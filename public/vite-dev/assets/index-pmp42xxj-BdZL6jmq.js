const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/raw-_eObXrMO-z93--tm9.js","assets/basedecoder-PFIibI7U-gdlnpIMU.js","assets/lzw-5BnjP5Zu-Rtm9pMoi.js","assets/jpeg-cL5qbLGO-DsQ9NELO.js","assets/deflate-vcCR2g03-uJvqLAd5.js","assets/pako.esm-BSHzuB9t-DQSVoCko.js","assets/packbits-QLsyzNt2-BPOn6aoD.js","assets/lerc-uk49vBKp-B8RQ-lpi.js","assets/webimage-Hf-HYtMO-Cer-ofJO.js"])))=>i.map(i=>d[i]);
const scriptRel="modulepreload",assetsURL=function(ie){return"/vite-dev/"+ie},seen={},__vitePreload=function(Z,ee,ae){let ye=Promise.resolve();if(ee&&ee.length>0){document.getElementsByTagName("link");const ve=document.querySelector("meta[property=csp-nonce]"),be=(ve==null?void 0:ve.nonce)||(ve==null?void 0:ve.getAttribute("nonce"));ye=Promise.all(ee.map(Ye=>{if(Ye=assetsURL(Ye),Ye in seen)return;seen[Ye]=!0;const Ke=Ye.endsWith(".css"),Xe=Ke?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${Ye}"]${Xe}`))return;const Je=document.createElement("link");if(Je.rel=Ke?"stylesheet":scriptRel,Ke||(Je.as="script",Je.crossOrigin=""),Je.href=Ye,be&&Je.setAttribute("nonce",be),document.head.appendChild(Je),Ke)return new Promise((rt,nt)=>{Je.addEventListener("load",rt),Je.addEventListener("error",()=>nt(new Error(`Unable to preload CSS for ${Ye}`)))})}))}return ye.then(()=>Z()).catch(ve=>{const be=new Event("vite:preloadError",{cancelable:!0});if(be.payload=ve,window.dispatchEvent(be),!be.defaultPrevented)throw ve})};var define_process_env_default={},oP=Object.defineProperty,aP=(ie,Z,ee)=>Z in ie?oP(ie,Z,{enumerable:!0,configurable:!0,writable:!0,value:ee}):ie[Z]=ee,Sc=(ie,Z,ee)=>(aP(ie,typeof Z!="symbol"?Z+"":Z,ee),ee);function _mergeNamespaces(ie,Z){for(var ee=0;ee<Z.length;ee++){const ae=Z[ee];if(typeof ae!="string"&&!Array.isArray(ae)){for(const ye in ae)if(ye!=="default"&&!(ye in ie)){const ve=Object.getOwnPropertyDescriptor(ae,ye);ve&&Object.defineProperty(ie,ye,ve.get?ve:{enumerable:!0,get:()=>ae[ye]})}}}return Object.freeze(Object.defineProperty(ie,Symbol.toStringTag,{value:"Module"}))}class BaseEvent{constructor(Z){this.propagationStopped,this.defaultPrevented,this.type=Z,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}const ObjectEventType={PROPERTYCHANGE:"propertychange"};class Disposable{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function binarySearch(ie,Z,ee){let ae,ye;ee=ee||ascending;let ve=0,be=ie.length,Ye=!1;for(;ve<be;)ae=ve+(be-ve>>1),ye=+ee(ie[ae],Z),ye<0?ve=ae+1:(be=ae,Ye=!ye);return Ye?ve:~ve}function ascending(ie,Z){return ie>Z?1:ie<Z?-1:0}function descending(ie,Z){return ie<Z?1:ie>Z?-1:0}function linearFindNearest(ie,Z,ee){if(ie[0]<=Z)return 0;const ae=ie.length;if(Z<=ie[ae-1])return ae-1;if(typeof ee=="function"){for(let ye=1;ye<ae;++ye){const ve=ie[ye];if(ve===Z)return ye;if(ve<Z)return ee(Z,ie[ye-1],ve)>0?ye-1:ye}return ae-1}if(ee>0){for(let ye=1;ye<ae;++ye)if(ie[ye]<Z)return ye-1;return ae-1}if(ee<0){for(let ye=1;ye<ae;++ye)if(ie[ye]<=Z)return ye;return ae-1}for(let ye=1;ye<ae;++ye){if(ie[ye]==Z)return ye;if(ie[ye]<Z)return ie[ye-1]-Z<Z-ie[ye]?ye-1:ye}return ae-1}function reverseSubArray(ie,Z,ee){for(;Z<ee;){const ae=ie[Z];ie[Z]=ie[ee],ie[ee]=ae,++Z,--ee}}function extend$2(ie,Z){const ee=Array.isArray(Z)?Z:[Z],ae=ee.length;for(let ye=0;ye<ae;ye++)ie[ie.length]=ee[ye]}function equals$2(ie,Z){const ee=ie.length;if(ee!==Z.length)return!1;for(let ae=0;ae<ee;ae++)if(ie[ae]!==Z[ae])return!1;return!0}function isSorted(ie,Z,ee){const ae=Z||ascending;return ie.every(function(ye,ve){if(ve===0)return!0;const be=ae(ie[ve-1],ye);return!(be>0||be===0)})}function TRUE(){return!0}function FALSE(){return!1}function VOID(){}function memoizeOne(ie){let Z=!1,ee,ae,ye;return function(){const ve=Array.prototype.slice.call(arguments);return(!Z||this!==ye||!equals$2(ve,ae))&&(Z=!0,ye=this,ae=ve,ee=ie.apply(this,arguments)),ee}}function toPromise(ie){function Z(){let ee;try{ee=ie()}catch(ae){return Promise.reject(ae)}return ee instanceof Promise?ee:Promise.resolve(ee)}return Z()}function clear(ie){for(const Z in ie)delete ie[Z]}function isEmpty$1(ie){let Z;for(Z in ie)return!1;return!Z}class Target extends Disposable{constructor(Z){super(),this.eventTarget_=Z,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(Z,ee){if(!Z||!ee)return;const ae=this.listeners_||(this.listeners_={}),ye=ae[Z]||(ae[Z]=[]);ye.includes(ee)||ye.push(ee)}dispatchEvent(Z){const ee=typeof Z=="string",ae=ee?Z:Z.type,ye=this.listeners_&&this.listeners_[ae];if(!ye)return;const ve=ee?new BaseEvent(Z):Z;ve.target||(ve.target=this.eventTarget_||this);const be=this.dispatching_||(this.dispatching_={}),Ye=this.pendingRemovals_||(this.pendingRemovals_={});ae in be||(be[ae]=0,Ye[ae]=0),++be[ae];let Ke;for(let Xe=0,Je=ye.length;Xe<Je;++Xe)if("handleEvent"in ye[Xe]?Ke=ye[Xe].handleEvent(ve):Ke=ye[Xe].call(this,ve),Ke===!1||ve.propagationStopped){Ke=!1;break}if(--be[ae]===0){let Xe=Ye[ae];for(delete Ye[ae];Xe--;)this.removeEventListener(ae,VOID);delete be[ae]}return Ke}disposeInternal(){this.listeners_&&clear(this.listeners_)}getListeners(Z){return this.listeners_&&this.listeners_[Z]||void 0}hasListener(Z){return this.listeners_?Z?Z in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(Z,ee){const ae=this.listeners_&&this.listeners_[Z];if(ae){const ye=ae.indexOf(ee);ye!==-1&&(this.pendingRemovals_&&Z in this.pendingRemovals_?(ae[ye]=VOID,++this.pendingRemovals_[Z]):(ae.splice(ye,1),ae.length===0&&delete this.listeners_[Z]))}}}const EventType={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function listen(ie,Z,ee,ae,ye){if(ae&&ae!==ie&&(ee=ee.bind(ae)),ye){const be=ee;ee=function(){ie.removeEventListener(Z,ee),be.apply(this,arguments)}}const ve={target:ie,type:Z,listener:ee};return ie.addEventListener(Z,ee),ve}function listenOnce(ie,Z,ee,ae){return listen(ie,Z,ee,ae,!0)}function unlistenByKey(ie){ie&&ie.target&&(ie.target.removeEventListener(ie.type,ie.listener),clear(ie))}class Observable extends Target{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(EventType.CHANGE)}getRevision(){return this.revision_}onInternal(Z,ee){if(Array.isArray(Z)){const ae=Z.length,ye=new Array(ae);for(let ve=0;ve<ae;++ve)ye[ve]=listen(this,Z[ve],ee);return ye}return listen(this,Z,ee)}onceInternal(Z,ee){let ae;if(Array.isArray(Z)){const ye=Z.length;ae=new Array(ye);for(let ve=0;ve<ye;++ve)ae[ve]=listenOnce(this,Z[ve],ee)}else ae=listenOnce(this,Z,ee);return ee.ol_key=ae,ae}unInternal(Z,ee){const ae=ee.ol_key;if(ae)unByKey(ae);else if(Array.isArray(Z))for(let ye=0,ve=Z.length;ye<ve;++ye)this.removeEventListener(Z[ye],ee);else this.removeEventListener(Z,ee)}}Observable.prototype.on;Observable.prototype.once;Observable.prototype.un;function unByKey(ie){if(Array.isArray(ie))for(let Z=0,ee=ie.length;Z<ee;++Z)unlistenByKey(ie[Z]);else unlistenByKey(ie)}function abstract(){throw new Error("Unimplemented abstract method.")}let uidCounter_=0;function getUid(ie){return ie.ol_uid||(ie.ol_uid=String(++uidCounter_))}class ObjectEvent extends BaseEvent{constructor(Z,ee,ae){super(Z),this.key=ee,this.oldValue=ae}}class BaseObject extends Observable{constructor(Z){super(),this.on,this.once,this.un,getUid(this),this.values_=null,Z!==void 0&&this.setProperties(Z)}get(Z){let ee;return this.values_&&this.values_.hasOwnProperty(Z)&&(ee=this.values_[Z]),ee}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(Z,ee){let ae;ae=`change:${Z}`,this.hasListener(ae)&&this.dispatchEvent(new ObjectEvent(ae,Z,ee)),ae=ObjectEventType.PROPERTYCHANGE,this.hasListener(ae)&&this.dispatchEvent(new ObjectEvent(ae,Z,ee))}addChangeListener(Z,ee){this.addEventListener(`change:${Z}`,ee)}removeChangeListener(Z,ee){this.removeEventListener(`change:${Z}`,ee)}set(Z,ee,ae){const ye=this.values_||(this.values_={});if(ae)ye[Z]=ee;else{const ve=ye[Z];ye[Z]=ee,ve!==ee&&this.notify(Z,ve)}}setProperties(Z,ee){for(const ae in Z)this.set(ae,Z[ae],ee)}applyProperties(Z){Z.values_&&Object.assign(this.values_||(this.values_={}),Z.values_)}unset(Z,ee){if(this.values_&&Z in this.values_){const ae=this.values_[Z];delete this.values_[Z],isEmpty$1(this.values_)&&(this.values_=null),ee||this.notify(Z,ae)}}}const CollectionEventType={ADD:"add",REMOVE:"remove"},Property$2={LENGTH:"length"};class CollectionEvent extends BaseEvent{constructor(Z,ee,ae){super(Z),this.element=ee,this.index=ae}}class Collection extends BaseObject{constructor(Z,ee){if(super(),this.on,this.once,this.un,ee=ee||{},this.unique_=!!ee.unique,this.array_=Z||[],this.unique_)for(let ae=0,ye=this.array_.length;ae<ye;++ae)this.assertUnique_(this.array_[ae],ae);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(Z){for(let ee=0,ae=Z.length;ee<ae;++ee)this.push(Z[ee]);return this}forEach(Z){const ee=this.array_;for(let ae=0,ye=ee.length;ae<ye;++ae)Z(ee[ae],ae,ee)}getArray(){return this.array_}item(Z){return this.array_[Z]}getLength(){return this.get(Property$2.LENGTH)}insertAt(Z,ee){if(Z<0||Z>this.getLength())throw new Error("Index out of bounds: "+Z);this.unique_&&this.assertUnique_(ee),this.array_.splice(Z,0,ee),this.updateLength_(),this.dispatchEvent(new CollectionEvent(CollectionEventType.ADD,ee,Z))}pop(){return this.removeAt(this.getLength()-1)}push(Z){this.unique_&&this.assertUnique_(Z);const ee=this.getLength();return this.insertAt(ee,Z),this.getLength()}remove(Z){const ee=this.array_;for(let ae=0,ye=ee.length;ae<ye;++ae)if(ee[ae]===Z)return this.removeAt(ae)}removeAt(Z){if(Z<0||Z>=this.getLength())return;const ee=this.array_[Z];return this.array_.splice(Z,1),this.updateLength_(),this.dispatchEvent(new CollectionEvent(CollectionEventType.REMOVE,ee,Z)),ee}setAt(Z,ee){const ae=this.getLength();if(Z>=ae){this.insertAt(Z,ee);return}if(Z<0)throw new Error("Index out of bounds: "+Z);this.unique_&&this.assertUnique_(ee,Z);const ye=this.array_[Z];this.array_[Z]=ee,this.dispatchEvent(new CollectionEvent(CollectionEventType.REMOVE,ye,Z)),this.dispatchEvent(new CollectionEvent(CollectionEventType.ADD,ee,Z))}updateLength_(){this.set(Property$2.LENGTH,this.array_.length)}assertUnique_(Z,ee){for(let ae=0,ye=this.array_.length;ae<ye;++ae)if(this.array_[ae]===Z&&ae!==ee)throw new Error("Duplicate item added to a unique collection")}}function assert(ie,Z){if(!ie)throw new Error(Z)}class Feature extends BaseObject{constructor(Z){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),Z)if(typeof Z.getSimplifiedGeometry=="function"){const ee=Z;this.setGeometry(ee)}else{const ee=Z;this.setProperties(ee)}}clone(){const Z=new Feature(this.hasProperties()?this.getProperties():null);Z.setGeometryName(this.getGeometryName());const ee=this.getGeometry();ee&&Z.setGeometry(ee.clone());const ae=this.getStyle();return ae&&Z.setStyle(ae),Z}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(unlistenByKey(this.geometryChangeKey_),this.geometryChangeKey_=null);const Z=this.getGeometry();Z&&(this.geometryChangeKey_=listen(Z,EventType.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(Z){this.set(this.geometryName_,Z)}setStyle(Z){this.style_=Z,this.styleFunction_=Z?createStyleFunction(Z):void 0,this.changed()}setId(Z){this.id_=Z,this.changed()}setGeometryName(Z){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=Z,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function createStyleFunction(ie){if(typeof ie=="function")return ie;let Z;return Array.isArray(ie)?Z=ie:(assert(typeof ie.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),Z=[ie]),function(){return Z}}const ua=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",FIREFOX=ua.includes("firefox"),SAFARI=ua.includes("safari")&&!ua.includes("chrom"),SAFARI_BUG_237906=SAFARI&&(ua.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(ua)),WEBKIT=ua.includes("webkit")&&!ua.includes("edge"),MAC=ua.includes("macintosh"),DEVICE_PIXEL_RATIO=typeof devicePixelRatio<"u"?devicePixelRatio:1,WORKER_OFFSCREEN_CANVAS=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,IMAGE_DECODE=typeof Image<"u"&&Image.prototype.decode,PASSIVE_EVENT_LISTENERS=function(){let ie=!1;try{const Z=Object.defineProperty({},"passive",{get:function(){ie=!0}});window.addEventListener("_",null,Z),window.removeEventListener("_",null,Z)}catch{}return ie}(),tmp_=new Array(6);function create$2(){return[1,0,0,1,0,0]}function reset(ie){return set(ie,1,0,0,1,0,0)}function multiply(ie,Z){const ee=ie[0],ae=ie[1],ye=ie[2],ve=ie[3],be=ie[4],Ye=ie[5],Ke=Z[0],Xe=Z[1],Je=Z[2],rt=Z[3],nt=Z[4],it=Z[5];return ie[0]=ee*Ke+ye*Xe,ie[1]=ae*Ke+ve*Xe,ie[2]=ee*Je+ye*rt,ie[3]=ae*Je+ve*rt,ie[4]=ee*nt+ye*it+be,ie[5]=ae*nt+ve*it+Ye,ie}function set(ie,Z,ee,ae,ye,ve,be){return ie[0]=Z,ie[1]=ee,ie[2]=ae,ie[3]=ye,ie[4]=ve,ie[5]=be,ie}function setFromArray(ie,Z){return ie[0]=Z[0],ie[1]=Z[1],ie[2]=Z[2],ie[3]=Z[3],ie[4]=Z[4],ie[5]=Z[5],ie}function apply(ie,Z){const ee=Z[0],ae=Z[1];return Z[0]=ie[0]*ee+ie[2]*ae+ie[4],Z[1]=ie[1]*ee+ie[3]*ae+ie[5],Z}function rotate$3(ie,Z){const ee=Math.cos(Z),ae=Math.sin(Z);return multiply(ie,set(tmp_,ee,ae,-ae,ee,0,0))}function scale$3(ie,Z,ee){return multiply(ie,set(tmp_,Z,0,0,ee,0,0))}function translate$1(ie,Z,ee){return multiply(ie,set(tmp_,1,0,0,1,Z,ee))}function compose$1(ie,Z,ee,ae,ye,ve,be,Ye){const Ke=Math.sin(ve),Xe=Math.cos(ve);return ie[0]=ae*Xe,ie[1]=ye*Ke,ie[2]=-ae*Ke,ie[3]=ye*Xe,ie[4]=be*ae*Xe-Ye*ae*Ke+Z,ie[5]=be*ye*Ke+Ye*ye*Xe+ee,ie}function makeInverse(ie,Z){const ee=determinant(Z);assert(ee!==0,"Transformation matrix cannot be inverted");const ae=Z[0],ye=Z[1],ve=Z[2],be=Z[3],Ye=Z[4],Ke=Z[5];return ie[0]=be/ee,ie[1]=-ye/ee,ie[2]=-ve/ee,ie[3]=ae/ee,ie[4]=(ve*Ke-be*Ye)/ee,ie[5]=-(ae*Ke-ye*Ye)/ee,ie}function determinant(ie){return ie[0]*ie[3]-ie[1]*ie[2]}let transformStringDiv;function toString$1(ie){const Z="matrix("+ie.join(", ")+")";if(WORKER_OFFSCREEN_CANVAS)return Z;const ee=transformStringDiv||(transformStringDiv=document.createElement("div"));return ee.style.transform=Z,ee.style.transform}const Relationship={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function boundingExtent(ie){const Z=createEmpty();for(let ee=0,ae=ie.length;ee<ae;++ee)extendCoordinate(Z,ie[ee]);return Z}function _boundingExtentXYs(ie,Z,ee){const ae=Math.min.apply(null,ie),ye=Math.min.apply(null,Z),ve=Math.max.apply(null,ie),be=Math.max.apply(null,Z);return createOrUpdate$2(ae,ye,ve,be,ee)}function buffer$1(ie,Z,ee){return ee?(ee[0]=ie[0]-Z,ee[1]=ie[1]-Z,ee[2]=ie[2]+Z,ee[3]=ie[3]+Z,ee):[ie[0]-Z,ie[1]-Z,ie[2]+Z,ie[3]+Z]}function clone(ie,Z){return Z?(Z[0]=ie[0],Z[1]=ie[1],Z[2]=ie[2],Z[3]=ie[3],Z):ie.slice()}function closestSquaredDistanceXY(ie,Z,ee){let ae,ye;return Z<ie[0]?ae=ie[0]-Z:ie[2]<Z?ae=Z-ie[2]:ae=0,ee<ie[1]?ye=ie[1]-ee:ie[3]<ee?ye=ee-ie[3]:ye=0,ae*ae+ye*ye}function containsCoordinate(ie,Z){return containsXY(ie,Z[0],Z[1])}function containsExtent(ie,Z){return ie[0]<=Z[0]&&Z[2]<=ie[2]&&ie[1]<=Z[1]&&Z[3]<=ie[3]}function containsXY(ie,Z,ee){return ie[0]<=Z&&Z<=ie[2]&&ie[1]<=ee&&ee<=ie[3]}function coordinateRelationship(ie,Z){const ee=ie[0],ae=ie[1],ye=ie[2],ve=ie[3],be=Z[0],Ye=Z[1];let Ke=Relationship.UNKNOWN;return be<ee?Ke=Ke|Relationship.LEFT:be>ye&&(Ke=Ke|Relationship.RIGHT),Ye<ae?Ke=Ke|Relationship.BELOW:Ye>ve&&(Ke=Ke|Relationship.ABOVE),Ke===Relationship.UNKNOWN&&(Ke=Relationship.INTERSECTING),Ke}function createEmpty(){return[1/0,1/0,-1/0,-1/0]}function createOrUpdate$2(ie,Z,ee,ae,ye){return ye?(ye[0]=ie,ye[1]=Z,ye[2]=ee,ye[3]=ae,ye):[ie,Z,ee,ae]}function createOrUpdateEmpty(ie){return createOrUpdate$2(1/0,1/0,-1/0,-1/0,ie)}function createOrUpdateFromCoordinate(ie,Z){const ee=ie[0],ae=ie[1];return createOrUpdate$2(ee,ae,ee,ae,Z)}function createOrUpdateFromFlatCoordinates(ie,Z,ee,ae,ye){const ve=createOrUpdateEmpty(ye);return extendFlatCoordinates(ve,ie,Z,ee,ae)}function equals$1(ie,Z){return ie[0]==Z[0]&&ie[2]==Z[2]&&ie[1]==Z[1]&&ie[3]==Z[3]}function extend$1(ie,Z){return Z[0]<ie[0]&&(ie[0]=Z[0]),Z[2]>ie[2]&&(ie[2]=Z[2]),Z[1]<ie[1]&&(ie[1]=Z[1]),Z[3]>ie[3]&&(ie[3]=Z[3]),ie}function extendCoordinate(ie,Z){Z[0]<ie[0]&&(ie[0]=Z[0]),Z[0]>ie[2]&&(ie[2]=Z[0]),Z[1]<ie[1]&&(ie[1]=Z[1]),Z[1]>ie[3]&&(ie[3]=Z[1])}function extendFlatCoordinates(ie,Z,ee,ae,ye){for(;ee<ae;ee+=ye)extendXY(ie,Z[ee],Z[ee+1]);return ie}function extendXY(ie,Z,ee){ie[0]=Math.min(ie[0],Z),ie[1]=Math.min(ie[1],ee),ie[2]=Math.max(ie[2],Z),ie[3]=Math.max(ie[3],ee)}function forEachCorner(ie,Z){let ee;return ee=Z(getBottomLeft(ie)),ee||(ee=Z(getBottomRight(ie)),ee)||(ee=Z(getTopRight(ie)),ee)||(ee=Z(getTopLeft(ie)),ee)?ee:!1}function getArea(ie){let Z=0;return isEmpty(ie)||(Z=getWidth(ie)*getHeight(ie)),Z}function getBottomLeft(ie){return[ie[0],ie[1]]}function getBottomRight(ie){return[ie[2],ie[1]]}function getCenter(ie){return[(ie[0]+ie[2])/2,(ie[1]+ie[3])/2]}function getCorner(ie,Z){let ee;if(Z==="bottom-left")ee=getBottomLeft(ie);else if(Z==="bottom-right")ee=getBottomRight(ie);else if(Z==="top-left")ee=getTopLeft(ie);else if(Z==="top-right")ee=getTopRight(ie);else throw new Error("Invalid corner");return ee}function getForViewAndSize(ie,Z,ee,ae,ye){const[ve,be,Ye,Ke,Xe,Je,rt,nt]=getRotatedViewport(ie,Z,ee,ae);return createOrUpdate$2(Math.min(ve,Ye,Xe,rt),Math.min(be,Ke,Je,nt),Math.max(ve,Ye,Xe,rt),Math.max(be,Ke,Je,nt),ye)}function getRotatedViewport(ie,Z,ee,ae){const ye=Z*ae[0]/2,ve=Z*ae[1]/2,be=Math.cos(ee),Ye=Math.sin(ee),Ke=ye*be,Xe=ye*Ye,Je=ve*be,rt=ve*Ye,nt=ie[0],it=ie[1];return[nt-Ke+rt,it-Xe-Je,nt-Ke-rt,it-Xe+Je,nt+Ke-rt,it+Xe+Je,nt+Ke+rt,it+Xe-Je,nt-Ke+rt,it-Xe-Je]}function getHeight(ie){return ie[3]-ie[1]}function getIntersection(ie,Z,ee){const ae=ee||createEmpty();return intersects$1(ie,Z)?(ie[0]>Z[0]?ae[0]=ie[0]:ae[0]=Z[0],ie[1]>Z[1]?ae[1]=ie[1]:ae[1]=Z[1],ie[2]<Z[2]?ae[2]=ie[2]:ae[2]=Z[2],ie[3]<Z[3]?ae[3]=ie[3]:ae[3]=Z[3]):createOrUpdateEmpty(ae),ae}function getTopLeft(ie){return[ie[0],ie[3]]}function getTopRight(ie){return[ie[2],ie[3]]}function getWidth(ie){return ie[2]-ie[0]}function intersects$1(ie,Z){return ie[0]<=Z[2]&&ie[2]>=Z[0]&&ie[1]<=Z[3]&&ie[3]>=Z[1]}function isEmpty(ie){return ie[2]<ie[0]||ie[3]<ie[1]}function returnOrUpdate(ie,Z){return Z?(Z[0]=ie[0],Z[1]=ie[1],Z[2]=ie[2],Z[3]=ie[3],Z):ie}function intersectsSegment(ie,Z,ee){let ae=!1;const ye=coordinateRelationship(ie,Z),ve=coordinateRelationship(ie,ee);if(ye===Relationship.INTERSECTING||ve===Relationship.INTERSECTING)ae=!0;else{const be=ie[0],Ye=ie[1],Ke=ie[2],Xe=ie[3],Je=Z[0],rt=Z[1],nt=ee[0],it=ee[1],lt=(it-rt)/(nt-Je);let ct,ot;ve&Relationship.ABOVE&&!(ye&Relationship.ABOVE)&&(ct=nt-(it-Xe)/lt,ae=ct>=be&&ct<=Ke),!ae&&ve&Relationship.RIGHT&&!(ye&Relationship.RIGHT)&&(ot=it-(nt-Ke)*lt,ae=ot>=Ye&&ot<=Xe),!ae&&ve&Relationship.BELOW&&!(ye&Relationship.BELOW)&&(ct=nt-(it-Ye)/lt,ae=ct>=be&&ct<=Ke),!ae&&ve&Relationship.LEFT&&!(ye&Relationship.LEFT)&&(ot=it-(nt-be)*lt,ae=ot>=Ye&&ot<=Xe)}return ae}function applyTransform(ie,Z,ee,ae){if(isEmpty(ie))return createOrUpdateEmpty(ee);let ye=[];ye=[ie[0],ie[1],ie[2],ie[1],ie[2],ie[3],ie[0],ie[3]],Z(ye,ye,2);const ve=[],be=[];for(let Ye=0,Ke=ye.length;Ye<Ke;Ye+=2)ve.push(ye[Ye]),be.push(ye[Ye+1]);return _boundingExtentXYs(ve,be,ee)}const unitByCode={9001:"m",9002:"ft",9003:"us-ft",9101:"radians",9102:"degrees"};function fromCode(ie){return unitByCode[ie]}const METERS_PER_UNIT$1={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class Projection{constructor(Z){this.code_=Z.code,this.units_=Z.units,this.extent_=Z.extent!==void 0?Z.extent:null,this.worldExtent_=Z.worldExtent!==void 0?Z.worldExtent:null,this.axisOrientation_=Z.axisOrientation!==void 0?Z.axisOrientation:"enu",this.global_=Z.global!==void 0?Z.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=Z.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=Z.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||METERS_PER_UNIT$1[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(Z){this.global_=Z,this.canWrapX_=!!(Z&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(Z){this.defaultTileGrid_=Z}setExtent(Z){this.extent_=Z,this.canWrapX_=!!(this.global_&&Z)}setWorldExtent(Z){this.worldExtent_=Z}setGetPointResolution(Z){this.getPointResolutionFunc_=Z}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const RADIUS$1=6378137,HALF_SIZE=Math.PI*RADIUS$1,EXTENT$1=[-HALF_SIZE,-HALF_SIZE,HALF_SIZE,HALF_SIZE],WORLD_EXTENT=[-180,-85,180,85],MAX_SAFE_Y=RADIUS$1*Math.log(Math.tan(Math.PI/2));class EPSG3857Projection extends Projection{constructor(Z){super({code:Z,units:"m",extent:EXTENT$1,global:!0,worldExtent:WORLD_EXTENT,getPointResolution:function(ee,ae){return ee/Math.cosh(ae[1]/RADIUS$1)}})}}const PROJECTIONS$1=[new EPSG3857Projection("EPSG:3857"),new EPSG3857Projection("EPSG:102100"),new EPSG3857Projection("EPSG:102113"),new EPSG3857Projection("EPSG:900913"),new EPSG3857Projection("http://www.opengis.net/def/crs/EPSG/0/3857"),new EPSG3857Projection("http://www.opengis.net/gml/srs/epsg.xml#3857")];function fromEPSG4326(ie,Z,ee){const ae=ie.length;ee=ee>1?ee:2,Z===void 0&&(ee>2?Z=ie.slice():Z=new Array(ae));for(let ye=0;ye<ae;ye+=ee){Z[ye]=HALF_SIZE*ie[ye]/180;let ve=RADIUS$1*Math.log(Math.tan(Math.PI*(+ie[ye+1]+90)/360));ve>MAX_SAFE_Y?ve=MAX_SAFE_Y:ve<-MAX_SAFE_Y&&(ve=-MAX_SAFE_Y),Z[ye+1]=ve}return Z}function toEPSG4326(ie,Z,ee){const ae=ie.length;ee=ee>1?ee:2,Z===void 0&&(ee>2?Z=ie.slice():Z=new Array(ae));for(let ye=0;ye<ae;ye+=ee)Z[ye]=180*ie[ye]/HALF_SIZE,Z[ye+1]=360*Math.atan(Math.exp(ie[ye+1]/RADIUS$1))/Math.PI-90;return Z}const RADIUS=6378137,EXTENT=[-180,-90,180,90],METERS_PER_UNIT=Math.PI*RADIUS/180;class EPSG4326Projection extends Projection{constructor(Z,ee){super({code:Z,units:"degrees",extent:EXTENT,axisOrientation:ee,global:!0,metersPerUnit:METERS_PER_UNIT,worldExtent:EXTENT})}}const PROJECTIONS=[new EPSG4326Projection("CRS:84"),new EPSG4326Projection("EPSG:4326","neu"),new EPSG4326Projection("urn:ogc:def:crs:OGC:1.3:CRS84"),new EPSG4326Projection("urn:ogc:def:crs:OGC:2:84"),new EPSG4326Projection("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new EPSG4326Projection("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new EPSG4326Projection("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let cache={};function get$3(ie){return cache[ie]||cache[ie.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function add$2(ie,Z){cache[ie]=Z}let transforms={};function add$1(ie,Z,ee){const ae=ie.getCode(),ye=Z.getCode();ae in transforms||(transforms[ae]={}),transforms[ae][ye]=ee}function get$2(ie,Z){let ee;return ie in transforms&&Z in transforms[ie]&&(ee=transforms[ie][Z]),ee}function clamp$1(ie,Z,ee){return Math.min(Math.max(ie,Z),ee)}function squaredSegmentDistance(ie,Z,ee,ae,ye,ve){const be=ye-ee,Ye=ve-ae;if(be!==0||Ye!==0){const Ke=((ie-ee)*be+(Z-ae)*Ye)/(be*be+Ye*Ye);Ke>1?(ee=ye,ae=ve):Ke>0&&(ee+=be*Ke,ae+=Ye*Ke)}return squaredDistance(ie,Z,ee,ae)}function squaredDistance(ie,Z,ee,ae){const ye=ee-ie,ve=ae-Z;return ye*ye+ve*ve}function solveLinearSystem(ie){const Z=ie.length;for(let ae=0;ae<Z;ae++){let ye=ae,ve=Math.abs(ie[ae][ae]);for(let Ye=ae+1;Ye<Z;Ye++){const Ke=Math.abs(ie[Ye][ae]);Ke>ve&&(ve=Ke,ye=Ye)}if(ve===0)return null;const be=ie[ye];ie[ye]=ie[ae],ie[ae]=be;for(let Ye=ae+1;Ye<Z;Ye++){const Ke=-ie[Ye][ae]/ie[ae][ae];for(let Xe=ae;Xe<Z+1;Xe++)ae==Xe?ie[Ye][Xe]=0:ie[Ye][Xe]+=Ke*ie[ae][Xe]}}const ee=new Array(Z);for(let ae=Z-1;ae>=0;ae--){ee[ae]=ie[ae][Z]/ie[ae][ae];for(let ye=ae-1;ye>=0;ye--)ie[ye][Z]-=ie[ye][ae]*ee[ae]}return ee}function toRadians(ie){return ie*Math.PI/180}function modulo(ie,Z){const ee=ie%Z;return ee*Z<0?ee+Z:ee}function lerp$1(ie,Z,ee){return ie+ee*(Z-ie)}function toFixed(ie,Z){const ee=Math.pow(10,Z);return Math.round(ie*ee)/ee}function floor$1(ie,Z){return Math.floor(toFixed(ie,Z))}function ceil(ie,Z){return Math.ceil(toFixed(ie,Z))}function add(ie,Z){return ie[0]+=+Z[0],ie[1]+=+Z[1],ie}function equals(ie,Z){let ee=!0;for(let ae=ie.length-1;ae>=0;--ae)if(ie[ae]!=Z[ae]){ee=!1;break}return ee}function rotate$2(ie,Z){const ee=Math.cos(Z),ae=Math.sin(Z),ye=ie[0]*ee-ie[1]*ae,ve=ie[1]*ee+ie[0]*ae;return ie[0]=ye,ie[1]=ve,ie}function scale$2(ie,Z){return ie[0]*=Z,ie[1]*=Z,ie}function wrapX$1(ie,Z){if(Z.canWrapX()){const ee=getWidth(Z.getExtent()),ae=getWorldsAway(ie,Z,ee);ae&&(ie[0]-=ae*ee)}return ie}function getWorldsAway(ie,Z,ee){const ae=Z.getExtent();let ye=0;return Z.canWrapX()&&(ie[0]<ae[0]||ie[0]>ae[2])&&(ee=ee||getWidth(ae),ye=Math.floor((ie[0]-ae[0])/ee)),ye}const DEFAULT_RADIUS=63710088e-1;function getDistance(ie,Z,ee){ee=ee||DEFAULT_RADIUS;const ae=toRadians(ie[1]),ye=toRadians(Z[1]),ve=(ye-ae)/2,be=toRadians(Z[0]-ie[0])/2,Ye=Math.sin(ve)*Math.sin(ve)+Math.sin(be)*Math.sin(be)*Math.cos(ae)*Math.cos(ye);return 2*ee*Math.atan2(Math.sqrt(Ye),Math.sqrt(1-Ye))}function warn(...ie){console.warn(...ie)}function error(...ie){console.error(...ie)}let showCoordinateWarning=!0;function disableCoordinateWarning(ie){showCoordinateWarning=!1}function cloneTransform(ie,Z){if(Z!==void 0){for(let ee=0,ae=ie.length;ee<ae;++ee)Z[ee]=ie[ee];Z=Z}else Z=ie.slice();return Z}function identityTransform(ie,Z){if(Z!==void 0&&ie!==Z){for(let ee=0,ae=ie.length;ee<ae;++ee)Z[ee]=ie[ee];ie=Z}return ie}function addProjection(ie){add$2(ie.getCode(),ie),add$1(ie,ie,cloneTransform)}function addProjections(ie){ie.forEach(addProjection)}function get$1(ie){return typeof ie=="string"?get$3(ie):ie||null}function getPointResolution(ie,Z,ee,ae){ie=get$1(ie);let ye;const ve=ie.getPointResolutionFunc();if(ve)ye=ve(Z,ee);else{const be=ie.getUnits();if(be=="degrees"&&!ae||ae=="degrees")ye=Z;else{const Ye=getTransformFromProjections(ie,get$1("EPSG:4326"));if(Ye===identityTransform&&be!=="degrees")ye=Z*ie.getMetersPerUnit();else{let Xe=[ee[0]-Z/2,ee[1],ee[0]+Z/2,ee[1],ee[0],ee[1]-Z/2,ee[0],ee[1]+Z/2];Xe=Ye(Xe,Xe,2);const Je=getDistance(Xe.slice(0,2),Xe.slice(2,4)),rt=getDistance(Xe.slice(4,6),Xe.slice(6,8));ye=(Je+rt)/2}const Ke=ie.getMetersPerUnit();Ke!==void 0&&(ye/=Ke)}}return ye}function addEquivalentProjections(ie){addProjections(ie),ie.forEach(function(Z){ie.forEach(function(ee){Z!==ee&&add$1(Z,ee,cloneTransform)})})}function addEquivalentTransforms(ie,Z,ee,ae){ie.forEach(function(ye){Z.forEach(function(ve){add$1(ye,ve,ee),add$1(ve,ye,ae)})})}function createProjection(ie,Z){return ie?typeof ie=="string"?get$1(ie):ie:get$1(Z)}function equivalent(ie,Z){if(ie===Z)return!0;const ee=ie.getUnits()===Z.getUnits();return(ie.getCode()===Z.getCode()||getTransformFromProjections(ie,Z)===cloneTransform)&&ee}function getTransformFromProjections(ie,Z){const ee=ie.getCode(),ae=Z.getCode();let ye=get$2(ee,ae);return ye||(ye=identityTransform),ye}function getTransform(ie,Z){const ee=get$1(ie),ae=get$1(Z);return getTransformFromProjections(ee,ae)}function transform(ie,Z,ee){return getTransform(Z,ee)(ie,void 0,ie.length)}function transformExtent(ie,Z,ee,ae){const ye=getTransform(Z,ee);return applyTransform(ie,ye,void 0)}let userProjection=null;function setUserProjection(ie){userProjection=get$1(ie)}function getUserProjection(){return userProjection}function useGeographic(){setUserProjection("EPSG:4326")}function toUserCoordinate(ie,Z){return userProjection?transform(ie,Z,userProjection):ie}function fromUserCoordinate(ie,Z){return userProjection?transform(ie,userProjection,Z):(showCoordinateWarning&&!equals(ie,[0,0])&&ie[0]>=-180&&ie[0]<=180&&ie[1]>=-90&&ie[1]<=90&&(showCoordinateWarning=!1,warn("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),ie)}function toUserExtent(ie,Z){return userProjection?transformExtent(ie,Z,userProjection):ie}function fromUserExtent(ie,Z){return userProjection?transformExtent(ie,userProjection,Z):ie}function addCommon(){addEquivalentProjections(PROJECTIONS$1),addEquivalentProjections(PROJECTIONS),addEquivalentTransforms(PROJECTIONS,PROJECTIONS$1,fromEPSG4326,toEPSG4326)}addCommon();function transform2D(ie,Z,ee,ae,ye,ve){ve=ve||[];let be=0;for(let Ye=Z;Ye<ee;Ye+=ae){const Ke=ie[Ye],Xe=ie[Ye+1];ve[be++]=ye[0]*Ke+ye[2]*Xe+ye[4],ve[be++]=ye[1]*Ke+ye[3]*Xe+ye[5]}return ve&&ve.length!=be&&(ve.length=be),ve}function rotate$1(ie,Z,ee,ae,ye,ve,be){be=be||[];const Ye=Math.cos(ye),Ke=Math.sin(ye),Xe=ve[0],Je=ve[1];let rt=0;for(let nt=Z;nt<ee;nt+=ae){const it=ie[nt]-Xe,lt=ie[nt+1]-Je;be[rt++]=Xe+it*Ye-lt*Ke,be[rt++]=Je+it*Ke+lt*Ye;for(let ct=nt+2;ct<nt+ae;++ct)be[rt++]=ie[ct]}return be&&be.length!=rt&&(be.length=rt),be}function scale$1(ie,Z,ee,ae,ye,ve,be,Ye){Ye=Ye||[];const Ke=be[0],Xe=be[1];let Je=0;for(let rt=Z;rt<ee;rt+=ae){const nt=ie[rt]-Ke,it=ie[rt+1]-Xe;Ye[Je++]=Ke+ye*nt,Ye[Je++]=Xe+ve*it;for(let lt=rt+2;lt<rt+ae;++lt)Ye[Je++]=ie[lt]}return Ye&&Ye.length!=Je&&(Ye.length=Je),Ye}function translate(ie,Z,ee,ae,ye,ve,be){be=be||[];let Ye=0;for(let Ke=Z;Ke<ee;Ke+=ae){be[Ye++]=ie[Ke]+ye,be[Ye++]=ie[Ke+1]+ve;for(let Xe=Ke+2;Xe<Ke+ae;++Xe)be[Ye++]=ie[Xe]}return be&&be.length!=Ye&&(be.length=Ye),be}const tmpTransform$1=create$2();class Geometry extends BaseObject{constructor(){super(),this.extent_=createEmpty(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=memoizeOne(function(Z,ee,ae){if(!ae)return this.getSimplifiedGeometry(ee);const ye=this.clone();return ye.applyTransform(ae),ye.getSimplifiedGeometry(ee)})}simplifyTransformed(Z,ee){return this.simplifyTransformedInternal(this.getRevision(),Z,ee)}clone(){return abstract()}closestPointXY(Z,ee,ae,ye){return abstract()}containsXY(Z,ee){const ae=this.getClosestPoint([Z,ee]);return ae[0]===Z&&ae[1]===ee}getClosestPoint(Z,ee){return ee=ee||[NaN,NaN],this.closestPointXY(Z[0],Z[1],ee,1/0),ee}intersectsCoordinate(Z){return this.containsXY(Z[0],Z[1])}computeExtent(Z){return abstract()}getExtent(Z){if(this.extentRevision_!=this.getRevision()){const ee=this.computeExtent(this.extent_);(isNaN(ee[0])||isNaN(ee[1]))&&createOrUpdateEmpty(ee),this.extentRevision_=this.getRevision()}return returnOrUpdate(this.extent_,Z)}rotate(Z,ee){abstract()}scale(Z,ee,ae){abstract()}simplify(Z){return this.getSimplifiedGeometry(Z*Z)}getSimplifiedGeometry(Z){return abstract()}getType(){return abstract()}applyTransform(Z){abstract()}intersectsExtent(Z){return abstract()}translate(Z,ee){abstract()}transform(Z,ee){const ae=get$1(Z),ye=ae.getUnits()=="tile-pixels"?function(ve,be,Ye){const Ke=ae.getExtent(),Xe=ae.getWorldExtent(),Je=getHeight(Xe)/getHeight(Ke);return compose$1(tmpTransform$1,Xe[0],Xe[3],Je,-Je,0,0,0),transform2D(ve,0,ve.length,Ye,tmpTransform$1,be),getTransform(ae,ee)(ve,be,Ye)}:getTransform(ae,ee);return this.applyTransform(ye),this}}class SimpleGeometry extends Geometry{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates=null}computeExtent(Z){return createOrUpdateFromFlatCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,Z)}getCoordinates(){return abstract()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(Z){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),Z<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&Z<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const ee=this.getSimplifiedGeometryInternal(Z);return ee.getFlatCoordinates().length<this.flatCoordinates.length?ee:(this.simplifiedGeometryMaxMinSquaredTolerance=Z,this)}getSimplifiedGeometryInternal(Z){return this}getStride(){return this.stride}setFlatCoordinates(Z,ee){this.stride=getStrideForLayout(Z),this.layout=Z,this.flatCoordinates=ee}setCoordinates(Z,ee){abstract()}setLayout(Z,ee,ae){let ye;if(Z)ye=getStrideForLayout(Z);else{for(let ve=0;ve<ae;++ve){if(ee.length===0){this.layout="XY",this.stride=2;return}ee=ee[0]}ye=ee.length,Z=getLayoutForStride(ye)}this.layout=Z,this.stride=ye}applyTransform(Z){this.flatCoordinates&&(Z(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(Z,ee){const ae=this.getFlatCoordinates();if(ae){const ye=this.getStride();rotate$1(ae,0,ae.length,ye,Z,ee,ae),this.changed()}}scale(Z,ee,ae){ee===void 0&&(ee=Z),ae||(ae=getCenter(this.getExtent()));const ye=this.getFlatCoordinates();if(ye){const ve=this.getStride();scale$1(ye,0,ye.length,ve,Z,ee,ae,ye),this.changed()}}translate(Z,ee){const ae=this.getFlatCoordinates();if(ae){const ye=this.getStride();translate(ae,0,ae.length,ye,Z,ee,ae),this.changed()}}}function getLayoutForStride(ie){let Z;return ie==2?Z="XY":ie==3?Z="XYZ":ie==4&&(Z="XYZM"),Z}function getStrideForLayout(ie){let Z;return ie=="XY"?Z=2:ie=="XYZ"||ie=="XYM"?Z=3:ie=="XYZM"&&(Z=4),Z}function transformGeom2D(ie,Z,ee){const ae=ie.getFlatCoordinates();if(!ae)return null;const ye=ie.getStride();return transform2D(ae,0,ae.length,ye,Z,ee)}function assignClosest(ie,Z,ee,ae,ye,ve,be){const Ye=ie[Z],Ke=ie[Z+1],Xe=ie[ee]-Ye,Je=ie[ee+1]-Ke;let rt;if(Xe===0&&Je===0)rt=Z;else{const nt=((ye-Ye)*Xe+(ve-Ke)*Je)/(Xe*Xe+Je*Je);if(nt>1)rt=ee;else if(nt>0){for(let it=0;it<ae;++it)be[it]=lerp$1(ie[Z+it],ie[ee+it],nt);be.length=ae;return}else rt=Z}for(let nt=0;nt<ae;++nt)be[nt]=ie[rt+nt];be.length=ae}function maxSquaredDelta(ie,Z,ee,ae,ye){let ve=ie[Z],be=ie[Z+1];for(Z+=ae;Z<ee;Z+=ae){const Ye=ie[Z],Ke=ie[Z+1],Xe=squaredDistance(ve,be,Ye,Ke);Xe>ye&&(ye=Xe),ve=Ye,be=Ke}return ye}function arrayMaxSquaredDelta(ie,Z,ee,ae,ye){for(let ve=0,be=ee.length;ve<be;++ve){const Ye=ee[ve];ye=maxSquaredDelta(ie,Z,Ye,ae,ye),Z=Ye}return ye}function multiArrayMaxSquaredDelta(ie,Z,ee,ae,ye){for(let ve=0,be=ee.length;ve<be;++ve){const Ye=ee[ve];ye=arrayMaxSquaredDelta(ie,Z,Ye,ae,ye),Z=Ye[Ye.length-1]}return ye}function assignClosestPoint(ie,Z,ee,ae,ye,ve,be,Ye,Ke,Xe,Je){if(Z==ee)return Xe;let rt,nt;if(ye===0){if(nt=squaredDistance(be,Ye,ie[Z],ie[Z+1]),nt<Xe){for(rt=0;rt<ae;++rt)Ke[rt]=ie[Z+rt];return Ke.length=ae,nt}return Xe}Je=Je||[NaN,NaN];let it=Z+ae;for(;it<ee;)if(assignClosest(ie,it-ae,it,ae,be,Ye,Je),nt=squaredDistance(be,Ye,Je[0],Je[1]),nt<Xe){for(Xe=nt,rt=0;rt<ae;++rt)Ke[rt]=Je[rt];Ke.length=ae,it+=ae}else it+=ae*Math.max((Math.sqrt(nt)-Math.sqrt(Xe))/ye|0,1);if(ve&&(assignClosest(ie,ee-ae,Z,ae,be,Ye,Je),nt=squaredDistance(be,Ye,Je[0],Je[1]),nt<Xe)){for(Xe=nt,rt=0;rt<ae;++rt)Ke[rt]=Je[rt];Ke.length=ae}return Xe}function assignClosestArrayPoint(ie,Z,ee,ae,ye,ve,be,Ye,Ke,Xe,Je){Je=Je||[NaN,NaN];for(let rt=0,nt=ee.length;rt<nt;++rt){const it=ee[rt];Xe=assignClosestPoint(ie,Z,it,ae,ye,ve,be,Ye,Ke,Xe,Je),Z=it}return Xe}function assignClosestMultiArrayPoint(ie,Z,ee,ae,ye,ve,be,Ye,Ke,Xe,Je){Je=Je||[NaN,NaN];for(let rt=0,nt=ee.length;rt<nt;++rt){const it=ee[rt];Xe=assignClosestArrayPoint(ie,Z,it,ae,ye,ve,be,Ye,Ke,Xe,Je),Z=it[it.length-1]}return Xe}function deflateCoordinate(ie,Z,ee,ae){for(let ye=0,ve=ee.length;ye<ve;++ye)ie[Z++]=ee[ye];return Z}function deflateCoordinates(ie,Z,ee,ae){for(let ye=0,ve=ee.length;ye<ve;++ye){const be=ee[ye];for(let Ye=0;Ye<ae;++Ye)ie[Z++]=be[Ye]}return Z}function deflateCoordinatesArray(ie,Z,ee,ae,ye){ye=ye||[];let ve=0;for(let be=0,Ye=ee.length;be<Ye;++be){const Ke=deflateCoordinates(ie,Z,ee[be],ae);ye[ve++]=Ke,Z=Ke}return ye.length=ve,ye}function deflateMultiCoordinatesArray(ie,Z,ee,ae,ye){ye=ye||[];let ve=0;for(let be=0,Ye=ee.length;be<Ye;++be){const Ke=deflateCoordinatesArray(ie,Z,ee[be],ae,ye[ve]);Ke.length===0&&(Ke[0]=Z),ye[ve++]=Ke,Z=Ke[Ke.length-1]}return ye.length=ve,ye}function douglasPeucker(ie,Z,ee,ae,ye,ve,be){const Ye=(ee-Z)/ae;if(Ye<3){for(;Z<ee;Z+=ae)ve[be++]=ie[Z],ve[be++]=ie[Z+1];return be}const Ke=new Array(Ye);Ke[0]=1,Ke[Ye-1]=1;const Xe=[Z,ee-ae];let Je=0;for(;Xe.length>0;){const rt=Xe.pop(),nt=Xe.pop();let it=0;const lt=ie[nt],ct=ie[nt+1],ot=ie[rt],dt=ie[rt+1];for(let ft=nt+ae;ft<rt;ft+=ae){const gt=ie[ft],mt=ie[ft+1],Yr=squaredSegmentDistance(gt,mt,lt,ct,ot,dt);Yr>it&&(Je=ft,it=Yr)}it>ye&&(Ke[(Je-Z)/ae]=1,nt+ae<Je&&Xe.push(nt,Je),Je+ae<rt&&Xe.push(Je,rt))}for(let rt=0;rt<Ye;++rt)Ke[rt]&&(ve[be++]=ie[Z+rt*ae],ve[be++]=ie[Z+rt*ae+1]);return be}function douglasPeuckerArray(ie,Z,ee,ae,ye,ve,be,Ye){for(let Ke=0,Xe=ee.length;Ke<Xe;++Ke){const Je=ee[Ke];be=douglasPeucker(ie,Z,Je,ae,ye,ve,be),Ye.push(be),Z=Je}return be}function snap(ie,Z){return Z*Math.round(ie/Z)}function quantize(ie,Z,ee,ae,ye,ve,be){if(Z==ee)return be;let Ye=snap(ie[Z],ye),Ke=snap(ie[Z+1],ye);Z+=ae,ve[be++]=Ye,ve[be++]=Ke;let Xe,Je;do if(Xe=snap(ie[Z],ye),Je=snap(ie[Z+1],ye),Z+=ae,Z==ee)return ve[be++]=Xe,ve[be++]=Je,be;while(Xe==Ye&&Je==Ke);for(;Z<ee;){const rt=snap(ie[Z],ye),nt=snap(ie[Z+1],ye);if(Z+=ae,rt==Xe&&nt==Je)continue;const it=Xe-Ye,lt=Je-Ke,ct=rt-Ye,ot=nt-Ke;if(it*ot==lt*ct&&(it<0&&ct<it||it==ct||it>0&&ct>it)&&(lt<0&&ot<lt||lt==ot||lt>0&&ot>lt)){Xe=rt,Je=nt;continue}ve[be++]=Xe,ve[be++]=Je,Ye=Xe,Ke=Je,Xe=rt,Je=nt}return ve[be++]=Xe,ve[be++]=Je,be}function quantizeArray(ie,Z,ee,ae,ye,ve,be,Ye){for(let Ke=0,Xe=ee.length;Ke<Xe;++Ke){const Je=ee[Ke];be=quantize(ie,Z,Je,ae,ye,ve,be),Ye.push(be),Z=Je}return be}function quantizeMultiArray(ie,Z,ee,ae,ye,ve,be,Ye){for(let Ke=0,Xe=ee.length;Ke<Xe;++Ke){const Je=ee[Ke],rt=[];be=quantizeArray(ie,Z,Je,ae,ye,ve,be,rt),Ye.push(rt),Z=Je[Je.length-1]}return be}function inflateCoordinates(ie,Z,ee,ae,ye){ye=ye!==void 0?ye:[];let ve=0;for(let be=Z;be<ee;be+=ae)ye[ve++]=ie.slice(be,be+ae);return ye.length=ve,ye}function inflateCoordinatesArray(ie,Z,ee,ae,ye){ye=ye!==void 0?ye:[];let ve=0;for(let be=0,Ye=ee.length;be<Ye;++be){const Ke=ee[be];ye[ve++]=inflateCoordinates(ie,Z,Ke,ae,ye[ve]),Z=Ke}return ye.length=ve,ye}function inflateMultiCoordinatesArray(ie,Z,ee,ae,ye){ye=ye!==void 0?ye:[];let ve=0;for(let be=0,Ye=ee.length;be<Ye;++be){const Ke=ee[be];ye[ve++]=Ke.length===1&&Ke[0]===Z?[]:inflateCoordinatesArray(ie,Z,Ke,ae,ye[ve]),Z=Ke[Ke.length-1]}return ye.length=ve,ye}function linearRing(ie,Z,ee,ae){let ye=0,ve=ie[ee-ae],be=ie[ee-ae+1];for(;Z<ee;Z+=ae){const Ye=ie[Z],Ke=ie[Z+1];ye+=be*Ye-ve*Ke,ve=Ye,be=Ke}return ye/2}function linearRings(ie,Z,ee,ae){let ye=0;for(let ve=0,be=ee.length;ve<be;++ve){const Ye=ee[ve];ye+=linearRing(ie,Z,Ye,ae),Z=Ye}return ye}function linearRingss$1(ie,Z,ee,ae){let ye=0;for(let ve=0,be=ee.length;ve<be;++ve){const Ye=ee[ve];ye+=linearRings(ie,Z,Ye,ae),Z=Ye[Ye.length-1]}return ye}class LinearRing extends SimpleGeometry{constructor(Z,ee){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,ee!==void 0&&!Array.isArray(Z[0])?this.setFlatCoordinates(ee,Z):this.setCoordinates(Z,ee)}clone(){return new LinearRing(this.flatCoordinates.slice(),this.layout)}closestPointXY(Z,ee,ae,ye){return ye<closestSquaredDistanceXY(this.getExtent(),Z,ee)?ye:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(maxSquaredDelta(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestPoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,Z,ee,ae,ye))}getArea(){return linearRing(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return inflateCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(Z){const ee=[];return ee.length=douglasPeucker(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,Z,ee,0),new LinearRing(ee,"XY")}getType(){return"LinearRing"}intersectsExtent(Z){return!1}setCoordinates(Z,ee){this.setLayout(ee,Z,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinates(this.flatCoordinates,0,Z,this.stride),this.changed()}}class Point extends SimpleGeometry{constructor(Z,ee){super(),this.setCoordinates(Z,ee)}clone(){const Z=new Point(this.flatCoordinates.slice(),this.layout);return Z.applyProperties(this),Z}closestPointXY(Z,ee,ae,ye){const ve=this.flatCoordinates,be=squaredDistance(Z,ee,ve[0],ve[1]);if(be<ye){const Ye=this.stride;for(let Ke=0;Ke<Ye;++Ke)ae[Ke]=ve[Ke];return ae.length=Ye,be}return ye}getCoordinates(){return this.flatCoordinates?this.flatCoordinates.slice():[]}computeExtent(Z){return createOrUpdateFromCoordinate(this.flatCoordinates,Z)}getType(){return"Point"}intersectsExtent(Z){return containsXY(Z,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(Z,ee){this.setLayout(ee,Z,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinate(this.flatCoordinates,0,Z,this.stride),this.changed()}}const Point$1=Point;function linearRingContainsExtent(ie,Z,ee,ae,ye){return!forEachCorner(ye,function(ve){return!linearRingContainsXY(ie,Z,ee,ae,ve[0],ve[1])})}function linearRingContainsXY(ie,Z,ee,ae,ye,ve){let be=0,Ye=ie[ee-ae],Ke=ie[ee-ae+1];for(;Z<ee;Z+=ae){const Xe=ie[Z],Je=ie[Z+1];Ke<=ve?Je>ve&&(Xe-Ye)*(ve-Ke)-(ye-Ye)*(Je-Ke)>0&&be++:Je<=ve&&(Xe-Ye)*(ve-Ke)-(ye-Ye)*(Je-Ke)<0&&be--,Ye=Xe,Ke=Je}return be!==0}function linearRingsContainsXY(ie,Z,ee,ae,ye,ve){if(ee.length===0||!linearRingContainsXY(ie,Z,ee[0],ae,ye,ve))return!1;for(let be=1,Ye=ee.length;be<Ye;++be)if(linearRingContainsXY(ie,ee[be-1],ee[be],ae,ye,ve))return!1;return!0}function linearRingssContainsXY(ie,Z,ee,ae,ye,ve){if(ee.length===0)return!1;for(let be=0,Ye=ee.length;be<Ye;++be){const Ke=ee[be];if(linearRingsContainsXY(ie,Z,Ke,ae,ye,ve))return!0;Z=Ke[Ke.length-1]}return!1}function getInteriorPointOfArray(ie,Z,ee,ae,ye,ve,be){let Ye,Ke,Xe,Je,rt,nt,it;const lt=ye[ve+1],ct=[];for(let ft=0,gt=ee.length;ft<gt;++ft){const mt=ee[ft];for(Je=ie[mt-ae],nt=ie[mt-ae+1],Ye=Z;Ye<mt;Ye+=ae)rt=ie[Ye],it=ie[Ye+1],(lt<=nt&&it<=lt||nt<=lt&&lt<=it)&&(Xe=(lt-nt)/(it-nt)*(rt-Je)+Je,ct.push(Xe)),Je=rt,nt=it}let ot=NaN,dt=-1/0;for(ct.sort(ascending),Je=ct[0],Ye=1,Ke=ct.length;Ye<Ke;++Ye){rt=ct[Ye];const ft=Math.abs(rt-Je);ft>dt&&(Xe=(Je+rt)/2,linearRingsContainsXY(ie,Z,ee,ae,Xe,lt)&&(ot=Xe,dt=ft)),Je=rt}return isNaN(ot)&&(ot=ye[ve]),be?(be.push(ot,lt,dt),be):[ot,lt,dt]}function getInteriorPointsOfMultiArray(ie,Z,ee,ae,ye){let ve=[];for(let be=0,Ye=ee.length;be<Ye;++be){const Ke=ee[be];ve=getInteriorPointOfArray(ie,Z,Ke,ae,ye,2*be,ve),Z=Ke[Ke.length-1]}return ve}function forEach(ie,Z,ee,ae,ye){let ve;for(Z+=ae;Z<ee;Z+=ae)if(ve=ye(ie.slice(Z-ae,Z),ie.slice(Z,Z+ae)),ve)return ve;return!1}function intersectsLineString(ie,Z,ee,ae,ye){const ve=extendFlatCoordinates(createEmpty(),ie,Z,ee,ae);return intersects$1(ye,ve)?containsExtent(ye,ve)||ve[0]>=ye[0]&&ve[2]<=ye[2]||ve[1]>=ye[1]&&ve[3]<=ye[3]?!0:forEach(ie,Z,ee,ae,function(be,Ye){return intersectsSegment(ye,be,Ye)}):!1}function intersectsLineStringArray(ie,Z,ee,ae,ye){for(let ve=0,be=ee.length;ve<be;++ve){if(intersectsLineString(ie,Z,ee[ve],ae,ye))return!0;Z=ee[ve]}return!1}function intersectsLinearRing(ie,Z,ee,ae,ye){return!!(intersectsLineString(ie,Z,ee,ae,ye)||linearRingContainsXY(ie,Z,ee,ae,ye[0],ye[1])||linearRingContainsXY(ie,Z,ee,ae,ye[0],ye[3])||linearRingContainsXY(ie,Z,ee,ae,ye[2],ye[1])||linearRingContainsXY(ie,Z,ee,ae,ye[2],ye[3]))}function intersectsLinearRingArray(ie,Z,ee,ae,ye){if(!intersectsLinearRing(ie,Z,ee[0],ae,ye))return!1;if(ee.length===1)return!0;for(let ve=1,be=ee.length;ve<be;++ve)if(linearRingContainsExtent(ie,ee[ve-1],ee[ve],ae,ye)&&!intersectsLineString(ie,ee[ve-1],ee[ve],ae,ye))return!1;return!0}function intersectsLinearRingMultiArray(ie,Z,ee,ae,ye){for(let ve=0,be=ee.length;ve<be;++ve){const Ye=ee[ve];if(intersectsLinearRingArray(ie,Z,Ye,ae,ye))return!0;Z=Ye[Ye.length-1]}return!1}function coordinates(ie,Z,ee,ae){for(;Z<ee-ae;){for(let ye=0;ye<ae;++ye){const ve=ie[Z+ye];ie[Z+ye]=ie[ee-ae+ye],ie[ee-ae+ye]=ve}Z+=ae,ee-=ae}}function linearRingIsClockwise(ie,Z,ee,ae){let ye=0,ve=ie[ee-ae],be=ie[ee-ae+1];for(;Z<ee;Z+=ae){const Ye=ie[Z],Ke=ie[Z+1];ye+=(Ye-ve)*(Ke+be),ve=Ye,be=Ke}return ye===0?void 0:ye>0}function linearRingsAreOriented(ie,Z,ee,ae,ye){ye=ye!==void 0?ye:!1;for(let ve=0,be=ee.length;ve<be;++ve){const Ye=ee[ve],Ke=linearRingIsClockwise(ie,Z,Ye,ae);if(ve===0){if(ye&&Ke||!ye&&!Ke)return!1}else if(ye&&!Ke||!ye&&Ke)return!1;Z=Ye}return!0}function linearRingssAreOriented(ie,Z,ee,ae,ye){for(let ve=0,be=ee.length;ve<be;++ve){const Ye=ee[ve];if(!linearRingsAreOriented(ie,Z,Ye,ae,ye))return!1;Ye.length&&(Z=Ye[Ye.length-1])}return!0}function orientLinearRings(ie,Z,ee,ae,ye){ye=ye!==void 0?ye:!1;for(let ve=0,be=ee.length;ve<be;++ve){const Ye=ee[ve],Ke=linearRingIsClockwise(ie,Z,Ye,ae);(ve===0?ye&&Ke||!ye&&!Ke:ye&&!Ke||!ye&&Ke)&&coordinates(ie,Z,Ye,ae),Z=Ye}return Z}function orientLinearRingsArray(ie,Z,ee,ae,ye){for(let ve=0,be=ee.length;ve<be;++ve)Z=orientLinearRings(ie,Z,ee[ve],ae,ye);return Z}function inflateEnds(ie,Z){const ee=[];let ae=0,ye=0;for(let ve=0,be=Z.length;ve<be;++ve){const Ye=Z[ve];if(!linearRingIsClockwise(ie,ae,Ye,2))ee.push(Z.slice(ye,ve+1));else{if(ee.length===0)continue;ee[ee.length-1].push(Z[ye])}ye=ve+1,ae=Ye}return ee}class Polygon extends SimpleGeometry{constructor(Z,ee,ae){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,ee!==void 0&&ae?(this.setFlatCoordinates(ee,Z),this.ends_=ae):this.setCoordinates(Z,ee)}appendLinearRing(Z){this.flatCoordinates?extend$2(this.flatCoordinates,Z.getFlatCoordinates()):this.flatCoordinates=Z.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const Z=new Polygon(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return Z.applyProperties(this),Z}closestPointXY(Z,ee,ae,ye){return ye<closestSquaredDistanceXY(this.getExtent(),Z,ee)?ye:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(arrayMaxSquaredDelta(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestArrayPoint(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,Z,ee,ae,ye))}containsXY(Z,ee){return linearRingsContainsXY(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,Z,ee)}getArea(){return linearRings(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(Z){let ee;return Z!==void 0?(ee=this.getOrientedFlatCoordinates().slice(),orientLinearRings(ee,0,this.ends_,this.stride,Z)):ee=this.flatCoordinates,inflateCoordinatesArray(ee,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const Z=getCenter(this.getExtent());this.flatInteriorPoint_=getInteriorPointOfArray(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,Z,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Point$1(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(Z){return Z<0||this.ends_.length<=Z?null:new LinearRing(this.flatCoordinates.slice(Z===0?0:this.ends_[Z-1],this.ends_[Z]),this.layout)}getLinearRings(){const Z=this.layout,ee=this.flatCoordinates,ae=this.ends_,ye=[];let ve=0;for(let be=0,Ye=ae.length;be<Ye;++be){const Ke=ae[be],Xe=new LinearRing(ee.slice(ve,Ke),Z);ye.push(Xe),ve=Ke}return ye}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const Z=this.flatCoordinates;linearRingsAreOriented(Z,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=Z:(this.orientedFlatCoordinates_=Z.slice(),this.orientedFlatCoordinates_.length=orientLinearRings(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(Z){const ee=[],ae=[];return ee.length=quantizeArray(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(Z),ee,0,ae),new Polygon(ee,"XY",ae)}getType(){return"Polygon"}intersectsExtent(Z){return intersectsLinearRingArray(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,Z)}setCoordinates(Z,ee){this.setLayout(ee,Z,2),this.flatCoordinates||(this.flatCoordinates=[]);const ae=deflateCoordinatesArray(this.flatCoordinates,0,Z,this.stride,this.ends_);this.flatCoordinates.length=ae.length===0?0:ae[ae.length-1],this.changed()}}const Polygon$1=Polygon;function fromExtent(ie){if(isEmpty(ie))throw new Error("Cannot create polygon from empty extent");const Z=ie[0],ee=ie[1],ae=ie[2],ye=ie[3],ve=[Z,ee,Z,ye,ae,ye,ae,ee,Z,ee];return new Polygon(ve,"XY",[ve.length])}const RenderEventType={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};class Fill{constructor(Z){Z=Z||{},this.color_=Z.color!==void 0?Z.color:null}clone(){const Z=this.getColor();return new Fill({color:Array.isArray(Z)?Z.slice():Z||void 0})}getColor(){return this.color_}setColor(Z){this.color_=Z}}function interpolatePoint(ie,Z,ee,ae,ye,ve,be){let Ye,Ke;const Xe=(ee-Z)/ae;if(Xe===1)Ye=Z;else if(Xe===2)Ye=Z,Ke=ye;else if(Xe!==0){let Je=ie[Z],rt=ie[Z+1],nt=0;const it=[0];for(let ot=Z+ae;ot<ee;ot+=ae){const dt=ie[ot],ft=ie[ot+1];nt+=Math.sqrt((dt-Je)*(dt-Je)+(ft-rt)*(ft-rt)),it.push(nt),Je=dt,rt=ft}const lt=ye*nt,ct=binarySearch(it,lt);ct<0?(Ke=(lt-it[-ct-2])/(it[-ct-1]-it[-ct-2]),Ye=Z+(-ct-2)*ae):Ye=Z+ct*ae}be=be>1?be:2,ve=ve||new Array(be);for(let Je=0;Je<be;++Je)ve[Je]=Ye===void 0?NaN:Ke===void 0?ie[Ye+Je]:lerp$1(ie[Ye+Je],ie[Ye+ae+Je],Ke);return ve}function lineStringCoordinateAtM(ie,Z,ee,ae,ye,ve){if(ee==Z)return null;let be;if(ye<ie[Z+ae-1])return ve?(be=ie.slice(Z,Z+ae),be[ae-1]=ye,be):null;if(ie[ee-1]<ye)return ve?(be=ie.slice(ee-ae,ee),be[ae-1]=ye,be):null;if(ye==ie[Z+ae-1])return ie.slice(Z,Z+ae);let Ye=Z/ae,Ke=ee/ae;for(;Ye<Ke;){const nt=Ye+Ke>>1;ye<ie[(nt+1)*ae-1]?Ke=nt:Ye=nt+1}const Xe=ie[Ye*ae-1];if(ye==Xe)return ie.slice((Ye-1)*ae,(Ye-1)*ae+ae);const Je=ie[(Ye+1)*ae-1],rt=(ye-Xe)/(Je-Xe);be=[];for(let nt=0;nt<ae-1;++nt)be.push(lerp$1(ie[(Ye-1)*ae+nt],ie[Ye*ae+nt],rt));return be.push(ye),be}function lineStringsCoordinateAtM(ie,Z,ee,ae,ye,ve,be){if(be)return lineStringCoordinateAtM(ie,Z,ee[ee.length-1],ae,ye,ve);let Ye;if(ye<ie[ae-1])return ve?(Ye=ie.slice(0,ae),Ye[ae-1]=ye,Ye):null;if(ie[ie.length-1]<ye)return ve?(Ye=ie.slice(ie.length-ae),Ye[ae-1]=ye,Ye):null;for(let Ke=0,Xe=ee.length;Ke<Xe;++Ke){const Je=ee[Ke];if(Z!=Je){if(ye<ie[Z+ae-1])return null;if(ye<=ie[Je-1])return lineStringCoordinateAtM(ie,Z,Je,ae,ye,!1);Z=Je}}return null}function lineStringLength(ie,Z,ee,ae){let ye=ie[Z],ve=ie[Z+1],be=0;for(let Ye=Z+ae;Ye<ee;Ye+=ae){const Ke=ie[Ye],Xe=ie[Ye+1];be+=Math.sqrt((Ke-ye)*(Ke-ye)+(Xe-ve)*(Xe-ve)),ye=Ke,ve=Xe}return be}class LineString extends SimpleGeometry{constructor(Z,ee){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,ee!==void 0&&!Array.isArray(Z[0])?this.setFlatCoordinates(ee,Z):this.setCoordinates(Z,ee)}appendCoordinate(Z){this.flatCoordinates?extend$2(this.flatCoordinates,Z):this.flatCoordinates=Z.slice(),this.changed()}clone(){const Z=new LineString(this.flatCoordinates.slice(),this.layout);return Z.applyProperties(this),Z}closestPointXY(Z,ee,ae,ye){return ye<closestSquaredDistanceXY(this.getExtent(),Z,ee)?ye:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(maxSquaredDelta(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestPoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,Z,ee,ae,ye))}forEachSegment(Z){return forEach(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,Z)}getCoordinateAtM(Z,ee){return this.layout!="XYM"&&this.layout!="XYZM"?null:(ee=ee!==void 0?ee:!1,lineStringCoordinateAtM(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,Z,ee))}getCoordinates(){return inflateCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(Z,ee){return interpolatePoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,Z,ee,this.stride)}getLength(){return lineStringLength(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(Z){const ee=[];return ee.length=douglasPeucker(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,Z,ee,0),new LineString(ee,"XY")}getType(){return"LineString"}intersectsExtent(Z){return intersectsLineString(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,Z)}setCoordinates(Z,ee){this.setLayout(ee,Z,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinates(this.flatCoordinates,0,Z,this.stride),this.changed()}}const LineString$1=LineString;class Stroke{constructor(Z){Z=Z||{},this.color_=Z.color!==void 0?Z.color:null,this.lineCap_=Z.lineCap,this.lineDash_=Z.lineDash!==void 0?Z.lineDash:null,this.lineDashOffset_=Z.lineDashOffset,this.lineJoin_=Z.lineJoin,this.miterLimit_=Z.miterLimit,this.width_=Z.width}clone(){const Z=this.getColor();return new Stroke({color:Array.isArray(Z)?Z.slice():Z||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(Z){this.color_=Z}setLineCap(Z){this.lineCap_=Z}setLineDash(Z){this.lineDash_=Z}setLineDashOffset(Z){this.lineDashOffset_=Z}setLineJoin(Z){this.lineJoin_=Z}setMiterLimit(Z){this.miterLimit_=Z}setWidth(Z){this.width_=Z}}const ImageState={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function hasArea(ie){return ie[0]>0&&ie[1]>0}function scale(ie,Z,ee){return ee===void 0&&(ee=[0,0]),ee[0]=ie[0]*Z+.5|0,ee[1]=ie[1]*Z+.5|0,ee}function toSize(ie,Z){return Array.isArray(ie)?ie:(Z===void 0?Z=[ie,ie]:(Z[0]=ie,Z[1]=ie),Z)}class ImageStyle{constructor(Z){this.opacity_=Z.opacity,this.rotateWithView_=Z.rotateWithView,this.rotation_=Z.rotation,this.scale_=Z.scale,this.scaleArray_=toSize(Z.scale),this.displacement_=Z.displacement,this.declutterMode_=Z.declutterMode}clone(){const Z=this.getScale();return new ImageStyle({opacity:this.getOpacity(),scale:Array.isArray(Z)?Z.slice():Z,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return abstract()}getImage(Z){return abstract()}getHitDetectionImage(){return abstract()}getPixelRatio(Z){return 1}getImageState(){return abstract()}getImageSize(){return abstract()}getOrigin(){return abstract()}getSize(){return abstract()}setDisplacement(Z){this.displacement_=Z}setOpacity(Z){this.opacity_=Z}setRotateWithView(Z){this.rotateWithView_=Z}setRotation(Z){this.rotation_=Z}setScale(Z){this.scale_=Z,this.scaleArray_=toSize(Z)}listenImageChange(Z){abstract()}load(){abstract()}unlistenImageChange(Z){abstract()}}const HEX_COLOR_RE_=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,NAMED_COLOR_RE_=/^([a-z]*)$|^hsla?\(.*\)$/i;function asString(ie){return typeof ie=="string"?ie:toString(ie)}function fromNamed(ie){const Z=document.createElement("div");if(Z.style.color=ie,Z.style.color!==""){document.body.appendChild(Z);const ee=getComputedStyle(Z).color;return document.body.removeChild(Z),ee}return""}const fromString=function(){const ie={};let Z=0;return function(ee){let ae;if(ie.hasOwnProperty(ee))ae=ie[ee];else{if(Z>=1024){let ye=0;for(const ve in ie)ye++&3||(delete ie[ve],--Z)}ae=fromStringInternal_(ee),ie[ee]=ae,++Z}return ae}}();function asArray(ie){return Array.isArray(ie)?ie:fromString(ie)}function fromStringInternal_(ie){let Z,ee,ae,ye,ve;if(NAMED_COLOR_RE_.exec(ie)&&(ie=fromNamed(ie)),HEX_COLOR_RE_.exec(ie)){const be=ie.length-1;let Ye;be<=4?Ye=1:Ye=2;const Ke=be===4||be===8;Z=parseInt(ie.substr(1+0*Ye,Ye),16),ee=parseInt(ie.substr(1+1*Ye,Ye),16),ae=parseInt(ie.substr(1+2*Ye,Ye),16),Ke?ye=parseInt(ie.substr(1+3*Ye,Ye),16):ye=255,Ye==1&&(Z=(Z<<4)+Z,ee=(ee<<4)+ee,ae=(ae<<4)+ae,Ke&&(ye=(ye<<4)+ye)),ve=[Z,ee,ae,ye/255]}else if(ie.startsWith("rgba("))ve=ie.slice(5,-1).split(",").map(Number),normalize$1(ve);else if(ie.startsWith("rgb("))ve=ie.slice(4,-1).split(",").map(Number),ve.push(1),normalize$1(ve);else throw new Error("Invalid color");return ve}function normalize$1(ie){return ie[0]=clamp$1(ie[0]+.5|0,0,255),ie[1]=clamp$1(ie[1]+.5|0,0,255),ie[2]=clamp$1(ie[2]+.5|0,0,255),ie[3]=clamp$1(ie[3],0,1),ie}function toString(ie){let Z=ie[0];Z!=(Z|0)&&(Z=Z+.5|0);let ee=ie[1];ee!=(ee|0)&&(ee=ee+.5|0);let ae=ie[2];ae!=(ae|0)&&(ae=ae+.5|0);const ye=ie[3]===void 0?1:Math.round(ie[3]*100)/100;return"rgba("+Z+","+ee+","+ae+","+ye+")"}function isStringColor(ie){return NAMED_COLOR_RE_.test(ie)&&(ie=fromNamed(ie)),HEX_COLOR_RE_.test(ie)||ie.startsWith("rgba(")||ie.startsWith("rgb(")}function asColorLike(ie){return Array.isArray(ie)?toString(ie):ie}function createCanvasContext2D(ie,Z,ee,ae){let ye;return ee&&ee.length?ye=ee.shift():WORKER_OFFSCREEN_CANVAS?ye=new OffscreenCanvas(ie||300,Z||300):ye=document.createElement("canvas"),ie&&(ye.width=ie),Z&&(ye.height=Z),ye.getContext("2d",ae)}function releaseCanvas$1(ie){const Z=ie.canvas;Z.width=1,Z.height=1,ie.clearRect(0,0,1,1)}function replaceNode(ie,Z){const ee=Z.parentNode;ee&&ee.replaceChild(ie,Z)}function removeNode(ie){return ie&&ie.parentNode?ie.parentNode.removeChild(ie):null}function removeChildren(ie){for(;ie.lastChild;)ie.removeChild(ie.lastChild)}function replaceChildren(ie,Z){const ee=ie.childNodes;for(let ae=0;;++ae){const ye=ee[ae],ve=Z[ae];if(!ye&&!ve)break;if(ye!==ve){if(!ye){ie.appendChild(ve);continue}if(!ve){ie.removeChild(ye),--ae;continue}ie.insertBefore(ve,ye)}}}const CLASS_HIDDEN="ol-hidden",CLASS_UNSELECTABLE="ol-unselectable",CLASS_UNSUPPORTED="ol-unsupported",CLASS_CONTROL="ol-control",CLASS_COLLAPSED="ol-collapsed",fontRegEx=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),fontRegExMatchIndex=["style","variant","weight","size","lineHeight","family"],getFontParameters=function(ie){const Z=ie.match(fontRegEx);if(!Z)return null;const ee={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let ae=0,ye=fontRegExMatchIndex.length;ae<ye;++ae){const ve=Z[ae+1];ve!==void 0&&(ee[fontRegExMatchIndex[ae]]=ve)}return ee.families=ee.family.split(/,\s?/),ee},defaultFont="10px sans-serif",defaultFillStyle="#000",defaultLineCap="round",defaultLineDash=[],defaultLineDashOffset=0,defaultLineJoin="round",defaultMiterLimit=10,defaultStrokeStyle="#000",defaultTextAlign="center",defaultTextBaseline="middle",defaultPadding=[0,0,0,0],defaultLineWidth=1,checkedFonts=new BaseObject;let measureContext=null,measureFont;const textHeights={},registerFont=function(){const ie="32px ",Z=["monospace","serif"],ee=Z.length,ae="wmytzilWMYTZIL@#/&?$%10";let ye,ve;function be(Ke,Xe,Je){let rt=!0;for(let nt=0;nt<ee;++nt){const it=Z[nt];if(ve=measureTextWidth(Ke+" "+Xe+" "+ie+it,ae),Je!=it){const lt=measureTextWidth(Ke+" "+Xe+" "+ie+Je+","+it,ae);rt=rt&&lt!=ve}}return!!rt}function Ye(){let Ke=!0;const Xe=checkedFonts.getKeys();for(let Je=0,rt=Xe.length;Je<rt;++Je){const nt=Xe[Je];checkedFonts.get(nt)<100&&(be.apply(this,nt.split(`
`))?(clear(textHeights),measureContext=null,measureFont=void 0,checkedFonts.set(nt,100)):(checkedFonts.set(nt,checkedFonts.get(nt)+1,!0),Ke=!1))}Ke&&(clearInterval(ye),ye=void 0)}return function(Ke){const Xe=getFontParameters(Ke);if(!Xe)return;const Je=Xe.families;for(let rt=0,nt=Je.length;rt<nt;++rt){const it=Je[rt],lt=Xe.style+`
`+Xe.weight+`
`+it;checkedFonts.get(lt)===void 0&&(checkedFonts.set(lt,100,!0),be(Xe.style,Xe.weight,it)||(checkedFonts.set(lt,0,!0),ye===void 0&&(ye=setInterval(Ye,32))))}}}(),measureTextHeight=function(){let ie;return function(Z){let ee=textHeights[Z];if(ee==null){if(WORKER_OFFSCREEN_CANVAS){const ae=getFontParameters(Z),ye=measureText(Z,"Žg");ee=(isNaN(Number(ae.lineHeight))?1.2:Number(ae.lineHeight))*(ye.actualBoundingBoxAscent+ye.actualBoundingBoxDescent)}else ie||(ie=document.createElement("div"),ie.innerHTML="M",ie.style.minHeight="0",ie.style.maxHeight="none",ie.style.height="auto",ie.style.padding="0",ie.style.border="none",ie.style.position="absolute",ie.style.display="block",ie.style.left="-99999px"),ie.style.font=Z,document.body.appendChild(ie),ee=ie.offsetHeight,document.body.removeChild(ie);textHeights[Z]=ee}return ee}}();function measureText(ie,Z){return measureContext||(measureContext=createCanvasContext2D(1,1)),ie!=measureFont&&(measureContext.font=ie,measureFont=measureContext.font),measureContext.measureText(Z)}function measureTextWidth(ie,Z){return measureText(ie,Z).width}function measureAndCacheTextWidth(ie,Z,ee){if(Z in ee)return ee[Z];const ae=Z.split(`
`).reduce((ye,ve)=>Math.max(ye,measureTextWidth(ie,ve)),0);return ee[Z]=ae,ae}function getTextDimensions(ie,Z){const ee=[],ae=[],ye=[];let ve=0,be=0,Ye=0,Ke=0;for(let Xe=0,Je=Z.length;Xe<=Je;Xe+=2){const rt=Z[Xe];if(rt===`
`||Xe===Je){ve=Math.max(ve,be),ye.push(be),be=0,Ye+=Ke;continue}const nt=Z[Xe+1]||ie.font,it=measureTextWidth(nt,rt);ee.push(it),be+=it;const lt=measureTextHeight(nt);ae.push(lt),Ke=Math.max(Ke,lt)}return{width:ve,height:Ye,widths:ee,heights:ae,lineWidths:ye}}function drawImageOrLabel(ie,Z,ee,ae,ye,ve,be,Ye,Ke,Xe,Je){ie.save(),ee!==1&&(ie.globalAlpha*=ee),Z&&ie.transform.apply(ie,Z),ae.contextInstructions?(ie.translate(Ke,Xe),ie.scale(Je[0],Je[1]),executeLabelInstructions(ae,ie)):Je[0]<0||Je[1]<0?(ie.translate(Ke,Xe),ie.scale(Je[0],Je[1]),ie.drawImage(ae,ye,ve,be,Ye,0,0,be,Ye)):ie.drawImage(ae,ye,ve,be,Ye,Ke,Xe,be*Je[0],Ye*Je[1]),ie.restore()}function executeLabelInstructions(ie,Z){const ee=ie.contextInstructions;for(let ae=0,ye=ee.length;ae<ye;ae+=2)Array.isArray(ee[ae+1])?Z[ee[ae]].apply(Z,ee[ae+1]):Z[ee[ae]]=ee[ae+1]}class RegularShape extends ImageStyle{constructor(Z){const ee=Z.rotateWithView!==void 0?Z.rotateWithView:!1;super({opacity:1,rotateWithView:ee,rotation:Z.rotation!==void 0?Z.rotation:0,scale:Z.scale!==void 0?Z.scale:1,displacement:Z.displacement!==void 0?Z.displacement:[0,0],declutterMode:Z.declutterMode}),this.canvas_=void 0,this.hitDetectionCanvas_=null,this.fill_=Z.fill!==void 0?Z.fill:null,this.origin_=[0,0],this.points_=Z.points,this.radius_=Z.radius!==void 0?Z.radius:Z.radius1,this.radius2_=Z.radius2,this.angle_=Z.angle!==void 0?Z.angle:0,this.stroke_=Z.stroke!==void 0?Z.stroke:null,this.size_=null,this.renderOptions_=null,this.render()}clone(){const Z=this.getScale(),ee=new RegularShape({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(Z)?Z.slice():Z,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return ee.setOpacity(this.getOpacity()),ee}getAnchor(){const Z=this.size_;if(!Z)return null;const ee=this.getDisplacement(),ae=this.getScaleArray();return[Z[0]/2-ee[0]/ae[0],Z[1]/2+ee[1]/ae[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(Z){this.fill_=Z,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_}getImage(Z){let ee=this.canvas_[Z];if(!ee){const ae=this.renderOptions_,ye=createCanvasContext2D(ae.size*Z,ae.size*Z);this.draw_(ae,ye,Z),ee=ye.canvas,this.canvas_[Z]=ee}return ee}getPixelRatio(Z){return Z}getImageSize(){return this.size_}getImageState(){return ImageState.LOADED}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(Z){this.stroke_=Z,this.render()}listenImageChange(Z){}load(){}unlistenImageChange(Z){}calculateLineJoinSize_(Z,ee,ae){if(ee===0||this.points_===1/0||Z!=="bevel"&&Z!=="miter")return ee;let ye=this.radius_,ve=this.radius2_===void 0?ye:this.radius2_;if(ye<ve){const mt=ye;ye=ve,ve=mt}const be=this.radius2_===void 0?this.points_:this.points_*2,Ye=2*Math.PI/be,Ke=ve*Math.sin(Ye),Xe=Math.sqrt(ve*ve-Ke*Ke),Je=ye-Xe,rt=Math.sqrt(Ke*Ke+Je*Je),nt=rt/Ke;if(Z==="miter"&&nt<=ae)return nt*ee;const it=ee/2/nt,lt=ee/2*(Je/rt),ct=Math.sqrt((ye+it)*(ye+it)+lt*lt)-ye;if(this.radius2_===void 0||Z==="bevel")return ct*2;const ot=ye*Math.sin(Ye),dt=Math.sqrt(ye*ye-ot*ot),ft=ve-dt,gt=Math.sqrt(ot*ot+ft*ft)/ot;if(gt<=ae){const mt=gt*ee/2-ve-ye;return 2*Math.max(ct,mt)}return ct*2}createRenderOptions(){let Z=defaultLineCap,ee=defaultLineJoin,ae=0,ye=null,ve=0,be,Ye=0;this.stroke_&&(be=this.stroke_.getColor(),be===null&&(be=defaultStrokeStyle),be=asColorLike(be),Ye=this.stroke_.getWidth(),Ye===void 0&&(Ye=defaultLineWidth),ye=this.stroke_.getLineDash(),ve=this.stroke_.getLineDashOffset(),ee=this.stroke_.getLineJoin(),ee===void 0&&(ee=defaultLineJoin),Z=this.stroke_.getLineCap(),Z===void 0&&(Z=defaultLineCap),ae=this.stroke_.getMiterLimit(),ae===void 0&&(ae=defaultMiterLimit));const Ke=this.calculateLineJoinSize_(ee,Ye,ae),Xe=Math.max(this.radius_,this.radius2_||0),Je=Math.ceil(2*Xe+Ke);return{strokeStyle:be,strokeWidth:Ye,size:Je,lineCap:Z,lineDash:ye,lineDashOffset:ve,lineJoin:ee,miterLimit:ae}}render(){this.renderOptions_=this.createRenderOptions();const Z=this.renderOptions_.size;this.canvas_={},this.size_=[Z,Z]}draw_(Z,ee,ae){if(ee.scale(ae,ae),ee.translate(Z.size/2,Z.size/2),this.createPath_(ee),this.fill_){let ye=this.fill_.getColor();ye===null&&(ye=defaultFillStyle),ee.fillStyle=asColorLike(ye),ee.fill()}this.stroke_&&(ee.strokeStyle=Z.strokeStyle,ee.lineWidth=Z.strokeWidth,Z.lineDash&&(ee.setLineDash(Z.lineDash),ee.lineDashOffset=Z.lineDashOffset),ee.lineCap=Z.lineCap,ee.lineJoin=Z.lineJoin,ee.miterLimit=Z.miterLimit,ee.stroke())}createHitDetectionCanvas_(Z){if(this.fill_){let ee=this.fill_.getColor(),ae=0;if(typeof ee=="string"&&(ee=asArray(ee)),ee===null?ae=1:Array.isArray(ee)&&(ae=ee.length===4?ee[3]:1),ae===0){const ye=createCanvasContext2D(Z.size,Z.size);this.hitDetectionCanvas_=ye.canvas,this.drawHitDetectionCanvas_(Z,ye)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))}createPath_(Z){let ee=this.points_;const ae=this.radius_;if(ee===1/0)Z.arc(0,0,ae,0,2*Math.PI);else{const ye=this.radius2_===void 0?ae:this.radius2_;this.radius2_!==void 0&&(ee*=2);const ve=this.angle_-Math.PI/2,be=2*Math.PI/ee;for(let Ye=0;Ye<ee;Ye++){const Ke=ve+Ye*be,Xe=Ye%2===0?ae:ye;Z.lineTo(Xe*Math.cos(Ke),Xe*Math.sin(Ke))}Z.closePath()}}drawHitDetectionCanvas_(Z,ee){ee.translate(Z.size/2,Z.size/2),this.createPath_(ee),ee.fillStyle=defaultFillStyle,ee.fill(),this.stroke_&&(ee.strokeStyle=Z.strokeStyle,ee.lineWidth=Z.strokeWidth,Z.lineDash&&(ee.setLineDash(Z.lineDash),ee.lineDashOffset=Z.lineDashOffset),ee.lineJoin=Z.lineJoin,ee.miterLimit=Z.miterLimit,ee.stroke())}}class CircleStyle extends RegularShape{constructor(Z){Z=Z||{radius:5},super({points:1/0,fill:Z.fill,radius:Z.radius,stroke:Z.stroke,scale:Z.scale!==void 0?Z.scale:1,rotation:Z.rotation!==void 0?Z.rotation:0,rotateWithView:Z.rotateWithView!==void 0?Z.rotateWithView:!1,displacement:Z.displacement!==void 0?Z.displacement:[0,0],declutterMode:Z.declutterMode})}clone(){const Z=this.getScale(),ee=new CircleStyle({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(Z)?Z.slice():Z,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return ee.setOpacity(this.getOpacity()),ee}setRadius(Z){this.radius_=Z,this.render()}}let Style$1=class Kf{constructor(Z){Z=Z||{},this.geometry_=null,this.geometryFunction_=defaultGeometryFunction,Z.geometry!==void 0&&this.setGeometry(Z.geometry),this.fill_=Z.fill!==void 0?Z.fill:null,this.image_=Z.image!==void 0?Z.image:null,this.renderer_=Z.renderer!==void 0?Z.renderer:null,this.hitDetectionRenderer_=Z.hitDetectionRenderer!==void 0?Z.hitDetectionRenderer:null,this.stroke_=Z.stroke!==void 0?Z.stroke:null,this.text_=Z.text!==void 0?Z.text:null,this.zIndex_=Z.zIndex}clone(){let Z=this.getGeometry();return Z&&typeof Z=="object"&&(Z=Z.clone()),new Kf({geometry:Z,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(Z){this.renderer_=Z}setHitDetectionRenderer(Z){this.hitDetectionRenderer_=Z}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(Z){this.fill_=Z}getImage(){return this.image_}setImage(Z){this.image_=Z}getStroke(){return this.stroke_}setStroke(Z){this.stroke_=Z}getText(){return this.text_}setText(Z){this.text_=Z}getZIndex(){return this.zIndex_}setGeometry(Z){typeof Z=="function"?this.geometryFunction_=Z:typeof Z=="string"?this.geometryFunction_=function(ee){return ee.get(Z)}:Z?Z!==void 0&&(this.geometryFunction_=function(){return Z}):this.geometryFunction_=defaultGeometryFunction,this.geometry_=Z}setZIndex(Z){this.zIndex_=Z}};function toFunction(ie){let Z;if(typeof ie=="function")Z=ie;else{let ee;Array.isArray(ie)?ee=ie:(assert(typeof ie.getZIndex=="function","Expected an `Style` or an array of `Style`"),ee=[ie]),Z=function(){return ee}}return Z}let defaultStyles=null;function createDefaultStyle(ie,Z){if(!defaultStyles){const ee=new Fill({color:"rgba(255,255,255,0.4)"}),ae=new Stroke({color:"#3399CC",width:1.25});defaultStyles=[new Style$1({image:new CircleStyle({fill:ee,stroke:ae,radius:5}),fill:ee,stroke:ae})]}return defaultStyles}function defaultGeometryFunction(ie){return ie.getGeometry()}const DEFAULT_FILL_COLOR="#333";let Text$1=class qf{constructor(Z){Z=Z||{},this.font_=Z.font,this.rotation_=Z.rotation,this.rotateWithView_=Z.rotateWithView,this.scale_=Z.scale,this.scaleArray_=toSize(Z.scale!==void 0?Z.scale:1),this.text_=Z.text,this.textAlign_=Z.textAlign,this.justify_=Z.justify,this.repeat_=Z.repeat,this.textBaseline_=Z.textBaseline,this.fill_=Z.fill!==void 0?Z.fill:new Fill({color:DEFAULT_FILL_COLOR}),this.maxAngle_=Z.maxAngle!==void 0?Z.maxAngle:Math.PI/4,this.placement_=Z.placement!==void 0?Z.placement:"point",this.overflow_=!!Z.overflow,this.stroke_=Z.stroke!==void 0?Z.stroke:null,this.offsetX_=Z.offsetX!==void 0?Z.offsetX:0,this.offsetY_=Z.offsetY!==void 0?Z.offsetY:0,this.backgroundFill_=Z.backgroundFill?Z.backgroundFill:null,this.backgroundStroke_=Z.backgroundStroke?Z.backgroundStroke:null,this.padding_=Z.padding===void 0?null:Z.padding}clone(){const Z=this.getScale();return new qf({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(Z)?Z.slice():Z,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}setOverflow(Z){this.overflow_=Z}setFont(Z){this.font_=Z}setMaxAngle(Z){this.maxAngle_=Z}setOffsetX(Z){this.offsetX_=Z}setOffsetY(Z){this.offsetY_=Z}setPlacement(Z){this.placement_=Z}setRepeat(Z){this.repeat_=Z}setRotateWithView(Z){this.rotateWithView_=Z}setFill(Z){this.fill_=Z}setRotation(Z){this.rotation_=Z}setScale(Z){this.scale_=Z,this.scaleArray_=toSize(Z!==void 0?Z:1)}setStroke(Z){this.stroke_=Z}setText(Z){this.text_=Z}setTextAlign(Z){this.textAlign_=Z}setJustify(Z){this.justify_=Z}setTextBaseline(Z){this.textBaseline_=Z}setBackgroundFill(Z){this.backgroundFill_=Z}setBackgroundStroke(Z){this.backgroundStroke_=Z}setPadding(Z){this.padding_=Z}};const LayerProperty={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class BaseLayer extends BaseObject{constructor(Z){super(),this.on,this.once,this.un,this.background_=Z.background;const ee=Object.assign({},Z);typeof Z.properties=="object"&&(delete ee.properties,Object.assign(ee,Z.properties)),ee[LayerProperty.OPACITY]=Z.opacity!==void 0?Z.opacity:1,assert(typeof ee[LayerProperty.OPACITY]=="number","Layer opacity must be a number"),ee[LayerProperty.VISIBLE]=Z.visible!==void 0?Z.visible:!0,ee[LayerProperty.Z_INDEX]=Z.zIndex,ee[LayerProperty.MAX_RESOLUTION]=Z.maxResolution!==void 0?Z.maxResolution:1/0,ee[LayerProperty.MIN_RESOLUTION]=Z.minResolution!==void 0?Z.minResolution:0,ee[LayerProperty.MIN_ZOOM]=Z.minZoom!==void 0?Z.minZoom:-1/0,ee[LayerProperty.MAX_ZOOM]=Z.maxZoom!==void 0?Z.maxZoom:1/0,this.className_=ee.className!==void 0?ee.className:"ol-layer",delete ee.className,this.setProperties(ee),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(Z){const ee=this.state_||{layer:this,managed:Z===void 0?!0:Z},ae=this.getZIndex();return ee.opacity=clamp$1(Math.round(this.getOpacity()*100)/100,0,1),ee.visible=this.getVisible(),ee.extent=this.getExtent(),ee.zIndex=ae===void 0&&!ee.managed?1/0:ae,ee.maxResolution=this.getMaxResolution(),ee.minResolution=Math.max(this.getMinResolution(),0),ee.minZoom=this.getMinZoom(),ee.maxZoom=this.getMaxZoom(),this.state_=ee,ee}getLayersArray(Z){return abstract()}getLayerStatesArray(Z){return abstract()}getExtent(){return this.get(LayerProperty.EXTENT)}getMaxResolution(){return this.get(LayerProperty.MAX_RESOLUTION)}getMinResolution(){return this.get(LayerProperty.MIN_RESOLUTION)}getMinZoom(){return this.get(LayerProperty.MIN_ZOOM)}getMaxZoom(){return this.get(LayerProperty.MAX_ZOOM)}getOpacity(){return this.get(LayerProperty.OPACITY)}getSourceState(){return abstract()}getVisible(){return this.get(LayerProperty.VISIBLE)}getZIndex(){return this.get(LayerProperty.Z_INDEX)}setBackground(Z){this.background_=Z,this.changed()}setExtent(Z){this.set(LayerProperty.EXTENT,Z)}setMaxResolution(Z){this.set(LayerProperty.MAX_RESOLUTION,Z)}setMinResolution(Z){this.set(LayerProperty.MIN_RESOLUTION,Z)}setMaxZoom(Z){this.set(LayerProperty.MAX_ZOOM,Z)}setMinZoom(Z){this.set(LayerProperty.MIN_ZOOM,Z)}setOpacity(Z){assert(typeof Z=="number","Layer opacity must be a number"),this.set(LayerProperty.OPACITY,Z)}setVisible(Z){this.set(LayerProperty.VISIBLE,Z)}setZIndex(Z){this.set(LayerProperty.Z_INDEX,Z)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const ViewHint={ANIMATING:0,INTERACTING:1},ViewProperty={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},DEFAULT_MAX_ZOOM=42,DEFAULT_TILE_SIZE=256;function createExtent(ie,Z,ee){return function(ae,ye,ve,be,Ye){if(!ae)return;if(!ye&&!Z)return ae;const Ke=Z?0:ve[0]*ye,Xe=Z?0:ve[1]*ye,Je=Ye?Ye[0]:0,rt=Ye?Ye[1]:0;let nt=ie[0]+Ke/2+Je,it=ie[2]-Ke/2+Je,lt=ie[1]+Xe/2+rt,ct=ie[3]-Xe/2+rt;nt>it&&(nt=(it+nt)/2,it=nt),lt>ct&&(lt=(ct+lt)/2,ct=lt);let ot=clamp$1(ae[0],nt,it),dt=clamp$1(ae[1],lt,ct);if(be&&ee&&ye){const ft=30*ye;ot+=-ft*Math.log(1+Math.max(0,nt-ae[0])/ft)+ft*Math.log(1+Math.max(0,ae[0]-it)/ft),dt+=-ft*Math.log(1+Math.max(0,lt-ae[1])/ft)+ft*Math.log(1+Math.max(0,ae[1]-ct)/ft)}return[ot,dt]}}function none$1(ie){return ie}function getViewportClampedResolution(ie,Z,ee,ae){const ye=getWidth(Z)/ee[0],ve=getHeight(Z)/ee[1];return ae?Math.min(ie,Math.max(ye,ve)):Math.min(ie,Math.min(ye,ve))}function getSmoothClampedResolution(ie,Z,ee){let ae=Math.min(ie,Z);const ye=50;return ae*=Math.log(1+ye*Math.max(0,ie/Z-1))/ye+1,ee&&(ae=Math.max(ae,ee),ae/=Math.log(1+ye*Math.max(0,ee/ie-1))/ye+1),clamp$1(ae,ee/2,Z*2)}function createSnapToResolutions(ie,Z,ee,ae){return Z=Z!==void 0?Z:!0,function(ye,ve,be,Ye){if(ye!==void 0){const Ke=ie[0],Xe=ie[ie.length-1],Je=ee?getViewportClampedResolution(Ke,ee,be,ae):Ke;if(Ye)return Z?getSmoothClampedResolution(ye,Je,Xe):clamp$1(ye,Xe,Je);const rt=Math.min(Je,ye),nt=Math.floor(linearFindNearest(ie,rt,ve));return ie[nt]>Je&&nt<ie.length-1?ie[nt+1]:ie[nt]}}}function createSnapToPower(ie,Z,ee,ae,ye,ve){return ae=ae!==void 0?ae:!0,ee=ee!==void 0?ee:0,function(be,Ye,Ke,Xe){if(be!==void 0){const Je=ye?getViewportClampedResolution(Z,ye,Ke,ve):Z;if(Xe)return ae?getSmoothClampedResolution(be,Je,ee):clamp$1(be,ee,Je);const rt=1e-9,nt=Math.ceil(Math.log(Z/Je)/Math.log(ie)-rt),it=-Ye*(.5-rt)+.5,lt=Math.min(Je,be),ct=Math.floor(Math.log(Z/lt)/Math.log(ie)+it),ot=Math.max(nt,ct),dt=Z/Math.pow(ie,ot);return clamp$1(dt,ee,Je)}}}function createMinMaxResolution(ie,Z,ee,ae,ye){return ee=ee!==void 0?ee:!0,function(ve,be,Ye,Ke){if(ve!==void 0){const Xe=ae?getViewportClampedResolution(ie,ae,Ye,ye):ie;return!ee||!Ke?clamp$1(ve,Z,Xe):getSmoothClampedResolution(ve,Xe,Z)}}}function disable(ie){if(ie!==void 0)return 0}function none(ie){if(ie!==void 0)return ie}function createSnapToN(ie){const Z=2*Math.PI/ie;return function(ee,ae){if(ae)return ee;if(ee!==void 0)return ee=Math.floor(ee/Z+.5)*Z,ee}}function createSnapToZero(ie){return ie=ie||toRadians(5),function(Z,ee){if(ee)return Z;if(Z!==void 0)return Math.abs(Z)<=ie?0:Z}}function easeIn(ie){return Math.pow(ie,3)}function easeOut(ie){return 1-easeIn(1-ie)}function inAndOut(ie){return 3*ie*ie-2*ie*ie*ie}function linear(ie){return ie}const DEFAULT_MIN_ZOOM=0;class View extends BaseObject{constructor(Z){super(),this.on,this.once,this.un,Z=Object.assign({},Z),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=createProjection(Z.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,Z.projection&&disableCoordinateWarning(),Z.center&&(Z.center=fromUserCoordinate(Z.center,this.projection_)),Z.extent&&(Z.extent=fromUserExtent(Z.extent,this.projection_)),this.applyOptions_(Z)}applyOptions_(Z){const ee=Object.assign({},Z);for(const Ye in ViewProperty)delete ee[Ye];this.setProperties(ee,!0);const ae=createResolutionConstraint(Z);this.maxResolution_=ae.maxResolution,this.minResolution_=ae.minResolution,this.zoomFactor_=ae.zoomFactor,this.resolutions_=Z.resolutions,this.padding_=Z.padding,this.minZoom_=ae.minZoom;const ye=createCenterConstraint(Z),ve=ae.constraint,be=createRotationConstraint(Z);this.constraints_={center:ye,resolution:ve,rotation:be},this.setRotation(Z.rotation!==void 0?Z.rotation:0),this.setCenterInternal(Z.center!==void 0?Z.center:null),Z.resolution!==void 0?this.setResolution(Z.resolution):Z.zoom!==void 0&&this.setZoom(Z.zoom)}get padding(){return this.padding_}set padding(Z){let ee=this.padding_;this.padding_=Z;const ae=this.getCenterInternal();if(ae){const ye=Z||[0,0,0,0];ee=ee||[0,0,0,0];const ve=this.getResolution(),be=ve/2*(ye[3]-ee[3]+ee[1]-ye[1]),Ye=ve/2*(ye[0]-ee[0]+ee[2]-ye[2]);this.setCenterInternal([ae[0]+be,ae[1]-Ye])}}getUpdatedOptions_(Z){const ee=this.getProperties();return ee.resolution!==void 0?ee.resolution=this.getResolution():ee.zoom=this.getZoom(),ee.center=this.getCenterInternal(),ee.rotation=this.getRotation(),Object.assign({},ee,Z)}animate(Z){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const ee=new Array(arguments.length);for(let ae=0;ae<ee.length;++ae){let ye=arguments[ae];ye.center&&(ye=Object.assign({},ye),ye.center=fromUserCoordinate(ye.center,this.getProjection())),ye.anchor&&(ye=Object.assign({},ye),ye.anchor=fromUserCoordinate(ye.anchor,this.getProjection())),ee[ae]=ye}this.animateInternal.apply(this,ee)}animateInternal(Z){let ee=arguments.length,ae;ee>1&&typeof arguments[ee-1]=="function"&&(ae=arguments[ee-1],--ee);let ye=0;for(;ye<ee&&!this.isDef();++ye){const Je=arguments[ye];Je.center&&this.setCenterInternal(Je.center),Je.zoom!==void 0?this.setZoom(Je.zoom):Je.resolution&&this.setResolution(Je.resolution),Je.rotation!==void 0&&this.setRotation(Je.rotation)}if(ye===ee){ae&&animationCallback(ae,!0);return}let ve=Date.now(),be=this.targetCenter_.slice(),Ye=this.targetResolution_,Ke=this.targetRotation_;const Xe=[];for(;ye<ee;++ye){const Je=arguments[ye],rt={start:ve,complete:!1,anchor:Je.anchor,duration:Je.duration!==void 0?Je.duration:1e3,easing:Je.easing||inAndOut,callback:ae};if(Je.center&&(rt.sourceCenter=be,rt.targetCenter=Je.center.slice(),be=rt.targetCenter),Je.zoom!==void 0?(rt.sourceResolution=Ye,rt.targetResolution=this.getResolutionForZoom(Je.zoom),Ye=rt.targetResolution):Je.resolution&&(rt.sourceResolution=Ye,rt.targetResolution=Je.resolution,Ye=rt.targetResolution),Je.rotation!==void 0){rt.sourceRotation=Ke;const nt=modulo(Je.rotation-Ke+Math.PI,2*Math.PI)-Math.PI;rt.targetRotation=Ke+nt,Ke=rt.targetRotation}isNoopAnimation(rt)?rt.complete=!0:ve+=rt.duration,Xe.push(rt)}this.animations_.push(Xe),this.setHint(ViewHint.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[ViewHint.ANIMATING]>0}getInteracting(){return this.hints_[ViewHint.INTERACTING]>0}cancelAnimations(){this.setHint(ViewHint.ANIMATING,-this.hints_[ViewHint.ANIMATING]);let Z;for(let ee=0,ae=this.animations_.length;ee<ae;++ee){const ye=this.animations_[ee];if(ye[0].callback&&animationCallback(ye[0].callback,!1),!Z)for(let ve=0,be=ye.length;ve<be;++ve){const Ye=ye[ve];if(!Ye.complete){Z=Ye.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=Z,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const Z=Date.now();let ee=!1;for(let ae=this.animations_.length-1;ae>=0;--ae){const ye=this.animations_[ae];let ve=!0;for(let be=0,Ye=ye.length;be<Ye;++be){const Ke=ye[be];if(Ke.complete)continue;const Xe=Z-Ke.start;let Je=Ke.duration>0?Xe/Ke.duration:1;Je>=1?(Ke.complete=!0,Je=1):ve=!1;const rt=Ke.easing(Je);if(Ke.sourceCenter){const nt=Ke.sourceCenter[0],it=Ke.sourceCenter[1],lt=Ke.targetCenter[0],ct=Ke.targetCenter[1];this.nextCenter_=Ke.targetCenter;const ot=nt+rt*(lt-nt),dt=it+rt*(ct-it);this.targetCenter_=[ot,dt]}if(Ke.sourceResolution&&Ke.targetResolution){const nt=rt===1?Ke.targetResolution:Ke.sourceResolution+rt*(Ke.targetResolution-Ke.sourceResolution);if(Ke.anchor){const it=this.getViewportSize_(this.getRotation()),lt=this.constraints_.resolution(nt,0,it,!0);this.targetCenter_=this.calculateCenterZoom(lt,Ke.anchor)}this.nextResolution_=Ke.targetResolution,this.targetResolution_=nt,this.applyTargetState_(!0)}if(Ke.sourceRotation!==void 0&&Ke.targetRotation!==void 0){const nt=rt===1?modulo(Ke.targetRotation+Math.PI,2*Math.PI)-Math.PI:Ke.sourceRotation+rt*(Ke.targetRotation-Ke.sourceRotation);if(Ke.anchor){const it=this.constraints_.rotation(nt,!0);this.targetCenter_=this.calculateCenterRotate(it,Ke.anchor)}this.nextRotation_=Ke.targetRotation,this.targetRotation_=nt}if(this.applyTargetState_(!0),ee=!0,!Ke.complete)break}if(ve){this.animations_[ae]=null,this.setHint(ViewHint.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const be=ye[0].callback;be&&animationCallback(be,!0)}}this.animations_=this.animations_.filter(Boolean),ee&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(Z,ee){let ae;const ye=this.getCenterInternal();return ye!==void 0&&(ae=[ye[0]-ee[0],ye[1]-ee[1]],rotate$2(ae,Z-this.getRotation()),add(ae,ee)),ae}calculateCenterZoom(Z,ee){let ae;const ye=this.getCenterInternal(),ve=this.getResolution();if(ye!==void 0&&ve!==void 0){const be=ee[0]-Z*(ee[0]-ye[0])/ve,Ye=ee[1]-Z*(ee[1]-ye[1])/ve;ae=[be,Ye]}return ae}getViewportSize_(Z){const ee=this.viewportSize_;if(Z){const ae=ee[0],ye=ee[1];return[Math.abs(ae*Math.cos(Z))+Math.abs(ye*Math.sin(Z)),Math.abs(ae*Math.sin(Z))+Math.abs(ye*Math.cos(Z))]}return ee}setViewportSize(Z){this.viewportSize_=Array.isArray(Z)?Z.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const Z=this.getCenterInternal();return Z&&toUserCoordinate(Z,this.getProjection())}getCenterInternal(){return this.get(ViewProperty.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(Z){return Z!==void 0?(Z[0]=this.hints_[0],Z[1]=this.hints_[1],Z):this.hints_.slice()}calculateExtent(Z){const ee=this.calculateExtentInternal(Z);return toUserExtent(ee,this.getProjection())}calculateExtentInternal(Z){Z=Z||this.getViewportSizeMinusPadding_();const ee=this.getCenterInternal();assert(ee,"The view center is not defined");const ae=this.getResolution();assert(ae!==void 0,"The view resolution is not defined");const ye=this.getRotation();return assert(ye!==void 0,"The view rotation is not defined"),getForViewAndSize(ee,ae,ye,Z)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(Z){this.applyOptions_(this.getUpdatedOptions_({maxZoom:Z}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(Z){this.applyOptions_(this.getUpdatedOptions_({minZoom:Z}))}setConstrainResolution(Z){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:Z}))}getProjection(){return this.projection_}getResolution(){return this.get(ViewProperty.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(Z,ee){return this.getResolutionForExtentInternal(fromUserExtent(Z,this.getProjection()),ee)}getResolutionForExtentInternal(Z,ee){ee=ee||this.getViewportSizeMinusPadding_();const ae=getWidth(Z)/ee[0],ye=getHeight(Z)/ee[1];return Math.max(ae,ye)}getResolutionForValueFunction(Z){Z=Z||2;const ee=this.getConstrainedResolution(this.maxResolution_),ae=this.minResolution_,ye=Math.log(ee/ae)/Math.log(Z);return function(ve){return ee/Math.pow(Z,ve*ye)}}getRotation(){return this.get(ViewProperty.ROTATION)}getValueForResolutionFunction(Z){const ee=Math.log(Z||2),ae=this.getConstrainedResolution(this.maxResolution_),ye=this.minResolution_,ve=Math.log(ae/ye)/ee;return function(be){return Math.log(ae/be)/ee/ve}}getViewportSizeMinusPadding_(Z){let ee=this.getViewportSize_(Z);const ae=this.padding_;return ae&&(ee=[ee[0]-ae[1]-ae[3],ee[1]-ae[0]-ae[2]]),ee}getState(){const Z=this.getProjection(),ee=this.getResolution(),ae=this.getRotation();let ye=this.getCenterInternal();const ve=this.padding_;if(ve){const be=this.getViewportSizeMinusPadding_();ye=calculateCenterOn(ye,this.getViewportSize_(),[be[0]/2+ve[3],be[1]/2+ve[0]],ee,ae)}return{center:ye.slice(0),projection:Z!==void 0?Z:null,resolution:ee,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:ae,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let Z;const ee=this.getResolution();return ee!==void 0&&(Z=this.getZoomForResolution(ee)),Z}getZoomForResolution(Z){let ee=this.minZoom_||0,ae,ye;if(this.resolutions_){const ve=linearFindNearest(this.resolutions_,Z,1);ee=ve,ae=this.resolutions_[ve],ve==this.resolutions_.length-1?ye=2:ye=ae/this.resolutions_[ve+1]}else ae=this.maxResolution_,ye=this.zoomFactor_;return ee+Math.log(ae/Z)/Math.log(ye)}getResolutionForZoom(Z){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const ee=clamp$1(Math.floor(Z),0,this.resolutions_.length-2),ae=this.resolutions_[ee]/this.resolutions_[ee+1];return this.resolutions_[ee]/Math.pow(ae,clamp$1(Z-ee,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,Z-this.minZoom_)}fit(Z,ee){let ae;if(assert(Array.isArray(Z)||typeof Z.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(Z)){assert(!isEmpty(Z),"Cannot fit empty extent provided as `geometry`");const ye=fromUserExtent(Z,this.getProjection());ae=fromExtent(ye)}else if(Z.getType()==="Circle"){const ye=fromUserExtent(Z.getExtent(),this.getProjection());ae=fromExtent(ye),ae.rotate(this.getRotation(),getCenter(ye))}else{const ye=getUserProjection();ye?ae=Z.clone().transform(ye,this.getProjection()):ae=Z}this.fitInternal(ae,ee)}rotatedExtentForGeometry(Z){const ee=this.getRotation(),ae=Math.cos(ee),ye=Math.sin(-ee),ve=Z.getFlatCoordinates(),be=Z.getStride();let Ye=1/0,Ke=1/0,Xe=-1/0,Je=-1/0;for(let rt=0,nt=ve.length;rt<nt;rt+=be){const it=ve[rt]*ae-ve[rt+1]*ye,lt=ve[rt]*ye+ve[rt+1]*ae;Ye=Math.min(Ye,it),Ke=Math.min(Ke,lt),Xe=Math.max(Xe,it),Je=Math.max(Je,lt)}return[Ye,Ke,Xe,Je]}fitInternal(Z,ee){ee=ee||{};let ae=ee.size;ae||(ae=this.getViewportSizeMinusPadding_());const ye=ee.padding!==void 0?ee.padding:[0,0,0,0],ve=ee.nearest!==void 0?ee.nearest:!1;let be;ee.minResolution!==void 0?be=ee.minResolution:ee.maxZoom!==void 0?be=this.getResolutionForZoom(ee.maxZoom):be=0;const Ye=this.rotatedExtentForGeometry(Z);let Ke=this.getResolutionForExtentInternal(Ye,[ae[0]-ye[1]-ye[3],ae[1]-ye[0]-ye[2]]);Ke=isNaN(Ke)?be:Math.max(Ke,be),Ke=this.getConstrainedResolution(Ke,ve?0:1);const Xe=this.getRotation(),Je=Math.sin(Xe),rt=Math.cos(Xe),nt=getCenter(Ye);nt[0]+=(ye[1]-ye[3])/2*Ke,nt[1]+=(ye[0]-ye[2])/2*Ke;const it=nt[0]*rt-nt[1]*Je,lt=nt[1]*rt+nt[0]*Je,ct=this.getConstrainedCenter([it,lt],Ke),ot=ee.callback?ee.callback:VOID;ee.duration!==void 0?this.animateInternal({resolution:Ke,center:ct,duration:ee.duration,easing:ee.easing},ot):(this.targetResolution_=Ke,this.targetCenter_=ct,this.applyTargetState_(!1,!0),animationCallback(ot,!0))}centerOn(Z,ee,ae){this.centerOnInternal(fromUserCoordinate(Z,this.getProjection()),ee,ae)}centerOnInternal(Z,ee,ae){this.setCenterInternal(calculateCenterOn(Z,ee,ae,this.getResolution(),this.getRotation()))}calculateCenterShift(Z,ee,ae,ye){let ve;const be=this.padding_;if(be&&Z){const Ye=this.getViewportSizeMinusPadding_(-ae),Ke=calculateCenterOn(Z,ye,[Ye[0]/2+be[3],Ye[1]/2+be[0]],ee,ae);ve=[Z[0]-Ke[0],Z[1]-Ke[1]]}return ve}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(Z){const ee=toUserCoordinate(this.targetCenter_,this.getProjection());this.setCenter([ee[0]+Z[0],ee[1]+Z[1]])}adjustCenterInternal(Z){const ee=this.targetCenter_;this.setCenterInternal([ee[0]+Z[0],ee[1]+Z[1]])}adjustResolution(Z,ee){ee=ee&&fromUserCoordinate(ee,this.getProjection()),this.adjustResolutionInternal(Z,ee)}adjustResolutionInternal(Z,ee){const ae=this.getAnimating()||this.getInteracting(),ye=this.getViewportSize_(this.getRotation()),ve=this.constraints_.resolution(this.targetResolution_*Z,0,ye,ae);ee&&(this.targetCenter_=this.calculateCenterZoom(ve,ee)),this.targetResolution_*=Z,this.applyTargetState_()}adjustZoom(Z,ee){this.adjustResolution(Math.pow(this.zoomFactor_,-Z),ee)}adjustRotation(Z,ee){ee&&(ee=fromUserCoordinate(ee,this.getProjection())),this.adjustRotationInternal(Z,ee)}adjustRotationInternal(Z,ee){const ae=this.getAnimating()||this.getInteracting(),ye=this.constraints_.rotation(this.targetRotation_+Z,ae);ee&&(this.targetCenter_=this.calculateCenterRotate(ye,ee)),this.targetRotation_+=Z,this.applyTargetState_()}setCenter(Z){this.setCenterInternal(Z&&fromUserCoordinate(Z,this.getProjection()))}setCenterInternal(Z){this.targetCenter_=Z,this.applyTargetState_()}setHint(Z,ee){return this.hints_[Z]+=ee,this.changed(),this.hints_[Z]}setResolution(Z){this.targetResolution_=Z,this.applyTargetState_()}setRotation(Z){this.targetRotation_=Z,this.applyTargetState_()}setZoom(Z){this.setResolution(this.getResolutionForZoom(Z))}applyTargetState_(Z,ee){const ae=this.getAnimating()||this.getInteracting()||ee,ye=this.constraints_.rotation(this.targetRotation_,ae),ve=this.getViewportSize_(ye),be=this.constraints_.resolution(this.targetResolution_,0,ve,ae),Ye=this.constraints_.center(this.targetCenter_,be,ve,ae,this.calculateCenterShift(this.targetCenter_,be,ye,ve));this.get(ViewProperty.ROTATION)!==ye&&this.set(ViewProperty.ROTATION,ye),this.get(ViewProperty.RESOLUTION)!==be&&(this.set(ViewProperty.RESOLUTION,be),this.set("zoom",this.getZoom(),!0)),(!Ye||!this.get(ViewProperty.CENTER)||!equals(this.get(ViewProperty.CENTER),Ye))&&this.set(ViewProperty.CENTER,Ye),this.getAnimating()&&!Z&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(Z,ee,ae){Z=Z!==void 0?Z:200;const ye=ee||0,ve=this.constraints_.rotation(this.targetRotation_),be=this.getViewportSize_(ve),Ye=this.constraints_.resolution(this.targetResolution_,ye,be),Ke=this.constraints_.center(this.targetCenter_,Ye,be,!1,this.calculateCenterShift(this.targetCenter_,Ye,ve,be));if(Z===0&&!this.cancelAnchor_){this.targetResolution_=Ye,this.targetRotation_=ve,this.targetCenter_=Ke,this.applyTargetState_();return}ae=ae||(Z===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==Ye||this.getRotation()!==ve||!this.getCenterInternal()||!equals(this.getCenterInternal(),Ke))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:ve,center:Ke,resolution:Ye,duration:Z,easing:easeOut,anchor:ae}))}beginInteraction(){this.resolveConstraints(0),this.setHint(ViewHint.INTERACTING,1)}endInteraction(Z,ee,ae){ae=ae&&fromUserCoordinate(ae,this.getProjection()),this.endInteractionInternal(Z,ee,ae)}endInteractionInternal(Z,ee,ae){this.getInteracting()&&(this.setHint(ViewHint.INTERACTING,-1),this.resolveConstraints(Z,ee,ae))}getConstrainedCenter(Z,ee){const ae=this.getViewportSize_(this.getRotation());return this.constraints_.center(Z,ee||this.getResolution(),ae)}getConstrainedZoom(Z,ee){const ae=this.getResolutionForZoom(Z);return this.getZoomForResolution(this.getConstrainedResolution(ae,ee))}getConstrainedResolution(Z,ee){ee=ee||0;const ae=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(Z,ee,ae)}}function animationCallback(ie,Z){setTimeout(function(){ie(Z)},0)}function createCenterConstraint(ie){if(ie.extent!==void 0){const ee=ie.smoothExtentConstraint!==void 0?ie.smoothExtentConstraint:!0;return createExtent(ie.extent,ie.constrainOnlyCenter,ee)}const Z=createProjection(ie.projection,"EPSG:3857");if(ie.multiWorld!==!0&&Z.isGlobal()){const ee=Z.getExtent().slice();return ee[0]=-1/0,ee[2]=1/0,createExtent(ee,!1,!1)}return none$1}function createResolutionConstraint(ie){let Z,ee,ae,ye=ie.minZoom!==void 0?ie.minZoom:DEFAULT_MIN_ZOOM,ve=ie.maxZoom!==void 0?ie.maxZoom:28;const be=ie.zoomFactor!==void 0?ie.zoomFactor:2,Ye=ie.multiWorld!==void 0?ie.multiWorld:!1,Ke=ie.smoothResolutionConstraint!==void 0?ie.smoothResolutionConstraint:!0,Xe=ie.showFullExtent!==void 0?ie.showFullExtent:!1,Je=createProjection(ie.projection,"EPSG:3857"),rt=Je.getExtent();let nt=ie.constrainOnlyCenter,it=ie.extent;if(!Ye&&!it&&Je.isGlobal()&&(nt=!1,it=rt),ie.resolutions!==void 0){const lt=ie.resolutions;ee=lt[ye],ae=lt[ve]!==void 0?lt[ve]:lt[lt.length-1],ie.constrainResolution?Z=createSnapToResolutions(lt,Ke,!nt&&it,Xe):Z=createMinMaxResolution(ee,ae,Ke,!nt&&it,Xe)}else{const lt=(rt?Math.max(getWidth(rt),getHeight(rt)):360*METERS_PER_UNIT$1.degrees/Je.getMetersPerUnit())/DEFAULT_TILE_SIZE/Math.pow(2,DEFAULT_MIN_ZOOM),ct=lt/Math.pow(2,28-DEFAULT_MIN_ZOOM);ee=ie.maxResolution,ee!==void 0?ye=0:ee=lt/Math.pow(be,ye),ae=ie.minResolution,ae===void 0&&(ie.maxZoom!==void 0?ie.maxResolution!==void 0?ae=ee/Math.pow(be,ve):ae=lt/Math.pow(be,ve):ae=ct),ve=ye+Math.floor(Math.log(ee/ae)/Math.log(be)),ae=ee/Math.pow(be,ve-ye),ie.constrainResolution?Z=createSnapToPower(be,ee,ae,Ke,!nt&&it,Xe):Z=createMinMaxResolution(ee,ae,Ke,!nt&&it,Xe)}return{constraint:Z,maxResolution:ee,minResolution:ae,minZoom:ye,zoomFactor:be}}function createRotationConstraint(ie){if(ie.enableRotation===void 0||ie.enableRotation){const Z=ie.constrainRotation;return Z===void 0||Z===!0?createSnapToZero():Z===!1?none:typeof Z=="number"?createSnapToN(Z):none}return disable}function isNoopAnimation(ie){return!(ie.sourceCenter&&ie.targetCenter&&!equals(ie.sourceCenter,ie.targetCenter)||ie.sourceResolution!==ie.targetResolution||ie.sourceRotation!==ie.targetRotation)}function calculateCenterOn(ie,Z,ee,ae,ye){const ve=Math.cos(-ye);let be=Math.sin(-ye),Ye=ie[0]*ve-ie[1]*be,Ke=ie[1]*ve+ie[0]*be;Ye+=(Z[0]/2-ee[0])*ae,Ke+=(ee[1]-Z[1]/2)*ae,be=-be;const Xe=Ye*ve-Ke*be,Je=Ke*ve+Ye*be;return[Xe,Je]}class Layer extends BaseLayer{constructor(Z){const ee=Object.assign({},Z);delete ee.source,super(ee),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,Z.render&&(this.render=Z.render),Z.map&&this.setMap(Z.map),this.addChangeListener(LayerProperty.SOURCE,this.handleSourcePropertyChange_);const ae=Z.source?Z.source:null;this.setSource(ae)}getLayersArray(Z){return Z=Z||[],Z.push(this),Z}getLayerStatesArray(Z){return Z=Z||[],Z.push(this.getLayerState()),Z}getSource(){return this.get(LayerProperty.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const Z=this.getSource();return Z?Z.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(unlistenByKey(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const Z=this.getSource();Z&&(this.sourceChangeKey_=listen(Z,EventType.CHANGE,this.handleSourceChange_,this),Z.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(Z){return this.renderer_?this.renderer_.getFeatures(Z):Promise.resolve([])}getData(Z){return!this.renderer_||!this.rendered?null:this.renderer_.getData(Z)}isVisible(Z){let ee;const ae=this.getMapInternal();!Z&&ae&&(Z=ae.getView()),Z instanceof View?ee={viewState:Z.getState(),extent:Z.calculateExtent()}:ee=Z,!ee.layerStatesArray&&ae&&(ee.layerStatesArray=ae.getLayerGroup().getLayerStatesArray());let ye;ee.layerStatesArray?ye=ee.layerStatesArray.find(be=>be.layer===this):ye=this.getLayerState();const ve=this.getExtent();return inView(ye,ee.viewState)&&(!ve||intersects$1(ve,ee.extent))}getAttributions(Z){if(!this.isVisible(Z))return[];let ee;const ae=this.getSource();if(ae&&(ee=ae.getAttributions()),!ee)return[];const ye=Z instanceof View?Z.getViewStateAndExtent():Z;let ve=ee(ye);return Array.isArray(ve)||(ve=[ve]),ve}render(Z,ee){const ae=this.getRenderer();return ae.prepareFrame(Z)?(this.rendered=!0,ae.renderFrame(Z,ee)):null}unrender(){this.rendered=!1}setMapInternal(Z){Z||this.unrender(),this.set(LayerProperty.MAP,Z)}getMapInternal(){return this.get(LayerProperty.MAP)}setMap(Z){this.mapPrecomposeKey_&&(unlistenByKey(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),Z||this.changed(),this.mapRenderKey_&&(unlistenByKey(this.mapRenderKey_),this.mapRenderKey_=null),Z&&(this.mapPrecomposeKey_=listen(Z,RenderEventType.PRECOMPOSE,function(ee){const ae=ee.frameState.layerStatesArray,ye=this.getLayerState(!1);assert(!ae.some(function(ve){return ve.layer===ye.layer}),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),ae.push(ye)},this),this.mapRenderKey_=listen(this,EventType.CHANGE,Z.render,Z),this.changed())}setSource(Z){this.set(LayerProperty.SOURCE,Z)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function inView(ie,Z){if(!ie.visible)return!1;const ee=Z.resolution;if(ee<ie.minResolution||ee>=ie.maxResolution)return!1;const ae=Z.zoom;return ae>ie.minZoom&&ae<=ie.maxZoom}function quickselect(ie,Z,ee,ae,ye){quickselectStep(ie,Z,ee||0,ae||ie.length-1,ye||defaultCompare)}function quickselectStep(ie,Z,ee,ae,ye){for(;ae>ee;){if(ae-ee>600){var ve=ae-ee+1,be=Z-ee+1,Ye=Math.log(ve),Ke=.5*Math.exp(2*Ye/3),Xe=.5*Math.sqrt(Ye*Ke*(ve-Ke)/ve)*(be-ve/2<0?-1:1),Je=Math.max(ee,Math.floor(Z-be*Ke/ve+Xe)),rt=Math.min(ae,Math.floor(Z+(ve-be)*Ke/ve+Xe));quickselectStep(ie,Z,Je,rt,ye)}var nt=ie[Z],it=ee,lt=ae;for(swap(ie,ee,Z),ye(ie[ae],nt)>0&&swap(ie,ee,ae);it<lt;){for(swap(ie,it,lt),it++,lt--;ye(ie[it],nt)<0;)it++;for(;ye(ie[lt],nt)>0;)lt--}ye(ie[ee],nt)===0?swap(ie,ee,lt):(lt++,swap(ie,lt,ae)),lt<=Z&&(ee=lt+1),Z<=lt&&(ae=lt-1)}}function swap(ie,Z,ee){var ae=ie[Z];ie[Z]=ie[ee],ie[ee]=ae}function defaultCompare(ie,Z){return ie<Z?-1:ie>Z?1:0}class RBush{constructor(Z=9){this._maxEntries=Math.max(4,Z),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(Z){let ee=this.data;const ae=[];if(!intersects(Z,ee))return ae;const ye=this.toBBox,ve=[];for(;ee;){for(let be=0;be<ee.children.length;be++){const Ye=ee.children[be],Ke=ee.leaf?ye(Ye):Ye;intersects(Z,Ke)&&(ee.leaf?ae.push(Ye):contains(Z,Ke)?this._all(Ye,ae):ve.push(Ye))}ee=ve.pop()}return ae}collides(Z){let ee=this.data;if(!intersects(Z,ee))return!1;const ae=[];for(;ee;){for(let ye=0;ye<ee.children.length;ye++){const ve=ee.children[ye],be=ee.leaf?this.toBBox(ve):ve;if(intersects(Z,be)){if(ee.leaf||contains(Z,be))return!0;ae.push(ve)}}ee=ae.pop()}return!1}load(Z){if(!(Z&&Z.length))return this;if(Z.length<this._minEntries){for(let ae=0;ae<Z.length;ae++)this.insert(Z[ae]);return this}let ee=this._build(Z.slice(),0,Z.length-1,0);if(!this.data.children.length)this.data=ee;else if(this.data.height===ee.height)this._splitRoot(this.data,ee);else{if(this.data.height<ee.height){const ae=this.data;this.data=ee,ee=ae}this._insert(ee,this.data.height-ee.height-1,!0)}return this}insert(Z){return Z&&this._insert(Z,this.data.height-1),this}clear(){return this.data=createNode([]),this}remove(Z,ee){if(!Z)return this;let ae=this.data;const ye=this.toBBox(Z),ve=[],be=[];let Ye,Ke,Xe;for(;ae||ve.length;){if(ae||(ae=ve.pop(),Ke=ve[ve.length-1],Ye=be.pop(),Xe=!0),ae.leaf){const Je=findItem(Z,ae.children,ee);if(Je!==-1)return ae.children.splice(Je,1),ve.push(ae),this._condense(ve),this}!Xe&&!ae.leaf&&contains(ae,ye)?(ve.push(ae),be.push(Ye),Ye=0,Ke=ae,ae=ae.children[0]):Ke?(Ye++,ae=Ke.children[Ye],Xe=!1):ae=null}return this}toBBox(Z){return Z}compareMinX(Z,ee){return Z.minX-ee.minX}compareMinY(Z,ee){return Z.minY-ee.minY}toJSON(){return this.data}fromJSON(Z){return this.data=Z,this}_all(Z,ee){const ae=[];for(;Z;)Z.leaf?ee.push(...Z.children):ae.push(...Z.children),Z=ae.pop();return ee}_build(Z,ee,ae,ye){const ve=ae-ee+1;let be=this._maxEntries,Ye;if(ve<=be)return Ye=createNode(Z.slice(ee,ae+1)),calcBBox(Ye,this.toBBox),Ye;ye||(ye=Math.ceil(Math.log(ve)/Math.log(be)),be=Math.ceil(ve/Math.pow(be,ye-1))),Ye=createNode([]),Ye.leaf=!1,Ye.height=ye;const Ke=Math.ceil(ve/be),Xe=Ke*Math.ceil(Math.sqrt(be));multiSelect(Z,ee,ae,Xe,this.compareMinX);for(let Je=ee;Je<=ae;Je+=Xe){const rt=Math.min(Je+Xe-1,ae);multiSelect(Z,Je,rt,Ke,this.compareMinY);for(let nt=Je;nt<=rt;nt+=Ke){const it=Math.min(nt+Ke-1,rt);Ye.children.push(this._build(Z,nt,it,ye-1))}}return calcBBox(Ye,this.toBBox),Ye}_chooseSubtree(Z,ee,ae,ye){for(;ye.push(ee),!(ee.leaf||ye.length-1===ae);){let ve=1/0,be=1/0,Ye;for(let Ke=0;Ke<ee.children.length;Ke++){const Xe=ee.children[Ke],Je=bboxArea(Xe),rt=enlargedArea(Z,Xe)-Je;rt<be?(be=rt,ve=Je<ve?Je:ve,Ye=Xe):rt===be&&Je<ve&&(ve=Je,Ye=Xe)}ee=Ye||ee.children[0]}return ee}_insert(Z,ee,ae){const ye=ae?Z:this.toBBox(Z),ve=[],be=this._chooseSubtree(ye,this.data,ee,ve);for(be.children.push(Z),extend(be,ye);ee>=0&&ve[ee].children.length>this._maxEntries;)this._split(ve,ee),ee--;this._adjustParentBBoxes(ye,ve,ee)}_split(Z,ee){const ae=Z[ee],ye=ae.children.length,ve=this._minEntries;this._chooseSplitAxis(ae,ve,ye);const be=this._chooseSplitIndex(ae,ve,ye),Ye=createNode(ae.children.splice(be,ae.children.length-be));Ye.height=ae.height,Ye.leaf=ae.leaf,calcBBox(ae,this.toBBox),calcBBox(Ye,this.toBBox),ee?Z[ee-1].children.push(Ye):this._splitRoot(ae,Ye)}_splitRoot(Z,ee){this.data=createNode([Z,ee]),this.data.height=Z.height+1,this.data.leaf=!1,calcBBox(this.data,this.toBBox)}_chooseSplitIndex(Z,ee,ae){let ye,ve=1/0,be=1/0;for(let Ye=ee;Ye<=ae-ee;Ye++){const Ke=distBBox(Z,0,Ye,this.toBBox),Xe=distBBox(Z,Ye,ae,this.toBBox),Je=intersectionArea(Ke,Xe),rt=bboxArea(Ke)+bboxArea(Xe);Je<ve?(ve=Je,ye=Ye,be=rt<be?rt:be):Je===ve&&rt<be&&(be=rt,ye=Ye)}return ye||ae-ee}_chooseSplitAxis(Z,ee,ae){const ye=Z.leaf?this.compareMinX:compareNodeMinX,ve=Z.leaf?this.compareMinY:compareNodeMinY,be=this._allDistMargin(Z,ee,ae,ye),Ye=this._allDistMargin(Z,ee,ae,ve);be<Ye&&Z.children.sort(ye)}_allDistMargin(Z,ee,ae,ye){Z.children.sort(ye);const ve=this.toBBox,be=distBBox(Z,0,ee,ve),Ye=distBBox(Z,ae-ee,ae,ve);let Ke=bboxMargin(be)+bboxMargin(Ye);for(let Xe=ee;Xe<ae-ee;Xe++){const Je=Z.children[Xe];extend(be,Z.leaf?ve(Je):Je),Ke+=bboxMargin(be)}for(let Xe=ae-ee-1;Xe>=ee;Xe--){const Je=Z.children[Xe];extend(Ye,Z.leaf?ve(Je):Je),Ke+=bboxMargin(Ye)}return Ke}_adjustParentBBoxes(Z,ee,ae){for(let ye=ae;ye>=0;ye--)extend(ee[ye],Z)}_condense(Z){for(let ee=Z.length-1,ae;ee>=0;ee--)Z[ee].children.length===0?ee>0?(ae=Z[ee-1].children,ae.splice(ae.indexOf(Z[ee]),1)):this.clear():calcBBox(Z[ee],this.toBBox)}}function findItem(ie,Z,ee){if(!ee)return Z.indexOf(ie);for(let ae=0;ae<Z.length;ae++)if(ee(ie,Z[ae]))return ae;return-1}function calcBBox(ie,Z){distBBox(ie,0,ie.children.length,Z,ie)}function distBBox(ie,Z,ee,ae,ye){ye||(ye=createNode(null)),ye.minX=1/0,ye.minY=1/0,ye.maxX=-1/0,ye.maxY=-1/0;for(let ve=Z;ve<ee;ve++){const be=ie.children[ve];extend(ye,ie.leaf?ae(be):be)}return ye}function extend(ie,Z){return ie.minX=Math.min(ie.minX,Z.minX),ie.minY=Math.min(ie.minY,Z.minY),ie.maxX=Math.max(ie.maxX,Z.maxX),ie.maxY=Math.max(ie.maxY,Z.maxY),ie}function compareNodeMinX(ie,Z){return ie.minX-Z.minX}function compareNodeMinY(ie,Z){return ie.minY-Z.minY}function bboxArea(ie){return(ie.maxX-ie.minX)*(ie.maxY-ie.minY)}function bboxMargin(ie){return ie.maxX-ie.minX+(ie.maxY-ie.minY)}function enlargedArea(ie,Z){return(Math.max(Z.maxX,ie.maxX)-Math.min(Z.minX,ie.minX))*(Math.max(Z.maxY,ie.maxY)-Math.min(Z.minY,ie.minY))}function intersectionArea(ie,Z){const ee=Math.max(ie.minX,Z.minX),ae=Math.max(ie.minY,Z.minY),ye=Math.min(ie.maxX,Z.maxX),ve=Math.min(ie.maxY,Z.maxY);return Math.max(0,ye-ee)*Math.max(0,ve-ae)}function contains(ie,Z){return ie.minX<=Z.minX&&ie.minY<=Z.minY&&Z.maxX<=ie.maxX&&Z.maxY<=ie.maxY}function intersects(ie,Z){return Z.minX<=ie.maxX&&Z.minY<=ie.maxY&&Z.maxX>=ie.minX&&Z.maxY>=ie.minY}function createNode(ie){return{children:ie,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function multiSelect(ie,Z,ee,ae,ye){const ve=[Z,ee];for(;ve.length;){if(ee=ve.pop(),Z=ve.pop(),ee-Z<=ae)continue;const be=Z+Math.ceil((ee-Z)/ae/2)*ae;quickselect(ie,be,Z,ee,ye),ve.push(Z,be,be,ee)}}function listenImage(ie,Z,ee){const ae=ie;let ye=!0,ve=!1,be=!1;const Ye=[listenOnce(ae,EventType.LOAD,function(){be=!0,ve||Z()})];return ae.src&&IMAGE_DECODE?(ve=!0,ae.decode().then(function(){ye&&Z()}).catch(function(Ke){ye&&(be?Z():ee())})):Ye.push(listenOnce(ae,EventType.ERROR,ee)),function(){ye=!1,Ye.forEach(unlistenByKey)}}function load(ie,Z){return new Promise((ee,ae)=>{function ye(){be(),ee(ie)}function ve(){be(),ae(new Error("Image load error"))}function be(){ie.removeEventListener("load",ye),ie.removeEventListener("error",ve)}ie.addEventListener("load",ye),ie.addEventListener("error",ve)})}function decodeFallback(ie,Z){return Z&&(ie.src=Z),IMAGE_DECODE?new Promise((ee,ae)=>ie.decode().then(()=>ee(ie),ae)):load(ie)}class IconImageCache{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let Z=0;for(const ee in this.cache_){const ae=this.cache_[ee];!(Z++&3)&&!ae.hasListener()&&(delete this.cache_[ee],--this.cacheSize_)}}}get(Z,ee,ae){const ye=getKey$1(Z,ee,ae);return ye in this.cache_?this.cache_[ye]:null}set(Z,ee,ae,ye){const ve=getKey$1(Z,ee,ae);this.cache_[ve]=ye,++this.cacheSize_}setSize(Z){this.maxCacheSize_=Z,this.expire()}}function getKey$1(ie,Z,ee){const ae=ee?asString(ee):"null";return Z+":"+ie+":"+ae}const shared=new IconImageCache;let taintedTestContext=null;class IconImage extends Target{constructor(Z,ee,ae,ye,ve){super(),this.hitDetectionImage_=null,this.image_=Z,this.crossOrigin_=ae,this.canvas_={},this.color_=ve,this.imageState_=ye===void 0?ImageState.IDLE:ye,this.size_=Z&&Z.width&&Z.height?[Z.width,Z.height]:null,this.src_=ee,this.tainted_}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===ImageState.LOADED){taintedTestContext||(taintedTestContext=createCanvasContext2D(1,1,void 0,{willReadFrequently:!0})),taintedTestContext.drawImage(this.image_,0,0);try{taintedTestContext.getImageData(0,0,1,1),this.tainted_=!1}catch{taintedTestContext=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(EventType.CHANGE)}handleImageError_(){this.imageState_=ImageState.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=ImageState.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(Z){return this.image_||this.initializeImage_(),this.replaceColor_(Z),this.canvas_[Z]?this.canvas_[Z]:this.image_}getPixelRatio(Z){return this.replaceColor_(Z),this.canvas_[Z]?Z:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const Z=this.size_[0],ee=this.size_[1],ae=createCanvasContext2D(Z,ee);ae.fillRect(0,0,Z,ee),this.hitDetectionImage_=ae.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===ImageState.IDLE){this.image_||this.initializeImage_(),this.imageState_=ImageState.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&decodeFallback(this.image_,this.src_).then(Z=>{this.image_=Z,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(Z){if(!this.color_||this.canvas_[Z]||this.imageState_!==ImageState.LOADED)return;const ee=this.image_,ae=document.createElement("canvas");ae.width=Math.ceil(ee.width*Z),ae.height=Math.ceil(ee.height*Z);const ye=ae.getContext("2d");ye.scale(Z,Z),ye.drawImage(ee,0,0),ye.globalCompositeOperation="multiply",ye.fillStyle=asString(this.color_),ye.fillRect(0,0,ae.width/Z,ae.height/Z),ye.globalCompositeOperation="destination-in",ye.drawImage(ee,0,0),this.canvas_[Z]=ae}}function get(ie,Z,ee,ae,ye){let ve=Z===void 0?void 0:shared.get(Z,ee,ye);return ve||(ve=new IconImage(ie,ie instanceof HTMLImageElement?ie.src||void 0:Z,ee,ae,ye),shared.set(Z,ee,ye,ve)),ve}function calculateScale(ie,Z,ee,ae){return ee!==void 0&&ae!==void 0?[ee/ie,ae/Z]:ee!==void 0?ee/ie:ae!==void 0?ae/Z:1}class Icon extends ImageStyle{constructor(Z){Z=Z||{};const ee=Z.opacity!==void 0?Z.opacity:1,ae=Z.rotation!==void 0?Z.rotation:0,ye=Z.scale!==void 0?Z.scale:1,ve=Z.rotateWithView!==void 0?Z.rotateWithView:!1;super({opacity:ee,rotation:ae,scale:ye,displacement:Z.displacement!==void 0?Z.displacement:[0,0],rotateWithView:ve,declutterMode:Z.declutterMode}),this.anchor_=Z.anchor!==void 0?Z.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=Z.anchorOrigin!==void 0?Z.anchorOrigin:"top-left",this.anchorXUnits_=Z.anchorXUnits!==void 0?Z.anchorXUnits:"fraction",this.anchorYUnits_=Z.anchorYUnits!==void 0?Z.anchorYUnits:"fraction",this.crossOrigin_=Z.crossOrigin!==void 0?Z.crossOrigin:null;const be=Z.img!==void 0?Z.img:null;let Ye=Z.src;assert(!(Ye!==void 0&&be),"`image` and `src` cannot be provided at the same time"),(Ye===void 0||Ye.length===0)&&be&&(Ye=be.src||getUid(be)),assert(Ye!==void 0&&Ye.length>0,"A defined and non-empty `src` or `image` must be provided"),assert(!((Z.width!==void 0||Z.height!==void 0)&&Z.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let Ke;if(Z.src!==void 0?Ke=ImageState.IDLE:be!==void 0&&(be instanceof HTMLImageElement?be.complete?Ke=be.src?ImageState.LOADED:ImageState.IDLE:Ke=ImageState.LOADING:Ke=ImageState.LOADED),this.color_=Z.color!==void 0?asArray(Z.color):null,this.iconImage_=get(be,Ye,this.crossOrigin_,Ke,this.color_),this.offset_=Z.offset!==void 0?Z.offset:[0,0],this.offsetOrigin_=Z.offsetOrigin!==void 0?Z.offsetOrigin:"top-left",this.origin_=null,this.size_=Z.size!==void 0?Z.size:null,Z.width!==void 0||Z.height!==void 0){let Xe,Je;if(Z.size)[Xe,Je]=Z.size;else{const rt=this.getImage(1);if(rt.width&&rt.height)Xe=rt.width,Je=rt.height;else if(rt instanceof HTMLImageElement){this.initialOptions_=Z;const nt=()=>{if(this.unlistenImageChange(nt),!this.initialOptions_)return;const it=this.iconImage_.getSize();this.setScale(calculateScale(it[0],it[1],Z.width,Z.height))};this.listenImageChange(nt);return}}Xe!==void 0&&this.setScale(calculateScale(Xe,Je,Z.width,Z.height))}}clone(){let Z,ee,ae;return this.initialOptions_?(ee=this.initialOptions_.width,ae=this.initialOptions_.height):(Z=this.getScale(),Z=Array.isArray(Z)?Z.slice():Z),new Icon({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:Z,width:ee,height:ae,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let Z=this.normalizedAnchor_;if(!Z){Z=this.anchor_;const ye=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!ye)return null;Z=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(Z[0]*=ye[0]),this.anchorYUnits_=="fraction"&&(Z[1]*=ye[1])}if(this.anchorOrigin_!="top-left"){if(!ye)return null;Z===this.anchor_&&(Z=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(Z[0]=-Z[0]+ye[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(Z[1]=-Z[1]+ye[1])}this.normalizedAnchor_=Z}const ee=this.getDisplacement(),ae=this.getScaleArray();return[Z[0]-ee[0]/ae[0],Z[1]+ee[1]/ae[1]]}setAnchor(Z){this.anchor_=Z,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(Z){return this.iconImage_.getImage(Z)}getPixelRatio(Z){return this.iconImage_.getPixelRatio(Z)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let Z=this.offset_;if(this.offsetOrigin_!="top-left"){const ee=this.getSize(),ae=this.iconImage_.getSize();if(!ee||!ae)return null;Z=Z.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(Z[0]=ae[0]-ee[0]-Z[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(Z[1]=ae[1]-ee[1]-Z[1])}return this.origin_=Z,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const Z=this.getScaleArray();if(this.size_)return this.size_[0]*Z[0];if(this.iconImage_.getImageState()==ImageState.LOADED)return this.iconImage_.getSize()[0]*Z[0]}getHeight(){const Z=this.getScaleArray();if(this.size_)return this.size_[1]*Z[1];if(this.iconImage_.getImageState()==ImageState.LOADED)return this.iconImage_.getSize()[1]*Z[1]}setScale(Z){delete this.initialOptions_,super.setScale(Z)}listenImageChange(Z){this.iconImage_.addEventListener(EventType.CHANGE,Z)}load(){this.iconImage_.load()}unlistenImageChange(Z){this.iconImage_.removeEventListener(EventType.CHANGE,Z)}}let numTypes=0;const BooleanType=1<<numTypes++,NumberType=1<<numTypes++,StringType=1<<numTypes++,ColorType=1<<numTypes++,NumberArrayType=1<<numTypes++,AnyType=Math.pow(2,numTypes)-1,typeNames={[BooleanType]:"boolean",[NumberType]:"number",[StringType]:"string",[ColorType]:"color",[NumberArrayType]:"number[]"},namedTypes=Object.keys(typeNames).map(Number).sort(ascending);function typeName(ie){const Z=[];for(const ee of namedTypes)includesType(ie,ee)&&Z.push(typeNames[ee]);return Z.length===0?"untyped":Z.length<3?Z.join(" or "):Z.slice(0,-1).join(", ")+", or "+Z[Z.length-1]}function includesType(ie,Z){return(ie&Z)===Z}function overlapsType(ie,Z){return!!(ie&Z)}class LiteralExpression{constructor(Z,ee){this.type=Z,this.value=ee}}class CallExpression{constructor(Z,ee,...ae){this.type=Z,this.operator=ee,this.args=ae}}function newParsingContext(){return{variables:new Set,properties:new Set}}function parse$9(ie,Z){switch(typeof ie){case"boolean":return new LiteralExpression(BooleanType,ie);case"number":return new LiteralExpression(NumberType,ie);case"string":return new LiteralExpression(StringType,ie)}if(!Array.isArray(ie))throw new Error("Expression must be an array or a primitive value");if(ie.length===0)throw new Error("Empty expression");if(typeof ie[0]=="string")return parseCallExpression(ie,Z);for(const ae of ie)if(typeof ae!="number")throw new Error("Expected an array of numbers");let ee=NumberArrayType;return(ie.length===3||ie.length===4)&&(ee|=ColorType),new LiteralExpression(ee,ie)}const Ops={Number:"number",String:"string",Get:"get",Var:"var",Any:"any",All:"all",Not:"!",Resolution:"resolution",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match"},parsers={[Ops.Number]:createParser(withArgs(1,1/0,AnyType),NumberType),[Ops.String]:createParser(withArgs(1,1/0,AnyType),StringType),[Ops.Get]:createParser(withGetArgs,AnyType),[Ops.Var]:createParser(withVarArgs,AnyType),[Ops.Resolution]:createParser(withNoArgs,NumberType),[Ops.Any]:createParser(withArgs(2,1/0,BooleanType),BooleanType),[Ops.All]:createParser(withArgs(2,1/0,BooleanType),BooleanType),[Ops.Not]:createParser(withArgs(1,1,BooleanType),BooleanType),[Ops.Equal]:createParser(withArgs(2,2,AnyType),BooleanType),[Ops.NotEqual]:createParser(withArgs(2,2,AnyType),BooleanType),[Ops.GreaterThan]:createParser(withArgs(2,2,AnyType),BooleanType),[Ops.GreaterThanOrEqualTo]:createParser(withArgs(2,2,AnyType),BooleanType),[Ops.LessThan]:createParser(withArgs(2,2,AnyType),BooleanType),[Ops.LessThanOrEqualTo]:createParser(withArgs(2,2,AnyType),BooleanType),[Ops.Multiply]:createParser(withArgs(2,1/0,NumberType),NumberType),[Ops.Divide]:createParser(withArgs(2,2,NumberType),NumberType),[Ops.Add]:createParser(withArgs(2,1/0,NumberType),NumberType),[Ops.Subtract]:createParser(withArgs(2,2,NumberType),NumberType),[Ops.Clamp]:createParser(withArgs(3,3,NumberType),NumberType),[Ops.Mod]:createParser(withArgs(2,2,NumberType),NumberType),[Ops.Pow]:createParser(withArgs(2,2,NumberType),NumberType),[Ops.Abs]:createParser(withArgs(1,1,NumberType),NumberType),[Ops.Floor]:createParser(withArgs(1,1,NumberType),NumberType),[Ops.Ceil]:createParser(withArgs(1,1,NumberType),NumberType),[Ops.Round]:createParser(withArgs(1,1,NumberType),NumberType),[Ops.Sin]:createParser(withArgs(1,1,NumberType),NumberType),[Ops.Cos]:createParser(withArgs(1,1,NumberType),NumberType),[Ops.Atan]:createParser(withArgs(1,2,NumberType),NumberType),[Ops.Sqrt]:createParser(withArgs(1,1,NumberType),NumberType),[Ops.Match]:createParser(withArgs(4,1/0,StringType|NumberType),AnyType)};function withGetArgs(ie,Z){if(ie.length!==2)throw new Error("Expected 1 argument for get operation");const ee=parse$9(ie[1],Z);if(!(ee instanceof LiteralExpression))throw new Error("Expected a literal argument for get operation");if(typeof ee.value!="string")throw new Error("Expected a string argument for get operation");return Z.properties.add(ee.value),[ee]}function withVarArgs(ie,Z){if(ie.length!==2)throw new Error("Expected 1 argument for var operation");const ee=parse$9(ie[1],Z);if(!(ee instanceof LiteralExpression))throw new Error("Expected a literal argument for var operation");if(typeof ee.value!="string")throw new Error("Expected a string argument for get operation");return Z.variables.add(ee.value),[ee]}function withNoArgs(ie,Z){const ee=ie[0];if(ie.length!==1)throw new Error(`Expected no arguments for ${ee} operation`);return[]}function withArgs(ie,Z,ee){return function(ae,ye){const ve=ae[0],be=ae.length-1;if(ie===Z){if(be!==ie){const Ke=ie===1?"":"s";throw new Error(`Expected ${ie} argument${Ke} for operation ${ve}, got ${be}`)}}else if(be<ie||be>Z)throw new Error(`Expected ${ie} to ${Z} arguments for operation ${ve}, got ${be}`);const Ye=new Array(be);for(let Ke=0;Ke<be;++Ke){const Xe=parse$9(ae[Ke+1],ye);if(!overlapsType(ee,Xe.type)){const Je=typeName(ee),rt=typeName(Xe.type);throw new Error(`Unexpected type for argument ${Ke} of ${ve} operation : got ${Je} but expected ${rt}`)}Ye[Ke]=Xe}return Ye}}function createParser(ie,Z){return function(ee,ae){const ye=ee[0],ve=ie(ee,ae);return new CallExpression(Z,ye,...ve)}}function parseCallExpression(ie,Z){const ee=ie[0],ae=parsers[ee];if(!ae)throw new Error(`Unknown operator: ${ee}`);return ae(ie,Z)}function newEvaluationContext(){return{variables:{},properties:{},resolution:NaN}}function buildExpression(ie,Z,ee){const ae=parse$9(ie,ee);if(!overlapsType(Z,ae.type)){const ye=typeName(Z),ve=typeName(ae.type);throw new Error(`Expected expression to be of type ${ye}, got ${ve}`)}return compileExpression(ae)}function compileExpression(ie,Z){if(ie instanceof LiteralExpression)return function(){return ie.value};const ee=ie.operator;switch(ee){case Ops.Number:case Ops.String:return compileAssertionExpression(ie);case Ops.Get:case Ops.Var:return compileAccessorExpression(ie);case Ops.Resolution:return ae=>ae.resolution;case Ops.Any:case Ops.All:case Ops.Not:return compileLogicalExpression(ie);case Ops.Equal:case Ops.NotEqual:case Ops.LessThan:case Ops.LessThanOrEqualTo:case Ops.GreaterThan:case Ops.GreaterThanOrEqualTo:return compileComparisonExpression(ie);case Ops.Multiply:case Ops.Divide:case Ops.Add:case Ops.Subtract:case Ops.Clamp:case Ops.Mod:case Ops.Pow:case Ops.Abs:case Ops.Floor:case Ops.Ceil:case Ops.Round:case Ops.Sin:case Ops.Cos:case Ops.Atan:case Ops.Sqrt:return compileNumericExpression(ie);case Ops.Match:return compileMatchExpression(ie);default:throw new Error(`Unsupported operator ${ee}`)}}function compileAssertionExpression(ie,Z){const ee=ie.operator,ae=ie.args.length,ye=new Array(ae);for(let ve=0;ve<ae;++ve)ye[ve]=compileExpression(ie.args[ve]);switch(ee){case Ops.Number:case Ops.String:return ve=>{for(let be=0;be<ae;++be){const Ye=ye[be](ve);if(typeof Ye===ee)return Ye}throw new Error(`Expected one of the values to be a ${ee}`)};default:throw new Error(`Unsupported assertion operator ${ee}`)}}function compileAccessorExpression(ie,Z){const ee=ie.args[0];if(!(ee instanceof LiteralExpression))throw new Error("Expected literal name");const ae=ee.value;if(typeof ae!="string")throw new Error("Expected string name");switch(ie.operator){case Ops.Get:return ye=>ye.properties[ae];case Ops.Var:return ye=>ye.variables[ae];default:throw new Error(`Unsupported accessor operator ${ie.operator}`)}}function compileComparisonExpression(ie,Z){const ee=ie.operator,ae=compileExpression(ie.args[0]),ye=compileExpression(ie.args[1]);switch(ee){case Ops.Equal:return ve=>ae(ve)===ye(ve);case Ops.NotEqual:return ve=>ae(ve)!==ye(ve);case Ops.LessThan:return ve=>ae(ve)<ye(ve);case Ops.LessThanOrEqualTo:return ve=>ae(ve)<=ye(ve);case Ops.GreaterThan:return ve=>ae(ve)>ye(ve);case Ops.GreaterThanOrEqualTo:return ve=>ae(ve)>=ye(ve);default:throw new Error(`Unsupported comparison operator ${ee}`)}}function compileLogicalExpression(ie,Z){const ee=ie.operator,ae=ie.args.length,ye=new Array(ae);for(let ve=0;ve<ae;++ve)ye[ve]=compileExpression(ie.args[ve]);switch(ee){case Ops.Any:return ve=>{for(let be=0;be<ae;++be)if(ye[be](ve))return!0;return!1};case Ops.All:return ve=>{for(let be=0;be<ae;++be)if(!ye[be](ve))return!1;return!0};case Ops.Not:return ve=>!ye[0](ve);default:throw new Error(`Unsupported logical operator ${ee}`)}}function compileNumericExpression(ie,Z){const ee=ie.operator,ae=ie.args.length,ye=new Array(ae);for(let ve=0;ve<ae;++ve)ye[ve]=compileExpression(ie.args[ve]);switch(ee){case Ops.Multiply:return ve=>{let be=1;for(let Ye=0;Ye<ae;++Ye)be*=ye[Ye](ve);return be};case Ops.Divide:return ve=>ye[0](ve)/ye[1](ve);case Ops.Add:return ve=>{let be=0;for(let Ye=0;Ye<ae;++Ye)be+=ye[Ye](ve);return be};case Ops.Subtract:return ve=>ye[0](ve)-ye[1](ve);case Ops.Clamp:return ve=>{const be=ye[0](ve),Ye=ye[1](ve);if(be<Ye)return Ye;const Ke=ye[2](ve);return be>Ke?Ke:be};case Ops.Mod:return ve=>ye[0](ve)%ye[1](ve);case Ops.Pow:return ve=>Math.pow(ye[0](ve),ye[1](ve));case Ops.Abs:return ve=>Math.abs(ye[0](ve));case Ops.Floor:return ve=>Math.floor(ye[0](ve));case Ops.Ceil:return ve=>Math.ceil(ye[0](ve));case Ops.Round:return ve=>Math.round(ye[0](ve));case Ops.Sin:return ve=>Math.sin(ye[0](ve));case Ops.Cos:return ve=>Math.cos(ye[0](ve));case Ops.Atan:return ae===2?ve=>Math.atan2(ye[0](ve),ye[1](ve)):ve=>Math.atan(ye[0](ve));case Ops.Sqrt:return ve=>Math.sqrt(ye[0](ve));default:throw new Error(`Unsupported numeric operator ${ee}`)}}function compileMatchExpression(ie,Z){const ee=ie.args.length,ae=new Array(ee);for(let ye=0;ye<ee;++ye)ae[ye]=compileExpression(ie.args[ye]);return ye=>{const ve=ae[0](ye);for(let be=1;be<ee;be+=2)if(ve===ae[be](ye))return ae[be+1](ye);return ae[ee-1](ye)}}function always$1(ie){return!0}function rulesToStyleFunction(ie){const Z=newParsingContext(),ee=buildRuleSet(ie,Z),ae=newEvaluationContext();return function(ye,ve){return ae.properties=ye.getPropertiesInternal(),ae.resolution=ve,ee(ae)}}function flatStylesToStyleFunction(ie){const Z=newParsingContext(),ee=ie.length,ae=new Array(ee);for(let be=0;be<ee;++be)ae[be]=buildStyle(ie[be],Z);const ye=newEvaluationContext(),ve=new Array(ee);return function(be,Ye){ye.properties=be.getPropertiesInternal(),ye.resolution=Ye;for(let Ke=0;Ke<ee;++Ke)ve[Ke]=ae[Ke](ye);return ve}}function buildRuleSet(ie,Z){const ee=ie.length,ae=new Array(ee);for(let ye=0;ye<ee;++ye){const ve=ie[ye],be="filter"in ve?buildExpression(ve.filter,BooleanType,Z):always$1;let Ye;if(Array.isArray(ve.style)){const Ke=ve.style.length;Ye=new Array(Ke);for(let Xe=0;Xe<Ke;++Xe)Ye[Xe]=buildStyle(ve.style[Xe],Z)}else Ye=[buildStyle(ve.style,Z)];ae[ye]={filter:be,styles:Ye}}return function(ye){const ve=[];let be=!1;for(let Ye=0;Ye<ee;++Ye){const Ke=ae[Ye].filter;if(Ke(ye)&&!(ie[Ye].else&&be)){be=!0;for(const Xe of ae[Ye].styles){const Je=Xe(ye);Je&&ve.push(Je)}}}return ve}}function buildStyle(ie,Z){const ee=buildFill(ie,"",Z),ae=buildStroke(ie,"",Z),ye=buildText(ie,Z),ve=buildImage(ie,Z),be=numberEvaluator(ie,"z-index",Z),Ye=new Style$1;return function(Ke){let Xe=!0;if(ee){const Je=ee(Ke);Je&&(Xe=!1),Ye.setFill(Je)}if(ae){const Je=ae(Ke);Je&&(Xe=!1),Ye.setStroke(Je)}if(ye){const Je=ye(Ke);Je&&(Xe=!1),Ye.setText(Je)}if(ve){const Je=ve(Ke);Je&&(Xe=!1),Ye.setImage(Je)}return be&&Ye.setZIndex(be(Ke)),Xe?null:Ye}}function buildFill(ie,Z,ee){const ae=colorLikeEvaluator(ie,Z+"fill-color",ee);if(!ae)return null;const ye=new Fill;return function(ve){const be=ae(ve);return be==="none"?null:(ye.setColor(be),ye)}}function buildStroke(ie,Z,ee){const ae=numberEvaluator(ie,Z+"stroke-width",ee),ye=colorLikeEvaluator(ie,Z+"stroke-color",ee);if(!ae&&!ye)return null;const ve=stringEvaluator(ie,Z+"stroke-line-cap",ee),be=stringEvaluator(ie,Z+"stroke-line-join",ee),Ye=numberArrayEvaluator(ie,Z+"stroke-line-dash",ee),Ke=numberEvaluator(ie,Z+"stroke-line-dash-offset",ee),Xe=numberEvaluator(ie,Z+"stroke-miter-limit",ee),Je=new Stroke;return function(rt){if(ye){const nt=ye(rt);if(nt==="none")return null;Je.setColor(nt)}if(ae&&Je.setWidth(ae(rt)),ve){const nt=ve(rt);if(nt!=="butt"&&nt!=="round"&&nt!=="square")throw new Error("Expected butt, round, or square line cap");Je.setLineCap(nt)}if(be){const nt=be(rt);if(nt!=="bevel"&&nt!=="round"&&nt!=="miter")throw new Error("Expected bevel, round, or miter line join");Je.setLineJoin(nt)}return Ye&&Je.setLineDash(Ye(rt)),Ke&&Je.setLineDashOffset(Ke(rt)),Xe&&Je.setMiterLimit(Xe(rt)),Je}}function buildText(ie,Z){const ee="text-",ae=stringEvaluator(ie,ee+"value",Z);if(!ae)return null;const ye=buildFill(ie,ee,Z),ve=buildFill(ie,ee+"background-",Z),be=buildStroke(ie,ee,Z),Ye=buildStroke(ie,ee+"background-",Z),Ke=stringEvaluator(ie,ee+"font",Z),Xe=numberEvaluator(ie,ee+"max-angle",Z),Je=numberEvaluator(ie,ee+"offset-x",Z),rt=numberEvaluator(ie,ee+"offset-y",Z),nt=booleanEvaluator(ie,ee+"overflow",Z),it=stringEvaluator(ie,ee+"placement",Z),lt=numberEvaluator(ie,ee+"repeat",Z),ct=sizeLikeEvaluator(ie,ee+"scale",Z),ot=booleanEvaluator(ie,ee+"rotate-with-view",Z),dt=numberEvaluator(ie,ee+"rotation",Z),ft=stringEvaluator(ie,ee+"align",Z),gt=stringEvaluator(ie,ee+"justify",Z),mt=stringEvaluator(ie,ee+"baseline",Z),Yr=numberArrayEvaluator(ie,ee+"padding",Z),Qr=new Text$1({});return function(Xr){if(Qr.setText(ae(Xr)),ye&&Qr.setFill(ye(Xr)),ve&&Qr.setBackgroundFill(ve(Xr)),be&&Qr.setStroke(be(Xr)),Ye&&Qr.setBackgroundStroke(Ye(Xr)),Ke&&Qr.setFont(Ke(Xr)),Xe&&Qr.setMaxAngle(Xe(Xr)),Je&&Qr.setOffsetX(Je(Xr)),rt&&Qr.setOffsetY(rt(Xr)),nt&&Qr.setOverflow(nt(Xr)),it){const Jr=it(Xr);if(Jr!=="point"&&Jr!=="line")throw new Error("Expected point or line for text-placement");Qr.setPlacement(Jr)}if(lt&&Qr.setRepeat(lt(Xr)),ct&&Qr.setScale(ct(Xr)),ot&&Qr.setRotateWithView(ot(Xr)),dt&&Qr.setRotation(dt(Xr)),ft){const Jr=ft(Xr);if(Jr!=="left"&&Jr!=="center"&&Jr!=="right"&&Jr!=="end"&&Jr!=="start")throw new Error("Expected left, right, center, start, or end for text-align");Qr.setTextAlign(Jr)}if(gt){const Jr=gt(Xr);if(Jr!=="left"&&Jr!=="right"&&Jr!=="center")throw new Error("Expected left, right, or center for text-justify");Qr.setJustify(Jr)}if(mt){const Jr=mt(Xr);if(Jr!=="bottom"&&Jr!=="top"&&Jr!=="middle"&&Jr!=="alphabetic"&&Jr!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");Qr.setTextBaseline(Jr)}return Yr&&Qr.setPadding(Yr(Xr)),Qr}}function buildImage(ie,Z){return"icon-src"in ie?buildIcon(ie,Z):"shape-points"in ie?buildShape(ie,Z):"circle-radius"in ie?buildCircle(ie,Z):null}function buildIcon(ie,Z){const ee="icon-",ae=ee+"src",ye=requireString(ie[ae],ae),ve=coordinateEvaluator(ie,ee+"anchor",Z),be=sizeLikeEvaluator(ie,ee+"scale",Z),Ye=numberEvaluator(ie,ee+"opacity",Z),Ke=coordinateEvaluator(ie,ee+"displacement",Z),Xe=numberEvaluator(ie,ee+"rotation",Z),Je=booleanEvaluator(ie,ee+"rotate-with-view",Z),rt=optionalIconOrigin(ie,ee+"anchor-origin"),nt=optionalIconAnchorUnits(ie,ee+"anchor-x-units"),it=optionalIconAnchorUnits(ie,ee+"anchor-y-units"),lt=optionalColorLike(ie,ee+"color"),ct=optionalString(ie,ee+"cross-origin"),ot=optionalNumberArray(ie,ee+"offset"),dt=optionalIconOrigin(ie,ee+"offset-origin"),ft=optionalNumber(ie,ee+"width"),gt=optionalNumber(ie,ee+"height"),mt=optionalSize(ie,ee+"size"),Yr=optionalDeclutterMode(ie,ee+"declutter"),Qr=new Icon({src:ye,anchorOrigin:rt,anchorXUnits:nt,anchorYUnits:it,color:lt,crossOrigin:ct,offset:ot,offsetOrigin:dt,height:gt,width:ft,size:mt,declutterMode:Yr});return function(Xr){return Ye&&Qr.setOpacity(Ye(Xr)),Ke&&Qr.setDisplacement(Ke(Xr)),Xe&&Qr.setRotation(Xe(Xr)),Je&&Qr.setRotateWithView(Je(Xr)),be&&Qr.setScale(be(Xr)),ve&&Qr.setAnchor(ve(Xr)),Qr}}function buildShape(ie,Z){const ee="shape-",ae=ee+"points",ye=requireNumber(ie[ae],ae),ve=buildFill(ie,ee,Z),be=buildStroke(ie,ee,Z),Ye=sizeLikeEvaluator(ie,ee+"scale",Z),Ke=coordinateEvaluator(ie,ee+"displacement",Z),Xe=numberEvaluator(ie,ee+"rotation",Z),Je=booleanEvaluator(ie,ee+"rotate-with-view",Z),rt=optionalNumber(ie,ee+"radius"),nt=optionalNumber(ie,ee+"radius1"),it=optionalNumber(ie,ee+"radius2"),lt=optionalNumber(ie,ee+"angle"),ct=optionalDeclutterMode(ie,ee+"declutter-mode"),ot=new RegularShape({points:ye,radius:rt,radius1:nt,radius2:it,angle:lt,declutterMode:ct});return function(dt){return ve&&ot.setFill(ve(dt)),be&&ot.setStroke(be(dt)),Ke&&ot.setDisplacement(Ke(dt)),Xe&&ot.setRotation(Xe(dt)),Je&&ot.setRotateWithView(Je(dt)),Ye&&ot.setScale(Ye(dt)),ot}}function buildCircle(ie,Z){const ee="circle-",ae=buildFill(ie,ee,Z),ye=buildStroke(ie,ee,Z),ve=numberEvaluator(ie,ee+"radius",Z),be=sizeLikeEvaluator(ie,ee+"scale",Z),Ye=coordinateEvaluator(ie,ee+"displacement",Z),Ke=numberEvaluator(ie,ee+"rotation",Z),Xe=booleanEvaluator(ie,ee+"rotate-with-view",Z),Je=optionalDeclutterMode(ie,ee+"declutter-mode"),rt=new CircleStyle({radius:5,declutterMode:Je});return function(nt){return ve&&rt.setRadius(ve(nt)),ae&&rt.setFill(ae(nt)),ye&&rt.setStroke(ye(nt)),Ye&&rt.setDisplacement(Ye(nt)),Ke&&rt.setRotation(Ke(nt)),Xe&&rt.setRotateWithView(Xe(nt)),be&&rt.setScale(be(nt)),rt}}function numberEvaluator(ie,Z,ee){if(!(Z in ie))return;const ae=buildExpression(ie[Z],NumberType,ee);return function(ye){return requireNumber(ae(ye),Z)}}function stringEvaluator(ie,Z,ee){if(!(Z in ie))return null;const ae=buildExpression(ie[Z],StringType,ee);return function(ye){return requireString(ae(ye),Z)}}function booleanEvaluator(ie,Z,ee){if(!(Z in ie))return null;const ae=buildExpression(ie[Z],BooleanType,ee);return function(ye){const ve=ae(ye);if(typeof ve!="boolean")throw new Error(`Expected a boolean for ${Z}`);return ve}}function colorLikeEvaluator(ie,Z,ee){if(!(Z in ie))return null;const ae=buildExpression(ie[Z],ColorType|StringType,ee);return function(ye){return requireColorLike(ae(ye),Z)}}function numberArrayEvaluator(ie,Z,ee){if(!(Z in ie))return null;const ae=buildExpression(ie[Z],NumberArrayType,ee);return function(ye){return requireNumberArray(ae(ye),Z)}}function coordinateEvaluator(ie,Z,ee){if(!(Z in ie))return null;const ae=buildExpression(ie[Z],NumberArrayType,ee);return function(ye){const ve=requireNumberArray(ae(ye),Z);if(ve.length!==2)throw new Error(`Expected two numbers for ${Z}`);return ve}}function sizeLikeEvaluator(ie,Z,ee){if(!(Z in ie))return null;const ae=buildExpression(ie[Z],NumberArrayType|NumberType,ee);return function(ye){return requireSizeLike(ae(ye),Z)}}function optionalNumber(ie,Z){const ee=ie[Z];if(ee!==void 0){if(typeof ee!="number")throw new Error(`Expected a number for ${Z}`);return ee}}function optionalSize(ie,Z){const ee=ie[Z];if(ee!==void 0){if(typeof ee=="number")return toSize(ee);if(!Array.isArray(ee))throw new Error(`Expected a number or size array for ${Z}`);if(ee.length!==2||typeof ee[0]!="number"||typeof ee[1]!="number")throw new Error(`Expected a number or size array for ${Z}`);return ee}}function optionalString(ie,Z){const ee=ie[Z];if(ee!==void 0){if(typeof ee!="string")throw new Error(`Expected a string for ${Z}`);return ee}}function optionalIconOrigin(ie,Z){const ee=ie[Z];if(ee!==void 0){if(ee!=="bottom-left"&&ee!=="bottom-right"&&ee!=="top-left"&&ee!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${Z}`);return ee}}function optionalIconAnchorUnits(ie,Z){const ee=ie[Z];if(ee!==void 0){if(ee!=="pixels"&&ee!=="fraction")throw new Error(`Expected pixels or fraction for ${Z}`);return ee}}function optionalNumberArray(ie,Z){const ee=ie[Z];if(ee!==void 0)return requireNumberArray(ee,Z)}function optionalDeclutterMode(ie,Z){const ee=ie[Z];if(ee!==void 0){if(typeof ee!="string")throw new Error(`Expected a string for ${Z}`);if(ee!=="declutter"&&ee!=="obstacle"&&ee!=="none")throw new Error(`Expected declutter, obstacle, or none for ${Z}`);return ee}}function optionalColorLike(ie,Z){const ee=ie[Z];if(ee!==void 0)return requireColorLike(ee,Z)}function requireNumberArray(ie,Z){if(!Array.isArray(ie))throw new Error(`Expected an array for ${Z}`);const ee=ie.length;for(let ae=0;ae<ee;++ae)if(typeof ie[ae]!="number")throw new Error(`Expected an array of numbers for ${Z}`);return ie}function requireString(ie,Z){if(typeof ie!="string")throw new Error(`Expected a string for ${Z}`);return ie}function requireNumber(ie,Z){if(typeof ie!="number")throw new Error(`Expected a number for ${Z}`);return ie}function requireColorLike(ie,Z){if(typeof ie=="string")return ie;const ee=requireNumberArray(ie,Z),ae=ee.length;if(ae<3||ae>4)throw new Error(`Expected a color with 3 or 4 values for ${Z}`);return ee}function requireSizeLike(ie,Z){if(typeof ie=="number")return ie;const ee=requireNumberArray(ie,Z);if(ee.length!==2)throw new Error(`Expected an array of two numbers for ${Z}`);return ee}const Property$1={RENDER_ORDER:"renderOrder"};class BaseVectorLayer extends Layer{constructor(Z){Z=Z||{};const ee=Object.assign({},Z);delete ee.style,delete ee.renderBuffer,delete ee.updateWhileAnimating,delete ee.updateWhileInteracting,super(ee),this.declutter_=Z.declutter!==void 0?Z.declutter:!1,this.renderBuffer_=Z.renderBuffer!==void 0?Z.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(Z.style),this.updateWhileAnimating_=Z.updateWhileAnimating!==void 0?Z.updateWhileAnimating:!1,this.updateWhileInteracting_=Z.updateWhileInteracting!==void 0?Z.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(Z){return super.getFeatures(Z)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(Property$1.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(Z){Z.declutterTree||(Z.declutterTree=new RBush(9)),this.getRenderer().renderDeclutter(Z)}setRenderOrder(Z){this.set(Property$1.RENDER_ORDER,Z)}setStyle(Z){this.style_=toStyleLike(Z),this.styleFunction_=Z===null?void 0:toFunction(this.style_),this.changed()}}function toStyleLike(ie){if(ie===void 0)return createDefaultStyle;if(!ie)return null;if(typeof ie=="function"||ie instanceof Style$1)return ie;if(!Array.isArray(ie))return flatStylesToStyleFunction([ie]);if(ie.length===0)return[];const Z=ie.length,ee=ie[0];if(ee instanceof Style$1){const ae=new Array(Z);for(let ye=0;ye<Z;++ye){const ve=ie[ye];if(!(ve instanceof Style$1))throw new Error("Expected a list of style instances");ae[ye]=ve}return ae}if("style"in ee){const ae=new Array(Z);for(let ye=0;ye<Z;++ye){const ve=ie[ye];if(!("style"in ve))throw new Error("Expected a list of rules with a style property");ae[ye]=ve}return rulesToStyleFunction(ae)}return flatStylesToStyleFunction(ie)}const Instruction={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},fillInstruction=[Instruction.FILL],strokeInstruction=[Instruction.STROKE],beginPathInstruction=[Instruction.BEGIN_PATH],closePathInstruction=[Instruction.CLOSE_PATH];class VectorContext{drawCustom(Z,ee,ae,ye){}drawGeometry(Z){}setStyle(Z){}drawCircle(Z,ee){}drawFeature(Z,ee){}drawGeometryCollection(Z,ee){}drawLineString(Z,ee){}drawMultiLineString(Z,ee){}drawMultiPoint(Z,ee){}drawMultiPolygon(Z,ee){}drawPoint(Z,ee){}drawPolygon(Z,ee){}drawText(Z,ee){}setFillStrokeStyle(Z,ee){}setImageStyle(Z,ee){}setTextStyle(Z,ee){}}class CanvasBuilder extends VectorContext{constructor(Z,ee,ae,ye){super(),this.tolerance=Z,this.maxExtent=ee,this.pixelRatio=ye,this.maxLineWidth=0,this.resolution=ae,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(Z){const ee=this.pixelRatio;return ee==1?Z:Z.map(function(ae){return ae*ee})}appendFlatPointCoordinates(Z,ee){const ae=this.getBufferedMaxExtent(),ye=this.tmpCoordinate_,ve=this.coordinates;let be=ve.length;for(let Ye=0,Ke=Z.length;Ye<Ke;Ye+=ee)ye[0]=Z[Ye],ye[1]=Z[Ye+1],containsCoordinate(ae,ye)&&(ve[be++]=ye[0],ve[be++]=ye[1]);return be}appendFlatLineCoordinates(Z,ee,ae,ye,ve,be){const Ye=this.coordinates;let Ke=Ye.length;const Xe=this.getBufferedMaxExtent();be&&(ee+=ye);let Je=Z[ee],rt=Z[ee+1];const nt=this.tmpCoordinate_;let it=!0,lt,ct,ot;for(lt=ee+ye;lt<ae;lt+=ye)nt[0]=Z[lt],nt[1]=Z[lt+1],ot=coordinateRelationship(Xe,nt),ot!==ct?(it&&(Ye[Ke++]=Je,Ye[Ke++]=rt,it=!1),Ye[Ke++]=nt[0],Ye[Ke++]=nt[1]):ot===Relationship.INTERSECTING?(Ye[Ke++]=nt[0],Ye[Ke++]=nt[1],it=!1):it=!0,Je=nt[0],rt=nt[1],ct=ot;return(ve&&it||lt===ee+ye)&&(Ye[Ke++]=Je,Ye[Ke++]=rt),Ke}drawCustomCoordinates_(Z,ee,ae,ye,ve){for(let be=0,Ye=ae.length;be<Ye;++be){const Ke=ae[be],Xe=this.appendFlatLineCoordinates(Z,ee,Ke,ye,!1,!1);ve.push(Xe),ee=Ke}return ee}drawCustom(Z,ee,ae,ye){this.beginGeometry(Z,ee);const ve=Z.getType(),be=Z.getStride(),Ye=this.coordinates.length;let Ke,Xe,Je,rt,nt;switch(ve){case"MultiPolygon":Ke=Z.getOrientedFlatCoordinates(),rt=[];const it=Z.getEndss();nt=0;for(let lt=0,ct=it.length;lt<ct;++lt){const ot=[];nt=this.drawCustomCoordinates_(Ke,nt,it[lt],be,ot),rt.push(ot)}this.instructions.push([Instruction.CUSTOM,Ye,rt,Z,ae,inflateMultiCoordinatesArray]),this.hitDetectionInstructions.push([Instruction.CUSTOM,Ye,rt,Z,ye||ae,inflateMultiCoordinatesArray]);break;case"Polygon":case"MultiLineString":Je=[],Ke=ve=="Polygon"?Z.getOrientedFlatCoordinates():Z.getFlatCoordinates(),nt=this.drawCustomCoordinates_(Ke,0,Z.getEnds(),be,Je),this.instructions.push([Instruction.CUSTOM,Ye,Je,Z,ae,inflateCoordinatesArray]),this.hitDetectionInstructions.push([Instruction.CUSTOM,Ye,Je,Z,ye||ae,inflateCoordinatesArray]);break;case"LineString":case"Circle":Ke=Z.getFlatCoordinates(),Xe=this.appendFlatLineCoordinates(Ke,0,Ke.length,be,!1,!1),this.instructions.push([Instruction.CUSTOM,Ye,Xe,Z,ae,inflateCoordinates]),this.hitDetectionInstructions.push([Instruction.CUSTOM,Ye,Xe,Z,ye||ae,inflateCoordinates]);break;case"MultiPoint":Ke=Z.getFlatCoordinates(),Xe=this.appendFlatPointCoordinates(Ke,be),Xe>Ye&&(this.instructions.push([Instruction.CUSTOM,Ye,Xe,Z,ae,inflateCoordinates]),this.hitDetectionInstructions.push([Instruction.CUSTOM,Ye,Xe,Z,ye||ae,inflateCoordinates]));break;case"Point":Ke=Z.getFlatCoordinates(),this.coordinates.push(Ke[0],Ke[1]),Xe=this.coordinates.length,this.instructions.push([Instruction.CUSTOM,Ye,Xe,Z,ae]),this.hitDetectionInstructions.push([Instruction.CUSTOM,Ye,Xe,Z,ye||ae]);break}this.endGeometry(ee)}beginGeometry(Z,ee){this.beginGeometryInstruction1_=[Instruction.BEGIN_GEOMETRY,ee,0,Z],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[Instruction.BEGIN_GEOMETRY,ee,0,Z],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const Z=this.hitDetectionInstructions;Z.reverse();let ee;const ae=Z.length;let ye,ve,be=-1;for(ee=0;ee<ae;++ee)ye=Z[ee],ve=ye[0],ve==Instruction.END_GEOMETRY?be=ee:ve==Instruction.BEGIN_GEOMETRY&&(ye[2]=ee,reverseSubArray(this.hitDetectionInstructions,be,ee),be=-1)}setFillStrokeStyle(Z,ee){const ae=this.state;if(Z){const ye=Z.getColor();ae.fillStyle=asColorLike(ye||defaultFillStyle)}else ae.fillStyle=void 0;if(ee){const ye=ee.getColor();ae.strokeStyle=asColorLike(ye||defaultStrokeStyle);const ve=ee.getLineCap();ae.lineCap=ve!==void 0?ve:defaultLineCap;const be=ee.getLineDash();ae.lineDash=be?be.slice():defaultLineDash;const Ye=ee.getLineDashOffset();ae.lineDashOffset=Ye||defaultLineDashOffset;const Ke=ee.getLineJoin();ae.lineJoin=Ke!==void 0?Ke:defaultLineJoin;const Xe=ee.getWidth();ae.lineWidth=Xe!==void 0?Xe:defaultLineWidth;const Je=ee.getMiterLimit();ae.miterLimit=Je!==void 0?Je:defaultMiterLimit,ae.lineWidth>this.maxLineWidth&&(this.maxLineWidth=ae.lineWidth,this.bufferedMaxExtent_=null)}else ae.strokeStyle=void 0,ae.lineCap=void 0,ae.lineDash=null,ae.lineDashOffset=void 0,ae.lineJoin=void 0,ae.lineWidth=void 0,ae.miterLimit=void 0}createFill(Z){const ee=Z.fillStyle,ae=[Instruction.SET_FILL_STYLE,ee];return typeof ee!="string"&&ae.push(!0),ae}applyStroke(Z){this.instructions.push(this.createStroke(Z))}createStroke(Z){return[Instruction.SET_STROKE_STYLE,Z.strokeStyle,Z.lineWidth*this.pixelRatio,Z.lineCap,Z.lineJoin,Z.miterLimit,this.applyPixelRatio(Z.lineDash),Z.lineDashOffset*this.pixelRatio]}updateFillStyle(Z,ee){const ae=Z.fillStyle;(typeof ae!="string"||Z.currentFillStyle!=ae)&&(ae!==void 0&&this.instructions.push(ee.call(this,Z)),Z.currentFillStyle=ae)}updateStrokeStyle(Z,ee){const ae=Z.strokeStyle,ye=Z.lineCap,ve=Z.lineDash,be=Z.lineDashOffset,Ye=Z.lineJoin,Ke=Z.lineWidth,Xe=Z.miterLimit;(Z.currentStrokeStyle!=ae||Z.currentLineCap!=ye||ve!=Z.currentLineDash&&!equals$2(Z.currentLineDash,ve)||Z.currentLineDashOffset!=be||Z.currentLineJoin!=Ye||Z.currentLineWidth!=Ke||Z.currentMiterLimit!=Xe)&&(ae!==void 0&&ee.call(this,Z),Z.currentStrokeStyle=ae,Z.currentLineCap=ye,Z.currentLineDash=ve,Z.currentLineDashOffset=be,Z.currentLineJoin=Ye,Z.currentLineWidth=Ke,Z.currentMiterLimit=Xe)}endGeometry(Z){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const ee=[Instruction.END_GEOMETRY,Z];this.instructions.push(ee),this.hitDetectionInstructions.push(ee)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=clone(this.maxExtent),this.maxLineWidth>0)){const Z=this.resolution*(this.maxLineWidth+1)/2;buffer$1(this.bufferedMaxExtent_,Z,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class CanvasImageBuilder extends CanvasBuilder{constructor(Z,ee,ae,ye){super(Z,ee,ae,ye),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(Z,ee){if(!this.image_)return;this.beginGeometry(Z,ee);const ae=Z.getFlatCoordinates(),ye=Z.getStride(),ve=this.coordinates.length,be=this.appendFlatPointCoordinates(ae,ye);this.instructions.push([Instruction.DRAW_IMAGE,ve,be,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Instruction.DRAW_IMAGE,ve,be,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(ee)}drawMultiPoint(Z,ee){if(!this.image_)return;this.beginGeometry(Z,ee);const ae=Z.getFlatCoordinates(),ye=Z.getStride(),ve=this.coordinates.length,be=this.appendFlatPointCoordinates(ae,ye);this.instructions.push([Instruction.DRAW_IMAGE,ve,be,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Instruction.DRAW_IMAGE,ve,be,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(ee)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(Z,ee){const ae=Z.getAnchor(),ye=Z.getSize(),ve=Z.getOrigin();this.imagePixelRatio_=Z.getPixelRatio(this.pixelRatio),this.anchorX_=ae[0],this.anchorY_=ae[1],this.hitDetectionImage_=Z.getHitDetectionImage(),this.image_=Z.getImage(this.pixelRatio),this.height_=ye[1],this.opacity_=Z.getOpacity(),this.originX_=ve[0],this.originY_=ve[1],this.rotateWithView_=Z.getRotateWithView(),this.rotation_=Z.getRotation(),this.scale_=Z.getScaleArray(),this.width_=ye[0],this.declutterMode_=Z.getDeclutterMode(),this.declutterImageWithText_=ee}}const ImageBuilder=CanvasImageBuilder;class CanvasLineStringBuilder extends CanvasBuilder{constructor(Z,ee,ae,ye){super(Z,ee,ae,ye)}drawFlatCoordinates_(Z,ee,ae,ye){const ve=this.coordinates.length,be=this.appendFlatLineCoordinates(Z,ee,ae,ye,!1,!1),Ye=[Instruction.MOVE_TO_LINE_TO,ve,be];return this.instructions.push(Ye),this.hitDetectionInstructions.push(Ye),ae}drawLineString(Z,ee){const ae=this.state,ye=ae.strokeStyle,ve=ae.lineWidth;if(ye===void 0||ve===void 0)return;this.updateStrokeStyle(ae,this.applyStroke),this.beginGeometry(Z,ee),this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,ae.strokeStyle,ae.lineWidth,ae.lineCap,ae.lineJoin,ae.miterLimit,defaultLineDash,defaultLineDashOffset],beginPathInstruction);const be=Z.getFlatCoordinates(),Ye=Z.getStride();this.drawFlatCoordinates_(be,0,be.length,Ye),this.hitDetectionInstructions.push(strokeInstruction),this.endGeometry(ee)}drawMultiLineString(Z,ee){const ae=this.state,ye=ae.strokeStyle,ve=ae.lineWidth;if(ye===void 0||ve===void 0)return;this.updateStrokeStyle(ae,this.applyStroke),this.beginGeometry(Z,ee),this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,ae.strokeStyle,ae.lineWidth,ae.lineCap,ae.lineJoin,ae.miterLimit,defaultLineDash,defaultLineDashOffset],beginPathInstruction);const be=Z.getEnds(),Ye=Z.getFlatCoordinates(),Ke=Z.getStride();let Xe=0;for(let Je=0,rt=be.length;Je<rt;++Je)Xe=this.drawFlatCoordinates_(Ye,Xe,be[Je],Ke);this.hitDetectionInstructions.push(strokeInstruction),this.endGeometry(ee)}finish(){const Z=this.state;return Z.lastStroke!=null&&Z.lastStroke!=this.coordinates.length&&this.instructions.push(strokeInstruction),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(Z){Z.lastStroke!=null&&Z.lastStroke!=this.coordinates.length&&(this.instructions.push(strokeInstruction),Z.lastStroke=this.coordinates.length),Z.lastStroke=0,super.applyStroke(Z),this.instructions.push(beginPathInstruction)}}const LineStringBuilder=CanvasLineStringBuilder;class CanvasPolygonBuilder extends CanvasBuilder{constructor(Z,ee,ae,ye){super(Z,ee,ae,ye)}drawFlatCoordinatess_(Z,ee,ae,ye){const ve=this.state,be=ve.fillStyle!==void 0,Ye=ve.strokeStyle!==void 0,Ke=ae.length;this.instructions.push(beginPathInstruction),this.hitDetectionInstructions.push(beginPathInstruction);for(let Xe=0;Xe<Ke;++Xe){const Je=ae[Xe],rt=this.coordinates.length,nt=this.appendFlatLineCoordinates(Z,ee,Je,ye,!0,!Ye),it=[Instruction.MOVE_TO_LINE_TO,rt,nt];this.instructions.push(it),this.hitDetectionInstructions.push(it),Ye&&(this.instructions.push(closePathInstruction),this.hitDetectionInstructions.push(closePathInstruction)),ee=Je}return be&&(this.instructions.push(fillInstruction),this.hitDetectionInstructions.push(fillInstruction)),Ye&&(this.instructions.push(strokeInstruction),this.hitDetectionInstructions.push(strokeInstruction)),ee}drawCircle(Z,ee){const ae=this.state,ye=ae.fillStyle,ve=ae.strokeStyle;if(ye===void 0&&ve===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(Z,ee),ae.fillStyle!==void 0&&this.hitDetectionInstructions.push([Instruction.SET_FILL_STYLE,defaultFillStyle]),ae.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,ae.strokeStyle,ae.lineWidth,ae.lineCap,ae.lineJoin,ae.miterLimit,defaultLineDash,defaultLineDashOffset]);const be=Z.getFlatCoordinates(),Ye=Z.getStride(),Ke=this.coordinates.length;this.appendFlatLineCoordinates(be,0,be.length,Ye,!1,!1);const Xe=[Instruction.CIRCLE,Ke];this.instructions.push(beginPathInstruction,Xe),this.hitDetectionInstructions.push(beginPathInstruction,Xe),ae.fillStyle!==void 0&&(this.instructions.push(fillInstruction),this.hitDetectionInstructions.push(fillInstruction)),ae.strokeStyle!==void 0&&(this.instructions.push(strokeInstruction),this.hitDetectionInstructions.push(strokeInstruction)),this.endGeometry(ee)}drawPolygon(Z,ee){const ae=this.state,ye=ae.fillStyle,ve=ae.strokeStyle;if(ye===void 0&&ve===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(Z,ee),ae.fillStyle!==void 0&&this.hitDetectionInstructions.push([Instruction.SET_FILL_STYLE,defaultFillStyle]),ae.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,ae.strokeStyle,ae.lineWidth,ae.lineCap,ae.lineJoin,ae.miterLimit,defaultLineDash,defaultLineDashOffset]);const be=Z.getEnds(),Ye=Z.getOrientedFlatCoordinates(),Ke=Z.getStride();this.drawFlatCoordinatess_(Ye,0,be,Ke),this.endGeometry(ee)}drawMultiPolygon(Z,ee){const ae=this.state,ye=ae.fillStyle,ve=ae.strokeStyle;if(ye===void 0&&ve===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(Z,ee),ae.fillStyle!==void 0&&this.hitDetectionInstructions.push([Instruction.SET_FILL_STYLE,defaultFillStyle]),ae.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,ae.strokeStyle,ae.lineWidth,ae.lineCap,ae.lineJoin,ae.miterLimit,defaultLineDash,defaultLineDashOffset]);const be=Z.getEndss(),Ye=Z.getOrientedFlatCoordinates(),Ke=Z.getStride();let Xe=0;for(let Je=0,rt=be.length;Je<rt;++Je)Xe=this.drawFlatCoordinatess_(Ye,Xe,be[Je],Ke);this.endGeometry(ee)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const Z=this.tolerance;if(Z!==0){const ee=this.coordinates;for(let ae=0,ye=ee.length;ae<ye;++ae)ee[ae]=snap(ee[ae],Z)}return super.finish()}setFillStrokeStyles_(){const Z=this.state;Z.fillStyle!==void 0&&this.updateFillStyle(Z,this.createFill),Z.strokeStyle!==void 0&&this.updateStrokeStyle(Z,this.applyStroke)}}const PolygonBuilder=CanvasPolygonBuilder;function lineChunk(ie,Z,ee,ae,ye){const ve=[];let be=ee,Ye=0,Ke=Z.slice(ee,2);for(;Ye<ie&&be+ye<ae;){const[Xe,Je]=Ke.slice(-2),rt=Z[be+ye],nt=Z[be+ye+1],it=Math.sqrt((rt-Xe)*(rt-Xe)+(nt-Je)*(nt-Je));if(Ye+=it,Ye>=ie){const lt=(ie-Ye+it)/it,ct=lerp$1(Xe,rt,lt),ot=lerp$1(Je,nt,lt);Ke.push(ct,ot),ve.push(Ke),Ke=[ct,ot],Ye==ie&&(be+=ye),Ye=0}else if(Ye<ie)Ke.push(Z[be+ye],Z[be+ye+1]),be+=ye;else{const lt=it-Ye,ct=lerp$1(Xe,rt,lt/it),ot=lerp$1(Je,nt,lt/it);Ke.push(ct,ot),ve.push(Ke),Ke=[ct,ot],Ye=0,be+=ye}}return Ye>0&&ve.push(Ke),ve}function matchingChunk(ie,Z,ee,ae,ye){let ve=ee,be=ee,Ye=0,Ke=0,Xe=ee,Je,rt,nt,it,lt,ct,ot,dt,ft,gt;for(rt=ee;rt<ae;rt+=ye){const mt=Z[rt],Yr=Z[rt+1];lt!==void 0&&(ft=mt-lt,gt=Yr-ct,it=Math.sqrt(ft*ft+gt*gt),ot!==void 0&&(Ke+=nt,Je=Math.acos((ot*ft+dt*gt)/(nt*it)),Je>ie&&(Ke>Ye&&(Ye=Ke,ve=Xe,be=rt),Ke=0,Xe=rt-ye)),nt=it,ot=ft,dt=gt),lt=mt,ct=Yr}return Ke+=it,Ke>Ye?[Xe,rt]:[ve,be]}const TEXT_ALIGN={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class CanvasTextBuilder extends CanvasBuilder{constructor(Z,ee,ae,ye){super(Z,ee,ae,ye),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[defaultFillStyle]={fillStyle:defaultFillStyle},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterImageWithText_=void 0}finish(){const Z=super.finish();return Z.textStates=this.textStates,Z.fillStates=this.fillStates,Z.strokeStates=this.strokeStates,Z}drawText(Z,ee){const ae=this.textFillState_,ye=this.textStrokeState_,ve=this.textState_;if(this.text_===""||!ve||!ae&&!ye)return;const be=this.coordinates;let Ye=be.length;const Ke=Z.getType();let Xe=null,Je=Z.getStride();if(ve.placement==="line"&&(Ke=="LineString"||Ke=="MultiLineString"||Ke=="Polygon"||Ke=="MultiPolygon")){if(!intersects$1(this.getBufferedMaxExtent(),Z.getExtent()))return;let rt;if(Xe=Z.getFlatCoordinates(),Ke=="LineString")rt=[Xe.length];else if(Ke=="MultiLineString")rt=Z.getEnds();else if(Ke=="Polygon")rt=Z.getEnds().slice(0,1);else if(Ke=="MultiPolygon"){const ct=Z.getEndss();rt=[];for(let ot=0,dt=ct.length;ot<dt;++ot)rt.push(ct[ot][0])}this.beginGeometry(Z,ee);const nt=ve.repeat,it=nt?void 0:ve.textAlign;let lt=0;for(let ct=0,ot=rt.length;ct<ot;++ct){let dt;nt?dt=lineChunk(nt*this.resolution,Xe,lt,rt[ct],Je):dt=[Xe.slice(lt,rt[ct])];for(let ft=0,gt=dt.length;ft<gt;++ft){const mt=dt[ft];let Yr=0,Qr=mt.length;if(it==null){const Jr=matchingChunk(ve.maxAngle,mt,0,mt.length,2);Yr=Jr[0],Qr=Jr[1]}for(let Jr=Yr;Jr<Qr;Jr+=Je)be.push(mt[Jr],mt[Jr+1]);const Xr=be.length;lt=rt[ct],this.drawChars_(Ye,Xr),Ye=Xr}}this.endGeometry(ee)}else{let rt=ve.overflow?null:[];switch(Ke){case"Point":case"MultiPoint":Xe=Z.getFlatCoordinates();break;case"LineString":Xe=Z.getFlatMidpoint();break;case"Circle":Xe=Z.getCenter();break;case"MultiLineString":Xe=Z.getFlatMidpoints(),Je=2;break;case"Polygon":Xe=Z.getFlatInteriorPoint(),ve.overflow||rt.push(Xe[2]/this.resolution),Je=3;break;case"MultiPolygon":const dt=Z.getFlatInteriorPoints();Xe=[];for(let ft=0,gt=dt.length;ft<gt;ft+=3)ve.overflow||rt.push(dt[ft+2]/this.resolution),Xe.push(dt[ft],dt[ft+1]);if(Xe.length===0)return;Je=2;break}const nt=this.appendFlatPointCoordinates(Xe,Je);if(nt===Ye)return;if(rt&&(nt-Ye)/2!==Xe.length/Je){let dt=Ye/2;rt=rt.filter((ft,gt)=>{const mt=be[(dt+gt)*2]===Xe[gt*Je]&&be[(dt+gt)*2+1]===Xe[gt*Je+1];return mt||--dt,mt})}this.saveTextStates_(),(ve.backgroundFill||ve.backgroundStroke)&&(this.setFillStrokeStyle(ve.backgroundFill,ve.backgroundStroke),ve.backgroundFill&&this.updateFillStyle(this.state,this.createFill),ve.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(Z,ee);let it=ve.padding;if(it!=defaultPadding&&(ve.scale[0]<0||ve.scale[1]<0)){let dt=ve.padding[0],ft=ve.padding[1],gt=ve.padding[2],mt=ve.padding[3];ve.scale[0]<0&&(ft=-ft,mt=-mt),ve.scale[1]<0&&(dt=-dt,gt=-gt),it=[dt,ft,gt,mt]}const lt=this.pixelRatio;this.instructions.push([Instruction.DRAW_IMAGE,Ye,nt,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,void 0,this.declutterImageWithText_,it==defaultPadding?defaultPadding:it.map(function(dt){return dt*lt}),!!ve.backgroundFill,!!ve.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,rt]);const ct=1/lt,ot=this.state.fillStyle;ve.backgroundFill&&(this.state.fillStyle=defaultFillStyle,this.hitDetectionInstructions.push(this.createFill(this.state))),this.hitDetectionInstructions.push([Instruction.DRAW_IMAGE,Ye,nt,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[ct,ct],NaN,void 0,this.declutterImageWithText_,it,!!ve.backgroundFill,!!ve.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?defaultFillStyle:this.fillKey_,this.textOffsetX_,this.textOffsetY_,rt]),ve.backgroundFill&&(this.state.fillStyle=ot,this.hitDetectionInstructions.push(this.createFill(this.state))),this.endGeometry(ee)}}saveTextStates_(){const Z=this.textStrokeState_,ee=this.textState_,ae=this.textFillState_,ye=this.strokeKey_;Z&&(ye in this.strokeStates||(this.strokeStates[ye]={strokeStyle:Z.strokeStyle,lineCap:Z.lineCap,lineDashOffset:Z.lineDashOffset,lineWidth:Z.lineWidth,lineJoin:Z.lineJoin,miterLimit:Z.miterLimit,lineDash:Z.lineDash}));const ve=this.textKey_;ve in this.textStates||(this.textStates[ve]={font:ee.font,textAlign:ee.textAlign||defaultTextAlign,justify:ee.justify,textBaseline:ee.textBaseline||defaultTextBaseline,scale:ee.scale});const be=this.fillKey_;ae&&(be in this.fillStates||(this.fillStates[be]={fillStyle:ae.fillStyle}))}drawChars_(Z,ee){const ae=this.textStrokeState_,ye=this.textState_,ve=this.strokeKey_,be=this.textKey_,Ye=this.fillKey_;this.saveTextStates_();const Ke=this.pixelRatio,Xe=TEXT_ALIGN[ye.textBaseline],Je=this.textOffsetY_*Ke,rt=this.text_,nt=ae?ae.lineWidth*Math.abs(ye.scale[0])/2:0;this.instructions.push([Instruction.DRAW_CHARS,Z,ee,Xe,ye.overflow,Ye,ye.maxAngle,Ke,Je,ve,nt*Ke,rt,be,1]),this.hitDetectionInstructions.push([Instruction.DRAW_CHARS,Z,ee,Xe,ye.overflow,Ye&&defaultFillStyle,ye.maxAngle,Ke,Je,ve,nt*Ke,rt,be,1/Ke])}setTextStyle(Z,ee){let ae,ye,ve;if(!Z)this.text_="";else{const be=Z.getFill();be?(ye=this.textFillState_,ye||(ye={},this.textFillState_=ye),ye.fillStyle=asColorLike(be.getColor()||defaultFillStyle)):(ye=null,this.textFillState_=ye);const Ye=Z.getStroke();if(!Ye)ve=null,this.textStrokeState_=ve;else{ve=this.textStrokeState_,ve||(ve={},this.textStrokeState_=ve);const lt=Ye.getLineDash(),ct=Ye.getLineDashOffset(),ot=Ye.getWidth(),dt=Ye.getMiterLimit();ve.lineCap=Ye.getLineCap()||defaultLineCap,ve.lineDash=lt?lt.slice():defaultLineDash,ve.lineDashOffset=ct===void 0?defaultLineDashOffset:ct,ve.lineJoin=Ye.getLineJoin()||defaultLineJoin,ve.lineWidth=ot===void 0?defaultLineWidth:ot,ve.miterLimit=dt===void 0?defaultMiterLimit:dt,ve.strokeStyle=asColorLike(Ye.getColor()||defaultStrokeStyle)}ae=this.textState_;const Ke=Z.getFont()||defaultFont;registerFont(Ke);const Xe=Z.getScaleArray();ae.overflow=Z.getOverflow(),ae.font=Ke,ae.maxAngle=Z.getMaxAngle(),ae.placement=Z.getPlacement(),ae.textAlign=Z.getTextAlign(),ae.repeat=Z.getRepeat(),ae.justify=Z.getJustify(),ae.textBaseline=Z.getTextBaseline()||defaultTextBaseline,ae.backgroundFill=Z.getBackgroundFill(),ae.backgroundStroke=Z.getBackgroundStroke(),ae.padding=Z.getPadding()||defaultPadding,ae.scale=Xe===void 0?[1,1]:Xe;const Je=Z.getOffsetX(),rt=Z.getOffsetY(),nt=Z.getRotateWithView(),it=Z.getRotation();this.text_=Z.getText()||"",this.textOffsetX_=Je===void 0?0:Je,this.textOffsetY_=rt===void 0?0:rt,this.textRotateWithView_=nt===void 0?!1:nt,this.textRotation_=it===void 0?0:it,this.strokeKey_=ve?(typeof ve.strokeStyle=="string"?ve.strokeStyle:getUid(ve.strokeStyle))+ve.lineCap+ve.lineDashOffset+"|"+ve.lineWidth+ve.lineJoin+ve.miterLimit+"["+ve.lineDash.join()+"]":"",this.textKey_=ae.font+ae.scale+(ae.textAlign||"?")+(ae.repeat||"?")+(ae.justify||"?")+(ae.textBaseline||"?"),this.fillKey_=ye?typeof ye.fillStyle=="string"?ye.fillStyle:"|"+getUid(ye.fillStyle):""}this.declutterImageWithText_=ee}}const BATCH_CONSTRUCTORS={Circle:PolygonBuilder,Default:CanvasBuilder,Image:ImageBuilder,LineString:LineStringBuilder,Polygon:PolygonBuilder,Text:CanvasTextBuilder};class BuilderGroup{constructor(Z,ee,ae,ye){this.tolerance_=Z,this.maxExtent_=ee,this.pixelRatio_=ye,this.resolution_=ae,this.buildersByZIndex_={}}finish(){const Z={};for(const ee in this.buildersByZIndex_){Z[ee]=Z[ee]||{};const ae=this.buildersByZIndex_[ee];for(const ye in ae){const ve=ae[ye].finish();Z[ee][ye]=ve}}return Z}getBuilder(Z,ee){const ae=Z!==void 0?Z.toString():"0";let ye=this.buildersByZIndex_[ae];ye===void 0&&(ye={},this.buildersByZIndex_[ae]=ye);let ve=ye[ee];if(ve===void 0){const be=BATCH_CONSTRUCTORS[ee];ve=new be(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),ye[ee]=ve}return ve}}class LayerRenderer extends Observable{constructor(Z){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=Z,this.declutterExecutorGroup=null}getFeatures(Z){return abstract()}getData(Z){return null}prepareFrame(Z){return abstract()}renderFrame(Z,ee){return abstract()}loadedTileCallback(Z,ee,ae){Z[ee]||(Z[ee]={}),Z[ee][ae.tileCoord.toString()]=ae}createLoadedTileFinder(Z,ee,ae){return(ye,ve)=>{const be=this.loadedTileCallback.bind(this,ae,ye);return Z.forEachLoadedTile(ee,ye,ve,be)}}forEachFeatureAtCoordinate(Z,ee,ae,ye,ve){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(Z){const ee=Z.target;(ee.getState()===ImageState.LOADED||ee.getState()===ImageState.ERROR)&&this.renderIfReadyAndVisible()}loadImage(Z){let ee=Z.getState();return ee!=ImageState.LOADED&&ee!=ImageState.ERROR&&Z.addEventListener(EventType.CHANGE,this.boundHandleImageChange_),ee==ImageState.IDLE&&(Z.load(),ee=Z.getState()),ee==ImageState.LOADED}renderIfReadyAndVisible(){const Z=this.getLayer();Z&&Z.getVisible()&&Z.getSourceState()==="ready"&&Z.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}}class RenderEvent extends BaseEvent{constructor(Z,ee,ae,ye){super(Z),this.inversePixelTransform=ee,this.frameState=ae,this.context=ye}}let pixelContext$1=null;function createPixelContext$1(){pixelContext$1=createCanvasContext2D(1,1,void 0,{willReadFrequently:!0})}class CanvasLayerRenderer extends LayerRenderer{constructor(Z){super(Z),this.container=null,this.renderedResolution,this.tempTransform=create$2(),this.pixelTransform=create$2(),this.inversePixelTransform=create$2(),this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(Z,ee,ae){pixelContext$1||createPixelContext$1(),pixelContext$1.clearRect(0,0,1,1);let ye;try{pixelContext$1.drawImage(Z,ee,ae,1,1,0,0,1,1),ye=pixelContext$1.getImageData(0,0,1,1).data}catch{return pixelContext$1=null,null}return ye}getBackground(Z){let ee=this.getLayer().getBackground();return typeof ee=="function"&&(ee=ee(Z.viewState.resolution)),ee||void 0}useContainer(Z,ee,ae){const ye=this.getLayer().getClassName();let ve,be;if(Z&&Z.className===ye&&(!ae||Z&&Z.style.backgroundColor&&equals$2(asArray(Z.style.backgroundColor),asArray(ae)))){const Ye=Z.firstElementChild;Ye instanceof HTMLCanvasElement&&(be=Ye.getContext("2d"))}if(be&&be.canvas.style.transform===ee?(this.container=Z,this.context=be,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){ve=document.createElement("div"),ve.className=ye;let Ye=ve.style;Ye.position="absolute",Ye.width="100%",Ye.height="100%",be=createCanvasContext2D();const Ke=be.canvas;ve.appendChild(Ke),Ye=Ke.style,Ye.position="absolute",Ye.left="0",Ye.transformOrigin="top left",this.container=ve,this.context=be}!this.containerReused&&ae&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=ae)}clipUnrotated(Z,ee,ae){const ye=getTopLeft(ae),ve=getTopRight(ae),be=getBottomRight(ae),Ye=getBottomLeft(ae);apply(ee.coordinateToPixelTransform,ye),apply(ee.coordinateToPixelTransform,ve),apply(ee.coordinateToPixelTransform,be),apply(ee.coordinateToPixelTransform,Ye);const Ke=this.inversePixelTransform;apply(Ke,ye),apply(Ke,ve),apply(Ke,be),apply(Ke,Ye),Z.save(),Z.beginPath(),Z.moveTo(Math.round(ye[0]),Math.round(ye[1])),Z.lineTo(Math.round(ve[0]),Math.round(ve[1])),Z.lineTo(Math.round(be[0]),Math.round(be[1])),Z.lineTo(Math.round(Ye[0]),Math.round(Ye[1])),Z.clip()}dispatchRenderEvent_(Z,ee,ae){const ye=this.getLayer();if(ye.hasListener(Z)){const ve=new RenderEvent(Z,this.inversePixelTransform,ae,ee);ye.dispatchEvent(ve)}}preRender(Z,ee){this.frameState=ee,this.dispatchRenderEvent_(RenderEventType.PRERENDER,Z,ee)}postRender(Z,ee){this.dispatchRenderEvent_(RenderEventType.POSTRENDER,Z,ee)}getRenderTransform(Z,ee,ae,ye,ve,be,Ye){const Ke=ve/2,Xe=be/2,Je=ye/ee,rt=-Je,nt=-Z[0]+Ye,it=-Z[1];return compose$1(this.tempTransform,Ke,Xe,Je,rt,-ae,nt,it)}disposeInternal(){delete this.frameState,super.disposeInternal()}}function drawTextOnPath(ie,Z,ee,ae,ye,ve,be,Ye,Ke,Xe,Je,rt){let nt=ie[Z],it=ie[Z+1],lt=0,ct=0,ot=0,dt=0;function ft(){lt=nt,ct=it,Z+=ae,nt=ie[Z],it=ie[Z+1],dt+=ot,ot=Math.sqrt((nt-lt)*(nt-lt)+(it-ct)*(it-ct))}do ft();while(Z<ee-ae&&dt+ot<ve);let gt=ot===0?0:(ve-dt)/ot;const mt=lerp$1(lt,nt,gt),Yr=lerp$1(ct,it,gt),Qr=Z-ae,Xr=dt,Jr=ve+Ye*Ke(Xe,ye,Je);for(;Z<ee-ae&&dt+ot<Jr;)ft();gt=ot===0?0:(Jr-dt)/ot;const ai=lerp$1(lt,nt,gt),oi=lerp$1(ct,it,gt);let ni;if(rt){const hi=[mt,Yr,ai,oi];rotate$1(hi,0,4,2,rt,hi,hi),ni=hi[0]>hi[2]}else ni=mt>ai;const li=Math.PI,ui=[],mi=Qr+ae===Z;Z=Qr,ot=0,dt=Xr,nt=ie[Z],it=ie[Z+1];let ii;if(mi){ft(),ii=Math.atan2(it-ct,nt-lt),ni&&(ii+=ii>0?-li:li);const hi=(ai+mt)/2,ri=(oi+Yr)/2;return ui[0]=[hi,ri,(Jr-ve)/2,ii,ye],ui}ye=ye.replace(/\n/g," ");for(let hi=0,ri=ye.length;hi<ri;){ft();let ci=Math.atan2(it-ct,nt-lt);if(ni&&(ci+=ci>0?-li:li),ii!==void 0){let Ci=ci-ii;if(Ci+=Ci>li?-2*li:Ci<-li?2*li:0,Math.abs(Ci)>be)return null}ii=ci;const Si=hi;let si=0;for(;hi<ri;++hi){const Ci=ni?ri-hi-1:hi,Ri=Ye*Ke(Xe,ye[Ci],Je);if(Z+ae<ee&&dt+ot<ve+si+Ri/2)break;si+=Ri}if(hi===Si)continue;const Ei=ni?ye.substring(ri-Si,ri-hi):ye.substring(Si,hi);gt=ot===0?0:(ve+si/2-dt)/ot;const yi=lerp$1(lt,nt,gt),Mi=lerp$1(ct,it,gt);ui.push([yi,Mi,si/2,ci,Ei]),ve+=si}return ui}const tmpExtent=createEmpty(),p1=[],p2=[],p3=[],p4=[];function getDeclutterBox(ie){return ie[3].declutterBox}const rtlRegEx=new RegExp("[֑-ࣿיִ-﷿ﹰ-ﻼࠀ-࿿-]");function horizontalTextAlign(ie,Z){return Z==="start"?Z=rtlRegEx.test(ie)?"right":"left":Z==="end"&&(Z=rtlRegEx.test(ie)?"left":"right"),TEXT_ALIGN[Z]}function createTextChunks(ie,Z,ee){return ee>0&&ie.push(`
`,""),ie.push(Z,""),ie}class Executor{constructor(Z,ee,ae,ye){this.overlaps=ae,this.pixelRatio=ee,this.resolution=Z,this.alignFill_,this.instructions=ye.instructions,this.coordinates=ye.coordinates,this.coordinateCache_={},this.renderedTransform_=create$2(),this.hitDetectionInstructions=ye.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=ye.fillStates||{},this.strokeStates=ye.strokeStates||{},this.textStates=ye.textStates||{},this.widths_={},this.labels_={}}createLabel(Z,ee,ae,ye){const ve=Z+ee+ae+ye;if(this.labels_[ve])return this.labels_[ve];const be=ye?this.strokeStates[ye]:null,Ye=ae?this.fillStates[ae]:null,Ke=this.textStates[ee],Xe=this.pixelRatio,Je=[Ke.scale[0]*Xe,Ke.scale[1]*Xe],rt=Array.isArray(Z),nt=Ke.justify?TEXT_ALIGN[Ke.justify]:horizontalTextAlign(Array.isArray(Z)?Z[0]:Z,Ke.textAlign||defaultTextAlign),it=ye&&be.lineWidth?be.lineWidth:0,lt=rt?Z:Z.split(`
`).reduce(createTextChunks,[]),{width:ct,height:ot,widths:dt,heights:ft,lineWidths:gt}=getTextDimensions(Ke,lt),mt=ct+it,Yr=[],Qr=(mt+2)*Je[0],Xr=(ot+it)*Je[1],Jr={width:Qr<0?Math.floor(Qr):Math.ceil(Qr),height:Xr<0?Math.floor(Xr):Math.ceil(Xr),contextInstructions:Yr};(Je[0]!=1||Je[1]!=1)&&Yr.push("scale",Je),ye&&(Yr.push("strokeStyle",be.strokeStyle),Yr.push("lineWidth",it),Yr.push("lineCap",be.lineCap),Yr.push("lineJoin",be.lineJoin),Yr.push("miterLimit",be.miterLimit),Yr.push("setLineDash",[be.lineDash]),Yr.push("lineDashOffset",be.lineDashOffset)),ae&&Yr.push("fillStyle",Ye.fillStyle),Yr.push("textBaseline","middle"),Yr.push("textAlign","center");const ai=.5-nt;let oi=nt*mt+ai*it;const ni=[],li=[];let ui=0,mi=0,ii=0,hi=0,ri;for(let ci=0,Si=lt.length;ci<Si;ci+=2){const si=lt[ci];if(si===`
`){mi+=ui,ui=0,oi=nt*mt+ai*it,++hi;continue}const Ei=lt[ci+1]||Ke.font;Ei!==ri&&(ye&&ni.push("font",Ei),ae&&li.push("font",Ei),ri=Ei),ui=Math.max(ui,ft[ii]);const yi=[si,oi+ai*dt[ii]+nt*(dt[ii]-gt[hi]),.5*(it+ui)+mi];oi+=dt[ii],ye&&ni.push("strokeText",yi),ae&&li.push("fillText",yi),++ii}return Array.prototype.push.apply(Yr,ni),Array.prototype.push.apply(Yr,li),this.labels_[ve]=Jr,Jr}replayTextBackground_(Z,ee,ae,ye,ve,be,Ye){Z.beginPath(),Z.moveTo.apply(Z,ee),Z.lineTo.apply(Z,ae),Z.lineTo.apply(Z,ye),Z.lineTo.apply(Z,ve),Z.lineTo.apply(Z,ee),be&&(this.alignFill_=be[2],this.fill_(Z)),Ye&&(this.setStrokeStyle_(Z,Ye),Z.stroke())}calculateImageOrLabelDimensions_(Z,ee,ae,ye,ve,be,Ye,Ke,Xe,Je,rt,nt,it,lt,ct,ot){Ye*=nt[0],Ke*=nt[1];let dt=ae-Ye,ft=ye-Ke;const gt=ve+Xe>Z?Z-Xe:ve,mt=be+Je>ee?ee-Je:be,Yr=lt[3]+gt*nt[0]+lt[1],Qr=lt[0]+mt*nt[1]+lt[2],Xr=dt-lt[3],Jr=ft-lt[0];(ct||rt!==0)&&(p1[0]=Xr,p4[0]=Xr,p1[1]=Jr,p2[1]=Jr,p2[0]=Xr+Yr,p3[0]=p2[0],p3[1]=Jr+Qr,p4[1]=p3[1]);let ai;return rt!==0?(ai=compose$1(create$2(),ae,ye,1,1,rt,-ae,-ye),apply(ai,p1),apply(ai,p2),apply(ai,p3),apply(ai,p4),createOrUpdate$2(Math.min(p1[0],p2[0],p3[0],p4[0]),Math.min(p1[1],p2[1],p3[1],p4[1]),Math.max(p1[0],p2[0],p3[0],p4[0]),Math.max(p1[1],p2[1],p3[1],p4[1]),tmpExtent)):createOrUpdate$2(Math.min(Xr,Xr+Yr),Math.min(Jr,Jr+Qr),Math.max(Xr,Xr+Yr),Math.max(Jr,Jr+Qr),tmpExtent),it&&(dt=Math.round(dt),ft=Math.round(ft)),{drawImageX:dt,drawImageY:ft,drawImageW:gt,drawImageH:mt,originX:Xe,originY:Je,declutterBox:{minX:tmpExtent[0],minY:tmpExtent[1],maxX:tmpExtent[2],maxY:tmpExtent[3],value:ot},canvasTransform:ai,scale:nt}}replayImageOrLabel_(Z,ee,ae,ye,ve,be,Ye){const Ke=!!(be||Ye),Xe=ye.declutterBox,Je=Z.canvas,rt=Ye?Ye[2]*ye.scale[0]/2:0;return Xe.minX-rt<=Je.width/ee&&Xe.maxX+rt>=0&&Xe.minY-rt<=Je.height/ee&&Xe.maxY+rt>=0&&(Ke&&this.replayTextBackground_(Z,p1,p2,p3,p4,be,Ye),drawImageOrLabel(Z,ye.canvasTransform,ve,ae,ye.originX,ye.originY,ye.drawImageW,ye.drawImageH,ye.drawImageX,ye.drawImageY,ye.scale)),!0}fill_(Z){if(this.alignFill_){const ee=apply(this.renderedTransform_,[0,0]),ae=512*this.pixelRatio;Z.save(),Z.translate(ee[0]%ae,ee[1]%ae),Z.rotate(this.viewRotation_)}Z.fill(),this.alignFill_&&Z.restore()}setStrokeStyle_(Z,ee){Z.strokeStyle=ee[1],Z.lineWidth=ee[2],Z.lineCap=ee[3],Z.lineJoin=ee[4],Z.miterLimit=ee[5],Z.lineDashOffset=ee[7],Z.setLineDash(ee[6])}drawLabelWithPointPlacement_(Z,ee,ae,ye){const ve=this.textStates[ee],be=this.createLabel(Z,ee,ye,ae),Ye=this.strokeStates[ae],Ke=this.pixelRatio,Xe=horizontalTextAlign(Array.isArray(Z)?Z[0]:Z,ve.textAlign||defaultTextAlign),Je=TEXT_ALIGN[ve.textBaseline||defaultTextBaseline],rt=Ye&&Ye.lineWidth?Ye.lineWidth:0,nt=be.width/Ke-2*ve.scale[0],it=Xe*nt+2*(.5-Xe)*rt,lt=Je*be.height/Ke+2*(.5-Je)*rt;return{label:be,anchorX:it,anchorY:lt}}execute_(Z,ee,ae,ye,ve,be,Ye,Ke){let Xe;this.pixelCoordinates_&&equals$2(ae,this.renderedTransform_)?Xe=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),Xe=transform2D(this.coordinates,0,this.coordinates.length,2,ae,this.pixelCoordinates_),setFromArray(this.renderedTransform_,ae));let Je=0;const rt=ye.length;let nt=0,it,lt,ct,ot,dt,ft,gt,mt,Yr,Qr,Xr,Jr,ai=0,oi=0,ni=null,li=null;const ui=this.coordinateCache_,mi=this.viewRotation_,ii=Math.round(Math.atan2(-ae[1],ae[0])*1e12)/1e12,hi={context:Z,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:mi},ri=this.instructions!=ye||this.overlaps?0:200;let ci,Si,si,Ei;for(;Je<rt;){const yi=ye[Je];switch(yi[0]){case Instruction.BEGIN_GEOMETRY:ci=yi[1],Ei=yi[3],ci.getGeometry()?Ye!==void 0&&!intersects$1(Ye,Ei.getExtent())?Je=yi[2]+1:++Je:Je=yi[2];break;case Instruction.BEGIN_PATH:ai>ri&&(this.fill_(Z),ai=0),oi>ri&&(Z.stroke(),oi=0),!ai&&!oi&&(Z.beginPath(),ot=NaN,dt=NaN),++Je;break;case Instruction.CIRCLE:nt=yi[1];const Mi=Xe[nt],Ci=Xe[nt+1],Ri=Xe[nt+2],Ni=Xe[nt+3],Ai=Ri-Mi,ki=Ni-Ci,Yi=Math.sqrt(Ai*Ai+ki*ki);Z.moveTo(Mi+Yi,Ci),Z.arc(Mi,Ci,Yi,0,2*Math.PI,!0),++Je;break;case Instruction.CLOSE_PATH:Z.closePath(),++Je;break;case Instruction.CUSTOM:nt=yi[1],it=yi[2];const Ji=yi[3],ls=yi[4],hs=yi.length==6?yi[5]:void 0;hi.geometry=Ji,hi.feature=ci,Je in ui||(ui[Je]=[]);const Kr=ui[Je];hs?hs(Xe,nt,it,2,Kr):(Kr[0]=Xe[nt],Kr[1]=Xe[nt+1],Kr.length=2),ls(Kr,hi),++Je;break;case Instruction.DRAW_IMAGE:nt=yi[1],it=yi[2],mt=yi[3],lt=yi[4],ct=yi[5];let di=yi[6];const wi=yi[7],Ii=yi[8],Di=yi[9],is=yi[10];let Gi=yi[11];const us=yi[12];let Zi=yi[13];const ns=yi[14],Ki=yi[15];if(!mt&&yi.length>=20){Yr=yi[19],Qr=yi[20],Xr=yi[21],Jr=yi[22];const Qi=this.drawLabelWithPointPlacement_(Yr,Qr,Xr,Jr);mt=Qi.label,yi[3]=mt;const ss=yi[23];lt=(Qi.anchorX-ss)*this.pixelRatio,yi[4]=lt;const cs=yi[24];ct=(Qi.anchorY-cs)*this.pixelRatio,yi[5]=ct,di=mt.height,yi[6]=di,Zi=mt.width,yi[13]=Zi}let ds;yi.length>25&&(ds=yi[25]);let as,ms,vs;yi.length>17?(as=yi[16],ms=yi[17],vs=yi[18]):(as=defaultPadding,ms=!1,vs=!1),is&&ii?Gi+=mi:!is&&!ii&&(Gi-=mi);let zs=0;for(;nt<it;nt+=2){if(ds&&ds[zs++]<Zi/this.pixelRatio)continue;const Qi=this.calculateImageOrLabelDimensions_(mt.width,mt.height,Xe[nt],Xe[nt+1],Zi,di,lt,ct,Ii,Di,Gi,us,ve,as,ms||vs,ci),ss=[Z,ee,mt,Qi,wi,ms?ni:null,vs?li:null];if(Ke){if(ns==="none")continue;if(ns==="obstacle"){Ke.insert(Qi.declutterBox);continue}else{let cs,Xi;if(Ki){const _s=it-nt;if(!Ki[_s]){Ki[_s]=ss;continue}if(cs=Ki[_s],delete Ki[_s],Xi=getDeclutterBox(cs),Ke.collides(Xi))continue}if(Ke.collides(Qi.declutterBox))continue;cs&&(Ke.insert(Xi),this.replayImageOrLabel_.apply(this,cs)),Ke.insert(Qi.declutterBox)}}this.replayImageOrLabel_.apply(this,ss)}++Je;break;case Instruction.DRAW_CHARS:const Zs=yi[1],Ts=yi[2],go=yi[3],Ha=yi[4];Jr=yi[5];const na=yi[6],No=yi[7],ei=yi[8];Xr=yi[9];const Zr=yi[10];Yr=yi[11],Qr=yi[12];const pi=[yi[13],yi[13]],gi=this.textStates[Qr],$i=gi.font,Vi=[gi.scale[0]*No,gi.scale[1]*No];let Bi;$i in this.widths_?Bi=this.widths_[$i]:(Bi={},this.widths_[$i]=Bi);const Ui=lineStringLength(Xe,Zs,Ts,2),es=Math.abs(Vi[0])*measureAndCacheTextWidth($i,Yr,Bi);if(Ha||es<=Ui){const Qi=this.textStates[Qr].textAlign,ss=(Ui-es)*horizontalTextAlign(Yr,Qi),cs=drawTextOnPath(Xe,Zs,Ts,2,Yr,ss,na,Math.abs(Vi[0]),measureAndCacheTextWidth,$i,Bi,ii?0:this.viewRotation_);e:if(cs){const Xi=[];let _s,eo,Ys,Ps,Os;if(Xr)for(_s=0,eo=cs.length;_s<eo;++_s){Os=cs[_s],Ys=Os[4],Ps=this.createLabel(Ys,Qr,"",Xr),lt=Os[2]+(Vi[0]<0?-Zr:Zr),ct=go*Ps.height+(.5-go)*2*Zr*Vi[1]/Vi[0]-ei;const mo=this.calculateImageOrLabelDimensions_(Ps.width,Ps.height,Os[0],Os[1],Ps.width,Ps.height,lt,ct,0,0,Os[3],pi,!1,defaultPadding,!1,ci);if(Ke&&Ke.collides(mo.declutterBox))break e;Xi.push([Z,ee,Ps,mo,1,null,null])}if(Jr)for(_s=0,eo=cs.length;_s<eo;++_s){Os=cs[_s],Ys=Os[4],Ps=this.createLabel(Ys,Qr,Jr,""),lt=Os[2],ct=go*Ps.height-ei;const mo=this.calculateImageOrLabelDimensions_(Ps.width,Ps.height,Os[0],Os[1],Ps.width,Ps.height,lt,ct,0,0,Os[3],pi,!1,defaultPadding,!1,ci);if(Ke&&Ke.collides(mo.declutterBox))break e;Xi.push([Z,ee,Ps,mo,1,null,null])}Ke&&Ke.load(Xi.map(getDeclutterBox));for(let mo=0,ia=Xi.length;mo<ia;++mo)this.replayImageOrLabel_.apply(this,Xi[mo])}}++Je;break;case Instruction.END_GEOMETRY:if(be!==void 0){ci=yi[1];const Qi=be(ci,Ei);if(Qi)return Qi}++Je;break;case Instruction.FILL:ri?ai++:this.fill_(Z),++Je;break;case Instruction.MOVE_TO_LINE_TO:for(nt=yi[1],it=yi[2],Si=Xe[nt],si=Xe[nt+1],ft=Si+.5|0,gt=si+.5|0,(ft!==ot||gt!==dt)&&(Z.moveTo(Si,si),ot=ft,dt=gt),nt+=2;nt<it;nt+=2)Si=Xe[nt],si=Xe[nt+1],ft=Si+.5|0,gt=si+.5|0,(nt==it-2||ft!==ot||gt!==dt)&&(Z.lineTo(Si,si),ot=ft,dt=gt);++Je;break;case Instruction.SET_FILL_STYLE:ni=yi,this.alignFill_=yi[2],ai&&(this.fill_(Z),ai=0,oi&&(Z.stroke(),oi=0)),Z.fillStyle=yi[1],++Je;break;case Instruction.SET_STROKE_STYLE:li=yi,oi&&(Z.stroke(),oi=0),this.setStrokeStyle_(Z,yi),++Je;break;case Instruction.STROKE:ri?oi++:Z.stroke(),++Je;break;default:++Je;break}}ai&&this.fill_(Z),oi&&Z.stroke()}execute(Z,ee,ae,ye,ve,be){this.viewRotation_=ye,this.execute_(Z,ee,ae,this.instructions,ve,void 0,void 0,be)}executeHitDetection(Z,ee,ae,ye,ve){return this.viewRotation_=ae,this.execute_(Z,1,ee,this.hitDetectionInstructions,!0,ye,ve)}}const ORDER=["Polygon","Circle","LineString","Image","Text","Default"];class ExecutorGroup{constructor(Z,ee,ae,ye,ve,be){this.maxExtent_=Z,this.overlaps_=ye,this.pixelRatio_=ae,this.resolution_=ee,this.renderBuffer_=be,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=create$2(),this.createExecutors_(ve)}clip(Z,ee){const ae=this.getClipCoords(ee);Z.beginPath(),Z.moveTo(ae[0],ae[1]),Z.lineTo(ae[2],ae[3]),Z.lineTo(ae[4],ae[5]),Z.lineTo(ae[6],ae[7]),Z.clip()}createExecutors_(Z){for(const ee in Z){let ae=this.executorsByZIndex_[ee];ae===void 0&&(ae={},this.executorsByZIndex_[ee]=ae);const ye=Z[ee];for(const ve in ye){const be=ye[ve];ae[ve]=new Executor(this.resolution_,this.pixelRatio_,this.overlaps_,be)}}}hasExecutors(Z){for(const ee in this.executorsByZIndex_){const ae=this.executorsByZIndex_[ee];for(let ye=0,ve=Z.length;ye<ve;++ye)if(Z[ye]in ae)return!0}return!1}forEachFeatureAtCoordinate(Z,ee,ae,ye,ve,be){ye=Math.round(ye);const Ye=ye*2+1,Ke=compose$1(this.hitDetectionTransform_,ye+.5,ye+.5,1/ee,-1/ee,-ae,-Z[0],-Z[1]),Xe=!this.hitDetectionContext_;Xe&&(this.hitDetectionContext_=createCanvasContext2D(Ye,Ye,void 0,{willReadFrequently:!0}));const Je=this.hitDetectionContext_;Je.canvas.width!==Ye||Je.canvas.height!==Ye?(Je.canvas.width=Ye,Je.canvas.height=Ye):Xe||Je.clearRect(0,0,Ye,Ye);let rt;this.renderBuffer_!==void 0&&(rt=createEmpty(),extendCoordinate(rt,Z),buffer$1(rt,ee*(this.renderBuffer_+ye),rt));const nt=getPixelIndexArray(ye);let it;function lt(Yr,Qr){const Xr=Je.getImageData(0,0,Ye,Ye).data;for(let Jr=0,ai=nt.length;Jr<ai;Jr++)if(Xr[nt[Jr]]>0){if(!be||it!=="Image"&&it!=="Text"||be.includes(Yr)){const oi=(nt[Jr]-3)/4,ni=ye-oi%Ye,li=ye-(oi/Ye|0),ui=ve(Yr,Qr,ni*ni+li*li);if(ui)return ui}Je.clearRect(0,0,Ye,Ye);break}}const ct=Object.keys(this.executorsByZIndex_).map(Number);ct.sort(ascending);let ot,dt,ft,gt,mt;for(ot=ct.length-1;ot>=0;--ot){const Yr=ct[ot].toString();for(ft=this.executorsByZIndex_[Yr],dt=ORDER.length-1;dt>=0;--dt)if(it=ORDER[dt],gt=ft[it],gt!==void 0&&(mt=gt.executeHitDetection(Je,Ke,ae,lt,rt),mt))return mt}}getClipCoords(Z){const ee=this.maxExtent_;if(!ee)return null;const ae=ee[0],ye=ee[1],ve=ee[2],be=ee[3],Ye=[ae,ye,ae,be,ve,be,ve,ye];return transform2D(Ye,0,8,2,Z,Ye),Ye}isEmpty(){return isEmpty$1(this.executorsByZIndex_)}execute(Z,ee,ae,ye,ve,be,Ye){const Ke=Object.keys(this.executorsByZIndex_).map(Number);Ke.sort(ascending),this.maxExtent_&&(Z.save(),this.clip(Z,ae)),be=be||ORDER;let Xe,Je,rt,nt,it,lt;for(Ye&&Ke.reverse(),Xe=0,Je=Ke.length;Xe<Je;++Xe){const ct=Ke[Xe].toString();for(it=this.executorsByZIndex_[ct],rt=0,nt=be.length;rt<nt;++rt){const ot=be[rt];lt=it[ot],lt!==void 0&&lt.execute(Z,ee,ae,ye,ve,Ye)}}this.maxExtent_&&Z.restore()}}const circlePixelIndexArrayCache={};function getPixelIndexArray(ie){if(circlePixelIndexArrayCache[ie]!==void 0)return circlePixelIndexArrayCache[ie];const Z=ie*2+1,ee=ie*ie,ae=new Array(ee+1);for(let ve=0;ve<=ie;++ve)for(let be=0;be<=ie;++be){const Ye=ve*ve+be*be;if(Ye>ee)break;let Ke=ae[Ye];Ke||(Ke=[],ae[Ye]=Ke),Ke.push(((ie+ve)*Z+(ie+be))*4+3),ve>0&&Ke.push(((ie-ve)*Z+(ie+be))*4+3),be>0&&(Ke.push(((ie+ve)*Z+(ie-be))*4+3),ve>0&&Ke.push(((ie-ve)*Z+(ie-be))*4+3))}const ye=[];for(let ve=0,be=ae.length;ve<be;++ve)ae[ve]&&ye.push(...ae[ve]);return circlePixelIndexArrayCache[ie]=ye,ye}class CanvasImmediateRenderer extends VectorContext{constructor(Z,ee,ae,ye,ve,be,Ye){super(),this.context_=Z,this.pixelRatio_=ee,this.extent_=ae,this.transform_=ye,this.transformRotation_=ye?toFixed(Math.atan2(ye[1],ye[0]),10):0,this.viewRotation_=ve,this.squaredTolerance_=be,this.userTransform_=Ye,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=create$2()}drawImages_(Z,ee,ae,ye){if(!this.image_)return;const ve=transform2D(Z,ee,ae,ye,this.transform_,this.pixelCoordinates_),be=this.context_,Ye=this.tmpLocalTransform_,Ke=be.globalAlpha;this.imageOpacity_!=1&&(be.globalAlpha=Ke*this.imageOpacity_);let Xe=this.imageRotation_;this.transformRotation_===0&&(Xe-=this.viewRotation_),this.imageRotateWithView_&&(Xe+=this.viewRotation_);for(let Je=0,rt=ve.length;Je<rt;Je+=2){const nt=ve[Je]-this.imageAnchorX_,it=ve[Je+1]-this.imageAnchorY_;if(Xe!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const lt=nt+this.imageAnchorX_,ct=it+this.imageAnchorY_;compose$1(Ye,lt,ct,1,1,Xe,-lt,-ct),be.save(),be.transform.apply(be,Ye),be.translate(lt,ct),be.scale(this.imageScale_[0],this.imageScale_[1]),be.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),be.restore()}else be.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,nt,it,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(be.globalAlpha=Ke)}drawText_(Z,ee,ae,ye){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const ve=transform2D(Z,ee,ae,ye,this.transform_,this.pixelCoordinates_),be=this.context_;let Ye=this.textRotation_;for(this.transformRotation_===0&&(Ye-=this.viewRotation_),this.textRotateWithView_&&(Ye+=this.viewRotation_);ee<ae;ee+=ye){const Ke=ve[ee]+this.textOffsetX_,Xe=ve[ee+1]+this.textOffsetY_;Ye!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(be.save(),be.translate(Ke-this.textOffsetX_,Xe-this.textOffsetY_),be.rotate(Ye),be.translate(this.textOffsetX_,this.textOffsetY_),be.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&be.strokeText(this.text_,0,0),this.textFillState_&&be.fillText(this.text_,0,0),be.restore()):(this.textStrokeState_&&be.strokeText(this.text_,Ke,Xe),this.textFillState_&&be.fillText(this.text_,Ke,Xe))}}moveToLineTo_(Z,ee,ae,ye,ve){const be=this.context_,Ye=transform2D(Z,ee,ae,ye,this.transform_,this.pixelCoordinates_);be.moveTo(Ye[0],Ye[1]);let Ke=Ye.length;ve&&(Ke-=2);for(let Xe=2;Xe<Ke;Xe+=2)be.lineTo(Ye[Xe],Ye[Xe+1]);return ve&&be.closePath(),ae}drawRings_(Z,ee,ae,ye){for(let ve=0,be=ae.length;ve<be;++ve)ee=this.moveToLineTo_(Z,ee,ae[ve],ye,!0);return ee}drawCircle(Z){if(this.squaredTolerance_&&(Z=Z.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!intersects$1(this.extent_,Z.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const ee=transformGeom2D(Z,this.transform_,this.pixelCoordinates_),ae=ee[2]-ee[0],ye=ee[3]-ee[1],ve=Math.sqrt(ae*ae+ye*ye),be=this.context_;be.beginPath(),be.arc(ee[0],ee[1],ve,0,2*Math.PI),this.fillState_&&be.fill(),this.strokeState_&&be.stroke()}this.text_!==""&&this.drawText_(Z.getCenter(),0,2,2)}}setStyle(Z){this.setFillStrokeStyle(Z.getFill(),Z.getStroke()),this.setImageStyle(Z.getImage()),this.setTextStyle(Z.getText())}setTransform(Z){this.transform_=Z}drawGeometry(Z){switch(Z.getType()){case"Point":this.drawPoint(Z);break;case"LineString":this.drawLineString(Z);break;case"Polygon":this.drawPolygon(Z);break;case"MultiPoint":this.drawMultiPoint(Z);break;case"MultiLineString":this.drawMultiLineString(Z);break;case"MultiPolygon":this.drawMultiPolygon(Z);break;case"GeometryCollection":this.drawGeometryCollection(Z);break;case"Circle":this.drawCircle(Z);break}}drawFeature(Z,ee){const ae=ee.getGeometryFunction()(Z);ae&&(this.setStyle(ee),this.drawGeometry(ae))}drawGeometryCollection(Z){const ee=Z.getGeometriesArray();for(let ae=0,ye=ee.length;ae<ye;++ae)this.drawGeometry(ee[ae])}drawPoint(Z){this.squaredTolerance_&&(Z=Z.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const ee=Z.getFlatCoordinates(),ae=Z.getStride();this.image_&&this.drawImages_(ee,0,ee.length,ae),this.text_!==""&&this.drawText_(ee,0,ee.length,ae)}drawMultiPoint(Z){this.squaredTolerance_&&(Z=Z.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const ee=Z.getFlatCoordinates(),ae=Z.getStride();this.image_&&this.drawImages_(ee,0,ee.length,ae),this.text_!==""&&this.drawText_(ee,0,ee.length,ae)}drawLineString(Z){if(this.squaredTolerance_&&(Z=Z.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!intersects$1(this.extent_,Z.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const ee=this.context_,ae=Z.getFlatCoordinates();ee.beginPath(),this.moveToLineTo_(ae,0,ae.length,Z.getStride(),!1),ee.stroke()}if(this.text_!==""){const ee=Z.getFlatMidpoint();this.drawText_(ee,0,2,2)}}}drawMultiLineString(Z){this.squaredTolerance_&&(Z=Z.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const ee=Z.getExtent();if(intersects$1(this.extent_,ee)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const ae=this.context_,ye=Z.getFlatCoordinates();let ve=0;const be=Z.getEnds(),Ye=Z.getStride();ae.beginPath();for(let Ke=0,Xe=be.length;Ke<Xe;++Ke)ve=this.moveToLineTo_(ye,ve,be[Ke],Ye,!1);ae.stroke()}if(this.text_!==""){const ae=Z.getFlatMidpoints();this.drawText_(ae,0,ae.length,2)}}}drawPolygon(Z){if(this.squaredTolerance_&&(Z=Z.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!intersects$1(this.extent_,Z.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const ee=this.context_;ee.beginPath(),this.drawRings_(Z.getOrientedFlatCoordinates(),0,Z.getEnds(),Z.getStride()),this.fillState_&&ee.fill(),this.strokeState_&&ee.stroke()}if(this.text_!==""){const ee=Z.getFlatInteriorPoint();this.drawText_(ee,0,2,2)}}}drawMultiPolygon(Z){if(this.squaredTolerance_&&(Z=Z.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!intersects$1(this.extent_,Z.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const ee=this.context_,ae=Z.getOrientedFlatCoordinates();let ye=0;const ve=Z.getEndss(),be=Z.getStride();ee.beginPath();for(let Ye=0,Ke=ve.length;Ye<Ke;++Ye){const Xe=ve[Ye];ye=this.drawRings_(ae,ye,Xe,be)}this.fillState_&&ee.fill(),this.strokeState_&&ee.stroke()}if(this.text_!==""){const ee=Z.getFlatInteriorPoints();this.drawText_(ee,0,ee.length,2)}}}setContextFillState_(Z){const ee=this.context_,ae=this.contextFillState_;ae?ae.fillStyle!=Z.fillStyle&&(ae.fillStyle=Z.fillStyle,ee.fillStyle=Z.fillStyle):(ee.fillStyle=Z.fillStyle,this.contextFillState_={fillStyle:Z.fillStyle})}setContextStrokeState_(Z){const ee=this.context_,ae=this.contextStrokeState_;ae?(ae.lineCap!=Z.lineCap&&(ae.lineCap=Z.lineCap,ee.lineCap=Z.lineCap),equals$2(ae.lineDash,Z.lineDash)||ee.setLineDash(ae.lineDash=Z.lineDash),ae.lineDashOffset!=Z.lineDashOffset&&(ae.lineDashOffset=Z.lineDashOffset,ee.lineDashOffset=Z.lineDashOffset),ae.lineJoin!=Z.lineJoin&&(ae.lineJoin=Z.lineJoin,ee.lineJoin=Z.lineJoin),ae.lineWidth!=Z.lineWidth&&(ae.lineWidth=Z.lineWidth,ee.lineWidth=Z.lineWidth),ae.miterLimit!=Z.miterLimit&&(ae.miterLimit=Z.miterLimit,ee.miterLimit=Z.miterLimit),ae.strokeStyle!=Z.strokeStyle&&(ae.strokeStyle=Z.strokeStyle,ee.strokeStyle=Z.strokeStyle)):(ee.lineCap=Z.lineCap,ee.setLineDash(Z.lineDash),ee.lineDashOffset=Z.lineDashOffset,ee.lineJoin=Z.lineJoin,ee.lineWidth=Z.lineWidth,ee.miterLimit=Z.miterLimit,ee.strokeStyle=Z.strokeStyle,this.contextStrokeState_={lineCap:Z.lineCap,lineDash:Z.lineDash,lineDashOffset:Z.lineDashOffset,lineJoin:Z.lineJoin,lineWidth:Z.lineWidth,miterLimit:Z.miterLimit,strokeStyle:Z.strokeStyle})}setContextTextState_(Z){const ee=this.context_,ae=this.contextTextState_,ye=Z.textAlign?Z.textAlign:defaultTextAlign;ae?(ae.font!=Z.font&&(ae.font=Z.font,ee.font=Z.font),ae.textAlign!=ye&&(ae.textAlign=ye,ee.textAlign=ye),ae.textBaseline!=Z.textBaseline&&(ae.textBaseline=Z.textBaseline,ee.textBaseline=Z.textBaseline)):(ee.font=Z.font,ee.textAlign=ye,ee.textBaseline=Z.textBaseline,this.contextTextState_={font:Z.font,textAlign:ye,textBaseline:Z.textBaseline})}setFillStrokeStyle(Z,ee){if(!Z)this.fillState_=null;else{const ae=Z.getColor();this.fillState_={fillStyle:asColorLike(ae||defaultFillStyle)}}if(!ee)this.strokeState_=null;else{const ae=ee.getColor(),ye=ee.getLineCap(),ve=ee.getLineDash(),be=ee.getLineDashOffset(),Ye=ee.getLineJoin(),Ke=ee.getWidth(),Xe=ee.getMiterLimit(),Je=ve||defaultLineDash;this.strokeState_={lineCap:ye!==void 0?ye:defaultLineCap,lineDash:this.pixelRatio_===1?Je:Je.map(rt=>rt*this.pixelRatio_),lineDashOffset:(be||defaultLineDashOffset)*this.pixelRatio_,lineJoin:Ye!==void 0?Ye:defaultLineJoin,lineWidth:(Ke!==void 0?Ke:defaultLineWidth)*this.pixelRatio_,miterLimit:Xe!==void 0?Xe:defaultMiterLimit,strokeStyle:asColorLike(ae||defaultStrokeStyle)}}}setImageStyle(Z){let ee;if(!Z||!(ee=Z.getSize())){this.image_=null;return}const ae=Z.getPixelRatio(this.pixelRatio_),ye=Z.getAnchor(),ve=Z.getOrigin();this.image_=Z.getImage(this.pixelRatio_),this.imageAnchorX_=ye[0]*ae,this.imageAnchorY_=ye[1]*ae,this.imageHeight_=ee[1]*ae,this.imageOpacity_=Z.getOpacity(),this.imageOriginX_=ve[0],this.imageOriginY_=ve[1],this.imageRotateWithView_=Z.getRotateWithView(),this.imageRotation_=Z.getRotation();const be=Z.getScaleArray();this.imageScale_=[be[0]*this.pixelRatio_/ae,be[1]*this.pixelRatio_/ae],this.imageWidth_=ee[0]*ae}setTextStyle(Z){if(!Z)this.text_="";else{const ee=Z.getFill();if(!ee)this.textFillState_=null;else{const it=ee.getColor();this.textFillState_={fillStyle:asColorLike(it||defaultFillStyle)}}const ae=Z.getStroke();if(!ae)this.textStrokeState_=null;else{const it=ae.getColor(),lt=ae.getLineCap(),ct=ae.getLineDash(),ot=ae.getLineDashOffset(),dt=ae.getLineJoin(),ft=ae.getWidth(),gt=ae.getMiterLimit();this.textStrokeState_={lineCap:lt!==void 0?lt:defaultLineCap,lineDash:ct||defaultLineDash,lineDashOffset:ot||defaultLineDashOffset,lineJoin:dt!==void 0?dt:defaultLineJoin,lineWidth:ft!==void 0?ft:defaultLineWidth,miterLimit:gt!==void 0?gt:defaultMiterLimit,strokeStyle:asColorLike(it||defaultStrokeStyle)}}const ye=Z.getFont(),ve=Z.getOffsetX(),be=Z.getOffsetY(),Ye=Z.getRotateWithView(),Ke=Z.getRotation(),Xe=Z.getScaleArray(),Je=Z.getText(),rt=Z.getTextAlign(),nt=Z.getTextBaseline();this.textState_={font:ye!==void 0?ye:defaultFont,textAlign:rt!==void 0?rt:defaultTextAlign,textBaseline:nt!==void 0?nt:defaultTextBaseline},this.text_=Je!==void 0?Array.isArray(Je)?Je.reduce((it,lt,ct)=>it+=ct%2?" ":lt,""):Je:"",this.textOffsetX_=ve!==void 0?this.pixelRatio_*ve:0,this.textOffsetY_=be!==void 0?this.pixelRatio_*be:0,this.textRotateWithView_=Ye!==void 0?Ye:!1,this.textRotation_=Ke!==void 0?Ke:0,this.textScale_=[this.pixelRatio_*Xe[0],this.pixelRatio_*Xe[1]]}}}const HIT_DETECT_RESOLUTION=.5;function createHitDetectionImageData(ie,Z,ee,ae,ye,ve,be){const Ye=ie[0]*HIT_DETECT_RESOLUTION,Ke=ie[1]*HIT_DETECT_RESOLUTION,Xe=createCanvasContext2D(Ye,Ke);Xe.imageSmoothingEnabled=!1;const Je=Xe.canvas,rt=new CanvasImmediateRenderer(Xe,HIT_DETECT_RESOLUTION,ye,null,be),nt=ee.length,it=Math.floor((256*256*256-1)/nt),lt={};for(let ot=1;ot<=nt;++ot){const dt=ee[ot-1],ft=dt.getStyleFunction()||ae;if(!ft)continue;let gt=ft(dt,ve);if(!gt)continue;Array.isArray(gt)||(gt=[gt]);const mt=(ot*it).toString(16).padStart(7,"#00000");for(let Yr=0,Qr=gt.length;Yr<Qr;++Yr){const Xr=gt[Yr],Jr=Xr.getGeometryFunction()(dt);if(!Jr||!intersects$1(ye,Jr.getExtent()))continue;const ai=Xr.clone(),oi=ai.getFill();oi&&oi.setColor(mt);const ni=ai.getStroke();ni&&(ni.setColor(mt),ni.setLineDash(null)),ai.setText(void 0);const li=Xr.getImage();if(li){const hi=li.getImageSize();if(!hi)continue;const ri=createCanvasContext2D(hi[0],hi[1],void 0,{alpha:!1}),ci=ri.canvas;ri.fillStyle=mt,ri.fillRect(0,0,ci.width,ci.height),ai.setImage(new Icon({img:ci,anchor:li.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:li.getOrigin(),opacity:1,size:li.getSize(),scale:li.getScale(),rotation:li.getRotation(),rotateWithView:li.getRotateWithView()}))}const ui=ai.getZIndex()||0;let mi=lt[ui];mi||(mi={},lt[ui]=mi,mi.Polygon=[],mi.Circle=[],mi.LineString=[],mi.Point=[]);const ii=Jr.getType();if(ii==="GeometryCollection"){const hi=Jr.getGeometriesArrayRecursive();for(let ri=0,ci=hi.length;ri<ci;++ri){const Si=hi[ri];mi[Si.getType().replace("Multi","")].push(Si,ai)}}else mi[ii.replace("Multi","")].push(Jr,ai)}}const ct=Object.keys(lt).map(Number).sort(ascending);for(let ot=0,dt=ct.length;ot<dt;++ot){const ft=lt[ct[ot]];for(const gt in ft){const mt=ft[gt];for(let Yr=0,Qr=mt.length;Yr<Qr;Yr+=2){rt.setStyle(mt[Yr+1]);for(let Xr=0,Jr=Z.length;Xr<Jr;++Xr)rt.setTransform(Z[Xr]),rt.drawGeometry(mt[Yr])}}}return Xe.getImageData(0,0,Je.width,Je.height)}function hitDetect(ie,Z,ee){const ae=[];if(ee){const ye=Math.floor(Math.round(ie[0])*HIT_DETECT_RESOLUTION),ve=Math.floor(Math.round(ie[1])*HIT_DETECT_RESOLUTION),be=(clamp$1(ye,0,ee.width-1)+clamp$1(ve,0,ee.height-1)*ee.width)*4,Ye=ee.data[be],Ke=ee.data[be+1],Xe=ee.data[be+2]+256*(Ke+256*Ye),Je=Math.floor((256*256*256-1)/Z.length);Xe&&Xe%Je===0&&ae.push(Z[Xe/Je-1])}return ae}const SIMPLIFY_TOLERANCE=.5,GEOMETRY_RENDERERS={Point:renderPointGeometry,LineString:renderLineStringGeometry,Polygon:renderPolygonGeometry,MultiPoint:renderMultiPointGeometry,MultiLineString:renderMultiLineStringGeometry,MultiPolygon:renderMultiPolygonGeometry,GeometryCollection:renderGeometryCollectionGeometry,Circle:renderCircleGeometry};function getSquaredTolerance(ie,Z){const ee=getTolerance(ie,Z);return ee*ee}function getTolerance(ie,Z){return SIMPLIFY_TOLERANCE*ie/Z}function renderCircleGeometry(ie,Z,ee,ae,ye){const ve=ee.getFill(),be=ee.getStroke();if(ve||be){const Ke=ie.getBuilder(ee.getZIndex(),"Circle");Ke.setFillStrokeStyle(ve,be),Ke.drawCircle(Z,ae)}const Ye=ee.getText();if(Ye&&Ye.getText()){const Ke=(ye||ie).getBuilder(ee.getZIndex(),"Text");Ke.setTextStyle(Ye),Ke.drawText(Z,ae)}}function renderFeature(ie,Z,ee,ae,ye,ve,be){let Ye=!1;const Ke=ee.getImage();if(Ke){const Xe=Ke.getImageState();Xe==ImageState.LOADED||Xe==ImageState.ERROR?Ke.unlistenImageChange(ye):(Xe==ImageState.IDLE&&Ke.load(),Ke.listenImageChange(ye),Ye=!0)}return renderFeatureInternal(ie,Z,ee,ae,ve,be),Ye}function renderFeatureInternal(ie,Z,ee,ae,ye,ve){const be=ee.getGeometryFunction()(Z);if(!be)return;const Ye=be.simplifyTransformed(ae,ye);if(ee.getRenderer())renderGeometry(ie,Ye,ee,Z);else{const Ke=GEOMETRY_RENDERERS[Ye.getType()];Ke(ie,Ye,ee,Z,ve)}}function renderGeometry(ie,Z,ee,ae){if(Z.getType()=="GeometryCollection"){const ye=Z.getGeometries();for(let ve=0,be=ye.length;ve<be;++ve)renderGeometry(ie,ye[ve],ee,ae);return}ie.getBuilder(ee.getZIndex(),"Default").drawCustom(Z,ae,ee.getRenderer(),ee.getHitDetectionRenderer())}function renderGeometryCollectionGeometry(ie,Z,ee,ae,ye){const ve=Z.getGeometriesArray();let be,Ye;for(be=0,Ye=ve.length;be<Ye;++be){const Ke=GEOMETRY_RENDERERS[ve[be].getType()];Ke(ie,ve[be],ee,ae,ye)}}function renderLineStringGeometry(ie,Z,ee,ae,ye){const ve=ee.getStroke();if(ve){const Ye=ie.getBuilder(ee.getZIndex(),"LineString");Ye.setFillStrokeStyle(null,ve),Ye.drawLineString(Z,ae)}const be=ee.getText();if(be&&be.getText()){const Ye=(ye||ie).getBuilder(ee.getZIndex(),"Text");Ye.setTextStyle(be),Ye.drawText(Z,ae)}}function renderMultiLineStringGeometry(ie,Z,ee,ae,ye){const ve=ee.getStroke();if(ve){const Ye=ie.getBuilder(ee.getZIndex(),"LineString");Ye.setFillStrokeStyle(null,ve),Ye.drawMultiLineString(Z,ae)}const be=ee.getText();if(be&&be.getText()){const Ye=(ye||ie).getBuilder(ee.getZIndex(),"Text");Ye.setTextStyle(be),Ye.drawText(Z,ae)}}function renderMultiPolygonGeometry(ie,Z,ee,ae,ye){const ve=ee.getFill(),be=ee.getStroke();if(be||ve){const Ke=ie.getBuilder(ee.getZIndex(),"Polygon");Ke.setFillStrokeStyle(ve,be),Ke.drawMultiPolygon(Z,ae)}const Ye=ee.getText();if(Ye&&Ye.getText()){const Ke=(ye||ie).getBuilder(ee.getZIndex(),"Text");Ke.setTextStyle(Ye),Ke.drawText(Z,ae)}}function renderPointGeometry(ie,Z,ee,ae,ye){const ve=ee.getImage(),be=ee.getText();let Ye;if(ve){if(ve.getImageState()!=ImageState.LOADED)return;let Ke=ie;if(ye){const Je=ve.getDeclutterMode();if(Je!=="none")if(Ke=ye,Je==="obstacle"){const rt=ie.getBuilder(ee.getZIndex(),"Image");rt.setImageStyle(ve,Ye),rt.drawPoint(Z,ae)}else be&&be.getText()&&(Ye={})}const Xe=Ke.getBuilder(ee.getZIndex(),"Image");Xe.setImageStyle(ve,Ye),Xe.drawPoint(Z,ae)}if(be&&be.getText()){let Ke=ie;ye&&(Ke=ye);const Xe=Ke.getBuilder(ee.getZIndex(),"Text");Xe.setTextStyle(be,Ye),Xe.drawText(Z,ae)}}function renderMultiPointGeometry(ie,Z,ee,ae,ye){const ve=ee.getImage(),be=ee.getText();let Ye;if(ve){if(ve.getImageState()!=ImageState.LOADED)return;let Ke=ie;if(ye){const Je=ve.getDeclutterMode();if(Je!=="none")if(Ke=ye,Je==="obstacle"){const rt=ie.getBuilder(ee.getZIndex(),"Image");rt.setImageStyle(ve,Ye),rt.drawMultiPoint(Z,ae)}else be&&be.getText()&&(Ye={})}const Xe=Ke.getBuilder(ee.getZIndex(),"Image");Xe.setImageStyle(ve,Ye),Xe.drawMultiPoint(Z,ae)}if(be&&be.getText()){let Ke=ie;ye&&(Ke=ye);const Xe=Ke.getBuilder(ee.getZIndex(),"Text");Xe.setTextStyle(be,Ye),Xe.drawText(Z,ae)}}function renderPolygonGeometry(ie,Z,ee,ae,ye){const ve=ee.getFill(),be=ee.getStroke();if(ve||be){const Ke=ie.getBuilder(ee.getZIndex(),"Polygon");Ke.setFillStrokeStyle(ve,be),Ke.drawPolygon(Z,ae)}const Ye=ee.getText();if(Ye&&Ye.getText()){const Ke=(ye||ie).getBuilder(ee.getZIndex(),"Text");Ke.setTextStyle(Ye),Ke.drawText(Z,ae)}}class Source extends BaseObject{constructor(Z){super(),this.projection=get$1(Z.projection),this.attributions_=adaptAttributions(Z.attributions),this.attributionsCollapsible_=Z.attributionsCollapsible!==void 0?Z.attributionsCollapsible:!0,this.loading=!1,this.state_=Z.state!==void 0?Z.state:"ready",this.wrapX_=Z.wrapX!==void 0?Z.wrapX:!1,this.interpolate_=!!Z.interpolate,this.viewResolver=null,this.viewRejector=null;const ee=this;this.viewPromise_=new Promise(function(ae,ye){ee.viewResolver=ae,ee.viewRejector=ye})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(Z){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(Z){this.attributions_=adaptAttributions(Z),this.changed()}setState(Z){this.state_=Z,this.changed()}}function adaptAttributions(ie){return ie?Array.isArray(ie)?function(Z){return ie}:typeof ie=="function"?ie:function(Z){return[ie]}:null}let withCredentials=!1;function loadFeaturesXhr(ie,Z,ee,ae,ye,ve,be){const Ye=new XMLHttpRequest;Ye.open("GET",typeof ie=="function"?ie(ee,ae,ye):ie,!0),Z.getType()=="arraybuffer"&&(Ye.responseType="arraybuffer"),Ye.withCredentials=withCredentials,Ye.onload=function(Ke){if(!Ye.status||Ye.status>=200&&Ye.status<300){const Xe=Z.getType();let Je;Xe=="json"||Xe=="text"?Je=Ye.responseText:Xe=="xml"?(Je=Ye.responseXML,Je||(Je=new DOMParser().parseFromString(Ye.responseText,"application/xml"))):Xe=="arraybuffer"&&(Je=Ye.response),Je?ve(Z.readFeatures(Je,{extent:ee,featureProjection:ye}),Z.readProjection(Je)):be()}else be()},Ye.onerror=be,Ye.send()}const TileState={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class Tile extends Target{constructor(Z,ee,ae){super(),ae=ae||{},this.tileCoord=Z,this.state=ee,this.interimTile=null,this.key="",this.transition_=ae.transition===void 0?250:ae.transition,this.transitionStarts_={},this.interpolate=!!ae.interpolate}changed(){this.dispatchEvent(EventType.CHANGE)}release(){this.state===TileState.ERROR&&this.setState(TileState.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){if(!this.interimTile)return this;let Z=this.interimTile;do{if(Z.getState()==TileState.LOADED)return this.transition_=0,Z;Z=Z.interimTile}while(Z);return this}refreshInterimChain(){if(!this.interimTile)return;let Z=this.interimTile,ee=this;do{if(Z.getState()==TileState.LOADED){Z.interimTile=null;break}else Z.getState()==TileState.LOADING?ee=Z:Z.getState()==TileState.IDLE?ee.interimTile=Z.interimTile:ee=Z;Z=ee.interimTile}while(Z)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(Z){if(this.state!==TileState.ERROR&&this.state>Z)throw new Error("Tile load sequence violation");this.state=Z,this.changed()}load(){abstract()}getAlpha(Z,ee){if(!this.transition_)return 1;let ae=this.transitionStarts_[Z];if(!ae)ae=ee,this.transitionStarts_[Z]=ae;else if(ae===-1)return 1;const ye=ee-ae+1e3/60;return ye>=this.transition_?1:easeIn(ye/this.transition_)}inTransition(Z){return this.transition_?this.transitionStarts_[Z]!==-1:!1}endTransition(Z){this.transition_&&(this.transitionStarts_[Z]=-1)}}class ImageTile extends Tile{constructor(Z,ee,ae,ye,ve,be){super(Z,ee,be),this.crossOrigin_=ye,this.src_=ae,this.key=ae,this.image_=new Image,ye!==null&&(this.image_.crossOrigin=ye),this.unlisten_=null,this.tileLoadFunction_=ve}getImage(){return this.image_}setImage(Z){this.image_=Z,this.state=TileState.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=TileState.ERROR,this.unlistenImage_(),this.image_=getBlankImage(),this.changed()}handleImageLoad_(){const Z=this.image_;Z.naturalWidth&&Z.naturalHeight?this.state=TileState.LOADED:this.state=TileState.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==TileState.ERROR&&(this.state=TileState.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==TileState.IDLE&&(this.state=TileState.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=listenImage(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function getBlankImage(){const ie=createCanvasContext2D(1,1);return ie.fillStyle="rgba(0,0,0,0)",ie.fillRect(0,0,1,1),ie.canvas}class Kinetic{constructor(Z,ee,ae){this.decay_=Z,this.minVelocity_=ee,this.delay_=ae,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(Z,ee){this.points_.push(Z,ee,Date.now())}end(){if(this.points_.length<6)return!1;const Z=Date.now()-this.delay_,ee=this.points_.length-3;if(this.points_[ee+2]<Z)return!1;let ae=ee-3;for(;ae>0&&this.points_[ae+2]>Z;)ae-=3;const ye=this.points_[ee+2]-this.points_[ae+2];if(ye<1e3/60)return!1;const ve=this.points_[ee]-this.points_[ae],be=this.points_[ee+1]-this.points_[ae+1];return this.angle_=Math.atan2(be,ve),this.initialVelocity_=Math.sqrt(ve*ve+be*be)/ye,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}class MapRenderer extends Disposable{constructor(Z){super(),this.map_=Z}dispatchRenderEvent(Z,ee){abstract()}calculateMatrices2D(Z){const ee=Z.viewState,ae=Z.coordinateToPixelTransform,ye=Z.pixelToCoordinateTransform;compose$1(ae,Z.size[0]/2,Z.size[1]/2,1/ee.resolution,-1/ee.resolution,-ee.rotation,-ee.center[0],-ee.center[1]),makeInverse(ye,ae)}forEachFeatureAtCoordinate(Z,ee,ae,ye,ve,be,Ye,Ke){let Xe;const Je=ee.viewState;function rt(mt,Yr,Qr,Xr){return ve.call(be,Yr,mt?Qr:null,Xr)}const nt=Je.projection,it=wrapX$1(Z.slice(),nt),lt=[[0,0]];if(nt.canWrapX()&&ye){const mt=nt.getExtent(),Yr=getWidth(mt);lt.push([-Yr,0],[Yr,0])}const ct=ee.layerStatesArray,ot=ct.length,dt=[],ft=[];for(let mt=0;mt<lt.length;mt++)for(let Yr=ot-1;Yr>=0;--Yr){const Qr=ct[Yr],Xr=Qr.layer;if(Xr.hasRenderer()&&inView(Qr,Je)&&Ye.call(Ke,Xr)){const Jr=Xr.getRenderer(),ai=Xr.getSource();if(Jr&&ai){const oi=ai.getWrapX()?it:Z,ni=rt.bind(null,Qr.managed);ft[0]=oi[0]+lt[mt][0],ft[1]=oi[1]+lt[mt][1],Xe=Jr.forEachFeatureAtCoordinate(ft,ee,ae,ni,dt)}if(Xe)return Xe}}if(dt.length===0)return;const gt=1/dt.length;return dt.forEach((mt,Yr)=>mt.distanceSq+=Yr*gt),dt.sort((mt,Yr)=>mt.distanceSq-Yr.distanceSq),dt.some(mt=>Xe=mt.callback(mt.feature,mt.layer,mt.geometry)),Xe}hasFeatureAtCoordinate(Z,ee,ae,ye,ve,be){return this.forEachFeatureAtCoordinate(Z,ee,ae,ye,TRUE,this,ve,be)!==void 0}getMap(){return this.map_}renderFrame(Z){abstract()}flushDeclutterItems(Z){}scheduleExpireIconCache(Z){shared.canExpireCache()&&Z.postRenderFunctions.push(expireIconCache)}}function expireIconCache(ie,Z){shared.expire()}class CompositeMapRenderer extends MapRenderer{constructor(Z){super(Z),this.fontChangeListenerKey_=listen(checkedFonts,ObjectEventType.PROPERTYCHANGE,Z.redrawText.bind(Z)),this.element_=document.createElement("div");const ee=this.element_.style;ee.position="absolute",ee.width="100%",ee.height="100%",ee.zIndex="0",this.element_.className=CLASS_UNSELECTABLE+" ol-layers";const ae=Z.getViewport();ae.insertBefore(this.element_,ae.firstChild||null),this.children_=[],this.renderedVisible_=!0,this.declutterLayers_=[]}dispatchRenderEvent(Z,ee){const ae=this.getMap();if(ae.hasListener(Z)){const ye=new RenderEvent(Z,void 0,ee);ae.dispatchEvent(ye)}}disposeInternal(){unlistenByKey(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(Z){if(!Z){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(Z),this.dispatchRenderEvent(RenderEventType.PRECOMPOSE,Z);const ee=Z.layerStatesArray.sort(function(be,Ye){return be.zIndex-Ye.zIndex}),ae=Z.viewState;this.children_.length=0;const ye=this.declutterLayers_;ye.length=0;let ve=null;for(let be=0,Ye=ee.length;be<Ye;++be){const Ke=ee[be];Z.layerIndex=be;const Xe=Ke.layer,Je=Xe.getSourceState();if(!inView(Ke,ae)||Je!="ready"&&Je!="undefined"){Xe.unrender();continue}const rt=Xe.render(Z,ve);rt&&(rt!==ve&&(this.children_.push(rt),ve=rt),"getDeclutter"in Xe&&ye.push(Xe))}this.flushDeclutterItems(Z),replaceChildren(this.element_,this.children_),this.dispatchRenderEvent(RenderEventType.POSTCOMPOSE,Z),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(Z)}flushDeclutterItems(Z){const ee=this.declutterLayers_;for(let ae=ee.length-1;ae>=0;--ae)ee[ae].renderDeclutter(Z);ee.length=0}}class GroupEvent extends BaseEvent{constructor(Z,ee){super(Z),this.layer=ee}}const Property={LAYERS:"layers"};class LayerGroup extends BaseLayer{constructor(Z){Z=Z||{};const ee=Object.assign({},Z);delete ee.layers;let ae=Z.layers;super(ee),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Property.LAYERS,this.handleLayersChanged_),ae?Array.isArray(ae)?ae=new Collection(ae.slice(),{unique:!0}):assert(typeof ae.getArray=="function","Expected `layers` to be an array or a `Collection`"):ae=new Collection(void 0,{unique:!0}),this.setLayers(ae)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(unlistenByKey),this.layersListenerKeys_.length=0;const Z=this.getLayers();this.layersListenerKeys_.push(listen(Z,CollectionEventType.ADD,this.handleLayersAdd_,this),listen(Z,CollectionEventType.REMOVE,this.handleLayersRemove_,this));for(const ae in this.listenerKeys_)this.listenerKeys_[ae].forEach(unlistenByKey);clear(this.listenerKeys_);const ee=Z.getArray();for(let ae=0,ye=ee.length;ae<ye;ae++){const ve=ee[ae];this.registerLayerListeners_(ve),this.dispatchEvent(new GroupEvent("addlayer",ve))}this.changed()}registerLayerListeners_(Z){const ee=[listen(Z,ObjectEventType.PROPERTYCHANGE,this.handleLayerChange_,this),listen(Z,EventType.CHANGE,this.handleLayerChange_,this)];Z instanceof LayerGroup&&ee.push(listen(Z,"addlayer",this.handleLayerGroupAdd_,this),listen(Z,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[getUid(Z)]=ee}handleLayerGroupAdd_(Z){this.dispatchEvent(new GroupEvent("addlayer",Z.layer))}handleLayerGroupRemove_(Z){this.dispatchEvent(new GroupEvent("removelayer",Z.layer))}handleLayersAdd_(Z){const ee=Z.element;this.registerLayerListeners_(ee),this.dispatchEvent(new GroupEvent("addlayer",ee)),this.changed()}handleLayersRemove_(Z){const ee=Z.element,ae=getUid(ee);this.listenerKeys_[ae].forEach(unlistenByKey),delete this.listenerKeys_[ae],this.dispatchEvent(new GroupEvent("removelayer",ee)),this.changed()}getLayers(){return this.get(Property.LAYERS)}setLayers(Z){const ee=this.getLayers();if(ee){const ae=ee.getArray();for(let ye=0,ve=ae.length;ye<ve;++ye)this.dispatchEvent(new GroupEvent("removelayer",ae[ye]))}this.set(Property.LAYERS,Z)}getLayersArray(Z){return Z=Z!==void 0?Z:[],this.getLayers().forEach(function(ee){ee.getLayersArray(Z)}),Z}getLayerStatesArray(Z){const ee=Z!==void 0?Z:[],ae=ee.length;this.getLayers().forEach(function(be){be.getLayerStatesArray(ee)});const ye=this.getLayerState();let ve=ye.zIndex;!Z&&ye.zIndex===void 0&&(ve=0);for(let be=ae,Ye=ee.length;be<Ye;be++){const Ke=ee[be];Ke.opacity*=ye.opacity,Ke.visible=Ke.visible&&ye.visible,Ke.maxResolution=Math.min(Ke.maxResolution,ye.maxResolution),Ke.minResolution=Math.max(Ke.minResolution,ye.minResolution),Ke.minZoom=Math.max(Ke.minZoom,ye.minZoom),Ke.maxZoom=Math.min(Ke.maxZoom,ye.maxZoom),ye.extent!==void 0&&(Ke.extent!==void 0?Ke.extent=getIntersection(Ke.extent,ye.extent):Ke.extent=ye.extent),Ke.zIndex===void 0&&(Ke.zIndex=ve)}return ee}getSourceState(){return"ready"}}class MapEvent extends BaseEvent{constructor(Z,ee,ae){super(Z),this.map=ee,this.frameState=ae!==void 0?ae:null}}class MapBrowserEvent extends MapEvent{constructor(Z,ee,ae,ye,ve,be){super(Z,ee,ve),this.originalEvent=ae,this.pixel_=null,this.coordinate_=null,this.dragging=ye!==void 0?ye:!1,this.activePointers=be}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(Z){this.pixel_=Z}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(Z){this.coordinate_=Z}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const MapBrowserEventType={SINGLECLICK:"singleclick",CLICK:EventType.CLICK,DBLCLICK:EventType.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},PointerEventType={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};class MapBrowserEventHandler extends Target{constructor(Z,ee){super(Z),this.map_=Z,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=ee===void 0?1:ee,this.down_=null;const ae=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=ae,this.pointerdownListenerKey_=listen(ae,PointerEventType.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=listen(ae,PointerEventType.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(EventType.TOUCHMOVE,this.boundHandleTouchMove_,PASSIVE_EVENT_LISTENERS?{passive:!1}:!1)}emulateClick_(Z){let ee=new MapBrowserEvent(MapBrowserEventType.CLICK,this.map_,Z);this.dispatchEvent(ee),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,ee=new MapBrowserEvent(MapBrowserEventType.DBLCLICK,this.map_,Z),this.dispatchEvent(ee)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const ae=new MapBrowserEvent(MapBrowserEventType.SINGLECLICK,this.map_,Z);this.dispatchEvent(ae)},250)}updateActivePointers_(Z){const ee=Z,ae=ee.pointerId;if(ee.type==MapBrowserEventType.POINTERUP||ee.type==MapBrowserEventType.POINTERCANCEL){delete this.trackedTouches_[ae];for(const ye in this.trackedTouches_)if(this.trackedTouches_[ye].target!==ee.target){delete this.trackedTouches_[ye];break}}else(ee.type==MapBrowserEventType.POINTERDOWN||ee.type==MapBrowserEventType.POINTERMOVE)&&(this.trackedTouches_[ae]=ee);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(Z){this.updateActivePointers_(Z);const ee=new MapBrowserEvent(MapBrowserEventType.POINTERUP,this.map_,Z,void 0,void 0,this.activePointers_);this.dispatchEvent(ee),this.emulateClicks_&&!ee.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(Z)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(unlistenByKey),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(Z){return Z.button===0}handlePointerDown_(Z){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(Z);const ee=new MapBrowserEvent(MapBrowserEventType.POINTERDOWN,this.map_,Z,void 0,void 0,this.activePointers_);if(this.dispatchEvent(ee),this.down_=new PointerEvent(Z.type,Z),Object.defineProperty(this.down_,"target",{writable:!1,value:Z.target}),this.dragListenerKeys_.length===0){const ae=this.map_.getOwnerDocument();this.dragListenerKeys_.push(listen(ae,MapBrowserEventType.POINTERMOVE,this.handlePointerMove_,this),listen(ae,MapBrowserEventType.POINTERUP,this.handlePointerUp_,this),listen(this.element_,MapBrowserEventType.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==ae&&this.dragListenerKeys_.push(listen(this.element_.getRootNode(),MapBrowserEventType.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(Z){if(this.isMoving_(Z)){this.updateActivePointers_(Z),this.dragging_=!0;const ee=new MapBrowserEvent(MapBrowserEventType.POINTERDRAG,this.map_,Z,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(ee)}}relayMoveEvent_(Z){this.originalPointerMoveEvent_=Z;const ee=!!(this.down_&&this.isMoving_(Z));this.dispatchEvent(new MapBrowserEvent(MapBrowserEventType.POINTERMOVE,this.map_,Z,ee))}handleTouchMove_(Z){const ee=this.originalPointerMoveEvent_;(!ee||ee.defaultPrevented)&&(typeof Z.cancelable!="boolean"||Z.cancelable===!0)&&Z.preventDefault()}isMoving_(Z){return this.dragging_||Math.abs(Z.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(Z.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(unlistenByKey(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(EventType.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(unlistenByKey(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(unlistenByKey),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const MapEventType={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},MapProperty={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},DROP=1/0;class PriorityQueue{constructor(Z,ee){this.priorityFunction_=Z,this.keyFunction_=ee,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,clear(this.queuedElements_)}dequeue(){const Z=this.elements_,ee=this.priorities_,ae=Z[0];Z.length==1?(Z.length=0,ee.length=0):(Z[0]=Z.pop(),ee[0]=ee.pop(),this.siftUp_(0));const ye=this.keyFunction_(ae);return delete this.queuedElements_[ye],ae}enqueue(Z){assert(!(this.keyFunction_(Z)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const ee=this.priorityFunction_(Z);return ee!=DROP?(this.elements_.push(Z),this.priorities_.push(ee),this.queuedElements_[this.keyFunction_(Z)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(Z){return Z*2+1}getRightChildIndex_(Z){return Z*2+2}getParentIndex_(Z){return Z-1>>1}heapify_(){let Z;for(Z=(this.elements_.length>>1)-1;Z>=0;Z--)this.siftUp_(Z)}isEmpty(){return this.elements_.length===0}isKeyQueued(Z){return Z in this.queuedElements_}isQueued(Z){return this.isKeyQueued(this.keyFunction_(Z))}siftUp_(Z){const ee=this.elements_,ae=this.priorities_,ye=ee.length,ve=ee[Z],be=ae[Z],Ye=Z;for(;Z<ye>>1;){const Ke=this.getLeftChildIndex_(Z),Xe=this.getRightChildIndex_(Z),Je=Xe<ye&&ae[Xe]<ae[Ke]?Xe:Ke;ee[Z]=ee[Je],ae[Z]=ae[Je],Z=Je}ee[Z]=ve,ae[Z]=be,this.siftDown_(Ye,Z)}siftDown_(Z,ee){const ae=this.elements_,ye=this.priorities_,ve=ae[ee],be=ye[ee];for(;ee>Z;){const Ye=this.getParentIndex_(ee);if(ye[Ye]>be)ae[ee]=ae[Ye],ye[ee]=ye[Ye],ee=Ye;else break}ae[ee]=ve,ye[ee]=be}reprioritize(){const Z=this.priorityFunction_,ee=this.elements_,ae=this.priorities_;let ye=0;const ve=ee.length;let be,Ye,Ke;for(Ye=0;Ye<ve;++Ye)be=ee[Ye],Ke=Z(be),Ke==DROP?delete this.queuedElements_[this.keyFunction_(be)]:(ae[ye]=Ke,ee[ye++]=be);ee.length=ye,ae.length=ye,this.heapify_()}}class TileQueue extends PriorityQueue{constructor(Z,ee){super(function(ae){return Z.apply(null,ae)},function(ae){return ae[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=ee,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(Z){const ee=super.enqueue(Z);return ee&&Z[0].addEventListener(EventType.CHANGE,this.boundHandleTileChange_),ee}getTilesLoading(){return this.tilesLoading_}handleTileChange(Z){const ee=Z.target,ae=ee.getState();if(ae===TileState.LOADED||ae===TileState.ERROR||ae===TileState.EMPTY){ae!==TileState.ERROR&&ee.removeEventListener(EventType.CHANGE,this.boundHandleTileChange_);const ye=ee.getKey();ye in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[ye],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(Z,ee){let ae=0,ye,ve,be;for(;this.tilesLoading_<Z&&ae<ee&&this.getCount()>0;)ve=this.dequeue()[0],be=ve.getKey(),ye=ve.getState(),ye===TileState.IDLE&&!(be in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[be]=!0,++this.tilesLoading_,++ae,ve.load())}}function getTilePriority(ie,Z,ee,ae,ye){if(!ie||!(ee in ie.wantedTiles)||!ie.wantedTiles[ee][Z.getKey()])return DROP;const ve=ie.viewState.center,be=ae[0]-ve[0],Ye=ae[1]-ve[1];return 65536*Math.log(ye)+Math.sqrt(be*be+Ye*Ye)/ye}class Control extends BaseObject{constructor(Z){super();const ee=Z.element;ee&&!Z.target&&!ee.style.pointerEvents&&(ee.style.pointerEvents="auto"),this.element=ee||null,this.target_=null,this.map_=null,this.listenerKeys=[],Z.render&&(this.render=Z.render),Z.target&&this.setTarget(Z.target)}disposeInternal(){removeNode(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(Z){this.map_&&removeNode(this.element);for(let ee=0,ae=this.listenerKeys.length;ee<ae;++ee)unlistenByKey(this.listenerKeys[ee]);this.listenerKeys.length=0,this.map_=Z,Z&&((this.target_?this.target_:Z.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==VOID&&this.listenerKeys.push(listen(Z,MapEventType.POSTRENDER,this.render,this)),Z.render())}render(Z){}setTarget(Z){this.target_=typeof Z=="string"?document.getElementById(Z):Z}}class Attribution extends Control{constructor(Z){Z=Z||{},super({element:document.createElement("div"),render:Z.render,target:Z.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=Z.collapsed!==void 0?Z.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=Z.collapsible!==void 0,this.collapsible_=Z.collapsible!==void 0?Z.collapsible:!0,this.collapsible_||(this.collapsed_=!1);const ee=Z.className!==void 0?Z.className:"ol-attribution",ae=Z.tipLabel!==void 0?Z.tipLabel:"Attributions",ye=Z.expandClassName!==void 0?Z.expandClassName:ee+"-expand",ve=Z.collapseLabel!==void 0?Z.collapseLabel:"›",be=Z.collapseClassName!==void 0?Z.collapseClassName:ee+"-collapse";typeof ve=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=ve,this.collapseLabel_.className=be):this.collapseLabel_=ve;const Ye=Z.label!==void 0?Z.label:"i";typeof Ye=="string"?(this.label_=document.createElement("span"),this.label_.textContent=Ye,this.label_.className=ye):this.label_=Ye;const Ke=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=ae,this.toggleButton_.appendChild(Ke),this.toggleButton_.addEventListener(EventType.CLICK,this.handleClick_.bind(this),!1);const Xe=ee+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL+(this.collapsed_&&this.collapsible_?" "+CLASS_COLLAPSED:"")+(this.collapsible_?"":" ol-uncollapsible"),Je=this.element;Je.className=Xe,Je.appendChild(this.toggleButton_),Je.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(Z){const ee=Array.from(new Set(this.getMap().getAllLayers().flatMap(ye=>ye.getAttributions(Z)))),ae=!this.getMap().getAllLayers().some(ye=>ye.getSource()&&ye.getSource().getAttributionsCollapsible()===!1);return this.overrideCollapsible_||this.setCollapsible(ae),ee}updateElement_(Z){if(!Z){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const ee=this.collectSourceAttributions_(Z),ae=ee.length>0;if(this.renderedVisible_!=ae&&(this.element.style.display=ae?"":"none",this.renderedVisible_=ae),!equals$2(ee,this.renderedAttributions_)){removeChildren(this.ulElement_);for(let ye=0,ve=ee.length;ye<ve;++ye){const be=document.createElement("li");be.innerHTML=ee[ye],this.ulElement_.appendChild(be)}this.renderedAttributions_=ee}}handleClick_(Z){Z.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(CLASS_COLLAPSED),this.collapsed_?replaceNode(this.collapseLabel_,this.label_):replaceNode(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(Z){this.collapsible_!==Z&&(this.collapsible_=Z,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(Z){this.userCollapsed_=Z,!(!this.collapsible_||this.collapsed_===Z)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(Z){this.updateElement_(Z.frameState)}}const Attribution$1=Attribution;class Rotate extends Control{constructor(Z){Z=Z||{},super({element:document.createElement("div"),render:Z.render,target:Z.target});const ee=Z.className!==void 0?Z.className:"ol-rotate",ae=Z.label!==void 0?Z.label:"⇧",ye=Z.compassClassName!==void 0?Z.compassClassName:"ol-compass";this.label_=null,typeof ae=="string"?(this.label_=document.createElement("span"),this.label_.className=ye,this.label_.textContent=ae):(this.label_=ae,this.label_.classList.add(ye));const ve=Z.tipLabel?Z.tipLabel:"Reset rotation",be=document.createElement("button");be.className=ee+"-reset",be.setAttribute("type","button"),be.title=ve,be.appendChild(this.label_),be.addEventListener(EventType.CLICK,this.handleClick_.bind(this),!1);const Ye=ee+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL,Ke=this.element;Ke.className=Ye,Ke.appendChild(be),this.callResetNorth_=Z.resetNorth?Z.resetNorth:void 0,this.duration_=Z.duration!==void 0?Z.duration:250,this.autoHide_=Z.autoHide!==void 0?Z.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(CLASS_HIDDEN)}handleClick_(Z){Z.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const Z=this.getMap().getView();if(!Z)return;const ee=Z.getRotation();ee!==void 0&&(this.duration_>0&&ee%(2*Math.PI)!==0?Z.animate({rotation:0,duration:this.duration_,easing:easeOut}):Z.setRotation(0))}render(Z){const ee=Z.frameState;if(!ee)return;const ae=ee.viewState.rotation;if(ae!=this.rotation_){const ye="rotate("+ae+"rad)";if(this.autoHide_){const ve=this.element.classList.contains(CLASS_HIDDEN);!ve&&ae===0?this.element.classList.add(CLASS_HIDDEN):ve&&ae!==0&&this.element.classList.remove(CLASS_HIDDEN)}this.label_.style.transform=ye}this.rotation_=ae}}const Rotate$1=Rotate;class Zoom extends Control{constructor(Z){Z=Z||{},super({element:document.createElement("div"),target:Z.target});const ee=Z.className!==void 0?Z.className:"ol-zoom",ae=Z.delta!==void 0?Z.delta:1,ye=Z.zoomInClassName!==void 0?Z.zoomInClassName:ee+"-in",ve=Z.zoomOutClassName!==void 0?Z.zoomOutClassName:ee+"-out",be=Z.zoomInLabel!==void 0?Z.zoomInLabel:"+",Ye=Z.zoomOutLabel!==void 0?Z.zoomOutLabel:"–",Ke=Z.zoomInTipLabel!==void 0?Z.zoomInTipLabel:"Zoom in",Xe=Z.zoomOutTipLabel!==void 0?Z.zoomOutTipLabel:"Zoom out",Je=document.createElement("button");Je.className=ye,Je.setAttribute("type","button"),Je.title=Ke,Je.appendChild(typeof be=="string"?document.createTextNode(be):be),Je.addEventListener(EventType.CLICK,this.handleClick_.bind(this,ae),!1);const rt=document.createElement("button");rt.className=ve,rt.setAttribute("type","button"),rt.title=Xe,rt.appendChild(typeof Ye=="string"?document.createTextNode(Ye):Ye),rt.addEventListener(EventType.CLICK,this.handleClick_.bind(this,-ae),!1);const nt=ee+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL,it=this.element;it.className=nt,it.appendChild(Je),it.appendChild(rt),this.duration_=Z.duration!==void 0?Z.duration:250}handleClick_(Z,ee){ee.preventDefault(),this.zoomByDelta_(Z)}zoomByDelta_(Z){const ee=this.getMap().getView();if(!ee)return;const ae=ee.getZoom();if(ae!==void 0){const ye=ee.getConstrainedZoom(ae+Z);this.duration_>0?(ee.getAnimating()&&ee.cancelAnimations(),ee.animate({zoom:ye,duration:this.duration_,easing:easeOut})):ee.setZoom(ye)}}}const Zoom$1=Zoom;function defaults$2(ie){ie=ie||{};const Z=new Collection;return(ie.zoom===void 0||ie.zoom)&&Z.push(new Zoom$1(ie.zoomOptions)),(ie.rotate===void 0||ie.rotate)&&Z.push(new Rotate$1(ie.rotateOptions)),(ie.attribution===void 0||ie.attribution)&&Z.push(new Attribution$1(ie.attributionOptions)),Z}const InteractionProperty={ACTIVE:"active"};class Interaction extends BaseObject{constructor(Z){super(),this.on,this.once,this.un,Z&&Z.handleEvent&&(this.handleEvent=Z.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(InteractionProperty.ACTIVE)}getMap(){return this.map_}handleEvent(Z){return!0}setActive(Z){this.set(InteractionProperty.ACTIVE,Z)}setMap(Z){this.map_=Z}}function pan(ie,Z,ee){const ae=ie.getCenterInternal();if(ae){const ye=[ae[0]+Z[0],ae[1]+Z[1]];ie.animateInternal({duration:ee!==void 0?ee:250,easing:linear,center:ie.getConstrainedCenter(ye)})}}function zoomByDelta(ie,Z,ee,ae){const ye=ie.getZoom();if(ye===void 0)return;const ve=ie.getConstrainedZoom(ye+Z),be=ie.getResolutionForZoom(ve);ie.getAnimating()&&ie.cancelAnimations(),ie.animate({resolution:be,anchor:ee,duration:ae!==void 0?ae:250,easing:easeOut})}class DoubleClickZoom extends Interaction{constructor(Z){super(),Z=Z||{},this.delta_=Z.delta?Z.delta:1,this.duration_=Z.duration!==void 0?Z.duration:250}handleEvent(Z){let ee=!1;if(Z.type==MapBrowserEventType.DBLCLICK){const ae=Z.originalEvent,ye=Z.map,ve=Z.coordinate,be=ae.shiftKey?-this.delta_:this.delta_,Ye=ye.getView();zoomByDelta(Ye,be,ve,this.duration_),ae.preventDefault(),ee=!0}return!ee}}const DoubleClickZoom$1=DoubleClickZoom;class PointerInteraction extends Interaction{constructor(Z){Z=Z||{},super(Z),Z.handleDownEvent&&(this.handleDownEvent=Z.handleDownEvent),Z.handleDragEvent&&(this.handleDragEvent=Z.handleDragEvent),Z.handleMoveEvent&&(this.handleMoveEvent=Z.handleMoveEvent),Z.handleUpEvent&&(this.handleUpEvent=Z.handleUpEvent),Z.stopDown&&(this.stopDown=Z.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(Z){return!1}handleDragEvent(Z){}handleEvent(Z){if(!Z.originalEvent)return!0;let ee=!1;if(this.updateTrackedPointers_(Z),this.handlingDownUpSequence){if(Z.type==MapBrowserEventType.POINTERDRAG)this.handleDragEvent(Z),Z.originalEvent.preventDefault();else if(Z.type==MapBrowserEventType.POINTERUP){const ae=this.handleUpEvent(Z);this.handlingDownUpSequence=ae&&this.targetPointers.length>0}}else if(Z.type==MapBrowserEventType.POINTERDOWN){const ae=this.handleDownEvent(Z);this.handlingDownUpSequence=ae,ee=this.stopDown(ae)}else Z.type==MapBrowserEventType.POINTERMOVE&&this.handleMoveEvent(Z);return!ee}handleMoveEvent(Z){}handleUpEvent(Z){return!1}stopDown(Z){return Z}updateTrackedPointers_(Z){Z.activePointers&&(this.targetPointers=Z.activePointers)}}function centroid(ie){const Z=ie.length;let ee=0,ae=0;for(let ye=0;ye<Z;ye++)ee+=ie[ye].clientX,ae+=ie[ye].clientY;return{clientX:ee/Z,clientY:ae/Z}}function all(ie){const Z=arguments;return function(ee){let ae=!0;for(let ye=0,ve=Z.length;ye<ve&&(ae=ae&&Z[ye](ee),!!ae);++ye);return ae}}const altShiftKeysOnly=function(ie){const Z=ie.originalEvent;return Z.altKey&&!(Z.metaKey||Z.ctrlKey)&&Z.shiftKey},focus=function(ie){const Z=ie.map.getTargetElement(),ee=ie.map.getOwnerDocument().activeElement;return Z.contains(ee)},focusWithTabindex=function(ie){return ie.map.getTargetElement().hasAttribute("tabindex")?focus(ie):!0},always=TRUE,mouseActionButton=function(ie){const Z=ie.originalEvent;return Z.button==0&&!(WEBKIT&&MAC&&Z.ctrlKey)},noModifierKeys=function(ie){const Z=ie.originalEvent;return!Z.altKey&&!(Z.metaKey||Z.ctrlKey)&&!Z.shiftKey},platformModifierKey=function(ie){const Z=ie.originalEvent;return MAC?Z.metaKey:Z.ctrlKey},shiftKeyOnly=function(ie){const Z=ie.originalEvent;return!Z.altKey&&!(Z.metaKey||Z.ctrlKey)&&Z.shiftKey},targetNotEditable=function(ie){const Z=ie.originalEvent,ee=Z.target.tagName;return ee!=="INPUT"&&ee!=="SELECT"&&ee!=="TEXTAREA"&&!Z.target.isContentEditable},mouseOnly=function(ie){const Z=ie.originalEvent;return assert(Z!==void 0,"mapBrowserEvent must originate from a pointer event"),Z.pointerType=="mouse"},primaryAction=function(ie){const Z=ie.originalEvent;return assert(Z!==void 0,"mapBrowserEvent must originate from a pointer event"),Z.isPrimary&&Z.button===0};class DragPan extends PointerInteraction{constructor(Z){super({stopDown:FALSE}),Z=Z||{},this.kinetic_=Z.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const ee=Z.condition?Z.condition:all(noModifierKeys,primaryAction);this.condition_=Z.onFocusOnly?all(focusWithTabindex,ee):ee,this.noKinetic_=!1}handleDragEvent(Z){const ee=Z.map;this.panning_||(this.panning_=!0,ee.getView().beginInteraction());const ae=this.targetPointers,ye=ee.getEventPixel(centroid(ae));if(ae.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(ye[0],ye[1]),this.lastCentroid){const ve=[this.lastCentroid[0]-ye[0],ye[1]-this.lastCentroid[1]],be=Z.map.getView();scale$2(ve,be.getResolution()),rotate$2(ve,be.getRotation()),be.adjustCenterInternal(ve)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=ye,this.lastPointersCount_=ae.length,Z.originalEvent.preventDefault()}handleUpEvent(Z){const ee=Z.map,ae=ee.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const ye=this.kinetic_.getDistance(),ve=this.kinetic_.getAngle(),be=ae.getCenterInternal(),Ye=ee.getPixelFromCoordinateInternal(be),Ke=ee.getCoordinateFromPixelInternal([Ye[0]-ye*Math.cos(ve),Ye[1]-ye*Math.sin(ve)]);ae.animateInternal({center:ae.getConstrainedCenter(Ke),duration:500,easing:easeOut})}return this.panning_&&(this.panning_=!1,ae.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(Z){if(this.targetPointers.length>0&&this.condition_(Z)){const ee=Z.map.getView();return this.lastCentroid=null,ee.getAnimating()&&ee.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}const DragPan$1=DragPan;class DragRotate extends PointerInteraction{constructor(Z){Z=Z||{},super({stopDown:FALSE}),this.condition_=Z.condition?Z.condition:altShiftKeysOnly,this.lastAngle_=void 0,this.duration_=Z.duration!==void 0?Z.duration:250}handleDragEvent(Z){if(!mouseOnly(Z))return;const ee=Z.map,ae=ee.getView();if(ae.getConstraints().rotation===disable)return;const ye=ee.getSize(),ve=Z.pixel,be=Math.atan2(ye[1]/2-ve[1],ve[0]-ye[0]/2);if(this.lastAngle_!==void 0){const Ye=be-this.lastAngle_;ae.adjustRotationInternal(-Ye)}this.lastAngle_=be}handleUpEvent(Z){return mouseOnly(Z)?(Z.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(Z){return mouseOnly(Z)&&mouseActionButton(Z)&&this.condition_(Z)?(Z.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class RenderBox extends Disposable{constructor(Z){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+Z,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const Z=this.startPixel_,ee=this.endPixel_,ae="px",ye=this.element_.style;ye.left=Math.min(Z[0],ee[0])+ae,ye.top=Math.min(Z[1],ee[1])+ae,ye.width=Math.abs(ee[0]-Z[0])+ae,ye.height=Math.abs(ee[1]-Z[1])+ae}setMap(Z){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const ee=this.element_.style;ee.left="inherit",ee.top="inherit",ee.width="inherit",ee.height="inherit"}this.map_=Z,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(Z,ee){this.startPixel_=Z,this.endPixel_=ee,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const Z=this.startPixel_,ee=this.endPixel_,ae=[Z,[Z[0],ee[1]],ee,[ee[0],Z[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);ae[4]=ae[0].slice(),this.geometry_?this.geometry_.setCoordinates([ae]):this.geometry_=new Polygon$1([ae])}getGeometry(){return this.geometry_}}const DragBoxEventType={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class DragBoxEvent extends BaseEvent{constructor(Z,ee,ae){super(Z),this.coordinate=ee,this.mapBrowserEvent=ae}}class DragBox extends PointerInteraction{constructor(Z){super(),this.on,this.once,this.un,Z=Z||{},this.box_=new RenderBox(Z.className||"ol-dragbox"),this.minArea_=Z.minArea!==void 0?Z.minArea:64,Z.onBoxEnd&&(this.onBoxEnd=Z.onBoxEnd),this.startPixel_=null,this.condition_=Z.condition?Z.condition:mouseActionButton,this.boxEndCondition_=Z.boxEndCondition?Z.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(Z,ee,ae){const ye=ae[0]-ee[0],ve=ae[1]-ee[1];return ye*ye+ve*ve>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(Z){this.box_.setPixels(this.startPixel_,Z.pixel),this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXDRAG,Z.coordinate,Z))}handleUpEvent(Z){this.box_.setMap(null);const ee=this.boxEndCondition_(Z,this.startPixel_,Z.pixel);return ee&&this.onBoxEnd(Z),this.dispatchEvent(new DragBoxEvent(ee?DragBoxEventType.BOXEND:DragBoxEventType.BOXCANCEL,Z.coordinate,Z)),!1}handleDownEvent(Z){return this.condition_(Z)?(this.startPixel_=Z.pixel,this.box_.setMap(Z.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXSTART,Z.coordinate,Z)),!0):!1}onBoxEnd(Z){}}class DragZoom extends DragBox{constructor(Z){Z=Z||{};const ee=Z.condition?Z.condition:shiftKeyOnly;super({condition:ee,className:Z.className||"ol-dragzoom",minArea:Z.minArea}),this.duration_=Z.duration!==void 0?Z.duration:200,this.out_=Z.out!==void 0?Z.out:!1}onBoxEnd(Z){const ee=this.getMap().getView();let ae=this.getGeometry();if(this.out_){const ye=ee.rotatedExtentForGeometry(ae),ve=ee.getResolutionForExtentInternal(ye),be=ee.getResolution()/ve;ae=ae.clone(),ae.scale(be*be)}ee.fitInternal(ae,{duration:this.duration_,easing:easeOut})}}const DragZoom$1=DragZoom,Key={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class KeyboardPan extends Interaction{constructor(Z){super(),Z=Z||{},this.defaultCondition_=function(ee){return noModifierKeys(ee)&&targetNotEditable(ee)},this.condition_=Z.condition!==void 0?Z.condition:this.defaultCondition_,this.duration_=Z.duration!==void 0?Z.duration:100,this.pixelDelta_=Z.pixelDelta!==void 0?Z.pixelDelta:128}handleEvent(Z){let ee=!1;if(Z.type==EventType.KEYDOWN){const ae=Z.originalEvent,ye=ae.key;if(this.condition_(Z)&&(ye==Key.DOWN||ye==Key.LEFT||ye==Key.RIGHT||ye==Key.UP)){const ve=Z.map.getView(),be=ve.getResolution()*this.pixelDelta_;let Ye=0,Ke=0;ye==Key.DOWN?Ke=-be:ye==Key.LEFT?Ye=-be:ye==Key.RIGHT?Ye=be:Ke=be;const Xe=[Ye,Ke];rotate$2(Xe,ve.getRotation()),pan(ve,Xe,this.duration_),ae.preventDefault(),ee=!0}}return!ee}}class KeyboardZoom extends Interaction{constructor(Z){super(),Z=Z||{},this.condition_=Z.condition?Z.condition:function(ee){return!platformModifierKey(ee)&&targetNotEditable(ee)},this.delta_=Z.delta?Z.delta:1,this.duration_=Z.duration!==void 0?Z.duration:100}handleEvent(Z){let ee=!1;if(Z.type==EventType.KEYDOWN||Z.type==EventType.KEYPRESS){const ae=Z.originalEvent,ye=ae.key;if(this.condition_(Z)&&(ye==="+"||ye==="-")){const ve=Z.map,be=ye==="+"?this.delta_:-this.delta_,Ye=ve.getView();zoomByDelta(Ye,be,void 0,this.duration_),ae.preventDefault(),ee=!0}}return!ee}}const KeyboardZoom$1=KeyboardZoom;class MouseWheelZoom extends Interaction{constructor(Z){Z=Z||{},super(Z),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=Z.maxDelta!==void 0?Z.maxDelta:1,this.duration_=Z.duration!==void 0?Z.duration:250,this.timeout_=Z.timeout!==void 0?Z.timeout:80,this.useAnchor_=Z.useAnchor!==void 0?Z.useAnchor:!0,this.constrainResolution_=Z.constrainResolution!==void 0?Z.constrainResolution:!1;const ee=Z.condition?Z.condition:always;this.condition_=Z.onFocusOnly?all(focusWithTabindex,ee):ee,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const Z=this.getMap();Z&&Z.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(Z){if(!this.condition_(Z)||Z.type!==EventType.WHEEL)return!0;const ee=Z.map,ae=Z.originalEvent;ae.preventDefault(),this.useAnchor_&&(this.lastAnchor_=Z.coordinate);let ye;if(Z.type==EventType.WHEEL&&(ye=ae.deltaY,FIREFOX&&ae.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(ye/=DEVICE_PIXEL_RATIO),ae.deltaMode===WheelEvent.DOM_DELTA_LINE&&(ye*=40)),ye===0)return!1;this.lastDelta_=ye;const ve=Date.now();this.startTime_===void 0&&(this.startTime_=ve),(!this.mode_||ve-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(ye)<4?"trackpad":"wheel");const be=ee.getView();if(this.mode_==="trackpad"&&!(be.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(be.getAnimating()&&be.cancelAnimations(),be.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),be.adjustZoom(-ye/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=ve,!1;this.totalDelta_+=ye;const Ye=Math.max(this.timeout_-(ve-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,ee),Ye),!1}handleWheelZoom_(Z){const ee=Z.getView();ee.getAnimating()&&ee.cancelAnimations();let ae=-clamp$1(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(ee.getConstrainResolution()||this.constrainResolution_)&&(ae=ae?ae>0?1:-1:0),zoomByDelta(ee,ae,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(Z){this.useAnchor_=Z,Z||(this.lastAnchor_=null)}}const MouseWheelZoom$1=MouseWheelZoom;class PinchRotate extends PointerInteraction{constructor(Z){Z=Z||{};const ee=Z;ee.stopDown||(ee.stopDown=FALSE),super(ee),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=Z.threshold!==void 0?Z.threshold:.3,this.duration_=Z.duration!==void 0?Z.duration:250}handleDragEvent(Z){let ee=0;const ae=this.targetPointers[0],ye=this.targetPointers[1],ve=Math.atan2(ye.clientY-ae.clientY,ye.clientX-ae.clientX);if(this.lastAngle_!==void 0){const Ke=ve-this.lastAngle_;this.rotationDelta_+=Ke,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),ee=Ke}this.lastAngle_=ve;const be=Z.map,Ye=be.getView();Ye.getConstraints().rotation!==disable&&(this.anchor_=be.getCoordinateFromPixelInternal(be.getEventPixel(centroid(this.targetPointers))),this.rotating_&&(be.render(),Ye.adjustRotationInternal(ee,this.anchor_)))}handleUpEvent(Z){return this.targetPointers.length<2?(Z.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(Z){if(this.targetPointers.length>=2){const ee=Z.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||ee.getView().beginInteraction(),!0}return!1}}class PinchZoom extends PointerInteraction{constructor(Z){Z=Z||{};const ee=Z;ee.stopDown||(ee.stopDown=FALSE),super(ee),this.anchor_=null,this.duration_=Z.duration!==void 0?Z.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(Z){let ee=1;const ae=this.targetPointers[0],ye=this.targetPointers[1],ve=ae.clientX-ye.clientX,be=ae.clientY-ye.clientY,Ye=Math.sqrt(ve*ve+be*be);this.lastDistance_!==void 0&&(ee=this.lastDistance_/Ye),this.lastDistance_=Ye;const Ke=Z.map,Xe=Ke.getView();ee!=1&&(this.lastScaleDelta_=ee),this.anchor_=Ke.getCoordinateFromPixelInternal(Ke.getEventPixel(centroid(this.targetPointers))),Ke.render(),Xe.adjustResolutionInternal(ee,this.anchor_)}handleUpEvent(Z){if(this.targetPointers.length<2){const ee=Z.map.getView(),ae=this.lastScaleDelta_>1?1:-1;return ee.endInteraction(this.duration_,ae),!1}return!0}handleDownEvent(Z){if(this.targetPointers.length>=2){const ee=Z.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||ee.getView().beginInteraction(),!0}return!1}}const PinchZoom$1=PinchZoom;function defaults$1(ie){ie=ie||{};const Z=new Collection,ee=new Kinetic(-.005,.05,100);return(ie.altShiftDragRotate===void 0||ie.altShiftDragRotate)&&Z.push(new DragRotate),(ie.doubleClickZoom===void 0||ie.doubleClickZoom)&&Z.push(new DoubleClickZoom$1({delta:ie.zoomDelta,duration:ie.zoomDuration})),(ie.dragPan===void 0||ie.dragPan)&&Z.push(new DragPan$1({onFocusOnly:ie.onFocusOnly,kinetic:ee})),(ie.pinchRotate===void 0||ie.pinchRotate)&&Z.push(new PinchRotate),(ie.pinchZoom===void 0||ie.pinchZoom)&&Z.push(new PinchZoom$1({duration:ie.zoomDuration})),(ie.keyboard===void 0||ie.keyboard)&&(Z.push(new KeyboardPan),Z.push(new KeyboardZoom$1({delta:ie.zoomDelta,duration:ie.zoomDuration}))),(ie.mouseWheelZoom===void 0||ie.mouseWheelZoom)&&Z.push(new MouseWheelZoom$1({onFocusOnly:ie.onFocusOnly,duration:ie.zoomDuration})),(ie.shiftDragZoom===void 0||ie.shiftDragZoom)&&Z.push(new DragZoom$1({duration:ie.zoomDuration})),Z}function removeLayerMapProperty(ie){if(ie instanceof Layer){ie.setMapInternal(null);return}ie instanceof LayerGroup&&ie.getLayers().forEach(removeLayerMapProperty)}function setLayerMapProperty(ie,Z){if(ie instanceof Layer){ie.setMapInternal(Z);return}if(ie instanceof LayerGroup){const ee=ie.getLayers().getArray();for(let ae=0,ye=ee.length;ae<ye;++ae)setLayerMapProperty(ee[ae],Z)}}let Map$1=class extends BaseObject{constructor(ie){super(),ie=ie||{},this.on,this.once,this.un;const Z=createOptionsInternal(ie);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=ie.maxTilesLoading!==void 0?ie.maxTilesLoading:16,this.pixelRatio_=ie.pixelRatio!==void 0?ie.pixelRatio:DEVICE_PIXEL_RATIO,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=create$2(),this.pixelToCoordinateTransform_=create$2(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=ie.moveTolerance,this.keyboardEventTarget_=Z.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=Z.controls||defaults$2(),this.interactions=Z.interactions||defaults$1({onFocusOnly:!0}),this.overlays_=Z.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new TileQueue(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(MapProperty.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(MapProperty.VIEW,this.handleViewChanged_),this.addChangeListener(MapProperty.SIZE,this.handleSizeChanged_),this.addChangeListener(MapProperty.TARGET,this.handleTargetChanged_),this.setProperties(Z.values);const ee=this;ie.view&&!(ie.view instanceof View)&&ie.view.then(function(ae){ee.setView(new View(ae))}),this.controls.addEventListener(CollectionEventType.ADD,ae=>{ae.element.setMap(this)}),this.controls.addEventListener(CollectionEventType.REMOVE,ae=>{ae.element.setMap(null)}),this.interactions.addEventListener(CollectionEventType.ADD,ae=>{ae.element.setMap(this)}),this.interactions.addEventListener(CollectionEventType.REMOVE,ae=>{ae.element.setMap(null)}),this.overlays_.addEventListener(CollectionEventType.ADD,ae=>{this.addOverlayInternal_(ae.element)}),this.overlays_.addEventListener(CollectionEventType.REMOVE,ae=>{const ye=ae.element.getId();ye!==void 0&&delete this.overlayIdIndex_[ye.toString()],ae.element.setMap(null)}),this.controls.forEach(ae=>{ae.setMap(this)}),this.interactions.forEach(ae=>{ae.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(ie){this.getControls().push(ie)}addInteraction(ie){this.getInteractions().push(ie)}addLayer(ie){this.getLayerGroup().getLayers().push(ie)}handleLayerAdd_(ie){setLayerMapProperty(ie.layer,this)}addOverlay(ie){this.getOverlays().push(ie)}addOverlayInternal_(ie){const Z=ie.getId();Z!==void 0&&(this.overlayIdIndex_[Z.toString()]=ie),ie.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(ie,Z,ee){if(!this.frameState_||!this.renderer_)return;const ae=this.getCoordinateFromPixelInternal(ie);ee=ee!==void 0?ee:{};const ye=ee.hitTolerance!==void 0?ee.hitTolerance:0,ve=ee.layerFilter!==void 0?ee.layerFilter:TRUE,be=ee.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(ae,this.frameState_,ye,be,Z,null,ve,null)}getFeaturesAtPixel(ie,Z){const ee=[];return this.forEachFeatureAtPixel(ie,function(ae){ee.push(ae)},Z),ee}getAllLayers(){const ie=[];function Z(ee){ee.forEach(function(ae){ae instanceof LayerGroup?Z(ae.getLayers()):ie.push(ae)})}return Z(this.getLayers()),ie}hasFeatureAtPixel(ie,Z){if(!this.frameState_||!this.renderer_)return!1;const ee=this.getCoordinateFromPixelInternal(ie);Z=Z!==void 0?Z:{};const ae=Z.layerFilter!==void 0?Z.layerFilter:TRUE,ye=Z.hitTolerance!==void 0?Z.hitTolerance:0,ve=Z.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(ee,this.frameState_,ye,ve,ae,null)}getEventCoordinate(ie){return this.getCoordinateFromPixel(this.getEventPixel(ie))}getEventCoordinateInternal(ie){return this.getCoordinateFromPixelInternal(this.getEventPixel(ie))}getEventPixel(ie){const Z=this.viewport_.getBoundingClientRect(),ee=this.getSize(),ae=Z.width/ee[0],ye=Z.height/ee[1],ve="changedTouches"in ie?ie.changedTouches[0]:ie;return[(ve.clientX-Z.left)/ae,(ve.clientY-Z.top)/ye]}getTarget(){return this.get(MapProperty.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(ie){return toUserCoordinate(this.getCoordinateFromPixelInternal(ie),this.getView().getProjection())}getCoordinateFromPixelInternal(ie){const Z=this.frameState_;return Z?apply(Z.pixelToCoordinateTransform,ie.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(ie){const Z=this.overlayIdIndex_[ie.toString()];return Z!==void 0?Z:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(MapProperty.LAYERGROUP)}setLayers(ie){const Z=this.getLayerGroup();if(ie instanceof Collection){Z.setLayers(ie);return}const ee=Z.getLayers();ee.clear(),ee.extend(ie)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const ie=this.getLayerGroup().getLayerStatesArray();for(let Z=0,ee=ie.length;Z<ee;++Z){const ae=ie[Z];if(!ae.visible)continue;const ye=ae.layer.getRenderer();if(ye&&!ye.ready)return!0;const ve=ae.layer.getSource();if(ve&&ve.loading)return!0}return!1}getPixelFromCoordinate(ie){const Z=fromUserCoordinate(ie,this.getView().getProjection());return this.getPixelFromCoordinateInternal(Z)}getPixelFromCoordinateInternal(ie){const Z=this.frameState_;return Z?apply(Z.coordinateToPixelTransform,ie.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(MapProperty.SIZE)}getView(){return this.get(MapProperty.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const ie=this.getTargetElement();return ie?ie.ownerDocument:document}getTilePriority(ie,Z,ee,ae){return getTilePriority(this.frameState_,ie,Z,ee,ae)}handleBrowserEvent(ie,Z){Z=Z||ie.type;const ee=new MapBrowserEvent(Z,this,ie);this.handleMapBrowserEvent(ee)}handleMapBrowserEvent(ie){if(!this.frameState_)return;const Z=ie.originalEvent,ee=Z.type;if(ee===PointerEventType.POINTERDOWN||ee===EventType.WHEEL||ee===EventType.KEYDOWN){const ae=this.getOwnerDocument(),ye=this.viewport_.getRootNode?this.viewport_.getRootNode():ae,ve=Z.target;if(this.overlayContainerStopEvent_.contains(ve)||!(ye===ae?ae.documentElement:ye).contains(ve))return}if(ie.frameState=this.frameState_,this.dispatchEvent(ie)!==!1){const ae=this.getInteractions().getArray().slice();for(let ye=ae.length-1;ye>=0;ye--){const ve=ae[ye];if(!(ve.getMap()!==this||!ve.getActive()||!this.getTargetElement())&&(!ve.handleEvent(ie)||ie.propagationStopped))break}}}handlePostRender(){const ie=this.frameState_,Z=this.tileQueue_;if(!Z.isEmpty()){let ae=this.maxTilesLoading_,ye=ae;if(ie){const ve=ie.viewHints;if(ve[ViewHint.ANIMATING]||ve[ViewHint.INTERACTING]){const be=Date.now()-ie.time>8;ae=be?0:8,ye=be?0:2}}Z.getTilesLoading()<ae&&(Z.reprioritize(),Z.loadMoreTiles(ae,ye))}ie&&this.renderer_&&!ie.animate&&(this.renderComplete_===!0?(this.hasListener(RenderEventType.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(RenderEventType.RENDERCOMPLETE,ie),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new MapEvent(MapEventType.LOADEND,this,ie)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new MapEvent(MapEventType.LOADSTART,this,ie))));const ee=this.postRenderFunctions_;for(let ae=0,ye=ee.length;ae<ye;++ae)ee[ae](this,ie);ee.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let ee=0,ae=this.targetChangeHandlerKeys_.length;ee<ae;++ee)unlistenByKey(this.targetChangeHandlerKeys_[ee]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(EventType.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(EventType.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,removeNode(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const ee=this.targetElement_.getRootNode();ee instanceof ShadowRoot&&this.resizeObserver_.unobserve(ee.host),this.setSize(void 0)}const ie=this.getTarget(),Z=typeof ie=="string"?document.getElementById(ie):ie;if(this.targetElement_=Z,!Z)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{Z.appendChild(this.viewport_),this.renderer_||(this.renderer_=new CompositeMapRenderer(this)),this.mapBrowserEventHandler_=new MapBrowserEventHandler(this,this.moveTolerance_);for(const ye in MapBrowserEventType)this.mapBrowserEventHandler_.addEventListener(MapBrowserEventType[ye],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(EventType.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(EventType.WHEEL,this.boundHandleBrowserEvent_,PASSIVE_EVENT_LISTENERS?{passive:!1}:!1);const ee=this.keyboardEventTarget_?this.keyboardEventTarget_:Z;this.targetChangeHandlerKeys_=[listen(ee,EventType.KEYDOWN,this.handleBrowserEvent,this),listen(ee,EventType.KEYPRESS,this.handleBrowserEvent,this)];const ae=Z.getRootNode();ae instanceof ShadowRoot&&this.resizeObserver_.observe(ae.host),this.resizeObserver_.observe(Z)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(unlistenByKey(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(unlistenByKey(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const ie=this.getView();ie&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=listen(ie,ObjectEventType.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=listen(ie,EventType.CHANGE,this.handleViewPropertyChanged_,this),ie.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(unlistenByKey),this.layerGroupPropertyListenerKeys_=null);const ie=this.getLayerGroup();ie&&(this.handleLayerAdd_(new GroupEvent("addlayer",ie)),this.layerGroupPropertyListenerKeys_=[listen(ie,ObjectEventType.PROPERTYCHANGE,this.render,this),listen(ie,EventType.CHANGE,this.render,this),listen(ie,"addlayer",this.handleLayerAdd_,this),listen(ie,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const ie=this.getLayerGroup().getLayerStatesArray();for(let Z=0,ee=ie.length;Z<ee;++Z){const ae=ie[Z].layer;ae.hasRenderer()&&ae.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}flushDeclutterItems(){const ie=this.frameState_;ie&&this.renderer_.flushDeclutterItems(ie)}removeControl(ie){return this.getControls().remove(ie)}removeInteraction(ie){return this.getInteractions().remove(ie)}removeLayer(ie){return this.getLayerGroup().getLayers().remove(ie)}handleLayerRemove_(ie){removeLayerMapProperty(ie.layer)}removeOverlay(ie){return this.getOverlays().remove(ie)}renderFrame_(ie){const Z=this.getSize(),ee=this.getView(),ae=this.frameState_;let ye=null;if(Z!==void 0&&hasArea(Z)&&ee&&ee.isDef()){const ve=ee.getHints(this.frameState_?this.frameState_.viewHints:void 0),be=ee.getState();if(ye={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:getForViewAndSize(be.center,be.resolution,be.rotation,Z),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:Z,tileQueue:this.tileQueue_,time:ie,usedTiles:{},viewState:be,viewHints:ve,wantedTiles:{},mapId:getUid(this),renderTargets:{}},be.nextCenter&&be.nextResolution){const Ye=isNaN(be.nextRotation)?be.rotation:be.nextRotation;ye.nextExtent=getForViewAndSize(be.nextCenter,be.nextResolution,Ye,Z)}}this.frameState_=ye,this.renderer_.renderFrame(ye),ye&&(ye.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,ye.postRenderFunctions),ae&&(!this.previousExtent_||!isEmpty(this.previousExtent_)&&!equals$1(ye.extent,this.previousExtent_))&&(this.dispatchEvent(new MapEvent(MapEventType.MOVESTART,this,ae)),this.previousExtent_=createOrUpdateEmpty(this.previousExtent_)),this.previousExtent_&&!ye.viewHints[ViewHint.ANIMATING]&&!ye.viewHints[ViewHint.INTERACTING]&&!equals$1(ye.extent,this.previousExtent_)&&(this.dispatchEvent(new MapEvent(MapEventType.MOVEEND,this,ye)),clone(ye.extent,this.previousExtent_))),this.dispatchEvent(new MapEvent(MapEventType.POSTRENDER,this,ye)),this.renderComplete_=this.hasListener(MapEventType.LOADSTART)||this.hasListener(MapEventType.LOADEND)||this.hasListener(RenderEventType.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(ie){const Z=this.getLayerGroup();Z&&this.handleLayerRemove_(new GroupEvent("removelayer",Z)),this.set(MapProperty.LAYERGROUP,ie)}setSize(ie){this.set(MapProperty.SIZE,ie)}setTarget(ie){this.set(MapProperty.TARGET,ie)}setView(ie){if(!ie||ie instanceof View){this.set(MapProperty.VIEW,ie);return}this.set(MapProperty.VIEW,new View);const Z=this;ie.then(function(ee){Z.setView(new View(ee))})}updateSize(){const ie=this.getTargetElement();let Z;if(ie){const ae=getComputedStyle(ie),ye=ie.offsetWidth-parseFloat(ae.borderLeftWidth)-parseFloat(ae.paddingLeft)-parseFloat(ae.paddingRight)-parseFloat(ae.borderRightWidth),ve=ie.offsetHeight-parseFloat(ae.borderTopWidth)-parseFloat(ae.paddingTop)-parseFloat(ae.paddingBottom)-parseFloat(ae.borderBottomWidth);!isNaN(ye)&&!isNaN(ve)&&(Z=[ye,ve],!hasArea(Z)&&(ie.offsetWidth||ie.offsetHeight||ie.getClientRects().length)&&warn("No map visible because the map container's width or height are 0."))}const ee=this.getSize();Z&&(!ee||!equals$2(Z,ee))&&(this.setSize(Z),this.updateViewportSize_())}updateViewportSize_(){const ie=this.getView();if(ie){let Z;const ee=getComputedStyle(this.viewport_);ee.width&&ee.height&&(Z=[parseInt(ee.width,10),parseInt(ee.height,10)]),ie.setViewportSize(Z)}}};function createOptionsInternal(ie){let Z=null;ie.keyboardEventTarget!==void 0&&(Z=typeof ie.keyboardEventTarget=="string"?document.getElementById(ie.keyboardEventTarget):ie.keyboardEventTarget);const ee={},ae=ie.layers&&typeof ie.layers.getLayers=="function"?ie.layers:new LayerGroup({layers:ie.layers});ee[MapProperty.LAYERGROUP]=ae,ee[MapProperty.TARGET]=ie.target,ee[MapProperty.VIEW]=ie.view instanceof View?ie.view:new View;let ye;ie.controls!==void 0&&(Array.isArray(ie.controls)?ye=new Collection(ie.controls.slice()):(assert(typeof ie.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),ye=ie.controls));let ve;ie.interactions!==void 0&&(Array.isArray(ie.interactions)?ve=new Collection(ie.interactions.slice()):(assert(typeof ie.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),ve=ie.interactions));let be;return ie.overlays!==void 0?Array.isArray(ie.overlays)?be=new Collection(ie.overlays.slice()):(assert(typeof ie.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),be=ie.overlays):be=new Collection,{controls:ye,interactions:ve,keyboardEventTarget:Z,overlays:be,values:ee}}class LRUCache{constructor(Z){this.highWaterMark=Z!==void 0?Z:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(Z){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(Z){return this.entries_.hasOwnProperty(Z)}forEach(Z){let ee=this.oldest_;for(;ee;)Z(ee.value_,ee.key_,this),ee=ee.newer}get(Z,ee){const ae=this.entries_[Z];return assert(ae!==void 0,"Tried to get a value for a key that does not exist in the cache"),ae===this.newest_||(ae===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(ae.newer.older=ae.older,ae.older.newer=ae.newer),ae.newer=null,ae.older=this.newest_,this.newest_.newer=ae,this.newest_=ae),ae.value_}remove(Z){const ee=this.entries_[Z];return assert(ee!==void 0,"Tried to get a value for a key that does not exist in the cache"),ee===this.newest_?(this.newest_=ee.older,this.newest_&&(this.newest_.newer=null)):ee===this.oldest_?(this.oldest_=ee.newer,this.oldest_&&(this.oldest_.older=null)):(ee.newer.older=ee.older,ee.older.newer=ee.newer),delete this.entries_[Z],--this.count_,ee.value_}getCount(){return this.count_}getKeys(){const Z=new Array(this.count_);let ee=0,ae;for(ae=this.newest_;ae;ae=ae.older)Z[ee++]=ae.key_;return Z}getValues(){const Z=new Array(this.count_);let ee=0,ae;for(ae=this.newest_;ae;ae=ae.older)Z[ee++]=ae.value_;return Z}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(Z){if(this.containsKey(Z))return this.entries_[Z].value_}pop(){const Z=this.oldest_;return delete this.entries_[Z.key_],Z.newer&&(Z.newer.older=null),this.oldest_=Z.newer,this.oldest_||(this.newest_=null),--this.count_,Z.value_}replace(Z,ee){this.get(Z),this.entries_[Z].value_=ee}set(Z,ee){assert(!(Z in this.entries_),"Tried to set a value for a key that is used already");const ae={key_:Z,newer:null,older:this.newest_,value_:ee};this.newest_?this.newest_.newer=ae:this.oldest_=ae,this.newest_=ae,this.entries_[Z]=ae,++this.count_}setSize(Z){this.highWaterMark=Z}}function createOrUpdate$1(ie,Z,ee,ae){return ae!==void 0?(ae[0]=ie,ae[1]=Z,ae[2]=ee,ae):[ie,Z,ee]}function getKeyZXY(ie,Z,ee){return ie+"/"+Z+"/"+ee}function getKey(ie){return getKeyZXY(ie[0],ie[1],ie[2])}function getCacheKeyForTileKey(ie){const[Z,ee,ae]=ie.substring(ie.lastIndexOf("/")+1,ie.length).split(",").map(Number);return getKeyZXY(Z,ee,ae)}function fromKey(ie){return ie.split("/").map(Number)}function hash$2(ie){return(ie[1]<<ie[0])+ie[2]}function withinExtentAndZ(ie,Z){const ee=ie[0],ae=ie[1],ye=ie[2];if(Z.getMinZoom()>ee||ee>Z.getMaxZoom())return!1;const ve=Z.getFullTileRange(ee);return ve?ve.containsXY(ae,ye):!0}class TileCache extends LRUCache{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(Z){for(;this.canExpireCache()&&!(this.peekLast().getKey()in Z);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const Z=this.peekFirstKey(),ee=fromKey(Z)[0];this.forEach(ae=>{ae.tileCoord[0]!==ee&&(this.remove(getKey(ae.tileCoord)),ae.release())})}}class TileRange{constructor(Z,ee,ae,ye){this.minX=Z,this.maxX=ee,this.minY=ae,this.maxY=ye}contains(Z){return this.containsXY(Z[1],Z[2])}containsTileRange(Z){return this.minX<=Z.minX&&Z.maxX<=this.maxX&&this.minY<=Z.minY&&Z.maxY<=this.maxY}containsXY(Z,ee){return this.minX<=Z&&Z<=this.maxX&&this.minY<=ee&&ee<=this.maxY}equals(Z){return this.minX==Z.minX&&this.minY==Z.minY&&this.maxX==Z.maxX&&this.maxY==Z.maxY}extend(Z){Z.minX<this.minX&&(this.minX=Z.minX),Z.maxX>this.maxX&&(this.maxX=Z.maxX),Z.minY<this.minY&&(this.minY=Z.minY),Z.maxY>this.maxY&&(this.maxY=Z.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(Z){return this.minX<=Z.maxX&&this.maxX>=Z.minX&&this.minY<=Z.maxY&&this.maxY>=Z.minY}}function createOrUpdate(ie,Z,ee,ae,ye){return ye!==void 0?(ye.minX=ie,ye.maxX=Z,ye.minY=ee,ye.maxY=ae,ye):new TileRange(ie,Z,ee,ae)}const canvasPool$1=[];class VectorRenderTile extends Tile{constructor(Z,ee,ae,ye){super(Z,ee,{transition:0}),this.context_={},this.executorGroups={},this.declutterExecutorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=ye.bind(void 0,this),this.wrappedTileCoord=ae}getContext(Z){const ee=getUid(Z);return ee in this.context_||(this.context_[ee]=createCanvasContext2D(1,1,canvasPool$1)),this.context_[ee]}hasContext(Z){return getUid(Z)in this.context_}getImage(Z){return this.hasContext(Z)?this.getContext(Z).canvas:null}getReplayState(Z){const ee=getUid(Z);return ee in this.replayState_||(this.replayState_[ee]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[ee]}load(){this.getSourceTiles()}release(){for(const Z in this.context_){const ee=this.context_[Z];releaseCanvas$1(ee),canvasPool$1.push(ee.canvas),delete this.context_[Z]}super.release()}}let VectorTile$1=class extends Tile{constructor(ie,Z,ee,ae,ye,ve){super(ie,Z,ve),this.extent=null,this.format_=ae,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=ye,this.url_=ee,this.key=ee}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==TileState.IDLE&&(this.setState(TileState.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(ie,Z){this.setFeatures(ie)}onError(){this.setState(TileState.ERROR)}setFeatures(ie){this.features_=ie,this.setState(TileState.LOADED)}setLoader(ie){this.loader_=ie}};const TileProperty={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class BaseTileLayer extends Layer{constructor(Z){Z=Z||{};const ee=Object.assign({},Z);delete ee.preload,delete ee.useInterimTilesOnError,super(ee),this.on,this.once,this.un,this.setPreload(Z.preload!==void 0?Z.preload:0),this.setUseInterimTilesOnError(Z.useInterimTilesOnError!==void 0?Z.useInterimTilesOnError:!0)}getPreload(){return this.get(TileProperty.PRELOAD)}setPreload(Z){this.set(TileProperty.PRELOAD,Z)}getUseInterimTilesOnError(){return this.get(TileProperty.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(Z){this.set(TileProperty.USE_INTERIM_TILES_ON_ERROR,Z)}getData(Z){return super.getData(Z)}}const ERROR_THRESHOLD=.5,MAX_SUBDIVISION=10,MAX_TRIANGLE_WIDTH=.25;class Triangulation{constructor(Z,ee,ae,ye,ve,be){this.sourceProj_=Z,this.targetProj_=ee;let Ye={};const Ke=getTransform(this.targetProj_,this.sourceProj_);this.transformInv_=function(ft){const gt=ft[0]+"/"+ft[1];return Ye[gt]||(Ye[gt]=Ke(ft)),Ye[gt]},this.maxSourceExtent_=ye,this.errorThresholdSquared_=ve*ve,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!ye&&!!this.sourceProj_.getExtent()&&getWidth(ye)>=getWidth(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?getWidth(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?getWidth(this.targetProj_.getExtent()):null;const Xe=getTopLeft(ae),Je=getTopRight(ae),rt=getBottomRight(ae),nt=getBottomLeft(ae),it=this.transformInv_(Xe),lt=this.transformInv_(Je),ct=this.transformInv_(rt),ot=this.transformInv_(nt),dt=MAX_SUBDIVISION+(be?Math.max(0,Math.ceil(Math.log2(getArea(ae)/(be*be*256*256)))):0);if(this.addQuad_(Xe,Je,rt,nt,it,lt,ct,ot,dt),this.wrapsXInSource_){let ft=1/0;this.triangles_.forEach(function(gt,mt,Yr){ft=Math.min(ft,gt.source[0][0],gt.source[1][0],gt.source[2][0])}),this.triangles_.forEach(gt=>{if(Math.max(gt.source[0][0],gt.source[1][0],gt.source[2][0])-ft>this.sourceWorldWidth_/2){const mt=[[gt.source[0][0],gt.source[0][1]],[gt.source[1][0],gt.source[1][1]],[gt.source[2][0],gt.source[2][1]]];mt[0][0]-ft>this.sourceWorldWidth_/2&&(mt[0][0]-=this.sourceWorldWidth_),mt[1][0]-ft>this.sourceWorldWidth_/2&&(mt[1][0]-=this.sourceWorldWidth_),mt[2][0]-ft>this.sourceWorldWidth_/2&&(mt[2][0]-=this.sourceWorldWidth_);const Yr=Math.min(mt[0][0],mt[1][0],mt[2][0]);Math.max(mt[0][0],mt[1][0],mt[2][0])-Yr<this.sourceWorldWidth_/2&&(gt.source=mt)}})}Ye={}}addTriangle_(Z,ee,ae,ye,ve,be){this.triangles_.push({source:[ye,ve,be],target:[Z,ee,ae]})}addQuad_(Z,ee,ae,ye,ve,be,Ye,Ke,Xe){const Je=boundingExtent([ve,be,Ye,Ke]),rt=this.sourceWorldWidth_?getWidth(Je)/this.sourceWorldWidth_:null,nt=this.sourceWorldWidth_,it=this.sourceProj_.canWrapX()&&rt>.5&&rt<1;let lt=!1;if(Xe>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const ot=boundingExtent([Z,ee,ae,ye]);lt=getWidth(ot)/this.targetWorldWidth_>MAX_TRIANGLE_WIDTH||lt}!it&&this.sourceProj_.isGlobal()&&rt&&(lt=rt>MAX_TRIANGLE_WIDTH||lt)}if(!lt&&this.maxSourceExtent_&&isFinite(Je[0])&&isFinite(Je[1])&&isFinite(Je[2])&&isFinite(Je[3])&&!intersects$1(Je,this.maxSourceExtent_))return;let ct=0;if(!lt&&(!isFinite(ve[0])||!isFinite(ve[1])||!isFinite(be[0])||!isFinite(be[1])||!isFinite(Ye[0])||!isFinite(Ye[1])||!isFinite(Ke[0])||!isFinite(Ke[1]))){if(Xe>0)lt=!0;else if(ct=(!isFinite(ve[0])||!isFinite(ve[1])?8:0)+(!isFinite(be[0])||!isFinite(be[1])?4:0)+(!isFinite(Ye[0])||!isFinite(Ye[1])?2:0)+(!isFinite(Ke[0])||!isFinite(Ke[1])?1:0),ct!=1&&ct!=2&&ct!=4&&ct!=8)return}if(Xe>0){if(!lt){const ot=[(Z[0]+ae[0])/2,(Z[1]+ae[1])/2],dt=this.transformInv_(ot);let ft;it?ft=(modulo(ve[0],nt)+modulo(Ye[0],nt))/2-modulo(dt[0],nt):ft=(ve[0]+Ye[0])/2-dt[0];const gt=(ve[1]+Ye[1])/2-dt[1];lt=ft*ft+gt*gt>this.errorThresholdSquared_}if(lt){if(Math.abs(Z[0]-ae[0])<=Math.abs(Z[1]-ae[1])){const ot=[(ee[0]+ae[0])/2,(ee[1]+ae[1])/2],dt=this.transformInv_(ot),ft=[(ye[0]+Z[0])/2,(ye[1]+Z[1])/2],gt=this.transformInv_(ft);this.addQuad_(Z,ee,ot,ft,ve,be,dt,gt,Xe-1),this.addQuad_(ft,ot,ae,ye,gt,dt,Ye,Ke,Xe-1)}else{const ot=[(Z[0]+ee[0])/2,(Z[1]+ee[1])/2],dt=this.transformInv_(ot),ft=[(ae[0]+ye[0])/2,(ae[1]+ye[1])/2],gt=this.transformInv_(ft);this.addQuad_(Z,ot,ft,ye,ve,dt,gt,Ke,Xe-1),this.addQuad_(ot,ee,ae,ft,dt,be,Ye,gt,Xe-1)}return}}if(it){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}ct&11||this.addTriangle_(Z,ae,ye,ve,Ye,Ke),ct&14||this.addTriangle_(Z,ae,ee,ve,Ye,be),ct&&(ct&13||this.addTriangle_(ee,ye,Z,be,Ke,ve),ct&7||this.addTriangle_(ee,ye,ae,be,Ke,Ye))}calculateSourceExtent(){const Z=createEmpty();return this.triangles_.forEach(function(ee,ae,ye){const ve=ee.source;extendCoordinate(Z,ve[0]),extendCoordinate(Z,ve[1]),extendCoordinate(Z,ve[2])}),Z}getTriangles(){return this.triangles_}}let brokenDiagonalRendering_;const canvasPool=[];function drawTestTriangle(ie,Z,ee,ae,ye){ie.beginPath(),ie.moveTo(0,0),ie.lineTo(Z,ee),ie.lineTo(ae,ye),ie.closePath(),ie.save(),ie.clip(),ie.fillRect(0,0,Math.max(Z,ae)+1,Math.max(ee,ye)),ie.restore()}function verifyBrokenDiagonalRendering(ie,Z){return Math.abs(ie[Z*4]-210)>2||Math.abs(ie[Z*4+3]-.75*255)>2}function isBrokenDiagonalRendering(){if(brokenDiagonalRendering_===void 0){const ie=createCanvasContext2D(6,6,canvasPool);ie.globalCompositeOperation="lighter",ie.fillStyle="rgba(210, 0, 0, 0.75)",drawTestTriangle(ie,4,5,4,0),drawTestTriangle(ie,4,5,0,5);const Z=ie.getImageData(0,0,3,3).data;brokenDiagonalRendering_=verifyBrokenDiagonalRendering(Z,0)||verifyBrokenDiagonalRendering(Z,4)||verifyBrokenDiagonalRendering(Z,8),releaseCanvas$1(ie),canvasPool.push(ie.canvas)}return brokenDiagonalRendering_}function calculateSourceResolution(ie,Z,ee,ae){const ye=transform(ee,Z,ie);let ve=getPointResolution(Z,ae,ee);const be=Z.getMetersPerUnit();be!==void 0&&(ve*=be);const Ye=ie.getMetersPerUnit();Ye!==void 0&&(ve/=Ye);const Ke=ie.getExtent();if(!Ke||containsCoordinate(Ke,ye)){const Xe=getPointResolution(ie,ve,ye)/ve;isFinite(Xe)&&Xe>0&&(ve/=Xe)}return ve}function calculateSourceExtentResolution(ie,Z,ee,ae){const ye=getCenter(ee);let ve=calculateSourceResolution(ie,Z,ye,ae);return(!isFinite(ve)||ve<=0)&&forEachCorner(ee,function(be){return ve=calculateSourceResolution(ie,Z,be,ae),isFinite(ve)&&ve>0}),ve}function render$1(ie,Z,ee,ae,ye,ve,be,Ye,Ke,Xe,Je,rt){const nt=createCanvasContext2D(Math.round(ee*ie),Math.round(ee*Z),canvasPool);if(rt||(nt.imageSmoothingEnabled=!1),Ke.length===0)return nt.canvas;nt.scale(ee,ee);function it(mt){return Math.round(mt*ee)/ee}nt.globalCompositeOperation="lighter";const lt=createEmpty();Ke.forEach(function(mt,Yr,Qr){extend$1(lt,mt.extent)});const ct=getWidth(lt),ot=getHeight(lt),dt=createCanvasContext2D(Math.round(ee*ct/ae),Math.round(ee*ot/ae),canvasPool);rt||(dt.imageSmoothingEnabled=!1);const ft=ee/ae;Ke.forEach(function(mt,Yr,Qr){const Xr=mt.extent[0]-lt[0],Jr=-(mt.extent[3]-lt[3]),ai=getWidth(mt.extent),oi=getHeight(mt.extent);mt.image.width>0&&mt.image.height>0&&dt.drawImage(mt.image,Xe,Xe,mt.image.width-2*Xe,mt.image.height-2*Xe,Xr*ft,Jr*ft,ai*ft,oi*ft)});const gt=getTopLeft(be);return Ye.getTriangles().forEach(function(mt,Yr,Qr){const Xr=mt.source,Jr=mt.target;let ai=Xr[0][0],oi=Xr[0][1],ni=Xr[1][0],li=Xr[1][1],ui=Xr[2][0],mi=Xr[2][1];const ii=it((Jr[0][0]-gt[0])/ve),hi=it(-(Jr[0][1]-gt[1])/ve),ri=it((Jr[1][0]-gt[0])/ve),ci=it(-(Jr[1][1]-gt[1])/ve),Si=it((Jr[2][0]-gt[0])/ve),si=it(-(Jr[2][1]-gt[1])/ve),Ei=ai,yi=oi;ai=0,oi=0,ni-=Ei,li-=yi,ui-=Ei,mi-=yi;const Mi=[[ni,li,0,0,ri-ii],[ui,mi,0,0,Si-ii],[0,0,ni,li,ci-hi],[0,0,ui,mi,si-hi]],Ci=solveLinearSystem(Mi);if(Ci){if(nt.save(),nt.beginPath(),isBrokenDiagonalRendering()||!rt){nt.moveTo(ri,ci);const Ri=4,Ni=ii-ri,Ai=hi-ci;for(let ki=0;ki<Ri;ki++)nt.lineTo(ri+it((ki+1)*Ni/Ri),ci+it(ki*Ai/(Ri-1))),ki!=Ri-1&&nt.lineTo(ri+it((ki+1)*Ni/Ri),ci+it((ki+1)*Ai/(Ri-1)));nt.lineTo(Si,si)}else nt.moveTo(ri,ci),nt.lineTo(ii,hi),nt.lineTo(Si,si);nt.clip(),nt.transform(Ci[0],Ci[2],Ci[1],Ci[3],ii,hi),nt.translate(lt[0]-Ei,lt[3]-yi),nt.scale(ae/ee,-ae/ee),nt.drawImage(dt.canvas,0,0),nt.restore()}}),releaseCanvas$1(dt),canvasPool.push(dt.canvas),Je&&(nt.save(),nt.globalCompositeOperation="source-over",nt.strokeStyle="black",nt.lineWidth=1,Ye.getTriangles().forEach(function(mt,Yr,Qr){const Xr=mt.target,Jr=(Xr[0][0]-gt[0])/ve,ai=-(Xr[0][1]-gt[1])/ve,oi=(Xr[1][0]-gt[0])/ve,ni=-(Xr[1][1]-gt[1])/ve,li=(Xr[2][0]-gt[0])/ve,ui=-(Xr[2][1]-gt[1])/ve;nt.beginPath(),nt.moveTo(oi,ni),nt.lineTo(Jr,ai),nt.lineTo(li,ui),nt.closePath(),nt.stroke()}),nt.restore()),nt.canvas}class ReprojTile extends Tile{constructor(Z,ee,ae,ye,ve,be,Ye,Ke,Xe,Je,rt,nt){super(ve,TileState.IDLE,{interpolate:!!nt}),this.renderEdges_=rt!==void 0?rt:!1,this.pixelRatio_=Ye,this.gutter_=Ke,this.canvas_=null,this.sourceTileGrid_=ee,this.targetTileGrid_=ye,this.wrappedTileCoord_=be||ve,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const it=ye.getTileCoordExtent(this.wrappedTileCoord_),lt=this.targetTileGrid_.getExtent();let ct=this.sourceTileGrid_.getExtent();const ot=lt?getIntersection(it,lt):it;if(getArea(ot)===0){this.state=TileState.EMPTY;return}const dt=Z.getExtent();dt&&(ct?ct=getIntersection(ct,dt):ct=dt);const ft=ye.getResolution(this.wrappedTileCoord_[0]),gt=calculateSourceExtentResolution(Z,ae,ot,ft);if(!isFinite(gt)||gt<=0){this.state=TileState.EMPTY;return}const mt=Je!==void 0?Je:ERROR_THRESHOLD;if(this.triangulation_=new Triangulation(Z,ae,ot,ct,gt*mt,ft),this.triangulation_.getTriangles().length===0){this.state=TileState.EMPTY;return}this.sourceZ_=ee.getZForResolution(gt);let Yr=this.triangulation_.calculateSourceExtent();if(ct&&(Z.canWrapX()?(Yr[1]=clamp$1(Yr[1],ct[1],ct[3]),Yr[3]=clamp$1(Yr[3],ct[1],ct[3])):Yr=getIntersection(Yr,ct)),!getArea(Yr))this.state=TileState.EMPTY;else{const Qr=ee.getTileRangeForExtentAndZ(Yr,this.sourceZ_);for(let Xr=Qr.minX;Xr<=Qr.maxX;Xr++)for(let Jr=Qr.minY;Jr<=Qr.maxY;Jr++){const ai=Xe(this.sourceZ_,Xr,Jr,Ye);ai&&this.sourceTiles_.push(ai)}this.sourceTiles_.length===0&&(this.state=TileState.EMPTY)}}getImage(){return this.canvas_}reproject_(){const Z=[];if(this.sourceTiles_.forEach(ee=>{ee&&ee.getState()==TileState.LOADED&&Z.push({extent:this.sourceTileGrid_.getTileCoordExtent(ee.tileCoord),image:ee.getImage()})}),this.sourceTiles_.length=0,Z.length===0)this.state=TileState.ERROR;else{const ee=this.wrappedTileCoord_[0],ae=this.targetTileGrid_.getTileSize(ee),ye=typeof ae=="number"?ae:ae[0],ve=typeof ae=="number"?ae:ae[1],be=this.targetTileGrid_.getResolution(ee),Ye=this.sourceTileGrid_.getResolution(this.sourceZ_),Ke=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=render$1(ye,ve,this.pixelRatio_,Ye,this.sourceTileGrid_.getExtent(),be,Ke,this.triangulation_,Z,this.gutter_,this.renderEdges_,this.interpolate),this.state=TileState.LOADED}this.changed()}load(){if(this.state==TileState.IDLE){this.state=TileState.LOADING,this.changed();let Z=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(ee=>{const ae=ee.getState();if(ae==TileState.IDLE||ae==TileState.LOADING){Z++;const ye=listen(ee,EventType.CHANGE,function(ve){const be=ee.getState();(be==TileState.LOADED||be==TileState.ERROR||be==TileState.EMPTY)&&(unlistenByKey(ye),Z--,Z===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(ye)}}),Z===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(ee,ae,ye){ee.getState()==TileState.IDLE&&ee.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(unlistenByKey),this.sourcesListenerKeys_=null}release(){this.canvas_&&(releaseCanvas$1(this.canvas_.getContext("2d")),canvasPool.push(this.canvas_),this.canvas_=null),super.release()}}class CanvasTileLayerRenderer extends CanvasLayerRenderer{constructor(Z){super(Z),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=createEmpty(),this.tmpTileRange_=new TileRange(0,0,0,0)}isDrawableTile(Z){const ee=this.getLayer(),ae=Z.getState(),ye=ee.getUseInterimTilesOnError();return ae==TileState.LOADED||ae==TileState.EMPTY||ae==TileState.ERROR&&!ye}getTile(Z,ee,ae,ye){const ve=ye.pixelRatio,be=ye.viewState.projection,Ye=this.getLayer();let Ke=Ye.getSource().getTile(Z,ee,ae,ve,be);return Ke.getState()==TileState.ERROR&&Ye.getUseInterimTilesOnError()&&Ye.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(Ke)||(Ke=Ke.getInterimTile()),Ke}getData(Z){const ee=this.frameState;if(!ee)return null;const ae=this.getLayer(),ye=apply(ee.pixelToCoordinateTransform,Z.slice()),ve=ae.getExtent();if(ve&&!containsCoordinate(ve,ye))return null;const be=ee.pixelRatio,Ye=ee.viewState.projection,Ke=ee.viewState,Xe=ae.getRenderSource(),Je=Xe.getTileGridForProjection(Ke.projection),rt=Xe.getTilePixelRatio(ee.pixelRatio);for(let nt=Je.getZForResolution(Ke.resolution);nt>=Je.getMinZoom();--nt){const it=Je.getTileCoordForCoordAndZ(ye,nt),lt=Xe.getTile(nt,it[1],it[2],be,Ye);if(!(lt instanceof ImageTile||lt instanceof ReprojTile)||lt instanceof ReprojTile&&lt.getState()===TileState.EMPTY)return null;if(lt.getState()!==TileState.LOADED)continue;const ct=Je.getOrigin(nt),ot=toSize(Je.getTileSize(nt)),dt=Je.getResolution(nt),ft=Math.floor(rt*((ye[0]-ct[0])/dt-it[1]*ot[0])),gt=Math.floor(rt*((ct[1]-ye[1])/dt-it[2]*ot[1])),mt=Math.round(rt*Xe.getGutterForProjection(Ke.projection));return this.getImageData(lt.getImage(),ft+mt,gt+mt)}return null}loadedTileCallback(Z,ee,ae){return this.isDrawableTile(ae)?super.loadedTileCallback(Z,ee,ae):!1}prepareFrame(Z){return!!this.getLayer().getSource()}renderFrame(Z,ee){const ae=Z.layerStatesArray[Z.layerIndex],ye=Z.viewState,ve=ye.projection,be=ye.resolution,Ye=ye.center,Ke=ye.rotation,Xe=Z.pixelRatio,Je=this.getLayer(),rt=Je.getSource(),nt=rt.getRevision(),it=rt.getTileGridForProjection(ve),lt=it.getZForResolution(be,rt.zDirection),ct=it.getResolution(lt);let ot=Z.extent;const dt=Z.viewState.resolution,ft=rt.getTilePixelRatio(Xe),gt=Math.round(getWidth(ot)/dt*Xe),mt=Math.round(getHeight(ot)/dt*Xe),Yr=ae.extent&&fromUserExtent(ae.extent,ve);Yr&&(ot=getIntersection(ot,fromUserExtent(ae.extent,ve)));const Qr=ct*gt/2/ft,Xr=ct*mt/2/ft,Jr=[Ye[0]-Qr,Ye[1]-Xr,Ye[0]+Qr,Ye[1]+Xr],ai=it.getTileRangeForExtentAndZ(ot,lt),oi={};oi[lt]={};const ni=this.createLoadedTileFinder(rt,ve,oi),li=this.tmpExtent,ui=this.tmpTileRange_;this.newTiles_=!1;const mi=Ke?getRotatedViewport(ye.center,dt,Ke,Z.size):void 0;for(let Mi=ai.minX;Mi<=ai.maxX;++Mi)for(let Ci=ai.minY;Ci<=ai.maxY;++Ci){if(Ke&&!it.tileCoordIntersectsViewport([lt,Mi,Ci],mi))continue;const Ri=this.getTile(lt,Mi,Ci,Z);if(this.isDrawableTile(Ri)){const ki=getUid(this);if(Ri.getState()==TileState.LOADED){oi[lt][Ri.tileCoord.toString()]=Ri;let Yi=Ri.inTransition(ki);Yi&&ae.opacity!==1&&(Ri.endTransition(ki),Yi=!1),!this.newTiles_&&(Yi||!this.renderedTiles.includes(Ri))&&(this.newTiles_=!0)}if(Ri.getAlpha(ki,Z.time)===1)continue}const Ni=it.getTileCoordChildTileRange(Ri.tileCoord,ui,li);let Ai=!1;Ni&&(Ai=ni(lt+1,Ni)),Ai||it.forEachTileCoordParentTileRange(Ri.tileCoord,ni,ui,li)}const ii=ct/be*Xe/ft;compose$1(this.pixelTransform,Z.size[0]/2,Z.size[1]/2,1/Xe,1/Xe,Ke,-gt/2,-mt/2);const hi=toString$1(this.pixelTransform);this.useContainer(ee,hi,this.getBackground(Z));const ri=this.context,ci=ri.canvas;makeInverse(this.inversePixelTransform,this.pixelTransform),compose$1(this.tempTransform,gt/2,mt/2,ii,ii,0,-gt/2,-mt/2),ci.width!=gt||ci.height!=mt?(ci.width=gt,ci.height=mt):this.containerReused||ri.clearRect(0,0,gt,mt),Yr&&this.clipUnrotated(ri,Z,Yr),rt.getInterpolate()||(ri.imageSmoothingEnabled=!1),this.preRender(ri,Z),this.renderedTiles.length=0;let Si=Object.keys(oi).map(Number);Si.sort(ascending);let si,Ei,yi;ae.opacity===1&&(!this.containerReused||rt.getOpaque(Z.viewState.projection))?Si=Si.reverse():(si=[],Ei=[]);for(let Mi=Si.length-1;Mi>=0;--Mi){const Ci=Si[Mi],Ri=rt.getTilePixelSize(Ci,Xe,ve),Ni=it.getResolution(Ci)/ct,Ai=Ri[0]*Ni*ii,ki=Ri[1]*Ni*ii,Yi=it.getTileCoordForCoordAndZ(getTopLeft(Jr),Ci),Ji=it.getTileCoordExtent(Yi),ls=apply(this.tempTransform,[ft*(Ji[0]-Jr[0])/ct,ft*(Jr[3]-Ji[3])/ct]),hs=ft*rt.getGutterForProjection(ve),Kr=oi[Ci];for(const di in Kr){const wi=Kr[di],Ii=wi.tileCoord,Di=Yi[1]-Ii[1],is=Math.round(ls[0]-(Di-1)*Ai),Gi=Yi[2]-Ii[2],us=Math.round(ls[1]-(Gi-1)*ki),Zi=Math.round(ls[0]-Di*Ai),ns=Math.round(ls[1]-Gi*ki),Ki=is-Zi,ds=us-ns,as=lt===Ci,ms=as&&wi.getAlpha(getUid(this),Z.time)!==1;let vs=!1;if(!ms)if(si){yi=[Zi,ns,Zi+Ki,ns,Zi+Ki,ns+ds,Zi,ns+ds];for(let zs=0,Zs=si.length;zs<Zs;++zs)if(lt!==Ci&&Ci<Ei[zs]){const Ts=si[zs];intersects$1([Zi,ns,Zi+Ki,ns+ds],[Ts[0],Ts[3],Ts[4],Ts[7]])&&(vs||(ri.save(),vs=!0),ri.beginPath(),ri.moveTo(yi[0],yi[1]),ri.lineTo(yi[2],yi[3]),ri.lineTo(yi[4],yi[5]),ri.lineTo(yi[6],yi[7]),ri.moveTo(Ts[6],Ts[7]),ri.lineTo(Ts[4],Ts[5]),ri.lineTo(Ts[2],Ts[3]),ri.lineTo(Ts[0],Ts[1]),ri.clip())}si.push(yi),Ei.push(Ci)}else ri.clearRect(Zi,ns,Ki,ds);this.drawTileImage(wi,Z,Zi,ns,Ki,ds,hs,as),si&&!ms?(vs&&ri.restore(),this.renderedTiles.unshift(wi)):this.renderedTiles.push(wi),this.updateUsedTiles(Z.usedTiles,rt,wi)}}return this.renderedRevision=nt,this.renderedResolution=ct,this.extentChanged=!this.renderedExtent_||!equals$1(this.renderedExtent_,Jr),this.renderedExtent_=Jr,this.renderedPixelRatio=Xe,this.renderedProjection=ve,this.manageTilePyramid(Z,rt,it,Xe,ve,ot,lt,Je.getPreload()),this.scheduleExpireCache(Z,rt),this.postRender(ri,Z),ae.extent&&ri.restore(),ri.imageSmoothingEnabled=!0,hi!==ci.style.transform&&(ci.style.transform=hi),this.container}drawTileImage(Z,ee,ae,ye,ve,be,Ye,Ke){const Xe=this.getTileImage(Z);if(!Xe)return;const Je=getUid(this),rt=ee.layerStatesArray[ee.layerIndex],nt=rt.opacity*(Ke?Z.getAlpha(Je,ee.time):1),it=nt!==this.context.globalAlpha;it&&(this.context.save(),this.context.globalAlpha=nt),this.context.drawImage(Xe,Ye,Ye,Xe.width-2*Ye,Xe.height-2*Ye,ae,ye,ve,be),it&&this.context.restore(),nt!==rt.opacity?ee.animate=!0:Ke&&Z.endTransition(Je)}getImage(){const Z=this.context;return Z?Z.canvas:null}getTileImage(Z){return Z.getImage()}scheduleExpireCache(Z,ee){if(ee.canExpireCache()){const ae=(function(ye,ve,be){const Ye=getUid(ye);Ye in be.usedTiles&&ye.expireCache(be.viewState.projection,be.usedTiles[Ye])}).bind(null,ee);Z.postRenderFunctions.push(ae)}}updateUsedTiles(Z,ee,ae){const ye=getUid(ee);ye in Z||(Z[ye]={}),Z[ye][ae.getKey()]=!0}manageTilePyramid(Z,ee,ae,ye,ve,be,Ye,Ke,Xe){const Je=getUid(ee);Je in Z.wantedTiles||(Z.wantedTiles[Je]={});const rt=Z.wantedTiles[Je],nt=Z.tileQueue,it=ae.getMinZoom(),lt=Z.viewState.rotation,ct=lt?getRotatedViewport(Z.viewState.center,Z.viewState.resolution,lt,Z.size):void 0;let ot=0,dt,ft,gt,mt,Yr,Qr;for(Qr=it;Qr<=Ye;++Qr)for(ft=ae.getTileRangeForExtentAndZ(be,Qr,ft),gt=ae.getResolution(Qr),mt=ft.minX;mt<=ft.maxX;++mt)for(Yr=ft.minY;Yr<=ft.maxY;++Yr)lt&&!ae.tileCoordIntersectsViewport([Qr,mt,Yr],ct)||(Ye-Qr<=Ke?(++ot,dt=ee.getTile(Qr,mt,Yr,ye,ve),dt.getState()==TileState.IDLE&&(rt[dt.getKey()]=!0,nt.isKeyQueued(dt.getKey())||nt.enqueue([dt,Je,ae.getTileCoordCenter(dt.tileCoord),gt])),Xe!==void 0&&Xe(dt)):ee.useTile(Qr,mt,Yr,ve));ee.updateCacheSize(ot,ve)}}class TileLayer extends BaseTileLayer{constructor(Z){super(Z)}createRenderer(){return new CanvasTileLayerRenderer(this)}}const IMAGE_REPLAYS={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},VECTOR_REPLAYS={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class CanvasVectorTileLayerRenderer extends CanvasTileLayerRenderer{constructor(Z){super(Z),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.tmpTransform_=create$2()}prepareTile(Z,ee,ae){let ye;const ve=Z.getState();return(ve===TileState.LOADED||ve===TileState.ERROR)&&(this.updateExecutorGroup_(Z,ee,ae),this.tileImageNeedsRender_(Z)&&(ye=!0)),ye}getTile(Z,ee,ae,ye){const ve=ye.pixelRatio,be=ye.viewState,Ye=be.resolution,Ke=be.projection,Xe=this.getLayer(),Je=Xe.getSource().getTile(Z,ee,ae,ve,Ke),rt=ye.viewHints,nt=!(rt[ViewHint.ANIMATING]||rt[ViewHint.INTERACTING]);return(nt||!Je.wantedResolution)&&(Je.wantedResolution=Ye),this.prepareTile(Je,ve,Ke)&&(nt||Date.now()-ye.time<8)&&Xe.getRenderMode()!=="vector"&&this.renderTileImage_(Je,ye),super.getTile(Z,ee,ae,ye)}isDrawableTile(Z){const ee=this.getLayer();return super.isDrawableTile(Z)&&(ee.getRenderMode()==="vector"?getUid(ee)in Z.executorGroups:Z.hasContext(ee))}getTileImage(Z){return Z.getImage(this.getLayer())}prepareFrame(Z){const ee=this.getLayer().getRevision();return this.renderedLayerRevision_!==ee&&(this.renderedLayerRevision_=ee,this.renderedTiles.length=0),super.prepareFrame(Z)}updateExecutorGroup_(Z,ee,ae){const ye=this.getLayer(),ve=ye.getRevision(),be=ye.getRenderOrder()||null,Ye=Z.wantedResolution,Ke=Z.getReplayState(ye);if(!Ke.dirty&&Ke.renderedResolution===Ye&&Ke.renderedRevision==ve&&Ke.renderedRenderOrder==be)return;const Xe=ye.getSource(),Je=ye.getDeclutter(),rt=Xe.getTileGrid(),nt=Xe.getTileGridForProjection(ae).getTileCoordExtent(Z.wrappedTileCoord),it=Xe.getSourceTiles(ee,ae,Z),lt=getUid(ye);delete Z.hitDetectionImageData[lt],Z.executorGroups[lt]=[],Je&&(Z.declutterExecutorGroups[lt]=[]),Ke.dirty=!1;for(let ct=0,ot=it.length;ct<ot;++ct){const dt=it[ct];if(dt.getState()!=TileState.LOADED)continue;const ft=dt.tileCoord,gt=rt.getTileCoordExtent(ft),mt=getIntersection(nt,gt),Yr=buffer$1(mt,ye.getRenderBuffer()*Ye,this.tmpExtent),Qr=equals$1(gt,mt)?null:Yr,Xr=new BuilderGroup(0,Yr,Ye,ee),Jr=Je?new BuilderGroup(0,mt,Ye,ee):void 0,ai=getSquaredTolerance(Ye,ee),oi=function(ii){let hi;const ri=ii.getStyleFunction()||ye.getStyleFunction();if(ri&&(hi=ri(ii,Ye)),hi){const ci=this.renderFeature(ii,ai,hi,Xr,Jr);Ke.dirty=Ke.dirty||ci}},ni=dt.getFeatures();be&&be!==Ke.renderedRenderOrder&&ni.sort(be);for(let ii=0,hi=ni.length;ii<hi;++ii){const ri=ni[ii];(!Qr||intersects$1(Qr,ri.getGeometry().getExtent()))&&oi.call(this,ri)}const li=Xr.finish(),ui=ye.getRenderMode()!=="vector"&&Je&&it.length===1?null:mt,mi=new ExecutorGroup(ui,Ye,ee,Xe.getOverlaps(),li,ye.getRenderBuffer());if(Z.executorGroups[lt].push(mi),Jr){const ii=new ExecutorGroup(null,Ye,ee,Xe.getOverlaps(),Jr.finish(),ye.getRenderBuffer());Z.declutterExecutorGroups[lt].push(ii)}}Ke.renderedRevision=ve,Ke.renderedRenderOrder=be,Ke.renderedResolution=Ye}forEachFeatureAtCoordinate(Z,ee,ae,ye,ve){const be=ee.viewState.resolution,Ye=ee.viewState.rotation;ae=ae??0;const Ke=this.getLayer(),Xe=Ke.getSource().getTileGridForProjection(ee.viewState.projection),Je=boundingExtent([Z]);buffer$1(Je,be*ae,Je);const rt={},nt=function(ct,ot,dt){let ft=ct.getId();ft===void 0&&(ft=getUid(ct));const gt=rt[ft];if(gt){if(gt!==!0&&dt<gt.distanceSq){if(dt===0)return rt[ft]=!0,ve.splice(ve.lastIndexOf(gt),1),ye(ct,Ke,ot);gt.geometry=ot,gt.distanceSq=dt}}else{if(dt===0)return rt[ft]=!0,ye(ct,Ke,ot);ve.push(rt[ft]={feature:ct,layer:Ke,geometry:ot,distanceSq:dt,callback:ye})}},it=this.renderedTiles;let lt;for(let ct=0,ot=it.length;!lt&&ct<ot;++ct){const dt=it[ct],ft=Xe.getTileCoordExtent(dt.wrappedTileCoord);if(!intersects$1(ft,Je))continue;const gt=getUid(Ke),mt=[dt.executorGroups[gt]],Yr=dt.declutterExecutorGroups[gt];Yr&&mt.push(Yr),mt.some(Qr=>{const Xr=Qr===Yr?ee.declutterTree.all().map(Jr=>Jr.value):null;for(let Jr=0,ai=Qr.length;Jr<ai;++Jr)if(lt=Qr[Jr].forEachFeatureAtCoordinate(Z,be,Ye,ae,nt,Xr),lt)return!0})}return lt}getFeatures(Z){return new Promise((ee,ae)=>{const ye=this.getLayer(),ve=getUid(ye),be=ye.getSource(),Ye=this.renderedProjection,Ke=Ye.getExtent(),Xe=this.renderedResolution,Je=be.getTileGridForProjection(Ye),rt=apply(this.renderedPixelToCoordinateTransform_,Z.slice()),nt=Je.getTileCoordForCoordAndResolution(rt,Xe);let it;for(let gt=0,mt=this.renderedTiles.length;gt<mt;++gt)if(nt.toString()===this.renderedTiles[gt].tileCoord.toString()){if(it=this.renderedTiles[gt],it.getState()===TileState.LOADED){const Yr=Je.getTileCoordExtent(it.tileCoord);be.getWrapX()&&Ye.canWrapX()&&!containsExtent(Ke,Yr)&&wrapX$1(rt,Ye);break}it=void 0}if(!it||it.loadingSourceTiles>0){ee([]);return}const lt=Je.getTileCoordExtent(it.wrappedTileCoord),ct=getTopLeft(lt),ot=[(rt[0]-ct[0])/Xe,(ct[1]-rt[1])/Xe],dt=it.getSourceTiles().reduce(function(gt,mt){return gt.concat(mt.getFeatures())},[]);let ft=it.hitDetectionImageData[ve];if(!ft){const gt=toSize(Je.getTileSize(Je.getZForResolution(Xe,be.zDirection))),mt=this.renderedRotation_,Yr=[this.getRenderTransform(Je.getTileCoordCenter(it.wrappedTileCoord),Xe,0,HIT_DETECT_RESOLUTION,gt[0]*HIT_DETECT_RESOLUTION,gt[1]*HIT_DETECT_RESOLUTION,0)];ft=createHitDetectionImageData(gt,Yr,dt,ye.getStyleFunction(),Je.getTileCoordExtent(it.wrappedTileCoord),it.getReplayState(ye).renderedResolution,mt),it.hitDetectionImageData[ve]=ft}ee(hitDetect(ot,dt,ft))})}handleFontsChanged(){const Z=this.getLayer();Z.getVisible()&&this.renderedLayerRevision_!==void 0&&Z.changed()}handleStyleImageChange_(Z){this.renderIfReadyAndVisible()}renderDeclutter(Z){const ee=this.context,ae=ee.globalAlpha;ee.globalAlpha=this.getLayer().getOpacity();const ye=Z.viewHints,ve=!(ye[ViewHint.ANIMATING]||ye[ViewHint.INTERACTING]),be=this.renderedTiles;for(let Ye=0,Ke=be.length;Ye<Ke;++Ye){const Xe=be[Ye],Je=Xe.declutterExecutorGroups[getUid(this.getLayer())];if(Je)for(let rt=Je.length-1;rt>=0;--rt)Je[rt].execute(this.context,1,this.getTileRenderTransform(Xe,Z),Z.viewState.rotation,ve,void 0,Z.declutterTree)}ee.globalAlpha=ae}getTileRenderTransform(Z,ee){const ae=ee.pixelRatio,ye=ee.viewState,ve=ye.center,be=ye.resolution,Ye=ye.rotation,Ke=ee.size,Xe=Math.round(Ke[0]*ae),Je=Math.round(Ke[1]*ae),rt=this.getLayer().getSource().getTileGridForProjection(ee.viewState.projection),nt=Z.tileCoord,it=rt.getTileCoordExtent(Z.wrappedTileCoord),lt=rt.getTileCoordExtent(nt,this.tmpExtent)[0]-it[0];return multiply(scale$3(this.inversePixelTransform.slice(),1/ae,1/ae),this.getRenderTransform(ve,be,Ye,ae,Xe,Je,lt))}postRender(Z,ee){const ae=ee.viewHints,ye=!(ae[ViewHint.ANIMATING]||ae[ViewHint.INTERACTING]);this.renderedPixelToCoordinateTransform_=ee.pixelToCoordinateTransform.slice(),this.renderedRotation_=ee.viewState.rotation;const ve=this.getLayer(),be=ve.getRenderMode(),Ye=Z.globalAlpha;Z.globalAlpha=ve.getOpacity();const Ke=VECTOR_REPLAYS[be],Xe=ee.viewState,Je=Xe.rotation,rt=ve.getSource(),nt=rt.getTileGridForProjection(Xe.projection).getZForResolution(Xe.resolution,rt.zDirection),it=this.renderedTiles,lt=[],ct=[];let ot=!0;for(let dt=it.length-1;dt>=0;--dt){const ft=it[dt];ot=ot&&!ft.getReplayState(ve).dirty;const gt=ft.executorGroups[getUid(ve)].filter(Jr=>Jr.hasExecutors(Ke));if(gt.length===0)continue;const mt=this.getTileRenderTransform(ft,ee),Yr=ft.tileCoord[0];let Qr=!1;const Xr=gt[0].getClipCoords(mt);if(Xr){for(let Jr=0,ai=lt.length;Jr<ai;++Jr)if(nt!==Yr&&Yr<ct[Jr]){const oi=lt[Jr];intersects$1([Xr[0],Xr[3],Xr[4],Xr[7]],[oi[0],oi[3],oi[4],oi[7]])&&(Qr||(Z.save(),Qr=!0),Z.beginPath(),Z.moveTo(Xr[0],Xr[1]),Z.lineTo(Xr[2],Xr[3]),Z.lineTo(Xr[4],Xr[5]),Z.lineTo(Xr[6],Xr[7]),Z.moveTo(oi[6],oi[7]),Z.lineTo(oi[4],oi[5]),Z.lineTo(oi[2],oi[3]),Z.lineTo(oi[0],oi[1]),Z.clip())}lt.push(Xr),ct.push(Yr)}for(let Jr=0,ai=gt.length;Jr<ai;++Jr)gt[Jr].execute(Z,1,mt,Je,ye,Ke);Qr&&Z.restore()}Z.globalAlpha=Ye,this.ready=ot,super.postRender(Z,ee)}renderFeature(Z,ee,ae,ye,ve){if(!ae)return!1;let be=!1;if(Array.isArray(ae))for(let Ye=0,Ke=ae.length;Ye<Ke;++Ye)be=renderFeature(ye,Z,ae[Ye],ee,this.boundHandleStyleImageChange_,void 0,ve)||be;else be=renderFeature(ye,Z,ae,ee,this.boundHandleStyleImageChange_,void 0,ve);return be}tileImageNeedsRender_(Z){const ee=this.getLayer();if(ee.getRenderMode()==="vector")return!1;const ae=Z.getReplayState(ee),ye=ee.getRevision(),ve=Z.wantedResolution;return ae.renderedTileResolution!==ve||ae.renderedTileRevision!==ye}renderTileImage_(Z,ee){const ae=this.getLayer(),ye=Z.getReplayState(ae),ve=ae.getRevision(),be=Z.executorGroups[getUid(ae)];ye.renderedTileRevision=ve;const Ye=Z.wrappedTileCoord,Ke=Ye[0],Xe=ae.getSource();let Je=ee.pixelRatio;const rt=ee.viewState.projection,nt=Xe.getTileGridForProjection(rt),it=nt.getResolution(Z.tileCoord[0]),lt=ee.pixelRatio/Z.wantedResolution*it,ct=nt.getResolution(Ke),ot=Z.getContext(ae);Je=Math.round(Math.max(Je,lt/Je));const dt=Xe.getTilePixelSize(Ke,Je,rt);ot.canvas.width=dt[0],ot.canvas.height=dt[1];const ft=Je/lt;if(ft!==1){const Qr=reset(this.tmpTransform_);scale$3(Qr,ft,ft),ot.setTransform.apply(ot,Qr)}const gt=nt.getTileCoordExtent(Ye,this.tmpExtent),mt=lt/ct,Yr=reset(this.tmpTransform_);scale$3(Yr,mt,-mt),translate$1(Yr,-gt[0],-gt[3]);for(let Qr=0,Xr=be.length;Qr<Xr;++Qr)be[Qr].execute(ot,ft,Yr,0,!0,IMAGE_REPLAYS[ae.getRenderMode()]);ye.renderedTileResolution=Z.wantedResolution}}class VectorTileLayer extends BaseVectorLayer{constructor(Z){Z=Z||{};const ee=Object.assign({},Z);delete ee.preload,delete ee.useInterimTilesOnError,super(ee),this.on,this.once,this.un;const ae=Z.renderMode||"hybrid";assert(ae=="hybrid"||ae=="vector","`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=ae,this.setPreload(Z.preload?Z.preload:0),this.setUseInterimTilesOnError(Z.useInterimTilesOnError!==void 0?Z.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new CanvasVectorTileLayerRenderer(this)}getFeatures(Z){return super.getFeatures(Z)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(TileProperty.PRELOAD)}getUseInterimTilesOnError(){return this.get(TileProperty.USE_INTERIM_TILES_ON_ERROR)}setPreload(Z){this.set(TileProperty.PRELOAD,Z)}setUseInterimTilesOnError(Z){this.set(TileProperty.USE_INTERIM_TILES_ON_ERROR,Z)}}const TileEventType={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},tmpTileCoord=[0,0,0],DECIMALS=5;class TileGrid{constructor(Z){this.minZoom=Z.minZoom!==void 0?Z.minZoom:0,this.resolutions_=Z.resolutions,assert(isSorted(this.resolutions_,function(ye,ve){return ve-ye}),"`resolutions` must be sorted in descending order");let ee;if(!Z.origins){for(let ye=0,ve=this.resolutions_.length-1;ye<ve;++ye)if(!ee)ee=this.resolutions_[ye]/this.resolutions_[ye+1];else if(this.resolutions_[ye]/this.resolutions_[ye+1]!==ee){ee=void 0;break}}this.zoomFactor_=ee,this.maxZoom=this.resolutions_.length-1,this.origin_=Z.origin!==void 0?Z.origin:null,this.origins_=null,Z.origins!==void 0&&(this.origins_=Z.origins,assert(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const ae=Z.extent;ae!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=getTopLeft(ae)),assert(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,Z.tileSizes!==void 0&&(this.tileSizes_=Z.tileSizes,assert(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=Z.tileSize!==void 0?Z.tileSize:this.tileSizes_?null:DEFAULT_TILE_SIZE,assert(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=ae!==void 0?ae:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],Z.sizes!==void 0?this.fullTileRanges_=Z.sizes.map(function(ye,ve){const be=new TileRange(Math.min(0,ye[0]),Math.max(ye[0]-1,-1),Math.min(0,ye[1]),Math.max(ye[1]-1,-1));if(ae){const Ye=this.getTileRangeForExtentAndZ(ae,ve);be.minX=Math.max(Ye.minX,be.minX),be.maxX=Math.min(Ye.maxX,be.maxX),be.minY=Math.max(Ye.minY,be.minY),be.maxY=Math.min(Ye.maxY,be.maxY)}return be},this):ae&&this.calculateTileRanges_(ae)}forEachTileCoord(Z,ee,ae){const ye=this.getTileRangeForExtentAndZ(Z,ee);for(let ve=ye.minX,be=ye.maxX;ve<=be;++ve)for(let Ye=ye.minY,Ke=ye.maxY;Ye<=Ke;++Ye)ae([ee,ve,Ye])}forEachTileCoordParentTileRange(Z,ee,ae,ye){let ve,be,Ye,Ke=null,Xe=Z[0]-1;for(this.zoomFactor_===2?(be=Z[1],Ye=Z[2]):Ke=this.getTileCoordExtent(Z,ye);Xe>=this.minZoom;){if(this.zoomFactor_===2?(be=Math.floor(be/2),Ye=Math.floor(Ye/2),ve=createOrUpdate(be,be,Ye,Ye,ae)):ve=this.getTileRangeForExtentAndZ(Ke,Xe,ae),ee(Xe,ve))return!0;--Xe}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(Z){return this.origin_?this.origin_:this.origins_[Z]}getResolution(Z){return this.resolutions_[Z]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(Z,ee,ae){if(Z[0]<this.maxZoom){if(this.zoomFactor_===2){const ve=Z[1]*2,be=Z[2]*2;return createOrUpdate(ve,ve+1,be,be+1,ee)}const ye=this.getTileCoordExtent(Z,ae||this.tmpExtent_);return this.getTileRangeForExtentAndZ(ye,Z[0]+1,ee)}return null}getTileRangeForTileCoordAndZ(Z,ee,ae){if(ee>this.maxZoom||ee<this.minZoom)return null;const ye=Z[0],ve=Z[1],be=Z[2];if(ee===ye)return createOrUpdate(ve,be,ve,be,ae);if(this.zoomFactor_){const Ke=Math.pow(this.zoomFactor_,ee-ye),Xe=Math.floor(ve*Ke),Je=Math.floor(be*Ke);if(ee<ye)return createOrUpdate(Xe,Xe,Je,Je,ae);const rt=Math.floor(Ke*(ve+1))-1,nt=Math.floor(Ke*(be+1))-1;return createOrUpdate(Xe,rt,Je,nt,ae)}const Ye=this.getTileCoordExtent(Z,this.tmpExtent_);return this.getTileRangeForExtentAndZ(Ye,ee,ae)}getTileRangeForExtentAndZ(Z,ee,ae){this.getTileCoordForXYAndZ_(Z[0],Z[3],ee,!1,tmpTileCoord);const ye=tmpTileCoord[1],ve=tmpTileCoord[2];this.getTileCoordForXYAndZ_(Z[2],Z[1],ee,!0,tmpTileCoord);const be=tmpTileCoord[1],Ye=tmpTileCoord[2];return createOrUpdate(ye,be,ve,Ye,ae)}getTileCoordCenter(Z){const ee=this.getOrigin(Z[0]),ae=this.getResolution(Z[0]),ye=toSize(this.getTileSize(Z[0]),this.tmpSize_);return[ee[0]+(Z[1]+.5)*ye[0]*ae,ee[1]-(Z[2]+.5)*ye[1]*ae]}getTileCoordExtent(Z,ee){const ae=this.getOrigin(Z[0]),ye=this.getResolution(Z[0]),ve=toSize(this.getTileSize(Z[0]),this.tmpSize_),be=ae[0]+Z[1]*ve[0]*ye,Ye=ae[1]-(Z[2]+1)*ve[1]*ye,Ke=be+ve[0]*ye,Xe=Ye+ve[1]*ye;return createOrUpdate$2(be,Ye,Ke,Xe,ee)}getTileCoordForCoordAndResolution(Z,ee,ae){return this.getTileCoordForXYAndResolution_(Z[0],Z[1],ee,!1,ae)}getTileCoordForXYAndResolution_(Z,ee,ae,ye,ve){const be=this.getZForResolution(ae),Ye=ae/this.getResolution(be),Ke=this.getOrigin(be),Xe=toSize(this.getTileSize(be),this.tmpSize_);let Je=Ye*(Z-Ke[0])/ae/Xe[0],rt=Ye*(Ke[1]-ee)/ae/Xe[1];return ye?(Je=ceil(Je,DECIMALS)-1,rt=ceil(rt,DECIMALS)-1):(Je=floor$1(Je,DECIMALS),rt=floor$1(rt,DECIMALS)),createOrUpdate$1(be,Je,rt,ve)}getTileCoordForXYAndZ_(Z,ee,ae,ye,ve){const be=this.getOrigin(ae),Ye=this.getResolution(ae),Ke=toSize(this.getTileSize(ae),this.tmpSize_);let Xe=(Z-be[0])/Ye/Ke[0],Je=(be[1]-ee)/Ye/Ke[1];return ye?(Xe=ceil(Xe,DECIMALS)-1,Je=ceil(Je,DECIMALS)-1):(Xe=floor$1(Xe,DECIMALS),Je=floor$1(Je,DECIMALS)),createOrUpdate$1(ae,Xe,Je,ve)}getTileCoordForCoordAndZ(Z,ee,ae){return this.getTileCoordForXYAndZ_(Z[0],Z[1],ee,!1,ae)}getTileCoordResolution(Z){return this.resolutions_[Z[0]]}getTileSize(Z){return this.tileSize_?this.tileSize_:this.tileSizes_[Z]}getFullTileRange(Z){return this.fullTileRanges_?this.fullTileRanges_[Z]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,Z):null}getZForResolution(Z,ee){const ae=linearFindNearest(this.resolutions_,Z,ee||0);return clamp$1(ae,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(Z,ee){return intersectsLinearRing(ee,0,ee.length,2,this.getTileCoordExtent(Z))}calculateTileRanges_(Z){const ee=this.resolutions_.length,ae=new Array(ee);for(let ye=this.minZoom;ye<ee;++ye)ae[ye]=this.getTileRangeForExtentAndZ(Z,ye);this.fullTileRanges_=ae}}function getForProjection(ie){let Z=ie.getDefaultTileGrid();return Z||(Z=createForProjection(ie),ie.setDefaultTileGrid(Z)),Z}function wrapX(ie,Z,ee){const ae=Z[0],ye=ie.getTileCoordCenter(Z),ve=extentFromProjection(ee);if(!containsCoordinate(ve,ye)){const be=getWidth(ve),Ye=Math.ceil((ve[0]-ye[0])/be);return ye[0]+=be*Ye,ie.getTileCoordForCoordAndZ(ye,ae)}return Z}function createForExtent(ie,Z,ee,ae){ae=ae!==void 0?ae:"top-left";const ye=resolutionsFromExtent(ie,Z,ee);return new TileGrid({extent:ie,origin:getCorner(ie,ae),resolutions:ye,tileSize:ee})}function createXYZ(ie){const Z=ie||{},ee=Z.extent||get$1("EPSG:3857").getExtent(),ae={extent:ee,minZoom:Z.minZoom,tileSize:Z.tileSize,resolutions:resolutionsFromExtent(ee,Z.maxZoom,Z.tileSize,Z.maxResolution)};return new TileGrid(ae)}function resolutionsFromExtent(ie,Z,ee,ae){Z=Z!==void 0?Z:DEFAULT_MAX_ZOOM,ee=toSize(ee!==void 0?ee:DEFAULT_TILE_SIZE);const ye=getHeight(ie),ve=getWidth(ie);ae=ae>0?ae:Math.max(ve/ee[0],ye/ee[1]);const be=Z+1,Ye=new Array(be);for(let Ke=0;Ke<be;++Ke)Ye[Ke]=ae/Math.pow(2,Ke);return Ye}function createForProjection(ie,Z,ee,ae){const ye=extentFromProjection(ie);return createForExtent(ye,Z,ee,ae)}function extentFromProjection(ie){ie=get$1(ie);let Z=ie.getExtent();if(!Z){const ee=180*METERS_PER_UNIT$1.degrees/ie.getMetersPerUnit();Z=createOrUpdate$2(-ee,-ee,ee,ee)}return Z}class TileSource extends Source{constructor(Z){super({attributions:Z.attributions,attributionsCollapsible:Z.attributionsCollapsible,projection:Z.projection,state:Z.state,wrapX:Z.wrapX,interpolate:Z.interpolate}),this.on,this.once,this.un,this.opaque_=Z.opaque!==void 0?Z.opaque:!1,this.tilePixelRatio_=Z.tilePixelRatio!==void 0?Z.tilePixelRatio:1,this.tileGrid=Z.tileGrid!==void 0?Z.tileGrid:null;const ee=[256,256];this.tileGrid&&toSize(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),ee),this.tileCache=new TileCache(Z.cacheSize||0),this.tmpSize=[0,0],this.key_=Z.key||"",this.tileOptions={transition:Z.transition,interpolate:Z.interpolate},this.zDirection=Z.zDirection?Z.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(Z,ee){const ae=this.getTileCacheForProjection(Z);ae&&ae.expireCache(ee)}forEachLoadedTile(Z,ee,ae,ye){const ve=this.getTileCacheForProjection(Z);if(!ve)return!1;let be=!0,Ye,Ke,Xe;for(let Je=ae.minX;Je<=ae.maxX;++Je)for(let rt=ae.minY;rt<=ae.maxY;++rt)Ke=getKeyZXY(ee,Je,rt),Xe=!1,ve.containsKey(Ke)&&(Ye=ve.get(Ke),Xe=Ye.getState()===TileState.LOADED,Xe&&(Xe=ye(Ye)!==!1)),Xe||(be=!1);return be}getGutterForProjection(Z){return 0}getKey(){return this.key_}setKey(Z){this.key_!==Z&&(this.key_=Z,this.changed())}getOpaque(Z){return this.opaque_}getResolutions(Z){const ee=Z?this.getTileGridForProjection(Z):this.tileGrid;return ee?ee.getResolutions():null}getTile(Z,ee,ae,ye,ve){return abstract()}getTileGrid(){return this.tileGrid}getTileGridForProjection(Z){return this.tileGrid?this.tileGrid:getForProjection(Z)}getTileCacheForProjection(Z){const ee=this.getProjection();return assert(ee===null||equivalent(ee,Z),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(Z){return this.tilePixelRatio_}getTilePixelSize(Z,ee,ae){const ye=this.getTileGridForProjection(ae),ve=this.getTilePixelRatio(ee),be=toSize(ye.getTileSize(Z),this.tmpSize);return ve==1?be:scale(be,ve,this.tmpSize)}getTileCoordForTileUrlFunction(Z,ee){ee=ee!==void 0?ee:this.getProjection();const ae=this.getTileGridForProjection(ee);return this.getWrapX()&&ee.isGlobal()&&(Z=wrapX(ae,Z,ee)),withinExtentAndZ(Z,ae)?Z:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(Z,ee){const ae=this.getTileCacheForProjection(ee);Z>ae.highWaterMark&&(ae.highWaterMark=Z)}useTile(Z,ee,ae,ye){}}class TileSourceEvent extends BaseEvent{constructor(Z,ee){super(Z),this.tile=ee}}function createFromTemplate(ie,Z){const ee=/\{z\}/g,ae=/\{x\}/g,ye=/\{y\}/g,ve=/\{-y\}/g;return function(be,Ye,Ke){if(be)return ie.replace(ee,be[0].toString()).replace(ae,be[1].toString()).replace(ye,be[2].toString()).replace(ve,function(){const Xe=be[0],Je=Z.getFullTileRange(Xe);return assert(Je,"The {-y} placeholder requires a tile grid with extent"),(Je.getHeight()-be[2]-1).toString()})}}function createFromTemplates(ie,Z){const ee=ie.length,ae=new Array(ee);for(let ye=0;ye<ee;++ye)ae[ye]=createFromTemplate(ie[ye],Z);return createFromTileUrlFunctions(ae)}function createFromTileUrlFunctions(ie){return ie.length===1?ie[0]:function(Z,ee,ae){if(!Z)return;const ye=hash$2(Z),ve=modulo(ye,ie.length);return ie[ve](Z,ee,ae)}}function expandUrl(ie){const Z=[];let ee=/\{([a-z])-([a-z])\}/.exec(ie);if(ee){const ae=ee[1].charCodeAt(0),ye=ee[2].charCodeAt(0);let ve;for(ve=ae;ve<=ye;++ve)Z.push(ie.replace(ee[0],String.fromCharCode(ve)));return Z}if(ee=/\{(\d+)-(\d+)\}/.exec(ie),ee){const ae=parseInt(ee[2],10);for(let ye=parseInt(ee[1],10);ye<=ae;ye++)Z.push(ie.replace(ee[0],ye.toString()));return Z}return Z.push(ie),Z}class UrlTile extends TileSource{constructor(Z){super({attributions:Z.attributions,cacheSize:Z.cacheSize,opaque:Z.opaque,projection:Z.projection,state:Z.state,tileGrid:Z.tileGrid,tilePixelRatio:Z.tilePixelRatio,wrapX:Z.wrapX,transition:Z.transition,interpolate:Z.interpolate,key:Z.key,attributionsCollapsible:Z.attributionsCollapsible,zDirection:Z.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===UrlTile.prototype.tileUrlFunction,this.tileLoadFunction=Z.tileLoadFunction,Z.tileUrlFunction&&(this.tileUrlFunction=Z.tileUrlFunction),this.urls=null,Z.urls?this.setUrls(Z.urls):Z.url&&this.setUrl(Z.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(Z){const ee=Z.target,ae=getUid(ee),ye=ee.getState();let ve;ye==TileState.LOADING?(this.tileLoadingKeys_[ae]=!0,ve=TileEventType.TILELOADSTART):ae in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[ae],ve=ye==TileState.ERROR?TileEventType.TILELOADERROR:ye==TileState.LOADED?TileEventType.TILELOADEND:void 0),ve!=null&&this.dispatchEvent(new TileSourceEvent(ve,ee))}setTileLoadFunction(Z){this.tileCache.clear(),this.tileLoadFunction=Z,this.changed()}setTileUrlFunction(Z,ee){this.tileUrlFunction=Z,this.tileCache.pruneExceptNewestZ(),typeof ee<"u"?this.setKey(ee):this.changed()}setUrl(Z){const ee=expandUrl(Z);this.urls=ee,this.setUrls(ee)}setUrls(Z){this.urls=Z;const ee=Z.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(createFromTemplates(Z,this.tileGrid),ee):this.setKey(ee)}tileUrlFunction(Z,ee,ae){}useTile(Z,ee,ae){const ye=getKeyZXY(Z,ee,ae);this.tileCache.containsKey(ye)&&this.tileCache.get(ye)}}class TileImage extends UrlTile{constructor(Z){super({attributions:Z.attributions,cacheSize:Z.cacheSize,opaque:Z.opaque,projection:Z.projection,state:Z.state,tileGrid:Z.tileGrid,tileLoadFunction:Z.tileLoadFunction?Z.tileLoadFunction:defaultTileLoadFunction,tilePixelRatio:Z.tilePixelRatio,tileUrlFunction:Z.tileUrlFunction,url:Z.url,urls:Z.urls,wrapX:Z.wrapX,transition:Z.transition,interpolate:Z.interpolate!==void 0?Z.interpolate:!0,key:Z.key,attributionsCollapsible:Z.attributionsCollapsible,zDirection:Z.zDirection}),this.crossOrigin=Z.crossOrigin!==void 0?Z.crossOrigin:null,this.tileClass=Z.tileClass!==void 0?Z.tileClass:ImageTile,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=Z.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const Z in this.tileCacheForProjection)if(this.tileCacheForProjection[Z].canExpireCache())return!0;return!1}expireCache(Z,ee){const ae=this.getTileCacheForProjection(Z);this.tileCache.expireCache(this.tileCache==ae?ee:{});for(const ye in this.tileCacheForProjection){const ve=this.tileCacheForProjection[ye];ve.expireCache(ve==ae?ee:{})}}getGutterForProjection(Z){return this.getProjection()&&Z&&!equivalent(this.getProjection(),Z)?0:this.getGutter()}getGutter(){return 0}getKey(){let Z=super.getKey();return this.getInterpolate()||(Z+=":disable-interpolation"),Z}getOpaque(Z){return this.getProjection()&&Z&&!equivalent(this.getProjection(),Z)?!1:super.getOpaque(Z)}getTileGridForProjection(Z){const ee=this.getProjection();if(this.tileGrid&&(!ee||equivalent(ee,Z)))return this.tileGrid;const ae=getUid(Z);return ae in this.tileGridForProjection||(this.tileGridForProjection[ae]=getForProjection(Z)),this.tileGridForProjection[ae]}getTileCacheForProjection(Z){const ee=this.getProjection();if(!ee||equivalent(ee,Z))return this.tileCache;const ae=getUid(Z);return ae in this.tileCacheForProjection||(this.tileCacheForProjection[ae]=new TileCache(this.tileCache.highWaterMark)),this.tileCacheForProjection[ae]}createTile_(Z,ee,ae,ye,ve,be){const Ye=[Z,ee,ae],Ke=this.getTileCoordForTileUrlFunction(Ye,ve),Xe=Ke?this.tileUrlFunction(Ke,ye,ve):void 0,Je=new this.tileClass(Ye,Xe!==void 0?TileState.IDLE:TileState.EMPTY,Xe!==void 0?Xe:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return Je.key=be,Je.addEventListener(EventType.CHANGE,this.handleTileChange.bind(this)),Je}getTile(Z,ee,ae,ye,ve){const be=this.getProjection();if(!be||!ve||equivalent(be,ve))return this.getTileInternal(Z,ee,ae,ye,be||ve);const Ye=this.getTileCacheForProjection(ve),Ke=[Z,ee,ae];let Xe;const Je=getKey(Ke);Ye.containsKey(Je)&&(Xe=Ye.get(Je));const rt=this.getKey();if(Xe&&Xe.key==rt)return Xe;const nt=this.getTileGridForProjection(be),it=this.getTileGridForProjection(ve),lt=this.getTileCoordForTileUrlFunction(Ke,ve),ct=new ReprojTile(be,nt,ve,it,Ke,lt,this.getTilePixelRatio(ye),this.getGutter(),(ot,dt,ft,gt)=>this.getTileInternal(ot,dt,ft,gt,be),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return ct.key=rt,Xe?(ct.interimTile=Xe,ct.refreshInterimChain(),Ye.replace(Je,ct)):Ye.set(Je,ct),ct}getTileInternal(Z,ee,ae,ye,ve){let be=null;const Ye=getKeyZXY(Z,ee,ae),Ke=this.getKey();if(!this.tileCache.containsKey(Ye))be=this.createTile_(Z,ee,ae,ye,ve,Ke),this.tileCache.set(Ye,be);else if(be=this.tileCache.get(Ye),be.key!=Ke){const Xe=be;be=this.createTile_(Z,ee,ae,ye,ve,Ke),Xe.getState()==TileState.IDLE?be.interimTile=Xe.interimTile:be.interimTile=Xe,be.refreshInterimChain(),this.tileCache.replace(Ye,be)}return be}setRenderReprojectionEdges(Z){if(this.renderReprojectionEdges_!=Z){this.renderReprojectionEdges_=Z;for(const ee in this.tileCacheForProjection)this.tileCacheForProjection[ee].clear();this.changed()}}setTileGridForProjection(Z,ee){const ae=get$1(Z);if(ae){const ye=getUid(ae);ye in this.tileGridForProjection||(this.tileGridForProjection[ye]=ee)}}clear(){super.clear();for(const Z in this.tileCacheForProjection)this.tileCacheForProjection[Z].clear()}}function defaultTileLoadFunction(ie,Z){ie.getImage().src=Z}class XYZ extends TileImage{constructor(Z){Z=Z||{};const ee=Z.projection!==void 0?Z.projection:"EPSG:3857",ae=Z.tileGrid!==void 0?Z.tileGrid:createXYZ({extent:extentFromProjection(ee),maxResolution:Z.maxResolution,maxZoom:Z.maxZoom,minZoom:Z.minZoom,tileSize:Z.tileSize});super({attributions:Z.attributions,cacheSize:Z.cacheSize,crossOrigin:Z.crossOrigin,interpolate:Z.interpolate,opaque:Z.opaque,projection:ee,reprojectionErrorThreshold:Z.reprojectionErrorThreshold,tileGrid:ae,tileLoadFunction:Z.tileLoadFunction,tilePixelRatio:Z.tilePixelRatio,tileUrlFunction:Z.tileUrlFunction,url:Z.url,urls:Z.urls,wrapX:Z.wrapX!==void 0?Z.wrapX:!0,transition:Z.transition,attributionsCollapsible:Z.attributionsCollapsible,zDirection:Z.zDirection}),this.gutter_=Z.gutter!==void 0?Z.gutter:0}getGutter(){return this.gutter_}}class GeometryCollection extends Geometry{constructor(Z){super(),this.geometries_=Z||null,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(unlistenByKey),this.changeEventsKeys_.length=0}listenGeometriesChange_(){if(this.geometries_)for(let Z=0,ee=this.geometries_.length;Z<ee;++Z)this.changeEventsKeys_.push(listen(this.geometries_[Z],EventType.CHANGE,this.changed,this))}clone(){const Z=new GeometryCollection(null);return Z.setGeometries(this.geometries_),Z.applyProperties(this),Z}closestPointXY(Z,ee,ae,ye){if(ye<closestSquaredDistanceXY(this.getExtent(),Z,ee))return ye;const ve=this.geometries_;for(let be=0,Ye=ve.length;be<Ye;++be)ye=ve[be].closestPointXY(Z,ee,ae,ye);return ye}containsXY(Z,ee){const ae=this.geometries_;for(let ye=0,ve=ae.length;ye<ve;++ye)if(ae[ye].containsXY(Z,ee))return!0;return!1}computeExtent(Z){createOrUpdateEmpty(Z);const ee=this.geometries_;for(let ae=0,ye=ee.length;ae<ye;++ae)extend$1(Z,ee[ae].getExtent());return Z}getGeometries(){return cloneGeometries(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let Z=[];const ee=this.geometries_;for(let ae=0,ye=ee.length;ae<ye;++ae)ee[ae].getType()===this.getType()?Z=Z.concat(ee[ae].getGeometriesArrayRecursive()):Z.push(ee[ae]);return Z}getSimplifiedGeometry(Z){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),Z<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&Z<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const ee=[],ae=this.geometries_;let ye=!1;for(let ve=0,be=ae.length;ve<be;++ve){const Ye=ae[ve],Ke=Ye.getSimplifiedGeometry(Z);ee.push(Ke),Ke!==Ye&&(ye=!0)}if(ye){const ve=new GeometryCollection(null);return ve.setGeometriesArray(ee),ve}return this.simplifiedGeometryMaxMinSquaredTolerance=Z,this}getType(){return"GeometryCollection"}intersectsExtent(Z){const ee=this.geometries_;for(let ae=0,ye=ee.length;ae<ye;++ae)if(ee[ae].intersectsExtent(Z))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(Z,ee){const ae=this.geometries_;for(let ye=0,ve=ae.length;ye<ve;++ye)ae[ye].rotate(Z,ee);this.changed()}scale(Z,ee,ae){ae||(ae=getCenter(this.getExtent()));const ye=this.geometries_;for(let ve=0,be=ye.length;ve<be;++ve)ye[ve].scale(Z,ee,ae);this.changed()}setGeometries(Z){this.setGeometriesArray(cloneGeometries(Z))}setGeometriesArray(Z){this.unlistenGeometriesChange_(),this.geometries_=Z,this.listenGeometriesChange_(),this.changed()}applyTransform(Z){const ee=this.geometries_;for(let ae=0,ye=ee.length;ae<ye;++ae)ee[ae].applyTransform(Z);this.changed()}translate(Z,ee){const ae=this.geometries_;for(let ye=0,ve=ae.length;ye<ve;++ye)ae[ye].translate(Z,ee);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function cloneGeometries(ie){const Z=[];for(let ee=0,ae=ie.length;ee<ae;++ee)Z.push(ie[ee].clone());return Z}const GeometryCollection$1=GeometryCollection;class FeatureFormat{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.supportedMediaTypes=null}getReadOptions(Z,ee){if(ee){let ae=ee.dataProjection?get$1(ee.dataProjection):this.readProjection(Z);ee.extent&&ae&&ae.getUnits()==="tile-pixels"&&(ae=get$1(ae),ae.setWorldExtent(ee.extent)),ee={dataProjection:ae,featureProjection:ee.featureProjection}}return this.adaptOptions(ee)}adaptOptions(Z){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},Z)}getType(){return abstract()}readFeature(Z,ee){return abstract()}readFeatures(Z,ee){return abstract()}readGeometry(Z,ee){return abstract()}readProjection(Z){return abstract()}writeFeature(Z,ee){return abstract()}writeFeatures(Z,ee){return abstract()}writeGeometry(Z,ee){return abstract()}}function transformGeometryWithOptions(ie,Z,ee){const ae=ee?get$1(ee.featureProjection):null,ye=ee?get$1(ee.dataProjection):null;let ve;if(ae&&ye&&!equivalent(ae,ye)?ve=(Z?ie.clone():ie).transform(Z?ae:ye,Z?ye:ae):ve=ie,Z&&ee&&ee.decimals!==void 0){const be=Math.pow(10,ee.decimals),Ye=function(Ke){for(let Xe=0,Je=Ke.length;Xe<Je;++Xe)Ke[Xe]=Math.round(Ke[Xe]*be)/be;return Ke};ve===ie&&(ve=ie.clone()),ve.applyTransform(Ye)}return ve}class JSONFeature extends FeatureFormat{constructor(){super()}getType(){return"json"}readFeature(Z,ee){return this.readFeatureFromObject(getObject(Z),this.getReadOptions(Z,ee))}readFeatures(Z,ee){return this.readFeaturesFromObject(getObject(Z),this.getReadOptions(Z,ee))}readFeatureFromObject(Z,ee){return abstract()}readFeaturesFromObject(Z,ee){return abstract()}readGeometry(Z,ee){return this.readGeometryFromObject(getObject(Z),this.getReadOptions(Z,ee))}readGeometryFromObject(Z,ee){return abstract()}readProjection(Z){return this.readProjectionFromObject(getObject(Z))}readProjectionFromObject(Z){return abstract()}writeFeature(Z,ee){return JSON.stringify(this.writeFeatureObject(Z,ee))}writeFeatureObject(Z,ee){return abstract()}writeFeatures(Z,ee){return JSON.stringify(this.writeFeaturesObject(Z,ee))}writeFeaturesObject(Z,ee){return abstract()}writeGeometry(Z,ee){return JSON.stringify(this.writeGeometryObject(Z,ee))}writeGeometryObject(Z,ee){return abstract()}}function getObject(ie){return typeof ie=="string"?JSON.parse(ie)||null:ie!==null?ie:null}class MultiLineString extends SimpleGeometry{constructor(Z,ee,ae){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(Z[0]))this.setCoordinates(Z,ee);else if(ee!==void 0&&ae)this.setFlatCoordinates(ee,Z),this.ends_=ae;else{let ye=this.getLayout();const ve=Z,be=[],Ye=[];for(let Ke=0,Xe=ve.length;Ke<Xe;++Ke){const Je=ve[Ke];Ke===0&&(ye=Je.getLayout()),extend$2(be,Je.getFlatCoordinates()),Ye.push(be.length)}this.setFlatCoordinates(ye,be),this.ends_=Ye}}appendLineString(Z){this.flatCoordinates?extend$2(this.flatCoordinates,Z.getFlatCoordinates().slice()):this.flatCoordinates=Z.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const Z=new MultiLineString(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return Z.applyProperties(this),Z}closestPointXY(Z,ee,ae,ye){return ye<closestSquaredDistanceXY(this.getExtent(),Z,ee)?ye:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(arrayMaxSquaredDelta(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestArrayPoint(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,Z,ee,ae,ye))}getCoordinateAtM(Z,ee,ae){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(ee=ee!==void 0?ee:!1,ae=ae!==void 0?ae:!1,lineStringsCoordinateAtM(this.flatCoordinates,0,this.ends_,this.stride,Z,ee,ae))}getCoordinates(){return inflateCoordinatesArray(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(Z){return Z<0||this.ends_.length<=Z?null:new LineString$1(this.flatCoordinates.slice(Z===0?0:this.ends_[Z-1],this.ends_[Z]),this.layout)}getLineStrings(){const Z=this.flatCoordinates,ee=this.ends_,ae=this.layout,ye=[];let ve=0;for(let be=0,Ye=ee.length;be<Ye;++be){const Ke=ee[be],Xe=new LineString$1(Z.slice(ve,Ke),ae);ye.push(Xe),ve=Ke}return ye}getFlatMidpoints(){const Z=[],ee=this.flatCoordinates;let ae=0;const ye=this.ends_,ve=this.stride;for(let be=0,Ye=ye.length;be<Ye;++be){const Ke=ye[be],Xe=interpolatePoint(ee,ae,Ke,ve,.5);extend$2(Z,Xe),ae=Ke}return Z}getSimplifiedGeometryInternal(Z){const ee=[],ae=[];return ee.length=douglasPeuckerArray(this.flatCoordinates,0,this.ends_,this.stride,Z,ee,0,ae),new MultiLineString(ee,"XY",ae)}getType(){return"MultiLineString"}intersectsExtent(Z){return intersectsLineStringArray(this.flatCoordinates,0,this.ends_,this.stride,Z)}setCoordinates(Z,ee){this.setLayout(ee,Z,2),this.flatCoordinates||(this.flatCoordinates=[]);const ae=deflateCoordinatesArray(this.flatCoordinates,0,Z,this.stride,this.ends_);this.flatCoordinates.length=ae.length===0?0:ae[ae.length-1],this.changed()}}const MultiLineString$1=MultiLineString;class MultiPoint extends SimpleGeometry{constructor(Z,ee){super(),ee&&!Array.isArray(Z[0])?this.setFlatCoordinates(ee,Z):this.setCoordinates(Z,ee)}appendPoint(Z){this.flatCoordinates?extend$2(this.flatCoordinates,Z.getFlatCoordinates()):this.flatCoordinates=Z.getFlatCoordinates().slice(),this.changed()}clone(){const Z=new MultiPoint(this.flatCoordinates.slice(),this.layout);return Z.applyProperties(this),Z}closestPointXY(Z,ee,ae,ye){if(ye<closestSquaredDistanceXY(this.getExtent(),Z,ee))return ye;const ve=this.flatCoordinates,be=this.stride;for(let Ye=0,Ke=ve.length;Ye<Ke;Ye+=be){const Xe=squaredDistance(Z,ee,ve[Ye],ve[Ye+1]);if(Xe<ye){ye=Xe;for(let Je=0;Je<be;++Je)ae[Je]=ve[Ye+Je];ae.length=be}}return ye}getCoordinates(){return inflateCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(Z){const ee=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return Z<0||ee<=Z?null:new Point$1(this.flatCoordinates.slice(Z*this.stride,(Z+1)*this.stride),this.layout)}getPoints(){const Z=this.flatCoordinates,ee=this.layout,ae=this.stride,ye=[];for(let ve=0,be=Z.length;ve<be;ve+=ae){const Ye=new Point$1(Z.slice(ve,ve+ae),ee);ye.push(Ye)}return ye}getType(){return"MultiPoint"}intersectsExtent(Z){const ee=this.flatCoordinates,ae=this.stride;for(let ye=0,ve=ee.length;ye<ve;ye+=ae){const be=ee[ye],Ye=ee[ye+1];if(containsXY(Z,be,Ye))return!0}return!1}setCoordinates(Z,ee){this.setLayout(ee,Z,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinates(this.flatCoordinates,0,Z,this.stride),this.changed()}}const MultiPoint$1=MultiPoint;function linearRingss(ie,Z,ee,ae){const ye=[];let ve=createEmpty();for(let be=0,Ye=ee.length;be<Ye;++be){const Ke=ee[be];ve=createOrUpdateFromFlatCoordinates(ie,Z,Ke[0],ae),ye.push((ve[0]+ve[2])/2,(ve[1]+ve[3])/2),Z=Ke[Ke.length-1]}return ye}class MultiPolygon extends SimpleGeometry{constructor(Z,ee,ae){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!ae&&!Array.isArray(Z[0])){let ye=this.getLayout();const ve=Z,be=[],Ye=[];for(let Ke=0,Xe=ve.length;Ke<Xe;++Ke){const Je=ve[Ke];Ke===0&&(ye=Je.getLayout());const rt=be.length,nt=Je.getEnds();for(let it=0,lt=nt.length;it<lt;++it)nt[it]+=rt;extend$2(be,Je.getFlatCoordinates()),Ye.push(nt)}ee=ye,Z=be,ae=Ye}ee!==void 0&&ae?(this.setFlatCoordinates(ee,Z),this.endss_=ae):this.setCoordinates(Z,ee)}appendPolygon(Z){let ee;if(!this.flatCoordinates)this.flatCoordinates=Z.getFlatCoordinates().slice(),ee=Z.getEnds().slice(),this.endss_.push();else{const ae=this.flatCoordinates.length;extend$2(this.flatCoordinates,Z.getFlatCoordinates()),ee=Z.getEnds().slice();for(let ye=0,ve=ee.length;ye<ve;++ye)ee[ye]+=ae}this.endss_.push(ee),this.changed()}clone(){const Z=this.endss_.length,ee=new Array(Z);for(let ye=0;ye<Z;++ye)ee[ye]=this.endss_[ye].slice();const ae=new MultiPolygon(this.flatCoordinates.slice(),this.layout,ee);return ae.applyProperties(this),ae}closestPointXY(Z,ee,ae,ye){return ye<closestSquaredDistanceXY(this.getExtent(),Z,ee)?ye:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(multiArrayMaxSquaredDelta(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestMultiArrayPoint(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,Z,ee,ae,ye))}containsXY(Z,ee){return linearRingssContainsXY(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,Z,ee)}getArea(){return linearRingss$1(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(Z){let ee;return Z!==void 0?(ee=this.getOrientedFlatCoordinates().slice(),orientLinearRingsArray(ee,0,this.endss_,this.stride,Z)):ee=this.flatCoordinates,inflateMultiCoordinatesArray(ee,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const Z=linearRingss(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=getInteriorPointsOfMultiArray(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,Z),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new MultiPoint$1(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const Z=this.flatCoordinates;linearRingssAreOriented(Z,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=Z:(this.orientedFlatCoordinates_=Z.slice(),this.orientedFlatCoordinates_.length=orientLinearRingsArray(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(Z){const ee=[],ae=[];return ee.length=quantizeMultiArray(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(Z),ee,0,ae),new MultiPolygon(ee,"XY",ae)}getPolygon(Z){if(Z<0||this.endss_.length<=Z)return null;let ee;if(Z===0)ee=0;else{const ve=this.endss_[Z-1];ee=ve[ve.length-1]}const ae=this.endss_[Z].slice(),ye=ae[ae.length-1];if(ee!==0)for(let ve=0,be=ae.length;ve<be;++ve)ae[ve]-=ee;return new Polygon$1(this.flatCoordinates.slice(ee,ye),this.layout,ae)}getPolygons(){const Z=this.layout,ee=this.flatCoordinates,ae=this.endss_,ye=[];let ve=0;for(let be=0,Ye=ae.length;be<Ye;++be){const Ke=ae[be].slice(),Xe=Ke[Ke.length-1];if(ve!==0)for(let rt=0,nt=Ke.length;rt<nt;++rt)Ke[rt]-=ve;const Je=new Polygon$1(ee.slice(ve,Xe),Z,Ke);ye.push(Je),ve=Xe}return ye}getType(){return"MultiPolygon"}intersectsExtent(Z){return intersectsLinearRingMultiArray(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,Z)}setCoordinates(Z,ee){this.setLayout(ee,Z,3),this.flatCoordinates||(this.flatCoordinates=[]);const ae=deflateMultiCoordinatesArray(this.flatCoordinates,0,Z,this.stride,this.endss_);if(ae.length===0)this.flatCoordinates.length=0;else{const ye=ae[ae.length-1];this.flatCoordinates.length=ye.length===0?0:ye[ye.length-1]}this.changed()}}const MultiPolygon$1=MultiPolygon;class GeoJSON extends JSONFeature{constructor(Z){Z=Z||{},super(),this.dataProjection=get$1(Z.dataProjection?Z.dataProjection:"EPSG:4326"),Z.featureProjection&&(this.defaultFeatureProjection=get$1(Z.featureProjection)),this.geometryName_=Z.geometryName,this.extractGeometryName_=Z.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(Z,ee){let ae=null;Z.type==="Feature"?ae=Z:ae={type:"Feature",geometry:Z,properties:null};const ye=readGeometry(ae.geometry,ee),ve=new Feature;return this.geometryName_?ve.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in ae!==void 0&&ve.setGeometryName(ae.geometry_name),ve.setGeometry(ye),"id"in ae&&ve.setId(ae.id),ae.properties&&ve.setProperties(ae.properties,!0),ve}readFeaturesFromObject(Z,ee){const ae=Z;let ye=null;if(ae.type==="FeatureCollection"){const ve=Z;ye=[];const be=ve.features;for(let Ye=0,Ke=be.length;Ye<Ke;++Ye)ye.push(this.readFeatureFromObject(be[Ye],ee))}else ye=[this.readFeatureFromObject(Z,ee)];return ye}readGeometryFromObject(Z,ee){return readGeometry(Z,ee)}readProjectionFromObject(Z){const ee=Z.crs;let ae;if(ee)if(ee.type=="name")ae=get$1(ee.properties.name);else if(ee.type==="EPSG")ae=get$1("EPSG:"+ee.properties.code);else throw new Error("Unknown SRS type");else ae=this.dataProjection;return ae}writeFeatureObject(Z,ee){ee=this.adaptOptions(ee);const ae={type:"Feature",geometry:null,properties:null},ye=Z.getId();if(ye!==void 0&&(ae.id=ye),!Z.hasProperties())return ae;const ve=Z.getProperties(),be=Z.getGeometry();return be&&(ae.geometry=writeGeometry(be,ee),delete ve[Z.getGeometryName()]),isEmpty$1(ve)||(ae.properties=ve),ae}writeFeaturesObject(Z,ee){ee=this.adaptOptions(ee);const ae=[];for(let ye=0,ve=Z.length;ye<ve;++ye)ae.push(this.writeFeatureObject(Z[ye],ee));return{type:"FeatureCollection",features:ae}}writeGeometryObject(Z,ee){return writeGeometry(Z,this.adaptOptions(ee))}}function readGeometry(ie,Z){if(!ie)return null;let ee;switch(ie.type){case"Point":{ee=readPointGeometry(ie);break}case"LineString":{ee=readLineStringGeometry(ie);break}case"Polygon":{ee=readPolygonGeometry(ie);break}case"MultiPoint":{ee=readMultiPointGeometry(ie);break}case"MultiLineString":{ee=readMultiLineStringGeometry(ie);break}case"MultiPolygon":{ee=readMultiPolygonGeometry(ie);break}case"GeometryCollection":{ee=readGeometryCollectionGeometry(ie);break}default:throw new Error("Unsupported GeoJSON type: "+ie.type)}return transformGeometryWithOptions(ee,!1,Z)}function readGeometryCollectionGeometry(ie,Z){const ee=ie.geometries.map(function(ae){return readGeometry(ae,Z)});return new GeometryCollection$1(ee)}function readPointGeometry(ie){return new Point$1(ie.coordinates)}function readLineStringGeometry(ie){return new LineString$1(ie.coordinates)}function readMultiLineStringGeometry(ie){return new MultiLineString$1(ie.coordinates)}function readMultiPointGeometry(ie){return new MultiPoint$1(ie.coordinates)}function readMultiPolygonGeometry(ie){return new MultiPolygon$1(ie.coordinates)}function readPolygonGeometry(ie){return new Polygon$1(ie.coordinates)}function writeGeometry(ie,Z){ie=transformGeometryWithOptions(ie,!0,Z);const ee=ie.getType();let ae;switch(ee){case"Point":{ae=writePointGeometry(ie);break}case"LineString":{ae=writeLineStringGeometry(ie);break}case"Polygon":{ae=writePolygonGeometry(ie,Z);break}case"MultiPoint":{ae=writeMultiPointGeometry(ie);break}case"MultiLineString":{ae=writeMultiLineStringGeometry(ie);break}case"MultiPolygon":{ae=writeMultiPolygonGeometry(ie,Z);break}case"GeometryCollection":{ae=writeGeometryCollectionGeometry(ie,Z);break}case"Circle":{ae={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+ee)}return ae}function writeGeometryCollectionGeometry(ie,Z){return Z=Object.assign({},Z),delete Z.featureProjection,{type:"GeometryCollection",geometries:ie.getGeometriesArray().map(function(ee){return writeGeometry(ee,Z)})}}function writeLineStringGeometry(ie,Z){return{type:"LineString",coordinates:ie.getCoordinates()}}function writeMultiLineStringGeometry(ie,Z){return{type:"MultiLineString",coordinates:ie.getCoordinates()}}function writeMultiPointGeometry(ie,Z){return{type:"MultiPoint",coordinates:ie.getCoordinates()}}function writeMultiPolygonGeometry(ie,Z){let ee;return Z&&(ee=Z.rightHanded),{type:"MultiPolygon",coordinates:ie.getCoordinates(ee)}}function writePointGeometry(ie,Z){return{type:"Point",coordinates:ie.getCoordinates()}}function writePolygonGeometry(ie,Z){let ee;return Z&&(ee=Z.rightHanded),{type:"Polygon",coordinates:ie.getCoordinates(ee)}}function asImageLike(ie){return ie instanceof Image||ie instanceof HTMLCanvasElement||ie instanceof HTMLVideoElement||ie instanceof ImageBitmap?ie:null}function asArrayLike(ie){return ie instanceof Uint8Array||ie instanceof Uint8ClampedArray||ie instanceof Float32Array||ie instanceof DataView?ie:null}let sharedContext=null;function toArray(ie){sharedContext||(sharedContext=createCanvasContext2D(ie.width,ie.height,void 0,{willReadFrequently:!0}));const Z=sharedContext.canvas,ee=ie.width;Z.width!==ee&&(Z.width=ee);const ae=ie.height;return Z.height!==ae&&(Z.height=ae),sharedContext.clearRect(0,0,ee,ae),sharedContext.drawImage(ie,0,0),sharedContext.getImageData(0,0,ee,ae).data}const defaultSize=[256,256];class DataTile extends Tile{constructor(Z){const ee=TileState.IDLE;super(Z.tileCoord,ee,{transition:Z.transition,interpolate:Z.interpolate}),this.loader_=Z.loader,this.data_=null,this.error_=null,this.size_=Z.size||null}getSize(){if(this.size_)return this.size_;const Z=asImageLike(this.data_);return Z?[Z.width,Z.height]:defaultSize}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==TileState.IDLE&&this.state!==TileState.ERROR)return;this.state=TileState.LOADING,this.changed();const Z=this;this.loader_().then(function(ee){Z.data_=ee,Z.state=TileState.LOADED,Z.changed()}).catch(function(ee){Z.error_=ee,Z.state=TileState.ERROR,Z.changed()})}}class ReprojDataTile extends DataTile{constructor(Z){super({tileCoord:Z.tileCoord,loader:()=>Promise.resolve(new Uint8Array(4)),interpolate:Z.interpolate,transition:Z.transition}),this.pixelRatio_=Z.pixelRatio,this.gutter_=Z.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=Z.sourceTileGrid,this.targetTileGrid_=Z.targetTileGrid,this.wrappedTileCoord_=Z.wrappedTileCoord||Z.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const ee=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),ae=this.targetTileGrid_.getExtent();let ye=this.sourceTileGrid_.getExtent();const ve=ae?getIntersection(ee,ae):ee;if(getArea(ve)===0){this.state=TileState.EMPTY;return}const be=Z.sourceProj,Ye=be.getExtent();Ye&&(ye?ye=getIntersection(ye,Ye):ye=Ye);const Ke=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),Xe=Z.targetProj,Je=calculateSourceExtentResolution(be,Xe,ve,Ke);if(!isFinite(Je)||Je<=0){this.state=TileState.EMPTY;return}const rt=Z.errorThreshold!==void 0?Z.errorThreshold:ERROR_THRESHOLD;if(this.triangulation_=new Triangulation(be,Xe,ve,ye,Je*rt,Ke),this.triangulation_.getTriangles().length===0){this.state=TileState.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(Je);let nt=this.triangulation_.calculateSourceExtent();if(ye&&(be.canWrapX()?(nt[1]=clamp$1(nt[1],ye[1],ye[3]),nt[3]=clamp$1(nt[3],ye[1],ye[3])):nt=getIntersection(nt,ye)),!getArea(nt))this.state=TileState.EMPTY;else{const it=this.sourceTileGrid_.getTileRangeForExtentAndZ(nt,this.sourceZ_),lt=Z.getTileFunction;for(let ct=it.minX;ct<=it.maxX;ct++)for(let ot=it.minY;ot<=it.maxY;ot++){const dt=lt(this.sourceZ_,ct,ot,this.pixelRatio_);dt&&this.sourceTiles_.push(dt)}this.sourceTiles_.length===0&&(this.state=TileState.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const Z=[];if(this.sourceTiles_.forEach(ee=>{if(!ee||ee.getState()!==TileState.LOADED)return;const ae=ee.getSize(),ye=this.gutter_;let ve;const be=asArrayLike(ee.getData());be?ve=be:ve=toArray(asImageLike(ee.getData()));const Ye=[ae[0]+2*ye,ae[1]+2*ye],Ke=ve instanceof Float32Array,Xe=Ye[0]*Ye[1],Je=Ke?Float32Array:Uint8Array,rt=new Je(ve.buffer),nt=Je.BYTES_PER_ELEMENT,it=nt*rt.length/Xe,lt=rt.byteLength/Ye[1],ct=Math.floor(lt/nt/Ye[0]),ot=Xe*ct;let dt=rt;if(rt.length!==ot){dt=new Je(ot);let ft=0,gt=0;const mt=Ye[0]*ct;for(let Yr=0;Yr<Ye[1];++Yr){for(let Qr=0;Qr<mt;++Qr)dt[ft++]=rt[gt+Qr];gt+=lt/nt}}Z.push({extent:this.sourceTileGrid_.getTileCoordExtent(ee.tileCoord),data:new Uint8Array(dt.buffer),dataType:Je,bytesPerPixel:it,pixelSize:Ye})}),this.sourceTiles_.length=0,Z.length===0)this.state=TileState.ERROR;else{const ee=this.wrappedTileCoord_[0],ae=this.targetTileGrid_.getTileSize(ee),ye=typeof ae=="number"?ae:ae[0],ve=typeof ae=="number"?ae:ae[1],be=this.targetTileGrid_.getResolution(ee),Ye=this.sourceTileGrid_.getResolution(this.sourceZ_),Ke=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);let Xe,Je;const rt=Z[0].bytesPerPixel,nt=Math.ceil(rt/3);for(let it=nt-1;it>=0;--it){const lt=[];for(let mt=0,Yr=Z.length;mt<Yr;++mt){const Qr=Z[mt],Xr=Qr.data,Jr=Qr.pixelSize,ai=Jr[0],oi=Jr[1],ni=createCanvasContext2D(ai,oi,canvasPool),li=ni.createImageData(ai,oi),ui=li.data;let mi=it*3;for(let ii=0,hi=ui.length;ii<hi;ii+=4)ui[ii]=Xr[mi],ui[ii+1]=Xr[mi+1],ui[ii+2]=Xr[mi+2],ui[ii+3]=255,mi+=rt;ni.putImageData(li,0,0),lt.push({extent:Qr.extent,image:ni.canvas})}const ct=render$1(ye,ve,this.pixelRatio_,Ye,this.sourceTileGrid_.getExtent(),be,Ke,this.triangulation_,lt,this.gutter_,!1,!1);for(let mt=0,Yr=lt.length;mt<Yr;++mt){const Qr=lt[mt].image.getContext("2d");releaseCanvas$1(Qr),canvasPool.push(Qr.canvas)}const ot=ct.getContext("2d"),dt=ot.getImageData(0,0,ct.width,ct.height);releaseCanvas$1(ot),canvasPool.push(ct),Xe||(Je=new Uint8Array(rt*dt.width*dt.height),Xe=new Z[0].dataType(Je.buffer));const ft=dt.data;let gt=it*3;for(let mt=0,Yr=ft.length;mt<Yr;mt+=4)ft[mt+3]===255?(Je[gt]=ft[mt],Je[gt+1]=ft[mt+1],Je[gt+2]=ft[mt+2]):(Je[gt]=0,Je[gt+1]=0,Je[gt+2]=0),gt+=rt}this.reprojData_=Xe,this.reprojSize_=[Math.round(ye*this.pixelRatio_),Math.round(ve*this.pixelRatio_)],this.state=TileState.LOADED}this.changed()}load(){if(this.state!==TileState.IDLE&&this.state!==TileState.ERROR)return;this.state=TileState.LOADING,this.changed();let Z=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(ee=>{const ae=ee.getState();if(ae!==TileState.IDLE&&ae!==TileState.LOADING)return;Z++;const ye=listen(ee,EventType.CHANGE,function(){const ve=ee.getState();(ve==TileState.LOADED||ve==TileState.ERROR||ve==TileState.EMPTY)&&(unlistenByKey(ye),Z--,Z===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(ye)}),Z===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(ee){ee.getState()==TileState.IDLE&&ee.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(unlistenByKey),this.sourcesListenerKeys_=null}}class DataTileSource extends TileSource{constructor(Z){const ee=Z.projection===void 0?"EPSG:3857":Z.projection;let ae=Z.tileGrid;ae===void 0&&ee&&(ae=createXYZ({extent:extentFromProjection(ee),maxResolution:Z.maxResolution,maxZoom:Z.maxZoom,minZoom:Z.minZoom,tileSize:Z.tileSize})),super({cacheSize:.1,attributions:Z.attributions,attributionsCollapsible:Z.attributionsCollapsible,projection:ee,tileGrid:ae,opaque:Z.opaque,state:Z.state,wrapX:Z.wrapX,transition:Z.transition,interpolate:Z.interpolate}),this.gutter_=Z.gutter!==void 0?Z.gutter:0,this.tileSize_=Z.tileSize?toSize(Z.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=Z.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=Z.bandCount===void 0?4:Z.bandCount,this.tileGridForProjection_={},this.tileCacheForProjection_={}}setTileSizes(Z){this.tileSizes_=Z}getTileSize(Z){if(this.tileSizes_)return this.tileSizes_[Z];if(this.tileSize_)return this.tileSize_;const ee=this.getTileGrid();return ee?toSize(ee.getTileSize(Z)):[256,256]}getGutterForProjection(Z){const ee=this.getProjection();return!ee||equivalent(ee,Z)?this.gutter_:0}setLoader(Z){this.loader_=Z}getReprojTile_(Z,ee,ae,ye,ve){const be=this.getTileCacheForProjection(ye),Ye=getKeyZXY(Z,ee,ae);if(be.containsKey(Ye)){const ot=be.get(Ye);if(ot&&ot.key==this.getKey())return ot}const Ke=this.getTileGrid(),Xe=Math.max.apply(null,Ke.getResolutions().map((ot,dt)=>{const ft=toSize(Ke.getTileSize(dt)),gt=this.getTileSize(dt);return Math.max(gt[0]/ft[0],gt[1]/ft[1])})),Je=this.getTileGridForProjection(ve),rt=this.getTileGridForProjection(ye),nt=[Z,ee,ae],it=this.getTileCoordForTileUrlFunction(nt,ye),lt=Object.assign({sourceProj:ve,sourceTileGrid:Je,targetProj:ye,targetTileGrid:rt,tileCoord:nt,wrappedTileCoord:it,pixelRatio:Xe,gutter:this.getGutterForProjection(ve),getTileFunction:(ot,dt,ft,gt)=>this.getTile(ot,dt,ft,gt,ve)},this.tileOptions),ct=new ReprojDataTile(lt);return ct.key=this.getKey(),ct}getTile(Z,ee,ae,ye,ve){const be=this.getProjection();if(be&&ve&&!equivalent(be,ve))return this.getReprojTile_(Z,ee,ae,ve,be);const Ye=this.getTileSize(Z),Ke=getKeyZXY(Z,ee,ae);if(this.tileCache.containsKey(Ke))return this.tileCache.get(Ke);const Xe=this.loader_;function Je(){return toPromise(function(){return Xe(Z,ee,ae)})}const rt=Object.assign({tileCoord:[Z,ee,ae],loader:Je,size:Ye},this.tileOptions),nt=new DataTile(rt);return nt.key=this.getKey(),nt.addEventListener(EventType.CHANGE,this.handleTileChange_),this.tileCache.set(Ke,nt),nt}handleTileChange_(Z){const ee=Z.target,ae=getUid(ee),ye=ee.getState();let ve;ye==TileState.LOADING?(this.tileLoadingKeys_[ae]=!0,ve=TileEventType.TILELOADSTART):ae in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[ae],ve=ye==TileState.ERROR?TileEventType.TILELOADERROR:ye==TileState.LOADED?TileEventType.TILELOADEND:void 0),ve&&this.dispatchEvent(new TileSourceEvent(ve,ee))}getTileGridForProjection(Z){const ee=this.getProjection();if(this.tileGrid&&(!ee||equivalent(ee,Z)))return this.tileGrid;const ae=getUid(Z);return ae in this.tileGridForProjection_||(this.tileGridForProjection_[ae]=getForProjection(Z)),this.tileGridForProjection_[ae]}setTileGridForProjection(Z,ee){const ae=get$1(Z);if(ae){const ye=getUid(ae);ye in this.tileGridForProjection_||(this.tileGridForProjection_[ye]=ee)}}getTileCacheForProjection(Z){const ee=this.getProjection();if(!ee||equivalent(ee,Z))return this.tileCache;const ae=getUid(Z);return ae in this.tileCacheForProjection_||(this.tileCacheForProjection_[ae]=new TileCache(.1)),this.tileCacheForProjection_[ae]}expireCache(Z,ee){const ae=this.getTileCacheForProjection(Z);this.tileCache.expireCache(this.tileCache==ae?ee:{});for(const ye in this.tileCacheForProjection_){const ve=this.tileCacheForProjection_[ye];ve.expireCache(ve==ae?ee:{})}}clear(){super.clear();for(const Z in this.tileCacheForProjection_)this.tileCacheForProjection_[Z].clear()}}function uncurryThis(ie){return(Z,...ee)=>ReflectApply(ie,Z,ee)}function uncurryThisGetter(ie,Z){return uncurryThis(ReflectGetOwnPropertyDescriptor(ie,Z).get)}const{apply:ReflectApply,construct:ReflectConstruct,defineProperty:ReflectDefineProperty,get:ReflectGet,getOwnPropertyDescriptor:ReflectGetOwnPropertyDescriptor,getPrototypeOf:ReflectGetPrototypeOf,has:ReflectHas,ownKeys:ReflectOwnKeys,set:ReflectSet,setPrototypeOf:ReflectSetPrototypeOf}=Reflect,{iterator:SymbolIterator,species:SymbolSpecies,toStringTag:SymbolToStringTag,for:SymbolFor}=Symbol,NativeObject=Object,{create:ObjectCreate,defineProperty:ObjectDefineProperty,freeze:ObjectFreeze,is:ObjectIs}=NativeObject,NativeArray=Array,ArrayPrototype=NativeArray.prototype,NativeArrayPrototypeSymbolIterator=ArrayPrototype[SymbolIterator],ArrayPrototypeSymbolIterator=uncurryThis(NativeArrayPrototypeSymbolIterator),NativeArrayBuffer=ArrayBuffer,ArrayBufferPrototype=NativeArrayBuffer.prototype;uncurryThisGetter(ArrayBufferPrototype,"byteLength");const NativeSharedArrayBuffer=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;NativeSharedArrayBuffer&&uncurryThisGetter(NativeSharedArrayBuffer.prototype,"byteLength");const TypedArray=ReflectGetPrototypeOf(Uint8Array);TypedArray.from;const TypedArrayPrototype=TypedArray.prototype;TypedArrayPrototype[SymbolIterator];uncurryThis(TypedArrayPrototype.keys);uncurryThis(TypedArrayPrototype.values);uncurryThis(TypedArrayPrototype.entries);uncurryThis(TypedArrayPrototype.set);uncurryThis(TypedArrayPrototype.reverse);uncurryThis(TypedArrayPrototype.fill);uncurryThis(TypedArrayPrototype.copyWithin);uncurryThis(TypedArrayPrototype.sort);uncurryThis(TypedArrayPrototype.slice);uncurryThis(TypedArrayPrototype.subarray);uncurryThisGetter(TypedArrayPrototype,"buffer");uncurryThisGetter(TypedArrayPrototype,"byteOffset");uncurryThisGetter(TypedArrayPrototype,"length");uncurryThisGetter(TypedArrayPrototype,SymbolToStringTag);const NativeUint8Array=Uint8Array,NativeUint16Array=Uint16Array,NativeUint32Array=Uint32Array,NativeFloat32Array=Float32Array,ArrayIteratorPrototype=ReflectGetPrototypeOf([][SymbolIterator]()),ArrayIteratorPrototypeNext=uncurryThis(ArrayIteratorPrototype.next),GeneratorPrototypeNext=uncurryThis(function*(){}().next),IteratorPrototype=ReflectGetPrototypeOf(ArrayIteratorPrototype),DataViewPrototype=DataView.prototype,DataViewPrototypeGetUint16=uncurryThis(DataViewPrototype.getUint16),NativeWeakMap=WeakMap,WeakMapPrototype=NativeWeakMap.prototype,WeakMapPrototypeGet=uncurryThis(WeakMapPrototype.get),WeakMapPrototypeSet=uncurryThis(WeakMapPrototype.set),arrayIterators=new NativeWeakMap,SafeIteratorPrototype=ObjectCreate(null,{next:{value:function(){const ie=WeakMapPrototypeGet(arrayIterators,this);return ArrayIteratorPrototypeNext(ie)}},[SymbolIterator]:{value:function(){return this}}});function safeIfNeeded(ie){if(ie[SymbolIterator]===NativeArrayPrototypeSymbolIterator&&ArrayIteratorPrototype.next===ArrayIteratorPrototypeNext)return ie;const Z=ObjectCreate(SafeIteratorPrototype);return WeakMapPrototypeSet(arrayIterators,Z,ArrayPrototypeSymbolIterator(ie)),Z}const generators=new NativeWeakMap,DummyArrayIteratorPrototype=ObjectCreate(IteratorPrototype,{next:{value:function(){const ie=WeakMapPrototypeGet(generators,this);return GeneratorPrototypeNext(ie)},writable:!0,configurable:!0}});for(const ie of ReflectOwnKeys(ArrayIteratorPrototype))ie!=="next"&&ObjectDefineProperty(DummyArrayIteratorPrototype,ie,ReflectGetOwnPropertyDescriptor(ArrayIteratorPrototype,ie));const buffer=new NativeArrayBuffer(4),floatView=new NativeFloat32Array(buffer),uint32View=new NativeUint32Array(buffer),baseTable=new NativeUint16Array(512),shiftTable=new NativeUint8Array(512);for(let ie=0;ie<256;++ie){const Z=ie-127;Z<-27?(baseTable[ie]=0,baseTable[ie|256]=32768,shiftTable[ie]=24,shiftTable[ie|256]=24):Z<-14?(baseTable[ie]=1024>>-Z-14,baseTable[ie|256]=1024>>-Z-14|32768,shiftTable[ie]=-Z-1,shiftTable[ie|256]=-Z-1):Z<=15?(baseTable[ie]=Z+15<<10,baseTable[ie|256]=Z+15<<10|32768,shiftTable[ie]=13,shiftTable[ie|256]=13):Z<128?(baseTable[ie]=31744,baseTable[ie|256]=64512,shiftTable[ie]=24,shiftTable[ie|256]=24):(baseTable[ie]=31744,baseTable[ie|256]=64512,shiftTable[ie]=13,shiftTable[ie|256]=13)}const mantissaTable=new NativeUint32Array(2048);for(let ie=1;ie<1024;++ie){let Z=ie<<13,ee=0;for(;!(Z&8388608);)Z<<=1,ee-=8388608;Z&=-8388609,ee+=947912704,mantissaTable[ie]=Z|ee}for(let ie=1024;ie<2048;++ie)mantissaTable[ie]=939524096+(ie-1024<<13);const exponentTable=new NativeUint32Array(64);for(let ie=1;ie<31;++ie)exponentTable[ie]=ie<<23;exponentTable[31]=1199570944;exponentTable[32]=2147483648;for(let ie=33;ie<63;++ie)exponentTable[ie]=2147483648+(ie-32<<23);exponentTable[63]=3347054592;const offsetTable=new NativeUint16Array(64);for(let ie=1;ie<64;++ie)ie!==32&&(offsetTable[ie]=1024);function convertToNumber(ie){const Z=ie>>10;return uint32View[0]=mantissaTable[offsetTable[Z]+(ie&1023)]+exponentTable[Z],floatView[0]}function getFloat16(ie,Z,...ee){return convertToNumber(DataViewPrototypeGetUint16(ie,Z,...safeIfNeeded(ee)))}var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs$1(ie){return ie&&ie.__esModule&&Object.prototype.hasOwnProperty.call(ie,"default")?ie.default:ie}function getAugmentedNamespace(ie){if(ie.__esModule)return ie;var Z=ie.default;if(typeof Z=="function"){var ee=function ae(){return this instanceof ae?Reflect.construct(Z,arguments,this.constructor):Z.apply(this,arguments)};ee.prototype=Z.prototype}else ee={};return Object.defineProperty(ee,"__esModule",{value:!0}),Object.keys(ie).forEach(function(ae){var ye=Object.getOwnPropertyDescriptor(ie,ae);Object.defineProperty(ee,ae,ye.get?ye:{enumerable:!0,get:function(){return ie[ae]}})}),ee}var getAttribute$2={exports:{}};function getAttribute(ie,Z,ee){const ae=ee&&ee.debug||!1;ae&&console.log("[xml-utils] getting "+Z+" in "+ie);const ye=typeof ie=="object"?ie.outer:ie,ve=ye.slice(0,ye.indexOf(">")+1),be=['"',"'"];for(let Ye=0;Ye<be.length;Ye++){const Ke=be[Ye],Xe=Z+"\\="+Ke+"([^"+Ke+"]*)"+Ke;ae&&console.log("[xml-utils] pattern:",Xe);const Je=new RegExp(Xe).exec(ve);if(ae&&console.log("[xml-utils] match:",Je),Je)return Je[1]}}getAttribute$2.exports=getAttribute;getAttribute$2.exports.default=getAttribute;var getAttributeExports=getAttribute$2.exports;const getAttribute$1=getDefaultExportFromCjs$1(getAttributeExports);var findTagsByName$2={exports:{}},findTagByName$2={exports:{}},indexOfMatch$2={exports:{}};function indexOfMatch$1(ie,Z,ee){const ae=new RegExp(Z).exec(ie.slice(ee));return ae?ee+ae.index:-1}indexOfMatch$2.exports=indexOfMatch$1;indexOfMatch$2.exports.default=indexOfMatch$1;var indexOfMatchExports=indexOfMatch$2.exports,indexOfMatchEnd$2={exports:{}};function indexOfMatchEnd$1(ie,Z,ee){const ae=new RegExp(Z).exec(ie.slice(ee));return ae?ee+ae.index+ae[0].length-1:-1}indexOfMatchEnd$2.exports=indexOfMatchEnd$1;indexOfMatchEnd$2.exports.default=indexOfMatchEnd$1;var indexOfMatchEndExports=indexOfMatchEnd$2.exports,countSubstring$2={exports:{}};function countSubstring$1(ie,Z){const ee=new RegExp(Z,"g"),ae=ie.match(ee);return ae?ae.length:0}countSubstring$2.exports=countSubstring$1;countSubstring$2.exports.default=countSubstring$1;var countSubstringExports=countSubstring$2.exports;const indexOfMatch=indexOfMatchExports,indexOfMatchEnd=indexOfMatchEndExports,countSubstring=countSubstringExports;function findTagByName$1(ie,Z,ee){const ae=ee&&ee.debug||!1,ye=!(ee&&typeof ee.nested===!1),ve=ee&&ee.startIndex||0;ae&&console.log("[xml-utils] starting findTagByName with",Z," and ",ee);const be=indexOfMatch(ie,`<${Z}[ 
>/]`,ve);if(ae&&console.log("[xml-utils] start:",be),be===-1)return;const Ye=ie.slice(be+Z.length);let Ke=indexOfMatchEnd(Ye,"^[^<]*[ /]>",0);const Xe=Ke!==-1&&Ye[Ke-1]==="/";if(ae&&console.log("[xml-utils] selfClosing:",Xe),Xe===!1)if(ye){let it=0,lt=1,ct=0;for(;(Ke=indexOfMatchEnd(Ye,"[ /]"+Z+">",it))!==-1;){const ot=Ye.substring(it,Ke+1);if(lt+=countSubstring(ot,"<"+Z+`[ 
	>]`),ct+=countSubstring(ot,"</"+Z+">"),ct>=lt)break;it=Ke}}else Ke=indexOfMatchEnd(Ye,"[ /]"+Z+">",0);const Je=be+Z.length+Ke+1;if(ae&&console.log("[xml-utils] end:",Je),Je===-1)return;const rt=ie.slice(be,Je);let nt;return Xe?nt=null:nt=rt.slice(rt.indexOf(">")+1,rt.lastIndexOf("<")),{inner:nt,outer:rt,start:be,end:Je}}findTagByName$2.exports=findTagByName$1;findTagByName$2.exports.default=findTagByName$1;var findTagByNameExports=findTagByName$2.exports;const findTagByName=findTagByNameExports;function findTagsByName(ie,Z,ee){const ae=[],ye=ee&&ee.debug||!1,ve=ee&&typeof ee.nested=="boolean"?ee.nested:!0;let be=ee&&ee.startIndex||0,Ye;for(;Ye=findTagByName(ie,Z,{debug:ye,startIndex:be});)ve?be=Ye.start+1+Z.length:be=Ye.end,ae.push(Ye);return ye&&console.log("findTagsByName found",ae.length,"tags"),ae}findTagsByName$2.exports=findTagsByName;findTagsByName$2.exports.default=findTagsByName;var findTagsByNameExports=findTagsByName$2.exports;const findTagsByName$1=getDefaultExportFromCjs$1(findTagsByNameExports),fieldTagNames={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},fieldTags={};for(const ie in fieldTagNames)fieldTagNames.hasOwnProperty(ie)&&(fieldTags[fieldTagNames[ie]]=parseInt(ie,10));const arrayFields=[fieldTags.BitsPerSample,fieldTags.ExtraSamples,fieldTags.SampleFormat,fieldTags.StripByteCounts,fieldTags.StripOffsets,fieldTags.StripRowCounts,fieldTags.TileByteCounts,fieldTags.TileOffsets,fieldTags.SubIFDs],fieldTypeNames={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},fieldTypes={};for(const ie in fieldTypeNames)fieldTypeNames.hasOwnProperty(ie)&&(fieldTypes[fieldTypeNames[ie]]=parseInt(ie,10));const photometricInterpretations={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},ExtraSamplesValues={Unspecified:0,Assocalpha:1,Unassalpha:2},LercParameters={Version:0,AddCompression:1},LercAddCompression={None:0,Deflate:1,Zstandard:2},geoKeyNames={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function fromWhiteIsZero(ie,Z){const{width:ee,height:ae}=ie,ye=new Uint8Array(ee*ae*3);let ve;for(let be=0,Ye=0;be<ie.length;++be,Ye+=3)ve=256-ie[be]/Z*256,ye[Ye]=ve,ye[Ye+1]=ve,ye[Ye+2]=ve;return ye}function fromBlackIsZero(ie,Z){const{width:ee,height:ae}=ie,ye=new Uint8Array(ee*ae*3);let ve;for(let be=0,Ye=0;be<ie.length;++be,Ye+=3)ve=ie[be]/Z*256,ye[Ye]=ve,ye[Ye+1]=ve,ye[Ye+2]=ve;return ye}function fromPalette(ie,Z){const{width:ee,height:ae}=ie,ye=new Uint8Array(ee*ae*3),ve=Z.length/3,be=Z.length/3*2;for(let Ye=0,Ke=0;Ye<ie.length;++Ye,Ke+=3){const Xe=ie[Ye];ye[Ke]=Z[Xe]/65536*256,ye[Ke+1]=Z[Xe+ve]/65536*256,ye[Ke+2]=Z[Xe+be]/65536*256}return ye}function fromCMYK(ie){const{width:Z,height:ee}=ie,ae=new Uint8Array(Z*ee*3);for(let ye=0,ve=0;ye<ie.length;ye+=4,ve+=3){const be=ie[ye],Ye=ie[ye+1],Ke=ie[ye+2],Xe=ie[ye+3];ae[ve]=255*((255-be)/256)*((255-Xe)/256),ae[ve+1]=255*((255-Ye)/256)*((255-Xe)/256),ae[ve+2]=255*((255-Ke)/256)*((255-Xe)/256)}return ae}function fromYCbCr(ie){const{width:Z,height:ee}=ie,ae=new Uint8ClampedArray(Z*ee*3);for(let ye=0,ve=0;ye<ie.length;ye+=3,ve+=3){const be=ie[ye],Ye=ie[ye+1],Ke=ie[ye+2];ae[ve]=be+1.402*(Ke-128),ae[ve+1]=be-.34414*(Ye-128)-.71414*(Ke-128),ae[ve+2]=be+1.772*(Ye-128)}return ae}const Xn$1=.95047,Yn$1=1,Zn$1=1.08883;function fromCIELab(ie){const{width:Z,height:ee}=ie,ae=new Uint8Array(Z*ee*3);for(let ye=0,ve=0;ye<ie.length;ye+=3,ve+=3){const be=ie[ye+0],Ye=ie[ye+1]<<24>>24,Ke=ie[ye+2]<<24>>24;let Xe=(be+16)/116,Je=Ye/500+Xe,rt=Xe-Ke/200,nt,it,lt;Je=Xn$1*(Je*Je*Je>.008856?Je*Je*Je:(Je-16/116)/7.787),Xe=Yn$1*(Xe*Xe*Xe>.008856?Xe*Xe*Xe:(Xe-16/116)/7.787),rt=Zn$1*(rt*rt*rt>.008856?rt*rt*rt:(rt-16/116)/7.787),nt=Je*3.2406+Xe*-1.5372+rt*-.4986,it=Je*-.9689+Xe*1.8758+rt*.0415,lt=Je*.0557+Xe*-.204+rt*1.057,nt=nt>.0031308?1.055*nt**(1/2.4)-.055:12.92*nt,it=it>.0031308?1.055*it**(1/2.4)-.055:12.92*it,lt=lt>.0031308?1.055*lt**(1/2.4)-.055:12.92*lt,ae[ve]=Math.max(0,Math.min(1,nt))*255,ae[ve+1]=Math.max(0,Math.min(1,it))*255,ae[ve+2]=Math.max(0,Math.min(1,lt))*255}return ae}const registry=new Map;function addDecoder(ie,Z){Array.isArray(ie)||(ie=[ie]),ie.forEach(ee=>registry.set(ee,Z))}async function getDecoder(ie){const Z=registry.get(ie.Compression);if(!Z)throw new Error(`Unknown compression method identifier: ${ie.Compression}`);const ee=await Z();return new ee(ie)}addDecoder([void 0,1],()=>__vitePreload(()=>import("./raw-_eObXrMO-z93--tm9.js"),__vite__mapDeps([0,1])).then(ie=>ie.default));addDecoder(5,()=>__vitePreload(()=>import("./lzw-5BnjP5Zu-Rtm9pMoi.js"),__vite__mapDeps([2,1])).then(ie=>ie.default));addDecoder(6,()=>{throw new Error("old style JPEG compression is not supported.")});addDecoder(7,()=>__vitePreload(()=>import("./jpeg-cL5qbLGO-DsQ9NELO.js"),__vite__mapDeps([3,1])).then(ie=>ie.default));addDecoder([8,32946],()=>__vitePreload(()=>import("./deflate-vcCR2g03-uJvqLAd5.js"),__vite__mapDeps([4,5,1])).then(ie=>ie.default));addDecoder(32773,()=>__vitePreload(()=>import("./packbits-QLsyzNt2-BPOn6aoD.js"),__vite__mapDeps([6,1])).then(ie=>ie.default));addDecoder(34887,()=>__vitePreload(()=>import("./lerc-uk49vBKp-B8RQ-lpi.js"),__vite__mapDeps([7,5,1])).then(async ie=>(await ie.zstd.init(),ie)).then(ie=>ie.default));addDecoder(50001,()=>__vitePreload(()=>import("./webimage-Hf-HYtMO-Cer-ofJO.js"),__vite__mapDeps([8,1])).then(ie=>ie.default));function copyNewSize(ie,Z,ee,ae=1){return new(Object.getPrototypeOf(ie)).constructor(Z*ee*ae)}function resampleNearest(ie,Z,ee,ae,ye){const ve=Z/ae,be=ee/ye;return ie.map(Ye=>{const Ke=copyNewSize(Ye,ae,ye);for(let Xe=0;Xe<ye;++Xe){const Je=Math.min(Math.round(be*Xe),ee-1);for(let rt=0;rt<ae;++rt){const nt=Math.min(Math.round(ve*rt),Z-1),it=Ye[Je*Z+nt];Ke[Xe*ae+rt]=it}}return Ke})}function lerp(ie,Z,ee){return(1-ee)*ie+ee*Z}function resampleBilinear(ie,Z,ee,ae,ye){const ve=Z/ae,be=ee/ye;return ie.map(Ye=>{const Ke=copyNewSize(Ye,ae,ye);for(let Xe=0;Xe<ye;++Xe){const Je=be*Xe,rt=Math.floor(Je),nt=Math.min(Math.ceil(Je),ee-1);for(let it=0;it<ae;++it){const lt=ve*it,ct=lt%1,ot=Math.floor(lt),dt=Math.min(Math.ceil(lt),Z-1),ft=Ye[rt*Z+ot],gt=Ye[rt*Z+dt],mt=Ye[nt*Z+ot],Yr=Ye[nt*Z+dt],Qr=lerp(lerp(ft,gt,ct),lerp(mt,Yr,ct),Je%1);Ke[Xe*ae+it]=Qr}}return Ke})}function resample(ie,Z,ee,ae,ye,ve="nearest"){switch(ve.toLowerCase()){case"nearest":return resampleNearest(ie,Z,ee,ae,ye);case"bilinear":case"linear":return resampleBilinear(ie,Z,ee,ae,ye);default:throw new Error(`Unsupported resampling method: '${ve}'`)}}function resampleNearestInterleaved(ie,Z,ee,ae,ye,ve){const be=Z/ae,Ye=ee/ye,Ke=copyNewSize(ie,ae,ye,ve);for(let Xe=0;Xe<ye;++Xe){const Je=Math.min(Math.round(Ye*Xe),ee-1);for(let rt=0;rt<ae;++rt){const nt=Math.min(Math.round(be*rt),Z-1);for(let it=0;it<ve;++it){const lt=ie[Je*Z*ve+nt*ve+it];Ke[Xe*ae*ve+rt*ve+it]=lt}}}return Ke}function resampleBilinearInterleaved(ie,Z,ee,ae,ye,ve){const be=Z/ae,Ye=ee/ye,Ke=copyNewSize(ie,ae,ye,ve);for(let Xe=0;Xe<ye;++Xe){const Je=Ye*Xe,rt=Math.floor(Je),nt=Math.min(Math.ceil(Je),ee-1);for(let it=0;it<ae;++it){const lt=be*it,ct=lt%1,ot=Math.floor(lt),dt=Math.min(Math.ceil(lt),Z-1);for(let ft=0;ft<ve;++ft){const gt=ie[rt*Z*ve+ot*ve+ft],mt=ie[rt*Z*ve+dt*ve+ft],Yr=ie[nt*Z*ve+ot*ve+ft],Qr=ie[nt*Z*ve+dt*ve+ft],Xr=lerp(lerp(gt,mt,ct),lerp(Yr,Qr,ct),Je%1);Ke[Xe*ae*ve+it*ve+ft]=Xr}}}return Ke}function resampleInterleaved(ie,Z,ee,ae,ye,ve,be="nearest"){switch(be.toLowerCase()){case"nearest":return resampleNearestInterleaved(ie,Z,ee,ae,ye,ve);case"bilinear":case"linear":return resampleBilinearInterleaved(ie,Z,ee,ae,ye,ve);default:throw new Error(`Unsupported resampling method: '${be}'`)}}function sum(ie,Z,ee){let ae=0;for(let ye=Z;ye<ee;++ye)ae+=ie[ye];return ae}function arrayForType(ie,Z,ee){switch(ie){case 1:if(Z<=8)return new Uint8Array(ee);if(Z<=16)return new Uint16Array(ee);if(Z<=32)return new Uint32Array(ee);break;case 2:if(Z===8)return new Int8Array(ee);if(Z===16)return new Int16Array(ee);if(Z===32)return new Int32Array(ee);break;case 3:switch(Z){case 16:case 32:return new Float32Array(ee);case 64:return new Float64Array(ee)}break}throw Error("Unsupported data format/bitsPerSample")}function needsNormalization(ie,Z){return(ie===1||ie===2)&&Z<=32&&Z%8===0?!1:!(ie===3&&(Z===16||Z===32||Z===64))}function normalizeArray(ie,Z,ee,ae,ye,ve,be){const Ye=new DataView(ie),Ke=ee===2?be*ve:be*ve*ae,Xe=ee===2?1:ae,Je=arrayForType(Z,ye,Ke),rt=parseInt("1".repeat(ye),2);if(Z===1){let nt;ee===1?nt=ae*ye:nt=ye;let it=ve*nt;it&7&&(it=it+7&-8);for(let lt=0;lt<be;++lt){const ct=lt*it;for(let ot=0;ot<ve;++ot){const dt=ct+ot*Xe*ye;for(let ft=0;ft<Xe;++ft){const gt=dt+ft*ye,mt=(lt*ve+ot)*Xe+ft,Yr=Math.floor(gt/8),Qr=gt%8;if(Qr+ye<=8)Je[mt]=Ye.getUint8(Yr)>>8-ye-Qr&rt;else if(Qr+ye<=16)Je[mt]=Ye.getUint16(Yr)>>16-ye-Qr&rt;else if(Qr+ye<=24){const Xr=Ye.getUint16(Yr)<<8|Ye.getUint8(Yr+2);Je[mt]=Xr>>24-ye-Qr&rt}else Je[mt]=Ye.getUint32(Yr)>>32-ye-Qr&rt}}}}return Je.buffer}class GeoTIFFImage{constructor(Z,ee,ae,ye,ve,be){this.fileDirectory=Z,this.geoKeys=ee,this.dataView=ae,this.littleEndian=ye,this.tiles=ve?{}:null,this.isTiled=!Z.StripOffsets;const Ye=Z.PlanarConfiguration;if(this.planarConfiguration=typeof Ye>"u"?1:Ye,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=be}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(Z){return this.isTiled||(Z+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-Z*this.getTileHeight()}getBytesPerPixel(){let Z=0;for(let ee=0;ee<this.fileDirectory.BitsPerSample.length;++ee)Z+=this.getSampleByteSize(ee);return Z}getSampleByteSize(Z){if(Z>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${Z} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[Z]/8)}getReaderForSample(Z){const ee=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[Z]:1,ae=this.fileDirectory.BitsPerSample[Z];switch(ee){case 1:if(ae<=8)return DataView.prototype.getUint8;if(ae<=16)return DataView.prototype.getUint16;if(ae<=32)return DataView.prototype.getUint32;break;case 2:if(ae<=8)return DataView.prototype.getInt8;if(ae<=16)return DataView.prototype.getInt16;if(ae<=32)return DataView.prototype.getInt32;break;case 3:switch(ae){case 16:return function(ye,ve){return getFloat16(this,ye,ve)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(Z=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[Z]:1}getBitsPerSample(Z=0){return this.fileDirectory.BitsPerSample[Z]}getArrayForSample(Z,ee){const ae=this.getSampleFormat(Z),ye=this.getBitsPerSample(Z);return arrayForType(ae,ye,ee)}async getTileOrStrip(Z,ee,ae,ye,ve){const be=Math.ceil(this.getWidth()/this.getTileWidth()),Ye=Math.ceil(this.getHeight()/this.getTileHeight());let Ke;const{tiles:Xe}=this;this.planarConfiguration===1?Ke=ee*be+Z:this.planarConfiguration===2&&(Ke=ae*be*Ye+ee*be+Z);let Je,rt;this.isTiled?(Je=this.fileDirectory.TileOffsets[Ke],rt=this.fileDirectory.TileByteCounts[Ke]):(Je=this.fileDirectory.StripOffsets[Ke],rt=this.fileDirectory.StripByteCounts[Ke]);const nt=(await this.source.fetch([{offset:Je,length:rt}],ve))[0];let it;return Xe===null||!Xe[Ke]?(it=(async()=>{let lt=await ye.decode(this.fileDirectory,nt);const ct=this.getSampleFormat(),ot=this.getBitsPerSample();return needsNormalization(ct,ot)&&(lt=normalizeArray(lt,ct,this.planarConfiguration,this.getSamplesPerPixel(),ot,this.getTileWidth(),this.getBlockHeight(ee))),lt})(),Xe!==null&&(Xe[Ke]=it)):it=Xe[Ke],{x:Z,y:ee,sample:ae,data:await it}}async _readRaster(Z,ee,ae,ye,ve,be,Ye,Ke,Xe){const Je=this.getTileWidth(),rt=this.getTileHeight(),nt=this.getWidth(),it=this.getHeight(),lt=Math.max(Math.floor(Z[0]/Je),0),ct=Math.min(Math.ceil(Z[2]/Je),Math.ceil(nt/Je)),ot=Math.max(Math.floor(Z[1]/rt),0),dt=Math.min(Math.ceil(Z[3]/rt),Math.ceil(it/rt)),ft=Z[2]-Z[0];let gt=this.getBytesPerPixel();const mt=[],Yr=[];for(let Jr=0;Jr<ee.length;++Jr)this.planarConfiguration===1?mt.push(sum(this.fileDirectory.BitsPerSample,0,ee[Jr])/8):mt.push(0),Yr.push(this.getReaderForSample(ee[Jr]));const Qr=[],{littleEndian:Xr}=this;for(let Jr=ot;Jr<dt;++Jr)for(let ai=lt;ai<ct;++ai){let oi;this.planarConfiguration===1&&(oi=this.getTileOrStrip(ai,Jr,0,ve,Xe));for(let ni=0;ni<ee.length;++ni){const li=ni,ui=ee[ni];this.planarConfiguration===2&&(gt=this.getSampleByteSize(ui),oi=this.getTileOrStrip(ai,Jr,ui,ve,Xe));const mi=oi.then(ii=>{const hi=ii.data,ri=new DataView(hi),ci=this.getBlockHeight(ii.y),Si=ii.y*rt,si=ii.x*Je,Ei=Si+ci,yi=(ii.x+1)*Je,Mi=Yr[li],Ci=Math.min(ci,ci-(Ei-Z[3]),it-Si),Ri=Math.min(Je,Je-(yi-Z[2]),nt-si);for(let Ni=Math.max(0,Z[1]-Si);Ni<Ci;++Ni)for(let Ai=Math.max(0,Z[0]-si);Ai<Ri;++Ai){const ki=(Ni*Je+Ai)*gt,Yi=Mi.call(ri,ki+mt[li],Xr);let Ji;ye?(Ji=(Ni+Si-Z[1])*ft*ee.length+(Ai+si-Z[0])*ee.length+li,ae[Ji]=Yi):(Ji=(Ni+Si-Z[1])*ft+Ai+si-Z[0],ae[li][Ji]=Yi)}});Qr.push(mi)}}if(await Promise.all(Qr),be&&Z[2]-Z[0]!==be||Ye&&Z[3]-Z[1]!==Ye){let Jr;return ye?Jr=resampleInterleaved(ae,Z[2]-Z[0],Z[3]-Z[1],be,Ye,ee.length,Ke):Jr=resample(ae,Z[2]-Z[0],Z[3]-Z[1],be,Ye,Ke),Jr.width=be,Jr.height=Ye,Jr}return ae.width=be||Z[2]-Z[0],ae.height=Ye||Z[3]-Z[1],ae}async readRasters({window:Z,samples:ee=[],interleave:ae,pool:ye=null,width:ve,height:be,resampleMethod:Ye,fillValue:Ke,signal:Xe}={}){const Je=Z||[0,0,this.getWidth(),this.getHeight()];if(Je[0]>Je[2]||Je[1]>Je[3])throw new Error("Invalid subsets");const rt=Je[2]-Je[0],nt=Je[3]-Je[1],it=rt*nt,lt=this.getSamplesPerPixel();if(!ee||!ee.length)for(let dt=0;dt<lt;++dt)ee.push(dt);else for(let dt=0;dt<ee.length;++dt)if(ee[dt]>=lt)return Promise.reject(new RangeError(`Invalid sample index '${ee[dt]}'.`));let ct;if(ae){const dt=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,ft=Math.max.apply(null,this.fileDirectory.BitsPerSample);ct=arrayForType(dt,ft,it*ee.length),Ke&&ct.fill(Ke)}else{ct=[];for(let dt=0;dt<ee.length;++dt){const ft=this.getArrayForSample(ee[dt],it);Array.isArray(Ke)&&dt<Ke.length?ft.fill(Ke[dt]):Ke&&!Array.isArray(Ke)&&ft.fill(Ke),ct.push(ft)}}const ot=ye||await getDecoder(this.fileDirectory);return await this._readRaster(Je,ee,ct,ae,ot,ve,be,Ye,Xe)}async readRGB({window:Z,interleave:ee=!0,pool:ae=null,width:ye,height:ve,resampleMethod:be,enableAlpha:Ye=!1,signal:Ke}={}){const Xe=Z||[0,0,this.getWidth(),this.getHeight()];if(Xe[0]>Xe[2]||Xe[1]>Xe[3])throw new Error("Invalid subsets");const Je=this.fileDirectory.PhotometricInterpretation;if(Je===photometricInterpretations.RGB){let dt=[0,1,2];if(this.fileDirectory.ExtraSamples!==ExtraSamplesValues.Unspecified&&Ye){dt=[];for(let ft=0;ft<this.fileDirectory.BitsPerSample.length;ft+=1)dt.push(ft)}return this.readRasters({window:Z,interleave:ee,samples:dt,pool:ae,width:ye,height:ve,resampleMethod:be,signal:Ke})}let rt;switch(Je){case photometricInterpretations.WhiteIsZero:case photometricInterpretations.BlackIsZero:case photometricInterpretations.Palette:rt=[0];break;case photometricInterpretations.CMYK:rt=[0,1,2,3];break;case photometricInterpretations.YCbCr:case photometricInterpretations.CIELab:rt=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const nt={window:Xe,interleave:!0,samples:rt,pool:ae,width:ye,height:ve,resampleMethod:be,signal:Ke},{fileDirectory:it}=this,lt=await this.readRasters(nt),ct=2**this.fileDirectory.BitsPerSample[0];let ot;switch(Je){case photometricInterpretations.WhiteIsZero:ot=fromWhiteIsZero(lt,ct);break;case photometricInterpretations.BlackIsZero:ot=fromBlackIsZero(lt,ct);break;case photometricInterpretations.Palette:ot=fromPalette(lt,it.ColorMap);break;case photometricInterpretations.CMYK:ot=fromCMYK(lt);break;case photometricInterpretations.YCbCr:ot=fromYCbCr(lt);break;case photometricInterpretations.CIELab:ot=fromCIELab(lt);break;default:throw new Error("Unsupported photometric interpretation.")}if(!ee){const dt=new Uint8Array(ot.length/3),ft=new Uint8Array(ot.length/3),gt=new Uint8Array(ot.length/3);for(let mt=0,Yr=0;mt<ot.length;mt+=3,++Yr)dt[Yr]=ot[mt],ft[Yr]=ot[mt+1],gt[Yr]=ot[mt+2];ot=[dt,ft,gt]}return ot.width=lt.width,ot.height=lt.height,ot}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const Z=[];for(let ee=0;ee<this.fileDirectory.ModelTiepoint.length;ee+=6)Z.push({i:this.fileDirectory.ModelTiepoint[ee],j:this.fileDirectory.ModelTiepoint[ee+1],k:this.fileDirectory.ModelTiepoint[ee+2],x:this.fileDirectory.ModelTiepoint[ee+3],y:this.fileDirectory.ModelTiepoint[ee+4],z:this.fileDirectory.ModelTiepoint[ee+5]});return Z}getGDALMetadata(Z=null){const ee={};if(!this.fileDirectory.GDAL_METADATA)return null;const ae=this.fileDirectory.GDAL_METADATA;let ye=findTagsByName$1(ae,"Item");Z===null?ye=ye.filter(ve=>getAttribute$1(ve,"sample")===void 0):ye=ye.filter(ve=>Number(getAttribute$1(ve,"sample"))===Z);for(let ve=0;ve<ye.length;++ve){const be=ye[ve];ee[getAttribute$1(be,"name")]=be.inner}return ee}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const Z=this.fileDirectory.GDAL_NODATA;return Number(Z.substring(0,Z.length-1))}getOrigin(){const Z=this.fileDirectory.ModelTiepoint,ee=this.fileDirectory.ModelTransformation;if(Z&&Z.length===6)return[Z[3],Z[4],Z[5]];if(ee)return[ee[3],ee[7],ee[11]];throw new Error("The image does not have an affine transformation.")}getResolution(Z=null){const ee=this.fileDirectory.ModelPixelScale,ae=this.fileDirectory.ModelTransformation;if(ee)return[ee[0],-ee[1],ee[2]];if(ae)return[ae[0],-ae[5],ae[10]];if(Z){const[ye,ve,be]=Z.getResolution();return[ye*Z.getWidth()/this.getWidth(),ve*Z.getHeight()/this.getHeight(),be*Z.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(Z=!1){const ee=this.getHeight(),ae=this.getWidth();if(this.fileDirectory.ModelTransformation&&!Z){const[ye,ve,be,Ye,Ke,Xe,Je,rt]=this.fileDirectory.ModelTransformation,nt=[[0,0],[0,ee],[ae,0],[ae,ee]].map(([ct,ot])=>[Ye+ye*ct+ve*ot,rt+Ke*ct+Xe*ot]),it=nt.map(ct=>ct[0]),lt=nt.map(ct=>ct[1]);return[Math.min(...it),Math.min(...lt),Math.max(...it),Math.max(...lt)]}else{const ye=this.getOrigin(),ve=this.getResolution(),be=ye[0],Ye=ye[1],Ke=be+ve[0]*ae,Xe=Ye+ve[1]*ee;return[Math.min(be,Ke),Math.min(Ye,Xe),Math.max(be,Ke),Math.max(Ye,Xe)]}}}class DataView64{constructor(Z){this._dataView=new DataView(Z)}get buffer(){return this._dataView.buffer}getUint64(Z,ee){const ae=this.getUint32(Z,ee),ye=this.getUint32(Z+4,ee);let ve;if(ee){if(ve=ae+2**32*ye,!Number.isSafeInteger(ve))throw new Error(`${ve} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return ve}if(ve=2**32*ae+ye,!Number.isSafeInteger(ve))throw new Error(`${ve} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return ve}getInt64(Z,ee){let ae=0;const ye=(this._dataView.getUint8(Z+(ee?7:0))&128)>0;let ve=!0;for(let be=0;be<8;be++){let Ye=this._dataView.getUint8(Z+(ee?be:7-be));ye&&(ve?Ye!==0&&(Ye=~(Ye-1)&255,ve=!1):Ye=~Ye&255),ae+=Ye*256**be}return ye&&(ae=-ae),ae}getUint8(Z,ee){return this._dataView.getUint8(Z,ee)}getInt8(Z,ee){return this._dataView.getInt8(Z,ee)}getUint16(Z,ee){return this._dataView.getUint16(Z,ee)}getInt16(Z,ee){return this._dataView.getInt16(Z,ee)}getUint32(Z,ee){return this._dataView.getUint32(Z,ee)}getInt32(Z,ee){return this._dataView.getInt32(Z,ee)}getFloat16(Z,ee){return getFloat16(this._dataView,Z,ee)}getFloat32(Z,ee){return this._dataView.getFloat32(Z,ee)}getFloat64(Z,ee){return this._dataView.getFloat64(Z,ee)}}class DataSlice{constructor(Z,ee,ae,ye){this._dataView=new DataView(Z),this._sliceOffset=ee,this._littleEndian=ae,this._bigTiff=ye}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(Z,ee){return this.sliceOffset<=Z&&this.sliceTop>=Z+ee}readUint8(Z){return this._dataView.getUint8(Z-this._sliceOffset,this._littleEndian)}readInt8(Z){return this._dataView.getInt8(Z-this._sliceOffset,this._littleEndian)}readUint16(Z){return this._dataView.getUint16(Z-this._sliceOffset,this._littleEndian)}readInt16(Z){return this._dataView.getInt16(Z-this._sliceOffset,this._littleEndian)}readUint32(Z){return this._dataView.getUint32(Z-this._sliceOffset,this._littleEndian)}readInt32(Z){return this._dataView.getInt32(Z-this._sliceOffset,this._littleEndian)}readFloat32(Z){return this._dataView.getFloat32(Z-this._sliceOffset,this._littleEndian)}readFloat64(Z){return this._dataView.getFloat64(Z-this._sliceOffset,this._littleEndian)}readUint64(Z){const ee=this.readUint32(Z),ae=this.readUint32(Z+4);let ye;if(this._littleEndian){if(ye=ee+2**32*ae,!Number.isSafeInteger(ye))throw new Error(`${ye} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return ye}if(ye=2**32*ee+ae,!Number.isSafeInteger(ye))throw new Error(`${ye} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return ye}readInt64(Z){let ee=0;const ae=(this._dataView.getUint8(Z+(this._littleEndian?7:0))&128)>0;let ye=!0;for(let ve=0;ve<8;ve++){let be=this._dataView.getUint8(Z+(this._littleEndian?ve:7-ve));ae&&(ye?be!==0&&(be=~(be-1)&255,ye=!1):be=~be&255),ee+=be*256**ve}return ae&&(ee=-ee),ee}readOffset(Z){return this._bigTiff?this.readUint64(Z):this.readUint32(Z)}}const defaultPoolSize=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class Pool{constructor(Z=defaultPoolSize,ee){this.workers=null,this._awaitingDecoder=null,this.size=Z,this.messageId=0,Z&&(this._awaitingDecoder=ee?Promise.resolve(ee):new Promise(ae=>{__vitePreload(()=>import("./decoder-b0JuKe3x-CaSv2t6h.js"),[]).then(ye=>{ae(ye.create)})}),this._awaitingDecoder.then(ae=>{this._awaitingDecoder=null,this.workers=[];for(let ye=0;ye<Z;ye++)this.workers.push({worker:ae(),idle:!0})}))}async decode(Z,ee){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?getDecoder(Z).then(ae=>ae.decode(Z,ee)):new Promise(ae=>{const ye=this.workers.find(Ye=>Ye.idle)||this.workers[Math.floor(Math.random()*this.size)];ye.idle=!1;const ve=this.messageId++,be=Ye=>{Ye.data.id===ve&&(ye.idle=!0,ae(Ye.data.decoded),ye.worker.removeEventListener("message",be))};ye.worker.addEventListener("message",be),ye.worker.postMessage({fileDirectory:Z,buffer:ee,id:ve},[ee])})}destroy(){this.workers&&(this.workers.forEach(Z=>{Z.worker.terminate()}),this.workers=null)}}const CRLFCRLF=`\r
\r
`;function itemsToObject(ie){if(typeof Object.fromEntries<"u")return Object.fromEntries(ie);const Z={};for(const[ee,ae]of ie)Z[ee.toLowerCase()]=ae;return Z}function parseHeaders(ie){const Z=ie.split(`\r
`).map(ee=>{const ae=ee.split(":").map(ye=>ye.trim());return ae[0]=ae[0].toLowerCase(),ae});return itemsToObject(Z)}function parseContentType(ie){const[Z,...ee]=ie.split(";").map(ye=>ye.trim()),ae=ee.map(ye=>ye.split("="));return{type:Z,params:itemsToObject(ae)}}function parseContentRange(ie){let Z,ee,ae;return ie&&([,Z,ee,ae]=ie.match(/bytes (\d+)-(\d+)\/(\d+)/),Z=parseInt(Z,10),ee=parseInt(ee,10),ae=parseInt(ae,10)),{start:Z,end:ee,total:ae}}function parseByteRanges(ie,Z){let ee=null;const ae=new TextDecoder("ascii"),ye=[],ve=`--${Z}`,be=`${ve}--`;for(let Ye=0;Ye<10;++Ye)ae.decode(new Uint8Array(ie,Ye,ve.length))===ve&&(ee=Ye);if(ee===null)throw new Error("Could not find initial boundary");for(;ee<ie.byteLength;){const Ye=ae.decode(new Uint8Array(ie,ee,Math.min(ve.length+1024,ie.byteLength-ee)));if(Ye.length===0||Ye.startsWith(be))break;if(!Ye.startsWith(ve))throw new Error("Part does not start with boundary");const Ke=Ye.substr(ve.length+2);if(Ke.length===0)break;const Xe=Ke.indexOf(CRLFCRLF),Je=parseHeaders(Ke.substr(0,Xe)),{start:rt,end:nt,total:it}=parseContentRange(Je["content-range"]),lt=ee+ve.length+Xe+CRLFCRLF.length,ct=parseInt(nt,10)+1-parseInt(rt,10);ye.push({headers:Je,data:ie.slice(lt,lt+ct),offset:rt,length:ct,fileSize:it}),ee=lt+ct+4}return ye}class BaseSource{async fetch(Z,ee=void 0){return Promise.all(Z.map(ae=>this.fetchSlice(ae,ee)))}async fetchSlice(Z){throw new Error(`fetching of slice ${Z} not possible, not implemented`)}get fileSize(){return null}async close(){}}class QuickLRU extends Map{constructor(Z={}){if(super(),!(Z.maxSize&&Z.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof Z.maxAge=="number"&&Z.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=Z.maxSize,this.maxAge=Z.maxAge||Number.POSITIVE_INFINITY,this.onEviction=Z.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(Z){if(typeof this.onEviction=="function")for(const[ee,ae]of Z)this.onEviction(ee,ae.value)}_deleteIfExpired(Z,ee){return typeof ee.expiry=="number"&&ee.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(Z,ee.value),this.delete(Z)):!1}_getOrDeleteIfExpired(Z,ee){if(this._deleteIfExpired(Z,ee)===!1)return ee.value}_getItemValue(Z,ee){return ee.expiry?this._getOrDeleteIfExpired(Z,ee):ee.value}_peek(Z,ee){const ae=ee.get(Z);return this._getItemValue(Z,ae)}_set(Z,ee){this.cache.set(Z,ee),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(Z,ee){this.oldCache.delete(Z),this._set(Z,ee)}*_entriesAscending(){for(const Z of this.oldCache){const[ee,ae]=Z;this.cache.has(ee)||this._deleteIfExpired(ee,ae)===!1&&(yield Z)}for(const Z of this.cache){const[ee,ae]=Z;this._deleteIfExpired(ee,ae)===!1&&(yield Z)}}get(Z){if(this.cache.has(Z)){const ee=this.cache.get(Z);return this._getItemValue(Z,ee)}if(this.oldCache.has(Z)){const ee=this.oldCache.get(Z);if(this._deleteIfExpired(Z,ee)===!1)return this._moveToRecent(Z,ee),ee.value}}set(Z,ee,{maxAge:ae=this.maxAge}={}){const ye=typeof ae=="number"&&ae!==Number.POSITIVE_INFINITY?Date.now()+ae:void 0;return this.cache.has(Z)?this.cache.set(Z,{value:ee,expiry:ye}):this._set(Z,{value:ee,expiry:ye}),this}has(Z){return this.cache.has(Z)?!this._deleteIfExpired(Z,this.cache.get(Z)):this.oldCache.has(Z)?!this._deleteIfExpired(Z,this.oldCache.get(Z)):!1}peek(Z){if(this.cache.has(Z))return this._peek(Z,this.cache);if(this.oldCache.has(Z))return this._peek(Z,this.oldCache)}delete(Z){const ee=this.cache.delete(Z);return ee&&this._size--,this.oldCache.delete(Z)||ee}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(Z){if(!(Z&&Z>0))throw new TypeError("`maxSize` must be a number greater than 0");const ee=[...this._entriesAscending()],ae=ee.length-Z;ae<0?(this.cache=new Map(ee),this.oldCache=new Map,this._size=ee.length):(ae>0&&this._emitEvictions(ee.slice(0,ae)),this.oldCache=new Map(ee.slice(ae)),this.cache=new Map,this._size=0),this.maxSize=Z}*keys(){for(const[Z]of this)yield Z}*values(){for(const[,Z]of this)yield Z}*[Symbol.iterator](){for(const Z of this.cache){const[ee,ae]=Z;this._deleteIfExpired(ee,ae)===!1&&(yield[ee,ae.value])}for(const Z of this.oldCache){const[ee,ae]=Z;this.cache.has(ee)||this._deleteIfExpired(ee,ae)===!1&&(yield[ee,ae.value])}}*entriesDescending(){let Z=[...this.cache];for(let ee=Z.length-1;ee>=0;--ee){const ae=Z[ee],[ye,ve]=ae;this._deleteIfExpired(ye,ve)===!1&&(yield[ye,ve.value])}Z=[...this.oldCache];for(let ee=Z.length-1;ee>=0;--ee){const ae=Z[ee],[ye,ve]=ae;this.cache.has(ye)||this._deleteIfExpired(ye,ve)===!1&&(yield[ye,ve.value])}}*entriesAscending(){for(const[Z,ee]of this._entriesAscending())yield[Z,ee.value]}get size(){if(!this._size)return this.oldCache.size;let Z=0;for(const ee of this.oldCache.keys())this.cache.has(ee)||Z++;return Math.min(this._size+Z,this.maxSize)}entries(){return this.entriesAscending()}forEach(Z,ee=this){for(const[ae,ye]of this.entriesAscending())Z.call(ee,ye,ae,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}async function wait(ie){return new Promise(Z=>setTimeout(Z,ie))}function zip(ie,Z){const ee=Array.isArray(ie)?ie:Array.from(ie),ae=Array.isArray(Z)?Z:Array.from(Z);return ee.map((ye,ve)=>[ye,ae[ve]])}class AbortError extends Error{constructor(Z){super(Z),Error.captureStackTrace&&Error.captureStackTrace(this,AbortError),this.name="AbortError"}}class CustomAggregateError extends Error{constructor(Z,ee){super(ee),this.errors=Z,this.message=ee,this.name="AggregateError"}}const AggregateError=CustomAggregateError;class Block{constructor(Z,ee,ae=null){this.offset=Z,this.length=ee,this.data=ae}get top(){return this.offset+this.length}}class BlockGroup{constructor(Z,ee,ae){this.offset=Z,this.length=ee,this.blockIds=ae}}class BlockedSource extends BaseSource{constructor(Z,{blockSize:ee=65536,cacheSize:ae=100}={}){super(),this.source=Z,this.blockSize=ee,this.blockCache=new QuickLRU({maxSize:ae,onEviction:(ye,ve)=>{this.evictedBlocks.set(ye,ve)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(Z,ee){const ae=[],ye=[],ve=[];this.evictedBlocks.clear();for(const{offset:nt,length:it}of Z){let lt=nt+it;const{fileSize:ct}=this;ct!==null&&(lt=Math.min(lt,ct));const ot=Math.floor(nt/this.blockSize)*this.blockSize;for(let dt=ot;dt<lt;dt+=this.blockSize){const ft=Math.floor(dt/this.blockSize);!this.blockCache.has(ft)&&!this.blockRequests.has(ft)&&(this.blockIdsToFetch.add(ft),ye.push(ft)),this.blockRequests.has(ft)&&ae.push(this.blockRequests.get(ft)),ve.push(ft)}}await wait(),this.fetchBlocks(ee);const be=[];for(const nt of ye)this.blockRequests.has(nt)&&be.push(this.blockRequests.get(nt));await Promise.allSettled(ae),await Promise.allSettled(be);const Ye=[],Ke=ve.filter(nt=>this.abortedBlockIds.has(nt)||!this.blockCache.has(nt));if(Ke.forEach(nt=>this.blockIdsToFetch.add(nt)),Ke.length>0&&ee&&!ee.aborted){this.fetchBlocks(null);for(const nt of Ke){const it=this.blockRequests.get(nt);if(!it)throw new Error(`Block ${nt} is not in the block requests`);Ye.push(it)}await Promise.allSettled(Ye)}if(ee&&ee.aborted)throw new AbortError("Request was aborted");const Xe=ve.map(nt=>this.blockCache.get(nt)||this.evictedBlocks.get(nt)),Je=Xe.filter(nt=>!nt);if(Je.length)throw new AggregateError(Je,"Request failed");const rt=new Map(zip(ve,Xe));return this.readSliceData(Z,rt)}fetchBlocks(Z){if(this.blockIdsToFetch.size>0){const ee=this.groupBlocks(this.blockIdsToFetch),ae=this.source.fetch(ee,Z);for(let ye=0;ye<ee.length;++ye){const ve=ee[ye];for(const be of ve.blockIds)this.blockRequests.set(be,(async()=>{try{const Ye=(await ae)[ye],Ke=be*this.blockSize,Xe=Ke-Ye.offset,Je=Math.min(Xe+this.blockSize,Ye.data.byteLength),rt=Ye.data.slice(Xe,Je),nt=new Block(Ke,rt.byteLength,rt,be);this.blockCache.set(be,nt),this.abortedBlockIds.delete(be)}catch(Ye){if(Ye.name==="AbortError")Ye.signal=Z,this.blockCache.delete(be),this.abortedBlockIds.add(be);else throw Ye}finally{this.blockRequests.delete(be)}})())}this.blockIdsToFetch.clear()}}groupBlocks(Z){const ee=Array.from(Z).sort((be,Ye)=>be-Ye);if(ee.length===0)return[];let ae=[],ye=null;const ve=[];for(const be of ee)ye===null||ye+1===be?(ae.push(be),ye=be):(ve.push(new BlockGroup(ae[0]*this.blockSize,ae.length*this.blockSize,ae)),ae=[be],ye=be);return ve.push(new BlockGroup(ae[0]*this.blockSize,ae.length*this.blockSize,ae)),ve}readSliceData(Z,ee){return Z.map(ae=>{let ye=ae.offset+ae.length;this.fileSize!==null&&(ye=Math.min(this.fileSize,ye));const ve=Math.floor(ae.offset/this.blockSize),be=Math.floor(ye/this.blockSize),Ye=new ArrayBuffer(ae.length),Ke=new Uint8Array(Ye);for(let Xe=ve;Xe<=be;++Xe){const Je=ee.get(Xe),rt=Je.offset-ae.offset,nt=Je.top-ye;let it=0,lt=0,ct;rt<0?it=-rt:rt>0&&(lt=rt),nt<0?ct=Je.length-it:ct=ye-Je.offset-it;const ot=new Uint8Array(Je.data,it,ct);Ke.set(ot,lt)}return Ye})}}class BaseResponse{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(Z){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class BaseClient{constructor(Z){this.url=Z}async request({headers:Z,signal:ee}={}){throw new Error("request is not implemented")}}class FetchResponse extends BaseResponse{constructor(Z){super(),this.response=Z}get status(){return this.response.status}getHeader(Z){return this.response.headers.get(Z)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class FetchClient extends BaseClient{constructor(Z,ee){super(Z),this.credentials=ee}async request({headers:Z,signal:ee}={}){const ae=await fetch(this.url,{headers:Z,credentials:this.credentials,signal:ee});return new FetchResponse(ae)}}class XHRResponse extends BaseResponse{constructor(Z,ee){super(),this.xhr=Z,this.data=ee}get status(){return this.xhr.status}getHeader(Z){return this.xhr.getResponseHeader(Z)}async getData(){return this.data}}class XHRClient extends BaseClient{constructRequest(Z,ee){return new Promise((ae,ye)=>{const ve=new XMLHttpRequest;ve.open("GET",this.url),ve.responseType="arraybuffer";for(const[be,Ye]of Object.entries(Z))ve.setRequestHeader(be,Ye);ve.onload=()=>{const be=ve.response;ae(new XHRResponse(ve,be))},ve.onerror=ye,ve.onabort=()=>ye(new AbortError("Request aborted")),ve.send(),ee&&(ee.aborted&&ve.abort(),ee.addEventListener("abort",()=>ve.abort()))})}async request({headers:Z,signal:ee}={}){return await this.constructRequest(Z,ee)}}const fs={},__viteBrowserExternal=Object.freeze(Object.defineProperty({__proto__:null,default:fs},Symbol.toStringTag,{value:"Module"}));class HttpResponse extends BaseResponse{constructor(Z,ee){super(),this.response=Z,this.dataPromise=ee}get status(){return this.response.statusCode}getHeader(Z){return this.response.headers[Z]}async getData(){return await this.dataPromise}}class HttpClient extends BaseClient{constructor(Z){super(Z),this.parsedUrl=fs.parse(this.url),this.httpApi=(this.parsedUrl.protocol,fs)}constructRequest(Z,ee){return new Promise((ae,ye)=>{const ve=this.httpApi.get({...this.parsedUrl,headers:Z},be=>{const Ye=new Promise(Ke=>{const Xe=[];be.on("data",Je=>{Xe.push(Je)}),be.on("end",()=>{const Je=Buffer.concat(Xe).buffer;Ke(Je)}),be.on("error",ye)});ae(new HttpResponse(be,Ye))});ve.on("error",ye),ee&&(ee.aborted&&ve.destroy(new AbortError("Request aborted")),ee.addEventListener("abort",()=>ve.destroy(new AbortError("Request aborted"))))})}async request({headers:Z,signal:ee}={}){return await this.constructRequest(Z,ee)}}class RemoteSource extends BaseSource{constructor(Z,ee,ae,ye){super(),this.client=Z,this.headers=ee,this.maxRanges=ae,this.allowFullFile=ye,this._fileSize=null}async fetch(Z,ee){return this.maxRanges>=Z.length?this.fetchSlices(Z,ee):(this.maxRanges>0&&Z.length>1,Promise.all(Z.map(ae=>this.fetchSlice(ae,ee))))}async fetchSlices(Z,ee){const ae=await this.client.request({headers:{...this.headers,Range:`bytes=${Z.map(({offset:ye,length:ve})=>`${ye}-${ye+ve}`).join(",")}`},signal:ee});if(ae.ok)if(ae.status===206){const{type:ye,params:ve}=parseContentType(ae.getHeader("content-type"));if(ye==="multipart/byteranges"){const rt=parseByteRanges(await ae.getData(),ve.boundary);return this._fileSize=rt[0].fileSize||null,rt}const be=await ae.getData(),{start:Ye,end:Ke,total:Xe}=parseContentRange(ae.getHeader("content-range"));this._fileSize=Xe||null;const Je=[{data:be,offset:Ye,length:Ke-Ye}];if(Z.length>1){const rt=await Promise.all(Z.slice(1).map(nt=>this.fetchSlice(nt,ee)));return Je.concat(rt)}return Je}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const ye=await ae.getData();return this._fileSize=ye.byteLength,[{data:ye,offset:0,length:ye.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(Z,ee){const{offset:ae,length:ye}=Z,ve=await this.client.request({headers:{...this.headers,Range:`bytes=${ae}-${ae+ye}`},signal:ee});if(ve.ok)if(ve.status===206){const be=await ve.getData(),{total:Ye}=parseContentRange(ve.getHeader("content-range"));return this._fileSize=Ye||null,{data:be,offset:ae,length:ye}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const be=await ve.getData();return this._fileSize=be.byteLength,{data:be,offset:0,length:be.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function maybeWrapInBlockedSource(ie,{blockSize:Z,cacheSize:ee}){return Z===null?ie:new BlockedSource(ie,{blockSize:Z,cacheSize:ee})}function makeFetchSource(ie,{headers:Z={},credentials:ee,maxRanges:ae=0,allowFullFile:ye=!1,...ve}={}){const be=new FetchClient(ie,ee),Ye=new RemoteSource(be,Z,ae,ye);return maybeWrapInBlockedSource(Ye,ve)}function makeXHRSource(ie,{headers:Z={},maxRanges:ee=0,allowFullFile:ae=!1,...ye}={}){const ve=new XHRClient(ie),be=new RemoteSource(ve,Z,ee,ae);return maybeWrapInBlockedSource(be,ye)}function makeHttpSource(ie,{headers:Z={},maxRanges:ee=0,allowFullFile:ae=!1,...ye}={}){const ve=new HttpClient(ie),be=new RemoteSource(ve,Z,ee,ae);return maybeWrapInBlockedSource(be,ye)}function makeRemoteSource(ie,{forceXHR:Z=!1,...ee}={}){return typeof fetch=="function"&&!Z?makeFetchSource(ie,ee):typeof XMLHttpRequest<"u"?makeXHRSource(ie,ee):makeHttpSource(ie,ee)}class FileReaderSource extends BaseSource{constructor(Z){super(),this.file=Z}async fetchSlice(Z,ee){return new Promise((ae,ye)=>{const ve=this.file.slice(Z.offset,Z.offset+Z.length),be=new FileReader;be.onload=Ye=>ae(Ye.target.result),be.onerror=ye,be.onabort=ye,be.readAsArrayBuffer(ve),ee&&ee.addEventListener("abort",()=>be.abort())})}}function makeFileReaderSource(ie){return new FileReaderSource(ie)}function getFieldTypeLength(ie){switch(ie){case fieldTypes.BYTE:case fieldTypes.ASCII:case fieldTypes.SBYTE:case fieldTypes.UNDEFINED:return 1;case fieldTypes.SHORT:case fieldTypes.SSHORT:return 2;case fieldTypes.LONG:case fieldTypes.SLONG:case fieldTypes.FLOAT:case fieldTypes.IFD:return 4;case fieldTypes.RATIONAL:case fieldTypes.SRATIONAL:case fieldTypes.DOUBLE:case fieldTypes.LONG8:case fieldTypes.SLONG8:case fieldTypes.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${ie}`)}}function parseGeoKeyDirectory(ie){const Z=ie.GeoKeyDirectory;if(!Z)return null;const ee={};for(let ae=4;ae<=Z[3]*4;ae+=4){const ye=geoKeyNames[Z[ae]],ve=Z[ae+1]?fieldTagNames[Z[ae+1]]:null,be=Z[ae+2],Ye=Z[ae+3];let Ke=null;if(!ve)Ke=Ye;else{if(Ke=ie[ve],typeof Ke>"u"||Ke===null)throw new Error(`Could not get value of geoKey '${ye}'.`);typeof Ke=="string"?Ke=Ke.substring(Ye,Ye+be-1):Ke.subarray&&(Ke=Ke.subarray(Ye,Ye+be),be===1&&(Ke=Ke[0]))}ee[ye]=Ke}return ee}function getValues(ie,Z,ee,ae){let ye=null,ve=null;const be=getFieldTypeLength(Z);switch(Z){case fieldTypes.BYTE:case fieldTypes.ASCII:case fieldTypes.UNDEFINED:ye=new Uint8Array(ee),ve=ie.readUint8;break;case fieldTypes.SBYTE:ye=new Int8Array(ee),ve=ie.readInt8;break;case fieldTypes.SHORT:ye=new Uint16Array(ee),ve=ie.readUint16;break;case fieldTypes.SSHORT:ye=new Int16Array(ee),ve=ie.readInt16;break;case fieldTypes.LONG:case fieldTypes.IFD:ye=new Uint32Array(ee),ve=ie.readUint32;break;case fieldTypes.SLONG:ye=new Int32Array(ee),ve=ie.readInt32;break;case fieldTypes.LONG8:case fieldTypes.IFD8:ye=new Array(ee),ve=ie.readUint64;break;case fieldTypes.SLONG8:ye=new Array(ee),ve=ie.readInt64;break;case fieldTypes.RATIONAL:ye=new Uint32Array(ee*2),ve=ie.readUint32;break;case fieldTypes.SRATIONAL:ye=new Int32Array(ee*2),ve=ie.readInt32;break;case fieldTypes.FLOAT:ye=new Float32Array(ee),ve=ie.readFloat32;break;case fieldTypes.DOUBLE:ye=new Float64Array(ee),ve=ie.readFloat64;break;default:throw new RangeError(`Invalid field type: ${Z}`)}if(Z===fieldTypes.RATIONAL||Z===fieldTypes.SRATIONAL)for(let Ye=0;Ye<ee;Ye+=2)ye[Ye]=ve.call(ie,ae+Ye*be),ye[Ye+1]=ve.call(ie,ae+(Ye*be+4));else for(let Ye=0;Ye<ee;++Ye)ye[Ye]=ve.call(ie,ae+Ye*be);return Z===fieldTypes.ASCII?new TextDecoder("utf-8").decode(ye):ye}class ImageFileDirectory{constructor(Z,ee,ae){this.fileDirectory=Z,this.geoKeyDirectory=ee,this.nextIFDByteOffset=ae}}class GeoTIFFImageIndexError extends Error{constructor(Z){super(`No image at index ${Z}`),this.index=Z}}class GeoTIFFBase{async readRasters(Z={}){const{window:ee,width:ae,height:ye}=Z;let{resX:ve,resY:be,bbox:Ye}=Z;const Ke=await this.getImage();let Xe=Ke;const Je=await this.getImageCount(),rt=Ke.getBoundingBox();if(ee&&Ye)throw new Error('Both "bbox" and "window" passed.');if(ae||ye){if(ee){const[lt,ct]=Ke.getOrigin(),[ot,dt]=Ke.getResolution();Ye=[lt+ee[0]*ot,ct+ee[1]*dt,lt+ee[2]*ot,ct+ee[3]*dt]}const it=Ye||rt;if(ae){if(ve)throw new Error("Both width and resX passed");ve=(it[2]-it[0])/ae}if(ye){if(be)throw new Error("Both width and resY passed");be=(it[3]-it[1])/ye}}if(ve||be){const it=[];for(let lt=0;lt<Je;++lt){const ct=await this.getImage(lt),{SubfileType:ot,NewSubfileType:dt}=ct.fileDirectory;(lt===0||ot===2||dt&1)&&it.push(ct)}it.sort((lt,ct)=>lt.getWidth()-ct.getWidth());for(let lt=0;lt<it.length;++lt){const ct=it[lt],ot=(rt[2]-rt[0])/ct.getWidth(),dt=(rt[3]-rt[1])/ct.getHeight();if(Xe=ct,ve&&ve>ot||be&&be>dt)break}}let nt=ee;if(Ye){const[it,lt]=Ke.getOrigin(),[ct,ot]=Xe.getResolution(Ke);nt=[Math.round((Ye[0]-it)/ct),Math.round((Ye[1]-lt)/ot),Math.round((Ye[2]-it)/ct),Math.round((Ye[3]-lt)/ot)],nt=[Math.min(nt[0],nt[2]),Math.min(nt[1],nt[3]),Math.max(nt[0],nt[2]),Math.max(nt[1],nt[3])]}return Xe.readRasters({...Z,window:nt})}}class GeoTIFF extends GeoTIFFBase{constructor(Z,ee,ae,ye,ve={}){super(),this.source=Z,this.littleEndian=ee,this.bigTiff=ae,this.firstIFDOffset=ye,this.cache=ve.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(Z,ee){const ae=this.bigTiff?4048:1024;return new DataSlice((await this.source.fetch([{offset:Z,length:typeof ee<"u"?ee:ae}]))[0],Z,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(Z){const ee=this.bigTiff?20:12,ae=this.bigTiff?8:2;let ye=await this.getSlice(Z);const ve=this.bigTiff?ye.readUint64(Z):ye.readUint16(Z),be=ve*ee+(this.bigTiff?16:6);ye.covers(Z,be)||(ye=await this.getSlice(Z,be));const Ye={};let Ke=Z+(this.bigTiff?8:2);for(let rt=0;rt<ve;Ke+=ee,++rt){const nt=ye.readUint16(Ke),it=ye.readUint16(Ke+2),lt=this.bigTiff?ye.readUint64(Ke+4):ye.readUint32(Ke+4);let ct,ot;const dt=getFieldTypeLength(it),ft=Ke+(this.bigTiff?12:8);if(dt*lt<=(this.bigTiff?8:4))ct=getValues(ye,it,lt,ft);else{const gt=ye.readOffset(ft),mt=getFieldTypeLength(it)*lt;if(ye.covers(gt,mt))ct=getValues(ye,it,lt,gt);else{const Yr=await this.getSlice(gt,mt);ct=getValues(Yr,it,lt,gt)}}lt===1&&arrayFields.indexOf(nt)===-1&&!(it===fieldTypes.RATIONAL||it===fieldTypes.SRATIONAL)?ot=ct[0]:ot=ct,Ye[fieldTagNames[nt]]=ot}const Xe=parseGeoKeyDirectory(Ye),Je=ye.readOffset(Z+ae+ee*ve);return new ImageFileDirectory(Ye,Xe,Je)}async requestIFD(Z){if(this.ifdRequests[Z])return this.ifdRequests[Z];if(Z===0)return this.ifdRequests[Z]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[Z];if(!this.ifdRequests[Z-1])try{this.ifdRequests[Z-1]=this.requestIFD(Z-1)}catch(ee){throw ee instanceof GeoTIFFImageIndexError?new GeoTIFFImageIndexError(Z):ee}return this.ifdRequests[Z]=(async()=>{const ee=await this.ifdRequests[Z-1];if(ee.nextIFDByteOffset===0)throw new GeoTIFFImageIndexError(Z);return this.parseFileDirectoryAt(ee.nextIFDByteOffset)})(),this.ifdRequests[Z]}async getImage(Z=0){const ee=await this.requestIFD(Z);return new GeoTIFFImage(ee.fileDirectory,ee.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let Z=0,ee=!0;for(;ee;)try{await this.requestIFD(Z),++Z}catch(ae){if(ae instanceof GeoTIFFImageIndexError)ee=!1;else throw ae}return Z}async getGhostValues(){const Z=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const ee="GDAL_STRUCTURAL_METADATA_SIZE=",ae=ee.length+100;let ye=await this.getSlice(Z,ae);if(ee===getValues(ye,fieldTypes.ASCII,ee.length,Z)){const ve=getValues(ye,fieldTypes.ASCII,ae,Z).split(`
`)[0],be=Number(ve.split("=")[1].split(" ")[0])+ve.length;be>ae&&(ye=await this.getSlice(Z,be));const Ye=getValues(ye,fieldTypes.ASCII,be,Z);this.ghostValues={},Ye.split(`
`).filter(Ke=>Ke.length>0).map(Ke=>Ke.split("=")).forEach(([Ke,Xe])=>{this.ghostValues[Ke]=Xe})}return this.ghostValues}static async fromSource(Z,ee,ae){const ye=(await Z.fetch([{offset:0,length:1024}],ae))[0],ve=new DataView64(ye),be=ve.getUint16(0,0);let Ye;if(be===18761)Ye=!0;else if(be===19789)Ye=!1;else throw new TypeError("Invalid byte order value.");const Ke=ve.getUint16(2,Ye);let Xe;if(Ke===42)Xe=!1;else if(Ke===43){if(Xe=!0,ve.getUint16(4,Ye)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const Je=Xe?ve.getUint64(8,Ye):ve.getUint32(4,Ye);return new GeoTIFF(Z,Ye,Xe,Je,ee)}close(){return typeof this.source.close=="function"?this.source.close():!1}}class MultiGeoTIFF extends GeoTIFFBase{constructor(Z,ee){super(),this.mainFile=Z,this.overviewFiles=ee,this.imageFiles=[Z].concat(ee),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){const Z=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map(ee=>ee.parseFileDirectoryAt(ee.firstIFDOffset)));return this.fileDirectoriesPerFile=await Promise.all(Z),this.fileDirectoriesPerFile}async getImage(Z=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let ee=0,ae=0;for(let ye=0;ye<this.imageFiles.length;ye++){const ve=this.imageFiles[ye];for(let be=0;be<this.imageCounts[ye];be++){if(Z===ee){const Ye=await ve.requestIFD(ae);return new GeoTIFFImage(Ye.fileDirectory,Ye.geoKeyDirectory,ve.dataView,ve.littleEndian,ve.cache,ve.source)}ee++,ae++}ae=0}throw new RangeError("Invalid image index")}async getImageCount(){if(this.imageCount!==null)return this.imageCount;const Z=[this.mainFile.getImageCount()].concat(this.overviewFiles.map(ee=>ee.getImageCount()));return this.imageCounts=await Promise.all(Z),this.imageCount=this.imageCounts.reduce((ee,ae)=>ee+ae,0),this.imageCount}}async function fromUrl(ie,Z={},ee){return GeoTIFF.fromSource(makeRemoteSource(ie,Z),ee)}async function fromBlob(ie,Z){return GeoTIFF.fromSource(makeFileReaderSource(ie),Z)}async function fromUrls(ie,Z=[],ee={},ae){const ye=await GeoTIFF.fromSource(makeRemoteSource(ie,ee),ae),ve=await Promise.all(Z.map(be=>GeoTIFF.fromSource(makeRemoteSource(be,ee))));return new MultiGeoTIFF(ye,ve)}function isMask(ie){return((ie.fileDirectory.NewSubfileType||0)&4)===4}function readRGB(ie,Z){if(!ie)return!1;if(ie===!0)return!0;if(Z.getSamplesPerPixel()!==3)return!1;const ee=Z.fileDirectory.PhotometricInterpretation,ae=photometricInterpretations;return ee===ae.CMYK||ee===ae.YCbCr||ee===ae.CIELab||ee===ae.ICCLab}const STATISTICS_MAXIMUM="STATISTICS_MAXIMUM",STATISTICS_MINIMUM="STATISTICS_MINIMUM",defaultTileSize=256;let workerPool;function getWorkerPool(){return workerPool||(workerPool=new Pool),workerPool}function getBoundingBox(ie){try{return ie.getBoundingBox()}catch{return[0,0,ie.getWidth(),ie.getHeight()]}}function getOrigin(ie){try{return ie.getOrigin().slice(0,2)}catch{return[0,ie.getHeight()]}}function getResolutions(ie,Z){try{return ie.getResolution(Z)}catch{return[Z.getWidth()/ie.getWidth(),Z.getHeight()/ie.getHeight()]}}function getProjection(ie){const Z=ie.geoKeys;if(!Z)return null;if(Z.ProjectedCSTypeGeoKey&&Z.ProjectedCSTypeGeoKey!==32767){const ee="EPSG:"+Z.ProjectedCSTypeGeoKey;let ae=get$1(ee);if(!ae){const ye=fromCode(Z.ProjLinearUnitsGeoKey);ye&&(ae=new Projection({code:ee,units:ye}))}return ae}if(Z.GeographicTypeGeoKey&&Z.GeographicTypeGeoKey!==32767){const ee="EPSG:"+Z.GeographicTypeGeoKey;let ae=get$1(ee);if(!ae){const ye=fromCode(Z.GeogAngularUnitsGeoKey);ye&&(ae=new Projection({code:ee,units:ye}))}return ae}return null}function getImagesForTIFF(ie){return ie.getImageCount().then(function(Z){const ee=new Array(Z);for(let ae=0;ae<Z;++ae)ee[ae]=ie.getImage(ae);return Promise.all(ee)})}function getImagesForSource(ie,Z){let ee;return ie.blob?ee=fromBlob(ie.blob):ie.overviews?ee=fromUrls(ie.url,ie.overviews,Z):ee=fromUrl(ie.url,Z),ee.then(getImagesForTIFF)}function assertEqual(ie,Z,ee,ae,ye){if(Array.isArray(ie)){const ve=ie.length;if(!Array.isArray(Z)||ve!=Z.length){const be=new Error(ae);throw ye(be),be}for(let be=0;be<ve;++be)assertEqual(ie[be],Z[be],ee,ae,ye);return}if(Z=Z,Math.abs(ie-Z)>ee*ie)throw new Error(ae)}function getMinForDataType(ie){return ie instanceof Int8Array?-128:ie instanceof Int16Array?-32768:ie instanceof Int32Array?-2147483648:ie instanceof Float32Array?12e-39:0}function getMaxForDataType(ie){return ie instanceof Int8Array?127:ie instanceof Uint8Array||ie instanceof Uint8ClampedArray?255:ie instanceof Int16Array?32767:ie instanceof Uint16Array?65535:ie instanceof Int32Array?2147483647:ie instanceof Uint32Array?4294967295:ie instanceof Float32Array?34e37:255}class GeoTIFFSource extends DataTileSource{constructor(Z){super({state:"loading",tileGrid:null,projection:Z.projection||null,opaque:Z.opaque,transition:Z.transition,interpolate:Z.interpolate!==!1,wrapX:Z.wrapX}),this.sourceInfo_=Z.sources;const ee=this.sourceInfo_.length;this.sourceOptions_=Z.sourceOptions,this.sourceImagery_=new Array(ee),this.sourceMasks_=new Array(ee),this.resolutionFactors_=new Array(ee),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=Z.normalize!==!1,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=Z.convertToRGB||!1,this.setKey(this.sourceInfo_.map(ve=>ve.url).join(","));const ae=this,ye=new Array(ee);for(let ve=0;ve<ee;++ve)ye[ve]=getImagesForSource(this.sourceInfo_[ve],this.sourceOptions_);Promise.all(ye).then(function(ve){ae.configure_(ve)}).catch(function(ve){error(ve),ae.error_=ve,ae.setState("error")})}getError(){return this.error_}determineProjection(Z){const ee=Z[0];for(let ae=ee.length-1;ae>=0;--ae){const ye=ee[ae],ve=getProjection(ye);if(ve){this.projection=ve;break}}}configure_(Z){let ee,ae,ye,ve,be;const Ye=new Array(Z.length),Ke=new Array(Z.length),Xe=new Array(Z.length);let Je=0;const rt=Z.length;for(let ct=0;ct<rt;++ct){const ot=[],dt=[];Z[ct].forEach(Jr=>{isMask(Jr)?dt.push(Jr):ot.push(Jr)});const ft=ot.length;if(dt.length>0&&dt.length!==ft)throw new Error(`Expected one mask per image found ${dt.length} masks and ${ft} images`);let gt,mt;const Yr=new Array(ft),Qr=new Array(ft),Xr=new Array(ft);Ke[ct]=new Array(ft),Xe[ct]=new Array(ft);for(let Jr=0;Jr<ft;++Jr){const ai=ot[Jr],oi=ai.getGDALNoData();Xe[ct][Jr]=ai.getGDALMetadata(0),Ke[ct][Jr]=oi;const ni=this.sourceInfo_[ct].bands;Ye[ct]=ni?ni.length:ai.getSamplesPerPixel();const li=ft-(Jr+1);gt||(gt=getBoundingBox(ai)),mt||(mt=getOrigin(ai));const ui=getResolutions(ai,ot[0]);Xr[li]=ui[0];const mi=[ai.getTileWidth(),ai.getTileHeight()];mi[0]!==mi[1]&&mi[1]<defaultTileSize&&(mi[0]=defaultTileSize,mi[1]=defaultTileSize),Yr[li]=mi;const ii=ui[0]/Math.abs(ui[1]);Qr[li]=[mi[0],mi[1]/ii]}if(ee?getIntersection(ee,gt,ee):ee=gt,!ae)ae=mt;else{const Jr=`Origin mismatch for source ${ct}, got [${mt}] but expected [${ae}]`;assertEqual(ae,mt,0,Jr,this.viewRejector)}if(!be)be=Xr,this.resolutionFactors_[ct]=1;else{be.length-Je>Xr.length&&(Je=be.length-Xr.length);const Jr=be[be.length-1]/Xr[Xr.length-1];this.resolutionFactors_[ct]=Jr;const ai=Xr.map(ni=>ni*=Jr),oi=`Resolution mismatch for source ${ct}, got [${ai}] but expected [${be}]`;assertEqual(be.slice(Je,be.length),ai,.02,oi,this.viewRejector)}ye?assertEqual(ye.slice(Je,ye.length),Qr,.01,`Tile size mismatch for source ${ct}`,this.viewRejector):ye=Qr,ve?assertEqual(ve.slice(Je,ve.length),Yr,0,`Tile size mismatch for source ${ct}`,this.viewRejector):ve=Yr,this.sourceImagery_[ct]=ot.reverse(),this.sourceMasks_[ct]=dt.reverse()}for(let ct=0,ot=this.sourceImagery_.length;ct<ot;++ct){const dt=this.sourceImagery_[ct];for(;dt.length<be.length;)dt.unshift(void 0)}this.getProjection()||this.determineProjection(Z),this.samplesPerPixel_=Ye,this.nodataValues_=Ke,this.metadata_=Xe;e:for(let ct=0;ct<rt;++ct){if(this.sourceInfo_[ct].nodata!==void 0){this.addAlpha_=!0;break}if(this.sourceMasks_[ct].length){this.addAlpha_=!0;break}const ot=Ke[ct],dt=this.sourceInfo_[ct].bands;if(dt){for(let ft=0;ft<dt.length;++ft)if(ot[dt[ft]-1]!==null){this.addAlpha_=!0;break e}continue}for(let ft=0;ft<ot.length;++ft)if(ot[ft]!==null){this.addAlpha_=!0;break e}}let nt=this.addAlpha_?1:0;for(let ct=0;ct<rt;++ct)nt+=Ye[ct];this.bandCount=nt;const it=new TileGrid({extent:ee,minZoom:Je,origin:ae,resolutions:be,tileSizes:ye});this.tileGrid=it,this.setTileSizes(ve),this.setLoader(this.loadTile_.bind(this)),this.setState("ready"),be.length===2?be=[be[0],be[1],be[1]/2]:be.length===1&&(be=[be[0]*2,be[0],be[0]/2]),this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:be,center:toUserCoordinate(getCenter(ee),this.projection),extent:toUserExtent(ee,this.projection),zoom:1})}loadTile_(Z,ee,ae){const ye=this.getTileSize(Z),ve=this.sourceImagery_.length,be=new Array(ve*2),Ye=this.nodataValues_,Ke=this.sourceInfo_,Xe=getWorkerPool();for(let Je=0;Je<ve;++Je){const rt=Ke[Je],nt=this.resolutionFactors_[Je],it=[Math.round(ee*(ye[0]*nt)),Math.round(ae*(ye[1]*nt)),Math.round((ee+1)*(ye[0]*nt)),Math.round((ae+1)*(ye[1]*nt))],lt=this.sourceImagery_[Je][Z];let ct;rt.bands&&(ct=rt.bands.map(function(mt){return mt-1}));let ot;"nodata"in rt&&rt.nodata!==null?ot=rt.nodata:ct?ot=ct.map(function(mt){return Ye[Je][mt]}):ot=Ye[Je];const dt={window:it,width:ye[0],height:ye[1],samples:ct,fillValue:ot,pool:Xe,interleave:!1};readRGB(this.convertToRGB_,lt)?be[Je]=lt.readRGB(dt):be[Je]=lt.readRasters(dt);const ft=ve+Je,gt=this.sourceMasks_[Je][Z];if(!gt){be[ft]=Promise.resolve(null);continue}be[ft]=gt.readRasters({window:it,width:ye[0],height:ye[1],samples:[0],pool:Xe,interleave:!1})}return Promise.all(be).then(this.composeTile_.bind(this,ye)).catch(function(Je){throw error(Je),Je})}composeTile_(Z,ee){const ae=this.metadata_,ye=this.sourceInfo_,ve=this.sourceImagery_.length,be=this.bandCount,Ye=this.samplesPerPixel_,Ke=this.nodataValues_,Xe=this.normalize_,Je=this.addAlpha_,rt=Z[0]*Z[1],nt=rt*be;let it;Xe?it=new Uint8Array(nt):it=new Float32Array(nt);let lt=0;for(let ct=0;ct<rt;++ct){let ot=Je;for(let dt=0;dt<ve;++dt){const ft=ye[dt];let gt=ft.min,mt=ft.max,Yr,Qr;if(Xe){const Xr=ae[dt][0];gt===void 0&&(Xr&&STATISTICS_MINIMUM in Xr?gt=parseFloat(Xr[STATISTICS_MINIMUM]):gt=getMinForDataType(ee[dt][0])),mt===void 0&&(Xr&&STATISTICS_MAXIMUM in Xr?mt=parseFloat(Xr[STATISTICS_MAXIMUM]):mt=getMaxForDataType(ee[dt][0])),Yr=255/(mt-gt),Qr=-gt*Yr}for(let Xr=0;Xr<Ye[dt];++Xr){const Jr=ee[dt][Xr][ct];let ai;if(Xe?ai=clamp$1(Yr*Jr+Qr,0,255):ai=Jr,!Je)it[lt]=ai;else{let oi=ft.nodata;if(oi===void 0){let li;ft.bands?li=ft.bands[Xr]-1:li=Xr,oi=Ke[dt][li]}const ni=isNaN(oi);(!ni&&Jr!==oi||ni&&!isNaN(Jr))&&(ot=!1,it[lt]=ai)}lt++}if(!ot){const Xr=ve+dt,Jr=ee[Xr];Jr&&!Jr[0][ct]&&(ot=!0)}}Je&&(ot||(it[lt]=255),lt++)}return it}}class BaseTileRepresentation extends Target{constructor(Z){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter_=Z.gutter||0,this.helper_=Z.helper,this.loaded=!1,this.ready=!1}setTile(Z){if(Z!==this.tile)if(this.tile&&this.tile.removeEventListener(EventType.CHANGE,this.handleTileChange_),this.tile=Z,this.loaded=Z.getState()===TileState.LOADED,this.loaded)this.uploadTile();else{if(Z instanceof ImageTile){const ee=Z.getImage();ee instanceof Image&&!ee.crossOrigin&&(ee.crossOrigin="anonymous")}Z.addEventListener(EventType.CHANGE,this.handleTileChange_)}}uploadTile(){abstract()}setReady(){this.ready=!0,this.dispatchEvent(EventType.CHANGE)}handleTileChange_(){this.tile.getState()===TileState.LOADED&&(this.loaded=!0,this.uploadTile())}disposeInternal(){this.tile.removeEventListener(EventType.CHANGE,this.handleTileChange_)}}const ARRAY_BUFFER=34962,ELEMENT_ARRAY_BUFFER=34963,STREAM_DRAW=35040,STATIC_DRAW=35044,DYNAMIC_DRAW=35048,UNSIGNED_BYTE=5121,UNSIGNED_SHORT=5123,UNSIGNED_INT=5125,FLOAT=5126,CONTEXT_IDS=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function getContext(ie,Z){Z=Object.assign({preserveDrawingBuffer:!0,antialias:!SAFARI_BUG_237906},Z);const ee=CONTEXT_IDS.length;for(let ae=0;ae<ee;++ae)try{const ye=ie.getContext(CONTEXT_IDS[ae],Z);if(ye)return ye}catch{}return null}const BufferUsage={STATIC_DRAW,STREAM_DRAW,DYNAMIC_DRAW};class WebGLArrayBuffer{constructor(Z,ee){this.array=null,this.type=Z,assert(Z===ARRAY_BUFFER||Z===ELEMENT_ARRAY_BUFFER,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage=ee!==void 0?ee:BufferUsage.STATIC_DRAW}ofSize(Z){return this.array=new(getArrayClassForType(this.type))(Z),this}fromArray(Z){return this.array=getArrayClassForType(this.type).from(Z),this}fromArrayBuffer(Z){return this.array=new(getArrayClassForType(this.type))(Z),this}getType(){return this.type}getArray(){return this.array}getUsage(){return this.usage}getSize(){return this.array?this.array.length:0}}function getArrayClassForType(ie){switch(ie){case ARRAY_BUFFER:return Float32Array;case ELEMENT_ARRAY_BUFFER:return Uint32Array;default:return Float32Array}}function bindAndConfigure(ie,Z,ee){const ae=ee?ie.LINEAR:ie.NEAREST;ie.bindTexture(ie.TEXTURE_2D,Z),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_S,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_T,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MIN_FILTER,ae),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MAG_FILTER,ae)}function uploadImageTexture(ie,Z,ee,ae){bindAndConfigure(ie,Z,ae),ie.texImage2D(ie.TEXTURE_2D,0,ie.RGBA,ie.RGBA,ie.UNSIGNED_BYTE,ee)}function uploadDataTexture(ie,Z,ee,ae,ye,ve){const be=ie.getGL();let Ye,Ke;ee instanceof Float32Array?(Ye=be.FLOAT,ie.getExtension("OES_texture_float"),Ke=ie.getExtension("OES_texture_float_linear")!==null):(Ye=be.UNSIGNED_BYTE,Ke=!0),bindAndConfigure(be,Z,ve&&Ke);const Xe=ee.byteLength/ae[1];let Je=1;Xe%8===0?Je=8:Xe%4===0?Je=4:Xe%2===0&&(Je=2);let rt;switch(ye){case 1:{rt=be.LUMINANCE;break}case 2:{rt=be.LUMINANCE_ALPHA;break}case 3:{rt=be.RGB;break}case 4:{rt=be.RGBA;break}default:throw new Error(`Unsupported number of bands: ${ye}`)}const nt=be.getParameter(be.UNPACK_ALIGNMENT);be.pixelStorei(be.UNPACK_ALIGNMENT,Je),be.texImage2D(be.TEXTURE_2D,0,rt,ae[0],ae[1],0,rt,Ye,ee),be.pixelStorei(be.UNPACK_ALIGNMENT,nt)}let pixelContext=null;function createPixelContext(){pixelContext=createCanvasContext2D(1,1,void 0,{willReadFrequently:!0})}class TileTexture extends BaseTileRepresentation{constructor(Z){super(Z),this.textures=[],this.renderSize_=toSize(Z.grid.getTileSize(Z.tile.tileCoord[0])),this.bandCount=NaN;const ee=new WebGLArrayBuffer(ARRAY_BUFFER,STATIC_DRAW);ee.fromArray([0,1,1,1,1,0,0,0]),this.helper_.flushBufferData(ee),this.coords=ee,this.setTile(Z.tile)}uploadTile(){const Z=this.helper_,ee=Z.getGL(),ae=this.tile;this.textures.length=0;let ye;ae instanceof ImageTile||ae instanceof ReprojTile?ye=ae.getImage():ye=ae.getData();const ve=asImageLike(ye);if(ve){const ft=ee.createTexture();this.textures.push(ft),this.bandCount=4,uploadImageTexture(ee,ft,ve,ae.interpolate),this.setReady();return}ye=asArrayLike(ye);const be=ae.getSize(),Ye=[be[0]+2*this.gutter_,be[1]+2*this.gutter_],Ke=ye instanceof Float32Array,Xe=Ye[0]*Ye[1],Je=Ke?Float32Array:Uint8Array,rt=Je.BYTES_PER_ELEMENT,nt=ye.byteLength/Ye[1];this.bandCount=Math.floor(nt/rt/Ye[0]);const it=Math.ceil(this.bandCount/4);if(it===1){const ft=ee.createTexture();this.textures.push(ft),uploadDataTexture(Z,ft,ye,Ye,this.bandCount,ae.interpolate),this.setReady();return}const lt=new Array(it);for(let ft=0;ft<it;++ft){const gt=ee.createTexture();this.textures.push(gt);const mt=ft<it-1?4:(this.bandCount-1)%4+1;lt[ft]=new Je(Xe*mt)}let ct=0,ot=0;const dt=Ye[0]*this.bandCount;for(let ft=0;ft<Ye[1];++ft){for(let gt=0;gt<dt;++gt){const mt=ye[ot+gt],Yr=Math.floor(ct/this.bandCount),Qr=gt%this.bandCount,Xr=Math.floor(Qr/4),Jr=lt[Xr],ai=Jr.length/Xe,oi=Qr%4;Jr[Yr*ai+oi]=mt,++ct}ot+=nt/rt}for(let ft=0;ft<it;++ft){const gt=this.textures[ft],mt=lt[ft],Yr=mt.length/Xe;uploadDataTexture(Z,gt,mt,Ye,Yr,ae.interpolate)}this.setReady()}disposeInternal(){const Z=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(let ee=0;ee<this.textures.length;++ee)Z.deleteTexture(this.textures[ee]);this.tile.removeEventListener(EventType.CHANGE,this.handleTileChange_)}getImagePixelData_(Z,ee,ae){const ye=this.gutter_,ve=this.renderSize_[0],be=this.renderSize_[1];pixelContext||createPixelContext(),pixelContext.clearRect(0,0,1,1);const Ye=Z.width,Ke=Z.height,Xe=Ye-2*ye,Je=Ke-2*ye,rt=ye+Math.floor(Xe*(ee/ve)),nt=ye+Math.floor(Je*(ae/be));let it;try{pixelContext.drawImage(Z,rt,nt,1,1,0,0,1,1),it=pixelContext.getImageData(0,0,1,1).data}catch{return pixelContext=null,null}return it}getArrayPixelData_(Z,ee,ae,ye){const ve=this.gutter_,be=this.renderSize_[0],Ye=this.renderSize_[1],Ke=ee[0],Xe=ee[1],Je=Ke+2*ve,rt=Xe+2*ve,nt=ve+Math.floor(Ke*(ae/be)),it=ve+Math.floor(Xe*(ye/Ye));if(Z instanceof DataView){const ct=Z.byteLength/(Je*rt),ot=ct*(it*Je+nt),dt=Z.buffer.slice(ot,ot+ct);return new DataView(dt)}const lt=this.bandCount*(it*Je+nt);return Z.slice(lt,lt+this.bandCount)}getPixelData(Z,ee){if(!this.loaded)return null;if(this.tile instanceof DataTile){const ae=this.tile.getData(),ye=asArrayLike(ae);if(ye){const ve=this.tile.getSize();return this.getArrayPixelData_(ye,ve,Z,ee)}return this.getImagePixelData_(asImageLike(ae),Z,ee)}return this.getImagePixelData_(this.tile.getImage(),Z,ee)}}const ContextEventType={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},DEFAULT_VERTEX_SHADER=`
  precision mediump float;
  
  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;
  
  uniform vec2 u_screenSize;
   
  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,DEFAULT_FRAGMENT_SHADER=`
  precision mediump float;
   
  uniform sampler2D u_image;
  uniform float u_opacity;
   
  varying vec2 v_texCoord;
   
  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;class WebGLPostProcessingPass{constructor(Z){this.gl_=Z.webGlContext;const ee=this.gl_;this.scaleRatio_=Z.scaleRatio||1,this.renderTargetTexture_=ee.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=ee.createFramebuffer(),this.depthBuffer_=ee.createRenderbuffer();const ae=ee.createShader(ee.VERTEX_SHADER);ee.shaderSource(ae,Z.vertexShader||DEFAULT_VERTEX_SHADER),ee.compileShader(ae);const ye=ee.createShader(ee.FRAGMENT_SHADER);ee.shaderSource(ye,Z.fragmentShader||DEFAULT_FRAGMENT_SHADER),ee.compileShader(ye),this.renderTargetProgram_=ee.createProgram(),ee.attachShader(this.renderTargetProgram_,ae),ee.attachShader(this.renderTargetProgram_,ye),ee.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=ee.createBuffer();const ve=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];ee.bindBuffer(ee.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),ee.bufferData(ee.ARRAY_BUFFER,new Float32Array(ve),ee.STATIC_DRAW),this.renderTargetAttribLocation_=ee.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=ee.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=ee.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=ee.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],Z.uniforms&&Object.keys(Z.uniforms).forEach(be=>{this.uniforms_.push({value:Z.uniforms[be],location:ee.getUniformLocation(this.renderTargetProgram_,be)})})}getGL(){return this.gl_}init(Z){const ee=this.getGL(),ae=[ee.drawingBufferWidth*this.scaleRatio_,ee.drawingBufferHeight*this.scaleRatio_];if(ee.bindFramebuffer(ee.FRAMEBUFFER,this.getFrameBuffer()),ee.bindRenderbuffer(ee.RENDERBUFFER,this.getDepthBuffer()),ee.viewport(0,0,ae[0],ae[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==ae[0]||this.renderTargetTextureSize_[1]!==ae[1]){this.renderTargetTextureSize_=ae;const ye=0,ve=ee.RGBA,be=0,Ye=ee.RGBA,Ke=ee.UNSIGNED_BYTE;ee.bindTexture(ee.TEXTURE_2D,this.renderTargetTexture_),ee.texImage2D(ee.TEXTURE_2D,ye,ve,ae[0],ae[1],be,Ye,Ke,null),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_MIN_FILTER,ee.LINEAR),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_WRAP_S,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_WRAP_T,ee.CLAMP_TO_EDGE),ee.framebufferTexture2D(ee.FRAMEBUFFER,ee.COLOR_ATTACHMENT0,ee.TEXTURE_2D,this.renderTargetTexture_,0),ee.renderbufferStorage(ee.RENDERBUFFER,ee.DEPTH_COMPONENT16,ae[0],ae[1]),ee.framebufferRenderbuffer(ee.FRAMEBUFFER,ee.DEPTH_ATTACHMENT,ee.RENDERBUFFER,this.depthBuffer_)}}apply(Z,ee,ae,ye){const ve=this.getGL(),be=Z.size;if(ve.bindFramebuffer(ve.FRAMEBUFFER,ee?ee.getFrameBuffer():null),ve.activeTexture(ve.TEXTURE0),ve.bindTexture(ve.TEXTURE_2D,this.renderTargetTexture_),!ee){const Ke=getUid(ve.canvas);if(!Z.renderTargets[Ke]){const Xe=ve.getContextAttributes();Xe&&Xe.preserveDrawingBuffer&&(ve.clearColor(0,0,0,0),ve.clearDepth(1),ve.clear(ve.COLOR_BUFFER_BIT|ve.DEPTH_BUFFER_BIT)),Z.renderTargets[Ke]=!0}}ve.disable(ve.DEPTH_TEST),ve.enable(ve.BLEND),ve.blendFunc(ve.ONE,ve.ONE_MINUS_SRC_ALPHA),ve.viewport(0,0,ve.drawingBufferWidth,ve.drawingBufferHeight),ve.bindBuffer(ve.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),ve.useProgram(this.renderTargetProgram_),ve.enableVertexAttribArray(this.renderTargetAttribLocation_),ve.vertexAttribPointer(this.renderTargetAttribLocation_,2,ve.FLOAT,!1,0,0),ve.uniform2f(this.renderTargetUniformLocation_,be[0],be[1]),ve.uniform1i(this.renderTargetTextureLocation_,0);const Ye=Z.layerStatesArray[Z.layerIndex].opacity;ve.uniform1f(this.renderTargetOpacityLocation_,Ye),this.applyUniforms(Z),ae&&ae(ve,Z),ve.drawArrays(ve.TRIANGLES,0,6),ye&&ye(ve,Z)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(Z){const ee=this.getGL();let ae,ye=1;this.uniforms_.forEach(function(ve){if(ae=typeof ve.value=="function"?ve.value(Z):ve.value,ae instanceof HTMLCanvasElement||ae instanceof ImageData)ve.texture||(ve.texture=ee.createTexture()),ee.activeTexture(ee[`TEXTURE${ye}`]),ee.bindTexture(ee.TEXTURE_2D,ve.texture),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_MIN_FILTER,ee.LINEAR),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_WRAP_S,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_WRAP_T,ee.CLAMP_TO_EDGE),ae instanceof ImageData?ee.texImage2D(ee.TEXTURE_2D,0,ee.RGBA,ee.RGBA,ae.width,ae.height,0,ee.UNSIGNED_BYTE,new Uint8Array(ae.data)):ee.texImage2D(ee.TEXTURE_2D,0,ee.RGBA,ee.RGBA,ee.UNSIGNED_BYTE,ae),ee.uniform1i(ve.location,ye++);else if(Array.isArray(ae))switch(ae.length){case 2:ee.uniform2f(ve.location,ae[0],ae[1]);return;case 3:ee.uniform3f(ve.location,ae[0],ae[1],ae[2]);return;case 4:ee.uniform4f(ve.location,ae[0],ae[1],ae[2],ae[3]);return;default:return}else typeof ae=="number"&&ee.uniform1f(ve.location,ae)})}}function create$1(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function fromTransform(ie,Z){return ie[0]=Z[0],ie[1]=Z[1],ie[4]=Z[2],ie[5]=Z[3],ie[12]=Z[4],ie[13]=Z[5],ie}const DefaultUniform={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},AttributeType={UNSIGNED_BYTE,UNSIGNED_SHORT,UNSIGNED_INT,FLOAT},canvasCache={};function getSharedCanvasCacheKey(ie){return"shared/"+ie}let uniqueCanvasCacheKeyCount=0;function getUniqueCanvasCacheKey(){const ie="unique/"+uniqueCanvasCacheKeyCount;return uniqueCanvasCacheKeyCount+=1,ie}function getOrCreateContext(ie){let Z=canvasCache[ie];if(!Z){const ee=document.createElement("canvas");ee.width=1,ee.height=1,ee.style.position="absolute",ee.style.left="0",Z={users:0,context:getContext(ee)},canvasCache[ie]=Z}return Z.users+=1,Z.context}function releaseCanvas(ie){const Z=canvasCache[ie];if(!Z||(Z.users-=1,Z.users>0))return;const ee=Z.context,ae=ee.getExtension("WEBGL_lose_context");ae&&ae.loseContext();const ye=ee.canvas;ye.width=1,ye.height=1,delete canvasCache[ie]}class WebGLHelper extends Disposable{constructor(Z){super(),Z=Z||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=Z.canvasCacheKey?getSharedCanvasCacheKey(Z.canvasCacheKey):getUniqueCanvasCacheKey(),this.gl_=getOrCreateContext(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const ee=this.gl_.canvas;ee.addEventListener(ContextEventType.LOST,this.boundHandleWebGLContextLost_),ee.addEventListener(ContextEventType.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=create$2(),this.offsetScaleMatrix_=create$2(),this.tmpMat4_=create$1(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],Z.uniforms&&this.setUniforms(Z.uniforms),this.postProcessPasses_=Z.postProcesses?Z.postProcesses.map(ae=>new WebGLPostProcessingPass({webGlContext:this.gl_,scaleRatio:ae.scaleRatio,vertexShader:ae.vertexShader,fragmentShader:ae.fragmentShader,uniforms:ae.uniforms})):[new WebGLPostProcessingPass({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(Z){this.uniforms_=[],this.addUniforms(Z)}addUniforms(Z){for(const ee in Z)this.uniforms_.push({name:ee,value:Z[ee]})}canvasCacheKeyMatches(Z){return this.canvasCacheKey_===getSharedCanvasCacheKey(Z)}getExtension(Z){if(Z in this.extensionCache_)return this.extensionCache_[Z];const ee=this.gl_.getExtension(Z);return this.extensionCache_[Z]=ee,ee}bindBuffer(Z){const ee=this.gl_,ae=getUid(Z);let ye=this.bufferCache_[ae];if(!ye){const ve=ee.createBuffer();ye={buffer:Z,webGlBuffer:ve},this.bufferCache_[ae]=ye}ee.bindBuffer(Z.getType(),ye.webGlBuffer)}flushBufferData(Z){const ee=this.gl_;this.bindBuffer(Z),ee.bufferData(Z.getType(),Z.getArray(),Z.getUsage())}deleteBuffer(Z){const ee=this.gl_,ae=getUid(Z),ye=this.bufferCache_[ae];ye&&!ee.isContextLost()&&ee.deleteBuffer(ye.webGlBuffer),delete this.bufferCache_[ae]}disposeInternal(){const Z=this.gl_.canvas;Z.removeEventListener(ContextEventType.LOST,this.boundHandleWebGLContextLost_),Z.removeEventListener(ContextEventType.RESTORED,this.boundHandleWebGLContextRestored_),releaseCanvas(this.canvasCacheKey_),delete this.gl_}prepareDraw(Z,ee,ae){const ye=this.gl_,ve=this.getCanvas(),be=Z.size,Ye=Z.pixelRatio;(ve.width!==be[0]*Ye||ve.height!==be[1]*Ye)&&(ve.width=be[0]*Ye,ve.height=be[1]*Ye,ve.style.width=be[0]+"px",ve.style.height=be[1]+"px");for(let Ke=this.postProcessPasses_.length-1;Ke>=0;Ke--)this.postProcessPasses_[Ke].init(Z);ye.bindTexture(ye.TEXTURE_2D,null),ye.clearColor(0,0,0,0),ye.depthRange(0,1),ye.clearDepth(1),ye.clear(ye.COLOR_BUFFER_BIT|ye.DEPTH_BUFFER_BIT),ye.enable(ye.BLEND),ye.blendFunc(ye.ONE,ee?ye.ZERO:ye.ONE_MINUS_SRC_ALPHA),ae?(ye.enable(ye.DEPTH_TEST),ye.depthFunc(ye.LEQUAL)):ye.disable(ye.DEPTH_TEST)}bindTexture(Z,ee,ae){const ye=this.gl_;ye.activeTexture(ye.TEXTURE0+ee),ye.bindTexture(ye.TEXTURE_2D,Z),ye.uniform1i(this.getUniformLocation(ae),ee)}prepareDrawToRenderTarget(Z,ee,ae,ye){const ve=this.gl_,be=ee.getSize();ve.bindFramebuffer(ve.FRAMEBUFFER,ee.getFramebuffer()),ve.bindRenderbuffer(ve.RENDERBUFFER,ee.getDepthbuffer()),ve.viewport(0,0,be[0],be[1]),ve.bindTexture(ve.TEXTURE_2D,ee.getTexture()),ve.clearColor(0,0,0,0),ve.depthRange(0,1),ve.clearDepth(1),ve.clear(ve.COLOR_BUFFER_BIT|ve.DEPTH_BUFFER_BIT),ve.enable(ve.BLEND),ve.blendFunc(ve.ONE,ae?ve.ZERO:ve.ONE_MINUS_SRC_ALPHA),ye?(ve.enable(ve.DEPTH_TEST),ve.depthFunc(ve.LEQUAL)):ve.disable(ve.DEPTH_TEST)}drawElements(Z,ee){const ae=this.gl_;this.getExtension("OES_element_index_uint");const ye=ae.UNSIGNED_INT,ve=4,be=ee-Z,Ye=Z*ve;ae.drawElements(ae.TRIANGLES,be,ye,Ye)}finalizeDraw(Z,ee,ae){for(let ye=0,ve=this.postProcessPasses_.length;ye<ve;ye++)ye===ve-1?this.postProcessPasses_[ye].apply(Z,null,ee,ae):this.postProcessPasses_[ye].apply(Z,this.postProcessPasses_[ye+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(Z){const ee=Z.size,ae=Z.viewState.rotation,ye=Z.pixelRatio;this.setUniformFloatValue(DefaultUniform.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(DefaultUniform.ZOOM,Z.viewState.zoom),this.setUniformFloatValue(DefaultUniform.RESOLUTION,Z.viewState.resolution),this.setUniformFloatValue(DefaultUniform.PIXEL_RATIO,ye),this.setUniformFloatVec2(DefaultUniform.VIEWPORT_SIZE_PX,[ee[0],ee[1]]),this.setUniformFloatValue(DefaultUniform.ROTATION,ae)}applyHitDetectionUniform(Z){const ee=this.getUniformLocation(DefaultUniform.HIT_DETECTION);this.getGL().uniform1i(ee,Z?1:0),Z&&this.setUniformFloatValue(DefaultUniform.PIXEL_RATIO,.5)}applyUniforms(Z){const ee=this.gl_;let ae,ye=0;this.uniforms_.forEach(ve=>{if(ae=typeof ve.value=="function"?ve.value(Z):ve.value,ae instanceof HTMLCanvasElement||ae instanceof HTMLImageElement||ae instanceof ImageData)ve.texture||(ve.prevValue=void 0,ve.texture=ee.createTexture()),this.bindTexture(ve.texture,ye,ve.name),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_MIN_FILTER,ee.LINEAR),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_WRAP_S,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_WRAP_T,ee.CLAMP_TO_EDGE),(!(ae instanceof HTMLImageElement)||ae.complete)&&ve.prevValue!==ae&&(ve.prevValue=ae,ee.texImage2D(ee.TEXTURE_2D,0,ee.RGBA,ee.RGBA,ee.UNSIGNED_BYTE,ae)),ye++;else if(Array.isArray(ae)&&ae.length===6)this.setUniformMatrixValue(ve.name,fromTransform(this.tmpMat4_,ae));else if(Array.isArray(ae)&&ae.length<=4)switch(ae.length){case 2:ee.uniform2f(this.getUniformLocation(ve.name),ae[0],ae[1]);return;case 3:ee.uniform3f(this.getUniformLocation(ve.name),ae[0],ae[1],ae[2]);return;case 4:ee.uniform4f(this.getUniformLocation(ve.name),ae[0],ae[1],ae[2],ae[3]);return;default:return}else typeof ae=="number"&&ee.uniform1f(this.getUniformLocation(ve.name),ae)})}useProgram(Z,ee){this.gl_.useProgram(Z),this.currentProgram_=Z,this.applyFrameState(ee),this.applyUniforms(ee)}compileShader(Z,ee){const ae=this.gl_,ye=ae.createShader(ee);return ae.shaderSource(ye,Z),ae.compileShader(ye),ye}getProgram(Z,ee){const ae=this.gl_,ye=this.compileShader(Z,ae.FRAGMENT_SHADER),ve=this.compileShader(ee,ae.VERTEX_SHADER),be=ae.createProgram();if(ae.attachShader(be,ye),ae.attachShader(be,ve),ae.linkProgram(be),!ae.getShaderParameter(ye,ae.COMPILE_STATUS)){const Ye=`Fragment shader compilation failed: ${ae.getShaderInfoLog(ye)}`;throw new Error(Ye)}if(ae.deleteShader(ye),!ae.getShaderParameter(ve,ae.COMPILE_STATUS)){const Ye=`Vertex shader compilation failed: ${ae.getShaderInfoLog(ve)}`;throw new Error(Ye)}if(ae.deleteShader(ve),!ae.getProgramParameter(be,ae.LINK_STATUS)){const Ye=`GL program linking failed: ${ae.getProgramInfoLog(be)}`;throw new Error(Ye)}return be}getUniformLocation(Z){const ee=getUid(this.currentProgram_);return this.uniformLocationsByProgram_[ee]===void 0&&(this.uniformLocationsByProgram_[ee]={}),this.uniformLocationsByProgram_[ee][Z]===void 0&&(this.uniformLocationsByProgram_[ee][Z]=this.gl_.getUniformLocation(this.currentProgram_,Z)),this.uniformLocationsByProgram_[ee][Z]}getAttributeLocation(Z){const ee=getUid(this.currentProgram_);return this.attribLocationsByProgram_[ee]===void 0&&(this.attribLocationsByProgram_[ee]={}),this.attribLocationsByProgram_[ee][Z]===void 0&&(this.attribLocationsByProgram_[ee][Z]=this.gl_.getAttribLocation(this.currentProgram_,Z)),this.attribLocationsByProgram_[ee][Z]}makeProjectionTransform(Z,ee){const ae=Z.size,ye=Z.viewState.rotation,ve=Z.viewState.resolution,be=Z.viewState.center;return compose$1(ee,0,0,2/(ve*ae[0]),2/(ve*ae[1]),-ye,-be[0],-be[1]),ee}setUniformFloatValue(Z,ee){this.gl_.uniform1f(this.getUniformLocation(Z),ee)}setUniformFloatVec2(Z,ee){this.gl_.uniform2fv(this.getUniformLocation(Z),ee)}setUniformFloatVec4(Z,ee){this.gl_.uniform4fv(this.getUniformLocation(Z),ee)}setUniformMatrixValue(Z,ee){this.gl_.uniformMatrix4fv(this.getUniformLocation(Z),!1,ee)}enableAttributeArray_(Z,ee,ae,ye,ve){const be=this.getAttributeLocation(Z);be<0||(this.gl_.enableVertexAttribArray(be),this.gl_.vertexAttribPointer(be,ee,ae,!1,ye,ve))}enableAttributes(Z){const ee=computeAttributesStride(Z);let ae=0;for(let ye=0;ye<Z.length;ye++){const ve=Z[ye];this.enableAttributeArray_(ve.name,ve.size,ve.type||FLOAT,ee,ae),ae+=ve.size*getByteSizeFromType(ve.type)}}handleWebGLContextLost(Z){clear(this.bufferCache_),this.currentProgram_=null,Z.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(Z,ee,ae){const ye=this.gl_;ae=ae||ye.createTexture();const ve=0,be=ye.RGBA,Ye=0,Ke=ye.RGBA,Xe=ye.UNSIGNED_BYTE;return ye.bindTexture(ye.TEXTURE_2D,ae),ee?ye.texImage2D(ye.TEXTURE_2D,ve,be,Ke,Xe,ee):ye.texImage2D(ye.TEXTURE_2D,ve,be,Z[0],Z[1],Ye,Ke,Xe,null),ye.texParameteri(ye.TEXTURE_2D,ye.TEXTURE_MIN_FILTER,ye.LINEAR),ye.texParameteri(ye.TEXTURE_2D,ye.TEXTURE_WRAP_S,ye.CLAMP_TO_EDGE),ye.texParameteri(ye.TEXTURE_2D,ye.TEXTURE_WRAP_T,ye.CLAMP_TO_EDGE),ae}}function computeAttributesStride(ie){let Z=0;for(let ee=0;ee<ie.length;ee++){const ae=ie[ee];Z+=ae.size*getByteSizeFromType(ae.type)}return Z}function getByteSizeFromType(ie){switch(ie){case AttributeType.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case AttributeType.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case AttributeType.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case AttributeType.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}class WebGLLayerRenderer extends LayerRenderer{constructor(Z,ee){super(Z),ee=ee||{},this.inversePixelTransform_=create$2(),this.pixelContext_=null,this.postProcesses_=ee.postProcesses,this.uniforms_=ee.uniforms,this.helper,Z.addChangeListener(LayerProperty.MAP,this.removeHelper.bind(this)),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(Z,ee){const ae=this.getLayer();if(ae.hasListener(RenderEventType.PRECOMPOSE)){const ye=new RenderEvent(RenderEventType.PRECOMPOSE,void 0,ee,Z);ae.dispatchEvent(ye)}}dispatchPostComposeEvent(Z,ee){const ae=this.getLayer();if(ae.hasListener(RenderEventType.POSTCOMPOSE)){const ye=new RenderEvent(RenderEventType.POSTCOMPOSE,void 0,ee,Z);ae.dispatchEvent(ye)}}reset(Z){this.uniforms_=Z.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(Z){if(this.getLayer().getRenderSource()){let ee=!0,ae=-1,ye;for(let be=0,Ye=Z.layerStatesArray.length;be<Ye;be++){const Ke=Z.layerStatesArray[be].layer,Xe=Ke.getRenderer();if(!(Xe instanceof WebGLLayerRenderer)){ee=!0;continue}const Je=Ke.getClassName();if((ee||Je!==ye)&&(ae+=1,ee=!1),ye=Je,Xe===this)break}const ve="map/"+Z.mapId+"/group/"+ae;(!this.helper||!this.helper.canvasCacheKeyMatches(ve)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new WebGLHelper({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:ve}),ye&&(this.helper.getCanvas().className=ye),this.afterHelperCreated())}return this.prepareFrameInternal(Z)}afterHelperCreated(){}prepareFrameInternal(Z){return!0}disposeInternal(){this.removeHelper(),super.disposeInternal()}dispatchRenderEvent_(Z,ee,ae){const ye=this.getLayer();if(ye.hasListener(Z)){compose$1(this.inversePixelTransform_,0,0,ae.pixelRatio,-ae.pixelRatio,0,0,-ae.size[1]);const ve=new RenderEvent(Z,this.inversePixelTransform_,ae,ee);ye.dispatchEvent(ve)}}preRender(Z,ee){this.dispatchRenderEvent_(RenderEventType.PRERENDER,Z,ee)}postRender(Z,ee){this.dispatchRenderEvent_(RenderEventType.POSTRENDER,Z,ee)}}const Uniforms$1={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"},empty={};function depthForZ(ie){return 1/(ie+2)}function newTileRepresentationLookup(){return{tileIds:new Set,representationsByZ:{}}}function lookupHasTile(ie,Z){return ie.tileIds.has(getUid(Z))}function addTileRepresentationToLookup(ie,Z,ee){const ae=ie.representationsByZ;ee in ae||(ae[ee]=new Set),ae[ee].add(Z),ie.tileIds.add(getUid(Z.tile))}function getRenderExtent(ie,Z){const ee=ie.layerStatesArray[ie.layerIndex];ee.extent&&(Z=getIntersection(Z,fromUserExtent(ee.extent,ie.viewState.projection)));const ae=ee.layer.getRenderSource();if(!ae.getWrapX()){const ye=ae.getTileGridForProjection(ie.viewState.projection).getExtent();ye&&(Z=getIntersection(Z,ye))}return Z}function getCacheKey(ie,Z){return`${ie.getKey()},${getKey(Z)}`}class WebGLBaseTileLayerRenderer extends WebGLLayerRenderer{constructor(Z,ee){super(Z,{uniforms:ee.uniforms,postProcesses:ee.postProcesses}),this.renderComplete=!1,this.tileTransform_=create$2(),this.tempMat4=create$1(),this.tempTileRange_=new TileRange(0,0,0,0),this.tempTileCoord_=createOrUpdate$1(0,0,0),this.tempSize_=[0,0];const ae=ee.cacheSize!==void 0?ee.cacheSize:512;this.tileRepresentationCache=new LRUCache(ae),this.frameState=null,this.projection_=void 0}reset(Z){super.reset({uniforms:Z.uniforms})}isDrawableTile_(Z){const ee=this.getLayer(),ae=Z.getState(),ye=ee.getUseInterimTilesOnError();return ae==TileState.LOADED||ae==TileState.EMPTY||ae==TileState.ERROR&&!ye}prepareFrameInternal(Z){this.projection_?Z.viewState.projection!==this.projection_&&(this.clearCache(),this.projection_=Z.viewState.projection):this.projection_=Z.viewState.projection;const ee=this.getLayer().getRenderSource();return!ee||isEmpty(getRenderExtent(Z,Z.extent))?!1:ee.getState()==="ready"}createTileRepresentation(Z){return abstract()}enqueueTiles(Z,ee,ae,ye,ve){const be=Z.viewState,Ye=this.getLayer(),Ke=Ye.getRenderSource(),Xe=Ke.getTileGridForProjection(be.projection),Je=Ke.getGutterForProjection(be.projection),rt=getUid(Ke);rt in Z.wantedTiles||(Z.wantedTiles[rt]={});const nt=Z.wantedTiles[rt],it=this.tileRepresentationCache,lt=Ye.getMapInternal(),ct=Math.max(ae-ve,Xe.getMinZoom(),Xe.getZForResolution(Math.min(Ye.getMaxResolution(),lt?lt.getView().getResolutionForZoom(Math.max(Ye.getMinZoom(),0)):Xe.getResolution(0)),Ke.zDirection));for(let ot=ae;ot>=ct;--ot){const dt=Xe.getTileRangeForExtentAndZ(ee,ot,this.tempTileRange_),ft=Xe.getResolution(ot);for(let gt=dt.minX;gt<=dt.maxX;++gt)for(let mt=dt.minY;mt<=dt.maxY;++mt){const Yr=createOrUpdate$1(ot,gt,mt,this.tempTileCoord_),Qr=getCacheKey(Ke,Yr);let Xr,Jr;if(it.containsKey(Qr)&&(Xr=it.get(Qr),Jr=Xr.tile),(!Xr||Xr.tile.key!==Ke.getKey())&&(Jr=Ke.getTile(ot,gt,mt,Z.pixelRatio,be.projection)),lookupHasTile(ye,Jr))continue;if(!Xr)Xr=this.createTileRepresentation({tile:Jr,grid:Xe,helper:this.helper,gutter:Je}),it.set(Qr,Xr);else if(this.isDrawableTile_(Jr))Xr.setTile(Jr);else{const oi=Jr.getInterimTile();Xr.setTile(oi)}addTileRepresentationToLookup(ye,Xr,ot);const ai=Jr.getKey();nt[ai]=!0,Jr.getState()===TileState.IDLE&&(Z.tileQueue.isKeyQueued(ai)||Z.tileQueue.enqueue([Jr,rt,Xe.getTileCoordCenter(Yr),ft]))}}}beforeTilesRender(Z,ee){this.helper.prepareDraw(this.frameState,!ee,!0)}renderTile(Z,ee,ae,ye,ve,be,Ye,Ke,Xe,Je,rt){}drawTile_(Z,ee,ae,ye,ve,be,Ye){if(!ee.loaded)return;const Ke=ee.tile.tileCoord,Xe=getKey(Ke),Je=Xe in be?be[Xe]:1,rt=Ye.getResolution(ae),nt=toSize(Ye.getTileSize(ae),this.tempSize_),it=Ye.getOrigin(ae),lt=Ye.getTileCoordExtent(Ke),ct=Je<1?-1:depthForZ(ae);Je<1&&(Z.animate=!0);const ot=Z.viewState,dt=ot.center[0],ft=ot.center[1],gt=nt[0]+2*ye,mt=nt[1]+2*ye,Yr=gt/mt,Qr=(dt-it[0])/(nt[0]*rt),Xr=(it[1]-ft)/(nt[1]*rt),Jr=ot.resolution/rt,ai=Ke[1],oi=Ke[2];reset(this.tileTransform_),scale$3(this.tileTransform_,2/(Z.size[0]*Jr/gt),-2/(Z.size[1]*Jr/gt)),rotate$3(this.tileTransform_,ot.rotation),scale$3(this.tileTransform_,1,1/Yr),translate$1(this.tileTransform_,(nt[0]*(ai-Qr)-ye)/gt,(nt[1]*(oi-Xr)-ye)/mt),this.renderTile(ee,this.tileTransform_,Z,ve,rt,nt,it,lt,ct,ye,Je)}renderFrame(Z){this.frameState=Z,this.renderComplete=!0;const ee=this.helper.getGL();this.preRender(ee,Z);const ae=Z.viewState,ye=this.getLayer(),ve=ye.getRenderSource(),be=ve.getTileGridForProjection(ae.projection),Ye=ve.getGutterForProjection(ae.projection),Ke=getRenderExtent(Z,Z.extent),Xe=be.getZForResolution(ae.resolution,ve.zDirection),Je=newTileRepresentationLookup(),rt=ye.getPreload();if(Z.nextExtent){const Yr=be.getZForResolution(ae.nextResolution,ve.zDirection),Qr=getRenderExtent(Z,Z.nextExtent);this.enqueueTiles(Z,Qr,Yr,Je,rt)}this.enqueueTiles(Z,Ke,Xe,Je,0),rt>0&&setTimeout(()=>{this.enqueueTiles(Z,Ke,Xe-1,Je,rt-1)},0);const nt={},it=getUid(this),lt=Z.time;let ct=!1;for(const Yr of Je.representationsByZ[Xe]){const Qr=Yr.tile;if((Qr instanceof ReprojTile||Qr instanceof ReprojDataTile)&&Qr.getState()===TileState.EMPTY)continue;const Xr=Qr.tileCoord;if(Yr.loaded){const ai=Qr.getAlpha(it,lt);if(ai===1){Qr.endTransition(it);continue}ct=!0;const oi=getKey(Xr);nt[oi]=ai}if(this.renderComplete=!1,this.findAltTiles_(be,Xr,Xe+1,Je))continue;const Jr=be.getMinZoom();for(let ai=Xe-1;ai>=Jr&&!this.findAltTiles_(be,Xr,ai,Je);--ai);}this.beforeTilesRender(Z,ct);const ot=Je.representationsByZ,dt=Object.keys(ot).map(Number).sort(descending);for(let Yr=0,Qr=dt.length;Yr<Qr;++Yr){const Xr=dt[Yr];for(const Jr of ot[Xr]){const ai=Jr.tile.tileCoord;getKey(ai)in nt||this.drawTile_(Z,Jr,Xr,Ye,Ke,nt,be)}}for(const Yr of ot[Xe]){const Qr=Yr.tile.tileCoord;getKey(Qr)in nt&&this.drawTile_(Z,Yr,Xe,Ye,Ke,nt,be)}this.helper.finalizeDraw(Z,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const ft=this.helper.getCanvas(),gt=this.tileRepresentationCache;for(;gt.canExpireCache();)gt.pop().dispose();const mt=function(Yr,Qr){ve.updateCacheSize(.1,Qr.viewState.projection),ve.expireCache(Qr.viewState.projection,empty)};return Z.postRenderFunctions.push(mt),this.postRender(ee,Z),ft}findAltTiles_(Z,ee,ae,ye){const ve=Z.getTileRangeForTileCoordAndZ(ee,ae,this.tempTileRange_);if(!ve)return!1;let be=!0;const Ye=this.tileRepresentationCache,Ke=this.getLayer().getRenderSource();for(let Xe=ve.minX;Xe<=ve.maxX;++Xe)for(let Je=ve.minY;Je<=ve.maxY;++Je){const rt=getCacheKey(Ke,[ae,Xe,Je]);let nt=!1;if(Ye.containsKey(rt)){const it=Ye.get(rt);it.loaded&&!lookupHasTile(ye,it.tile)&&(addTileRepresentationToLookup(ye,it,ae),nt=!0)}nt||(be=!1)}return be}clearCache(){const Z=this.tileRepresentationCache;Z.forEach(ee=>ee.dispose()),Z.clear()}removeHelper(){this.helper&&this.clearCache(),super.removeHelper()}disposeInternal(){super.disposeInternal(),delete this.frameState}}const Uniforms={...Uniforms$1,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},Attributes={TEXTURE_COORD:"a_textureCoord"},attributeDescriptions=[{name:Attributes.TEXTURE_COORD,size:2,type:AttributeType.FLOAT}];class WebGLTileLayerRenderer extends WebGLBaseTileLayerRenderer{constructor(Z,ee){super(Z,ee),this.program_,this.vertexShader_=ee.vertexShader,this.fragmentShader_=ee.fragmentShader,this.indices_=new WebGLArrayBuffer(ELEMENT_ARRAY_BUFFER,STATIC_DRAW),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=ee.paletteTextures||[]}reset(Z){super.reset(Z),this.vertexShader_=Z.vertexShader,this.fragmentShader_=Z.fragmentShader,this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}createTileRepresentation(Z){return new TileTexture(Z)}beforeTilesRender(Z,ee){super.beforeTilesRender(Z,ee),this.helper.useProgram(this.program_,Z)}renderTile(Z,ee,ae,ye,ve,be,Ye,Ke,Xe,Je,rt){const nt=this.helper.getGL();this.helper.bindBuffer(Z.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(attributeDescriptions);let it=0;for(;it<Z.textures.length;){const Yr=`${Uniforms.TILE_TEXTURE_ARRAY}[${it}]`;this.helper.bindTexture(Z.textures[it],it,Yr),++it}for(let Yr=0;Yr<this.paletteTextures_.length;++Yr){const Qr=this.paletteTextures_[Yr],Xr=Qr.getTexture(nt);this.helper.bindTexture(Xr,it,Qr.name),++it}const lt=ae.viewState,ct=be[0]+2*Je,ot=be[1]+2*Je,dt=Z.tile.tileCoord,ft=dt[1],gt=dt[2];this.helper.setUniformMatrixValue(Uniforms.TILE_TRANSFORM,fromTransform(this.tempMat4,ee)),this.helper.setUniformFloatValue(Uniforms.TRANSITION_ALPHA,rt),this.helper.setUniformFloatValue(Uniforms.DEPTH,Xe);let mt=ye;Je>0&&(mt=Ke,getIntersection(mt,ye,mt)),this.helper.setUniformFloatVec4(Uniforms.RENDER_EXTENT,mt),this.helper.setUniformFloatValue(Uniforms.RESOLUTION,lt.resolution),this.helper.setUniformFloatValue(Uniforms.ZOOM,lt.zoom),this.helper.setUniformFloatValue(Uniforms.TEXTURE_PIXEL_WIDTH,ct),this.helper.setUniformFloatValue(Uniforms.TEXTURE_PIXEL_HEIGHT,ot),this.helper.setUniformFloatValue(Uniforms.TEXTURE_RESOLUTION,ve),this.helper.setUniformFloatValue(Uniforms.TEXTURE_ORIGIN_X,Ye[0]+ft*be[0]*ve-Je*ve),this.helper.setUniformFloatValue(Uniforms.TEXTURE_ORIGIN_Y,Ye[1]-gt*be[1]*ve+Je*ve),this.helper.drawElements(0,this.indices_.getSize())}getData(Z){if(!this.helper.getGL())return null;const ee=this.frameState;if(!ee)return null;const ae=this.getLayer(),ye=apply(ee.pixelToCoordinateTransform,Z.slice()),ve=ee.viewState,be=ae.getExtent();if(be&&!containsCoordinate(fromUserExtent(be,ve.projection),ye))return null;const Ye=ae.getSources(boundingExtent([ye]),ve.resolution);let Ke,Xe,Je;for(Ke=Ye.length-1;Ke>=0;--Ke)if(Xe=Ye[Ke],Xe.getState()==="ready"){if(Je=Xe.getTileGridForProjection(ve.projection),Xe.getWrapX())break;const nt=Je.getExtent();if(!nt||containsCoordinate(nt,ye))break}if(Ke<0)return null;const rt=this.tileRepresentationCache;for(let nt=Je.getZForResolution(ve.resolution);nt>=Je.getMinZoom();--nt){const it=Je.getTileCoordForCoordAndZ(ye,nt),lt=getCacheKey(Xe,it);if(!rt.containsKey(lt))continue;const ct=rt.get(lt),ot=ct.tile;if((ot instanceof ReprojTile||ot instanceof ReprojDataTile)&&ot.getState()===TileState.EMPTY)return null;if(!ct.loaded)continue;const dt=Je.getOrigin(nt),ft=toSize(Je.getTileSize(nt)),gt=Je.getResolution(nt),mt=(ye[0]-dt[0])/gt-it[1]*ft[0],Yr=(dt[1]-ye[1])/gt-it[2]*ft[1];return ct.getPixelData(mt,Yr)}return null}disposeInternal(){const Z=this.helper;Z&&(Z.getGL().deleteProgram(this.program_),delete this.program_,Z.deleteBuffer(this.indices_)),super.disposeInternal(),delete this.indices_}}class PaletteTexture{constructor(Z,ee){this.name=Z,this.data=ee,this.texture_=null}getTexture(Z){if(!this.texture_){const ee=Z.createTexture();Z.bindTexture(Z.TEXTURE_2D,ee),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MIN_FILTER,Z.NEAREST),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MAG_FILTER,Z.NEAREST),Z.texImage2D(Z.TEXTURE_2D,0,Z.RGBA,this.data.length/4,1,0,Z.RGBA,Z.UNSIGNED_BYTE,this.data),this.texture_=ee}return this.texture_}}const ValueTypes={NUMBER:1,STRING:2,COLOR:4,BOOLEAN:8,NUMBER_ARRAY:16,ANY:31,NONE:0};function getTypeFromHint(ie){switch(ie){case"string":return ValueTypes.STRING;case"color":return ValueTypes.COLOR;case"number":return ValueTypes.NUMBER;case"boolean":return ValueTypes.BOOLEAN;case"number[]":return ValueTypes.NUMBER_ARRAY;default:throw new Error(`Unrecognized type hint: ${ie}`)}}const Operators={};function getValueType(ie){if(typeof ie=="number")return ValueTypes.NUMBER;if(typeof ie=="boolean")return ValueTypes.BOOLEAN;if(typeof ie=="string")return isStringColor(ie)?ValueTypes.COLOR|ValueTypes.STRING:ValueTypes.STRING;if(!Array.isArray(ie))throw new Error(`Unhandled value type: ${JSON.stringify(ie)}`);const Z=ie;if(Z.every(function(ae){return typeof ae=="number"}))return Z.length===3||Z.length===4?ValueTypes.COLOR|ValueTypes.NUMBER_ARRAY:ValueTypes.NUMBER_ARRAY;if(typeof Z[0]!="string")throw new Error(`Expected an expression operator but received: ${JSON.stringify(Z)}`);const ee=Operators[Z[0]];if(ee===void 0)throw new Error(`Unrecognized expression operator: ${JSON.stringify(Z)}`);return ee.getReturnType(Z.slice(1))}function isTypeUnique(ie){return Math.log2(ie)%1===0}function printTypes(ie){const Z=[];return(ie&ValueTypes.NUMBER)>0&&Z.push("number"),(ie&ValueTypes.COLOR)>0&&Z.push("color"),(ie&ValueTypes.BOOLEAN)>0&&Z.push("boolean"),(ie&ValueTypes.NUMBER_ARRAY)>0&&Z.push("number[]"),(ie&ValueTypes.STRING)>0&&Z.push("string"),Z.length>0?Z.join(", "):"(no type)"}function computeOperatorFunctionName(ie,Z){return`operator_${ie}_${Object.keys(Z.functions).length}`}function numberToGlsl(ie){const Z=ie.toString();return Z.includes(".")?Z:Z+".0"}function arrayToGlsl(ie){if(ie.length<2||ie.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${ie.length}(${ie.map(numberToGlsl).join(", ")})`}function colorToGlsl(ie){const Z=asArray(ie),ee=Z.length>3?Z[3]:1;return arrayToGlsl([Z[0]/255*ee,Z[1]/255*ee,Z[2]/255*ee,ee])}const stringToFloatMap={};let stringToFloatCounter=0;function getStringNumberEquivalent(ie){return ie in stringToFloatMap||(stringToFloatMap[ie]=stringToFloatCounter++),stringToFloatMap[ie]}function stringToGlsl(ie){return numberToGlsl(getStringNumberEquivalent(ie))}function expressionToGlsl(ie,Z,ee){const ae=ee!==void 0?ee:ValueTypes.NUMBER;if(Array.isArray(Z)&&typeof Z[0]=="string"){const ve=Operators[Z[0]];if(ve===void 0)throw new Error(`Unrecognized expression operator: ${JSON.stringify(Z)}`);return ve.toGlsl(ie,Z.slice(1),ae)}const ye=getValueType(Z)&ae;if(assertNotEmptyType(Z,ye,""),(ye&ValueTypes.NUMBER)>0)return numberToGlsl(Z);if((ye&ValueTypes.BOOLEAN)>0)return Z.toString();if((ye&ValueTypes.STRING)>0)return stringToGlsl(Z.toString());if((ye&ValueTypes.COLOR)>0)return colorToGlsl(Z);if((ye&ValueTypes.NUMBER_ARRAY)>0)return arrayToGlsl(Z);throw new Error(`Unexpected expression ${Z} (expected type ${printTypes(ae)})`)}function assertNumber(ie){if(!(getValueType(ie)&ValueTypes.NUMBER))throw new Error(`A numeric value was expected, got ${JSON.stringify(ie)} instead`)}function assertNumbers(ie){for(let Z=0;Z<ie.length;Z++)assertNumber(ie[Z])}function assertString(ie){if(!(getValueType(ie)&ValueTypes.STRING))throw new Error(`A string value was expected, got ${JSON.stringify(ie)} instead`)}function assertBoolean(ie){if(!(getValueType(ie)&ValueTypes.BOOLEAN))throw new Error(`A boolean value was expected, got ${JSON.stringify(ie)} instead`)}function assertArgsCount(ie,Z){if(ie.length!==Z)throw new Error(`Exactly ${Z} arguments were expected, got ${ie.length} instead`)}function assertArgsMinCount(ie,Z){if(ie.length<Z)throw new Error(`At least ${Z} arguments were expected, got ${ie.length} instead`)}function assertArgsMaxCount(ie,Z){if(ie.length>Z)throw new Error(`At most ${Z} arguments were expected, got ${ie.length} instead`)}function assertArgsEven(ie){if(ie.length%2!==0)throw new Error(`An even amount of arguments was expected, got ${JSON.stringify(ie)} instead`)}function assertArgsOdd(ie){if(ie.length%2===0)throw new Error(`An odd amount of arguments was expected, got ${JSON.stringify(ie)} instead`)}function assertNotEmptyType(ie,Z,ee){if(Z===ValueTypes.NONE)throw new Error(`No matching type was found for the following expression ${ee}: ${JSON.stringify(ie)}`)}function assertSingleType(ie,Z,ee){if(assertNotEmptyType(ie,Z,ee),!isTypeUnique(Z))throw new Error(`Expected to have a unique type for the following expression ${ee}: ${JSON.stringify(ie)}
Got the following types instead: ${printTypes(Z)}`)}function assertOfType(ie,Z,ee,ae){if((Z&ee)===ValueTypes.NONE)throw new Error(`Expected the ${ae} type of the following expression: ${JSON.stringify(ie)} to be of the following types: ${printTypes(ee)}
Got these types instead: ${printTypes(Z)}`)}Operators.get={getReturnType:function(ie){if(ie.length===2){const Z=ie[1];return getTypeFromHint(Z)}return ValueTypes.ANY},toGlsl:function(ie,Z,ee){assertArgsMinCount(Z,1),assertArgsMaxCount(Z,2),assertString(Z[0]);const ae=ee&Operators.get.getReturnType(Z);assertSingleType(["get",...Z],ae,"");const ye=Z[0].toString(),ve=ie.attributes.find(be=>be.name===ye);if(!ve)ie.attributes.push({name:ye,type:ae});else if(ae!==ve.type)throw new Error(`The following attribute was used in different places with incompatible types: ${ye}
Types were: ${printTypes(ve.type)} and ${printTypes(ae)}`);return(ie.inFragmentShader?"v_":"a_")+ye}};function uniformNameForVariable(ie){return"u_var_"+ie}Operators.var={getReturnType:function(){return ValueTypes.ANY},toGlsl:function(ie,Z,ee){assertArgsCount(Z,1),assertString(Z[0]);const ae=Z[0].toString();if(!ie.style.variables||ie.style.variables[ae]===void 0)throw new Error(`The following variable is missing from the style: ${ae}`);const ye=ie.style.variables[ae],ve=ee&getValueType(ye);assertSingleType(["var",...Z],ve,"");const be=ie.variables.find(Ye=>Ye.name===ae);if(!be)ie.variables.push({name:ae,type:ve});else if(ve!==be.type)throw new Error(`The following variable was used in different places with incompatible types: ${ae}
Types were: ${printTypes(be.type)} and ${printTypes(ve)}`);return uniformNameForVariable(ae)}};const PALETTE_TEXTURE_ARRAY="u_paletteTextures";Operators.palette={getReturnType:function(){return ValueTypes.COLOR},toGlsl:function(ie,Z){assertArgsCount(Z,2),assertNumber(Z[0]);const ee=expressionToGlsl(ie,Z[0]),ae=Z[1];if(!Array.isArray(ae))throw new Error("The second argument of palette must be an array");const ye=ae.length,ve=new Uint8Array(ye*4);for(let Ke=0;Ke<ye;Ke++){const Xe=ae[Ke];let Je;if(typeof Xe=="string")Je=fromString(Xe);else{if(!Array.isArray(Xe))throw new Error("The second argument of palette must be an array of strings or colors");const nt=Xe.length;if(nt===4)Je=Xe;else{if(nt!==3)throw new Error(`Expected palette color to have 3 or 4 values, got ${nt}`);Je=[Xe[0],Xe[1],Xe[2],1]}}const rt=Ke*4;ve[rt]=Je[0],ve[rt+1]=Je[1],ve[rt+2]=Je[2],ve[rt+3]=Je[3]*255}ie.paletteTextures||(ie.paletteTextures=[]);const be=`${PALETTE_TEXTURE_ARRAY}[${ie.paletteTextures.length}]`,Ye=new PaletteTexture(be,ve);return ie.paletteTextures.push(Ye),`texture2D(${be}, vec2((${ee} + 0.5) / ${ye}.0, 0.5))`}};const GET_BAND_VALUE_FUNC="getBandValue";Operators.band={getReturnType:function(){return ValueTypes.NUMBER},toGlsl:function(ie,Z){assertArgsMinCount(Z,1),assertArgsMaxCount(Z,3);const ee=Z[0];if(!(GET_BAND_VALUE_FUNC in ie.functions)){let be="";const Ye=ie.bandCount||1;for(let Ke=0;Ke<Ye;Ke++){const Xe=Math.floor(Ke/4);let Je=Ke%4;Ke===Ye-1&&Je===1&&(Je=3);const rt=`${Uniforms.TILE_TEXTURE_ARRAY}[${Xe}]`;be+=`
          if (band == ${Ke+1}.0) {
            return texture2D(${rt}, v_textureCoord + vec2(dx, dy))[${Je}];
          }
        `}ie.functions[GET_BAND_VALUE_FUNC]=`
        float getBandValue(float band, float xOffset, float yOffset) {
          float dx = xOffset / ${Uniforms.TEXTURE_PIXEL_WIDTH};
          float dy = yOffset / ${Uniforms.TEXTURE_PIXEL_HEIGHT};
          ${be}
        }
      `}const ae=expressionToGlsl(ie,ee),ye=expressionToGlsl(ie,Z[1]||0),ve=expressionToGlsl(ie,Z[2]||0);return`${GET_BAND_VALUE_FUNC}(${ae}, ${ye}, ${ve})`}};Operators.time={getReturnType:function(){return ValueTypes.NUMBER},toGlsl:function(ie,Z){return assertArgsCount(Z,0),"u_time"}};Operators.zoom={getReturnType:function(){return ValueTypes.NUMBER},toGlsl:function(ie,Z){return assertArgsCount(Z,0),"u_zoom"}};Operators.resolution={getReturnType:function(){return ValueTypes.NUMBER},toGlsl:function(ie,Z){return assertArgsCount(Z,0),"u_resolution"}};Operators["geometry-type"]={getReturnType:function(){return ValueTypes.STRING},toGlsl:function(ie,Z){assertArgsCount(Z,0);const ee="geometryType",ae=ye=>{const ve=ye.getType();switch(ve){case"Point":case"LineString":case"Polygon":return ve;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return ve.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return ae(ye.getGeometries()[0])}};return ie.attributes.find(ye=>ye.name===ee)||ie.attributes.push({name:ee,type:ValueTypes.STRING,callback:ye=>ae(ye.getGeometry())}),(ie.inFragmentShader?"v_":"a_")+ee}};Operators["*"]={getReturnType:function(ie){let Z=ValueTypes.NUMBER|ValueTypes.COLOR;for(let ee=0;ee<ie.length;ee++)Z=Z&getValueType(ie[ee]);return Z},toGlsl:function(ie,Z,ee){assertArgsMinCount(Z,2);let ae=ee;for(let ye=0;ye<Z.length;ye++)ae=ae&getValueType(Z[ye]);return assertOfType(Z,ae,ValueTypes.NUMBER|ValueTypes.COLOR,"output"),`(${Z.map(ye=>expressionToGlsl(ie,ye,ae)).join(" * ")})`}};Operators["/"]={getReturnType:function(){return ValueTypes.NUMBER},toGlsl:function(ie,Z){return assertArgsCount(Z,2),assertNumbers(Z),`(${expressionToGlsl(ie,Z[0])} / ${expressionToGlsl(ie,Z[1])})`}};Operators["+"]={getReturnType:function(){return ValueTypes.NUMBER},toGlsl:function(ie,Z){return assertArgsMinCount(Z,2),assertNumbers(Z),`(${Z.map(ee=>expressionToGlsl(ie,ee)).join(" + ")})`}};Operators["-"]={getReturnType:function(){return ValueTypes.NUMBER},toGlsl:function(ie,Z){return assertArgsCount(Z,2),assertNumbers(Z),`(${expressionToGlsl(ie,Z[0])} - ${expressionToGlsl(ie,Z[1])})`}};Operators.clamp={getReturnType:function(){return ValueTypes.NUMBER},toGlsl:function(ie,Z){assertArgsCount(Z,3),assertNumbers(Z);const ee=expressionToGlsl(ie,Z[1]),ae=expressionToGlsl(ie,Z[2]);return`clamp(${expressionToGlsl(ie,Z[0])}, ${ee}, ${ae})`}};Operators["%"]={getReturnType:function(){return ValueTypes.NUMBER},toGlsl:function(ie,Z){return assertArgsCount(Z,2),assertNumbers(Z),`mod(${expressionToGlsl(ie,Z[0])}, ${expressionToGlsl(ie,Z[1])})`}};Operators["^"]={getReturnType:function(){return ValueTypes.NUMBER},toGlsl:function(ie,Z){return assertArgsCount(Z,2),assertNumbers(Z),`pow(${expressionToGlsl(ie,Z[0])}, ${expressionToGlsl(ie,Z[1])})`}};Operators.abs={getReturnType:function(){return ValueTypes.NUMBER},toGlsl:function(ie,Z){return assertArgsCount(Z,1),assertNumbers(Z),`abs(${expressionToGlsl(ie,Z[0])})`}};Operators.floor={getReturnType:function(){return ValueTypes.NUMBER},toGlsl:function(ie,Z){return assertArgsCount(Z,1),assertNumbers(Z),`floor(${expressionToGlsl(ie,Z[0])})`}};Operators.round={getReturnType:function(){return ValueTypes.NUMBER},toGlsl:function(ie,Z){return assertArgsCount(Z,1),assertNumbers(Z),`floor(${expressionToGlsl(ie,Z[0])} + 0.5)`}};Operators.ceil={getReturnType:function(){return ValueTypes.NUMBER},toGlsl:function(ie,Z){return assertArgsCount(Z,1),assertNumbers(Z),`ceil(${expressionToGlsl(ie,Z[0])})`}};Operators.sin={getReturnType:function(){return ValueTypes.NUMBER},toGlsl:function(ie,Z){return assertArgsCount(Z,1),assertNumbers(Z),`sin(${expressionToGlsl(ie,Z[0])})`}};Operators.cos={getReturnType:function(){return ValueTypes.NUMBER},toGlsl:function(ie,Z){return assertArgsCount(Z,1),assertNumbers(Z),`cos(${expressionToGlsl(ie,Z[0])})`}};Operators.atan={getReturnType:function(){return ValueTypes.NUMBER},toGlsl:function(ie,Z){return assertArgsMinCount(Z,1),assertArgsMaxCount(Z,2),assertNumbers(Z),Z.length===2?`atan(${expressionToGlsl(ie,Z[0])}, ${expressionToGlsl(ie,Z[1])})`:`atan(${expressionToGlsl(ie,Z[0])})`}};Operators.sqrt={getReturnType:function(){return ValueTypes.NUMBER},toGlsl:function(ie,Z){return assertArgsCount(Z,1),assertNumbers(Z),`sqrt(${expressionToGlsl(ie,Z[0])})`}};Operators[">"]={getReturnType:function(){return ValueTypes.BOOLEAN},toGlsl:function(ie,Z){return assertArgsCount(Z,2),assertNumbers(Z),`(${expressionToGlsl(ie,Z[0])} > ${expressionToGlsl(ie,Z[1])})`}};Operators[">="]={getReturnType:function(){return ValueTypes.BOOLEAN},toGlsl:function(ie,Z){return assertArgsCount(Z,2),assertNumbers(Z),`(${expressionToGlsl(ie,Z[0])} >= ${expressionToGlsl(ie,Z[1])})`}};Operators["<"]={getReturnType:function(){return ValueTypes.BOOLEAN},toGlsl:function(ie,Z){return assertArgsCount(Z,2),assertNumbers(Z),`(${expressionToGlsl(ie,Z[0])} < ${expressionToGlsl(ie,Z[1])})`}};Operators["<="]={getReturnType:function(){return ValueTypes.BOOLEAN},toGlsl:function(ie,Z){return assertArgsCount(Z,2),assertNumbers(Z),`(${expressionToGlsl(ie,Z[0])} <= ${expressionToGlsl(ie,Z[1])})`}};function getEqualOperator(ie){return{getReturnType:function(){return ValueTypes.BOOLEAN},toGlsl:function(Z,ee){assertArgsCount(ee,2);let ae=ValueTypes.ANY;for(let ye=0;ye<ee.length;ye++)ae&=getValueType(ee[ye]);if(ae===ValueTypes.NONE)throw new Error(`All arguments should be of compatible type, got ${JSON.stringify(ee)} instead`);return ae&=~ValueTypes.COLOR,`(${expressionToGlsl(Z,ee[0],ae)} ${ie} ${expressionToGlsl(Z,ee[1],ae)})`}}}Operators["=="]=getEqualOperator("==");Operators["!="]=getEqualOperator("!=");Operators["!"]={getReturnType:function(){return ValueTypes.BOOLEAN},toGlsl:function(ie,Z){return assertArgsCount(Z,1),assertBoolean(Z[0]),`(!${expressionToGlsl(ie,Z[0],ValueTypes.BOOLEAN)})`}};function getDecisionOperator(ie){return{getReturnType:function(){return ValueTypes.BOOLEAN},toGlsl:function(Z,ee){assertArgsMinCount(ee,2);for(let ye=0;ye<ee.length;ye++)assertBoolean(ee[ye]);let ae=ee.map(ye=>expressionToGlsl(Z,ye,ValueTypes.BOOLEAN)).join(` ${ie} `);return ae=`(${ae})`,ae}}}Operators.all=getDecisionOperator("&&");Operators.any=getDecisionOperator("||");Operators.between={getReturnType:function(){return ValueTypes.BOOLEAN},toGlsl:function(ie,Z){assertArgsCount(Z,3),assertNumbers(Z);const ee=expressionToGlsl(ie,Z[1]),ae=expressionToGlsl(ie,Z[2]),ye=expressionToGlsl(ie,Z[0]);return`(${ye} >= ${ee} && ${ye} <= ${ae})`}};Operators.array={getReturnType:function(){return ValueTypes.NUMBER_ARRAY},toGlsl:function(ie,Z){assertArgsMinCount(Z,2),assertArgsMaxCount(Z,4),assertNumbers(Z);const ee=Z.map(function(ae){return expressionToGlsl(ie,ae)});return`vec${Z.length}(${ee.join(", ")})`}};Operators.color={getReturnType:function(){return ValueTypes.COLOR},toGlsl:function(ie,Z){assertArgsMinCount(Z,3),assertArgsMaxCount(Z,4),assertNumbers(Z);const ee=Z.slice(0,3).map(ae=>`${expressionToGlsl(ie,ae)} / 255.0`);return Z.length===3?`vec4(${ee.join(", ")}, 1.0)`:`(${expressionToGlsl(ie,Z[3])} * vec4(${ee.join(", ")}, 1.0))`}};Operators.interpolate={getReturnType:function(ie){let Z=ValueTypes.COLOR|ValueTypes.NUMBER;for(let ee=3;ee<ie.length;ee+=2)Z=Z&getValueType(ie[ee]);return Z},toGlsl:function(ie,Z,ee){assertArgsEven(Z),assertArgsMinCount(Z,6);const ae=Z[0];let ye;switch(ae[0]){case"linear":ye=1;break;case"exponential":ye=ae[1];break;default:ye=null}if(!ye)throw new Error(`Invalid interpolation type for "interpolate" operator, received: ${JSON.stringify(ae)}`);const ve=ValueTypes.NUMBER,be=Operators.interpolate.getReturnType(Z)&ee;assertSingleType(["interpolate",...Z],be,"output");const Ye=expressionToGlsl(ie,Z[1],ve),Ke=numberToGlsl(ye);let Xe="";for(let Je=2;Je<Z.length-2;Je+=2){const rt=expressionToGlsl(ie,Z[Je],ve),nt=Xe||expressionToGlsl(ie,Z[Je+1],be),it=expressionToGlsl(ie,Z[Je+2],ve),lt=expressionToGlsl(ie,Z[Je+3],be);let ct;ye===1?ct=`(${Ye} - ${rt}) / (${it} - ${rt})`:ct=`(pow(${Ke}, (${Ye} - ${rt})) - 1.0) / (pow(${Ke}, (${it} - ${rt})) - 1.0)`,Xe=`mix(${nt}, ${lt}, clamp(${ct}, 0.0, 1.0))`}return Xe}};Operators.match={getReturnType:function(ie){let Z=ValueTypes.ANY;for(let ee=2;ee<ie.length;ee+=2)Z=Z&getValueType(ie[ee]);return Z=Z&getValueType(ie[ie.length-1]),Z},toGlsl:function(ie,Z,ee){assertArgsEven(Z),assertArgsMinCount(Z,4);let ae=getValueType(Z[0]);for(let Ke=1;Ke<Z.length-1;Ke+=2)ae=ae&getValueType(Z[Ke]);assertOfType(["match",...Z],ae,ValueTypes.STRING|ValueTypes.NUMBER|ValueTypes.BOOLEAN,"input"),ae=(ValueTypes.STRING|ValueTypes.NUMBER|ValueTypes.BOOLEAN)&ae;const ye=Operators.match.getReturnType(Z)&ee;assertSingleType(["match",...Z],ye,"output");const ve=expressionToGlsl(ie,Z[0],ae),be=expressionToGlsl(ie,Z[Z.length-1],ye);let Ye=null;for(let Ke=Z.length-3;Ke>=1;Ke-=2){const Xe=expressionToGlsl(ie,Z[Ke],ae),Je=expressionToGlsl(ie,Z[Ke+1],ye);Ye=`(${ve} == ${Xe} ? ${Je} : ${Ye||be})`}return Ye}};Operators.case={getReturnType:function(ie){let Z=ValueTypes.ANY;for(let ee=1;ee<ie.length;ee+=2)Z=Z&getValueType(ie[ee]);return Z=Z&getValueType(ie[ie.length-1]),Z},toGlsl:function(ie,Z,ee){assertArgsOdd(Z),assertArgsMinCount(Z,3);const ae=Operators.case.getReturnType(Z)&ee;assertSingleType(["case",...Z],ae,"output");for(let be=0;be<Z.length-1;be+=2)assertBoolean(Z[be]);const ye=expressionToGlsl(ie,Z[Z.length-1],ae);let ve=null;for(let be=Z.length-3;be>=0;be-=2){const Ye=expressionToGlsl(ie,Z[be],ValueTypes.BOOLEAN),Ke=expressionToGlsl(ie,Z[be+1],ae);ve=`(${Ye} ? ${Ke} : ${ve||ye})`}return ve}};Operators.in={getReturnType:function(ie){return ValueTypes.BOOLEAN},toGlsl:function(ie,Z){assertArgsCount(Z,2);const ee=Z[0];let ae=Z[1];if(!Array.isArray(ae))throw new Error('The "in" operator expects an array literal as its second argument.');if(typeof ae[0]=="string"){if(ae[0]!=="literal")throw new Error('For the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions.');if(!Array.isArray(ae[1]))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');ae=ae[1]}let ye=getValueType(ee);for(let Ye=0;Ye<ae.length-1;Ye+=1)ye=ye&getValueType(ae[Ye]);assertOfType(["match",...Z],ye,ValueTypes.STRING|ValueTypes.NUMBER|ValueTypes.BOOLEAN,"input"),ye=(ValueTypes.STRING|ValueTypes.NUMBER|ValueTypes.BOOLEAN)&ye;const ve=computeOperatorFunctionName("in",ie),be=[];for(let Ye=0;Ye<ae.length;Ye+=1)be.push(`  if (inputValue == ${expressionToGlsl(ie,ae[Ye],ye)}) { return true; }`);return ie.functions[ve]=`bool ${ve}(float inputValue) {
${be.join(`
`)}
  return false;
}`,`${ve}(${expressionToGlsl(ie,ee,ye)})`}};function parseStyle(ie,Z){const ee=`
    attribute vec2 ${Attributes.TEXTURE_COORD};
    uniform mat4 ${Uniforms.TILE_TRANSFORM};
    uniform float ${Uniforms.TEXTURE_PIXEL_WIDTH};
    uniform float ${Uniforms.TEXTURE_PIXEL_HEIGHT};
    uniform float ${Uniforms.TEXTURE_RESOLUTION};
    uniform float ${Uniforms.TEXTURE_ORIGIN_X};
    uniform float ${Uniforms.TEXTURE_ORIGIN_Y};
    uniform float ${Uniforms.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${Attributes.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${Uniforms.TEXTURE_ORIGIN_X} + ${Uniforms.TEXTURE_RESOLUTION} * ${Uniforms.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${Uniforms.TEXTURE_ORIGIN_Y} - ${Uniforms.TEXTURE_RESOLUTION} * ${Uniforms.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${Uniforms.TILE_TRANSFORM} * vec4(${Attributes.TEXTURE_COORD}, ${Uniforms.DEPTH}, 1.0);
    }
  `,ae={inFragmentShader:!0,variables:[],attributes:[],functions:{},bandCount:Z,style:ie},ye=[];if(ie.color!==void 0){const rt=expressionToGlsl(ae,ie.color,ValueTypes.COLOR);ye.push(`color = ${rt};`)}if(ie.contrast!==void 0){const rt=expressionToGlsl(ae,ie.contrast,ValueTypes.NUMBER);ye.push(`color.rgb = clamp((${rt} + 1.0) * color.rgb - (${rt} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(ie.exposure!==void 0){const rt=expressionToGlsl(ae,ie.exposure,ValueTypes.NUMBER);ye.push(`color.rgb = clamp((${rt} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(ie.saturation!==void 0){const rt=expressionToGlsl(ae,ie.saturation,ValueTypes.NUMBER);ye.push(`
      float saturation = ${rt} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(ie.gamma!==void 0){const rt=expressionToGlsl(ae,ie.gamma,ValueTypes.NUMBER);ye.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${rt}));`)}if(ie.brightness!==void 0){const rt=expressionToGlsl(ae,ie.brightness,ValueTypes.NUMBER);ye.push(`color.rgb = clamp(color.rgb + ${rt}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const ve={},be=ae.variables.length;if(be>1&&!ie.variables)throw new Error(`Missing variables in style (expected ${ae.variables})`);for(let rt=0;rt<be;++rt){const nt=ae.variables[rt];if(!(nt.name in ie.variables))throw new Error(`Missing '${nt.name}' in style variables`);const it=uniformNameForVariable(nt.name);ve[it]=function(){let lt=ie.variables[nt.name];return typeof lt=="string"&&(lt=getStringNumberEquivalent(lt)),lt!==void 0?lt:-9999999}}const Ye=Object.keys(ve).map(function(rt){return`uniform float ${rt};`}),Ke=Math.ceil(Z/4);Ye.push(`uniform sampler2D ${Uniforms.TILE_TEXTURE_ARRAY}[${Ke}];`),ae.paletteTextures&&Ye.push(`uniform sampler2D ${PALETTE_TEXTURE_ARRAY}[${ae.paletteTextures.length}];`);const Xe=Object.keys(ae.functions).map(function(rt){return ae.functions[rt]}),Je=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${Uniforms.RENDER_EXTENT};
    uniform float ${Uniforms.TRANSITION_ALPHA};
    uniform float ${Uniforms.TEXTURE_PIXEL_WIDTH};
    uniform float ${Uniforms.TEXTURE_PIXEL_HEIGHT};
    uniform float ${Uniforms.RESOLUTION};
    uniform float ${Uniforms.ZOOM};

    ${Ye.join(`
`)}

    ${Xe.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${Uniforms.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${Uniforms.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${Uniforms.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${Uniforms.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${Uniforms.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${ye.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${Uniforms.TRANSITION_ALPHA};
    }`;return{vertexShader:ee,fragmentShader:Je,uniforms:ve,paletteTextures:ae.paletteTextures}}class WebGLTileLayer extends BaseTileLayer{constructor(Z){Z=Z?Object.assign({},Z):{};const ee=Z.style||{};delete Z.style;const ae=Z.cacheSize;delete Z.cacheSize,super(Z),this.sources_=Z.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=ee,this.cacheSize_=ae,this.styleVariables_=this.style_.variables||{},this.addChangeListener(LayerProperty.SOURCE,this.handleSourceUpdate_)}getSources(Z,ee){const ae=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(Z,ee):this.sources_:ae?[ae]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const Z=this.getRenderSource();return Z?Z.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache(),this.getSource()&&this.setStyle(this.style_)}getSourceBandCount_(){const Z=Number.MAX_SAFE_INTEGER,ee=this.getSources([-Z,-Z,Z,Z],Z);return ee&&ee.length&&"bandCount"in ee[0]?ee[0].bandCount:4}createRenderer(){const Z=parseStyle(this.style_,this.getSourceBandCount_());return new WebGLTileLayerRenderer(this,{vertexShader:Z.vertexShader,fragmentShader:Z.fragmentShader,uniforms:Z.uniforms,cacheSize:this.cacheSize_,paletteTextures:Z.paletteTextures})}renderSources(Z,ee){const ae=this.getRenderer();let ye;for(let ve=0,be=ee.length;ve<be;++ve)this.renderedSource_=ee[ve],ae.prepareFrame(Z)&&(ye=ae.renderFrame(Z));return ye}render(Z,ee){this.rendered=!0;const ae=Z.viewState,ye=this.getSources(Z.extent,ae.resolution);let ve=!0;for(let Ye=0,Ke=ye.length;Ye<Ke;++Ye){const Xe=ye[Ye],Je=Xe.getState();if(Je=="loading"){const rt=()=>{Xe.getState()=="ready"&&(Xe.removeEventListener("change",rt),this.changed())};Xe.addEventListener("change",rt)}ve=ve&&Je=="ready"}const be=this.renderSources(Z,ye);if(this.getRenderer().renderComplete&&ve)return this.renderedResolution_=ae.resolution,be;if(this.renderedResolution_>.5*ae.resolution){const Ye=this.getSources(Z.extent,this.renderedResolution_).filter(Ke=>!ye.includes(Ke));if(Ye.length>0)return this.renderSources(Z,Ye)}return be}setStyle(Z){this.styleVariables_=Z.variables||{},this.style_=Z;const ee=parseStyle(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:ee.vertexShader,fragmentShader:ee.fragmentShader,uniforms:ee.uniforms}),this.changed()}updateStyleVariables(Z){Object.assign(this.styleVariables_,Z),this.changed()}}WebGLTileLayer.prototype.dispose;const events=["fullscreenchange","webkitfullscreenchange","MSFullscreenChange"],FullScreenEventType={ENTERFULLSCREEN:"enterfullscreen",LEAVEFULLSCREEN:"leavefullscreen"};class FullScreen extends Control{constructor(Z){Z=Z||{},super({element:document.createElement("div"),target:Z.target}),this.on,this.once,this.un,this.keys_=Z.keys!==void 0?Z.keys:!1,this.source_=Z.source,this.isInFullscreen_=!1,this.boundHandleMapTargetChange_=this.handleMapTargetChange_.bind(this),this.cssClassName_=Z.className!==void 0?Z.className:"ol-full-screen",this.documentListeners_=[],this.activeClassName_=Z.activeClassName!==void 0?Z.activeClassName.split(" "):[this.cssClassName_+"-true"],this.inactiveClassName_=Z.inactiveClassName!==void 0?Z.inactiveClassName.split(" "):[this.cssClassName_+"-false"];const ee=Z.label!==void 0?Z.label:"⤢";this.labelNode_=typeof ee=="string"?document.createTextNode(ee):ee;const ae=Z.labelActive!==void 0?Z.labelActive:"×";this.labelActiveNode_=typeof ae=="string"?document.createTextNode(ae):ae;const ye=Z.tipLabel?Z.tipLabel:"Toggle full-screen";this.button_=document.createElement("button"),this.button_.title=ye,this.button_.setAttribute("type","button"),this.button_.appendChild(this.labelNode_),this.button_.addEventListener(EventType.CLICK,this.handleClick_.bind(this),!1),this.setClassName_(this.button_,this.isInFullscreen_),this.element.className=`${this.cssClassName_} ${CLASS_UNSELECTABLE} ${CLASS_CONTROL}`,this.element.appendChild(this.button_)}handleClick_(Z){Z.preventDefault(),this.handleFullScreen_()}handleFullScreen_(){const Z=this.getMap();if(!Z)return;const ee=Z.getOwnerDocument();if(isFullScreenSupported(ee))if(isFullScreen(ee))exitFullScreen(ee);else{let ae;this.source_?ae=typeof this.source_=="string"?ee.getElementById(this.source_):this.source_:ae=Z.getTargetElement(),this.keys_?requestFullScreenWithKeys(ae):requestFullScreen(ae)}}handleFullScreenChange_(){const Z=this.getMap();if(!Z)return;const ee=this.isInFullscreen_;this.isInFullscreen_=isFullScreen(Z.getOwnerDocument()),ee!==this.isInFullscreen_&&(this.setClassName_(this.button_,this.isInFullscreen_),this.isInFullscreen_?(replaceNode(this.labelActiveNode_,this.labelNode_),this.dispatchEvent(FullScreenEventType.ENTERFULLSCREEN)):(replaceNode(this.labelNode_,this.labelActiveNode_),this.dispatchEvent(FullScreenEventType.LEAVEFULLSCREEN)),Z.updateSize())}setClassName_(Z,ee){ee?(Z.classList.remove(...this.inactiveClassName_),Z.classList.add(...this.activeClassName_)):(Z.classList.remove(...this.activeClassName_),Z.classList.add(...this.inactiveClassName_))}setMap(Z){const ee=this.getMap();ee&&ee.removeChangeListener(MapProperty.TARGET,this.boundHandleMapTargetChange_),super.setMap(Z),this.handleMapTargetChange_(),Z&&Z.addChangeListener(MapProperty.TARGET,this.boundHandleMapTargetChange_)}handleMapTargetChange_(){const Z=this.documentListeners_;for(let ae=0,ye=Z.length;ae<ye;++ae)unlistenByKey(Z[ae]);Z.length=0;const ee=this.getMap();if(ee){const ae=ee.getOwnerDocument();isFullScreenSupported(ae)?this.element.classList.remove(CLASS_UNSUPPORTED):this.element.classList.add(CLASS_UNSUPPORTED);for(let ye=0,ve=events.length;ye<ve;++ye)Z.push(listen(ae,events[ye],this.handleFullScreenChange_,this));this.handleFullScreenChange_()}}}function isFullScreenSupported(ie){const Z=ie.body;return!!(Z.webkitRequestFullscreen||Z.requestFullscreen&&ie.fullscreenEnabled)}function isFullScreen(ie){return!!(ie.webkitIsFullScreen||ie.fullscreenElement)}function requestFullScreen(ie){ie.requestFullscreen?ie.requestFullscreen():ie.webkitRequestFullscreen&&ie.webkitRequestFullscreen()}function requestFullScreenWithKeys(ie){ie.webkitRequestFullscreen?ie.webkitRequestFullscreen():requestFullScreen(ie)}function exitFullScreen(ie){ie.exitFullscreen?ie.exitFullscreen():ie.webkitExitFullscreen&&ie.webkitExitFullscreen()}class VectorTile extends UrlTile{constructor(Z){const ee=Z.projection||"EPSG:3857",ae=Z.extent||extentFromProjection(ee),ye=Z.tileGrid||createXYZ({extent:ae,maxResolution:Z.maxResolution,maxZoom:Z.maxZoom!==void 0?Z.maxZoom:22,minZoom:Z.minZoom,tileSize:Z.tileSize||512});super({attributions:Z.attributions,attributionsCollapsible:Z.attributionsCollapsible,cacheSize:Z.cacheSize,interpolate:!0,opaque:!1,projection:ee,state:Z.state,tileGrid:ye,tileLoadFunction:Z.tileLoadFunction?Z.tileLoadFunction:defaultLoadFunction,tileUrlFunction:Z.tileUrlFunction,url:Z.url,urls:Z.urls,wrapX:Z.wrapX===void 0?!0:Z.wrapX,transition:Z.transition,zDirection:Z.zDirection===void 0?1:Z.zDirection}),this.format_=Z.format?Z.format:null,this.sourceTileCache=new TileCache(this.tileCache.highWaterMark),this.overlaps_=Z.overlaps==null?!0:Z.overlaps,this.tileClass=Z.tileClass?Z.tileClass:VectorTile$1,this.tileGrids_={}}getFeaturesInExtent(Z){const ee=[],ae=this.tileCache;if(ae.getCount()===0)return ee;const ye=fromKey(ae.peekFirstKey())[0],ve=this.tileGrid;return ae.forEach(function(be){if(be.tileCoord[0]!==ye||be.getState()!==TileState.LOADED)return;const Ye=be.getSourceTiles();for(let Ke=0,Xe=Ye.length;Ke<Xe;++Ke){const Je=Ye[Ke],rt=Je.tileCoord;if(intersects$1(Z,ve.getTileCoordExtent(rt))){const nt=Je.getFeatures();if(nt)for(let it=0,lt=nt.length;it<lt;++it){const ct=nt[it],ot=ct.getGeometry();intersects$1(Z,ot.getExtent())&&ee.push(ct)}}}}),ee}getOverlaps(){return this.overlaps_}clear(){this.tileCache.clear(),this.sourceTileCache.clear()}expireCache(Z,ee){const ae=this.getTileCacheForProjection(Z),ye=Object.keys(ee).reduce((ve,be)=>{const Ye=getCacheKeyForTileKey(be),Ke=ae.peek(Ye);if(Ke){const Xe=Ke.sourceTiles;for(let Je=0,rt=Xe.length;Je<rt;++Je)ve[Xe[Je].getKey()]=!0}return ve},{});super.expireCache(Z,ee),this.sourceTileCache.expireCache(ye)}getSourceTiles(Z,ee,ae){if(ae.getState()===TileState.IDLE){ae.setState(TileState.LOADING);const ye=ae.wrappedTileCoord,ve=this.getTileGridForProjection(ee),be=ve.getTileCoordExtent(ye),Ye=ye[0],Ke=ve.getResolution(Ye);buffer$1(be,-Ke,be);const Xe=this.tileGrid,Je=Xe.getExtent();Je&&getIntersection(be,Je,be);const rt=Xe.getZForResolution(Ke,this.zDirection);Xe.forEachTileCoord(be,rt,nt=>{const it=this.tileUrlFunction(nt,Z,ee),lt=this.sourceTileCache.containsKey(it)?this.sourceTileCache.get(it):new this.tileClass(nt,it?TileState.IDLE:TileState.EMPTY,it,this.format_,this.tileLoadFunction);ae.sourceTiles.push(lt);const ct=lt.getState();if(ct<TileState.LOADED){const ot=dt=>{this.handleTileChange(dt);const ft=lt.getState();if(ft===TileState.LOADED||ft===TileState.ERROR){const gt=lt.getKey();gt in ae.errorTileKeys?lt.getState()===TileState.LOADED&&delete ae.errorTileKeys[gt]:ae.loadingSourceTiles--,ft===TileState.ERROR?ae.errorTileKeys[gt]=!0:lt.removeEventListener(EventType.CHANGE,ot),ae.loadingSourceTiles===0&&ae.setState(isEmpty$1(ae.errorTileKeys)?TileState.LOADED:TileState.ERROR)}};lt.addEventListener(EventType.CHANGE,ot),ae.loadingSourceTiles++}ct===TileState.IDLE&&(lt.extent=Xe.getTileCoordExtent(nt),lt.projection=ee,lt.resolution=Xe.getResolution(nt[0]),this.sourceTileCache.set(it,lt),lt.load())}),ae.loadingSourceTiles||ae.setState(ae.sourceTiles.some(nt=>nt.getState()===TileState.ERROR)?TileState.ERROR:TileState.LOADED)}return ae.sourceTiles}getTile(Z,ee,ae,ye,ve){const be=getKeyZXY(Z,ee,ae),Ye=this.getKey();let Ke;if(this.tileCache.containsKey(be)&&(Ke=this.tileCache.get(be),Ke.key===Ye))return Ke;const Xe=[Z,ee,ae];let Je=this.getTileCoordForTileUrlFunction(Xe,ve);const rt=this.getTileGrid().getExtent(),nt=this.getTileGridForProjection(ve);if(Je&&rt){const ct=nt.getTileCoordExtent(Je);buffer$1(ct,-nt.getResolution(Z),ct),intersects$1(rt,ct)||(Je=null)}let it=!0;if(Je!==null){const ct=this.tileGrid,ot=nt.getResolution(Z),dt=ct.getZForResolution(ot,1),ft=nt.getTileCoordExtent(Je);buffer$1(ft,-ot,ft),ct.forEachTileCoord(ft,dt,gt=>{it=it&&!this.tileUrlFunction(gt,ye,ve)})}const lt=new VectorRenderTile(Xe,it?TileState.EMPTY:TileState.IDLE,Je,this.getSourceTiles.bind(this,ye,ve));return lt.key=Ye,Ke?(lt.interimTile=Ke,lt.refreshInterimChain(),this.tileCache.replace(be,lt)):this.tileCache.set(be,lt),lt}getTileGridForProjection(Z){const ee=Z.getCode();let ae=this.tileGrids_[ee];if(!ae){const ye=this.tileGrid,ve=ye.getResolutions().slice(),be=ve.map(function(Xe,Je){return ye.getOrigin(Je)}),Ye=ve.map(function(Xe,Je){return ye.getTileSize(Je)}),Ke=DEFAULT_MAX_ZOOM+1;for(let Xe=ve.length;Xe<Ke;++Xe)ve.push(ve[Xe-1]/2),be.push(be[Xe-1]),Ye.push(Ye[Xe-1]);ae=new TileGrid({extent:ye.getExtent(),origins:be,resolutions:ve,tileSizes:Ye}),this.tileGrids_[ee]=ae}return ae}getTilePixelRatio(Z){return Z}getTilePixelSize(Z,ee,ae){const ye=this.getTileGridForProjection(ae),ve=toSize(ye.getTileSize(Z),this.tmpSize);return[Math.round(ve[0]*ee),Math.round(ve[1]*ee)]}updateCacheSize(Z,ee){super.updateCacheSize(Z*2,ee),this.sourceTileCache.highWaterMark=this.getTileCacheForProjection(ee).highWaterMark}}function defaultLoadFunction(ie,Z){ie.setLoader(function(ee,ae,ye){loadFeaturesXhr(Z,ie.getFormat(),ee,ae,ye,ie.onLoad.bind(ie),ie.onError.bind(ie))})}var ieee754$1={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ieee754$1.read=function(ie,Z,ee,ae,ye){var ve,be,Ye=ye*8-ae-1,Ke=(1<<Ye)-1,Xe=Ke>>1,Je=-7,rt=ee?ye-1:0,nt=ee?-1:1,it=ie[Z+rt];for(rt+=nt,ve=it&(1<<-Je)-1,it>>=-Je,Je+=Ye;Je>0;ve=ve*256+ie[Z+rt],rt+=nt,Je-=8);for(be=ve&(1<<-Je)-1,ve>>=-Je,Je+=ae;Je>0;be=be*256+ie[Z+rt],rt+=nt,Je-=8);if(ve===0)ve=1-Xe;else{if(ve===Ke)return be?NaN:(it?-1:1)*(1/0);be=be+Math.pow(2,ae),ve=ve-Xe}return(it?-1:1)*be*Math.pow(2,ve-ae)};ieee754$1.write=function(ie,Z,ee,ae,ye,ve){var be,Ye,Ke,Xe=ve*8-ye-1,Je=(1<<Xe)-1,rt=Je>>1,nt=ye===23?Math.pow(2,-24)-Math.pow(2,-77):0,it=ae?0:ve-1,lt=ae?1:-1,ct=Z<0||Z===0&&1/Z<0?1:0;for(Z=Math.abs(Z),isNaN(Z)||Z===1/0?(Ye=isNaN(Z)?1:0,be=Je):(be=Math.floor(Math.log(Z)/Math.LN2),Z*(Ke=Math.pow(2,-be))<1&&(be--,Ke*=2),be+rt>=1?Z+=nt/Ke:Z+=nt*Math.pow(2,1-rt),Z*Ke>=2&&(be++,Ke/=2),be+rt>=Je?(Ye=0,be=Je):be+rt>=1?(Ye=(Z*Ke-1)*Math.pow(2,ye),be=be+rt):(Ye=Z*Math.pow(2,rt-1)*Math.pow(2,ye),be=0));ye>=8;ie[ee+it]=Ye&255,it+=lt,Ye/=256,ye-=8);for(be=be<<ye|Ye,Xe+=ye;Xe>0;ie[ee+it]=be&255,it+=lt,be/=256,Xe-=8);ie[ee+it-lt]|=ct*128};var pbf=Pbf,ieee754=ieee754$1;function Pbf(ie){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(ie)?ie:new Uint8Array(ie||0),this.pos=0,this.type=0,this.length=this.buf.length}Pbf.Varint=0;Pbf.Fixed64=1;Pbf.Bytes=2;Pbf.Fixed32=5;var SHIFT_LEFT_32=65536*65536,SHIFT_RIGHT_32=1/SHIFT_LEFT_32,TEXT_DECODER_MIN_LENGTH=12,utf8TextDecoder=typeof TextDecoder>"u"?null:new TextDecoder("utf8");Pbf.prototype={destroy:function(){this.buf=null},readFields:function(ie,Z,ee){for(ee=ee||this.length;this.pos<ee;){var ae=this.readVarint(),ye=ae>>3,ve=this.pos;this.type=ae&7,ie(ye,Z,this),this.pos===ve&&this.skip(ae)}return Z},readMessage:function(ie,Z){return this.readFields(ie,Z,this.readVarint()+this.pos)},readFixed32:function(){var ie=readUInt32(this.buf,this.pos);return this.pos+=4,ie},readSFixed32:function(){var ie=readInt32(this.buf,this.pos);return this.pos+=4,ie},readFixed64:function(){var ie=readUInt32(this.buf,this.pos)+readUInt32(this.buf,this.pos+4)*SHIFT_LEFT_32;return this.pos+=8,ie},readSFixed64:function(){var ie=readUInt32(this.buf,this.pos)+readInt32(this.buf,this.pos+4)*SHIFT_LEFT_32;return this.pos+=8,ie},readFloat:function(){var ie=ieee754.read(this.buf,this.pos,!0,23,4);return this.pos+=4,ie},readDouble:function(){var ie=ieee754.read(this.buf,this.pos,!0,52,8);return this.pos+=8,ie},readVarint:function(ie){var Z=this.buf,ee,ae;return ae=Z[this.pos++],ee=ae&127,ae<128||(ae=Z[this.pos++],ee|=(ae&127)<<7,ae<128)||(ae=Z[this.pos++],ee|=(ae&127)<<14,ae<128)||(ae=Z[this.pos++],ee|=(ae&127)<<21,ae<128)?ee:(ae=Z[this.pos],ee|=(ae&15)<<28,readVarintRemainder$1(ee,ie,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var ie=this.readVarint();return ie%2===1?(ie+1)/-2:ie/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var ie=this.readVarint()+this.pos,Z=this.pos;return this.pos=ie,ie-Z>=TEXT_DECODER_MIN_LENGTH&&utf8TextDecoder?readUtf8TextDecoder(this.buf,Z,ie):readUtf8(this.buf,Z,ie)},readBytes:function(){var ie=this.readVarint()+this.pos,Z=this.buf.subarray(this.pos,ie);return this.pos=ie,Z},readPackedVarint:function(ie,Z){if(this.type!==Pbf.Bytes)return ie.push(this.readVarint(Z));var ee=readPackedEnd(this);for(ie=ie||[];this.pos<ee;)ie.push(this.readVarint(Z));return ie},readPackedSVarint:function(ie){if(this.type!==Pbf.Bytes)return ie.push(this.readSVarint());var Z=readPackedEnd(this);for(ie=ie||[];this.pos<Z;)ie.push(this.readSVarint());return ie},readPackedBoolean:function(ie){if(this.type!==Pbf.Bytes)return ie.push(this.readBoolean());var Z=readPackedEnd(this);for(ie=ie||[];this.pos<Z;)ie.push(this.readBoolean());return ie},readPackedFloat:function(ie){if(this.type!==Pbf.Bytes)return ie.push(this.readFloat());var Z=readPackedEnd(this);for(ie=ie||[];this.pos<Z;)ie.push(this.readFloat());return ie},readPackedDouble:function(ie){if(this.type!==Pbf.Bytes)return ie.push(this.readDouble());var Z=readPackedEnd(this);for(ie=ie||[];this.pos<Z;)ie.push(this.readDouble());return ie},readPackedFixed32:function(ie){if(this.type!==Pbf.Bytes)return ie.push(this.readFixed32());var Z=readPackedEnd(this);for(ie=ie||[];this.pos<Z;)ie.push(this.readFixed32());return ie},readPackedSFixed32:function(ie){if(this.type!==Pbf.Bytes)return ie.push(this.readSFixed32());var Z=readPackedEnd(this);for(ie=ie||[];this.pos<Z;)ie.push(this.readSFixed32());return ie},readPackedFixed64:function(ie){if(this.type!==Pbf.Bytes)return ie.push(this.readFixed64());var Z=readPackedEnd(this);for(ie=ie||[];this.pos<Z;)ie.push(this.readFixed64());return ie},readPackedSFixed64:function(ie){if(this.type!==Pbf.Bytes)return ie.push(this.readSFixed64());var Z=readPackedEnd(this);for(ie=ie||[];this.pos<Z;)ie.push(this.readSFixed64());return ie},skip:function(ie){var Z=ie&7;if(Z===Pbf.Varint)for(;this.buf[this.pos++]>127;);else if(Z===Pbf.Bytes)this.pos=this.readVarint()+this.pos;else if(Z===Pbf.Fixed32)this.pos+=4;else if(Z===Pbf.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+Z)},writeTag:function(ie,Z){this.writeVarint(ie<<3|Z)},realloc:function(ie){for(var Z=this.length||16;Z<this.pos+ie;)Z*=2;if(Z!==this.length){var ee=new Uint8Array(Z);ee.set(this.buf),this.buf=ee,this.length=Z}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(ie){this.realloc(4),writeInt32(this.buf,ie,this.pos),this.pos+=4},writeSFixed32:function(ie){this.realloc(4),writeInt32(this.buf,ie,this.pos),this.pos+=4},writeFixed64:function(ie){this.realloc(8),writeInt32(this.buf,ie&-1,this.pos),writeInt32(this.buf,Math.floor(ie*SHIFT_RIGHT_32),this.pos+4),this.pos+=8},writeSFixed64:function(ie){this.realloc(8),writeInt32(this.buf,ie&-1,this.pos),writeInt32(this.buf,Math.floor(ie*SHIFT_RIGHT_32),this.pos+4),this.pos+=8},writeVarint:function(ie){if(ie=+ie||0,ie>268435455||ie<0){writeBigVarint(ie,this);return}this.realloc(4),this.buf[this.pos++]=ie&127|(ie>127?128:0),!(ie<=127)&&(this.buf[this.pos++]=(ie>>>=7)&127|(ie>127?128:0),!(ie<=127)&&(this.buf[this.pos++]=(ie>>>=7)&127|(ie>127?128:0),!(ie<=127)&&(this.buf[this.pos++]=ie>>>7&127)))},writeSVarint:function(ie){this.writeVarint(ie<0?-ie*2-1:ie*2)},writeBoolean:function(ie){this.writeVarint(!!ie)},writeString:function(ie){ie=String(ie),this.realloc(ie.length*4),this.pos++;var Z=this.pos;this.pos=writeUtf8(this.buf,ie,this.pos);var ee=this.pos-Z;ee>=128&&makeRoomForExtraLength(Z,ee,this),this.pos=Z-1,this.writeVarint(ee),this.pos+=ee},writeFloat:function(ie){this.realloc(4),ieee754.write(this.buf,ie,this.pos,!0,23,4),this.pos+=4},writeDouble:function(ie){this.realloc(8),ieee754.write(this.buf,ie,this.pos,!0,52,8),this.pos+=8},writeBytes:function(ie){var Z=ie.length;this.writeVarint(Z),this.realloc(Z);for(var ee=0;ee<Z;ee++)this.buf[this.pos++]=ie[ee]},writeRawMessage:function(ie,Z){this.pos++;var ee=this.pos;ie(Z,this);var ae=this.pos-ee;ae>=128&&makeRoomForExtraLength(ee,ae,this),this.pos=ee-1,this.writeVarint(ae),this.pos+=ae},writeMessage:function(ie,Z,ee){this.writeTag(ie,Pbf.Bytes),this.writeRawMessage(Z,ee)},writePackedVarint:function(ie,Z){Z.length&&this.writeMessage(ie,writePackedVarint,Z)},writePackedSVarint:function(ie,Z){Z.length&&this.writeMessage(ie,writePackedSVarint,Z)},writePackedBoolean:function(ie,Z){Z.length&&this.writeMessage(ie,writePackedBoolean,Z)},writePackedFloat:function(ie,Z){Z.length&&this.writeMessage(ie,writePackedFloat,Z)},writePackedDouble:function(ie,Z){Z.length&&this.writeMessage(ie,writePackedDouble,Z)},writePackedFixed32:function(ie,Z){Z.length&&this.writeMessage(ie,writePackedFixed32,Z)},writePackedSFixed32:function(ie,Z){Z.length&&this.writeMessage(ie,writePackedSFixed32,Z)},writePackedFixed64:function(ie,Z){Z.length&&this.writeMessage(ie,writePackedFixed64,Z)},writePackedSFixed64:function(ie,Z){Z.length&&this.writeMessage(ie,writePackedSFixed64,Z)},writeBytesField:function(ie,Z){this.writeTag(ie,Pbf.Bytes),this.writeBytes(Z)},writeFixed32Field:function(ie,Z){this.writeTag(ie,Pbf.Fixed32),this.writeFixed32(Z)},writeSFixed32Field:function(ie,Z){this.writeTag(ie,Pbf.Fixed32),this.writeSFixed32(Z)},writeFixed64Field:function(ie,Z){this.writeTag(ie,Pbf.Fixed64),this.writeFixed64(Z)},writeSFixed64Field:function(ie,Z){this.writeTag(ie,Pbf.Fixed64),this.writeSFixed64(Z)},writeVarintField:function(ie,Z){this.writeTag(ie,Pbf.Varint),this.writeVarint(Z)},writeSVarintField:function(ie,Z){this.writeTag(ie,Pbf.Varint),this.writeSVarint(Z)},writeStringField:function(ie,Z){this.writeTag(ie,Pbf.Bytes),this.writeString(Z)},writeFloatField:function(ie,Z){this.writeTag(ie,Pbf.Fixed32),this.writeFloat(Z)},writeDoubleField:function(ie,Z){this.writeTag(ie,Pbf.Fixed64),this.writeDouble(Z)},writeBooleanField:function(ie,Z){this.writeVarintField(ie,!!Z)}};function readVarintRemainder$1(ie,Z,ee){var ae=ee.buf,ye,ve;if(ve=ae[ee.pos++],ye=(ve&112)>>4,ve<128||(ve=ae[ee.pos++],ye|=(ve&127)<<3,ve<128)||(ve=ae[ee.pos++],ye|=(ve&127)<<10,ve<128)||(ve=ae[ee.pos++],ye|=(ve&127)<<17,ve<128)||(ve=ae[ee.pos++],ye|=(ve&127)<<24,ve<128)||(ve=ae[ee.pos++],ye|=(ve&1)<<31,ve<128))return toNum$1(ie,ye,Z);throw new Error("Expected varint not more than 10 bytes")}function readPackedEnd(ie){return ie.type===Pbf.Bytes?ie.readVarint()+ie.pos:ie.pos+1}function toNum$1(ie,Z,ee){return ee?Z*4294967296+(ie>>>0):(Z>>>0)*4294967296+(ie>>>0)}function writeBigVarint(ie,Z){var ee,ae;if(ie>=0?(ee=ie%4294967296|0,ae=ie/4294967296|0):(ee=~(-ie%4294967296),ae=~(-ie/4294967296),ee^4294967295?ee=ee+1|0:(ee=0,ae=ae+1|0)),ie>=18446744073709552e3||ie<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Z.realloc(10),writeBigVarintLow(ee,ae,Z),writeBigVarintHigh(ae,Z)}function writeBigVarintLow(ie,Z,ee){ee.buf[ee.pos++]=ie&127|128,ie>>>=7,ee.buf[ee.pos++]=ie&127|128,ie>>>=7,ee.buf[ee.pos++]=ie&127|128,ie>>>=7,ee.buf[ee.pos++]=ie&127|128,ie>>>=7,ee.buf[ee.pos]=ie&127}function writeBigVarintHigh(ie,Z){var ee=(ie&7)<<4;Z.buf[Z.pos++]|=ee|((ie>>>=3)?128:0),ie&&(Z.buf[Z.pos++]=ie&127|((ie>>>=7)?128:0),ie&&(Z.buf[Z.pos++]=ie&127|((ie>>>=7)?128:0),ie&&(Z.buf[Z.pos++]=ie&127|((ie>>>=7)?128:0),ie&&(Z.buf[Z.pos++]=ie&127|((ie>>>=7)?128:0),ie&&(Z.buf[Z.pos++]=ie&127)))))}function makeRoomForExtraLength(ie,Z,ee){var ae=Z<=16383?1:Z<=2097151?2:Z<=268435455?3:Math.floor(Math.log(Z)/(Math.LN2*7));ee.realloc(ae);for(var ye=ee.pos-1;ye>=ie;ye--)ee.buf[ye+ae]=ee.buf[ye]}function writePackedVarint(ie,Z){for(var ee=0;ee<ie.length;ee++)Z.writeVarint(ie[ee])}function writePackedSVarint(ie,Z){for(var ee=0;ee<ie.length;ee++)Z.writeSVarint(ie[ee])}function writePackedFloat(ie,Z){for(var ee=0;ee<ie.length;ee++)Z.writeFloat(ie[ee])}function writePackedDouble(ie,Z){for(var ee=0;ee<ie.length;ee++)Z.writeDouble(ie[ee])}function writePackedBoolean(ie,Z){for(var ee=0;ee<ie.length;ee++)Z.writeBoolean(ie[ee])}function writePackedFixed32(ie,Z){for(var ee=0;ee<ie.length;ee++)Z.writeFixed32(ie[ee])}function writePackedSFixed32(ie,Z){for(var ee=0;ee<ie.length;ee++)Z.writeSFixed32(ie[ee])}function writePackedFixed64(ie,Z){for(var ee=0;ee<ie.length;ee++)Z.writeFixed64(ie[ee])}function writePackedSFixed64(ie,Z){for(var ee=0;ee<ie.length;ee++)Z.writeSFixed64(ie[ee])}function readUInt32(ie,Z){return(ie[Z]|ie[Z+1]<<8|ie[Z+2]<<16)+ie[Z+3]*16777216}function writeInt32(ie,Z,ee){ie[ee]=Z,ie[ee+1]=Z>>>8,ie[ee+2]=Z>>>16,ie[ee+3]=Z>>>24}function readInt32(ie,Z){return(ie[Z]|ie[Z+1]<<8|ie[Z+2]<<16)+(ie[Z+3]<<24)}function readUtf8(ie,Z,ee){for(var ae="",ye=Z;ye<ee;){var ve=ie[ye],be=null,Ye=ve>239?4:ve>223?3:ve>191?2:1;if(ye+Ye>ee)break;var Ke,Xe,Je;Ye===1?ve<128&&(be=ve):Ye===2?(Ke=ie[ye+1],(Ke&192)===128&&(be=(ve&31)<<6|Ke&63,be<=127&&(be=null))):Ye===3?(Ke=ie[ye+1],Xe=ie[ye+2],(Ke&192)===128&&(Xe&192)===128&&(be=(ve&15)<<12|(Ke&63)<<6|Xe&63,(be<=2047||be>=55296&&be<=57343)&&(be=null))):Ye===4&&(Ke=ie[ye+1],Xe=ie[ye+2],Je=ie[ye+3],(Ke&192)===128&&(Xe&192)===128&&(Je&192)===128&&(be=(ve&15)<<18|(Ke&63)<<12|(Xe&63)<<6|Je&63,(be<=65535||be>=1114112)&&(be=null))),be===null?(be=65533,Ye=1):be>65535&&(be-=65536,ae+=String.fromCharCode(be>>>10&1023|55296),be=56320|be&1023),ae+=String.fromCharCode(be),ye+=Ye}return ae}function readUtf8TextDecoder(ie,Z,ee){return utf8TextDecoder.decode(ie.subarray(Z,ee))}function writeUtf8(ie,Z,ee){for(var ae=0,ye,ve;ae<Z.length;ae++){if(ye=Z.charCodeAt(ae),ye>55295&&ye<57344)if(ve)if(ye<56320){ie[ee++]=239,ie[ee++]=191,ie[ee++]=189,ve=ye;continue}else ye=ve-55296<<10|ye-56320|65536,ve=null;else{ye>56319||ae+1===Z.length?(ie[ee++]=239,ie[ee++]=191,ie[ee++]=189):ve=ye;continue}else ve&&(ie[ee++]=239,ie[ee++]=191,ie[ee++]=189,ve=null);ye<128?ie[ee++]=ye:(ye<2048?ie[ee++]=ye>>6|192:(ye<65536?ie[ee++]=ye>>12|224:(ie[ee++]=ye>>18|240,ie[ee++]=ye>>12&63|128),ie[ee++]=ye>>6&63|128),ie[ee++]=ye&63|128)}return ee}const PBF=getDefaultExportFromCjs$1(pbf),tmpTransform=create$2();class RenderFeature{constructor(Z,ee,ae,ye,ve){this.styleFunction,this.extent_,this.id_=ve,this.type_=Z,this.flatCoordinates_=ee,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=ae,this.properties_=ye}get(Z){return this.properties_[Z]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?createOrUpdateFromCoordinate(this.flatCoordinates_):createOrUpdateFromFlatCoordinates(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const Z=getCenter(this.getExtent());this.flatInteriorPoints_=getInteriorPointOfArray(this.flatCoordinates_,0,this.ends_,2,Z,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const Z=linearRingss(this.flatCoordinates_,0,this.ends_,2);this.flatInteriorPoints_=getInteriorPointsOfMultiArray(this.flatCoordinates_,0,this.ends_,2,Z)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=interpolatePoint(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const Z=this.flatCoordinates_;let ee=0;const ae=this.ends_;for(let ye=0,ve=ae.length;ye<ve;++ye){const be=ae[ye],Ye=interpolatePoint(Z,ee,be,2,.5);extend$2(this.flatMidpoints_,Ye),ee=be}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(Z){return this}simplifyTransformed(Z,ee){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return 2}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(Z){Z=get$1(Z);const ee=Z.getExtent(),ae=Z.getWorldExtent();if(ee&&ae){const ye=getHeight(ae)/getHeight(ee);compose$1(tmpTransform,ae[0],ae[3],ye,-ye,0,0,0),transform2D(this.flatCoordinates_,0,this.flatCoordinates_.length,2,tmpTransform,this.flatCoordinates_)}}getEnds(){return this.ends_}}RenderFeature.prototype.getEndss=RenderFeature.prototype.getEnds;RenderFeature.prototype.getFlatCoordinates=RenderFeature.prototype.getOrientedFlatCoordinates;class MVT extends FeatureFormat{constructor(Z){super(),Z=Z||{},this.dataProjection=new Projection({code:"",units:"tile-pixels"}),this.featureClass_=Z.featureClass?Z.featureClass:RenderFeature,this.geometryName_=Z.geometryName,this.layerName_=Z.layerName?Z.layerName:"layer",this.layers_=Z.layers?Z.layers:null,this.idProperty_=Z.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(Z,ee,ae,ye){Z.pos=ee.geometry;const ve=Z.readVarint()+Z.pos;let be=1,Ye=0,Ke=0,Xe=0,Je=0,rt=0;for(;Z.pos<ve;){if(!Ye){const nt=Z.readVarint();be=nt&7,Ye=nt>>3}if(Ye--,be===1||be===2)Ke+=Z.readSVarint(),Xe+=Z.readSVarint(),be===1&&Je>rt&&(ye.push(Je),rt=Je),ae.push(Ke,Xe),Je+=2;else if(be===7)Je>rt&&(ae.push(ae[rt],ae[rt+1]),Je+=2);else throw new Error("Invalid command found in the PBF")}Je>rt&&(ye.push(Je),rt=Je)}createFeature_(Z,ee,ae){const ye=ee.type;if(ye===0)return null;let ve;const be=ee.properties;let Ye;this.idProperty_?(Ye=be[this.idProperty_],delete be[this.idProperty_]):Ye=ee.id,be[this.layerName_]=ee.layer.name;const Ke=[],Xe=[];this.readRawGeometry_(Z,ee,Ke,Xe);const Je=getGeometryType(ye,Xe.length);if(this.featureClass_===RenderFeature)ve=new this.featureClass_(Je,Ke,Xe,be,Ye),ve.transform(ae.dataProjection);else{let rt;if(Je=="Polygon"){const lt=inflateEnds(Ke,Xe);rt=lt.length>1?new MultiPolygon$1(Ke,"XY",lt):new Polygon$1(Ke,"XY",Xe)}else rt=Je==="Point"?new Point$1(Ke,"XY"):Je==="LineString"?new LineString$1(Ke,"XY"):Je==="MultiPoint"?new MultiPoint$1(Ke,"XY"):Je==="MultiLineString"?new MultiLineString$1(Ke,"XY",Xe):null;const nt=this.featureClass_;ve=new nt,this.geometryName_&&ve.setGeometryName(this.geometryName_);const it=transformGeometryWithOptions(rt,!1,ae);ve.setGeometry(it),Ye!==void 0&&ve.setId(Ye),ve.setProperties(be,!0)}return ve}getType(){return"arraybuffer"}readFeatures(Z,ee){const ae=this.layers_;ee=this.adaptOptions(ee);const ye=get$1(ee.dataProjection);ye.setWorldExtent(ee.extent),ee.dataProjection=ye;const ve=new PBF(Z),be=ve.readFields(layersPBFReader,{}),Ye=[];for(const Ke in be){if(ae&&!ae.includes(Ke))continue;const Xe=be[Ke],Je=Xe?[0,0,Xe.extent,Xe.extent]:null;ye.setExtent(Je);for(let rt=0,nt=Xe.length;rt<nt;++rt){const it=readRawFeature(ve,Xe,rt),lt=this.createFeature_(ve,it,ee);lt!==null&&Ye.push(lt)}}return Ye}readProjection(Z){return this.dataProjection}setLayers(Z){this.layers_=Z}}function layersPBFReader(ie,Z,ee){if(ie===3){const ae={keys:[],values:[],features:[]},ye=ee.readVarint()+ee.pos;ee.readFields(layerPBFReader,ae,ye),ae.length=ae.features.length,ae.length&&(Z[ae.name]=ae)}}function layerPBFReader(ie,Z,ee){if(ie===15)Z.version=ee.readVarint();else if(ie===1)Z.name=ee.readString();else if(ie===5)Z.extent=ee.readVarint();else if(ie===2)Z.features.push(ee.pos);else if(ie===3)Z.keys.push(ee.readString());else if(ie===4){let ae=null;const ye=ee.readVarint()+ee.pos;for(;ee.pos<ye;)ie=ee.readVarint()>>3,ae=ie===1?ee.readString():ie===2?ee.readFloat():ie===3?ee.readDouble():ie===4?ee.readVarint64():ie===5?ee.readVarint():ie===6?ee.readSVarint():ie===7?ee.readBoolean():null;Z.values.push(ae)}}function featurePBFReader(ie,Z,ee){if(ie==1)Z.id=ee.readVarint();else if(ie==2){const ae=ee.readVarint()+ee.pos;for(;ee.pos<ae;){const ye=Z.layer.keys[ee.readVarint()],ve=Z.layer.values[ee.readVarint()];Z.properties[ye]=ve}}else ie==3?Z.type=ee.readVarint():ie==4&&(Z.geometry=ee.pos)}function readRawFeature(ie,Z,ee){ie.pos=Z.features[ee];const ae=ie.readVarint()+ie.pos,ye={layer:Z,type:0,properties:{}};return ie.readFields(featurePBFReader,ye,ae),ye}function getGeometryType(ie,Z){let ee;return ie===1?ee=Z===1?"Point":"MultiPoint":ie===2?ee=Z===1?"LineString":"MultiLineString":ie===3&&(ee="Polygon"),ee}var __async=(ie,Z,ee)=>new Promise((ae,ye)=>{var ve=Ke=>{try{Ye(ee.next(Ke))}catch(Xe){ye(Xe)}},be=Ke=>{try{Ye(ee.throw(Ke))}catch(Xe){ye(Xe)}},Ye=Ke=>Ke.done?ae(Ke.value):Promise.resolve(Ke.value).then(ve,be);Ye((ee=ee.apply(ie,Z)).next())}),u8=Uint8Array,u16=Uint16Array,i32=Int32Array,fleb=new u8([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fdeb=new u8([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),clim=new u8([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),freb=function(ie,Z){for(var ee=new u16(31),ae=0;ae<31;++ae)ee[ae]=Z+=1<<ie[ae-1];for(var ye=new i32(ee[30]),ae=1;ae<30;++ae)for(var ve=ee[ae];ve<ee[ae+1];++ve)ye[ve]=ve-ee[ae]<<5|ae;return{b:ee,r:ye}},_a=freb(fleb,2),fl=_a.b,revfl=_a.r;fl[28]=258,revfl[258]=28;var _b=freb(fdeb,0),fd=_b.b,rev=new u16(32768);for(i$2=0;i$2<32768;++i$2)x$2=(i$2&43690)>>1|(i$2&21845)<<1,x$2=(x$2&52428)>>2|(x$2&13107)<<2,x$2=(x$2&61680)>>4|(x$2&3855)<<4,rev[i$2]=((x$2&65280)>>8|(x$2&255)<<8)>>1;var x$2,i$2,hMap=function(ie,Z,ee){for(var ae=ie.length,ye=0,ve=new u16(Z);ye<ae;++ye)ie[ye]&&++ve[ie[ye]-1];var be=new u16(Z);for(ye=1;ye<Z;++ye)be[ye]=be[ye-1]+ve[ye-1]<<1;var Ye;{Ye=new u16(1<<Z);var Ke=15-Z;for(ye=0;ye<ae;++ye)if(ie[ye])for(var Xe=ye<<4|ie[ye],Je=Z-ie[ye],rt=be[ie[ye]-1]++<<Je,nt=rt|(1<<Je)-1;rt<=nt;++rt)Ye[rev[rt]>>Ke]=Xe}return Ye},flt=new u8(288);for(i$2=0;i$2<144;++i$2)flt[i$2]=8;var i$2;for(i$2=144;i$2<256;++i$2)flt[i$2]=9;var i$2;for(i$2=256;i$2<280;++i$2)flt[i$2]=7;var i$2;for(i$2=280;i$2<288;++i$2)flt[i$2]=8;var i$2,fdt=new u8(32);for(i$2=0;i$2<32;++i$2)fdt[i$2]=5;var i$2,flrm=hMap(flt,9),fdrm=hMap(fdt,5),max$1=function(ie){for(var Z=ie[0],ee=1;ee<ie.length;++ee)ie[ee]>Z&&(Z=ie[ee]);return Z},bits=function(ie,Z,ee){var ae=Z/8|0;return(ie[ae]|ie[ae+1]<<8)>>(Z&7)&ee},bits16=function(ie,Z){var ee=Z/8|0;return(ie[ee]|ie[ee+1]<<8|ie[ee+2]<<16)>>(Z&7)},shft=function(ie){return(ie+7)/8|0},slc=function(ie,Z,ee){(ee==null||ee>ie.length)&&(ee=ie.length);var ae=new u8(ee-Z);return ae.set(ie.subarray(Z,ee)),ae},ec=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],err=function(ie,Z,ee){var ae=new Error(Z||ec[ie]);if(ae.code=ie,Error.captureStackTrace&&Error.captureStackTrace(ae,err),!ee)throw ae;return ae},inflt=function(ie,Z,ee,ae){var ye=ie.length,ve=0;if(!ye||Z.f&&!Z.l)return ee||new u8(0);var be=!ee||Z.i!=2,Ye=Z.i;ee||(ee=new u8(ye*3));var Ke=function(Ji){var ls=ee.length;if(Ji>ls){var hs=new u8(Math.max(ls*2,Ji));hs.set(ee),ee=hs}},Xe=Z.f||0,Je=Z.p||0,rt=Z.b||0,nt=Z.l,it=Z.d,lt=Z.m,ct=Z.n,ot=ye*8;do{if(!nt){Xe=bits(ie,Je,1);var dt=bits(ie,Je+1,3);if(Je+=3,dt)if(dt==1)nt=flrm,it=fdrm,lt=9,ct=5;else if(dt==2){var ft=bits(ie,Je,31)+257,gt=bits(ie,Je+10,15)+4,mt=ft+bits(ie,Je+5,31)+1;Je+=14;for(var Yr=new u8(mt),Qr=new u8(19),Xr=0;Xr<gt;++Xr)Qr[clim[Xr]]=bits(ie,Je+Xr*3,7);Je+=gt*3;for(var Jr=max$1(Qr),ai=(1<<Jr)-1,oi=hMap(Qr,Jr),Xr=0;Xr<mt;){var ni=oi[bits(ie,Je,ai)];Je+=ni&15;var li=ni>>4;if(li<16)Yr[Xr++]=li;else{var ui=0,mi=0;for(li==16?(mi=3+bits(ie,Je,3),Je+=2,ui=Yr[Xr-1]):li==17?(mi=3+bits(ie,Je,7),Je+=3):li==18&&(mi=11+bits(ie,Je,127),Je+=7);mi--;)Yr[Xr++]=ui}}var ii=Yr.subarray(0,ft),hi=Yr.subarray(ft);lt=max$1(ii),ct=max$1(hi),nt=hMap(ii,lt),it=hMap(hi,ct)}else err(1);else{var li=shft(Je)+4,ri=ie[li-4]|ie[li-3]<<8,ci=li+ri;if(ci>ye){Ye&&err(0);break}be&&Ke(rt+ri),ee.set(ie.subarray(li,ci),rt),Z.b=rt+=ri,Z.p=Je=ci*8,Z.f=Xe;continue}if(Je>ot){Ye&&err(0);break}}be&&Ke(rt+131072);for(var Si=(1<<lt)-1,si=(1<<ct)-1,Ei=Je;;Ei=Je){var ui=nt[bits16(ie,Je)&Si],yi=ui>>4;if(Je+=ui&15,Je>ot){Ye&&err(0);break}if(ui||err(2),yi<256)ee[rt++]=yi;else if(yi==256){Ei=Je,nt=null;break}else{var Mi=yi-254;if(yi>264){var Xr=yi-257,Ci=fleb[Xr];Mi=bits(ie,Je,(1<<Ci)-1)+fl[Xr],Je+=Ci}var Ri=it[bits16(ie,Je)&si],Ni=Ri>>4;Ri||err(3),Je+=Ri&15;var hi=fd[Ni];if(Ni>3){var Ci=fdeb[Ni];hi+=bits16(ie,Je)&(1<<Ci)-1,Je+=Ci}if(Je>ot){Ye&&err(0);break}be&&Ke(rt+131072);var Ai=rt+Mi;if(rt<hi){var ki=ve-hi,Yi=Math.min(hi,Ai);for(ki+rt<0&&err(3);rt<Yi;++rt)ee[rt]=ae[ki+rt]}for(;rt<Ai;rt+=4)ee[rt]=ee[rt-hi],ee[rt+1]=ee[rt+1-hi],ee[rt+2]=ee[rt+2-hi],ee[rt+3]=ee[rt+3-hi];rt=Ai}}Z.l=nt,Z.p=Ei,Z.b=rt,Z.f=Xe,nt&&(Xe=1,Z.m=lt,Z.d=it,Z.n=ct)}while(!Xe);return rt==ee.length?ee:slc(ee,0,rt)},et=new u8(0),gzs=function(ie){(ie[0]!=31||ie[1]!=139||ie[2]!=8)&&err(6,"invalid gzip data");var Z=ie[3],ee=10;Z&4&&(ee+=(ie[10]|ie[11]<<8)+2);for(var ae=(Z>>3&1)+(Z>>4&1);ae>0;ae-=!ie[ee++]);return ee+(Z&2)},gzl=function(ie){var Z=ie.length;return(ie[Z-4]|ie[Z-3]<<8|ie[Z-2]<<16|ie[Z-1]<<24)>>>0},zls=function(ie,Z){return((ie[0]&15)!=8||ie[0]>>4>7||(ie[0]<<8|ie[1])%31)&&err(6,"invalid zlib data"),(ie[1]>>5&1)==+!Z&&err(6,"invalid zlib data: "+(ie[1]&32?"need":"unexpected")+" dictionary"),(ie[1]>>3&4)+2};function inflateSync(ie,Z){return inflt(ie,{i:2},Z,Z)}function gunzipSync(ie,Z){var ee=gzs(ie);return ee+8>ie.length&&err(6,"invalid gzip data"),inflt(ie.subarray(ee,-8),{i:2},new u8(gzl(ie)),Z)}function unzlibSync(ie,Z){return inflt(ie.subarray(zls(ie,Z),-4),{i:2},Z,Z)}function decompressSync(ie,Z){return ie[0]==31&&ie[1]==139&&ie[2]==8?gunzipSync(ie,Z):(ie[0]&15)!=8||ie[0]>>4>7||(ie[0]<<8|ie[1])%31?inflateSync(ie,Z):unzlibSync(ie,Z)}var td=typeof TextDecoder<"u"&&new TextDecoder,tds=0;try{td.decode(et,{stream:!0}),tds=1}catch{}var shift$2=(ie,Z)=>ie*Math.pow(2,Z),unshift=(ie,Z)=>Math.floor(ie/Math.pow(2,Z)),getUint24=(ie,Z)=>shift$2(ie.getUint16(Z+1,!0),8)+ie.getUint8(Z),getUint48=(ie,Z)=>shift$2(ie.getUint32(Z+2,!0),16)+ie.getUint16(Z,!0),compare=(ie,Z,ee,ae,ye)=>{if(ie!=ae.getUint8(ye))return ie-ae.getUint8(ye);const ve=getUint24(ae,ye+1);if(Z!=ve)return Z-ve;const be=getUint24(ae,ye+4);return ee!=be?ee-be:0},queryLeafdir=(ie,Z,ee,ae)=>{const ye=queryView(ie,Z|128,ee,ae);return ye?{z:Z,x:ee,y:ae,offset:ye[0],length:ye[1],is_dir:!0}:null},queryTile=(ie,Z,ee,ae)=>{const ye=queryView(ie,Z,ee,ae);return ye?{z:Z,x:ee,y:ae,offset:ye[0],length:ye[1],is_dir:!1}:null},queryView=(ie,Z,ee,ae)=>{let ye=0,ve=ie.byteLength/17-1;for(;ye<=ve;){const be=ve+ye>>1,Ye=compare(Z,ee,ae,ie,be*17);if(Ye>0)ye=be+1;else if(Ye<0)ve=be-1;else return[getUint48(ie,be*17+7),ie.getUint32(be*17+13,!0)]}return null},entrySort=(ie,Z)=>ie.is_dir&&!Z.is_dir?1:!ie.is_dir&&Z.is_dir?-1:ie.z!==Z.z?ie.z-Z.z:ie.x!==Z.x?ie.x-Z.x:ie.y-Z.y,parseEntry=(ie,Z)=>{const ee=ie.getUint8(Z*17);return{z:ee&127,x:getUint24(ie,Z*17+1),y:getUint24(ie,Z*17+4),offset:getUint48(ie,Z*17+7),length:ie.getUint32(Z*17+13,!0),is_dir:ee>>7===1}},sortDir=ie=>{const Z=[],ee=new DataView(ie);for(let ae=0;ae<ee.byteLength/17;ae++)Z.push(parseEntry(ee,ae));return createDirectory(Z)},createDirectory=ie=>{ie.sort(entrySort);const Z=new ArrayBuffer(17*ie.length),ee=new Uint8Array(Z);for(let ae=0;ae<ie.length;ae++){const ye=ie[ae];let ve=ye.z;ye.is_dir&&(ve=ve|128),ee[ae*17]=ve,ee[ae*17+1]=ye.x&255,ee[ae*17+2]=ye.x>>8&255,ee[ae*17+3]=ye.x>>16&255,ee[ae*17+4]=ye.y&255,ee[ae*17+5]=ye.y>>8&255,ee[ae*17+6]=ye.y>>16&255,ee[ae*17+7]=ye.offset&255,ee[ae*17+8]=unshift(ye.offset,8)&255,ee[ae*17+9]=unshift(ye.offset,16)&255,ee[ae*17+10]=unshift(ye.offset,24)&255,ee[ae*17+11]=unshift(ye.offset,32)&255,ee[ae*17+12]=unshift(ye.offset,48)&255,ee[ae*17+13]=ye.length&255,ee[ae*17+14]=ye.length>>8&255,ee[ae*17+15]=ye.length>>16&255,ee[ae*17+16]=ye.length>>24&255}return Z},deriveLeaf=(ie,Z)=>{if(ie.byteLength<17)return null;const ee=ie.byteLength/17,ae=parseEntry(ie,ee-1);if(ae.is_dir){const ye=ae.z,ve=Z.z-ye,be=Math.trunc(Z.x/(1<<ve)),Ye=Math.trunc(Z.y/(1<<ve));return{z:ye,x:be,y:Ye}}return null};function getHeader(ie){return __async(this,null,function*(){const Z=yield ie.getBytes(0,512e3),ee=new DataView(Z.data),ae=ee.getUint32(4,!0),ye=ee.getUint16(8,!0),ve=new TextDecoder("utf-8"),be=JSON.parse(ve.decode(new DataView(Z.data,10,ae)));let Ye=0;be.compression==="gzip"&&(Ye=2);let Ke=0;"minzoom"in be&&(Ke=+be.minzoom);let Xe=0;"maxzoom"in be&&(Xe=+be.maxzoom);let Je=0,rt=0,nt=0,it=-180,lt=-85,ct=180,ot=85;if(be.bounds){const dt=be.bounds.split(",");it=+dt[0],lt=+dt[1],ct=+dt[2],ot=+dt[3]}if(be.center){const dt=be.center.split(",");Je=+dt[0],rt=+dt[1],nt=+dt[2]}return{specVersion:ee.getUint16(2,!0),rootDirectoryOffset:10+ae,rootDirectoryLength:ye*17,jsonMetadataOffset:10,jsonMetadataLength:ae,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:Ye,tileType:1,minZoom:Ke,maxZoom:Xe,minLon:it,minLat:lt,maxLon:ct,maxLat:ot,centerZoom:nt,centerLon:Je,centerLat:rt,etag:Z.etag}})}function getZxy(ie,Z,ee,ae,ye,ve,be){return __async(this,null,function*(){let Ye=yield ee.getArrayBuffer(Z,ie.rootDirectoryOffset,ie.rootDirectoryLength,ie);ie.specVersion===1&&(Ye=sortDir(Ye));const Ke=queryTile(new DataView(Ye),ae,ye,ve);if(Ke){let Je=(yield Z.getBytes(Ke.offset,Ke.length,be)).data;const rt=new DataView(Je);return rt.getUint8(0)==31&&rt.getUint8(1)==139&&(Je=decompressSync(new Uint8Array(Je))),{data:Je}}const Xe=deriveLeaf(new DataView(Ye),{z:ae,x:ye,y:ve});if(Xe){const Je=queryLeafdir(new DataView(Ye),Xe.z,Xe.x,Xe.y);if(Je){let rt=yield ee.getArrayBuffer(Z,Je.offset,Je.length,ie);ie.specVersion===1&&(rt=sortDir(rt));const nt=queryTile(new DataView(rt),ae,ye,ve);if(nt){let it=(yield Z.getBytes(nt.offset,nt.length,be)).data;const lt=new DataView(it);return lt.getUint8(0)==31&&lt.getUint8(1)==139&&(it=decompressSync(new Uint8Array(it))),{data:it}}}}})}var v2_default={getHeader,getZxy};function toNum(ie,Z){return(Z>>>0)*4294967296+(ie>>>0)}function readVarintRemainder(ie,Z){const ee=Z.buf;let ae,ye;if(ye=ee[Z.pos++],ae=(ye&112)>>4,ye<128||(ye=ee[Z.pos++],ae|=(ye&127)<<3,ye<128)||(ye=ee[Z.pos++],ae|=(ye&127)<<10,ye<128)||(ye=ee[Z.pos++],ae|=(ye&127)<<17,ye<128)||(ye=ee[Z.pos++],ae|=(ye&127)<<24,ye<128)||(ye=ee[Z.pos++],ae|=(ye&1)<<31,ye<128))return toNum(ie,ae);throw new Error("Expected varint not more than 10 bytes")}function readVarint(ie){const Z=ie.buf;let ee,ae;return ae=Z[ie.pos++],ee=ae&127,ae<128||(ae=Z[ie.pos++],ee|=(ae&127)<<7,ae<128)||(ae=Z[ie.pos++],ee|=(ae&127)<<14,ae<128)||(ae=Z[ie.pos++],ee|=(ae&127)<<21,ae<128)?ee:(ae=Z[ie.pos],ee|=(ae&15)<<28,readVarintRemainder(ee,ie))}function rotate(ie,Z,ee,ae){if(ae==0){ee==1&&(Z[0]=ie-1-Z[0],Z[1]=ie-1-Z[1]);const ye=Z[0];Z[0]=Z[1],Z[1]=ye}}var tzValues=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function zxyToTileId(ie,Z,ee){if(ie>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(Z>Math.pow(2,ie)-1||ee>Math.pow(2,ie)-1)throw Error("tile x/y outside zoom level bounds");const ae=tzValues[ie],ye=Math.pow(2,ie);let ve=0,be=0,Ye=0;const Ke=[Z,ee];let Xe=ye/2;for(;Xe>0;)ve=(Ke[0]&Xe)>0?1:0,be=(Ke[1]&Xe)>0?1:0,Ye+=Xe*Xe*(3*ve^be),rotate(Xe,Ke,ve,be),Xe=Xe/2;return ae+Ye}function defaultDecompress(ie,Z){return __async(this,null,function*(){if(Z===1||Z===0)return ie;if(Z===2){if(typeof globalThis.DecompressionStream>"u")return decompressSync(new Uint8Array(ie));{let ee=new Response(ie).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(ee).arrayBuffer()}}else throw Error("Compression method not supported")})}var HEADER_SIZE_BYTES=127;function findTile(ie,Z){let ee=0,ae=ie.length-1;for(;ee<=ae;){const ye=ae+ee>>1,ve=Z-ie[ye].tileId;if(ve>0)ee=ye+1;else if(ve<0)ae=ye-1;else return ie[ye]}return ae>=0&&(ie[ae].runLength===0||Z-ie[ae].tileId<ie[ae].runLength)?ie[ae]:null}var FetchSource=class{constructor(ie,Z=new Headers){this.url=ie,this.customHeaders=Z}getKey(){return this.url}setHeaders(ie){this.customHeaders=ie}getBytes(ie,Z,ee){return __async(this,null,function*(){let ae;ee||(ae=new AbortController,ee=ae.signal);const ye=new Headers(this.customHeaders);ye.set("Range","bytes="+ie+"-"+(ie+Z-1));let ve=yield fetch(this.url,{signal:ee,headers:ye});if(ve.status===416&&ie===0){const Ye=ve.headers.get("Content-Range");if(!Ye||!Ye.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const Ke=+Ye.substr(8);ve=yield fetch(this.url,{signal:ee,headers:{Range:"bytes=0-"+(Ke-1)}})}if(ve.status>=300)throw Error("Bad response code: "+ve.status);const be=ve.headers.get("Content-Length");if(ve.status===200&&(!be||+be>Z))throw ae&&ae.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield ve.arrayBuffer(),etag:ve.headers.get("ETag")||void 0,cacheControl:ve.headers.get("Cache-Control")||void 0,expires:ve.headers.get("Expires")||void 0}})}};function getUint64(ie,Z){const ee=ie.getUint32(Z+4,!0),ae=ie.getUint32(Z+0,!0);return ee*Math.pow(2,32)+ae}function bytesToHeader(ie,Z){const ee=new DataView(ie),ae=ee.getUint8(7);if(ae>3)throw Error(`Archive is spec version ${ae} but this library supports up to spec version 3`);return{specVersion:ae,rootDirectoryOffset:getUint64(ee,8),rootDirectoryLength:getUint64(ee,16),jsonMetadataOffset:getUint64(ee,24),jsonMetadataLength:getUint64(ee,32),leafDirectoryOffset:getUint64(ee,40),leafDirectoryLength:getUint64(ee,48),tileDataOffset:getUint64(ee,56),tileDataLength:getUint64(ee,64),numAddressedTiles:getUint64(ee,72),numTileEntries:getUint64(ee,80),numTileContents:getUint64(ee,88),clustered:ee.getUint8(96)===1,internalCompression:ee.getUint8(97),tileCompression:ee.getUint8(98),tileType:ee.getUint8(99),minZoom:ee.getUint8(100),maxZoom:ee.getUint8(101),minLon:ee.getInt32(102,!0)/1e7,minLat:ee.getInt32(106,!0)/1e7,maxLon:ee.getInt32(110,!0)/1e7,maxLat:ee.getInt32(114,!0)/1e7,centerZoom:ee.getUint8(118),centerLon:ee.getInt32(119,!0)/1e7,centerLat:ee.getInt32(123,!0)/1e7,etag:Z}}function deserializeIndex(ie){const Z={buf:new Uint8Array(ie),pos:0},ee=readVarint(Z),ae=[];let ye=0;for(let ve=0;ve<ee;ve++){const be=readVarint(Z);ae.push({tileId:ye+be,offset:0,length:0,runLength:1}),ye+=be}for(let ve=0;ve<ee;ve++)ae[ve].runLength=readVarint(Z);for(let ve=0;ve<ee;ve++)ae[ve].length=readVarint(Z);for(let ve=0;ve<ee;ve++){const be=readVarint(Z);be===0&&ve>0?ae[ve].offset=ae[ve-1].offset+ae[ve-1].length:ae[ve].offset=be-1}return ae}function detectVersion(ie){const Z=new DataView(ie);return Z.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):Z.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var EtagMismatch=class extends Error{};function getHeaderAndRoot(ie,Z,ee,ae){return __async(this,null,function*(){const ye=yield ie.getBytes(0,16384);if(new DataView(ye.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(detectVersion(ye.data)<3)return[yield v2_default.getHeader(ie)];const ve=ye.data.slice(0,HEADER_SIZE_BYTES);let be=ye.etag;ae&&ye.etag!=ae&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+ie.getKey()),be=void 0);const Ye=bytesToHeader(ve,be);if(ee){const Ke=ye.data.slice(Ye.rootDirectoryOffset,Ye.rootDirectoryOffset+Ye.rootDirectoryLength),Xe=ie.getKey()+"|"+(Ye.etag||"")+"|"+Ye.rootDirectoryOffset+"|"+Ye.rootDirectoryLength,Je=deserializeIndex(yield Z(Ke,Ye.internalCompression));return[Ye,[Xe,Je.length,Je]]}return[Ye,void 0]})}function getDirectory(ie,Z,ee,ae,ye){return __async(this,null,function*(){const ve=yield ie.getBytes(ee,ae);if(ye.etag&&ye.etag!==ve.etag)throw new EtagMismatch(ve.etag);const be=yield Z(ve.data,ye.internalCompression),Ye=deserializeIndex(be);if(Ye.length===0)throw new Error("Empty directory is invalid");return Ye})}var SharedPromiseCache=class{constructor(ie=100,Z=!0,ee=defaultDecompress){this.cache=new Map,this.maxCacheEntries=ie,this.counter=1,this.prefetch=Z,this.decompress=ee}getHeader(ie,Z){return __async(this,null,function*(){const ee=ie.getKey();if(this.cache.has(ee))return this.cache.get(ee).lastUsed=this.counter++,yield this.cache.get(ee).data;const ae=new Promise((ye,ve)=>{getHeaderAndRoot(ie,this.decompress,this.prefetch,Z).then(be=>{be[1]&&this.cache.set(be[1][0],{lastUsed:this.counter++,data:Promise.resolve(be[1][2])}),ye(be[0]),this.prune()}).catch(be=>{ve(be)})});return this.cache.set(ee,{lastUsed:this.counter++,data:ae}),ae})}getDirectory(ie,Z,ee,ae){return __async(this,null,function*(){const ye=ie.getKey()+"|"+(ae.etag||"")+"|"+Z+"|"+ee;if(this.cache.has(ye))return this.cache.get(ye).lastUsed=this.counter++,yield this.cache.get(ye).data;const ve=new Promise((be,Ye)=>{getDirectory(ie,this.decompress,Z,ee,ae).then(Ke=>{be(Ke),this.prune()}).catch(Ke=>{Ye(Ke)})});return this.cache.set(ye,{lastUsed:this.counter++,data:ve}),ve})}getArrayBuffer(ie,Z,ee,ae){return __async(this,null,function*(){const ye=ie.getKey()+"|"+(ae.etag||"")+"|"+Z+"|"+ee;if(this.cache.has(ye))return this.cache.get(ye).lastUsed=this.counter++,yield this.cache.get(ye).data;const ve=new Promise((be,Ye)=>{ie.getBytes(Z,ee).then(Ke=>{if(ae.etag&&ae.etag!==Ke.etag)throw new EtagMismatch(Ke.etag);be(Ke.data),this.cache.has(ye),this.prune()}).catch(Ke=>{Ye(Ke)})});return this.cache.set(ye,{lastUsed:this.counter++,data:ve}),ve})}prune(){if(this.cache.size>=this.maxCacheEntries){let ie=1/0,Z;this.cache.forEach((ee,ae)=>{ee.lastUsed<ie&&(ie=ee.lastUsed,Z=ae)}),Z&&this.cache.delete(Z)}}invalidate(ie,Z){return __async(this,null,function*(){this.cache.delete(ie.getKey()),yield this.getHeader(ie,Z)})}},PMTiles=class{constructor(ie,Z,ee){typeof ie=="string"?this.source=new FetchSource(ie):this.source=ie,ee?this.decompress=ee:this.decompress=defaultDecompress,Z?this.cache=Z:this.cache=new SharedPromiseCache}getHeader(){return __async(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(ie,Z,ee,ae){return __async(this,null,function*(){const ye=zxyToTileId(ie,Z,ee),ve=yield this.cache.getHeader(this.source);if(ve.specVersion<3)return v2_default.getZxy(ve,this.source,this.cache,ie,Z,ee,ae);if(ie<ve.minZoom||ie>ve.maxZoom)return;let be=ve.rootDirectoryOffset,Ye=ve.rootDirectoryLength;for(let Ke=0;Ke<=3;Ke++){const Xe=yield this.cache.getDirectory(this.source,be,Ye,ve),Je=findTile(Xe,ye);if(Je)if(Je.runLength>0){const rt=yield this.source.getBytes(ve.tileDataOffset+Je.offset,Je.length,ae);if(ve.etag&&ve.etag!==rt.etag)throw new EtagMismatch(rt.etag);return{data:yield this.decompress(rt.data,ve.tileCompression),cacheControl:rt.cacheControl,expires:rt.expires}}else be=ve.leafDirectoryOffset+Je.offset,Ye=Je.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(ie,Z,ee,ae){return __async(this,null,function*(){try{return yield this.getZxyAttempt(ie,Z,ee,ae)}catch(ye){if(ye instanceof EtagMismatch)return this.cache.invalidate(this.source,ye.message),yield this.getZxyAttempt(ie,Z,ee,ae);throw ye}})}getMetadataAttempt(){return __async(this,null,function*(){const ie=yield this.cache.getHeader(this.source),Z=yield this.source.getBytes(ie.jsonMetadataOffset,ie.jsonMetadataLength);if(ie.etag&&ie.etag!==Z.etag)throw new EtagMismatch(Z.etag);const ee=yield this.decompress(Z.data,ie.internalCompression),ae=new TextDecoder("utf-8");return JSON.parse(ae.decode(ee))})}getMetadata(){return __async(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(ie){if(ie instanceof EtagMismatch)return this.cache.invalidate(this.source,ie.message),yield this.getMetadataAttempt();throw ie}})}};class PMTilesVectorSource extends VectorTile{constructor(Z){super({...Z,state:"loading",url:"pmtiles://"+Z.url+"/{z}/{x}/{y}",format:new MVT}),Sc(this,"tileLoadFunction",(ae,ye)=>{const ve=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),be=ye.match(ve),Ye=+be[2],Ke=+be[3],Xe=+be[4];ae.setLoader((Je,rt,nt)=>{ae.setState(TileState.LOADING),this.pmtiles_.getZxy(Ye,Ke,Xe).then(it=>{if(it){const lt=ae.getFormat();ae.setFeatures(lt.readFeatures(it.data,{extent:Je,featureProjection:nt})),ae.setState(TileState.LOADED)}else ae.setFeatures([]),ae.setState(TileState.EMPTY)}).catch(it=>{ae.setFeatures([]),ae.setState(TileState.ERROR)})})});const ee=new FetchSource(Z.url,new Headers(Z.headers));this.pmtiles_=new PMTiles(ee),this.pmtiles_.getHeader().then(ae=>{this.tileGrid.minZoom=ae.minZoom,this.tileGrid.maxZoom=ae.maxZoom,this.setTileLoadFunction(this.tileLoadFunction),this.setState("ready")})}}const openLayersBasemaps={darkMatter:{url:"https://{a-d}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://carto.com/attributions">Carto</a>',maxZoom:18},positron:{url:"https://{a-d}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://carto.com/attributions">Carto</a>',maxZoom:18},positronLite:{url:"https://{a-d}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://carto.com/attributions">Carto</a>',maxZoom:18},worldAntique:{url:"https://cartocdn_{a-d}.global.ssl.fastly.net/base-antique/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://carto.com/attributions">Carto</a>',maxZoom:18},worldEco:{url:"https://cartocdn_{a-d}.global.ssl.fastly.net/base-eco/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://carto.com/attributions">Carto</a>',maxZoom:18},flatBlue:{url:"https://cartocdn_{a-d}.global.ssl.fastly.net/base-flatblue/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://carto.com/attributions">Carto</a>',maxZoom:18},midnightCommander:{url:"https://cartocdn_{a-d}.global.ssl.fastly.net/base-midnight/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://carto.com/attributions">Carto</a>',maxZoom:18},openstreetmapHot:{url:"https://{a-c}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, Tiles courtesy of <a href="http://hot.openstreetmap.org/" target="_blank">Humanitarian OpenStreetMap Team</a>',maxZoom:19},openstreetmapStandard:{url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',maxZoom:19}};class OlInitializer{constructor(){this.element=document.getElementById("ol-map"),this.element&&(this.data=this.element.dataset,this.extent=new GeoJSON().readFeatures(this.data.mapGeom)[0].getGeometry().getExtent())}run(){if(!this.element)return!1;this.data.protocol==="Pmtiles"?this.initializePmtiles():this.data.protocol==="Cog"&&this.initializeCog()}baseLayer(){const Z=openLayersBasemaps[this.data.basemap];return new TileLayer({source:new XYZ({attributions:Z.attribution,url:Z.url,maxZoom:Z.maxZoom})})}initializePmtiles(){const Z=new VectorTileLayer({declutter:!0,source:new PMTilesVectorSource({url:this.data.url}),style:new Style$1({stroke:new Stroke({color:"#7070B3",width:1}),fill:new Fill({color:"#FFFFFF"}),image:new CircleStyle({radius:7,fill:new Fill({color:"#7070B3"}),stroke:new Stroke({color:"#FFFFFF",width:2})})})});useGeographic();const ee=new Map$1({controls:defaults$2().extend([new FullScreen]),layers:[this.baseLayer(),Z],target:"ol-map"});ee.getView().fit(this.extent,ee.getSize())}initializeCog(){const Z=new GeoTIFFSource({sources:[{url:this.data.url}]});Z.getView().then(ee=>{const ae=new Map$1({controls:defaults$2().extend([new FullScreen]),target:"ol-map",layers:[this.baseLayer(),new WebGLTileLayer({source:Z})],view:new View({center:ee.center})});ae.getView().fit(ee.extent,ae.getSize())})}}var react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReact_production_min;function requireReact_production_min(){if(hasRequiredReact_production_min)return react_production_min;hasRequiredReact_production_min=1;var ie=Symbol.for("react.element"),Z=Symbol.for("react.portal"),ee=Symbol.for("react.fragment"),ae=Symbol.for("react.strict_mode"),ye=Symbol.for("react.profiler"),ve=Symbol.for("react.provider"),be=Symbol.for("react.context"),Ye=Symbol.for("react.forward_ref"),Ke=Symbol.for("react.suspense"),Xe=Symbol.for("react.memo"),Je=Symbol.for("react.lazy"),rt=Symbol.iterator;function nt(si){return si===null||typeof si!="object"?null:(si=rt&&si[rt]||si["@@iterator"],typeof si=="function"?si:null)}var it={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},lt=Object.assign,ct={};function ot(si,Ei,yi){this.props=si,this.context=Ei,this.refs=ct,this.updater=yi||it}ot.prototype.isReactComponent={},ot.prototype.setState=function(si,Ei){if(typeof si!="object"&&typeof si!="function"&&si!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,si,Ei,"setState")},ot.prototype.forceUpdate=function(si){this.updater.enqueueForceUpdate(this,si,"forceUpdate")};function dt(){}dt.prototype=ot.prototype;function ft(si,Ei,yi){this.props=si,this.context=Ei,this.refs=ct,this.updater=yi||it}var gt=ft.prototype=new dt;gt.constructor=ft,lt(gt,ot.prototype),gt.isPureReactComponent=!0;var mt=Array.isArray,Yr=Object.prototype.hasOwnProperty,Qr={current:null},Xr={key:!0,ref:!0,__self:!0,__source:!0};function Jr(si,Ei,yi){var Mi,Ci={},Ri=null,Ni=null;if(Ei!=null)for(Mi in Ei.ref!==void 0&&(Ni=Ei.ref),Ei.key!==void 0&&(Ri=""+Ei.key),Ei)Yr.call(Ei,Mi)&&!Xr.hasOwnProperty(Mi)&&(Ci[Mi]=Ei[Mi]);var Ai=arguments.length-2;if(Ai===1)Ci.children=yi;else if(1<Ai){for(var ki=Array(Ai),Yi=0;Yi<Ai;Yi++)ki[Yi]=arguments[Yi+2];Ci.children=ki}if(si&&si.defaultProps)for(Mi in Ai=si.defaultProps,Ai)Ci[Mi]===void 0&&(Ci[Mi]=Ai[Mi]);return{$$typeof:ie,type:si,key:Ri,ref:Ni,props:Ci,_owner:Qr.current}}function ai(si,Ei){return{$$typeof:ie,type:si.type,key:Ei,ref:si.ref,props:si.props,_owner:si._owner}}function oi(si){return typeof si=="object"&&si!==null&&si.$$typeof===ie}function ni(si){var Ei={"=":"=0",":":"=2"};return"$"+si.replace(/[=:]/g,function(yi){return Ei[yi]})}var li=/\/+/g;function ui(si,Ei){return typeof si=="object"&&si!==null&&si.key!=null?ni(""+si.key):Ei.toString(36)}function mi(si,Ei,yi,Mi,Ci){var Ri=typeof si;(Ri==="undefined"||Ri==="boolean")&&(si=null);var Ni=!1;if(si===null)Ni=!0;else switch(Ri){case"string":case"number":Ni=!0;break;case"object":switch(si.$$typeof){case ie:case Z:Ni=!0}}if(Ni)return Ni=si,Ci=Ci(Ni),si=Mi===""?"."+ui(Ni,0):Mi,mt(Ci)?(yi="",si!=null&&(yi=si.replace(li,"$&/")+"/"),mi(Ci,Ei,yi,"",function(Yi){return Yi})):Ci!=null&&(oi(Ci)&&(Ci=ai(Ci,yi+(!Ci.key||Ni&&Ni.key===Ci.key?"":(""+Ci.key).replace(li,"$&/")+"/")+si)),Ei.push(Ci)),1;if(Ni=0,Mi=Mi===""?".":Mi+":",mt(si))for(var Ai=0;Ai<si.length;Ai++){Ri=si[Ai];var ki=Mi+ui(Ri,Ai);Ni+=mi(Ri,Ei,yi,ki,Ci)}else if(ki=nt(si),typeof ki=="function")for(si=ki.call(si),Ai=0;!(Ri=si.next()).done;)Ri=Ri.value,ki=Mi+ui(Ri,Ai++),Ni+=mi(Ri,Ei,yi,ki,Ci);else if(Ri==="object")throw Ei=String(si),Error("Objects are not valid as a React child (found: "+(Ei==="[object Object]"?"object with keys {"+Object.keys(si).join(", ")+"}":Ei)+"). If you meant to render a collection of children, use an array instead.");return Ni}function ii(si,Ei,yi){if(si==null)return si;var Mi=[],Ci=0;return mi(si,Mi,"","",function(Ri){return Ei.call(yi,Ri,Ci++)}),Mi}function hi(si){if(si._status===-1){var Ei=si._result;Ei=Ei(),Ei.then(function(yi){(si._status===0||si._status===-1)&&(si._status=1,si._result=yi)},function(yi){(si._status===0||si._status===-1)&&(si._status=2,si._result=yi)}),si._status===-1&&(si._status=0,si._result=Ei)}if(si._status===1)return si._result.default;throw si._result}var ri={current:null},ci={transition:null},Si={ReactCurrentDispatcher:ri,ReactCurrentBatchConfig:ci,ReactCurrentOwner:Qr};return react_production_min.Children={map:ii,forEach:function(si,Ei,yi){ii(si,function(){Ei.apply(this,arguments)},yi)},count:function(si){var Ei=0;return ii(si,function(){Ei++}),Ei},toArray:function(si){return ii(si,function(Ei){return Ei})||[]},only:function(si){if(!oi(si))throw Error("React.Children.only expected to receive a single React element child.");return si}},react_production_min.Component=ot,react_production_min.Fragment=ee,react_production_min.Profiler=ye,react_production_min.PureComponent=ft,react_production_min.StrictMode=ae,react_production_min.Suspense=Ke,react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Si,react_production_min.cloneElement=function(si,Ei,yi){if(si==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+si+".");var Mi=lt({},si.props),Ci=si.key,Ri=si.ref,Ni=si._owner;if(Ei!=null){if(Ei.ref!==void 0&&(Ri=Ei.ref,Ni=Qr.current),Ei.key!==void 0&&(Ci=""+Ei.key),si.type&&si.type.defaultProps)var Ai=si.type.defaultProps;for(ki in Ei)Yr.call(Ei,ki)&&!Xr.hasOwnProperty(ki)&&(Mi[ki]=Ei[ki]===void 0&&Ai!==void 0?Ai[ki]:Ei[ki])}var ki=arguments.length-2;if(ki===1)Mi.children=yi;else if(1<ki){Ai=Array(ki);for(var Yi=0;Yi<ki;Yi++)Ai[Yi]=arguments[Yi+2];Mi.children=Ai}return{$$typeof:ie,type:si.type,key:Ci,ref:Ri,props:Mi,_owner:Ni}},react_production_min.createContext=function(si){return si={$$typeof:be,_currentValue:si,_currentValue2:si,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},si.Provider={$$typeof:ve,_context:si},si.Consumer=si},react_production_min.createElement=Jr,react_production_min.createFactory=function(si){var Ei=Jr.bind(null,si);return Ei.type=si,Ei},react_production_min.createRef=function(){return{current:null}},react_production_min.forwardRef=function(si){return{$$typeof:Ye,render:si}},react_production_min.isValidElement=oi,react_production_min.lazy=function(si){return{$$typeof:Je,_payload:{_status:-1,_result:si},_init:hi}},react_production_min.memo=function(si,Ei){return{$$typeof:Xe,type:si,compare:Ei===void 0?null:Ei}},react_production_min.startTransition=function(si){var Ei=ci.transition;ci.transition={};try{si()}finally{ci.transition=Ei}},react_production_min.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},react_production_min.useCallback=function(si,Ei){return ri.current.useCallback(si,Ei)},react_production_min.useContext=function(si){return ri.current.useContext(si)},react_production_min.useDebugValue=function(){},react_production_min.useDeferredValue=function(si){return ri.current.useDeferredValue(si)},react_production_min.useEffect=function(si,Ei){return ri.current.useEffect(si,Ei)},react_production_min.useId=function(){return ri.current.useId()},react_production_min.useImperativeHandle=function(si,Ei,yi){return ri.current.useImperativeHandle(si,Ei,yi)},react_production_min.useInsertionEffect=function(si,Ei){return ri.current.useInsertionEffect(si,Ei)},react_production_min.useLayoutEffect=function(si,Ei){return ri.current.useLayoutEffect(si,Ei)},react_production_min.useMemo=function(si,Ei){return ri.current.useMemo(si,Ei)},react_production_min.useReducer=function(si,Ei,yi){return ri.current.useReducer(si,Ei,yi)},react_production_min.useRef=function(si){return ri.current.useRef(si)},react_production_min.useState=function(si){return ri.current.useState(si)},react_production_min.useSyncExternalStore=function(si,Ei,yi){return ri.current.useSyncExternalStore(si,Ei,yi)},react_production_min.useTransition=function(){return ri.current.useTransition()},react_production_min.version="18.2.0",react_production_min}react.exports=requireReact_production_min();var reactExports=react.exports;const e$1=getDefaultExportFromCjs$1(reactExports),$2AODx$react=_mergeNamespaces({__proto__:null,default:e$1},[reactExports]);var reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredScheduler_production_min;function requireScheduler_production_min(){return hasRequiredScheduler_production_min||(hasRequiredScheduler_production_min=1,function(ie){function Z(ci,Si){var si=ci.length;ci.push(Si);e:for(;0<si;){var Ei=si-1>>>1,yi=ci[Ei];if(0<ye(yi,Si))ci[Ei]=Si,ci[si]=yi,si=Ei;else break e}}function ee(ci){return ci.length===0?null:ci[0]}function ae(ci){if(ci.length===0)return null;var Si=ci[0],si=ci.pop();if(si!==Si){ci[0]=si;e:for(var Ei=0,yi=ci.length,Mi=yi>>>1;Ei<Mi;){var Ci=2*(Ei+1)-1,Ri=ci[Ci],Ni=Ci+1,Ai=ci[Ni];if(0>ye(Ri,si))Ni<yi&&0>ye(Ai,Ri)?(ci[Ei]=Ai,ci[Ni]=si,Ei=Ni):(ci[Ei]=Ri,ci[Ci]=si,Ei=Ci);else if(Ni<yi&&0>ye(Ai,si))ci[Ei]=Ai,ci[Ni]=si,Ei=Ni;else break e}}return Si}function ye(ci,Si){var si=ci.sortIndex-Si.sortIndex;return si!==0?si:ci.id-Si.id}if(typeof performance=="object"&&typeof performance.now=="function"){var ve=performance;ie.unstable_now=function(){return ve.now()}}else{var be=Date,Ye=be.now();ie.unstable_now=function(){return be.now()-Ye}}var Ke=[],Xe=[],Je=1,rt=null,nt=3,it=!1,lt=!1,ct=!1,ot=typeof setTimeout=="function"?setTimeout:null,dt=typeof clearTimeout=="function"?clearTimeout:null,ft=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function gt(ci){for(var Si=ee(Xe);Si!==null;){if(Si.callback===null)ae(Xe);else if(Si.startTime<=ci)ae(Xe),Si.sortIndex=Si.expirationTime,Z(Ke,Si);else break;Si=ee(Xe)}}function mt(ci){if(ct=!1,gt(ci),!lt)if(ee(Ke)!==null)lt=!0,hi(Yr);else{var Si=ee(Xe);Si!==null&&ri(mt,Si.startTime-ci)}}function Yr(ci,Si){lt=!1,ct&&(ct=!1,dt(Jr),Jr=-1),it=!0;var si=nt;try{for(gt(Si),rt=ee(Ke);rt!==null&&(!(rt.expirationTime>Si)||ci&&!ni());){var Ei=rt.callback;if(typeof Ei=="function"){rt.callback=null,nt=rt.priorityLevel;var yi=Ei(rt.expirationTime<=Si);Si=ie.unstable_now(),typeof yi=="function"?rt.callback=yi:rt===ee(Ke)&&ae(Ke),gt(Si)}else ae(Ke);rt=ee(Ke)}if(rt!==null)var Mi=!0;else{var Ci=ee(Xe);Ci!==null&&ri(mt,Ci.startTime-Si),Mi=!1}return Mi}finally{rt=null,nt=si,it=!1}}var Qr=!1,Xr=null,Jr=-1,ai=5,oi=-1;function ni(){return!(ie.unstable_now()-oi<ai)}function li(){if(Xr!==null){var ci=ie.unstable_now();oi=ci;var Si=!0;try{Si=Xr(!0,ci)}finally{Si?ui():(Qr=!1,Xr=null)}}else Qr=!1}var ui;if(typeof ft=="function")ui=function(){ft(li)};else if(typeof MessageChannel<"u"){var mi=new MessageChannel,ii=mi.port2;mi.port1.onmessage=li,ui=function(){ii.postMessage(null)}}else ui=function(){ot(li,0)};function hi(ci){Xr=ci,Qr||(Qr=!0,ui())}function ri(ci,Si){Jr=ot(function(){ci(ie.unstable_now())},Si)}ie.unstable_IdlePriority=5,ie.unstable_ImmediatePriority=1,ie.unstable_LowPriority=4,ie.unstable_NormalPriority=3,ie.unstable_Profiling=null,ie.unstable_UserBlockingPriority=2,ie.unstable_cancelCallback=function(ci){ci.callback=null},ie.unstable_continueExecution=function(){lt||it||(lt=!0,hi(Yr))},ie.unstable_forceFrameRate=function(ci){0>ci||125<ci?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ai=0<ci?Math.floor(1e3/ci):5},ie.unstable_getCurrentPriorityLevel=function(){return nt},ie.unstable_getFirstCallbackNode=function(){return ee(Ke)},ie.unstable_next=function(ci){switch(nt){case 1:case 2:case 3:var Si=3;break;default:Si=nt}var si=nt;nt=Si;try{return ci()}finally{nt=si}},ie.unstable_pauseExecution=function(){},ie.unstable_requestPaint=function(){},ie.unstable_runWithPriority=function(ci,Si){switch(ci){case 1:case 2:case 3:case 4:case 5:break;default:ci=3}var si=nt;nt=ci;try{return Si()}finally{nt=si}},ie.unstable_scheduleCallback=function(ci,Si,si){var Ei=ie.unstable_now();switch(typeof si=="object"&&si!==null?(si=si.delay,si=typeof si=="number"&&0<si?Ei+si:Ei):si=Ei,ci){case 1:var yi=-1;break;case 2:yi=250;break;case 5:yi=1073741823;break;case 4:yi=1e4;break;default:yi=5e3}return yi=si+yi,ci={id:Je++,callback:Si,priorityLevel:ci,startTime:si,expirationTime:yi,sortIndex:-1},si>Ei?(ci.sortIndex=si,Z(Xe,ci),ee(Ke)===null&&ci===ee(Xe)&&(ct?(dt(Jr),Jr=-1):ct=!0,ri(mt,si-Ei))):(ci.sortIndex=yi,Z(Ke,ci),lt||it||(lt=!0,hi(Yr))),ci},ie.unstable_shouldYield=ni,ie.unstable_wrapCallback=function(ci){var Si=nt;return function(){var si=nt;nt=Si;try{return ci.apply(this,arguments)}finally{nt=si}}}}(scheduler_production_min)),scheduler_production_min}var hasRequiredScheduler;function requireScheduler(){return hasRequiredScheduler||(hasRequiredScheduler=1,scheduler.exports=requireScheduler_production_min()),scheduler.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactDom_production_min;function requireReactDom_production_min(){if(hasRequiredReactDom_production_min)return reactDom_production_min;hasRequiredReactDom_production_min=1;var ie=reactExports,Z=requireScheduler();function ee(Qe){for(var tt="https://reactjs.org/docs/error-decoder.html?invariant="+Qe,st=1;st<arguments.length;st++)tt+="&args[]="+encodeURIComponent(arguments[st]);return"Minified React error #"+Qe+"; visit "+tt+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var ae=new Set,ye={};function ve(Qe,tt){be(Qe,tt),be(Qe+"Capture",tt)}function be(Qe,tt){for(ye[Qe]=tt,Qe=0;Qe<tt.length;Qe++)ae.add(tt[Qe])}var Ye=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ke=Object.prototype.hasOwnProperty,Xe=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Je={},rt={};function nt(Qe){return Ke.call(rt,Qe)?!0:Ke.call(Je,Qe)?!1:Xe.test(Qe)?rt[Qe]=!0:(Je[Qe]=!0,!1)}function it(Qe,tt,st,ut){if(st!==null&&st.type===0)return!1;switch(typeof tt){case"function":case"symbol":return!0;case"boolean":return ut?!1:st!==null?!st.acceptsBooleans:(Qe=Qe.toLowerCase().slice(0,5),Qe!=="data-"&&Qe!=="aria-");default:return!1}}function lt(Qe,tt,st,ut){if(tt===null||typeof tt>"u"||it(Qe,tt,st,ut))return!0;if(ut)return!1;if(st!==null)switch(st.type){case 3:return!tt;case 4:return tt===!1;case 5:return isNaN(tt);case 6:return isNaN(tt)||1>tt}return!1}function ct(Qe,tt,st,ut,pt,_r,ti){this.acceptsBooleans=tt===2||tt===3||tt===4,this.attributeName=ut,this.attributeNamespace=pt,this.mustUseProperty=st,this.propertyName=Qe,this.type=tt,this.sanitizeURL=_r,this.removeEmptyString=ti}var ot={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(Qe){ot[Qe]=new ct(Qe,0,!1,Qe,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(Qe){var tt=Qe[0];ot[tt]=new ct(tt,1,!1,Qe[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(Qe){ot[Qe]=new ct(Qe,2,!1,Qe.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(Qe){ot[Qe]=new ct(Qe,2,!1,Qe,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(Qe){ot[Qe]=new ct(Qe,3,!1,Qe.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(Qe){ot[Qe]=new ct(Qe,3,!0,Qe,null,!1,!1)}),["capture","download"].forEach(function(Qe){ot[Qe]=new ct(Qe,4,!1,Qe,null,!1,!1)}),["cols","rows","size","span"].forEach(function(Qe){ot[Qe]=new ct(Qe,6,!1,Qe,null,!1,!1)}),["rowSpan","start"].forEach(function(Qe){ot[Qe]=new ct(Qe,5,!1,Qe.toLowerCase(),null,!1,!1)});var dt=/[\-:]([a-z])/g;function ft(Qe){return Qe[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(Qe){var tt=Qe.replace(dt,ft);ot[tt]=new ct(tt,1,!1,Qe,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(Qe){var tt=Qe.replace(dt,ft);ot[tt]=new ct(tt,1,!1,Qe,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(Qe){var tt=Qe.replace(dt,ft);ot[tt]=new ct(tt,1,!1,Qe,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(Qe){ot[Qe]=new ct(Qe,1,!1,Qe.toLowerCase(),null,!1,!1)}),ot.xlinkHref=new ct("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(Qe){ot[Qe]=new ct(Qe,1,!1,Qe.toLowerCase(),null,!0,!0)});function gt(Qe,tt,st,ut){var pt=ot.hasOwnProperty(tt)?ot[tt]:null;(pt!==null?pt.type!==0:ut||!(2<tt.length)||tt[0]!=="o"&&tt[0]!=="O"||tt[1]!=="n"&&tt[1]!=="N")&&(lt(tt,st,pt,ut)&&(st=null),ut||pt===null?nt(tt)&&(st===null?Qe.removeAttribute(tt):Qe.setAttribute(tt,""+st)):pt.mustUseProperty?Qe[pt.propertyName]=st===null?pt.type===3?!1:"":st:(tt=pt.attributeName,ut=pt.attributeNamespace,st===null?Qe.removeAttribute(tt):(pt=pt.type,st=pt===3||pt===4&&st===!0?"":""+st,ut?Qe.setAttributeNS(ut,tt,st):Qe.setAttribute(tt,st))))}var mt=ie.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Yr=Symbol.for("react.element"),Qr=Symbol.for("react.portal"),Xr=Symbol.for("react.fragment"),Jr=Symbol.for("react.strict_mode"),ai=Symbol.for("react.profiler"),oi=Symbol.for("react.provider"),ni=Symbol.for("react.context"),li=Symbol.for("react.forward_ref"),ui=Symbol.for("react.suspense"),mi=Symbol.for("react.suspense_list"),ii=Symbol.for("react.memo"),hi=Symbol.for("react.lazy"),ri=Symbol.for("react.offscreen"),ci=Symbol.iterator;function Si(Qe){return Qe===null||typeof Qe!="object"?null:(Qe=ci&&Qe[ci]||Qe["@@iterator"],typeof Qe=="function"?Qe:null)}var si=Object.assign,Ei;function yi(Qe){if(Ei===void 0)try{throw Error()}catch(st){var tt=st.stack.trim().match(/\n( *(at )?)/);Ei=tt&&tt[1]||""}return`
`+Ei+Qe}var Mi=!1;function Ci(Qe,tt){if(!Qe||Mi)return"";Mi=!0;var st=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(tt)if(tt=function(){throw Error()},Object.defineProperty(tt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(tt,[])}catch(_i){var ut=_i}Reflect.construct(Qe,[],tt)}else{try{tt.call()}catch(_i){ut=_i}Qe.call(tt.prototype)}else{try{throw Error()}catch(_i){ut=_i}Qe()}}catch(_i){if(_i&&ut&&typeof _i.stack=="string"){for(var pt=_i.stack.split(`
`),_r=ut.stack.split(`
`),ti=pt.length-1,fi=_r.length-1;1<=ti&&0<=fi&&pt[ti]!==_r[fi];)fi--;for(;1<=ti&&0<=fi;ti--,fi--)if(pt[ti]!==_r[fi]){if(ti!==1||fi!==1)do if(ti--,fi--,0>fi||pt[ti]!==_r[fi]){var vi=`
`+pt[ti].replace(" at new "," at ");return Qe.displayName&&vi.includes("<anonymous>")&&(vi=vi.replace("<anonymous>",Qe.displayName)),vi}while(1<=ti&&0<=fi);break}}}finally{Mi=!1,Error.prepareStackTrace=st}return(Qe=Qe?Qe.displayName||Qe.name:"")?yi(Qe):""}function Ri(Qe){switch(Qe.tag){case 5:return yi(Qe.type);case 16:return yi("Lazy");case 13:return yi("Suspense");case 19:return yi("SuspenseList");case 0:case 2:case 15:return Qe=Ci(Qe.type,!1),Qe;case 11:return Qe=Ci(Qe.type.render,!1),Qe;case 1:return Qe=Ci(Qe.type,!0),Qe;default:return""}}function Ni(Qe){if(Qe==null)return null;if(typeof Qe=="function")return Qe.displayName||Qe.name||null;if(typeof Qe=="string")return Qe;switch(Qe){case Xr:return"Fragment";case Qr:return"Portal";case ai:return"Profiler";case Jr:return"StrictMode";case ui:return"Suspense";case mi:return"SuspenseList"}if(typeof Qe=="object")switch(Qe.$$typeof){case ni:return(Qe.displayName||"Context")+".Consumer";case oi:return(Qe._context.displayName||"Context")+".Provider";case li:var tt=Qe.render;return Qe=Qe.displayName,Qe||(Qe=tt.displayName||tt.name||"",Qe=Qe!==""?"ForwardRef("+Qe+")":"ForwardRef"),Qe;case ii:return tt=Qe.displayName||null,tt!==null?tt:Ni(Qe.type)||"Memo";case hi:tt=Qe._payload,Qe=Qe._init;try{return Ni(Qe(tt))}catch{}}return null}function Ai(Qe){var tt=Qe.type;switch(Qe.tag){case 24:return"Cache";case 9:return(tt.displayName||"Context")+".Consumer";case 10:return(tt._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return Qe=tt.render,Qe=Qe.displayName||Qe.name||"",tt.displayName||(Qe!==""?"ForwardRef("+Qe+")":"ForwardRef");case 7:return"Fragment";case 5:return tt;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ni(tt);case 8:return tt===Jr?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof tt=="function")return tt.displayName||tt.name||null;if(typeof tt=="string")return tt}return null}function ki(Qe){switch(typeof Qe){case"boolean":case"number":case"string":case"undefined":return Qe;case"object":return Qe;default:return""}}function Yi(Qe){var tt=Qe.type;return(Qe=Qe.nodeName)&&Qe.toLowerCase()==="input"&&(tt==="checkbox"||tt==="radio")}function Ji(Qe){var tt=Yi(Qe)?"checked":"value",st=Object.getOwnPropertyDescriptor(Qe.constructor.prototype,tt),ut=""+Qe[tt];if(!Qe.hasOwnProperty(tt)&&typeof st<"u"&&typeof st.get=="function"&&typeof st.set=="function"){var pt=st.get,_r=st.set;return Object.defineProperty(Qe,tt,{configurable:!0,get:function(){return pt.call(this)},set:function(ti){ut=""+ti,_r.call(this,ti)}}),Object.defineProperty(Qe,tt,{enumerable:st.enumerable}),{getValue:function(){return ut},setValue:function(ti){ut=""+ti},stopTracking:function(){Qe._valueTracker=null,delete Qe[tt]}}}}function ls(Qe){Qe._valueTracker||(Qe._valueTracker=Ji(Qe))}function hs(Qe){if(!Qe)return!1;var tt=Qe._valueTracker;if(!tt)return!0;var st=tt.getValue(),ut="";return Qe&&(ut=Yi(Qe)?Qe.checked?"true":"false":Qe.value),Qe=ut,Qe!==st?(tt.setValue(Qe),!0):!1}function Kr(Qe){if(Qe=Qe||(typeof document<"u"?document:void 0),typeof Qe>"u")return null;try{return Qe.activeElement||Qe.body}catch{return Qe.body}}function di(Qe,tt){var st=tt.checked;return si({},tt,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:st??Qe._wrapperState.initialChecked})}function wi(Qe,tt){var st=tt.defaultValue==null?"":tt.defaultValue,ut=tt.checked!=null?tt.checked:tt.defaultChecked;st=ki(tt.value!=null?tt.value:st),Qe._wrapperState={initialChecked:ut,initialValue:st,controlled:tt.type==="checkbox"||tt.type==="radio"?tt.checked!=null:tt.value!=null}}function Ii(Qe,tt){tt=tt.checked,tt!=null&&gt(Qe,"checked",tt,!1)}function Di(Qe,tt){Ii(Qe,tt);var st=ki(tt.value),ut=tt.type;if(st!=null)ut==="number"?(st===0&&Qe.value===""||Qe.value!=st)&&(Qe.value=""+st):Qe.value!==""+st&&(Qe.value=""+st);else if(ut==="submit"||ut==="reset"){Qe.removeAttribute("value");return}tt.hasOwnProperty("value")?Gi(Qe,tt.type,st):tt.hasOwnProperty("defaultValue")&&Gi(Qe,tt.type,ki(tt.defaultValue)),tt.checked==null&&tt.defaultChecked!=null&&(Qe.defaultChecked=!!tt.defaultChecked)}function is(Qe,tt,st){if(tt.hasOwnProperty("value")||tt.hasOwnProperty("defaultValue")){var ut=tt.type;if(!(ut!=="submit"&&ut!=="reset"||tt.value!==void 0&&tt.value!==null))return;tt=""+Qe._wrapperState.initialValue,st||tt===Qe.value||(Qe.value=tt),Qe.defaultValue=tt}st=Qe.name,st!==""&&(Qe.name=""),Qe.defaultChecked=!!Qe._wrapperState.initialChecked,st!==""&&(Qe.name=st)}function Gi(Qe,tt,st){(tt!=="number"||Kr(Qe.ownerDocument)!==Qe)&&(st==null?Qe.defaultValue=""+Qe._wrapperState.initialValue:Qe.defaultValue!==""+st&&(Qe.defaultValue=""+st))}var us=Array.isArray;function Zi(Qe,tt,st,ut){if(Qe=Qe.options,tt){tt={};for(var pt=0;pt<st.length;pt++)tt["$"+st[pt]]=!0;for(st=0;st<Qe.length;st++)pt=tt.hasOwnProperty("$"+Qe[st].value),Qe[st].selected!==pt&&(Qe[st].selected=pt),pt&&ut&&(Qe[st].defaultSelected=!0)}else{for(st=""+ki(st),tt=null,pt=0;pt<Qe.length;pt++){if(Qe[pt].value===st){Qe[pt].selected=!0,ut&&(Qe[pt].defaultSelected=!0);return}tt!==null||Qe[pt].disabled||(tt=Qe[pt])}tt!==null&&(tt.selected=!0)}}function ns(Qe,tt){if(tt.dangerouslySetInnerHTML!=null)throw Error(ee(91));return si({},tt,{value:void 0,defaultValue:void 0,children:""+Qe._wrapperState.initialValue})}function Ki(Qe,tt){var st=tt.value;if(st==null){if(st=tt.children,tt=tt.defaultValue,st!=null){if(tt!=null)throw Error(ee(92));if(us(st)){if(1<st.length)throw Error(ee(93));st=st[0]}tt=st}tt==null&&(tt=""),st=tt}Qe._wrapperState={initialValue:ki(st)}}function ds(Qe,tt){var st=ki(tt.value),ut=ki(tt.defaultValue);st!=null&&(st=""+st,st!==Qe.value&&(Qe.value=st),tt.defaultValue==null&&Qe.defaultValue!==st&&(Qe.defaultValue=st)),ut!=null&&(Qe.defaultValue=""+ut)}function as(Qe){var tt=Qe.textContent;tt===Qe._wrapperState.initialValue&&tt!==""&&tt!==null&&(Qe.value=tt)}function ms(Qe){switch(Qe){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function vs(Qe,tt){return Qe==null||Qe==="http://www.w3.org/1999/xhtml"?ms(tt):Qe==="http://www.w3.org/2000/svg"&&tt==="foreignObject"?"http://www.w3.org/1999/xhtml":Qe}var zs,Zs=function(Qe){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(tt,st,ut,pt){MSApp.execUnsafeLocalFunction(function(){return Qe(tt,st,ut,pt)})}:Qe}(function(Qe,tt){if(Qe.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in Qe)Qe.innerHTML=tt;else{for(zs=zs||document.createElement("div"),zs.innerHTML="<svg>"+tt.valueOf().toString()+"</svg>",tt=zs.firstChild;Qe.firstChild;)Qe.removeChild(Qe.firstChild);for(;tt.firstChild;)Qe.appendChild(tt.firstChild)}});function Ts(Qe,tt){if(tt){var st=Qe.firstChild;if(st&&st===Qe.lastChild&&st.nodeType===3){st.nodeValue=tt;return}}Qe.textContent=tt}var go={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ha=["Webkit","ms","Moz","O"];Object.keys(go).forEach(function(Qe){Ha.forEach(function(tt){tt=tt+Qe.charAt(0).toUpperCase()+Qe.substring(1),go[tt]=go[Qe]})});function na(Qe,tt,st){return tt==null||typeof tt=="boolean"||tt===""?"":st||typeof tt!="number"||tt===0||go.hasOwnProperty(Qe)&&go[Qe]?(""+tt).trim():tt+"px"}function No(Qe,tt){Qe=Qe.style;for(var st in tt)if(tt.hasOwnProperty(st)){var ut=st.indexOf("--")===0,pt=na(st,tt[st],ut);st==="float"&&(st="cssFloat"),ut?Qe.setProperty(st,pt):Qe[st]=pt}}var ei=si({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Zr(Qe,tt){if(tt){if(ei[Qe]&&(tt.children!=null||tt.dangerouslySetInnerHTML!=null))throw Error(ee(137,Qe));if(tt.dangerouslySetInnerHTML!=null){if(tt.children!=null)throw Error(ee(60));if(typeof tt.dangerouslySetInnerHTML!="object"||!("__html"in tt.dangerouslySetInnerHTML))throw Error(ee(61))}if(tt.style!=null&&typeof tt.style!="object")throw Error(ee(62))}}function pi(Qe,tt){if(Qe.indexOf("-")===-1)return typeof tt.is=="string";switch(Qe){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var gi=null;function $i(Qe){return Qe=Qe.target||Qe.srcElement||window,Qe.correspondingUseElement&&(Qe=Qe.correspondingUseElement),Qe.nodeType===3?Qe.parentNode:Qe}var Vi=null,Bi=null,Ui=null;function es(Qe){if(Qe=al(Qe)){if(typeof Vi!="function")throw Error(ee(280));var tt=Qe.stateNode;tt&&(tt=jl(tt),Vi(Qe.stateNode,Qe.type,tt))}}function Qi(Qe){Bi?Ui?Ui.push(Qe):Ui=[Qe]:Bi=Qe}function ss(){if(Bi){var Qe=Bi,tt=Ui;if(Ui=Bi=null,es(Qe),tt)for(Qe=0;Qe<tt.length;Qe++)es(tt[Qe])}}function cs(Qe,tt){return Qe(tt)}function Xi(){}var _s=!1;function eo(Qe,tt,st){if(_s)return Qe(tt,st);_s=!0;try{return cs(Qe,tt,st)}finally{_s=!1,(Bi!==null||Ui!==null)&&(Xi(),ss())}}function Ys(Qe,tt){var st=Qe.stateNode;if(st===null)return null;var ut=jl(st);if(ut===null)return null;st=ut[tt];e:switch(tt){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(ut=!ut.disabled)||(Qe=Qe.type,ut=!(Qe==="button"||Qe==="input"||Qe==="select"||Qe==="textarea")),Qe=!ut;break e;default:Qe=!1}if(Qe)return null;if(st&&typeof st!="function")throw Error(ee(231,tt,typeof st));return st}var Ps=!1;if(Ye)try{var Os={};Object.defineProperty(Os,"passive",{get:function(){Ps=!0}}),window.addEventListener("test",Os,Os),window.removeEventListener("test",Os,Os)}catch{Ps=!1}function mo(Qe,tt,st,ut,pt,_r,ti,fi,vi){var _i=Array.prototype.slice.call(arguments,3);try{tt.apply(st,_i)}catch(Li){this.onError(Li)}}var ia=!1,xl=null,_l=!1,$c=null,Zf={onError:function(Qe){ia=!0,xl=Qe}};function ep(Qe,tt,st,ut,pt,_r,ti,fi,vi){ia=!1,xl=null,mo.apply(Zf,arguments)}function tp(Qe,tt,st,ut,pt,_r,ti,fi,vi){if(ep.apply(this,arguments),ia){if(ia){var _i=xl;ia=!1,xl=null}else throw Error(ee(198));_l||(_l=!0,$c=_i)}}function sa(Qe){var tt=Qe,st=Qe;if(Qe.alternate)for(;tt.return;)tt=tt.return;else{Qe=tt;do tt=Qe,tt.flags&4098&&(st=tt.return),Qe=tt.return;while(Qe)}return tt.tag===3?st:null}function dh(Qe){if(Qe.tag===13){var tt=Qe.memoizedState;if(tt===null&&(Qe=Qe.alternate,Qe!==null&&(tt=Qe.memoizedState)),tt!==null)return tt.dehydrated}return null}function fh(Qe){if(sa(Qe)!==Qe)throw Error(ee(188))}function rp(Qe){var tt=Qe.alternate;if(!tt){if(tt=sa(Qe),tt===null)throw Error(ee(188));return tt!==Qe?null:Qe}for(var st=Qe,ut=tt;;){var pt=st.return;if(pt===null)break;var _r=pt.alternate;if(_r===null){if(ut=pt.return,ut!==null){st=ut;continue}break}if(pt.child===_r.child){for(_r=pt.child;_r;){if(_r===st)return fh(pt),Qe;if(_r===ut)return fh(pt),tt;_r=_r.sibling}throw Error(ee(188))}if(st.return!==ut.return)st=pt,ut=_r;else{for(var ti=!1,fi=pt.child;fi;){if(fi===st){ti=!0,st=pt,ut=_r;break}if(fi===ut){ti=!0,ut=pt,st=_r;break}fi=fi.sibling}if(!ti){for(fi=_r.child;fi;){if(fi===st){ti=!0,st=_r,ut=pt;break}if(fi===ut){ti=!0,ut=_r,st=pt;break}fi=fi.sibling}if(!ti)throw Error(ee(189))}}if(st.alternate!==ut)throw Error(ee(190))}if(st.tag!==3)throw Error(ee(188));return st.stateNode.current===st?Qe:tt}function ph(Qe){return Qe=rp(Qe),Qe!==null?gh(Qe):null}function gh(Qe){if(Qe.tag===5||Qe.tag===6)return Qe;for(Qe=Qe.child;Qe!==null;){var tt=gh(Qe);if(tt!==null)return tt;Qe=Qe.sibling}return null}var mh=Z.unstable_scheduleCallback,yh=Z.unstable_cancelCallback,np=Z.unstable_shouldYield,ip=Z.unstable_requestPaint,As=Z.unstable_now,sp=Z.unstable_getCurrentPriorityLevel,Dc=Z.unstable_ImmediatePriority,vh=Z.unstable_UserBlockingPriority,wl=Z.unstable_NormalPriority,op=Z.unstable_LowPriority,Eh=Z.unstable_IdlePriority,Cl=null,_o=null;function ap(Qe){if(_o&&typeof _o.onCommitFiberRoot=="function")try{_o.onCommitFiberRoot(Cl,Qe,void 0,(Qe.current.flags&128)===128)}catch{}}var yo=Math.clz32?Math.clz32:up,lp=Math.log,cp=Math.LN2;function up(Qe){return Qe>>>=0,Qe===0?32:31-(lp(Qe)/cp|0)|0}var Rl=64,Al=4194304;function Va(Qe){switch(Qe&-Qe){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return Qe&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return Qe&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return Qe}}function Il(Qe,tt){var st=Qe.pendingLanes;if(st===0)return 0;var ut=0,pt=Qe.suspendedLanes,_r=Qe.pingedLanes,ti=st&268435455;if(ti!==0){var fi=ti&~pt;fi!==0?ut=Va(fi):(_r&=ti,_r!==0&&(ut=Va(_r)))}else ti=st&~pt,ti!==0?ut=Va(ti):_r!==0&&(ut=Va(_r));if(ut===0)return 0;if(tt!==0&&tt!==ut&&!(tt&pt)&&(pt=ut&-ut,_r=tt&-tt,pt>=_r||pt===16&&(_r&4194240)!==0))return tt;if(ut&4&&(ut|=st&16),tt=Qe.entangledLanes,tt!==0)for(Qe=Qe.entanglements,tt&=ut;0<tt;)st=31-yo(tt),pt=1<<st,ut|=Qe[st],tt&=~pt;return ut}function hp(Qe,tt){switch(Qe){case 1:case 2:case 4:return tt+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return tt+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function dp(Qe,tt){for(var st=Qe.suspendedLanes,ut=Qe.pingedLanes,pt=Qe.expirationTimes,_r=Qe.pendingLanes;0<_r;){var ti=31-yo(_r),fi=1<<ti,vi=pt[ti];vi===-1?(!(fi&st)||fi&ut)&&(pt[ti]=hp(fi,tt)):vi<=tt&&(Qe.expiredLanes|=fi),_r&=~fi}}function Oc(Qe){return Qe=Qe.pendingLanes&-1073741825,Qe!==0?Qe:Qe&1073741824?1073741824:0}function Th(){var Qe=Rl;return Rl<<=1,!(Rl&4194240)&&(Rl=64),Qe}function Mc(Qe){for(var tt=[],st=0;31>st;st++)tt.push(Qe);return tt}function za(Qe,tt,st){Qe.pendingLanes|=tt,tt!==536870912&&(Qe.suspendedLanes=0,Qe.pingedLanes=0),Qe=Qe.eventTimes,tt=31-yo(tt),Qe[tt]=st}function fp(Qe,tt){var st=Qe.pendingLanes&~tt;Qe.pendingLanes=tt,Qe.suspendedLanes=0,Qe.pingedLanes=0,Qe.expiredLanes&=tt,Qe.mutableReadLanes&=tt,Qe.entangledLanes&=tt,tt=Qe.entanglements;var ut=Qe.eventTimes;for(Qe=Qe.expirationTimes;0<st;){var pt=31-yo(st),_r=1<<pt;tt[pt]=0,ut[pt]=-1,Qe[pt]=-1,st&=~_r}}function kc(Qe,tt){var st=Qe.entangledLanes|=tt;for(Qe=Qe.entanglements;st;){var ut=31-yo(st),pt=1<<ut;pt&tt|Qe[ut]&tt&&(Qe[ut]|=tt),st&=~pt}}var ys=0;function bh(Qe){return Qe&=-Qe,1<Qe?4<Qe?Qe&268435455?16:536870912:4:1}var Sh,Nc,xh,_h,wh,Fc=!1,Pl=[],Fo=null,Bo=null,Uo=null,ja=new Map,Wa=new Map,Go=[],pp="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ch(Qe,tt){switch(Qe){case"focusin":case"focusout":Fo=null;break;case"dragenter":case"dragleave":Bo=null;break;case"mouseover":case"mouseout":Uo=null;break;case"pointerover":case"pointerout":ja.delete(tt.pointerId);break;case"gotpointercapture":case"lostpointercapture":Wa.delete(tt.pointerId)}}function Ya(Qe,tt,st,ut,pt,_r){return Qe===null||Qe.nativeEvent!==_r?(Qe={blockedOn:tt,domEventName:st,eventSystemFlags:ut,nativeEvent:_r,targetContainers:[pt]},tt!==null&&(tt=al(tt),tt!==null&&Nc(tt)),Qe):(Qe.eventSystemFlags|=ut,tt=Qe.targetContainers,pt!==null&&tt.indexOf(pt)===-1&&tt.push(pt),Qe)}function gp(Qe,tt,st,ut,pt){switch(tt){case"focusin":return Fo=Ya(Fo,Qe,tt,st,ut,pt),!0;case"dragenter":return Bo=Ya(Bo,Qe,tt,st,ut,pt),!0;case"mouseover":return Uo=Ya(Uo,Qe,tt,st,ut,pt),!0;case"pointerover":var _r=pt.pointerId;return ja.set(_r,Ya(ja.get(_r)||null,Qe,tt,st,ut,pt)),!0;case"gotpointercapture":return _r=pt.pointerId,Wa.set(_r,Ya(Wa.get(_r)||null,Qe,tt,st,ut,pt)),!0}return!1}function Rh(Qe){var tt=oa(Qe.target);if(tt!==null){var st=sa(tt);if(st!==null){if(tt=st.tag,tt===13){if(tt=dh(st),tt!==null){Qe.blockedOn=tt,wh(Qe.priority,function(){xh(st)});return}}else if(tt===3&&st.stateNode.current.memoizedState.isDehydrated){Qe.blockedOn=st.tag===3?st.stateNode.containerInfo:null;return}}}Qe.blockedOn=null}function Ll(Qe){if(Qe.blockedOn!==null)return!1;for(var tt=Qe.targetContainers;0<tt.length;){var st=Uc(Qe.domEventName,Qe.eventSystemFlags,tt[0],Qe.nativeEvent);if(st===null){st=Qe.nativeEvent;var ut=new st.constructor(st.type,st);gi=ut,st.target.dispatchEvent(ut),gi=null}else return tt=al(st),tt!==null&&Nc(tt),Qe.blockedOn=st,!1;tt.shift()}return!0}function Ah(Qe,tt,st){Ll(Qe)&&st.delete(tt)}function mp(){Fc=!1,Fo!==null&&Ll(Fo)&&(Fo=null),Bo!==null&&Ll(Bo)&&(Bo=null),Uo!==null&&Ll(Uo)&&(Uo=null),ja.forEach(Ah),Wa.forEach(Ah)}function Ka(Qe,tt){Qe.blockedOn===tt&&(Qe.blockedOn=null,Fc||(Fc=!0,Z.unstable_scheduleCallback(Z.unstable_NormalPriority,mp)))}function qa(Qe){function tt(pt){return Ka(pt,Qe)}if(0<Pl.length){Ka(Pl[0],Qe);for(var st=1;st<Pl.length;st++){var ut=Pl[st];ut.blockedOn===Qe&&(ut.blockedOn=null)}}for(Fo!==null&&Ka(Fo,Qe),Bo!==null&&Ka(Bo,Qe),Uo!==null&&Ka(Uo,Qe),ja.forEach(tt),Wa.forEach(tt),st=0;st<Go.length;st++)ut=Go[st],ut.blockedOn===Qe&&(ut.blockedOn=null);for(;0<Go.length&&(st=Go[0],st.blockedOn===null);)Rh(st),st.blockedOn===null&&Go.shift()}var Ea=mt.ReactCurrentBatchConfig,$l=!0;function yp(Qe,tt,st,ut){var pt=ys,_r=Ea.transition;Ea.transition=null;try{ys=1,Bc(Qe,tt,st,ut)}finally{ys=pt,Ea.transition=_r}}function vp(Qe,tt,st,ut){var pt=ys,_r=Ea.transition;Ea.transition=null;try{ys=4,Bc(Qe,tt,st,ut)}finally{ys=pt,Ea.transition=_r}}function Bc(Qe,tt,st,ut){if($l){var pt=Uc(Qe,tt,st,ut);if(pt===null)nu(Qe,tt,ut,Dl,st),Ch(Qe,ut);else if(gp(pt,Qe,tt,st,ut))ut.stopPropagation();else if(Ch(Qe,ut),tt&4&&-1<pp.indexOf(Qe)){for(;pt!==null;){var _r=al(pt);if(_r!==null&&Sh(_r),_r=Uc(Qe,tt,st,ut),_r===null&&nu(Qe,tt,ut,Dl,st),_r===pt)break;pt=_r}pt!==null&&ut.stopPropagation()}else nu(Qe,tt,ut,null,st)}}var Dl=null;function Uc(Qe,tt,st,ut){if(Dl=null,Qe=$i(ut),Qe=oa(Qe),Qe!==null)if(tt=sa(Qe),tt===null)Qe=null;else if(st=tt.tag,st===13){if(Qe=dh(tt),Qe!==null)return Qe;Qe=null}else if(st===3){if(tt.stateNode.current.memoizedState.isDehydrated)return tt.tag===3?tt.stateNode.containerInfo:null;Qe=null}else tt!==Qe&&(Qe=null);return Dl=Qe,null}function Ih(Qe){switch(Qe){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(sp()){case Dc:return 1;case vh:return 4;case wl:case op:return 16;case Eh:return 536870912;default:return 16}default:return 16}}var Ho=null,Gc=null,Ol=null;function Ph(){if(Ol)return Ol;var Qe,tt=Gc,st=tt.length,ut,pt="value"in Ho?Ho.value:Ho.textContent,_r=pt.length;for(Qe=0;Qe<st&&tt[Qe]===pt[Qe];Qe++);var ti=st-Qe;for(ut=1;ut<=ti&&tt[st-ut]===pt[_r-ut];ut++);return Ol=pt.slice(Qe,1<ut?1-ut:void 0)}function Ml(Qe){var tt=Qe.keyCode;return"charCode"in Qe?(Qe=Qe.charCode,Qe===0&&tt===13&&(Qe=13)):Qe=tt,Qe===10&&(Qe=13),32<=Qe||Qe===13?Qe:0}function kl(){return!0}function Lh(){return!1}function to(Qe){function tt(st,ut,pt,_r,ti){this._reactName=st,this._targetInst=pt,this.type=ut,this.nativeEvent=_r,this.target=ti,this.currentTarget=null;for(var fi in Qe)Qe.hasOwnProperty(fi)&&(st=Qe[fi],this[fi]=st?st(_r):_r[fi]);return this.isDefaultPrevented=(_r.defaultPrevented!=null?_r.defaultPrevented:_r.returnValue===!1)?kl:Lh,this.isPropagationStopped=Lh,this}return si(tt.prototype,{preventDefault:function(){this.defaultPrevented=!0;var st=this.nativeEvent;st&&(st.preventDefault?st.preventDefault():typeof st.returnValue!="unknown"&&(st.returnValue=!1),this.isDefaultPrevented=kl)},stopPropagation:function(){var st=this.nativeEvent;st&&(st.stopPropagation?st.stopPropagation():typeof st.cancelBubble!="unknown"&&(st.cancelBubble=!0),this.isPropagationStopped=kl)},persist:function(){},isPersistent:kl}),tt}var Ta={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(Qe){return Qe.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Hc=to(Ta),Xa=si({},Ta,{view:0,detail:0}),Ep=to(Xa),Vc,zc,Qa,Nl=si({},Xa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Wc,button:0,buttons:0,relatedTarget:function(Qe){return Qe.relatedTarget===void 0?Qe.fromElement===Qe.srcElement?Qe.toElement:Qe.fromElement:Qe.relatedTarget},movementX:function(Qe){return"movementX"in Qe?Qe.movementX:(Qe!==Qa&&(Qa&&Qe.type==="mousemove"?(Vc=Qe.screenX-Qa.screenX,zc=Qe.screenY-Qa.screenY):zc=Vc=0,Qa=Qe),Vc)},movementY:function(Qe){return"movementY"in Qe?Qe.movementY:zc}}),$h=to(Nl),Tp=si({},Nl,{dataTransfer:0}),bp=to(Tp),Sp=si({},Xa,{relatedTarget:0}),jc=to(Sp),xp=si({},Ta,{animationName:0,elapsedTime:0,pseudoElement:0}),_p=to(xp),wp=si({},Ta,{clipboardData:function(Qe){return"clipboardData"in Qe?Qe.clipboardData:window.clipboardData}}),Cp=to(wp),Rp=si({},Ta,{data:0}),Dh=to(Rp),Ap={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ip={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Pp={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Lp(Qe){var tt=this.nativeEvent;return tt.getModifierState?tt.getModifierState(Qe):(Qe=Pp[Qe])?!!tt[Qe]:!1}function Wc(){return Lp}var $p=si({},Xa,{key:function(Qe){if(Qe.key){var tt=Ap[Qe.key]||Qe.key;if(tt!=="Unidentified")return tt}return Qe.type==="keypress"?(Qe=Ml(Qe),Qe===13?"Enter":String.fromCharCode(Qe)):Qe.type==="keydown"||Qe.type==="keyup"?Ip[Qe.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Wc,charCode:function(Qe){return Qe.type==="keypress"?Ml(Qe):0},keyCode:function(Qe){return Qe.type==="keydown"||Qe.type==="keyup"?Qe.keyCode:0},which:function(Qe){return Qe.type==="keypress"?Ml(Qe):Qe.type==="keydown"||Qe.type==="keyup"?Qe.keyCode:0}}),Dp=to($p),Op=si({},Nl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Oh=to(Op),Mp=si({},Xa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Wc}),kp=to(Mp),Np=si({},Ta,{propertyName:0,elapsedTime:0,pseudoElement:0}),Fp=to(Np),Bp=si({},Nl,{deltaX:function(Qe){return"deltaX"in Qe?Qe.deltaX:"wheelDeltaX"in Qe?-Qe.wheelDeltaX:0},deltaY:function(Qe){return"deltaY"in Qe?Qe.deltaY:"wheelDeltaY"in Qe?-Qe.wheelDeltaY:"wheelDelta"in Qe?-Qe.wheelDelta:0},deltaZ:0,deltaMode:0}),Up=to(Bp),Gp=[9,13,27,32],Yc=Ye&&"CompositionEvent"in window,Ja=null;Ye&&"documentMode"in document&&(Ja=document.documentMode);var Hp=Ye&&"TextEvent"in window&&!Ja,Mh=Ye&&(!Yc||Ja&&8<Ja&&11>=Ja),kh=" ",Nh=!1;function Fh(Qe,tt){switch(Qe){case"keyup":return Gp.indexOf(tt.keyCode)!==-1;case"keydown":return tt.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Bh(Qe){return Qe=Qe.detail,typeof Qe=="object"&&"data"in Qe?Qe.data:null}var ba=!1;function Vp(Qe,tt){switch(Qe){case"compositionend":return Bh(tt);case"keypress":return tt.which!==32?null:(Nh=!0,kh);case"textInput":return Qe=tt.data,Qe===kh&&Nh?null:Qe;default:return null}}function zp(Qe,tt){if(ba)return Qe==="compositionend"||!Yc&&Fh(Qe,tt)?(Qe=Ph(),Ol=Gc=Ho=null,ba=!1,Qe):null;switch(Qe){case"paste":return null;case"keypress":if(!(tt.ctrlKey||tt.altKey||tt.metaKey)||tt.ctrlKey&&tt.altKey){if(tt.char&&1<tt.char.length)return tt.char;if(tt.which)return String.fromCharCode(tt.which)}return null;case"compositionend":return Mh&&tt.locale!=="ko"?null:tt.data;default:return null}}var jp={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Uh(Qe){var tt=Qe&&Qe.nodeName&&Qe.nodeName.toLowerCase();return tt==="input"?!!jp[Qe.type]:tt==="textarea"}function Gh(Qe,tt,st,ut){Qi(ut),tt=Hl(tt,"onChange"),0<tt.length&&(st=new Hc("onChange","change",null,st,ut),Qe.push({event:st,listeners:tt}))}var Za=null,el=null;function Wp(Qe){od(Qe,0)}function Fl(Qe){var tt=Ra(Qe);if(hs(tt))return Qe}function Yp(Qe,tt){if(Qe==="change")return tt}var Hh=!1;if(Ye){var Kc;if(Ye){var qc="oninput"in document;if(!qc){var Vh=document.createElement("div");Vh.setAttribute("oninput","return;"),qc=typeof Vh.oninput=="function"}Kc=qc}else Kc=!1;Hh=Kc&&(!document.documentMode||9<document.documentMode)}function zh(){Za&&(Za.detachEvent("onpropertychange",jh),el=Za=null)}function jh(Qe){if(Qe.propertyName==="value"&&Fl(el)){var tt=[];Gh(tt,el,Qe,$i(Qe)),eo(Wp,tt)}}function Kp(Qe,tt,st){Qe==="focusin"?(zh(),Za=tt,el=st,Za.attachEvent("onpropertychange",jh)):Qe==="focusout"&&zh()}function qp(Qe){if(Qe==="selectionchange"||Qe==="keyup"||Qe==="keydown")return Fl(el)}function Xp(Qe,tt){if(Qe==="click")return Fl(tt)}function Qp(Qe,tt){if(Qe==="input"||Qe==="change")return Fl(tt)}function Jp(Qe,tt){return Qe===tt&&(Qe!==0||1/Qe===1/tt)||Qe!==Qe&&tt!==tt}var vo=typeof Object.is=="function"?Object.is:Jp;function tl(Qe,tt){if(vo(Qe,tt))return!0;if(typeof Qe!="object"||Qe===null||typeof tt!="object"||tt===null)return!1;var st=Object.keys(Qe),ut=Object.keys(tt);if(st.length!==ut.length)return!1;for(ut=0;ut<st.length;ut++){var pt=st[ut];if(!Ke.call(tt,pt)||!vo(Qe[pt],tt[pt]))return!1}return!0}function Wh(Qe){for(;Qe&&Qe.firstChild;)Qe=Qe.firstChild;return Qe}function Yh(Qe,tt){var st=Wh(Qe);Qe=0;for(var ut;st;){if(st.nodeType===3){if(ut=Qe+st.textContent.length,Qe<=tt&&ut>=tt)return{node:st,offset:tt-Qe};Qe=ut}e:{for(;st;){if(st.nextSibling){st=st.nextSibling;break e}st=st.parentNode}st=void 0}st=Wh(st)}}function Kh(Qe,tt){return Qe&&tt?Qe===tt?!0:Qe&&Qe.nodeType===3?!1:tt&&tt.nodeType===3?Kh(Qe,tt.parentNode):"contains"in Qe?Qe.contains(tt):Qe.compareDocumentPosition?!!(Qe.compareDocumentPosition(tt)&16):!1:!1}function qh(){for(var Qe=window,tt=Kr();tt instanceof Qe.HTMLIFrameElement;){try{var st=typeof tt.contentWindow.location.href=="string"}catch{st=!1}if(st)Qe=tt.contentWindow;else break;tt=Kr(Qe.document)}return tt}function Xc(Qe){var tt=Qe&&Qe.nodeName&&Qe.nodeName.toLowerCase();return tt&&(tt==="input"&&(Qe.type==="text"||Qe.type==="search"||Qe.type==="tel"||Qe.type==="url"||Qe.type==="password")||tt==="textarea"||Qe.contentEditable==="true")}function Zp(Qe){var tt=qh(),st=Qe.focusedElem,ut=Qe.selectionRange;if(tt!==st&&st&&st.ownerDocument&&Kh(st.ownerDocument.documentElement,st)){if(ut!==null&&Xc(st)){if(tt=ut.start,Qe=ut.end,Qe===void 0&&(Qe=tt),"selectionStart"in st)st.selectionStart=tt,st.selectionEnd=Math.min(Qe,st.value.length);else if(Qe=(tt=st.ownerDocument||document)&&tt.defaultView||window,Qe.getSelection){Qe=Qe.getSelection();var pt=st.textContent.length,_r=Math.min(ut.start,pt);ut=ut.end===void 0?_r:Math.min(ut.end,pt),!Qe.extend&&_r>ut&&(pt=ut,ut=_r,_r=pt),pt=Yh(st,_r);var ti=Yh(st,ut);pt&&ti&&(Qe.rangeCount!==1||Qe.anchorNode!==pt.node||Qe.anchorOffset!==pt.offset||Qe.focusNode!==ti.node||Qe.focusOffset!==ti.offset)&&(tt=tt.createRange(),tt.setStart(pt.node,pt.offset),Qe.removeAllRanges(),_r>ut?(Qe.addRange(tt),Qe.extend(ti.node,ti.offset)):(tt.setEnd(ti.node,ti.offset),Qe.addRange(tt)))}}for(tt=[],Qe=st;Qe=Qe.parentNode;)Qe.nodeType===1&&tt.push({element:Qe,left:Qe.scrollLeft,top:Qe.scrollTop});for(typeof st.focus=="function"&&st.focus(),st=0;st<tt.length;st++)Qe=tt[st],Qe.element.scrollLeft=Qe.left,Qe.element.scrollTop=Qe.top}}var eg=Ye&&"documentMode"in document&&11>=document.documentMode,Sa=null,Qc=null,rl=null,Jc=!1;function Xh(Qe,tt,st){var ut=st.window===st?st.document:st.nodeType===9?st:st.ownerDocument;Jc||Sa==null||Sa!==Kr(ut)||(ut=Sa,"selectionStart"in ut&&Xc(ut)?ut={start:ut.selectionStart,end:ut.selectionEnd}:(ut=(ut.ownerDocument&&ut.ownerDocument.defaultView||window).getSelection(),ut={anchorNode:ut.anchorNode,anchorOffset:ut.anchorOffset,focusNode:ut.focusNode,focusOffset:ut.focusOffset}),rl&&tl(rl,ut)||(rl=ut,ut=Hl(Qc,"onSelect"),0<ut.length&&(tt=new Hc("onSelect","select",null,tt,st),Qe.push({event:tt,listeners:ut}),tt.target=Sa)))}function Bl(Qe,tt){var st={};return st[Qe.toLowerCase()]=tt.toLowerCase(),st["Webkit"+Qe]="webkit"+tt,st["Moz"+Qe]="moz"+tt,st}var xa={animationend:Bl("Animation","AnimationEnd"),animationiteration:Bl("Animation","AnimationIteration"),animationstart:Bl("Animation","AnimationStart"),transitionend:Bl("Transition","TransitionEnd")},Zc={},Qh={};Ye&&(Qh=document.createElement("div").style,"AnimationEvent"in window||(delete xa.animationend.animation,delete xa.animationiteration.animation,delete xa.animationstart.animation),"TransitionEvent"in window||delete xa.transitionend.transition);function Ul(Qe){if(Zc[Qe])return Zc[Qe];if(!xa[Qe])return Qe;var tt=xa[Qe],st;for(st in tt)if(tt.hasOwnProperty(st)&&st in Qh)return Zc[Qe]=tt[st];return Qe}var Jh=Ul("animationend"),Zh=Ul("animationiteration"),ed=Ul("animationstart"),rd=Ul("transitionend"),nd=new Map,id="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Vo(Qe,tt){nd.set(Qe,tt),ve(tt,[Qe])}for(var eu=0;eu<id.length;eu++){var tu=id[eu],tg=tu.toLowerCase(),rg=tu[0].toUpperCase()+tu.slice(1);Vo(tg,"on"+rg)}Vo(Jh,"onAnimationEnd"),Vo(Zh,"onAnimationIteration"),Vo(ed,"onAnimationStart"),Vo("dblclick","onDoubleClick"),Vo("focusin","onFocus"),Vo("focusout","onBlur"),Vo(rd,"onTransitionEnd"),be("onMouseEnter",["mouseout","mouseover"]),be("onMouseLeave",["mouseout","mouseover"]),be("onPointerEnter",["pointerout","pointerover"]),be("onPointerLeave",["pointerout","pointerover"]),ve("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ve("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ve("onBeforeInput",["compositionend","keypress","textInput","paste"]),ve("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ve("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ve("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var nl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ng=new Set("cancel close invalid load scroll toggle".split(" ").concat(nl));function sd(Qe,tt,st){var ut=Qe.type||"unknown-event";Qe.currentTarget=st,tp(ut,tt,void 0,Qe),Qe.currentTarget=null}function od(Qe,tt){tt=(tt&4)!==0;for(var st=0;st<Qe.length;st++){var ut=Qe[st],pt=ut.event;ut=ut.listeners;e:{var _r=void 0;if(tt)for(var ti=ut.length-1;0<=ti;ti--){var fi=ut[ti],vi=fi.instance,_i=fi.currentTarget;if(fi=fi.listener,vi!==_r&&pt.isPropagationStopped())break e;sd(pt,fi,_i),_r=vi}else for(ti=0;ti<ut.length;ti++){if(fi=ut[ti],vi=fi.instance,_i=fi.currentTarget,fi=fi.listener,vi!==_r&&pt.isPropagationStopped())break e;sd(pt,fi,_i),_r=vi}}}if(_l)throw Qe=$c,_l=!1,$c=null,Qe}function bs(Qe,tt){var st=tt[cu];st===void 0&&(st=tt[cu]=new Set);var ut=Qe+"__bubble";st.has(ut)||(ad(tt,Qe,2,!1),st.add(ut))}function ru(Qe,tt,st){var ut=0;tt&&(ut|=4),ad(st,Qe,ut,tt)}var Gl="_reactListening"+Math.random().toString(36).slice(2);function il(Qe){if(!Qe[Gl]){Qe[Gl]=!0,ae.forEach(function(st){st!=="selectionchange"&&(ng.has(st)||ru(st,!1,Qe),ru(st,!0,Qe))});var tt=Qe.nodeType===9?Qe:Qe.ownerDocument;tt===null||tt[Gl]||(tt[Gl]=!0,ru("selectionchange",!1,tt))}}function ad(Qe,tt,st,ut){switch(Ih(tt)){case 1:var pt=yp;break;case 4:pt=vp;break;default:pt=Bc}st=pt.bind(null,tt,st,Qe),pt=void 0,!Ps||tt!=="touchstart"&&tt!=="touchmove"&&tt!=="wheel"||(pt=!0),ut?pt!==void 0?Qe.addEventListener(tt,st,{capture:!0,passive:pt}):Qe.addEventListener(tt,st,!0):pt!==void 0?Qe.addEventListener(tt,st,{passive:pt}):Qe.addEventListener(tt,st,!1)}function nu(Qe,tt,st,ut,pt){var _r=ut;if(!(tt&1)&&!(tt&2)&&ut!==null)e:for(;;){if(ut===null)return;var ti=ut.tag;if(ti===3||ti===4){var fi=ut.stateNode.containerInfo;if(fi===pt||fi.nodeType===8&&fi.parentNode===pt)break;if(ti===4)for(ti=ut.return;ti!==null;){var vi=ti.tag;if((vi===3||vi===4)&&(vi=ti.stateNode.containerInfo,vi===pt||vi.nodeType===8&&vi.parentNode===pt))return;ti=ti.return}for(;fi!==null;){if(ti=oa(fi),ti===null)return;if(vi=ti.tag,vi===5||vi===6){ut=_r=ti;continue e}fi=fi.parentNode}}ut=ut.return}eo(function(){var _i=_r,Li=$i(st),Oi=[];e:{var Pi=nd.get(Qe);if(Pi!==void 0){var Hi=Hc,ji=Qe;switch(Qe){case"keypress":if(Ml(st)===0)break e;case"keydown":case"keyup":Hi=Dp;break;case"focusin":ji="focus",Hi=jc;break;case"focusout":ji="blur",Hi=jc;break;case"beforeblur":case"afterblur":Hi=jc;break;case"click":if(st.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Hi=$h;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Hi=bp;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Hi=kp;break;case Jh:case Zh:case ed:Hi=_p;break;case rd:Hi=Fp;break;case"scroll":Hi=Ep;break;case"wheel":Hi=Up;break;case"copy":case"cut":case"paste":Hi=Cp;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Hi=Oh}var Wi=(tt&4)!==0,Is=!Wi&&Qe==="scroll",bi=Wi?Pi!==null?Pi+"Capture":null:Pi;Wi=[];for(var Ti=_i,xi;Ti!==null;){xi=Ti;var Fi=xi.stateNode;if(xi.tag===5&&Fi!==null&&(xi=Fi,bi!==null&&(Fi=Ys(Ti,bi),Fi!=null&&Wi.push(sl(Ti,Fi,xi)))),Is)break;Ti=Ti.return}0<Wi.length&&(Pi=new Hi(Pi,ji,null,st,Li),Oi.push({event:Pi,listeners:Wi}))}}if(!(tt&7)){e:{if(Pi=Qe==="mouseover"||Qe==="pointerover",Hi=Qe==="mouseout"||Qe==="pointerout",Pi&&st!==gi&&(ji=st.relatedTarget||st.fromElement)&&(oa(ji)||ji[Io]))break e;if((Hi||Pi)&&(Pi=Li.window===Li?Li:(Pi=Li.ownerDocument)?Pi.defaultView||Pi.parentWindow:window,Hi?(ji=st.relatedTarget||st.toElement,Hi=_i,ji=ji?oa(ji):null,ji!==null&&(Is=sa(ji),ji!==Is||ji.tag!==5&&ji.tag!==6)&&(ji=null)):(Hi=null,ji=_i),Hi!==ji)){if(Wi=$h,Fi="onMouseLeave",bi="onMouseEnter",Ti="mouse",(Qe==="pointerout"||Qe==="pointerover")&&(Wi=Oh,Fi="onPointerLeave",bi="onPointerEnter",Ti="pointer"),Is=Hi==null?Pi:Ra(Hi),xi=ji==null?Pi:Ra(ji),Pi=new Wi(Fi,Ti+"leave",Hi,st,Li),Pi.target=Is,Pi.relatedTarget=xi,Fi=null,oa(Li)===_i&&(Wi=new Wi(bi,Ti+"enter",ji,st,Li),Wi.target=xi,Wi.relatedTarget=Is,Fi=Wi),Is=Fi,Hi&&ji)t:{for(Wi=Hi,bi=ji,Ti=0,xi=Wi;xi;xi=wa(xi))Ti++;for(xi=0,Fi=bi;Fi;Fi=wa(Fi))xi++;for(;0<Ti-xi;)Wi=wa(Wi),Ti--;for(;0<xi-Ti;)bi=wa(bi),xi--;for(;Ti--;){if(Wi===bi||bi!==null&&Wi===bi.alternate)break t;Wi=wa(Wi),bi=wa(bi)}Wi=null}else Wi=null;Hi!==null&&ld(Oi,Pi,Hi,Wi,!1),ji!==null&&Is!==null&&ld(Oi,Is,ji,Wi,!0)}}e:{if(Pi=_i?Ra(_i):window,Hi=Pi.nodeName&&Pi.nodeName.toLowerCase(),Hi==="select"||Hi==="input"&&Pi.type==="file")var qi=Yp;else if(Uh(Pi))if(Hh)qi=Qp;else{qi=qp;var ts=Kp}else(Hi=Pi.nodeName)&&Hi.toLowerCase()==="input"&&(Pi.type==="checkbox"||Pi.type==="radio")&&(qi=Xp);if(qi&&(qi=qi(Qe,_i))){Gh(Oi,qi,st,Li);break e}ts&&ts(Qe,Pi,_i),Qe==="focusout"&&(ts=Pi._wrapperState)&&ts.controlled&&Pi.type==="number"&&Gi(Pi,"number",Pi.value)}switch(ts=_i?Ra(_i):window,Qe){case"focusin":(Uh(ts)||ts.contentEditable==="true")&&(Sa=ts,Qc=_i,rl=null);break;case"focusout":rl=Qc=Sa=null;break;case"mousedown":Jc=!0;break;case"contextmenu":case"mouseup":case"dragend":Jc=!1,Xh(Oi,st,Li);break;case"selectionchange":if(eg)break;case"keydown":case"keyup":Xh(Oi,st,Li)}var rs;if(Yc)e:{switch(Qe){case"compositionstart":var os="onCompositionStart";break e;case"compositionend":os="onCompositionEnd";break e;case"compositionupdate":os="onCompositionUpdate";break e}os=void 0}else ba?Fh(Qe,st)&&(os="onCompositionEnd"):Qe==="keydown"&&st.keyCode===229&&(os="onCompositionStart");os&&(Mh&&st.locale!=="ko"&&(ba||os!=="onCompositionStart"?os==="onCompositionEnd"&&ba&&(rs=Ph()):(Ho=Li,Gc="value"in Ho?Ho.value:Ho.textContent,ba=!0)),ts=Hl(_i,os),0<ts.length&&(os=new Dh(os,Qe,null,st,Li),Oi.push({event:os,listeners:ts}),rs?os.data=rs:(rs=Bh(st),rs!==null&&(os.data=rs)))),(rs=Hp?Vp(Qe,st):zp(Qe,st))&&(_i=Hl(_i,"onBeforeInput"),0<_i.length&&(Li=new Dh("onBeforeInput","beforeinput",null,st,Li),Oi.push({event:Li,listeners:_i}),Li.data=rs))}od(Oi,tt)})}function sl(Qe,tt,st){return{instance:Qe,listener:tt,currentTarget:st}}function Hl(Qe,tt){for(var st=tt+"Capture",ut=[];Qe!==null;){var pt=Qe,_r=pt.stateNode;pt.tag===5&&_r!==null&&(pt=_r,_r=Ys(Qe,st),_r!=null&&ut.unshift(sl(Qe,_r,pt)),_r=Ys(Qe,tt),_r!=null&&ut.push(sl(Qe,_r,pt))),Qe=Qe.return}return ut}function wa(Qe){if(Qe===null)return null;do Qe=Qe.return;while(Qe&&Qe.tag!==5);return Qe||null}function ld(Qe,tt,st,ut,pt){for(var _r=tt._reactName,ti=[];st!==null&&st!==ut;){var fi=st,vi=fi.alternate,_i=fi.stateNode;if(vi!==null&&vi===ut)break;fi.tag===5&&_i!==null&&(fi=_i,pt?(vi=Ys(st,_r),vi!=null&&ti.unshift(sl(st,vi,fi))):pt||(vi=Ys(st,_r),vi!=null&&ti.push(sl(st,vi,fi)))),st=st.return}ti.length!==0&&Qe.push({event:tt,listeners:ti})}var ig=/\r\n?/g,sg=/\u0000|\uFFFD/g;function cd(Qe){return(typeof Qe=="string"?Qe:""+Qe).replace(ig,`
`).replace(sg,"")}function Vl(Qe,tt,st){if(tt=cd(tt),cd(Qe)!==tt&&st)throw Error(ee(425))}function zl(){}var iu=null,su=null;function ou(Qe,tt){return Qe==="textarea"||Qe==="noscript"||typeof tt.children=="string"||typeof tt.children=="number"||typeof tt.dangerouslySetInnerHTML=="object"&&tt.dangerouslySetInnerHTML!==null&&tt.dangerouslySetInnerHTML.__html!=null}var au=typeof setTimeout=="function"?setTimeout:void 0,og=typeof clearTimeout=="function"?clearTimeout:void 0,ud=typeof Promise=="function"?Promise:void 0,ag=typeof queueMicrotask=="function"?queueMicrotask:typeof ud<"u"?function(Qe){return ud.resolve(null).then(Qe).catch(lg)}:au;function lg(Qe){setTimeout(function(){throw Qe})}function lu(Qe,tt){var st=tt,ut=0;do{var pt=st.nextSibling;if(Qe.removeChild(st),pt&&pt.nodeType===8)if(st=pt.data,st==="/$"){if(ut===0){Qe.removeChild(pt),qa(tt);return}ut--}else st!=="$"&&st!=="$?"&&st!=="$!"||ut++;st=pt}while(st);qa(tt)}function zo(Qe){for(;Qe!=null;Qe=Qe.nextSibling){var tt=Qe.nodeType;if(tt===1||tt===3)break;if(tt===8){if(tt=Qe.data,tt==="$"||tt==="$!"||tt==="$?")break;if(tt==="/$")return null}}return Qe}function hd(Qe){Qe=Qe.previousSibling;for(var tt=0;Qe;){if(Qe.nodeType===8){var st=Qe.data;if(st==="$"||st==="$!"||st==="$?"){if(tt===0)return Qe;tt--}else st==="/$"&&tt++}Qe=Qe.previousSibling}return null}var Ca=Math.random().toString(36).slice(2),wo="__reactFiber$"+Ca,ol="__reactProps$"+Ca,Io="__reactContainer$"+Ca,cu="__reactEvents$"+Ca,cg="__reactListeners$"+Ca,ug="__reactHandles$"+Ca;function oa(Qe){var tt=Qe[wo];if(tt)return tt;for(var st=Qe.parentNode;st;){if(tt=st[Io]||st[wo]){if(st=tt.alternate,tt.child!==null||st!==null&&st.child!==null)for(Qe=hd(Qe);Qe!==null;){if(st=Qe[wo])return st;Qe=hd(Qe)}return tt}Qe=st,st=Qe.parentNode}return null}function al(Qe){return Qe=Qe[wo]||Qe[Io],!Qe||Qe.tag!==5&&Qe.tag!==6&&Qe.tag!==13&&Qe.tag!==3?null:Qe}function Ra(Qe){if(Qe.tag===5||Qe.tag===6)return Qe.stateNode;throw Error(ee(33))}function jl(Qe){return Qe[ol]||null}var uu=[],Aa=-1;function jo(Qe){return{current:Qe}}function Ss(Qe){0>Aa||(Qe.current=uu[Aa],uu[Aa]=null,Aa--)}function Es(Qe,tt){Aa++,uu[Aa]=Qe.current,Qe.current=tt}var Wo={},Us=jo(Wo),Ks=jo(!1),aa=Wo;function Ia(Qe,tt){var st=Qe.type.contextTypes;if(!st)return Wo;var ut=Qe.stateNode;if(ut&&ut.__reactInternalMemoizedUnmaskedChildContext===tt)return ut.__reactInternalMemoizedMaskedChildContext;var pt={},_r;for(_r in st)pt[_r]=tt[_r];return ut&&(Qe=Qe.stateNode,Qe.__reactInternalMemoizedUnmaskedChildContext=tt,Qe.__reactInternalMemoizedMaskedChildContext=pt),pt}function qs(Qe){return Qe=Qe.childContextTypes,Qe!=null}function Wl(){Ss(Ks),Ss(Us)}function dd(Qe,tt,st){if(Us.current!==Wo)throw Error(ee(168));Es(Us,tt),Es(Ks,st)}function pd(Qe,tt,st){var ut=Qe.stateNode;if(tt=tt.childContextTypes,typeof ut.getChildContext!="function")return st;ut=ut.getChildContext();for(var pt in ut)if(!(pt in tt))throw Error(ee(108,Ai(Qe)||"Unknown",pt));return si({},st,ut)}function Yl(Qe){return Qe=(Qe=Qe.stateNode)&&Qe.__reactInternalMemoizedMergedChildContext||Wo,aa=Us.current,Es(Us,Qe),Es(Ks,Ks.current),!0}function gd(Qe,tt,st){var ut=Qe.stateNode;if(!ut)throw Error(ee(169));st?(Qe=pd(Qe,tt,aa),ut.__reactInternalMemoizedMergedChildContext=Qe,Ss(Ks),Ss(Us),Es(Us,Qe)):Ss(Ks),Es(Ks,st)}var Po=null,Kl=!1,hu=!1;function md(Qe){Po===null?Po=[Qe]:Po.push(Qe)}function hg(Qe){Kl=!0,md(Qe)}function Yo(){if(!hu&&Po!==null){hu=!0;var Qe=0,tt=ys;try{var st=Po;for(ys=1;Qe<st.length;Qe++){var ut=st[Qe];do ut=ut(!0);while(ut!==null)}Po=null,Kl=!1}catch(pt){throw Po!==null&&(Po=Po.slice(Qe+1)),mh(Dc,Yo),pt}finally{ys=tt,hu=!1}}return null}var Pa=[],La=0,ql=null,Xl=0,lo=[],co=0,la=null,Lo=1,$o="";function ca(Qe,tt){Pa[La++]=Xl,Pa[La++]=ql,ql=Qe,Xl=tt}function yd(Qe,tt,st){lo[co++]=Lo,lo[co++]=$o,lo[co++]=la,la=Qe;var ut=Lo;Qe=$o;var pt=32-yo(ut)-1;ut&=~(1<<pt),st+=1;var _r=32-yo(tt)+pt;if(30<_r){var ti=pt-pt%5;_r=(ut&(1<<ti)-1).toString(32),ut>>=ti,pt-=ti,Lo=1<<32-yo(tt)+pt|st<<pt|ut,$o=_r+Qe}else Lo=1<<_r|st<<pt|ut,$o=Qe}function du(Qe){Qe.return!==null&&(ca(Qe,1),yd(Qe,1,0))}function fu(Qe){for(;Qe===ql;)ql=Pa[--La],Pa[La]=null,Xl=Pa[--La],Pa[La]=null;for(;Qe===la;)la=lo[--co],lo[co]=null,$o=lo[--co],lo[co]=null,Lo=lo[--co],lo[co]=null}var no=null,io=null,xs=!1,Eo=null;function vd(Qe,tt){var st=po(5,null,null,0);st.elementType="DELETED",st.stateNode=tt,st.return=Qe,tt=Qe.deletions,tt===null?(Qe.deletions=[st],Qe.flags|=16):tt.push(st)}function Ed(Qe,tt){switch(Qe.tag){case 5:var st=Qe.type;return tt=tt.nodeType!==1||st.toLowerCase()!==tt.nodeName.toLowerCase()?null:tt,tt!==null?(Qe.stateNode=tt,no=Qe,io=zo(tt.firstChild),!0):!1;case 6:return tt=Qe.pendingProps===""||tt.nodeType!==3?null:tt,tt!==null?(Qe.stateNode=tt,no=Qe,io=null,!0):!1;case 13:return tt=tt.nodeType!==8?null:tt,tt!==null?(st=la!==null?{id:Lo,overflow:$o}:null,Qe.memoizedState={dehydrated:tt,treeContext:st,retryLane:1073741824},st=po(18,null,null,0),st.stateNode=tt,st.return=Qe,Qe.child=st,no=Qe,io=null,!0):!1;default:return!1}}function pu(Qe){return(Qe.mode&1)!==0&&(Qe.flags&128)===0}function gu(Qe){if(xs){var tt=io;if(tt){var st=tt;if(!Ed(Qe,tt)){if(pu(Qe))throw Error(ee(418));tt=zo(st.nextSibling);var ut=no;tt&&Ed(Qe,tt)?vd(ut,st):(Qe.flags=Qe.flags&-4097|2,xs=!1,no=Qe)}}else{if(pu(Qe))throw Error(ee(418));Qe.flags=Qe.flags&-4097|2,xs=!1,no=Qe}}}function Td(Qe){for(Qe=Qe.return;Qe!==null&&Qe.tag!==5&&Qe.tag!==3&&Qe.tag!==13;)Qe=Qe.return;no=Qe}function Ql(Qe){if(Qe!==no)return!1;if(!xs)return Td(Qe),xs=!0,!1;var tt;if((tt=Qe.tag!==3)&&!(tt=Qe.tag!==5)&&(tt=Qe.type,tt=tt!=="head"&&tt!=="body"&&!ou(Qe.type,Qe.memoizedProps)),tt&&(tt=io)){if(pu(Qe))throw bd(),Error(ee(418));for(;tt;)vd(Qe,tt),tt=zo(tt.nextSibling)}if(Td(Qe),Qe.tag===13){if(Qe=Qe.memoizedState,Qe=Qe!==null?Qe.dehydrated:null,!Qe)throw Error(ee(317));e:{for(Qe=Qe.nextSibling,tt=0;Qe;){if(Qe.nodeType===8){var st=Qe.data;if(st==="/$"){if(tt===0){io=zo(Qe.nextSibling);break e}tt--}else st!=="$"&&st!=="$!"&&st!=="$?"||tt++}Qe=Qe.nextSibling}io=null}}else io=no?zo(Qe.stateNode.nextSibling):null;return!0}function bd(){for(var Qe=io;Qe;)Qe=zo(Qe.nextSibling)}function $a(){io=no=null,xs=!1}function mu(Qe){Eo===null?Eo=[Qe]:Eo.push(Qe)}var dg=mt.ReactCurrentBatchConfig;function To(Qe,tt){if(Qe&&Qe.defaultProps){tt=si({},tt),Qe=Qe.defaultProps;for(var st in Qe)tt[st]===void 0&&(tt[st]=Qe[st]);return tt}return tt}var Jl=jo(null),Zl=null,Da=null,yu=null;function vu(){yu=Da=Zl=null}function Eu(Qe){var tt=Jl.current;Ss(Jl),Qe._currentValue=tt}function Tu(Qe,tt,st){for(;Qe!==null;){var ut=Qe.alternate;if((Qe.childLanes&tt)!==tt?(Qe.childLanes|=tt,ut!==null&&(ut.childLanes|=tt)):ut!==null&&(ut.childLanes&tt)!==tt&&(ut.childLanes|=tt),Qe===st)break;Qe=Qe.return}}function Oa(Qe,tt){Zl=Qe,yu=Da=null,Qe=Qe.dependencies,Qe!==null&&Qe.firstContext!==null&&(Qe.lanes&tt&&(Xs=!0),Qe.firstContext=null)}function uo(Qe){var tt=Qe._currentValue;if(yu!==Qe)if(Qe={context:Qe,memoizedValue:tt,next:null},Da===null){if(Zl===null)throw Error(ee(308));Da=Qe,Zl.dependencies={lanes:0,firstContext:Qe}}else Da=Da.next=Qe;return tt}var ha=null;function bu(Qe){ha===null?ha=[Qe]:ha.push(Qe)}function Sd(Qe,tt,st,ut){var pt=tt.interleaved;return pt===null?(st.next=st,bu(tt)):(st.next=pt.next,pt.next=st),tt.interleaved=st,Do(Qe,ut)}function Do(Qe,tt){Qe.lanes|=tt;var st=Qe.alternate;for(st!==null&&(st.lanes|=tt),st=Qe,Qe=Qe.return;Qe!==null;)Qe.childLanes|=tt,st=Qe.alternate,st!==null&&(st.childLanes|=tt),st=Qe,Qe=Qe.return;return st.tag===3?st.stateNode:null}var Ko=!1;function Su(Qe){Qe.updateQueue={baseState:Qe.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function xd(Qe,tt){Qe=Qe.updateQueue,tt.updateQueue===Qe&&(tt.updateQueue={baseState:Qe.baseState,firstBaseUpdate:Qe.firstBaseUpdate,lastBaseUpdate:Qe.lastBaseUpdate,shared:Qe.shared,effects:Qe.effects})}function Oo(Qe,tt){return{eventTime:Qe,lane:tt,tag:0,payload:null,callback:null,next:null}}function qo(Qe,tt,st){var ut=Qe.updateQueue;if(ut===null)return null;if(ut=ut.shared,ps&2){var pt=ut.pending;return pt===null?tt.next=tt:(tt.next=pt.next,pt.next=tt),ut.pending=tt,Do(Qe,st)}return pt=ut.interleaved,pt===null?(tt.next=tt,bu(ut)):(tt.next=pt.next,pt.next=tt),ut.interleaved=tt,Do(Qe,st)}function tc(Qe,tt,st){if(tt=tt.updateQueue,tt!==null&&(tt=tt.shared,(st&4194240)!==0)){var ut=tt.lanes;ut&=Qe.pendingLanes,st|=ut,tt.lanes=st,kc(Qe,st)}}function _d(Qe,tt){var st=Qe.updateQueue,ut=Qe.alternate;if(ut!==null&&(ut=ut.updateQueue,st===ut)){var pt=null,_r=null;if(st=st.firstBaseUpdate,st!==null){do{var ti={eventTime:st.eventTime,lane:st.lane,tag:st.tag,payload:st.payload,callback:st.callback,next:null};_r===null?pt=_r=ti:_r=_r.next=ti,st=st.next}while(st!==null);_r===null?pt=_r=tt:_r=_r.next=tt}else pt=_r=tt;st={baseState:ut.baseState,firstBaseUpdate:pt,lastBaseUpdate:_r,shared:ut.shared,effects:ut.effects},Qe.updateQueue=st;return}Qe=st.lastBaseUpdate,Qe===null?st.firstBaseUpdate=tt:Qe.next=tt,st.lastBaseUpdate=tt}function rc(Qe,tt,st,ut){var pt=Qe.updateQueue;Ko=!1;var _r=pt.firstBaseUpdate,ti=pt.lastBaseUpdate,fi=pt.shared.pending;if(fi!==null){pt.shared.pending=null;var vi=fi,_i=vi.next;vi.next=null,ti===null?_r=_i:ti.next=_i,ti=vi;var Li=Qe.alternate;Li!==null&&(Li=Li.updateQueue,fi=Li.lastBaseUpdate,fi!==ti&&(fi===null?Li.firstBaseUpdate=_i:fi.next=_i,Li.lastBaseUpdate=vi))}if(_r!==null){var Oi=pt.baseState;ti=0,Li=_i=vi=null,fi=_r;do{var Pi=fi.lane,Hi=fi.eventTime;if((ut&Pi)===Pi){Li!==null&&(Li=Li.next={eventTime:Hi,lane:0,tag:fi.tag,payload:fi.payload,callback:fi.callback,next:null});e:{var ji=Qe,Wi=fi;switch(Pi=tt,Hi=st,Wi.tag){case 1:if(ji=Wi.payload,typeof ji=="function"){Oi=ji.call(Hi,Oi,Pi);break e}Oi=ji;break e;case 3:ji.flags=ji.flags&-65537|128;case 0:if(ji=Wi.payload,Pi=typeof ji=="function"?ji.call(Hi,Oi,Pi):ji,Pi==null)break e;Oi=si({},Oi,Pi);break e;case 2:Ko=!0}}fi.callback!==null&&fi.lane!==0&&(Qe.flags|=64,Pi=pt.effects,Pi===null?pt.effects=[fi]:Pi.push(fi))}else Hi={eventTime:Hi,lane:Pi,tag:fi.tag,payload:fi.payload,callback:fi.callback,next:null},Li===null?(_i=Li=Hi,vi=Oi):Li=Li.next=Hi,ti|=Pi;if(fi=fi.next,fi===null){if(fi=pt.shared.pending,fi===null)break;Pi=fi,fi=Pi.next,Pi.next=null,pt.lastBaseUpdate=Pi,pt.shared.pending=null}}while(!0);if(Li===null&&(vi=Oi),pt.baseState=vi,pt.firstBaseUpdate=_i,pt.lastBaseUpdate=Li,tt=pt.shared.interleaved,tt!==null){pt=tt;do ti|=pt.lane,pt=pt.next;while(pt!==tt)}else _r===null&&(pt.shared.lanes=0);pa|=ti,Qe.lanes=ti,Qe.memoizedState=Oi}}function wd(Qe,tt,st){if(Qe=tt.effects,tt.effects=null,Qe!==null)for(tt=0;tt<Qe.length;tt++){var ut=Qe[tt],pt=ut.callback;if(pt!==null){if(ut.callback=null,ut=st,typeof pt!="function")throw Error(ee(191,pt));pt.call(ut)}}}var Cd=new ie.Component().refs;function xu(Qe,tt,st,ut){tt=Qe.memoizedState,st=st(ut,tt),st=st==null?tt:si({},tt,st),Qe.memoizedState=st,Qe.lanes===0&&(Qe.updateQueue.baseState=st)}var nc={isMounted:function(Qe){return(Qe=Qe._reactInternals)?sa(Qe)===Qe:!1},enqueueSetState:function(Qe,tt,st){Qe=Qe._reactInternals;var ut=Ws(),pt=Zo(Qe),_r=Oo(ut,pt);_r.payload=tt,st!=null&&(_r.callback=st),tt=qo(Qe,_r,pt),tt!==null&&(xo(tt,Qe,pt,ut),tc(tt,Qe,pt))},enqueueReplaceState:function(Qe,tt,st){Qe=Qe._reactInternals;var ut=Ws(),pt=Zo(Qe),_r=Oo(ut,pt);_r.tag=1,_r.payload=tt,st!=null&&(_r.callback=st),tt=qo(Qe,_r,pt),tt!==null&&(xo(tt,Qe,pt,ut),tc(tt,Qe,pt))},enqueueForceUpdate:function(Qe,tt){Qe=Qe._reactInternals;var st=Ws(),ut=Zo(Qe),pt=Oo(st,ut);pt.tag=2,tt!=null&&(pt.callback=tt),tt=qo(Qe,pt,ut),tt!==null&&(xo(tt,Qe,ut,st),tc(tt,Qe,ut))}};function Rd(Qe,tt,st,ut,pt,_r,ti){return Qe=Qe.stateNode,typeof Qe.shouldComponentUpdate=="function"?Qe.shouldComponentUpdate(ut,_r,ti):tt.prototype&&tt.prototype.isPureReactComponent?!tl(st,ut)||!tl(pt,_r):!0}function Ad(Qe,tt,st){var ut=!1,pt=Wo,_r=tt.contextType;return typeof _r=="object"&&_r!==null?_r=uo(_r):(pt=qs(tt)?aa:Us.current,ut=tt.contextTypes,_r=(ut=ut!=null)?Ia(Qe,pt):Wo),tt=new tt(st,_r),Qe.memoizedState=tt.state!==null&&tt.state!==void 0?tt.state:null,tt.updater=nc,Qe.stateNode=tt,tt._reactInternals=Qe,ut&&(Qe=Qe.stateNode,Qe.__reactInternalMemoizedUnmaskedChildContext=pt,Qe.__reactInternalMemoizedMaskedChildContext=_r),tt}function Id(Qe,tt,st,ut){Qe=tt.state,typeof tt.componentWillReceiveProps=="function"&&tt.componentWillReceiveProps(st,ut),typeof tt.UNSAFE_componentWillReceiveProps=="function"&&tt.UNSAFE_componentWillReceiveProps(st,ut),tt.state!==Qe&&nc.enqueueReplaceState(tt,tt.state,null)}function _u(Qe,tt,st,ut){var pt=Qe.stateNode;pt.props=st,pt.state=Qe.memoizedState,pt.refs=Cd,Su(Qe);var _r=tt.contextType;typeof _r=="object"&&_r!==null?pt.context=uo(_r):(_r=qs(tt)?aa:Us.current,pt.context=Ia(Qe,_r)),pt.state=Qe.memoizedState,_r=tt.getDerivedStateFromProps,typeof _r=="function"&&(xu(Qe,tt,_r,st),pt.state=Qe.memoizedState),typeof tt.getDerivedStateFromProps=="function"||typeof pt.getSnapshotBeforeUpdate=="function"||typeof pt.UNSAFE_componentWillMount!="function"&&typeof pt.componentWillMount!="function"||(tt=pt.state,typeof pt.componentWillMount=="function"&&pt.componentWillMount(),typeof pt.UNSAFE_componentWillMount=="function"&&pt.UNSAFE_componentWillMount(),tt!==pt.state&&nc.enqueueReplaceState(pt,pt.state,null),rc(Qe,st,pt,ut),pt.state=Qe.memoizedState),typeof pt.componentDidMount=="function"&&(Qe.flags|=4194308)}function ll(Qe,tt,st){if(Qe=st.ref,Qe!==null&&typeof Qe!="function"&&typeof Qe!="object"){if(st._owner){if(st=st._owner,st){if(st.tag!==1)throw Error(ee(309));var ut=st.stateNode}if(!ut)throw Error(ee(147,Qe));var pt=ut,_r=""+Qe;return tt!==null&&tt.ref!==null&&typeof tt.ref=="function"&&tt.ref._stringRef===_r?tt.ref:(tt=function(ti){var fi=pt.refs;fi===Cd&&(fi=pt.refs={}),ti===null?delete fi[_r]:fi[_r]=ti},tt._stringRef=_r,tt)}if(typeof Qe!="string")throw Error(ee(284));if(!st._owner)throw Error(ee(290,Qe))}return Qe}function ic(Qe,tt){throw Qe=Object.prototype.toString.call(tt),Error(ee(31,Qe==="[object Object]"?"object with keys {"+Object.keys(tt).join(", ")+"}":Qe))}function Pd(Qe){var tt=Qe._init;return tt(Qe._payload)}function Ld(Qe){function tt(bi,Ti){if(Qe){var xi=bi.deletions;xi===null?(bi.deletions=[Ti],bi.flags|=16):xi.push(Ti)}}function st(bi,Ti){if(!Qe)return null;for(;Ti!==null;)tt(bi,Ti),Ti=Ti.sibling;return null}function ut(bi,Ti){for(bi=new Map;Ti!==null;)Ti.key!==null?bi.set(Ti.key,Ti):bi.set(Ti.index,Ti),Ti=Ti.sibling;return bi}function pt(bi,Ti){return bi=ta(bi,Ti),bi.index=0,bi.sibling=null,bi}function _r(bi,Ti,xi){return bi.index=xi,Qe?(xi=bi.alternate,xi!==null?(xi=xi.index,xi<Ti?(bi.flags|=2,Ti):xi):(bi.flags|=2,Ti)):(bi.flags|=1048576,Ti)}function ti(bi){return Qe&&bi.alternate===null&&(bi.flags|=2),bi}function fi(bi,Ti,xi,Fi){return Ti===null||Ti.tag!==6?(Ti=oh(xi,bi.mode,Fi),Ti.return=bi,Ti):(Ti=pt(Ti,xi),Ti.return=bi,Ti)}function vi(bi,Ti,xi,Fi){var qi=xi.type;return qi===Xr?Li(bi,Ti,xi.props.children,Fi,xi.key):Ti!==null&&(Ti.elementType===qi||typeof qi=="object"&&qi!==null&&qi.$$typeof===hi&&Pd(qi)===Ti.type)?(Fi=pt(Ti,xi.props),Fi.ref=ll(bi,Ti,xi),Fi.return=bi,Fi):(Fi=_c(xi.type,xi.key,xi.props,null,bi.mode,Fi),Fi.ref=ll(bi,Ti,xi),Fi.return=bi,Fi)}function _i(bi,Ti,xi,Fi){return Ti===null||Ti.tag!==4||Ti.stateNode.containerInfo!==xi.containerInfo||Ti.stateNode.implementation!==xi.implementation?(Ti=ah(xi,bi.mode,Fi),Ti.return=bi,Ti):(Ti=pt(Ti,xi.children||[]),Ti.return=bi,Ti)}function Li(bi,Ti,xi,Fi,qi){return Ti===null||Ti.tag!==7?(Ti=va(xi,bi.mode,Fi,qi),Ti.return=bi,Ti):(Ti=pt(Ti,xi),Ti.return=bi,Ti)}function Oi(bi,Ti,xi){if(typeof Ti=="string"&&Ti!==""||typeof Ti=="number")return Ti=oh(""+Ti,bi.mode,xi),Ti.return=bi,Ti;if(typeof Ti=="object"&&Ti!==null){switch(Ti.$$typeof){case Yr:return xi=_c(Ti.type,Ti.key,Ti.props,null,bi.mode,xi),xi.ref=ll(bi,null,Ti),xi.return=bi,xi;case Qr:return Ti=ah(Ti,bi.mode,xi),Ti.return=bi,Ti;case hi:var Fi=Ti._init;return Oi(bi,Fi(Ti._payload),xi)}if(us(Ti)||Si(Ti))return Ti=va(Ti,bi.mode,xi,null),Ti.return=bi,Ti;ic(bi,Ti)}return null}function Pi(bi,Ti,xi,Fi){var qi=Ti!==null?Ti.key:null;if(typeof xi=="string"&&xi!==""||typeof xi=="number")return qi!==null?null:fi(bi,Ti,""+xi,Fi);if(typeof xi=="object"&&xi!==null){switch(xi.$$typeof){case Yr:return xi.key===qi?vi(bi,Ti,xi,Fi):null;case Qr:return xi.key===qi?_i(bi,Ti,xi,Fi):null;case hi:return qi=xi._init,Pi(bi,Ti,qi(xi._payload),Fi)}if(us(xi)||Si(xi))return qi!==null?null:Li(bi,Ti,xi,Fi,null);ic(bi,xi)}return null}function Hi(bi,Ti,xi,Fi,qi){if(typeof Fi=="string"&&Fi!==""||typeof Fi=="number")return bi=bi.get(xi)||null,fi(Ti,bi,""+Fi,qi);if(typeof Fi=="object"&&Fi!==null){switch(Fi.$$typeof){case Yr:return bi=bi.get(Fi.key===null?xi:Fi.key)||null,vi(Ti,bi,Fi,qi);case Qr:return bi=bi.get(Fi.key===null?xi:Fi.key)||null,_i(Ti,bi,Fi,qi);case hi:var ts=Fi._init;return Hi(bi,Ti,xi,ts(Fi._payload),qi)}if(us(Fi)||Si(Fi))return bi=bi.get(xi)||null,Li(Ti,bi,Fi,qi,null);ic(Ti,Fi)}return null}function ji(bi,Ti,xi,Fi){for(var qi=null,ts=null,rs=Ti,os=Ti=0,Ns=null;rs!==null&&os<xi.length;os++){rs.index>os?(Ns=rs,rs=null):Ns=rs.sibling;var gs=Pi(bi,rs,xi[os],Fi);if(gs===null){rs===null&&(rs=Ns);break}Qe&&rs&&gs.alternate===null&&tt(bi,rs),Ti=_r(gs,Ti,os),ts===null?qi=gs:ts.sibling=gs,ts=gs,rs=Ns}if(os===xi.length)return st(bi,rs),xs&&ca(bi,os),qi;if(rs===null){for(;os<xi.length;os++)rs=Oi(bi,xi[os],Fi),rs!==null&&(Ti=_r(rs,Ti,os),ts===null?qi=rs:ts.sibling=rs,ts=rs);return xs&&ca(bi,os),qi}for(rs=ut(bi,rs);os<xi.length;os++)Ns=Hi(rs,bi,os,xi[os],Fi),Ns!==null&&(Qe&&Ns.alternate!==null&&rs.delete(Ns.key===null?os:Ns.key),Ti=_r(Ns,Ti,os),ts===null?qi=Ns:ts.sibling=Ns,ts=Ns);return Qe&&rs.forEach(function(ra){return tt(bi,ra)}),xs&&ca(bi,os),qi}function Wi(bi,Ti,xi,Fi){var qi=Si(xi);if(typeof qi!="function")throw Error(ee(150));if(xi=qi.call(xi),xi==null)throw Error(ee(151));for(var ts=qi=null,rs=Ti,os=Ti=0,Ns=null,gs=xi.next();rs!==null&&!gs.done;os++,gs=xi.next()){rs.index>os?(Ns=rs,rs=null):Ns=rs.sibling;var ra=Pi(bi,rs,gs.value,Fi);if(ra===null){rs===null&&(rs=Ns);break}Qe&&rs&&ra.alternate===null&&tt(bi,rs),Ti=_r(ra,Ti,os),ts===null?qi=ra:ts.sibling=ra,ts=ra,rs=Ns}if(gs.done)return st(bi,rs),xs&&ca(bi,os),qi;if(rs===null){for(;!gs.done;os++,gs=xi.next())gs=Oi(bi,gs.value,Fi),gs!==null&&(Ti=_r(gs,Ti,os),ts===null?qi=gs:ts.sibling=gs,ts=gs);return xs&&ca(bi,os),qi}for(rs=ut(bi,rs);!gs.done;os++,gs=xi.next())gs=Hi(rs,bi,os,gs.value,Fi),gs!==null&&(Qe&&gs.alternate!==null&&rs.delete(gs.key===null?os:gs.key),Ti=_r(gs,Ti,os),ts===null?qi=gs:ts.sibling=gs,ts=gs);return Qe&&rs.forEach(function(jg){return tt(bi,jg)}),xs&&ca(bi,os),qi}function Is(bi,Ti,xi,Fi){if(typeof xi=="object"&&xi!==null&&xi.type===Xr&&xi.key===null&&(xi=xi.props.children),typeof xi=="object"&&xi!==null){switch(xi.$$typeof){case Yr:e:{for(var qi=xi.key,ts=Ti;ts!==null;){if(ts.key===qi){if(qi=xi.type,qi===Xr){if(ts.tag===7){st(bi,ts.sibling),Ti=pt(ts,xi.props.children),Ti.return=bi,bi=Ti;break e}}else if(ts.elementType===qi||typeof qi=="object"&&qi!==null&&qi.$$typeof===hi&&Pd(qi)===ts.type){st(bi,ts.sibling),Ti=pt(ts,xi.props),Ti.ref=ll(bi,ts,xi),Ti.return=bi,bi=Ti;break e}st(bi,ts);break}else tt(bi,ts);ts=ts.sibling}xi.type===Xr?(Ti=va(xi.props.children,bi.mode,Fi,xi.key),Ti.return=bi,bi=Ti):(Fi=_c(xi.type,xi.key,xi.props,null,bi.mode,Fi),Fi.ref=ll(bi,Ti,xi),Fi.return=bi,bi=Fi)}return ti(bi);case Qr:e:{for(ts=xi.key;Ti!==null;){if(Ti.key===ts)if(Ti.tag===4&&Ti.stateNode.containerInfo===xi.containerInfo&&Ti.stateNode.implementation===xi.implementation){st(bi,Ti.sibling),Ti=pt(Ti,xi.children||[]),Ti.return=bi,bi=Ti;break e}else{st(bi,Ti);break}else tt(bi,Ti);Ti=Ti.sibling}Ti=ah(xi,bi.mode,Fi),Ti.return=bi,bi=Ti}return ti(bi);case hi:return ts=xi._init,Is(bi,Ti,ts(xi._payload),Fi)}if(us(xi))return ji(bi,Ti,xi,Fi);if(Si(xi))return Wi(bi,Ti,xi,Fi);ic(bi,xi)}return typeof xi=="string"&&xi!==""||typeof xi=="number"?(xi=""+xi,Ti!==null&&Ti.tag===6?(st(bi,Ti.sibling),Ti=pt(Ti,xi),Ti.return=bi,bi=Ti):(st(bi,Ti),Ti=oh(xi,bi.mode,Fi),Ti.return=bi,bi=Ti),ti(bi)):st(bi,Ti)}return Is}var Ma=Ld(!0),$d=Ld(!1),cl={},Co=jo(cl),ul=jo(cl),hl=jo(cl);function da(Qe){if(Qe===cl)throw Error(ee(174));return Qe}function wu(Qe,tt){switch(Es(hl,tt),Es(ul,Qe),Es(Co,cl),Qe=tt.nodeType,Qe){case 9:case 11:tt=(tt=tt.documentElement)?tt.namespaceURI:vs(null,"");break;default:Qe=Qe===8?tt.parentNode:tt,tt=Qe.namespaceURI||null,Qe=Qe.tagName,tt=vs(tt,Qe)}Ss(Co),Es(Co,tt)}function ka(){Ss(Co),Ss(ul),Ss(hl)}function Dd(Qe){da(hl.current);var tt=da(Co.current),st=vs(tt,Qe.type);tt!==st&&(Es(ul,Qe),Es(Co,st))}function Cu(Qe){ul.current===Qe&&(Ss(Co),Ss(ul))}var ws=jo(0);function sc(Qe){for(var tt=Qe;tt!==null;){if(tt.tag===13){var st=tt.memoizedState;if(st!==null&&(st=st.dehydrated,st===null||st.data==="$?"||st.data==="$!"))return tt}else if(tt.tag===19&&tt.memoizedProps.revealOrder!==void 0){if(tt.flags&128)return tt}else if(tt.child!==null){tt.child.return=tt,tt=tt.child;continue}if(tt===Qe)break;for(;tt.sibling===null;){if(tt.return===null||tt.return===Qe)return null;tt=tt.return}tt.sibling.return=tt.return,tt=tt.sibling}return null}var Ru=[];function Au(){for(var Qe=0;Qe<Ru.length;Qe++)Ru[Qe]._workInProgressVersionPrimary=null;Ru.length=0}var oc=mt.ReactCurrentDispatcher,Iu=mt.ReactCurrentBatchConfig,fa=0,Cs=null,$s=null,Ms=null,ac=!1,dl=!1,pl=0,fg=0;function Gs(){throw Error(ee(321))}function Pu(Qe,tt){if(tt===null)return!1;for(var st=0;st<tt.length&&st<Qe.length;st++)if(!vo(Qe[st],tt[st]))return!1;return!0}function Lu(Qe,tt,st,ut,pt,_r){if(fa=_r,Cs=tt,tt.memoizedState=null,tt.updateQueue=null,tt.lanes=0,oc.current=Qe===null||Qe.memoizedState===null?yg:vg,Qe=st(ut,pt),dl){_r=0;do{if(dl=!1,pl=0,25<=_r)throw Error(ee(301));_r+=1,Ms=$s=null,tt.updateQueue=null,oc.current=Eg,Qe=st(ut,pt)}while(dl)}if(oc.current=uc,tt=$s!==null&&$s.next!==null,fa=0,Ms=$s=Cs=null,ac=!1,tt)throw Error(ee(300));return Qe}function $u(){var Qe=pl!==0;return pl=0,Qe}function Ro(){var Qe={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ms===null?Cs.memoizedState=Ms=Qe:Ms=Ms.next=Qe,Ms}function ho(){if($s===null){var Qe=Cs.alternate;Qe=Qe!==null?Qe.memoizedState:null}else Qe=$s.next;var tt=Ms===null?Cs.memoizedState:Ms.next;if(tt!==null)Ms=tt,$s=Qe;else{if(Qe===null)throw Error(ee(310));$s=Qe,Qe={memoizedState:$s.memoizedState,baseState:$s.baseState,baseQueue:$s.baseQueue,queue:$s.queue,next:null},Ms===null?Cs.memoizedState=Ms=Qe:Ms=Ms.next=Qe}return Ms}function gl(Qe,tt){return typeof tt=="function"?tt(Qe):tt}function Du(Qe){var tt=ho(),st=tt.queue;if(st===null)throw Error(ee(311));st.lastRenderedReducer=Qe;var ut=$s,pt=ut.baseQueue,_r=st.pending;if(_r!==null){if(pt!==null){var ti=pt.next;pt.next=_r.next,_r.next=ti}ut.baseQueue=pt=_r,st.pending=null}if(pt!==null){_r=pt.next,ut=ut.baseState;var fi=ti=null,vi=null,_i=_r;do{var Li=_i.lane;if((fa&Li)===Li)vi!==null&&(vi=vi.next={lane:0,action:_i.action,hasEagerState:_i.hasEagerState,eagerState:_i.eagerState,next:null}),ut=_i.hasEagerState?_i.eagerState:Qe(ut,_i.action);else{var Oi={lane:Li,action:_i.action,hasEagerState:_i.hasEagerState,eagerState:_i.eagerState,next:null};vi===null?(fi=vi=Oi,ti=ut):vi=vi.next=Oi,Cs.lanes|=Li,pa|=Li}_i=_i.next}while(_i!==null&&_i!==_r);vi===null?ti=ut:vi.next=fi,vo(ut,tt.memoizedState)||(Xs=!0),tt.memoizedState=ut,tt.baseState=ti,tt.baseQueue=vi,st.lastRenderedState=ut}if(Qe=st.interleaved,Qe!==null){pt=Qe;do _r=pt.lane,Cs.lanes|=_r,pa|=_r,pt=pt.next;while(pt!==Qe)}else pt===null&&(st.lanes=0);return[tt.memoizedState,st.dispatch]}function Ou(Qe){var tt=ho(),st=tt.queue;if(st===null)throw Error(ee(311));st.lastRenderedReducer=Qe;var ut=st.dispatch,pt=st.pending,_r=tt.memoizedState;if(pt!==null){st.pending=null;var ti=pt=pt.next;do _r=Qe(_r,ti.action),ti=ti.next;while(ti!==pt);vo(_r,tt.memoizedState)||(Xs=!0),tt.memoizedState=_r,tt.baseQueue===null&&(tt.baseState=_r),st.lastRenderedState=_r}return[_r,ut]}function Od(){}function Md(Qe,tt){var st=Cs,ut=ho(),pt=tt(),_r=!vo(ut.memoizedState,pt);if(_r&&(ut.memoizedState=pt,Xs=!0),ut=ut.queue,Mu(Fd.bind(null,st,ut,Qe),[Qe]),ut.getSnapshot!==tt||_r||Ms!==null&&Ms.memoizedState.tag&1){if(st.flags|=2048,ml(9,Nd.bind(null,st,ut,pt,tt),void 0,null),ks===null)throw Error(ee(349));fa&30||kd(st,tt,pt)}return pt}function kd(Qe,tt,st){Qe.flags|=16384,Qe={getSnapshot:tt,value:st},tt=Cs.updateQueue,tt===null?(tt={lastEffect:null,stores:null},Cs.updateQueue=tt,tt.stores=[Qe]):(st=tt.stores,st===null?tt.stores=[Qe]:st.push(Qe))}function Nd(Qe,tt,st,ut){tt.value=st,tt.getSnapshot=ut,Bd(tt)&&Ud(Qe)}function Fd(Qe,tt,st){return st(function(){Bd(tt)&&Ud(Qe)})}function Bd(Qe){var tt=Qe.getSnapshot;Qe=Qe.value;try{var st=tt();return!vo(Qe,st)}catch{return!0}}function Ud(Qe){var tt=Do(Qe,1);tt!==null&&xo(tt,Qe,1,-1)}function Gd(Qe){var tt=Ro();return typeof Qe=="function"&&(Qe=Qe()),tt.memoizedState=tt.baseState=Qe,Qe={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:gl,lastRenderedState:Qe},tt.queue=Qe,Qe=Qe.dispatch=mg.bind(null,Cs,Qe),[tt.memoizedState,Qe]}function ml(Qe,tt,st,ut){return Qe={tag:Qe,create:tt,destroy:st,deps:ut,next:null},tt=Cs.updateQueue,tt===null?(tt={lastEffect:null,stores:null},Cs.updateQueue=tt,tt.lastEffect=Qe.next=Qe):(st=tt.lastEffect,st===null?tt.lastEffect=Qe.next=Qe:(ut=st.next,st.next=Qe,Qe.next=ut,tt.lastEffect=Qe)),Qe}function Hd(){return ho().memoizedState}function lc(Qe,tt,st,ut){var pt=Ro();Cs.flags|=Qe,pt.memoizedState=ml(1|tt,st,void 0,ut===void 0?null:ut)}function cc(Qe,tt,st,ut){var pt=ho();ut=ut===void 0?null:ut;var _r=void 0;if($s!==null){var ti=$s.memoizedState;if(_r=ti.destroy,ut!==null&&Pu(ut,ti.deps)){pt.memoizedState=ml(tt,st,_r,ut);return}}Cs.flags|=Qe,pt.memoizedState=ml(1|tt,st,_r,ut)}function Vd(Qe,tt){return lc(8390656,8,Qe,tt)}function Mu(Qe,tt){return cc(2048,8,Qe,tt)}function zd(Qe,tt){return cc(4,2,Qe,tt)}function jd(Qe,tt){return cc(4,4,Qe,tt)}function Wd(Qe,tt){if(typeof tt=="function")return Qe=Qe(),tt(Qe),function(){tt(null)};if(tt!=null)return Qe=Qe(),tt.current=Qe,function(){tt.current=null}}function Yd(Qe,tt,st){return st=st!=null?st.concat([Qe]):null,cc(4,4,Wd.bind(null,tt,Qe),st)}function ku(){}function Kd(Qe,tt){var st=ho();tt=tt===void 0?null:tt;var ut=st.memoizedState;return ut!==null&&tt!==null&&Pu(tt,ut[1])?ut[0]:(st.memoizedState=[Qe,tt],Qe)}function qd(Qe,tt){var st=ho();tt=tt===void 0?null:tt;var ut=st.memoizedState;return ut!==null&&tt!==null&&Pu(tt,ut[1])?ut[0]:(Qe=Qe(),st.memoizedState=[Qe,tt],Qe)}function Xd(Qe,tt,st){return fa&21?(vo(st,tt)||(st=Th(),Cs.lanes|=st,pa|=st,Qe.baseState=!0),tt):(Qe.baseState&&(Qe.baseState=!1,Xs=!0),Qe.memoizedState=st)}function pg(Qe,tt){var st=ys;ys=st!==0&&4>st?st:4,Qe(!0);var ut=Iu.transition;Iu.transition={};try{Qe(!1),tt()}finally{ys=st,Iu.transition=ut}}function Qd(){return ho().memoizedState}function gg(Qe,tt,st){var ut=Zo(Qe);if(st={lane:ut,action:st,hasEagerState:!1,eagerState:null,next:null},Jd(Qe))Zd(tt,st);else if(st=Sd(Qe,tt,st,ut),st!==null){var pt=Ws();xo(st,Qe,ut,pt),ef(st,tt,ut)}}function mg(Qe,tt,st){var ut=Zo(Qe),pt={lane:ut,action:st,hasEagerState:!1,eagerState:null,next:null};if(Jd(Qe))Zd(tt,pt);else{var _r=Qe.alternate;if(Qe.lanes===0&&(_r===null||_r.lanes===0)&&(_r=tt.lastRenderedReducer,_r!==null))try{var ti=tt.lastRenderedState,fi=_r(ti,st);if(pt.hasEagerState=!0,pt.eagerState=fi,vo(fi,ti)){var vi=tt.interleaved;vi===null?(pt.next=pt,bu(tt)):(pt.next=vi.next,vi.next=pt),tt.interleaved=pt;return}}catch{}finally{}st=Sd(Qe,tt,pt,ut),st!==null&&(pt=Ws(),xo(st,Qe,ut,pt),ef(st,tt,ut))}}function Jd(Qe){var tt=Qe.alternate;return Qe===Cs||tt!==null&&tt===Cs}function Zd(Qe,tt){dl=ac=!0;var st=Qe.pending;st===null?tt.next=tt:(tt.next=st.next,st.next=tt),Qe.pending=tt}function ef(Qe,tt,st){if(st&4194240){var ut=tt.lanes;ut&=Qe.pendingLanes,st|=ut,tt.lanes=st,kc(Qe,st)}}var uc={readContext:uo,useCallback:Gs,useContext:Gs,useEffect:Gs,useImperativeHandle:Gs,useInsertionEffect:Gs,useLayoutEffect:Gs,useMemo:Gs,useReducer:Gs,useRef:Gs,useState:Gs,useDebugValue:Gs,useDeferredValue:Gs,useTransition:Gs,useMutableSource:Gs,useSyncExternalStore:Gs,useId:Gs,unstable_isNewReconciler:!1},yg={readContext:uo,useCallback:function(Qe,tt){return Ro().memoizedState=[Qe,tt===void 0?null:tt],Qe},useContext:uo,useEffect:Vd,useImperativeHandle:function(Qe,tt,st){return st=st!=null?st.concat([Qe]):null,lc(4194308,4,Wd.bind(null,tt,Qe),st)},useLayoutEffect:function(Qe,tt){return lc(4194308,4,Qe,tt)},useInsertionEffect:function(Qe,tt){return lc(4,2,Qe,tt)},useMemo:function(Qe,tt){var st=Ro();return tt=tt===void 0?null:tt,Qe=Qe(),st.memoizedState=[Qe,tt],Qe},useReducer:function(Qe,tt,st){var ut=Ro();return tt=st!==void 0?st(tt):tt,ut.memoizedState=ut.baseState=tt,Qe={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Qe,lastRenderedState:tt},ut.queue=Qe,Qe=Qe.dispatch=gg.bind(null,Cs,Qe),[ut.memoizedState,Qe]},useRef:function(Qe){var tt=Ro();return Qe={current:Qe},tt.memoizedState=Qe},useState:Gd,useDebugValue:ku,useDeferredValue:function(Qe){return Ro().memoizedState=Qe},useTransition:function(){var Qe=Gd(!1),tt=Qe[0];return Qe=pg.bind(null,Qe[1]),Ro().memoizedState=Qe,[tt,Qe]},useMutableSource:function(){},useSyncExternalStore:function(Qe,tt,st){var ut=Cs,pt=Ro();if(xs){if(st===void 0)throw Error(ee(407));st=st()}else{if(st=tt(),ks===null)throw Error(ee(349));fa&30||kd(ut,tt,st)}pt.memoizedState=st;var _r={value:st,getSnapshot:tt};return pt.queue=_r,Vd(Fd.bind(null,ut,_r,Qe),[Qe]),ut.flags|=2048,ml(9,Nd.bind(null,ut,_r,st,tt),void 0,null),st},useId:function(){var Qe=Ro(),tt=ks.identifierPrefix;if(xs){var st=$o,ut=Lo;st=(ut&~(1<<32-yo(ut)-1)).toString(32)+st,tt=":"+tt+"R"+st,st=pl++,0<st&&(tt+="H"+st.toString(32)),tt+=":"}else st=fg++,tt=":"+tt+"r"+st.toString(32)+":";return Qe.memoizedState=tt},unstable_isNewReconciler:!1},vg={readContext:uo,useCallback:Kd,useContext:uo,useEffect:Mu,useImperativeHandle:Yd,useInsertionEffect:zd,useLayoutEffect:jd,useMemo:qd,useReducer:Du,useRef:Hd,useState:function(){return Du(gl)},useDebugValue:ku,useDeferredValue:function(Qe){var tt=ho();return Xd(tt,$s.memoizedState,Qe)},useTransition:function(){var Qe=Du(gl)[0],tt=ho().memoizedState;return[Qe,tt]},useMutableSource:Od,useSyncExternalStore:Md,useId:Qd,unstable_isNewReconciler:!1},Eg={readContext:uo,useCallback:Kd,useContext:uo,useEffect:Mu,useImperativeHandle:Yd,useInsertionEffect:zd,useLayoutEffect:jd,useMemo:qd,useReducer:Ou,useRef:Hd,useState:function(){return Ou(gl)},useDebugValue:ku,useDeferredValue:function(Qe){var tt=ho();return $s===null?tt.memoizedState=Qe:Xd(tt,$s.memoizedState,Qe)},useTransition:function(){var Qe=Ou(gl)[0],tt=ho().memoizedState;return[Qe,tt]},useMutableSource:Od,useSyncExternalStore:Md,useId:Qd,unstable_isNewReconciler:!1};function Na(Qe,tt){try{var st="",ut=tt;do st+=Ri(ut),ut=ut.return;while(ut);var pt=st}catch(_r){pt=`
Error generating stack: `+_r.message+`
`+_r.stack}return{value:Qe,source:tt,stack:pt,digest:null}}function Nu(Qe,tt,st){return{value:Qe,source:null,stack:st??null,digest:tt??null}}function Fu(Qe,tt){try{console.error(tt.value)}catch(st){setTimeout(function(){throw st})}}var Tg=typeof WeakMap=="function"?WeakMap:Map;function tf(Qe,tt,st){st=Oo(-1,st),st.tag=3,st.payload={element:null};var ut=tt.value;return st.callback=function(){yc||(yc=!0,Ju=ut),Fu(Qe,tt)},st}function rf(Qe,tt,st){st=Oo(-1,st),st.tag=3;var ut=Qe.type.getDerivedStateFromError;if(typeof ut=="function"){var pt=tt.value;st.payload=function(){return ut(pt)},st.callback=function(){Fu(Qe,tt)}}var _r=Qe.stateNode;return _r!==null&&typeof _r.componentDidCatch=="function"&&(st.callback=function(){Fu(Qe,tt),typeof ut!="function"&&(Qo===null?Qo=new Set([this]):Qo.add(this));var ti=tt.stack;this.componentDidCatch(tt.value,{componentStack:ti!==null?ti:""})}),st}function nf(Qe,tt,st){var ut=Qe.pingCache;if(ut===null){ut=Qe.pingCache=new Tg;var pt=new Set;ut.set(tt,pt)}else pt=ut.get(tt),pt===void 0&&(pt=new Set,ut.set(tt,pt));pt.has(st)||(pt.add(st),Qe=Og.bind(null,Qe,tt,st),tt.then(Qe,Qe))}function sf(Qe){do{var tt;if((tt=Qe.tag===13)&&(tt=Qe.memoizedState,tt=tt!==null?tt.dehydrated!==null:!0),tt)return Qe;Qe=Qe.return}while(Qe!==null);return null}function of(Qe,tt,st,ut,pt){return Qe.mode&1?(Qe.flags|=65536,Qe.lanes=pt,Qe):(Qe===tt?Qe.flags|=65536:(Qe.flags|=128,st.flags|=131072,st.flags&=-52805,st.tag===1&&(st.alternate===null?st.tag=17:(tt=Oo(-1,1),tt.tag=2,qo(st,tt,1))),st.lanes|=1),Qe)}var bg=mt.ReactCurrentOwner,Xs=!1;function js(Qe,tt,st,ut){tt.child=Qe===null?$d(tt,null,st,ut):Ma(tt,Qe.child,st,ut)}function af(Qe,tt,st,ut,pt){st=st.render;var _r=tt.ref;return Oa(tt,pt),ut=Lu(Qe,tt,st,ut,_r,pt),st=$u(),Qe!==null&&!Xs?(tt.updateQueue=Qe.updateQueue,tt.flags&=-2053,Qe.lanes&=~pt,Mo(Qe,tt,pt)):(xs&&st&&du(tt),tt.flags|=1,js(Qe,tt,ut,pt),tt.child)}function lf(Qe,tt,st,ut,pt){if(Qe===null){var _r=st.type;return typeof _r=="function"&&!sh(_r)&&_r.defaultProps===void 0&&st.compare===null&&st.defaultProps===void 0?(tt.tag=15,tt.type=_r,cf(Qe,tt,_r,ut,pt)):(Qe=_c(st.type,null,ut,tt,tt.mode,pt),Qe.ref=tt.ref,Qe.return=tt,tt.child=Qe)}if(_r=Qe.child,!(Qe.lanes&pt)){var ti=_r.memoizedProps;if(st=st.compare,st=st!==null?st:tl,st(ti,ut)&&Qe.ref===tt.ref)return Mo(Qe,tt,pt)}return tt.flags|=1,Qe=ta(_r,ut),Qe.ref=tt.ref,Qe.return=tt,tt.child=Qe}function cf(Qe,tt,st,ut,pt){if(Qe!==null){var _r=Qe.memoizedProps;if(tl(_r,ut)&&Qe.ref===tt.ref)if(Xs=!1,tt.pendingProps=ut=_r,(Qe.lanes&pt)!==0)Qe.flags&131072&&(Xs=!0);else return tt.lanes=Qe.lanes,Mo(Qe,tt,pt)}return Bu(Qe,tt,st,ut,pt)}function uf(Qe,tt,st){var ut=tt.pendingProps,pt=ut.children,_r=Qe!==null?Qe.memoizedState:null;if(ut.mode==="hidden")if(!(tt.mode&1))tt.memoizedState={baseLanes:0,cachePool:null,transitions:null},Es(Ba,so),so|=st;else{if(!(st&1073741824))return Qe=_r!==null?_r.baseLanes|st:st,tt.lanes=tt.childLanes=1073741824,tt.memoizedState={baseLanes:Qe,cachePool:null,transitions:null},tt.updateQueue=null,Es(Ba,so),so|=Qe,null;tt.memoizedState={baseLanes:0,cachePool:null,transitions:null},ut=_r!==null?_r.baseLanes:st,Es(Ba,so),so|=ut}else _r!==null?(ut=_r.baseLanes|st,tt.memoizedState=null):ut=st,Es(Ba,so),so|=ut;return js(Qe,tt,pt,st),tt.child}function hf(Qe,tt){var st=tt.ref;(Qe===null&&st!==null||Qe!==null&&Qe.ref!==st)&&(tt.flags|=512,tt.flags|=2097152)}function Bu(Qe,tt,st,ut,pt){var _r=qs(st)?aa:Us.current;return _r=Ia(tt,_r),Oa(tt,pt),st=Lu(Qe,tt,st,ut,_r,pt),ut=$u(),Qe!==null&&!Xs?(tt.updateQueue=Qe.updateQueue,tt.flags&=-2053,Qe.lanes&=~pt,Mo(Qe,tt,pt)):(xs&&ut&&du(tt),tt.flags|=1,js(Qe,tt,st,pt),tt.child)}function df(Qe,tt,st,ut,pt){if(qs(st)){var _r=!0;Yl(tt)}else _r=!1;if(Oa(tt,pt),tt.stateNode===null)dc(Qe,tt),Ad(tt,st,ut),_u(tt,st,ut,pt),ut=!0;else if(Qe===null){var ti=tt.stateNode,fi=tt.memoizedProps;ti.props=fi;var vi=ti.context,_i=st.contextType;typeof _i=="object"&&_i!==null?_i=uo(_i):(_i=qs(st)?aa:Us.current,_i=Ia(tt,_i));var Li=st.getDerivedStateFromProps,Oi=typeof Li=="function"||typeof ti.getSnapshotBeforeUpdate=="function";Oi||typeof ti.UNSAFE_componentWillReceiveProps!="function"&&typeof ti.componentWillReceiveProps!="function"||(fi!==ut||vi!==_i)&&Id(tt,ti,ut,_i),Ko=!1;var Pi=tt.memoizedState;ti.state=Pi,rc(tt,ut,ti,pt),vi=tt.memoizedState,fi!==ut||Pi!==vi||Ks.current||Ko?(typeof Li=="function"&&(xu(tt,st,Li,ut),vi=tt.memoizedState),(fi=Ko||Rd(tt,st,fi,ut,Pi,vi,_i))?(Oi||typeof ti.UNSAFE_componentWillMount!="function"&&typeof ti.componentWillMount!="function"||(typeof ti.componentWillMount=="function"&&ti.componentWillMount(),typeof ti.UNSAFE_componentWillMount=="function"&&ti.UNSAFE_componentWillMount()),typeof ti.componentDidMount=="function"&&(tt.flags|=4194308)):(typeof ti.componentDidMount=="function"&&(tt.flags|=4194308),tt.memoizedProps=ut,tt.memoizedState=vi),ti.props=ut,ti.state=vi,ti.context=_i,ut=fi):(typeof ti.componentDidMount=="function"&&(tt.flags|=4194308),ut=!1)}else{ti=tt.stateNode,xd(Qe,tt),fi=tt.memoizedProps,_i=tt.type===tt.elementType?fi:To(tt.type,fi),ti.props=_i,Oi=tt.pendingProps,Pi=ti.context,vi=st.contextType,typeof vi=="object"&&vi!==null?vi=uo(vi):(vi=qs(st)?aa:Us.current,vi=Ia(tt,vi));var Hi=st.getDerivedStateFromProps;(Li=typeof Hi=="function"||typeof ti.getSnapshotBeforeUpdate=="function")||typeof ti.UNSAFE_componentWillReceiveProps!="function"&&typeof ti.componentWillReceiveProps!="function"||(fi!==Oi||Pi!==vi)&&Id(tt,ti,ut,vi),Ko=!1,Pi=tt.memoizedState,ti.state=Pi,rc(tt,ut,ti,pt);var ji=tt.memoizedState;fi!==Oi||Pi!==ji||Ks.current||Ko?(typeof Hi=="function"&&(xu(tt,st,Hi,ut),ji=tt.memoizedState),(_i=Ko||Rd(tt,st,_i,ut,Pi,ji,vi)||!1)?(Li||typeof ti.UNSAFE_componentWillUpdate!="function"&&typeof ti.componentWillUpdate!="function"||(typeof ti.componentWillUpdate=="function"&&ti.componentWillUpdate(ut,ji,vi),typeof ti.UNSAFE_componentWillUpdate=="function"&&ti.UNSAFE_componentWillUpdate(ut,ji,vi)),typeof ti.componentDidUpdate=="function"&&(tt.flags|=4),typeof ti.getSnapshotBeforeUpdate=="function"&&(tt.flags|=1024)):(typeof ti.componentDidUpdate!="function"||fi===Qe.memoizedProps&&Pi===Qe.memoizedState||(tt.flags|=4),typeof ti.getSnapshotBeforeUpdate!="function"||fi===Qe.memoizedProps&&Pi===Qe.memoizedState||(tt.flags|=1024),tt.memoizedProps=ut,tt.memoizedState=ji),ti.props=ut,ti.state=ji,ti.context=vi,ut=_i):(typeof ti.componentDidUpdate!="function"||fi===Qe.memoizedProps&&Pi===Qe.memoizedState||(tt.flags|=4),typeof ti.getSnapshotBeforeUpdate!="function"||fi===Qe.memoizedProps&&Pi===Qe.memoizedState||(tt.flags|=1024),ut=!1)}return Uu(Qe,tt,st,ut,_r,pt)}function Uu(Qe,tt,st,ut,pt,_r){hf(Qe,tt);var ti=(tt.flags&128)!==0;if(!ut&&!ti)return pt&&gd(tt,st,!1),Mo(Qe,tt,_r);ut=tt.stateNode,bg.current=tt;var fi=ti&&typeof st.getDerivedStateFromError!="function"?null:ut.render();return tt.flags|=1,Qe!==null&&ti?(tt.child=Ma(tt,Qe.child,null,_r),tt.child=Ma(tt,null,fi,_r)):js(Qe,tt,fi,_r),tt.memoizedState=ut.state,pt&&gd(tt,st,!0),tt.child}function ff(Qe){var tt=Qe.stateNode;tt.pendingContext?dd(Qe,tt.pendingContext,tt.pendingContext!==tt.context):tt.context&&dd(Qe,tt.context,!1),wu(Qe,tt.containerInfo)}function pf(Qe,tt,st,ut,pt){return $a(),mu(pt),tt.flags|=256,js(Qe,tt,st,ut),tt.child}var Gu={dehydrated:null,treeContext:null,retryLane:0};function Hu(Qe){return{baseLanes:Qe,cachePool:null,transitions:null}}function gf(Qe,tt,st){var ut=tt.pendingProps,pt=ws.current,_r=!1,ti=(tt.flags&128)!==0,fi;if((fi=ti)||(fi=Qe!==null&&Qe.memoizedState===null?!1:(pt&2)!==0),fi?(_r=!0,tt.flags&=-129):(Qe===null||Qe.memoizedState!==null)&&(pt|=1),Es(ws,pt&1),Qe===null)return gu(tt),Qe=tt.memoizedState,Qe!==null&&(Qe=Qe.dehydrated,Qe!==null)?(tt.mode&1?Qe.data==="$!"?tt.lanes=8:tt.lanes=1073741824:tt.lanes=1,null):(ti=ut.children,Qe=ut.fallback,_r?(ut=tt.mode,_r=tt.child,ti={mode:"hidden",children:ti},!(ut&1)&&_r!==null?(_r.childLanes=0,_r.pendingProps=ti):_r=wc(ti,ut,0,null),Qe=va(Qe,ut,st,null),_r.return=tt,Qe.return=tt,_r.sibling=Qe,tt.child=_r,tt.child.memoizedState=Hu(st),tt.memoizedState=Gu,Qe):Vu(tt,ti));if(pt=Qe.memoizedState,pt!==null&&(fi=pt.dehydrated,fi!==null))return Sg(Qe,tt,ti,ut,fi,pt,st);if(_r){_r=ut.fallback,ti=tt.mode,pt=Qe.child,fi=pt.sibling;var vi={mode:"hidden",children:ut.children};return!(ti&1)&&tt.child!==pt?(ut=tt.child,ut.childLanes=0,ut.pendingProps=vi,tt.deletions=null):(ut=ta(pt,vi),ut.subtreeFlags=pt.subtreeFlags&14680064),fi!==null?_r=ta(fi,_r):(_r=va(_r,ti,st,null),_r.flags|=2),_r.return=tt,ut.return=tt,ut.sibling=_r,tt.child=ut,ut=_r,_r=tt.child,ti=Qe.child.memoizedState,ti=ti===null?Hu(st):{baseLanes:ti.baseLanes|st,cachePool:null,transitions:ti.transitions},_r.memoizedState=ti,_r.childLanes=Qe.childLanes&~st,tt.memoizedState=Gu,ut}return _r=Qe.child,Qe=_r.sibling,ut=ta(_r,{mode:"visible",children:ut.children}),!(tt.mode&1)&&(ut.lanes=st),ut.return=tt,ut.sibling=null,Qe!==null&&(st=tt.deletions,st===null?(tt.deletions=[Qe],tt.flags|=16):st.push(Qe)),tt.child=ut,tt.memoizedState=null,ut}function Vu(Qe,tt){return tt=wc({mode:"visible",children:tt},Qe.mode,0,null),tt.return=Qe,Qe.child=tt}function hc(Qe,tt,st,ut){return ut!==null&&mu(ut),Ma(tt,Qe.child,null,st),Qe=Vu(tt,tt.pendingProps.children),Qe.flags|=2,tt.memoizedState=null,Qe}function Sg(Qe,tt,st,ut,pt,_r,ti){if(st)return tt.flags&256?(tt.flags&=-257,ut=Nu(Error(ee(422))),hc(Qe,tt,ti,ut)):tt.memoizedState!==null?(tt.child=Qe.child,tt.flags|=128,null):(_r=ut.fallback,pt=tt.mode,ut=wc({mode:"visible",children:ut.children},pt,0,null),_r=va(_r,pt,ti,null),_r.flags|=2,ut.return=tt,_r.return=tt,ut.sibling=_r,tt.child=ut,tt.mode&1&&Ma(tt,Qe.child,null,ti),tt.child.memoizedState=Hu(ti),tt.memoizedState=Gu,_r);if(!(tt.mode&1))return hc(Qe,tt,ti,null);if(pt.data==="$!"){if(ut=pt.nextSibling&&pt.nextSibling.dataset,ut)var fi=ut.dgst;return ut=fi,_r=Error(ee(419)),ut=Nu(_r,ut,void 0),hc(Qe,tt,ti,ut)}if(fi=(ti&Qe.childLanes)!==0,Xs||fi){if(ut=ks,ut!==null){switch(ti&-ti){case 4:pt=2;break;case 16:pt=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:pt=32;break;case 536870912:pt=268435456;break;default:pt=0}pt=pt&(ut.suspendedLanes|ti)?0:pt,pt!==0&&pt!==_r.retryLane&&(_r.retryLane=pt,Do(Qe,pt),xo(ut,Qe,pt,-1))}return ih(),ut=Nu(Error(ee(421))),hc(Qe,tt,ti,ut)}return pt.data==="$?"?(tt.flags|=128,tt.child=Qe.child,tt=Mg.bind(null,Qe),pt._reactRetry=tt,null):(Qe=_r.treeContext,io=zo(pt.nextSibling),no=tt,xs=!0,Eo=null,Qe!==null&&(lo[co++]=Lo,lo[co++]=$o,lo[co++]=la,Lo=Qe.id,$o=Qe.overflow,la=tt),tt=Vu(tt,ut.children),tt.flags|=4096,tt)}function mf(Qe,tt,st){Qe.lanes|=tt;var ut=Qe.alternate;ut!==null&&(ut.lanes|=tt),Tu(Qe.return,tt,st)}function zu(Qe,tt,st,ut,pt){var _r=Qe.memoizedState;_r===null?Qe.memoizedState={isBackwards:tt,rendering:null,renderingStartTime:0,last:ut,tail:st,tailMode:pt}:(_r.isBackwards=tt,_r.rendering=null,_r.renderingStartTime=0,_r.last=ut,_r.tail=st,_r.tailMode=pt)}function yf(Qe,tt,st){var ut=tt.pendingProps,pt=ut.revealOrder,_r=ut.tail;if(js(Qe,tt,ut.children,st),ut=ws.current,ut&2)ut=ut&1|2,tt.flags|=128;else{if(Qe!==null&&Qe.flags&128)e:for(Qe=tt.child;Qe!==null;){if(Qe.tag===13)Qe.memoizedState!==null&&mf(Qe,st,tt);else if(Qe.tag===19)mf(Qe,st,tt);else if(Qe.child!==null){Qe.child.return=Qe,Qe=Qe.child;continue}if(Qe===tt)break e;for(;Qe.sibling===null;){if(Qe.return===null||Qe.return===tt)break e;Qe=Qe.return}Qe.sibling.return=Qe.return,Qe=Qe.sibling}ut&=1}if(Es(ws,ut),!(tt.mode&1))tt.memoizedState=null;else switch(pt){case"forwards":for(st=tt.child,pt=null;st!==null;)Qe=st.alternate,Qe!==null&&sc(Qe)===null&&(pt=st),st=st.sibling;st=pt,st===null?(pt=tt.child,tt.child=null):(pt=st.sibling,st.sibling=null),zu(tt,!1,pt,st,_r);break;case"backwards":for(st=null,pt=tt.child,tt.child=null;pt!==null;){if(Qe=pt.alternate,Qe!==null&&sc(Qe)===null){tt.child=pt;break}Qe=pt.sibling,pt.sibling=st,st=pt,pt=Qe}zu(tt,!0,st,null,_r);break;case"together":zu(tt,!1,null,null,void 0);break;default:tt.memoizedState=null}return tt.child}function dc(Qe,tt){!(tt.mode&1)&&Qe!==null&&(Qe.alternate=null,tt.alternate=null,tt.flags|=2)}function Mo(Qe,tt,st){if(Qe!==null&&(tt.dependencies=Qe.dependencies),pa|=tt.lanes,!(st&tt.childLanes))return null;if(Qe!==null&&tt.child!==Qe.child)throw Error(ee(153));if(tt.child!==null){for(Qe=tt.child,st=ta(Qe,Qe.pendingProps),tt.child=st,st.return=tt;Qe.sibling!==null;)Qe=Qe.sibling,st=st.sibling=ta(Qe,Qe.pendingProps),st.return=tt;st.sibling=null}return tt.child}function xg(Qe,tt,st){switch(tt.tag){case 3:ff(tt),$a();break;case 5:Dd(tt);break;case 1:qs(tt.type)&&Yl(tt);break;case 4:wu(tt,tt.stateNode.containerInfo);break;case 10:var ut=tt.type._context,pt=tt.memoizedProps.value;Es(Jl,ut._currentValue),ut._currentValue=pt;break;case 13:if(ut=tt.memoizedState,ut!==null)return ut.dehydrated!==null?(Es(ws,ws.current&1),tt.flags|=128,null):st&tt.child.childLanes?gf(Qe,tt,st):(Es(ws,ws.current&1),Qe=Mo(Qe,tt,st),Qe!==null?Qe.sibling:null);Es(ws,ws.current&1);break;case 19:if(ut=(st&tt.childLanes)!==0,Qe.flags&128){if(ut)return yf(Qe,tt,st);tt.flags|=128}if(pt=tt.memoizedState,pt!==null&&(pt.rendering=null,pt.tail=null,pt.lastEffect=null),Es(ws,ws.current),ut)break;return null;case 22:case 23:return tt.lanes=0,uf(Qe,tt,st)}return Mo(Qe,tt,st)}var vf,ju,Ef,Tf;vf=function(Qe,tt){for(var st=tt.child;st!==null;){if(st.tag===5||st.tag===6)Qe.appendChild(st.stateNode);else if(st.tag!==4&&st.child!==null){st.child.return=st,st=st.child;continue}if(st===tt)break;for(;st.sibling===null;){if(st.return===null||st.return===tt)return;st=st.return}st.sibling.return=st.return,st=st.sibling}},ju=function(){},Ef=function(Qe,tt,st,ut){var pt=Qe.memoizedProps;if(pt!==ut){Qe=tt.stateNode,da(Co.current);var _r=null;switch(st){case"input":pt=di(Qe,pt),ut=di(Qe,ut),_r=[];break;case"select":pt=si({},pt,{value:void 0}),ut=si({},ut,{value:void 0}),_r=[];break;case"textarea":pt=ns(Qe,pt),ut=ns(Qe,ut),_r=[];break;default:typeof pt.onClick!="function"&&typeof ut.onClick=="function"&&(Qe.onclick=zl)}Zr(st,ut);var ti;st=null;for(_i in pt)if(!ut.hasOwnProperty(_i)&&pt.hasOwnProperty(_i)&&pt[_i]!=null)if(_i==="style"){var fi=pt[_i];for(ti in fi)fi.hasOwnProperty(ti)&&(st||(st={}),st[ti]="")}else _i!=="dangerouslySetInnerHTML"&&_i!=="children"&&_i!=="suppressContentEditableWarning"&&_i!=="suppressHydrationWarning"&&_i!=="autoFocus"&&(ye.hasOwnProperty(_i)?_r||(_r=[]):(_r=_r||[]).push(_i,null));for(_i in ut){var vi=ut[_i];if(fi=pt!=null?pt[_i]:void 0,ut.hasOwnProperty(_i)&&vi!==fi&&(vi!=null||fi!=null))if(_i==="style")if(fi){for(ti in fi)!fi.hasOwnProperty(ti)||vi&&vi.hasOwnProperty(ti)||(st||(st={}),st[ti]="");for(ti in vi)vi.hasOwnProperty(ti)&&fi[ti]!==vi[ti]&&(st||(st={}),st[ti]=vi[ti])}else st||(_r||(_r=[]),_r.push(_i,st)),st=vi;else _i==="dangerouslySetInnerHTML"?(vi=vi?vi.__html:void 0,fi=fi?fi.__html:void 0,vi!=null&&fi!==vi&&(_r=_r||[]).push(_i,vi)):_i==="children"?typeof vi!="string"&&typeof vi!="number"||(_r=_r||[]).push(_i,""+vi):_i!=="suppressContentEditableWarning"&&_i!=="suppressHydrationWarning"&&(ye.hasOwnProperty(_i)?(vi!=null&&_i==="onScroll"&&bs("scroll",Qe),_r||fi===vi||(_r=[])):(_r=_r||[]).push(_i,vi))}st&&(_r=_r||[]).push("style",st);var _i=_r;(tt.updateQueue=_i)&&(tt.flags|=4)}},Tf=function(Qe,tt,st,ut){st!==ut&&(tt.flags|=4)};function yl(Qe,tt){if(!xs)switch(Qe.tailMode){case"hidden":tt=Qe.tail;for(var st=null;tt!==null;)tt.alternate!==null&&(st=tt),tt=tt.sibling;st===null?Qe.tail=null:st.sibling=null;break;case"collapsed":st=Qe.tail;for(var ut=null;st!==null;)st.alternate!==null&&(ut=st),st=st.sibling;ut===null?tt||Qe.tail===null?Qe.tail=null:Qe.tail.sibling=null:ut.sibling=null}}function Hs(Qe){var tt=Qe.alternate!==null&&Qe.alternate.child===Qe.child,st=0,ut=0;if(tt)for(var pt=Qe.child;pt!==null;)st|=pt.lanes|pt.childLanes,ut|=pt.subtreeFlags&14680064,ut|=pt.flags&14680064,pt.return=Qe,pt=pt.sibling;else for(pt=Qe.child;pt!==null;)st|=pt.lanes|pt.childLanes,ut|=pt.subtreeFlags,ut|=pt.flags,pt.return=Qe,pt=pt.sibling;return Qe.subtreeFlags|=ut,Qe.childLanes=st,tt}function _g(Qe,tt,st){var ut=tt.pendingProps;switch(fu(tt),tt.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Hs(tt),null;case 1:return qs(tt.type)&&Wl(),Hs(tt),null;case 3:return ut=tt.stateNode,ka(),Ss(Ks),Ss(Us),Au(),ut.pendingContext&&(ut.context=ut.pendingContext,ut.pendingContext=null),(Qe===null||Qe.child===null)&&(Ql(tt)?tt.flags|=4:Qe===null||Qe.memoizedState.isDehydrated&&!(tt.flags&256)||(tt.flags|=1024,Eo!==null&&(th(Eo),Eo=null))),ju(Qe,tt),Hs(tt),null;case 5:Cu(tt);var pt=da(hl.current);if(st=tt.type,Qe!==null&&tt.stateNode!=null)Ef(Qe,tt,st,ut,pt),Qe.ref!==tt.ref&&(tt.flags|=512,tt.flags|=2097152);else{if(!ut){if(tt.stateNode===null)throw Error(ee(166));return Hs(tt),null}if(Qe=da(Co.current),Ql(tt)){ut=tt.stateNode,st=tt.type;var _r=tt.memoizedProps;switch(ut[wo]=tt,ut[ol]=_r,Qe=(tt.mode&1)!==0,st){case"dialog":bs("cancel",ut),bs("close",ut);break;case"iframe":case"object":case"embed":bs("load",ut);break;case"video":case"audio":for(pt=0;pt<nl.length;pt++)bs(nl[pt],ut);break;case"source":bs("error",ut);break;case"img":case"image":case"link":bs("error",ut),bs("load",ut);break;case"details":bs("toggle",ut);break;case"input":wi(ut,_r),bs("invalid",ut);break;case"select":ut._wrapperState={wasMultiple:!!_r.multiple},bs("invalid",ut);break;case"textarea":Ki(ut,_r),bs("invalid",ut)}Zr(st,_r),pt=null;for(var ti in _r)if(_r.hasOwnProperty(ti)){var fi=_r[ti];ti==="children"?typeof fi=="string"?ut.textContent!==fi&&(_r.suppressHydrationWarning!==!0&&Vl(ut.textContent,fi,Qe),pt=["children",fi]):typeof fi=="number"&&ut.textContent!==""+fi&&(_r.suppressHydrationWarning!==!0&&Vl(ut.textContent,fi,Qe),pt=["children",""+fi]):ye.hasOwnProperty(ti)&&fi!=null&&ti==="onScroll"&&bs("scroll",ut)}switch(st){case"input":ls(ut),is(ut,_r,!0);break;case"textarea":ls(ut),as(ut);break;case"select":case"option":break;default:typeof _r.onClick=="function"&&(ut.onclick=zl)}ut=pt,tt.updateQueue=ut,ut!==null&&(tt.flags|=4)}else{ti=pt.nodeType===9?pt:pt.ownerDocument,Qe==="http://www.w3.org/1999/xhtml"&&(Qe=ms(st)),Qe==="http://www.w3.org/1999/xhtml"?st==="script"?(Qe=ti.createElement("div"),Qe.innerHTML="<script><\/script>",Qe=Qe.removeChild(Qe.firstChild)):typeof ut.is=="string"?Qe=ti.createElement(st,{is:ut.is}):(Qe=ti.createElement(st),st==="select"&&(ti=Qe,ut.multiple?ti.multiple=!0:ut.size&&(ti.size=ut.size))):Qe=ti.createElementNS(Qe,st),Qe[wo]=tt,Qe[ol]=ut,vf(Qe,tt,!1,!1),tt.stateNode=Qe;e:{switch(ti=pi(st,ut),st){case"dialog":bs("cancel",Qe),bs("close",Qe),pt=ut;break;case"iframe":case"object":case"embed":bs("load",Qe),pt=ut;break;case"video":case"audio":for(pt=0;pt<nl.length;pt++)bs(nl[pt],Qe);pt=ut;break;case"source":bs("error",Qe),pt=ut;break;case"img":case"image":case"link":bs("error",Qe),bs("load",Qe),pt=ut;break;case"details":bs("toggle",Qe),pt=ut;break;case"input":wi(Qe,ut),pt=di(Qe,ut),bs("invalid",Qe);break;case"option":pt=ut;break;case"select":Qe._wrapperState={wasMultiple:!!ut.multiple},pt=si({},ut,{value:void 0}),bs("invalid",Qe);break;case"textarea":Ki(Qe,ut),pt=ns(Qe,ut),bs("invalid",Qe);break;default:pt=ut}Zr(st,pt),fi=pt;for(_r in fi)if(fi.hasOwnProperty(_r)){var vi=fi[_r];_r==="style"?No(Qe,vi):_r==="dangerouslySetInnerHTML"?(vi=vi?vi.__html:void 0,vi!=null&&Zs(Qe,vi)):_r==="children"?typeof vi=="string"?(st!=="textarea"||vi!=="")&&Ts(Qe,vi):typeof vi=="number"&&Ts(Qe,""+vi):_r!=="suppressContentEditableWarning"&&_r!=="suppressHydrationWarning"&&_r!=="autoFocus"&&(ye.hasOwnProperty(_r)?vi!=null&&_r==="onScroll"&&bs("scroll",Qe):vi!=null&&gt(Qe,_r,vi,ti))}switch(st){case"input":ls(Qe),is(Qe,ut,!1);break;case"textarea":ls(Qe),as(Qe);break;case"option":ut.value!=null&&Qe.setAttribute("value",""+ki(ut.value));break;case"select":Qe.multiple=!!ut.multiple,_r=ut.value,_r!=null?Zi(Qe,!!ut.multiple,_r,!1):ut.defaultValue!=null&&Zi(Qe,!!ut.multiple,ut.defaultValue,!0);break;default:typeof pt.onClick=="function"&&(Qe.onclick=zl)}switch(st){case"button":case"input":case"select":case"textarea":ut=!!ut.autoFocus;break e;case"img":ut=!0;break e;default:ut=!1}}ut&&(tt.flags|=4)}tt.ref!==null&&(tt.flags|=512,tt.flags|=2097152)}return Hs(tt),null;case 6:if(Qe&&tt.stateNode!=null)Tf(Qe,tt,Qe.memoizedProps,ut);else{if(typeof ut!="string"&&tt.stateNode===null)throw Error(ee(166));if(st=da(hl.current),da(Co.current),Ql(tt)){if(ut=tt.stateNode,st=tt.memoizedProps,ut[wo]=tt,(_r=ut.nodeValue!==st)&&(Qe=no,Qe!==null))switch(Qe.tag){case 3:Vl(ut.nodeValue,st,(Qe.mode&1)!==0);break;case 5:Qe.memoizedProps.suppressHydrationWarning!==!0&&Vl(ut.nodeValue,st,(Qe.mode&1)!==0)}_r&&(tt.flags|=4)}else ut=(st.nodeType===9?st:st.ownerDocument).createTextNode(ut),ut[wo]=tt,tt.stateNode=ut}return Hs(tt),null;case 13:if(Ss(ws),ut=tt.memoizedState,Qe===null||Qe.memoizedState!==null&&Qe.memoizedState.dehydrated!==null){if(xs&&io!==null&&tt.mode&1&&!(tt.flags&128))bd(),$a(),tt.flags|=98560,_r=!1;else if(_r=Ql(tt),ut!==null&&ut.dehydrated!==null){if(Qe===null){if(!_r)throw Error(ee(318));if(_r=tt.memoizedState,_r=_r!==null?_r.dehydrated:null,!_r)throw Error(ee(317));_r[wo]=tt}else $a(),!(tt.flags&128)&&(tt.memoizedState=null),tt.flags|=4;Hs(tt),_r=!1}else Eo!==null&&(th(Eo),Eo=null),_r=!0;if(!_r)return tt.flags&65536?tt:null}return tt.flags&128?(tt.lanes=st,tt):(ut=ut!==null,ut!==(Qe!==null&&Qe.memoizedState!==null)&&ut&&(tt.child.flags|=8192,tt.mode&1&&(Qe===null||ws.current&1?Ds===0&&(Ds=3):ih())),tt.updateQueue!==null&&(tt.flags|=4),Hs(tt),null);case 4:return ka(),ju(Qe,tt),Qe===null&&il(tt.stateNode.containerInfo),Hs(tt),null;case 10:return Eu(tt.type._context),Hs(tt),null;case 17:return qs(tt.type)&&Wl(),Hs(tt),null;case 19:if(Ss(ws),_r=tt.memoizedState,_r===null)return Hs(tt),null;if(ut=(tt.flags&128)!==0,ti=_r.rendering,ti===null)if(ut)yl(_r,!1);else{if(Ds!==0||Qe!==null&&Qe.flags&128)for(Qe=tt.child;Qe!==null;){if(ti=sc(Qe),ti!==null){for(tt.flags|=128,yl(_r,!1),ut=ti.updateQueue,ut!==null&&(tt.updateQueue=ut,tt.flags|=4),tt.subtreeFlags=0,ut=st,st=tt.child;st!==null;)_r=st,Qe=ut,_r.flags&=14680066,ti=_r.alternate,ti===null?(_r.childLanes=0,_r.lanes=Qe,_r.child=null,_r.subtreeFlags=0,_r.memoizedProps=null,_r.memoizedState=null,_r.updateQueue=null,_r.dependencies=null,_r.stateNode=null):(_r.childLanes=ti.childLanes,_r.lanes=ti.lanes,_r.child=ti.child,_r.subtreeFlags=0,_r.deletions=null,_r.memoizedProps=ti.memoizedProps,_r.memoizedState=ti.memoizedState,_r.updateQueue=ti.updateQueue,_r.type=ti.type,Qe=ti.dependencies,_r.dependencies=Qe===null?null:{lanes:Qe.lanes,firstContext:Qe.firstContext}),st=st.sibling;return Es(ws,ws.current&1|2),tt.child}Qe=Qe.sibling}_r.tail!==null&&As()>Ua&&(tt.flags|=128,ut=!0,yl(_r,!1),tt.lanes=4194304)}else{if(!ut)if(Qe=sc(ti),Qe!==null){if(tt.flags|=128,ut=!0,st=Qe.updateQueue,st!==null&&(tt.updateQueue=st,tt.flags|=4),yl(_r,!0),_r.tail===null&&_r.tailMode==="hidden"&&!ti.alternate&&!xs)return Hs(tt),null}else 2*As()-_r.renderingStartTime>Ua&&st!==1073741824&&(tt.flags|=128,ut=!0,yl(_r,!1),tt.lanes=4194304);_r.isBackwards?(ti.sibling=tt.child,tt.child=ti):(st=_r.last,st!==null?st.sibling=ti:tt.child=ti,_r.last=ti)}return _r.tail!==null?(tt=_r.tail,_r.rendering=tt,_r.tail=tt.sibling,_r.renderingStartTime=As(),tt.sibling=null,st=ws.current,Es(ws,ut?st&1|2:st&1),tt):(Hs(tt),null);case 22:case 23:return nh(),ut=tt.memoizedState!==null,Qe!==null&&Qe.memoizedState!==null!==ut&&(tt.flags|=8192),ut&&tt.mode&1?so&1073741824&&(Hs(tt),tt.subtreeFlags&6&&(tt.flags|=8192)):Hs(tt),null;case 24:return null;case 25:return null}throw Error(ee(156,tt.tag))}function wg(Qe,tt){switch(fu(tt),tt.tag){case 1:return qs(tt.type)&&Wl(),Qe=tt.flags,Qe&65536?(tt.flags=Qe&-65537|128,tt):null;case 3:return ka(),Ss(Ks),Ss(Us),Au(),Qe=tt.flags,Qe&65536&&!(Qe&128)?(tt.flags=Qe&-65537|128,tt):null;case 5:return Cu(tt),null;case 13:if(Ss(ws),Qe=tt.memoizedState,Qe!==null&&Qe.dehydrated!==null){if(tt.alternate===null)throw Error(ee(340));$a()}return Qe=tt.flags,Qe&65536?(tt.flags=Qe&-65537|128,tt):null;case 19:return Ss(ws),null;case 4:return ka(),null;case 10:return Eu(tt.type._context),null;case 22:case 23:return nh(),null;case 24:return null;default:return null}}var fc=!1,Vs=!1,Cg=typeof WeakSet=="function"?WeakSet:Set,zi=null;function Fa(Qe,tt){var st=Qe.ref;if(st!==null)if(typeof st=="function")try{st(null)}catch(ut){Rs(Qe,tt,ut)}else st.current=null}function bf(Qe,tt,st){try{st()}catch(ut){Rs(Qe,tt,ut)}}var Sf=!1;function Rg(Qe,tt){if(iu=$l,Qe=qh(),Xc(Qe)){if("selectionStart"in Qe)var st={start:Qe.selectionStart,end:Qe.selectionEnd};else e:{st=(st=Qe.ownerDocument)&&st.defaultView||window;var ut=st.getSelection&&st.getSelection();if(ut&&ut.rangeCount!==0){st=ut.anchorNode;var pt=ut.anchorOffset,_r=ut.focusNode;ut=ut.focusOffset;try{st.nodeType,_r.nodeType}catch{st=null;break e}var ti=0,fi=-1,vi=-1,_i=0,Li=0,Oi=Qe,Pi=null;t:for(;;){for(var Hi;Oi!==st||pt!==0&&Oi.nodeType!==3||(fi=ti+pt),Oi!==_r||ut!==0&&Oi.nodeType!==3||(vi=ti+ut),Oi.nodeType===3&&(ti+=Oi.nodeValue.length),(Hi=Oi.firstChild)!==null;)Pi=Oi,Oi=Hi;for(;;){if(Oi===Qe)break t;if(Pi===st&&++_i===pt&&(fi=ti),Pi===_r&&++Li===ut&&(vi=ti),(Hi=Oi.nextSibling)!==null)break;Oi=Pi,Pi=Oi.parentNode}Oi=Hi}st=fi===-1||vi===-1?null:{start:fi,end:vi}}else st=null}st=st||{start:0,end:0}}else st=null;for(su={focusedElem:Qe,selectionRange:st},$l=!1,zi=tt;zi!==null;)if(tt=zi,Qe=tt.child,(tt.subtreeFlags&1028)!==0&&Qe!==null)Qe.return=tt,zi=Qe;else for(;zi!==null;){tt=zi;try{var ji=tt.alternate;if(tt.flags&1024)switch(tt.tag){case 0:case 11:case 15:break;case 1:if(ji!==null){var Wi=ji.memoizedProps,Is=ji.memoizedState,bi=tt.stateNode,Ti=bi.getSnapshotBeforeUpdate(tt.elementType===tt.type?Wi:To(tt.type,Wi),Is);bi.__reactInternalSnapshotBeforeUpdate=Ti}break;case 3:var xi=tt.stateNode.containerInfo;xi.nodeType===1?xi.textContent="":xi.nodeType===9&&xi.documentElement&&xi.removeChild(xi.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ee(163))}}catch(Fi){Rs(tt,tt.return,Fi)}if(Qe=tt.sibling,Qe!==null){Qe.return=tt.return,zi=Qe;break}zi=tt.return}return ji=Sf,Sf=!1,ji}function vl(Qe,tt,st){var ut=tt.updateQueue;if(ut=ut!==null?ut.lastEffect:null,ut!==null){var pt=ut=ut.next;do{if((pt.tag&Qe)===Qe){var _r=pt.destroy;pt.destroy=void 0,_r!==void 0&&bf(tt,st,_r)}pt=pt.next}while(pt!==ut)}}function pc(Qe,tt){if(tt=tt.updateQueue,tt=tt!==null?tt.lastEffect:null,tt!==null){var st=tt=tt.next;do{if((st.tag&Qe)===Qe){var ut=st.create;st.destroy=ut()}st=st.next}while(st!==tt)}}function Wu(Qe){var tt=Qe.ref;if(tt!==null){var st=Qe.stateNode;switch(Qe.tag){case 5:Qe=st;break;default:Qe=st}typeof tt=="function"?tt(Qe):tt.current=Qe}}function xf(Qe){var tt=Qe.alternate;tt!==null&&(Qe.alternate=null,xf(tt)),Qe.child=null,Qe.deletions=null,Qe.sibling=null,Qe.tag===5&&(tt=Qe.stateNode,tt!==null&&(delete tt[wo],delete tt[ol],delete tt[cu],delete tt[cg],delete tt[ug])),Qe.stateNode=null,Qe.return=null,Qe.dependencies=null,Qe.memoizedProps=null,Qe.memoizedState=null,Qe.pendingProps=null,Qe.stateNode=null,Qe.updateQueue=null}function _f(Qe){return Qe.tag===5||Qe.tag===3||Qe.tag===4}function wf(Qe){e:for(;;){for(;Qe.sibling===null;){if(Qe.return===null||_f(Qe.return))return null;Qe=Qe.return}for(Qe.sibling.return=Qe.return,Qe=Qe.sibling;Qe.tag!==5&&Qe.tag!==6&&Qe.tag!==18;){if(Qe.flags&2||Qe.child===null||Qe.tag===4)continue e;Qe.child.return=Qe,Qe=Qe.child}if(!(Qe.flags&2))return Qe.stateNode}}function Yu(Qe,tt,st){var ut=Qe.tag;if(ut===5||ut===6)Qe=Qe.stateNode,tt?st.nodeType===8?st.parentNode.insertBefore(Qe,tt):st.insertBefore(Qe,tt):(st.nodeType===8?(tt=st.parentNode,tt.insertBefore(Qe,st)):(tt=st,tt.appendChild(Qe)),st=st._reactRootContainer,st!=null||tt.onclick!==null||(tt.onclick=zl));else if(ut!==4&&(Qe=Qe.child,Qe!==null))for(Yu(Qe,tt,st),Qe=Qe.sibling;Qe!==null;)Yu(Qe,tt,st),Qe=Qe.sibling}function Ku(Qe,tt,st){var ut=Qe.tag;if(ut===5||ut===6)Qe=Qe.stateNode,tt?st.insertBefore(Qe,tt):st.appendChild(Qe);else if(ut!==4&&(Qe=Qe.child,Qe!==null))for(Ku(Qe,tt,st),Qe=Qe.sibling;Qe!==null;)Ku(Qe,tt,st),Qe=Qe.sibling}var Fs=null,bo=!1;function Xo(Qe,tt,st){for(st=st.child;st!==null;)Cf(Qe,tt,st),st=st.sibling}function Cf(Qe,tt,st){if(_o&&typeof _o.onCommitFiberUnmount=="function")try{_o.onCommitFiberUnmount(Cl,st)}catch{}switch(st.tag){case 5:Vs||Fa(st,tt);case 6:var ut=Fs,pt=bo;Fs=null,Xo(Qe,tt,st),Fs=ut,bo=pt,Fs!==null&&(bo?(Qe=Fs,st=st.stateNode,Qe.nodeType===8?Qe.parentNode.removeChild(st):Qe.removeChild(st)):Fs.removeChild(st.stateNode));break;case 18:Fs!==null&&(bo?(Qe=Fs,st=st.stateNode,Qe.nodeType===8?lu(Qe.parentNode,st):Qe.nodeType===1&&lu(Qe,st),qa(Qe)):lu(Fs,st.stateNode));break;case 4:ut=Fs,pt=bo,Fs=st.stateNode.containerInfo,bo=!0,Xo(Qe,tt,st),Fs=ut,bo=pt;break;case 0:case 11:case 14:case 15:if(!Vs&&(ut=st.updateQueue,ut!==null&&(ut=ut.lastEffect,ut!==null))){pt=ut=ut.next;do{var _r=pt,ti=_r.destroy;_r=_r.tag,ti!==void 0&&(_r&2||_r&4)&&bf(st,tt,ti),pt=pt.next}while(pt!==ut)}Xo(Qe,tt,st);break;case 1:if(!Vs&&(Fa(st,tt),ut=st.stateNode,typeof ut.componentWillUnmount=="function"))try{ut.props=st.memoizedProps,ut.state=st.memoizedState,ut.componentWillUnmount()}catch(fi){Rs(st,tt,fi)}Xo(Qe,tt,st);break;case 21:Xo(Qe,tt,st);break;case 22:st.mode&1?(Vs=(ut=Vs)||st.memoizedState!==null,Xo(Qe,tt,st),Vs=ut):Xo(Qe,tt,st);break;default:Xo(Qe,tt,st)}}function Rf(Qe){var tt=Qe.updateQueue;if(tt!==null){Qe.updateQueue=null;var st=Qe.stateNode;st===null&&(st=Qe.stateNode=new Cg),tt.forEach(function(ut){var pt=kg.bind(null,Qe,ut);st.has(ut)||(st.add(ut),ut.then(pt,pt))})}}function So(Qe,tt){var st=tt.deletions;if(st!==null)for(var ut=0;ut<st.length;ut++){var pt=st[ut];try{var _r=Qe,ti=tt,fi=ti;e:for(;fi!==null;){switch(fi.tag){case 5:Fs=fi.stateNode,bo=!1;break e;case 3:Fs=fi.stateNode.containerInfo,bo=!0;break e;case 4:Fs=fi.stateNode.containerInfo,bo=!0;break e}fi=fi.return}if(Fs===null)throw Error(ee(160));Cf(_r,ti,pt),Fs=null,bo=!1;var vi=pt.alternate;vi!==null&&(vi.return=null),pt.return=null}catch(_i){Rs(pt,tt,_i)}}if(tt.subtreeFlags&12854)for(tt=tt.child;tt!==null;)Af(tt,Qe),tt=tt.sibling}function Af(Qe,tt){var st=Qe.alternate,ut=Qe.flags;switch(Qe.tag){case 0:case 11:case 14:case 15:if(So(tt,Qe),Ao(Qe),ut&4){try{vl(3,Qe,Qe.return),pc(3,Qe)}catch(Wi){Rs(Qe,Qe.return,Wi)}try{vl(5,Qe,Qe.return)}catch(Wi){Rs(Qe,Qe.return,Wi)}}break;case 1:So(tt,Qe),Ao(Qe),ut&512&&st!==null&&Fa(st,st.return);break;case 5:if(So(tt,Qe),Ao(Qe),ut&512&&st!==null&&Fa(st,st.return),Qe.flags&32){var pt=Qe.stateNode;try{Ts(pt,"")}catch(Wi){Rs(Qe,Qe.return,Wi)}}if(ut&4&&(pt=Qe.stateNode,pt!=null)){var _r=Qe.memoizedProps,ti=st!==null?st.memoizedProps:_r,fi=Qe.type,vi=Qe.updateQueue;if(Qe.updateQueue=null,vi!==null)try{fi==="input"&&_r.type==="radio"&&_r.name!=null&&Ii(pt,_r),pi(fi,ti);var _i=pi(fi,_r);for(ti=0;ti<vi.length;ti+=2){var Li=vi[ti],Oi=vi[ti+1];Li==="style"?No(pt,Oi):Li==="dangerouslySetInnerHTML"?Zs(pt,Oi):Li==="children"?Ts(pt,Oi):gt(pt,Li,Oi,_i)}switch(fi){case"input":Di(pt,_r);break;case"textarea":ds(pt,_r);break;case"select":var Pi=pt._wrapperState.wasMultiple;pt._wrapperState.wasMultiple=!!_r.multiple;var Hi=_r.value;Hi!=null?Zi(pt,!!_r.multiple,Hi,!1):Pi!==!!_r.multiple&&(_r.defaultValue!=null?Zi(pt,!!_r.multiple,_r.defaultValue,!0):Zi(pt,!!_r.multiple,_r.multiple?[]:"",!1))}pt[ol]=_r}catch(Wi){Rs(Qe,Qe.return,Wi)}}break;case 6:if(So(tt,Qe),Ao(Qe),ut&4){if(Qe.stateNode===null)throw Error(ee(162));pt=Qe.stateNode,_r=Qe.memoizedProps;try{pt.nodeValue=_r}catch(Wi){Rs(Qe,Qe.return,Wi)}}break;case 3:if(So(tt,Qe),Ao(Qe),ut&4&&st!==null&&st.memoizedState.isDehydrated)try{qa(tt.containerInfo)}catch(Wi){Rs(Qe,Qe.return,Wi)}break;case 4:So(tt,Qe),Ao(Qe);break;case 13:So(tt,Qe),Ao(Qe),pt=Qe.child,pt.flags&8192&&(_r=pt.memoizedState!==null,pt.stateNode.isHidden=_r,!_r||pt.alternate!==null&&pt.alternate.memoizedState!==null||(Qu=As())),ut&4&&Rf(Qe);break;case 22:if(Li=st!==null&&st.memoizedState!==null,Qe.mode&1?(Vs=(_i=Vs)||Li,So(tt,Qe),Vs=_i):So(tt,Qe),Ao(Qe),ut&8192){if(_i=Qe.memoizedState!==null,(Qe.stateNode.isHidden=_i)&&!Li&&Qe.mode&1)for(zi=Qe,Li=Qe.child;Li!==null;){for(Oi=zi=Li;zi!==null;){switch(Pi=zi,Hi=Pi.child,Pi.tag){case 0:case 11:case 14:case 15:vl(4,Pi,Pi.return);break;case 1:Fa(Pi,Pi.return);var ji=Pi.stateNode;if(typeof ji.componentWillUnmount=="function"){ut=Pi,st=Pi.return;try{tt=ut,ji.props=tt.memoizedProps,ji.state=tt.memoizedState,ji.componentWillUnmount()}catch(Wi){Rs(ut,st,Wi)}}break;case 5:Fa(Pi,Pi.return);break;case 22:if(Pi.memoizedState!==null){Lf(Oi);continue}}Hi!==null?(Hi.return=Pi,zi=Hi):Lf(Oi)}Li=Li.sibling}e:for(Li=null,Oi=Qe;;){if(Oi.tag===5){if(Li===null){Li=Oi;try{pt=Oi.stateNode,_i?(_r=pt.style,typeof _r.setProperty=="function"?_r.setProperty("display","none","important"):_r.display="none"):(fi=Oi.stateNode,vi=Oi.memoizedProps.style,ti=vi!=null&&vi.hasOwnProperty("display")?vi.display:null,fi.style.display=na("display",ti))}catch(Wi){Rs(Qe,Qe.return,Wi)}}}else if(Oi.tag===6){if(Li===null)try{Oi.stateNode.nodeValue=_i?"":Oi.memoizedProps}catch(Wi){Rs(Qe,Qe.return,Wi)}}else if((Oi.tag!==22&&Oi.tag!==23||Oi.memoizedState===null||Oi===Qe)&&Oi.child!==null){Oi.child.return=Oi,Oi=Oi.child;continue}if(Oi===Qe)break e;for(;Oi.sibling===null;){if(Oi.return===null||Oi.return===Qe)break e;Li===Oi&&(Li=null),Oi=Oi.return}Li===Oi&&(Li=null),Oi.sibling.return=Oi.return,Oi=Oi.sibling}}break;case 19:So(tt,Qe),Ao(Qe),ut&4&&Rf(Qe);break;case 21:break;default:So(tt,Qe),Ao(Qe)}}function Ao(Qe){var tt=Qe.flags;if(tt&2){try{e:{for(var st=Qe.return;st!==null;){if(_f(st)){var ut=st;break e}st=st.return}throw Error(ee(160))}switch(ut.tag){case 5:var pt=ut.stateNode;ut.flags&32&&(Ts(pt,""),ut.flags&=-33);var _r=wf(Qe);Ku(Qe,_r,pt);break;case 3:case 4:var ti=ut.stateNode.containerInfo,fi=wf(Qe);Yu(Qe,fi,ti);break;default:throw Error(ee(161))}}catch(vi){Rs(Qe,Qe.return,vi)}Qe.flags&=-3}tt&4096&&(Qe.flags&=-4097)}function Ag(Qe,tt,st){zi=Qe,If(Qe)}function If(Qe,tt,st){for(var ut=(Qe.mode&1)!==0;zi!==null;){var pt=zi,_r=pt.child;if(pt.tag===22&&ut){var ti=pt.memoizedState!==null||fc;if(!ti){var fi=pt.alternate,vi=fi!==null&&fi.memoizedState!==null||Vs;fi=fc;var _i=Vs;if(fc=ti,(Vs=vi)&&!_i)for(zi=pt;zi!==null;)ti=zi,vi=ti.child,ti.tag===22&&ti.memoizedState!==null?$f(pt):vi!==null?(vi.return=ti,zi=vi):$f(pt);for(;_r!==null;)zi=_r,If(_r),_r=_r.sibling;zi=pt,fc=fi,Vs=_i}Pf(Qe)}else pt.subtreeFlags&8772&&_r!==null?(_r.return=pt,zi=_r):Pf(Qe)}}function Pf(Qe){for(;zi!==null;){var tt=zi;if(tt.flags&8772){var st=tt.alternate;try{if(tt.flags&8772)switch(tt.tag){case 0:case 11:case 15:Vs||pc(5,tt);break;case 1:var ut=tt.stateNode;if(tt.flags&4&&!Vs)if(st===null)ut.componentDidMount();else{var pt=tt.elementType===tt.type?st.memoizedProps:To(tt.type,st.memoizedProps);ut.componentDidUpdate(pt,st.memoizedState,ut.__reactInternalSnapshotBeforeUpdate)}var _r=tt.updateQueue;_r!==null&&wd(tt,_r,ut);break;case 3:var ti=tt.updateQueue;if(ti!==null){if(st=null,tt.child!==null)switch(tt.child.tag){case 5:st=tt.child.stateNode;break;case 1:st=tt.child.stateNode}wd(tt,ti,st)}break;case 5:var fi=tt.stateNode;if(st===null&&tt.flags&4){st=fi;var vi=tt.memoizedProps;switch(tt.type){case"button":case"input":case"select":case"textarea":vi.autoFocus&&st.focus();break;case"img":vi.src&&(st.src=vi.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(tt.memoizedState===null){var _i=tt.alternate;if(_i!==null){var Li=_i.memoizedState;if(Li!==null){var Oi=Li.dehydrated;Oi!==null&&qa(Oi)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ee(163))}Vs||tt.flags&512&&Wu(tt)}catch(Pi){Rs(tt,tt.return,Pi)}}if(tt===Qe){zi=null;break}if(st=tt.sibling,st!==null){st.return=tt.return,zi=st;break}zi=tt.return}}function Lf(Qe){for(;zi!==null;){var tt=zi;if(tt===Qe){zi=null;break}var st=tt.sibling;if(st!==null){st.return=tt.return,zi=st;break}zi=tt.return}}function $f(Qe){for(;zi!==null;){var tt=zi;try{switch(tt.tag){case 0:case 11:case 15:var st=tt.return;try{pc(4,tt)}catch(vi){Rs(tt,st,vi)}break;case 1:var ut=tt.stateNode;if(typeof ut.componentDidMount=="function"){var pt=tt.return;try{ut.componentDidMount()}catch(vi){Rs(tt,pt,vi)}}var _r=tt.return;try{Wu(tt)}catch(vi){Rs(tt,_r,vi)}break;case 5:var ti=tt.return;try{Wu(tt)}catch(vi){Rs(tt,ti,vi)}}}catch(vi){Rs(tt,tt.return,vi)}if(tt===Qe){zi=null;break}var fi=tt.sibling;if(fi!==null){fi.return=tt.return,zi=fi;break}zi=tt.return}}var Ig=Math.ceil,gc=mt.ReactCurrentDispatcher,qu=mt.ReactCurrentOwner,fo=mt.ReactCurrentBatchConfig,ps=0,ks=null,Ls=null,Bs=0,so=0,Ba=jo(0),Ds=0,El=null,pa=0,mc=0,Xu=0,Tl=null,Qs=null,Qu=0,Ua=1/0,ko=null,yc=!1,Ju=null,Qo=null,vc=!1,Jo=null,Ec=0,bl=0,Zu=null,Tc=-1,bc=0;function Ws(){return ps&6?As():Tc!==-1?Tc:Tc=As()}function Zo(Qe){return Qe.mode&1?ps&2&&Bs!==0?Bs&-Bs:dg.transition!==null?(bc===0&&(bc=Th()),bc):(Qe=ys,Qe!==0||(Qe=window.event,Qe=Qe===void 0?16:Ih(Qe.type)),Qe):1}function xo(Qe,tt,st,ut){if(50<bl)throw bl=0,Zu=null,Error(ee(185));za(Qe,st,ut),(!(ps&2)||Qe!==ks)&&(Qe===ks&&(!(ps&2)&&(mc|=st),Ds===4&&ea(Qe,Bs)),Js(Qe,ut),st===1&&ps===0&&!(tt.mode&1)&&(Ua=As()+500,Kl&&Yo()))}function Js(Qe,tt){var st=Qe.callbackNode;dp(Qe,tt);var ut=Il(Qe,Qe===ks?Bs:0);if(ut===0)st!==null&&yh(st),Qe.callbackNode=null,Qe.callbackPriority=0;else if(tt=ut&-ut,Qe.callbackPriority!==tt){if(st!=null&&yh(st),tt===1)Qe.tag===0?hg(Of.bind(null,Qe)):md(Of.bind(null,Qe)),ag(function(){!(ps&6)&&Yo()}),st=null;else{switch(bh(ut)){case 1:st=Dc;break;case 4:st=vh;break;case 16:st=wl;break;case 536870912:st=Eh;break;default:st=wl}st=Hf(st,Df.bind(null,Qe))}Qe.callbackPriority=tt,Qe.callbackNode=st}}function Df(Qe,tt){if(Tc=-1,bc=0,ps&6)throw Error(ee(327));var st=Qe.callbackNode;if(Ga()&&Qe.callbackNode!==st)return null;var ut=Il(Qe,Qe===ks?Bs:0);if(ut===0)return null;if(ut&30||ut&Qe.expiredLanes||tt)tt=xc(Qe,ut);else{tt=ut;var pt=ps;ps|=2;var _r=kf();(ks!==Qe||Bs!==tt)&&(ko=null,Ua=As()+500,ma(Qe,tt));do try{$g();break}catch(fi){Mf(Qe,fi)}while(!0);vu(),gc.current=_r,ps=pt,Ls!==null?tt=0:(ks=null,Bs=0,tt=Ds)}if(tt!==0){if(tt===2&&(pt=Oc(Qe),pt!==0&&(ut=pt,tt=eh(Qe,pt))),tt===1)throw st=El,ma(Qe,0),ea(Qe,ut),Js(Qe,As()),st;if(tt===6)ea(Qe,ut);else{if(pt=Qe.current.alternate,!(ut&30)&&!Pg(pt)&&(tt=xc(Qe,ut),tt===2&&(_r=Oc(Qe),_r!==0&&(ut=_r,tt=eh(Qe,_r))),tt===1))throw st=El,ma(Qe,0),ea(Qe,ut),Js(Qe,As()),st;switch(Qe.finishedWork=pt,Qe.finishedLanes=ut,tt){case 0:case 1:throw Error(ee(345));case 2:ya(Qe,Qs,ko);break;case 3:if(ea(Qe,ut),(ut&130023424)===ut&&(tt=Qu+500-As(),10<tt)){if(Il(Qe,0)!==0)break;if(pt=Qe.suspendedLanes,(pt&ut)!==ut){Ws(),Qe.pingedLanes|=Qe.suspendedLanes&pt;break}Qe.timeoutHandle=au(ya.bind(null,Qe,Qs,ko),tt);break}ya(Qe,Qs,ko);break;case 4:if(ea(Qe,ut),(ut&4194240)===ut)break;for(tt=Qe.eventTimes,pt=-1;0<ut;){var ti=31-yo(ut);_r=1<<ti,ti=tt[ti],ti>pt&&(pt=ti),ut&=~_r}if(ut=pt,ut=As()-ut,ut=(120>ut?120:480>ut?480:1080>ut?1080:1920>ut?1920:3e3>ut?3e3:4320>ut?4320:1960*Ig(ut/1960))-ut,10<ut){Qe.timeoutHandle=au(ya.bind(null,Qe,Qs,ko),ut);break}ya(Qe,Qs,ko);break;case 5:ya(Qe,Qs,ko);break;default:throw Error(ee(329))}}}return Js(Qe,As()),Qe.callbackNode===st?Df.bind(null,Qe):null}function eh(Qe,tt){var st=Tl;return Qe.current.memoizedState.isDehydrated&&(ma(Qe,tt).flags|=256),Qe=xc(Qe,tt),Qe!==2&&(tt=Qs,Qs=st,tt!==null&&th(tt)),Qe}function th(Qe){Qs===null?Qs=Qe:Qs.push.apply(Qs,Qe)}function Pg(Qe){for(var tt=Qe;;){if(tt.flags&16384){var st=tt.updateQueue;if(st!==null&&(st=st.stores,st!==null))for(var ut=0;ut<st.length;ut++){var pt=st[ut],_r=pt.getSnapshot;pt=pt.value;try{if(!vo(_r(),pt))return!1}catch{return!1}}}if(st=tt.child,tt.subtreeFlags&16384&&st!==null)st.return=tt,tt=st;else{if(tt===Qe)break;for(;tt.sibling===null;){if(tt.return===null||tt.return===Qe)return!0;tt=tt.return}tt.sibling.return=tt.return,tt=tt.sibling}}return!0}function ea(Qe,tt){for(tt&=~Xu,tt&=~mc,Qe.suspendedLanes|=tt,Qe.pingedLanes&=~tt,Qe=Qe.expirationTimes;0<tt;){var st=31-yo(tt),ut=1<<st;Qe[st]=-1,tt&=~ut}}function Of(Qe){if(ps&6)throw Error(ee(327));Ga();var tt=Il(Qe,0);if(!(tt&1))return Js(Qe,As()),null;var st=xc(Qe,tt);if(Qe.tag!==0&&st===2){var ut=Oc(Qe);ut!==0&&(tt=ut,st=eh(Qe,ut))}if(st===1)throw st=El,ma(Qe,0),ea(Qe,tt),Js(Qe,As()),st;if(st===6)throw Error(ee(345));return Qe.finishedWork=Qe.current.alternate,Qe.finishedLanes=tt,ya(Qe,Qs,ko),Js(Qe,As()),null}function rh(Qe,tt){var st=ps;ps|=1;try{return Qe(tt)}finally{ps=st,ps===0&&(Ua=As()+500,Kl&&Yo())}}function ga(Qe){Jo!==null&&Jo.tag===0&&!(ps&6)&&Ga();var tt=ps;ps|=1;var st=fo.transition,ut=ys;try{if(fo.transition=null,ys=1,Qe)return Qe()}finally{ys=ut,fo.transition=st,ps=tt,!(ps&6)&&Yo()}}function nh(){so=Ba.current,Ss(Ba)}function ma(Qe,tt){Qe.finishedWork=null,Qe.finishedLanes=0;var st=Qe.timeoutHandle;if(st!==-1&&(Qe.timeoutHandle=-1,og(st)),Ls!==null)for(st=Ls.return;st!==null;){var ut=st;switch(fu(ut),ut.tag){case 1:ut=ut.type.childContextTypes,ut!=null&&Wl();break;case 3:ka(),Ss(Ks),Ss(Us),Au();break;case 5:Cu(ut);break;case 4:ka();break;case 13:Ss(ws);break;case 19:Ss(ws);break;case 10:Eu(ut.type._context);break;case 22:case 23:nh()}st=st.return}if(ks=Qe,Ls=Qe=ta(Qe.current,null),Bs=so=tt,Ds=0,El=null,Xu=mc=pa=0,Qs=Tl=null,ha!==null){for(tt=0;tt<ha.length;tt++)if(st=ha[tt],ut=st.interleaved,ut!==null){st.interleaved=null;var pt=ut.next,_r=st.pending;if(_r!==null){var ti=_r.next;_r.next=pt,ut.next=ti}st.pending=ut}ha=null}return Qe}function Mf(Qe,tt){do{var st=Ls;try{if(vu(),oc.current=uc,ac){for(var ut=Cs.memoizedState;ut!==null;){var pt=ut.queue;pt!==null&&(pt.pending=null),ut=ut.next}ac=!1}if(fa=0,Ms=$s=Cs=null,dl=!1,pl=0,qu.current=null,st===null||st.return===null){Ds=1,El=tt,Ls=null;break}e:{var _r=Qe,ti=st.return,fi=st,vi=tt;if(tt=Bs,fi.flags|=32768,vi!==null&&typeof vi=="object"&&typeof vi.then=="function"){var _i=vi,Li=fi,Oi=Li.tag;if(!(Li.mode&1)&&(Oi===0||Oi===11||Oi===15)){var Pi=Li.alternate;Pi?(Li.updateQueue=Pi.updateQueue,Li.memoizedState=Pi.memoizedState,Li.lanes=Pi.lanes):(Li.updateQueue=null,Li.memoizedState=null)}var Hi=sf(ti);if(Hi!==null){Hi.flags&=-257,of(Hi,ti,fi,_r,tt),Hi.mode&1&&nf(_r,_i,tt),tt=Hi,vi=_i;var ji=tt.updateQueue;if(ji===null){var Wi=new Set;Wi.add(vi),tt.updateQueue=Wi}else ji.add(vi);break e}else{if(!(tt&1)){nf(_r,_i,tt),ih();break e}vi=Error(ee(426))}}else if(xs&&fi.mode&1){var Is=sf(ti);if(Is!==null){!(Is.flags&65536)&&(Is.flags|=256),of(Is,ti,fi,_r,tt),mu(Na(vi,fi));break e}}_r=vi=Na(vi,fi),Ds!==4&&(Ds=2),Tl===null?Tl=[_r]:Tl.push(_r),_r=ti;do{switch(_r.tag){case 3:_r.flags|=65536,tt&=-tt,_r.lanes|=tt;var bi=tf(_r,vi,tt);_d(_r,bi);break e;case 1:fi=vi;var Ti=_r.type,xi=_r.stateNode;if(!(_r.flags&128)&&(typeof Ti.getDerivedStateFromError=="function"||xi!==null&&typeof xi.componentDidCatch=="function"&&(Qo===null||!Qo.has(xi)))){_r.flags|=65536,tt&=-tt,_r.lanes|=tt;var Fi=rf(_r,fi,tt);_d(_r,Fi);break e}}_r=_r.return}while(_r!==null)}Ff(st)}catch(qi){tt=qi,Ls===st&&st!==null&&(Ls=st=st.return);continue}break}while(!0)}function kf(){var Qe=gc.current;return gc.current=uc,Qe===null?uc:Qe}function ih(){(Ds===0||Ds===3||Ds===2)&&(Ds=4),ks===null||!(pa&268435455)&&!(mc&268435455)||ea(ks,Bs)}function xc(Qe,tt){var st=ps;ps|=2;var ut=kf();(ks!==Qe||Bs!==tt)&&(ko=null,ma(Qe,tt));do try{Lg();break}catch(pt){Mf(Qe,pt)}while(!0);if(vu(),ps=st,gc.current=ut,Ls!==null)throw Error(ee(261));return ks=null,Bs=0,Ds}function Lg(){for(;Ls!==null;)Nf(Ls)}function $g(){for(;Ls!==null&&!np();)Nf(Ls)}function Nf(Qe){var tt=Gf(Qe.alternate,Qe,so);Qe.memoizedProps=Qe.pendingProps,tt===null?Ff(Qe):Ls=tt,qu.current=null}function Ff(Qe){var tt=Qe;do{var st=tt.alternate;if(Qe=tt.return,tt.flags&32768){if(st=wg(st,tt),st!==null){st.flags&=32767,Ls=st;return}if(Qe!==null)Qe.flags|=32768,Qe.subtreeFlags=0,Qe.deletions=null;else{Ds=6,Ls=null;return}}else if(st=_g(st,tt,so),st!==null){Ls=st;return}if(tt=tt.sibling,tt!==null){Ls=tt;return}Ls=tt=Qe}while(tt!==null);Ds===0&&(Ds=5)}function ya(Qe,tt,st){var ut=ys,pt=fo.transition;try{fo.transition=null,ys=1,Dg(Qe,tt,st,ut)}finally{fo.transition=pt,ys=ut}return null}function Dg(Qe,tt,st,ut){do Ga();while(Jo!==null);if(ps&6)throw Error(ee(327));st=Qe.finishedWork;var pt=Qe.finishedLanes;if(st===null)return null;if(Qe.finishedWork=null,Qe.finishedLanes=0,st===Qe.current)throw Error(ee(177));Qe.callbackNode=null,Qe.callbackPriority=0;var _r=st.lanes|st.childLanes;if(fp(Qe,_r),Qe===ks&&(Ls=ks=null,Bs=0),!(st.subtreeFlags&2064)&&!(st.flags&2064)||vc||(vc=!0,Hf(wl,function(){return Ga(),null})),_r=(st.flags&15990)!==0,st.subtreeFlags&15990||_r){_r=fo.transition,fo.transition=null;var ti=ys;ys=1;var fi=ps;ps|=4,qu.current=null,Rg(Qe,st),Af(st,Qe),Zp(su),$l=!!iu,su=iu=null,Qe.current=st,Ag(st),ip(),ps=fi,ys=ti,fo.transition=_r}else Qe.current=st;if(vc&&(vc=!1,Jo=Qe,Ec=pt),_r=Qe.pendingLanes,_r===0&&(Qo=null),ap(st.stateNode),Js(Qe,As()),tt!==null)for(ut=Qe.onRecoverableError,st=0;st<tt.length;st++)pt=tt[st],ut(pt.value,{componentStack:pt.stack,digest:pt.digest});if(yc)throw yc=!1,Qe=Ju,Ju=null,Qe;return Ec&1&&Qe.tag!==0&&Ga(),_r=Qe.pendingLanes,_r&1?Qe===Zu?bl++:(bl=0,Zu=Qe):bl=0,Yo(),null}function Ga(){if(Jo!==null){var Qe=bh(Ec),tt=fo.transition,st=ys;try{if(fo.transition=null,ys=16>Qe?16:Qe,Jo===null)var ut=!1;else{if(Qe=Jo,Jo=null,Ec=0,ps&6)throw Error(ee(331));var pt=ps;for(ps|=4,zi=Qe.current;zi!==null;){var _r=zi,ti=_r.child;if(zi.flags&16){var fi=_r.deletions;if(fi!==null){for(var vi=0;vi<fi.length;vi++){var _i=fi[vi];for(zi=_i;zi!==null;){var Li=zi;switch(Li.tag){case 0:case 11:case 15:vl(8,Li,_r)}var Oi=Li.child;if(Oi!==null)Oi.return=Li,zi=Oi;else for(;zi!==null;){Li=zi;var Pi=Li.sibling,Hi=Li.return;if(xf(Li),Li===_i){zi=null;break}if(Pi!==null){Pi.return=Hi,zi=Pi;break}zi=Hi}}}var ji=_r.alternate;if(ji!==null){var Wi=ji.child;if(Wi!==null){ji.child=null;do{var Is=Wi.sibling;Wi.sibling=null,Wi=Is}while(Wi!==null)}}zi=_r}}if(_r.subtreeFlags&2064&&ti!==null)ti.return=_r,zi=ti;else e:for(;zi!==null;){if(_r=zi,_r.flags&2048)switch(_r.tag){case 0:case 11:case 15:vl(9,_r,_r.return)}var bi=_r.sibling;if(bi!==null){bi.return=_r.return,zi=bi;break e}zi=_r.return}}var Ti=Qe.current;for(zi=Ti;zi!==null;){ti=zi;var xi=ti.child;if(ti.subtreeFlags&2064&&xi!==null)xi.return=ti,zi=xi;else e:for(ti=Ti;zi!==null;){if(fi=zi,fi.flags&2048)try{switch(fi.tag){case 0:case 11:case 15:pc(9,fi)}}catch(qi){Rs(fi,fi.return,qi)}if(fi===ti){zi=null;break e}var Fi=fi.sibling;if(Fi!==null){Fi.return=fi.return,zi=Fi;break e}zi=fi.return}}if(ps=pt,Yo(),_o&&typeof _o.onPostCommitFiberRoot=="function")try{_o.onPostCommitFiberRoot(Cl,Qe)}catch{}ut=!0}return ut}finally{ys=st,fo.transition=tt}}return!1}function Bf(Qe,tt,st){tt=Na(st,tt),tt=tf(Qe,tt,1),Qe=qo(Qe,tt,1),tt=Ws(),Qe!==null&&(za(Qe,1,tt),Js(Qe,tt))}function Rs(Qe,tt,st){if(Qe.tag===3)Bf(Qe,Qe,st);else for(;tt!==null;){if(tt.tag===3){Bf(tt,Qe,st);break}else if(tt.tag===1){var ut=tt.stateNode;if(typeof tt.type.getDerivedStateFromError=="function"||typeof ut.componentDidCatch=="function"&&(Qo===null||!Qo.has(ut))){Qe=Na(st,Qe),Qe=rf(tt,Qe,1),tt=qo(tt,Qe,1),Qe=Ws(),tt!==null&&(za(tt,1,Qe),Js(tt,Qe));break}}tt=tt.return}}function Og(Qe,tt,st){var ut=Qe.pingCache;ut!==null&&ut.delete(tt),tt=Ws(),Qe.pingedLanes|=Qe.suspendedLanes&st,ks===Qe&&(Bs&st)===st&&(Ds===4||Ds===3&&(Bs&130023424)===Bs&&500>As()-Qu?ma(Qe,0):Xu|=st),Js(Qe,tt)}function Uf(Qe,tt){tt===0&&(Qe.mode&1?(tt=Al,Al<<=1,!(Al&130023424)&&(Al=4194304)):tt=1);var st=Ws();Qe=Do(Qe,tt),Qe!==null&&(za(Qe,tt,st),Js(Qe,st))}function Mg(Qe){var tt=Qe.memoizedState,st=0;tt!==null&&(st=tt.retryLane),Uf(Qe,st)}function kg(Qe,tt){var st=0;switch(Qe.tag){case 13:var ut=Qe.stateNode,pt=Qe.memoizedState;pt!==null&&(st=pt.retryLane);break;case 19:ut=Qe.stateNode;break;default:throw Error(ee(314))}ut!==null&&ut.delete(tt),Uf(Qe,st)}var Gf;Gf=function(Qe,tt,st){if(Qe!==null)if(Qe.memoizedProps!==tt.pendingProps||Ks.current)Xs=!0;else{if(!(Qe.lanes&st)&&!(tt.flags&128))return Xs=!1,xg(Qe,tt,st);Xs=!!(Qe.flags&131072)}else Xs=!1,xs&&tt.flags&1048576&&yd(tt,Xl,tt.index);switch(tt.lanes=0,tt.tag){case 2:var ut=tt.type;dc(Qe,tt),Qe=tt.pendingProps;var pt=Ia(tt,Us.current);Oa(tt,st),pt=Lu(null,tt,ut,Qe,pt,st);var _r=$u();return tt.flags|=1,typeof pt=="object"&&pt!==null&&typeof pt.render=="function"&&pt.$$typeof===void 0?(tt.tag=1,tt.memoizedState=null,tt.updateQueue=null,qs(ut)?(_r=!0,Yl(tt)):_r=!1,tt.memoizedState=pt.state!==null&&pt.state!==void 0?pt.state:null,Su(tt),pt.updater=nc,tt.stateNode=pt,pt._reactInternals=tt,_u(tt,ut,Qe,st),tt=Uu(null,tt,ut,!0,_r,st)):(tt.tag=0,xs&&_r&&du(tt),js(null,tt,pt,st),tt=tt.child),tt;case 16:ut=tt.elementType;e:{switch(dc(Qe,tt),Qe=tt.pendingProps,pt=ut._init,ut=pt(ut._payload),tt.type=ut,pt=tt.tag=Fg(ut),Qe=To(ut,Qe),pt){case 0:tt=Bu(null,tt,ut,Qe,st);break e;case 1:tt=df(null,tt,ut,Qe,st);break e;case 11:tt=af(null,tt,ut,Qe,st);break e;case 14:tt=lf(null,tt,ut,To(ut.type,Qe),st);break e}throw Error(ee(306,ut,""))}return tt;case 0:return ut=tt.type,pt=tt.pendingProps,pt=tt.elementType===ut?pt:To(ut,pt),Bu(Qe,tt,ut,pt,st);case 1:return ut=tt.type,pt=tt.pendingProps,pt=tt.elementType===ut?pt:To(ut,pt),df(Qe,tt,ut,pt,st);case 3:e:{if(ff(tt),Qe===null)throw Error(ee(387));ut=tt.pendingProps,_r=tt.memoizedState,pt=_r.element,xd(Qe,tt),rc(tt,ut,null,st);var ti=tt.memoizedState;if(ut=ti.element,_r.isDehydrated)if(_r={element:ut,isDehydrated:!1,cache:ti.cache,pendingSuspenseBoundaries:ti.pendingSuspenseBoundaries,transitions:ti.transitions},tt.updateQueue.baseState=_r,tt.memoizedState=_r,tt.flags&256){pt=Na(Error(ee(423)),tt),tt=pf(Qe,tt,ut,st,pt);break e}else if(ut!==pt){pt=Na(Error(ee(424)),tt),tt=pf(Qe,tt,ut,st,pt);break e}else for(io=zo(tt.stateNode.containerInfo.firstChild),no=tt,xs=!0,Eo=null,st=$d(tt,null,ut,st),tt.child=st;st;)st.flags=st.flags&-3|4096,st=st.sibling;else{if($a(),ut===pt){tt=Mo(Qe,tt,st);break e}js(Qe,tt,ut,st)}tt=tt.child}return tt;case 5:return Dd(tt),Qe===null&&gu(tt),ut=tt.type,pt=tt.pendingProps,_r=Qe!==null?Qe.memoizedProps:null,ti=pt.children,ou(ut,pt)?ti=null:_r!==null&&ou(ut,_r)&&(tt.flags|=32),hf(Qe,tt),js(Qe,tt,ti,st),tt.child;case 6:return Qe===null&&gu(tt),null;case 13:return gf(Qe,tt,st);case 4:return wu(tt,tt.stateNode.containerInfo),ut=tt.pendingProps,Qe===null?tt.child=Ma(tt,null,ut,st):js(Qe,tt,ut,st),tt.child;case 11:return ut=tt.type,pt=tt.pendingProps,pt=tt.elementType===ut?pt:To(ut,pt),af(Qe,tt,ut,pt,st);case 7:return js(Qe,tt,tt.pendingProps,st),tt.child;case 8:return js(Qe,tt,tt.pendingProps.children,st),tt.child;case 12:return js(Qe,tt,tt.pendingProps.children,st),tt.child;case 10:e:{if(ut=tt.type._context,pt=tt.pendingProps,_r=tt.memoizedProps,ti=pt.value,Es(Jl,ut._currentValue),ut._currentValue=ti,_r!==null)if(vo(_r.value,ti)){if(_r.children===pt.children&&!Ks.current){tt=Mo(Qe,tt,st);break e}}else for(_r=tt.child,_r!==null&&(_r.return=tt);_r!==null;){var fi=_r.dependencies;if(fi!==null){ti=_r.child;for(var vi=fi.firstContext;vi!==null;){if(vi.context===ut){if(_r.tag===1){vi=Oo(-1,st&-st),vi.tag=2;var _i=_r.updateQueue;if(_i!==null){_i=_i.shared;var Li=_i.pending;Li===null?vi.next=vi:(vi.next=Li.next,Li.next=vi),_i.pending=vi}}_r.lanes|=st,vi=_r.alternate,vi!==null&&(vi.lanes|=st),Tu(_r.return,st,tt),fi.lanes|=st;break}vi=vi.next}}else if(_r.tag===10)ti=_r.type===tt.type?null:_r.child;else if(_r.tag===18){if(ti=_r.return,ti===null)throw Error(ee(341));ti.lanes|=st,fi=ti.alternate,fi!==null&&(fi.lanes|=st),Tu(ti,st,tt),ti=_r.sibling}else ti=_r.child;if(ti!==null)ti.return=_r;else for(ti=_r;ti!==null;){if(ti===tt){ti=null;break}if(_r=ti.sibling,_r!==null){_r.return=ti.return,ti=_r;break}ti=ti.return}_r=ti}js(Qe,tt,pt.children,st),tt=tt.child}return tt;case 9:return pt=tt.type,ut=tt.pendingProps.children,Oa(tt,st),pt=uo(pt),ut=ut(pt),tt.flags|=1,js(Qe,tt,ut,st),tt.child;case 14:return ut=tt.type,pt=To(ut,tt.pendingProps),pt=To(ut.type,pt),lf(Qe,tt,ut,pt,st);case 15:return cf(Qe,tt,tt.type,tt.pendingProps,st);case 17:return ut=tt.type,pt=tt.pendingProps,pt=tt.elementType===ut?pt:To(ut,pt),dc(Qe,tt),tt.tag=1,qs(ut)?(Qe=!0,Yl(tt)):Qe=!1,Oa(tt,st),Ad(tt,ut,pt),_u(tt,ut,pt,st),Uu(null,tt,ut,!0,Qe,st);case 19:return yf(Qe,tt,st);case 22:return uf(Qe,tt,st)}throw Error(ee(156,tt.tag))};function Hf(Qe,tt){return mh(Qe,tt)}function Ng(Qe,tt,st,ut){this.tag=Qe,this.key=st,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=tt,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=ut,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function po(Qe,tt,st,ut){return new Ng(Qe,tt,st,ut)}function sh(Qe){return Qe=Qe.prototype,!(!Qe||!Qe.isReactComponent)}function Fg(Qe){if(typeof Qe=="function")return sh(Qe)?1:0;if(Qe!=null){if(Qe=Qe.$$typeof,Qe===li)return 11;if(Qe===ii)return 14}return 2}function ta(Qe,tt){var st=Qe.alternate;return st===null?(st=po(Qe.tag,tt,Qe.key,Qe.mode),st.elementType=Qe.elementType,st.type=Qe.type,st.stateNode=Qe.stateNode,st.alternate=Qe,Qe.alternate=st):(st.pendingProps=tt,st.type=Qe.type,st.flags=0,st.subtreeFlags=0,st.deletions=null),st.flags=Qe.flags&14680064,st.childLanes=Qe.childLanes,st.lanes=Qe.lanes,st.child=Qe.child,st.memoizedProps=Qe.memoizedProps,st.memoizedState=Qe.memoizedState,st.updateQueue=Qe.updateQueue,tt=Qe.dependencies,st.dependencies=tt===null?null:{lanes:tt.lanes,firstContext:tt.firstContext},st.sibling=Qe.sibling,st.index=Qe.index,st.ref=Qe.ref,st}function _c(Qe,tt,st,ut,pt,_r){var ti=2;if(ut=Qe,typeof Qe=="function")sh(Qe)&&(ti=1);else if(typeof Qe=="string")ti=5;else e:switch(Qe){case Xr:return va(st.children,pt,_r,tt);case Jr:ti=8,pt|=8;break;case ai:return Qe=po(12,st,tt,pt|2),Qe.elementType=ai,Qe.lanes=_r,Qe;case ui:return Qe=po(13,st,tt,pt),Qe.elementType=ui,Qe.lanes=_r,Qe;case mi:return Qe=po(19,st,tt,pt),Qe.elementType=mi,Qe.lanes=_r,Qe;case ri:return wc(st,pt,_r,tt);default:if(typeof Qe=="object"&&Qe!==null)switch(Qe.$$typeof){case oi:ti=10;break e;case ni:ti=9;break e;case li:ti=11;break e;case ii:ti=14;break e;case hi:ti=16,ut=null;break e}throw Error(ee(130,Qe==null?Qe:typeof Qe,""))}return tt=po(ti,st,tt,pt),tt.elementType=Qe,tt.type=ut,tt.lanes=_r,tt}function va(Qe,tt,st,ut){return Qe=po(7,Qe,ut,tt),Qe.lanes=st,Qe}function wc(Qe,tt,st,ut){return Qe=po(22,Qe,ut,tt),Qe.elementType=ri,Qe.lanes=st,Qe.stateNode={isHidden:!1},Qe}function oh(Qe,tt,st){return Qe=po(6,Qe,null,tt),Qe.lanes=st,Qe}function ah(Qe,tt,st){return tt=po(4,Qe.children!==null?Qe.children:[],Qe.key,tt),tt.lanes=st,tt.stateNode={containerInfo:Qe.containerInfo,pendingChildren:null,implementation:Qe.implementation},tt}function Bg(Qe,tt,st,ut,pt){this.tag=tt,this.containerInfo=Qe,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Mc(0),this.expirationTimes=Mc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Mc(0),this.identifierPrefix=ut,this.onRecoverableError=pt,this.mutableSourceEagerHydrationData=null}function lh(Qe,tt,st,ut,pt,_r,ti,fi,vi){return Qe=new Bg(Qe,tt,st,fi,vi),tt===1?(tt=1,_r===!0&&(tt|=8)):tt=0,_r=po(3,null,null,tt),Qe.current=_r,_r.stateNode=Qe,_r.memoizedState={element:ut,isDehydrated:st,cache:null,transitions:null,pendingSuspenseBoundaries:null},Su(_r),Qe}function Ug(Qe,tt,st){var ut=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Qr,key:ut==null?null:""+ut,children:Qe,containerInfo:tt,implementation:st}}function Vf(Qe){if(!Qe)return Wo;Qe=Qe._reactInternals;e:{if(sa(Qe)!==Qe||Qe.tag!==1)throw Error(ee(170));var tt=Qe;do{switch(tt.tag){case 3:tt=tt.stateNode.context;break e;case 1:if(qs(tt.type)){tt=tt.stateNode.__reactInternalMemoizedMergedChildContext;break e}}tt=tt.return}while(tt!==null);throw Error(ee(171))}if(Qe.tag===1){var st=Qe.type;if(qs(st))return pd(Qe,st,tt)}return tt}function zf(Qe,tt,st,ut,pt,_r,ti,fi,vi){return Qe=lh(st,ut,!0,Qe,pt,_r,ti,fi,vi),Qe.context=Vf(null),st=Qe.current,ut=Ws(),pt=Zo(st),_r=Oo(ut,pt),_r.callback=tt??null,qo(st,_r,pt),Qe.current.lanes=pt,za(Qe,pt,ut),Js(Qe,ut),Qe}function Cc(Qe,tt,st,ut){var pt=tt.current,_r=Ws(),ti=Zo(pt);return st=Vf(st),tt.context===null?tt.context=st:tt.pendingContext=st,tt=Oo(_r,ti),tt.payload={element:Qe},ut=ut===void 0?null:ut,ut!==null&&(tt.callback=ut),Qe=qo(pt,tt,ti),Qe!==null&&(xo(Qe,pt,ti,_r),tc(Qe,pt,ti)),ti}function Rc(Qe){if(Qe=Qe.current,!Qe.child)return null;switch(Qe.child.tag){case 5:return Qe.child.stateNode;default:return Qe.child.stateNode}}function jf(Qe,tt){if(Qe=Qe.memoizedState,Qe!==null&&Qe.dehydrated!==null){var st=Qe.retryLane;Qe.retryLane=st!==0&&st<tt?st:tt}}function ch(Qe,tt){jf(Qe,tt),(Qe=Qe.alternate)&&jf(Qe,tt)}function Gg(){return null}var Wf=typeof reportError=="function"?reportError:function(Qe){console.error(Qe)};function uh(Qe){this._internalRoot=Qe}Ac.prototype.render=uh.prototype.render=function(Qe){var tt=this._internalRoot;if(tt===null)throw Error(ee(409));Cc(Qe,tt,null,null)},Ac.prototype.unmount=uh.prototype.unmount=function(){var Qe=this._internalRoot;if(Qe!==null){this._internalRoot=null;var tt=Qe.containerInfo;ga(function(){Cc(null,Qe,null,null)}),tt[Io]=null}};function Ac(Qe){this._internalRoot=Qe}Ac.prototype.unstable_scheduleHydration=function(Qe){if(Qe){var tt=_h();Qe={blockedOn:null,target:Qe,priority:tt};for(var st=0;st<Go.length&&tt!==0&&tt<Go[st].priority;st++);Go.splice(st,0,Qe),st===0&&Rh(Qe)}};function hh(Qe){return!(!Qe||Qe.nodeType!==1&&Qe.nodeType!==9&&Qe.nodeType!==11)}function Ic(Qe){return!(!Qe||Qe.nodeType!==1&&Qe.nodeType!==9&&Qe.nodeType!==11&&(Qe.nodeType!==8||Qe.nodeValue!==" react-mount-point-unstable "))}function Yf(){}function Hg(Qe,tt,st,ut,pt){if(pt){if(typeof ut=="function"){var _r=ut;ut=function(){var _i=Rc(ti);_r.call(_i)}}var ti=zf(tt,ut,Qe,0,null,!1,!1,"",Yf);return Qe._reactRootContainer=ti,Qe[Io]=ti.current,il(Qe.nodeType===8?Qe.parentNode:Qe),ga(),ti}for(;pt=Qe.lastChild;)Qe.removeChild(pt);if(typeof ut=="function"){var fi=ut;ut=function(){var _i=Rc(vi);fi.call(_i)}}var vi=lh(Qe,0,!1,null,null,!1,!1,"",Yf);return Qe._reactRootContainer=vi,Qe[Io]=vi.current,il(Qe.nodeType===8?Qe.parentNode:Qe),ga(function(){Cc(tt,vi,st,ut)}),vi}function Pc(Qe,tt,st,ut,pt){var _r=st._reactRootContainer;if(_r){var ti=_r;if(typeof pt=="function"){var fi=pt;pt=function(){var vi=Rc(ti);fi.call(vi)}}Cc(tt,ti,Qe,pt)}else ti=Hg(st,tt,Qe,pt,ut);return Rc(ti)}Sh=function(Qe){switch(Qe.tag){case 3:var tt=Qe.stateNode;if(tt.current.memoizedState.isDehydrated){var st=Va(tt.pendingLanes);st!==0&&(kc(tt,st|1),Js(tt,As()),!(ps&6)&&(Ua=As()+500,Yo()))}break;case 13:ga(function(){var ut=Do(Qe,1);if(ut!==null){var pt=Ws();xo(ut,Qe,1,pt)}}),ch(Qe,1)}},Nc=function(Qe){if(Qe.tag===13){var tt=Do(Qe,134217728);if(tt!==null){var st=Ws();xo(tt,Qe,134217728,st)}ch(Qe,134217728)}},xh=function(Qe){if(Qe.tag===13){var tt=Zo(Qe),st=Do(Qe,tt);if(st!==null){var ut=Ws();xo(st,Qe,tt,ut)}ch(Qe,tt)}},_h=function(){return ys},wh=function(Qe,tt){var st=ys;try{return ys=Qe,tt()}finally{ys=st}},Vi=function(Qe,tt,st){switch(tt){case"input":if(Di(Qe,st),tt=st.name,st.type==="radio"&&tt!=null){for(st=Qe;st.parentNode;)st=st.parentNode;for(st=st.querySelectorAll("input[name="+JSON.stringify(""+tt)+'][type="radio"]'),tt=0;tt<st.length;tt++){var ut=st[tt];if(ut!==Qe&&ut.form===Qe.form){var pt=jl(ut);if(!pt)throw Error(ee(90));hs(ut),Di(ut,pt)}}}break;case"textarea":ds(Qe,st);break;case"select":tt=st.value,tt!=null&&Zi(Qe,!!st.multiple,tt,!1)}},cs=rh,Xi=ga;var Vg={usingClientEntryPoint:!1,Events:[al,Ra,jl,Qi,ss,rh]},Sl={findFiberByHostInstance:oa,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},zg={bundleType:Sl.bundleType,version:Sl.version,rendererPackageName:Sl.rendererPackageName,rendererConfig:Sl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:mt.ReactCurrentDispatcher,findHostInstanceByFiber:function(Qe){return Qe=ph(Qe),Qe===null?null:Qe.stateNode},findFiberByHostInstance:Sl.findFiberByHostInstance||Gg,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Lc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Lc.isDisabled&&Lc.supportsFiber)try{Cl=Lc.inject(zg),_o=Lc}catch{}}return reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Vg,reactDom_production_min.createPortal=function(Qe,tt){var st=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!hh(tt))throw Error(ee(200));return Ug(Qe,tt,null,st)},reactDom_production_min.createRoot=function(Qe,tt){if(!hh(Qe))throw Error(ee(299));var st=!1,ut="",pt=Wf;return tt!=null&&(tt.unstable_strictMode===!0&&(st=!0),tt.identifierPrefix!==void 0&&(ut=tt.identifierPrefix),tt.onRecoverableError!==void 0&&(pt=tt.onRecoverableError)),tt=lh(Qe,1,!1,null,null,st,!1,ut,pt),Qe[Io]=tt.current,il(Qe.nodeType===8?Qe.parentNode:Qe),new uh(tt)},reactDom_production_min.findDOMNode=function(Qe){if(Qe==null)return null;if(Qe.nodeType===1)return Qe;var tt=Qe._reactInternals;if(tt===void 0)throw typeof Qe.render=="function"?Error(ee(188)):(Qe=Object.keys(Qe).join(","),Error(ee(268,Qe)));return Qe=ph(tt),Qe=Qe===null?null:Qe.stateNode,Qe},reactDom_production_min.flushSync=function(Qe){return ga(Qe)},reactDom_production_min.hydrate=function(Qe,tt,st){if(!Ic(tt))throw Error(ee(200));return Pc(null,Qe,tt,!0,st)},reactDom_production_min.hydrateRoot=function(Qe,tt,st){if(!hh(Qe))throw Error(ee(405));var ut=st!=null&&st.hydratedSources||null,pt=!1,_r="",ti=Wf;if(st!=null&&(st.unstable_strictMode===!0&&(pt=!0),st.identifierPrefix!==void 0&&(_r=st.identifierPrefix),st.onRecoverableError!==void 0&&(ti=st.onRecoverableError)),tt=zf(tt,null,Qe,1,st??null,pt,!1,_r,ti),Qe[Io]=tt.current,il(Qe),ut)for(Qe=0;Qe<ut.length;Qe++)st=ut[Qe],pt=st._getVersion,pt=pt(st._source),tt.mutableSourceEagerHydrationData==null?tt.mutableSourceEagerHydrationData=[st,pt]:tt.mutableSourceEagerHydrationData.push(st,pt);return new Ac(tt)},reactDom_production_min.render=function(Qe,tt,st){if(!Ic(tt))throw Error(ee(200));return Pc(null,Qe,tt,!1,st)},reactDom_production_min.unmountComponentAtNode=function(Qe){if(!Ic(Qe))throw Error(ee(40));return Qe._reactRootContainer?(ga(function(){Pc(null,null,Qe,!1,function(){Qe._reactRootContainer=null,Qe[Io]=null})}),!0):!1},reactDom_production_min.unstable_batchedUpdates=rh,reactDom_production_min.unstable_renderSubtreeIntoContainer=function(Qe,tt,st,ut){if(!Ic(st))throw Error(ee(200));if(Qe==null||Qe._reactInternals===void 0)throw Error(ee(38));return Pc(Qe,tt,st,!1,ut)},reactDom_production_min.version="18.2.0-next-9e3b772b8-20220608",reactDom_production_min}function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(ie){console.error(ie)}}checkDCE(),reactDom.exports=requireReactDom_production_min();var reactDomExports=reactDom.exports;const $7SXl2$reactdom=getDefaultExportFromCjs$1(reactDomExports);var createRoot,m$2=reactDomExports;createRoot=m$2.createRoot,m$2.hydrateRoot;var __defProp=Object.defineProperty,__defNormalProp=(ie,Z,ee)=>Z in ie?__defProp(ie,Z,{enumerable:!0,configurable:!0,writable:!0,value:ee}):ie[Z]=ee,__publicField=(ie,Z,ee)=>(__defNormalProp(ie,typeof Z!="symbol"?Z+"":Z,ee),ee);const EMPTY=[];Object.freeze(EMPTY);const emptyAnnotationPage={id:"https://iiif-parser/annotation-page",type:"AnnotationPage",behavior:EMPTY,motivation:null,label:null,thumbnail:EMPTY,summary:null,requiredStatement:null,metadata:EMPTY,rights:null,provider:EMPTY,items:EMPTY,seeAlso:EMPTY,homepage:EMPTY,logo:EMPTY,rendering:EMPTY,service:EMPTY},emptyCanvas={id:"https://iiif-parser/empty-canvas",type:"Canvas",label:null,behavior:EMPTY,motivation:null,thumbnail:EMPTY,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:EMPTY,rights:null,navDate:null,provider:EMPTY,items:EMPTY,annotations:EMPTY,seeAlso:EMPTY,homepage:EMPTY,logo:EMPTY,partOf:EMPTY,rendering:EMPTY,service:EMPTY,duration:0,height:0,width:0},emptyCollection={id:"https://iiif-parser/empty-collection",type:"Collection",label:null,viewingDirection:"left-to-right",behavior:EMPTY,motivation:null,thumbnail:EMPTY,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:EMPTY,rights:null,navDate:null,provider:EMPTY,items:EMPTY,annotations:EMPTY,seeAlso:EMPTY,homepage:EMPTY,logo:EMPTY,partOf:EMPTY,rendering:EMPTY,service:EMPTY,services:EMPTY},emptyManifest={id:"https://iiif-parser/empty-manifest",type:"Manifest",annotations:EMPTY,behavior:EMPTY,homepage:EMPTY,items:EMPTY,label:null,logo:EMPTY,metadata:EMPTY,motivation:null,navDate:null,provider:EMPTY,partOf:EMPTY,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,rendering:EMPTY,requiredStatement:null,rights:null,seeAlso:EMPTY,service:EMPTY,services:EMPTY,start:null,structures:EMPTY,summary:null,thumbnail:EMPTY,viewingDirection:"left-to-right"},emptyRange={id:"https://iiif-parser/empty-canvas",type:"Range",label:null,behavior:EMPTY,motivation:null,thumbnail:EMPTY,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:EMPTY,rights:null,navDate:null,provider:EMPTY,items:EMPTY,annotations:EMPTY,seeAlso:EMPTY,homepage:EMPTY,logo:EMPTY,partOf:EMPTY,rendering:EMPTY,service:EMPTY,start:null,supplementary:null,viewingDirection:"left-to-right"},emptyAgent={id:"https://iiif-parser/empty-agent",type:"Agent",label:{},logo:EMPTY,seeAlso:EMPTY,homepage:EMPTY};function ensureArray$1(ie){return Array.isArray(ie)?ie:[ie]}const types$1=["Collection","Manifest","Canvas","AnnotationPage","AnnotationCollection","Annotation","ContentResource","Range","Service","Selector","Agent"];function identifyResource$1(ie){if(typeof ie>"u"||ie===null)throw new Error("Null or undefined is not a valid entity.");if(Array.isArray(ie))throw new Error("Array is not a valid entity");if(typeof ie!="object")throw new Error(`${typeof ie} is not a valid entity`);if(typeof ie.type=="string"){const Z=types$1.indexOf(ie.type);if(Z!==-1)return types$1[Z]}if(ie.profile)return"Service";throw new Error("Resource type is not known")}class Traverse$1{constructor(Z,ee={}){__publicField(this,"traversals"),__publicField(this,"options"),this.traversals={collection:[],manifest:[],canvas:[],annotationCollection:[],annotationPage:[],annotation:[],contentResource:[],choice:[],range:[],service:[],agent:[],...Z},this.options={allowUndefinedReturn:!1,...ee}}static all(Z){return new Traverse$1({collection:[Z],manifest:[Z],canvas:[Z],annotationCollection:[Z],annotationPage:[Z],annotation:[Z],contentResource:[Z],choice:[Z],range:[Z],service:[Z]})}traverseDescriptive(Z){return Z.thumbnail&&(Z.thumbnail=Z.thumbnail.map(ee=>this.traverseType(ee,this.traversals.contentResource))),Z.provider&&(Z.provider=Z.provider.map(ee=>this.traverseAgent(ee))),Z}traverseLinking(Z){return Z.seeAlso&&(Z.seeAlso=Z.seeAlso.map(ee=>this.traverseType(ee,this.traversals.contentResource))),Z.service&&(Z.service=ensureArray$1(Z.service).map(ee=>this.traverseType(ee,this.traversals.service))),Z.services&&(Z.services=Z.services.map(ee=>this.traverseType(ee,this.traversals.service))),Z.logo&&(Z.logo=Z.logo.map(ee=>this.traverseType(ee,this.traversals.contentResource))),Z.homepage&&(Z.homepage=Z.homepage.map(ee=>this.traverseType(ee,this.traversals.contentResource))),Z.partOf&&(Z.partOf=Z.partOf.map(ee=>typeof ee=="string"||!ee.type?this.traverseType(ee,this.traversals.contentResource):ee.type==="Canvas"?this.traverseType(ee,this.traversals.canvas):ee.type==="AnnotationCollection"?this.traverseType(ee,this.traversals.annotationCollection):ee.type==="Collection"?this.traverseType(ee,this.traversals.collection):this.traverseType(ee,this.traversals.contentResource))),Z.start&&(Z.start=Z.start?this.traverseType(Z.start,this.traversals.canvas):null),Z.rendering&&(Z.rendering=Z.rendering.map(ee=>this.traverseType(ee,this.traversals.contentResource))),Z.supplementary&&(Z.supplementary=Z.supplementary.map(ee=>this.traverseType(ee,this.traversals.contentResource))),Z}traverseCollectionItems(Z){return Z.items&&Z.items.map(ee=>ee.type==="Collection"?this.traverseCollection(ee):this.traverseManifest(ee)),Z}traverseCollection(Z){return this.traverseType(this.traverseDescriptive(this.traverseInlineAnnotationPages(this.traverseLinking(this.traversePosterCanvas(this.traverseCollectionItems(Z))))),this.traversals.collection)}traverseManifestItems(Z){return Z.items&&(Z.items=Z.items.map(ee=>this.traverseCanvas(ee))),Z}traverseManifestStructures(Z){return Z.structures&&(Z.structures=Z.structures.map(ee=>this.traverseRange(ee))),Z}traverseManifest(Z){return this.traverseType(this.traverseInlineAnnotationPages(this.traverseManifestStructures(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(Z)))))),this.traversals.manifest)}traverseCanvasItems(Z){return Z.items=(Z.items||[]).map(ee=>this.traverseAnnotationPage(ee)),Z}traverseInlineAnnotationPages(Z){return typeof Z=="string"||!Z||Z.annotations&&(Z.annotations=Z.annotations.map(ee=>this.traverseAnnotationPage(ee))),Z}traverseCanvas(Z){return this.traverseType(this.traverseInlineAnnotationPages(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(Z))))),this.traversals.canvas)}traverseAnnotationPageItems(Z){return Z.items&&(Z.items=Z.items.map(ee=>this.traverseAnnotation(ee))),Z}traverseAnnotationPage(Z){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationPageItems(Z))),this.traversals.annotationPage)}traverseAnnotationBody(Z){return Array.isArray(Z.body)?Z.body=Z.body.map(ee=>this.traverseContentResource(ee)):Z.body&&(Z.body=this.traverseContentResource(Z.body)),Z}traversePosterCanvas(Z){return Z.posterCanvas&&(Z.posterCanvas=this.traverseCanvas(Z.posterCanvas)),Z.placeholderCanvas&&(Z.placeholderCanvas=this.traverseCanvas(Z.placeholderCanvas)),Z.accompanyingCanvas&&(Z.accompanyingCanvas=this.traverseCanvas(Z.accompanyingCanvas)),Z}traverseAnnotation(Z){return this.traverseType(this.traverseLinking(this.traverseAnnotationBody(Z)),this.traversals.annotation)}traverseContentResourceLinking(Z){return typeof Z=="string"||!Z||Z&&Z.service&&(Z.service=ensureArray$1(Z.service||[]).map(ee=>this.traverseType(ee,this.traversals.service))),Z}traverseContentResource(Z){return Z.type==="Choice"&&(Z.items=Z.items.map(ee=>this.traverseContentResource(ee))),this.traverseType(this.traverseInlineAnnotationPages(this.traverseContentResourceLinking(Z)),this.traversals.contentResource)}traverseRangeRanges(Z){return Z.items&&(Z.items=Z.items.map(ee=>typeof ee=="string"?this.traverseCanvas({id:ee,type:"Canvas"}):ee.type==="Manifest"?this.traverseManifest(ee):this.traverseRange(ee))),Z}traverseRange(Z){return this.traverseType(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseRangeRanges(Z)))),this.traversals.range)}traverseAgent(Z){return this.traverseType(this.traverseDescriptive(this.traverseLinking(Z)),this.traversals.agent)}traverseType(Z,ee){return ee.reduce((ae,ye)=>{const ve=ye(ae);return typeof ve>"u"&&!this.options.allowUndefinedReturn?ae:ve},Z)}traverseService(Z){return this.traverseType(Z,this.traversals.service)}traverseUnknown(Z){const ee=identifyResource$1(Z);switch(ee){case"Collection":return this.traverseCollection(Z);case"Manifest":return this.traverseManifest(Z);case"Canvas":return this.traverseCanvas(Z);case"AnnotationPage":return this.traverseAnnotationPage(Z);case"Annotation":return this.traverseAnnotation(Z);case"ContentResource":return this.traverseContentResource(Z);case"Range":return this.traverseRange(Z);case"Service":return this.traverseService(Z);case"Agent":return this.traverseAgent(Z);default:throw new Error(`Unknown or unsupported resource type of ${ee}`)}}}const types=["sc:Collection","sc:Manifest","sc:Canvas","sc:AnnotationList","oa:Annotation","sc:Range","sc:Layer","sc:Sequence","oa:Choice","Service","ContentResource"];function identifyResource(ie){if(typeof ie>"u"||ie===null)throw new Error("Null or undefined is not a valid entity.");if(Array.isArray(ie))throw new Error("Array is not a valid entity");if(typeof ie!="object")throw new Error(`${typeof ie} is not a valid entity`);if(typeof ie["@type"]=="string"){const Z=types.indexOf(ie["@type"]);if(Z!==-1)return types[Z]}if(ie.profile)return"Service";if(ie.format||ie["@type"])return"ContentResource";throw new Error("Resource type is not known")}class Traverse{constructor(Z,ee={}){__publicField(this,"traversals"),__publicField(this,"options"),this.traversals={collection:[],manifest:[],canvas:[],annotationList:[],sequence:[],annotation:[],contentResource:[],choice:[],range:[],service:[],layer:[],...Z},this.options={convertPropsToArray:!0,mergeMemberProperties:!0,allowUndefinedReturn:!1,...ee}}static all(Z){return new Traverse({collection:[Z],manifest:[Z],canvas:[Z],annotationList:[Z],sequence:[Z],annotation:[Z],contentResource:[Z],choice:[Z],range:[Z],service:[Z],layer:[Z]})}traverseCollection(Z){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCollectionItems(Z))),this.traversals.collection)}traverseCollectionItems(Z){if(this.options.mergeMemberProperties){const ee=[...(Z.manifests||[]).map(ae=>typeof ae=="string"?{"@id":ae,"@type":"sc:Manifest"}:ae),...(Z.collections||[]).map(ae=>typeof ae=="string"?{"@id":ae,"@type":"sc:Collection"}:ae),...Z.members||[]];delete Z.collections,delete Z.manifests,Z.members=ee}return Z.manifests&&(Z.manifests=Z.manifests.map(ee=>this.traverseManifest(typeof ee=="string"?{"@id":ee,"@type":"sc:Manifest"}:ee))),Z.collections&&(Z.collections=Z.collections.map(ee=>this.traverseCollection(typeof ee=="string"?{"@id":ee,"@type":"sc:Collection"}:ee))),Z.members&&(Z.members=Z.members.map(ee=>typeof ee=="string"?ee:this.traverseUnknown(ee))),Z}traverseManifest(Z){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(Z))),this.traversals.manifest)}traverseManifestItems(Z){return Z.sequences&&(Z.sequences=Z.sequences.map(ee=>this.traverseSequence(ee))),Z.structures&&(Z.structures=Z.structures.map(ee=>this.traverseRange(ee))),Z}traverseSequence(Z){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseSequenceItems(Z))),this.traversals.sequence)}traverseSequenceItems(Z){return Z.canvases&&(Z.canvases=Z.canvases.map(ee=>this.traverseCanvas(ee))),Z}traverseCanvas(Z){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(Z))),this.traversals.canvas)}traverseCanvasItems(Z){return Z.images&&(Z.images=Z.images.map(ee=>this.traverseAnnotation(ee))),Z.otherContent&&(Z.otherContent=Z.otherContent.map(ee=>this.traverseAnnotationList(ee))),Z}traverseRange(Z){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseRangeItems(Z))),this.traversals.range)}traverseRangeItems(Z){if(this.options.mergeMemberProperties){const ee=[...(Z.ranges||[]).map(ae=>typeof ae=="string"?{"@id":ae,"@type":"sc:Range"}:ae),...(Z.canvases||[]).map(ae=>typeof ae=="string"?{"@id":ae,"@type":"sc:Canvas"}:ae),...Z.members||[]];delete Z.ranges,delete Z.canvases,Z.members=ee.length?ee.map(ae=>this.traverseUnknown(ae)):void 0}return Z}traverseAnnotationList(Z){const ee=typeof Z=="string"?{"@id":Z,"@type":"sc:AnnotationList"}:Z;return this.traverseType(this.traverseDescriptive(this.traverseAnnotationListItems(ee)),this.traversals.annotationList)}traverseAnnotationListItems(Z){return Z.resources&&(Z.resources=Z.resources.map(ee=>this.traverseAnnotation(ee))),Z}traverseAnnotation(Z){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationItems(Z))),this.traversals.annotation)}traverseAnnotationItems(Z){return Z.resource&&(Array.isArray(Z.resource)?Z.resource=Z.resource.map(ee=>this.traverseContentResource(ee)):Z.resource=this.traverseContentResource(Z.resource)),Z.on,Z}traverseLayer(Z){return this.traverseType(this.traverseLinking(this.traverseLayerItems(Z)),this.traversals.layer)}traverseLayerItems(Z){return Z.otherContent&&(Z.otherContent=Z.otherContent.map(ee=>this.traverseAnnotationList(ee))),Z}traverseChoice(Z){return this.traverseType(this.traverseChoiceItems(Z),this.traversals.choice)}traverseChoiceItems(Z){return Z.default&&Z.default!=="rdf:nil"&&(Z.default=this.traverseContentResource(Z.default)),Z.item&&Z.item!=="rdf:nil"&&(Z.item=Z.item.map(ee=>this.traverseContentResource(ee))),Z}traverseService(Z){return this.traverseType(this.traverseLinking(Z),this.traversals.service)}traverseContentResource(Z){return Z["@type"]==="oa:Choice"?this.traverseChoice(Z):this.traverseType(this.traverseDescriptive(this.traverseLinking(Z)),this.traversals.contentResource)}traverseUnknown(Z){if(!Z["@type"]||typeof Z=="string")return Z;switch(identifyResource(Z)){case"sc:Collection":return this.traverseCollection(Z);case"sc:Manifest":return this.traverseManifest(Z);case"sc:Canvas":return this.traverseCanvas(Z);case"sc:Sequence":return this.traverseSequence(Z);case"sc:Range":return this.traverseRange(Z);case"oa:Annotation":return this.traverseAnnotation(Z);case"sc:AnnotationList":return this.traverseAnnotationList(Z);case"sc:Layer":return this.traverseLayer(Z);case"Service":return this.traverseService(Z);case"oa:Choice":return this.traverseChoice(Z);case"ContentResource":return this.traverseContentResource(Z)}return Z.profile?this.traverseService(Z):Z}traverseImageResource(Z){const ee=Array.isArray(Z),ae=Array.isArray(Z)?Z:[Z],ye=[];for(const ve of ae)typeof ve=="string"?ye.push(this.traverseContentResource({"@id":ve,"@type":"dctypes:Image"})):ye.push(this.traverseContentResource(ve));return!ee&&!this.options.convertPropsToArray?ye[0]:ye}traverseDescriptive(Z){return Z.thumbnail&&(Z.thumbnail=this.traverseImageResource(Z.thumbnail)),Z.logo&&(Z.logo=this.traverseImageResource(Z.logo)),Z}traverseOneOrMoreServices(Z){const ee=Array.isArray(Z),ae=Array.isArray(Z)?Z:[Z],ye=[];for(const ve of ae)ye.push(this.traverseService(ve));return!ee&&!this.options.convertPropsToArray?ye[0]:ye}traverseLinking(Z){return Z.related&&(Z.related=this.traverseOneOrManyType(Z.related,this.traversals.contentResource)),Z.rendering&&(Z.rendering=this.traverseOneOrManyType(Z.rendering,this.traversals.contentResource)),Z.service&&(Z.service=this.traverseOneOrMoreServices(Z.service)),Z.seeAlso&&(Z.seeAlso=this.traverseOneOrManyType(Z.seeAlso,this.traversals.contentResource)),Z.within&&(typeof Z.within=="string"||(Z.within=this.traverseOneOrManyType(Z.within,this.traversals.contentResource))),Z.startCanvas&&(typeof Z.startCanvas=="string"?Z.startCanvas=this.traverseType({"@id":Z.startCanvas,"@type":"sc:Canvas"},this.traversals.canvas):Z.startCanvas&&this.traverseType(Z.startCanvas,this.traversals.canvas)),Z.contentLayer&&(typeof Z.contentLayer=="string"?Z.contentLayer=this.traverseLayer({"@id":Z.contentLayer,"@type":"sc:Layer"}):Z.contentLayer=this.traverseLayer(Z.contentLayer)),Z}traverseOneOrManyType(Z,ee){if(!Array.isArray(Z))if(this.options.convertPropsToArray)Z=[Z];else return this.traverseType(Z,ee);return Z.map(ae=>this.traverseType(ae,ee))}traverseType(Z,ee){return ee.reduce((ae,ye)=>{const ve=ye(ae);return typeof ve>"u"&&!this.options.allowUndefinedReturn?ae:ve},Z)}}const STANFORD_IIIF_IMAGE_COMPLIANCE_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",STANFORD_IIIF_IMAGE_COMPLIANCE_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",STANFORD_IIIF_IMAGE_COMPLIANCE_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",STANFORD_IIIF_IMAGE_CONFORMANCE_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",STANFORD_IIIF_IMAGE_CONFORMANCE_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",STANFORD_IIIF_IMAGE_CONFORMANCE_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",STANFORD_IIIF_1_IMAGE_COMPLIANCE_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",STANFORD_IIIF_1_IMAGE_COMPLIANCE_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",STANFORD_IIIF_1_IMAGE_COMPLIANCE_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",STANFORD_IIIF_1_IMAGE_CONFORMANCE_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",STANFORD_IIIF_1_IMAGE_CONFORMANCE_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",STANFORD_IIIF_1_IMAGE_CONFORMANCE_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",IIIF_1_IMAGE_LEVEL_0="http://iiif.io/api/image/1/level0.json",IIIF_1_IMAGE_LEVEL_0_PROFILE="http://iiif.io/api/image/1/profiles/level0.json",IIIF_1_IMAGE_LEVEL_1="http://iiif.io/api/image/1/level1.json",IIIF_1_IMAGE_LEVEL_1_PROFILE="http://iiif.io/api/image/1/profiles/level1.json",IIIF_1_IMAGE_LEVEL_2="http://iiif.io/api/image/1/level2.json",IIIF_1_IMAGE_LEVEL_2_PROFILE="http://iiif.io/api/image/1/profiles/level2.json",IIIF_2_IMAGE_LEVEL_0="http://iiif.io/api/image/2/level0.json",IIIF_2_IMAGE_LEVEL_0_PROFILE="http://iiif.io/api/image/2/profiles/level0.json",IIIF_2_IMAGE_LEVEL_1="http://iiif.io/api/image/2/level1.json",IIIF_2_IMAGE_LEVEL_1_PROFILE="http://iiif.io/api/image/2/profiles/level1.json",IIIF_2_IMAGE_LEVEL_2="http://iiif.io/api/image/2/level2.json",IIIF_2_IMAGE_LEVEL_2_PROFILE="http://iiif.io/api/image/2/profiles/level2.json",IIIF_3_IMAGE_LEVEL_0="level0",IIIF_3_IMAGE_LEVEL_1="level1",IIIF_3_IMAGE_LEVEL_2="level2",IIIF_2_IMAGE_LEVEL_0_NO_JSON="http://iiif.io/api/image/2/level0",IIIF_2_IMAGE_LEVEL_1_NO_JSON="http://iiif.io/api/image/2/level1",IIIF_2_IMAGE_LEVEL_2_NO_JSON="http://iiif.io/api/image/2/level2",level1Support=[IIIF_2_IMAGE_LEVEL_1_NO_JSON,IIIF_2_IMAGE_LEVEL_2_NO_JSON,STANFORD_IIIF_IMAGE_COMPLIANCE_1,STANFORD_IIIF_IMAGE_COMPLIANCE_2,STANFORD_IIIF_IMAGE_CONFORMANCE_1,STANFORD_IIIF_IMAGE_CONFORMANCE_2,STANFORD_IIIF_1_IMAGE_COMPLIANCE_1,STANFORD_IIIF_1_IMAGE_COMPLIANCE_2,STANFORD_IIIF_1_IMAGE_CONFORMANCE_1,STANFORD_IIIF_1_IMAGE_CONFORMANCE_2,IIIF_1_IMAGE_LEVEL_1,IIIF_1_IMAGE_LEVEL_1_PROFILE,IIIF_1_IMAGE_LEVEL_2,IIIF_1_IMAGE_LEVEL_2_PROFILE,IIIF_2_IMAGE_LEVEL_1,IIIF_2_IMAGE_LEVEL_1_PROFILE,IIIF_2_IMAGE_LEVEL_2,IIIF_2_IMAGE_LEVEL_2_PROFILE,IIIF_3_IMAGE_LEVEL_1,IIIF_3_IMAGE_LEVEL_2],imageServiceProfiles=[IIIF_2_IMAGE_LEVEL_0_NO_JSON,IIIF_2_IMAGE_LEVEL_1_NO_JSON,IIIF_2_IMAGE_LEVEL_2_NO_JSON,STANFORD_IIIF_IMAGE_COMPLIANCE_0,STANFORD_IIIF_IMAGE_COMPLIANCE_1,STANFORD_IIIF_IMAGE_COMPLIANCE_2,STANFORD_IIIF_IMAGE_CONFORMANCE_0,STANFORD_IIIF_IMAGE_CONFORMANCE_1,STANFORD_IIIF_IMAGE_CONFORMANCE_2,STANFORD_IIIF_1_IMAGE_COMPLIANCE_0,STANFORD_IIIF_1_IMAGE_COMPLIANCE_1,STANFORD_IIIF_1_IMAGE_COMPLIANCE_2,STANFORD_IIIF_1_IMAGE_CONFORMANCE_0,STANFORD_IIIF_1_IMAGE_CONFORMANCE_1,STANFORD_IIIF_1_IMAGE_CONFORMANCE_2,IIIF_1_IMAGE_LEVEL_0,IIIF_1_IMAGE_LEVEL_0_PROFILE,IIIF_1_IMAGE_LEVEL_1,IIIF_1_IMAGE_LEVEL_1_PROFILE,IIIF_1_IMAGE_LEVEL_2,IIIF_1_IMAGE_LEVEL_2_PROFILE,IIIF_2_IMAGE_LEVEL_0,IIIF_2_IMAGE_LEVEL_0_PROFILE,IIIF_2_IMAGE_LEVEL_1,IIIF_2_IMAGE_LEVEL_1_PROFILE,IIIF_2_IMAGE_LEVEL_2,IIIF_2_IMAGE_LEVEL_2_PROFILE,IIIF_3_IMAGE_LEVEL_0,IIIF_3_IMAGE_LEVEL_1,IIIF_3_IMAGE_LEVEL_2],configuration={attributionLabel:"Attribution",lang:"none",providerId:"http://example.org/provider",providerName:"Unknown"};function convertLanguageMapping(ie,Z="none"){if(!ie)return{};const ee=Array.isArray(ie)?ie:[ie],ae={};for(const ye of ee){if(typeof ye=="string"){ae[Z]=ae[Z]?ae[Z]:[],ae[Z].push(ye||"");continue}if(!ye["@language"]){ae[Z]=ae[Z]?ae[Z]:[],ae[Z].push(ye["@value"]||"");continue}const ve=ye["@language"];ae[ve]=ae[ve]?ae[ve]:[],ae[ve].push(ye["@value"]||"")}return ae}function getProfile(ie){if(Array.isArray(ie))return getProfile(ie.find(Z=>typeof Z=="string"));if(imageServiceProfiles.indexOf(ie)!==-1)return"level2";if(level1Support.indexOf(ie)!==-1)return"level1";if(typeof ie=="string")return ie}function getTypeFromContext(ie){const Z=Array.isArray(ie)?ie:[ie];for(const ee of Z)switch(ee){case"http://iiif.io/api/image/2/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2":return"ImageService2";case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":return"ImageService1";case"http://iiif.io/api/annex/openannotation/context.json":return"ImageApiSelector"}}function getTypeFromProfile(ie){switch(ie){case"http://iiif.io/api/image/2/level0.json":case"http://iiif.io/api/image/2/level1.json":case"http://iiif.io/api/image/2/level2.json":return"ImageService2";case"http://iiif.io/api/auth/1/kiosk":case"http://iiif.io/api/auth/1/login":case"http://iiif.io/api/auth/1/clickthrough":case"http://iiif.io/api/auth/1/external":case"http://iiif.io/api/auth/0/kiosk":case"http://iiif.io/api/auth/0/login":case"http://iiif.io/api/auth/0/clickthrough":case"http://iiif.io/api/auth/0/external":return"AuthCookieService1";case"http://iiif.io/api/auth/1/token":case"http://iiif.io/api/auth/0/token":return"AuthTokenService1";case"http://iiif.io/api/auth/1/logout":case"http://iiif.io/api/auth/0/logout":return"AuthLogoutService1";case"http://iiif.io/api/search/1/search":case"http://iiif.io/api/search/0/search":return"SearchService1";case"http://iiif.io/api/search/1/autocomplete":case"http://iiif.io/api/search/0/autocomplete":return"AutoCompleteService1"}}function removePrefix(ie){for(const Z of["sc","oa","dcterms","dctypes","iiif"])if(ie.startsWith(`${Z}:`))return ie.slice(Z.length+1);return ie}const knownTypes=["Collection","Manifest","Annotation","AnnotationPage","Range","Service"];function getNewType(ie){const Z=ie["@id"]||ie.id;let ee=ie["@type"]||ie.type;const ae=ie.profile||void 0,ye=ie["@context"]||void 0;if(ae){const ve=getTypeFromProfile(ae);if(ve)return ve}if(ye){const ve=getTypeFromContext(ye);if(ve)return ve}if(ee){if(Array.isArray(ee)){if(ee.indexOf("oa:CssStylesheet")!==-1)return"CssStylesheet";if(ee.indexOf("cnt:ContentAsText")!==-1)return"TextualBody";ee=ee[0]}for(const ve of["sc","oa","dcterms","dctypes","iiif"])if(ee.startsWith(`${ve}:`)){ee=ee.slice(ve.length+1);break}switch(ee){case"Layer":return"AnnotationCollection";case"AnnotationList":return"AnnotationPage";case"cnt:ContentAsText":return"TextualBody"}}if(ee&&knownTypes.indexOf(ee)!==-1)return ee;if(ie.format){if(ie.format.startsWith("image/"))return"Image";if(ie.format.startsWith("text/")||ie.format==="application/pdf")return"Text";if(ie.format.startsWith("application/"))return"Dataset"}return Z&&(Z.endsWith(".jpg")||Z.endsWith(".png")||Z.endsWith(".jpeg"))?"Image":ee||"unknown"}const licenseRegex=/http(s)?:\/\/(creativecommons.org|rightsstatements.org)[^"'\\<\n]+/gm;function extractLicense(ie){const Z=ie.match(licenseRegex);return Z?Z[0]:ie}function fixLicense(ie,Z="Rights/License",ee="none"){let ae=null;const ye=[],ve=Array.isArray(ie)?ie:[ie];for(const be of ve){const Ye=be?extractLicense(be):void 0;if(Ye&&(Ye.indexOf("creativecommons.org")!==-1||Ye.indexOf("rightsstatements.org")!==-1)){Ye.startsWith("https://")?ae=`http://${Ye.slice(8)}`:ae=Ye;continue}Ye&&ye.push({label:{[ee]:[Z]},value:{[ee]:[Ye]}})}return[ae,ye]}const removeContexts=["http://iiif.io/api/presentation/2/context.json","http://iiif.io/api/image/2/context.json","http://iiif.io/api/image/1/context.json","http://library.stanford.edu/iiif/image-api/1.1/context.json","http://iiif.io/api/search/1/context.json","http://iiif.io/api/search/0/context.json","http://iiif.io/api/auth/1/context.json","http://iiif.io/api/auth/0/context.json","http://iiif.io/api/annex/openannotation/context.json"];function fixContext(ie){if(ie){const Z=Array.isArray(ie)?ie:[ie],ee=[];for(const ae of Z)ae==="http://iiif.io/api/presentation/2/context.json"&&ee.push("http://iiif.io/api/presentation/3/context.json"),removeContexts.indexOf(ae)===-1&&ee.push(ae);if(Z.length)return ee.length===1?ee[0]:ee}}function convertMetadata(ie){return ie?ie.map(Z=>({label:convertLanguageMapping(Z.label),value:convertLanguageMapping(Z.value)})):[]}function removeUndefinedProperties(ie){for(const Z in ie)(typeof ie[Z]>"u"||ie[Z]===null)&&delete ie[Z];return ie}let mintedIdCounter=0;function mintNewIdFromResource(ie,Z){const ee=encodeURI(ie.id||ie["@id"]||"").trim();return ee&&Z?`${ee}/${Z}`:ee||(mintedIdCounter++,`http://example.org/${ie["@type"]}${Z?`/${Z}`:""}/${mintedIdCounter}`)}function technicalProperties$2(ie){const Z=[...ie.behavior||[]];ie.viewingHint&&Z.push(ie.viewingHint);let ee;return Array.isArray(ie.motivation)?ee=ie.motivation.map(removePrefix):ie.motivation&&(ee=removePrefix(ie.motivation)),{"@context":ie["@context"]?fixContext(ie["@context"]):void 0,id:(ie["@id"]||mintNewIdFromResource(ie)).trim(),type:getNewType(ie),behavior:Z.length?Z:void 0,height:ie.height?ie.height:void 0,width:ie.width?ie.width:void 0,motivation:ee,viewingDirection:ie.viewingDirection,profile:ie.profile,format:ie.format?ie.format:void 0,duration:void 0,timeMode:void 0}}function descriptiveProperties$2(ie){const[Z,ee]=fixLicense(ie.license),ae=[...ie.metadata?convertMetadata(ie.metadata):[],...ee];return{rights:Z,metadata:ae.length?ae:void 0,label:ie.label?convertLanguageMapping(ie.label):void 0,requiredStatement:ie.attribution?{label:convertLanguageMapping(configuration.attributionLabel),value:convertLanguageMapping(ie.attribution)}:void 0,navDate:ie.navDate,summary:ie.description?convertLanguageMapping(ie.description):void 0,thumbnail:ie.thumbnail}}function parseWithin(ie){if(!ie.within)return;const Z=Array.isArray(ie.within)?ie.within:[ie.within],ee=[];for(const ae of Z)if(typeof ae=="string"){if(ae)switch(ie["@type"]){case"sc:Manifest":ee.push({id:ae,type:"Collection"});break}}else ae["@id"]&&ee.push({id:ae["@id"],type:getNewType(ae)});return ee.length?ee:void 0}function linkingProperties$2(ie){const Z=ie.related?Array.isArray(ie.related)?ie.related:[ie.related]:[],ee=ie.contentLayer;return{provider:ie.logo||Z.length?[{id:configuration.providerId,type:"Agent",homepage:Z.length?[Z[0]]:void 0,logo:ie.logo?Array.isArray(ie.logo)?ie.logo:[ie.logo]:void 0,label:convertLanguageMapping(configuration.providerName)}]:void 0,partOf:parseWithin(ie),rendering:ie.rendering,seeAlso:ie.seeAlso,start:ie.startCanvas,service:ie.service?ensureArray$1(ie.service):void 0,supplementary:ee?[ee]:void 0}}function embeddedContentProperties(ie){return{chars:ie.chars,format:ie.format?ie.format:void 0,language:ie.language}}function upgradeCollection(ie){return removeUndefinedProperties({...technicalProperties$2(ie),...descriptiveProperties$2(ie),...linkingProperties$2(ie),items:ie.members})}function upgradeManifest(ie){const Z=[],ee=[];for(const ye of ie.sequences||[])ye.canvases.length&&Z.push(...ye.canvases),ye.behavior&&ee.push(...ye.behavior);const ae=technicalProperties$2(ie);return ee.length&&(ae.behavior?ae.behavior.push(...ee):ae.behavior=ee),removeUndefinedProperties({...ae,...descriptiveProperties$2(ie),...linkingProperties$2(ie),items:Z,structures:ie.structures})}function upgradeCanvas(ie){return removeUndefinedProperties({...technicalProperties$2(ie),...descriptiveProperties$2(ie),...linkingProperties$2(ie),annotations:ie.otherContent&&ie.otherContent.length?ie.otherContent:void 0,items:ie.images&&ie.images.length?[{id:mintNewIdFromResource(ie,"annotation-page"),type:"AnnotationPage",items:ie.images}]:void 0})}function upgradeAnnotationList(ie){return removeUndefinedProperties({...technicalProperties$2(ie),...descriptiveProperties$2(ie),...linkingProperties$2(ie),items:ie.resources&&ie.resources.length?ie.resources:void 0})}function upgradeSequence(ie){return!ie.canvases||ie.canvases.length===0?{canvases:[],behavior:[]}:{canvases:ie.canvases,behavior:ie.viewingHint?[ie.viewingHint]:[]}}function upgradeAnnotation(ie){function Z(ee){if(Array.isArray(ee)){if(ee.length>1)return{type:"List",items:ee.map(Z)};ee=ee[0]}if(typeof ee=="string")return encodeURI(ee).trim();if("@type"in ee){let ae;if(typeof ee.full=="string")ae=ee.full;else if(ee.full["@type"]==="dctypes:Image")ae={id:ee.full["@id"],type:"Image"};else if(ee.full["@type"]==="sc:Canvas")ae={id:ee.full["@id"],type:"Canvas"};else throw new Error(`Unsupported source type on annotation: ${ee.full["@type"]}`);return{type:"SpecificResource",source:ae,selector:upgradeSelector(ee.selector)}}else return encodeURI(ee["@id"]).trim()}return removeUndefinedProperties({...technicalProperties$2(ie),...descriptiveProperties$2(ie),...linkingProperties$2(ie),target:Z(ie.on),body:Array.isArray(ie.resource)?ie.resource.map(upgradeContentResource):upgradeContentResource(ie.resource)})}function upgradeContentResource(ie){const Z=ie;return removeUndefinedProperties({...technicalProperties$2(Z),...descriptiveProperties$2(Z),...linkingProperties$2(Z),...embeddedContentProperties(Z)})}function upgradeChoice(ie){const Z=[];return ie.default&&ie.default!=="rdf:nil"&&Z.push(ie.default),ie.item&&ie.item!=="rdf:nil"&&Z.push(...ie.item),{...technicalProperties$2(ie),...descriptiveProperties$2(ie),items:Z}}function upgradeRange(ie){return removeUndefinedProperties({...technicalProperties$2(ie),...descriptiveProperties$2(ie),...linkingProperties$2(ie),items:ie.members})}function upgradeService(ie){const{"@id":Z,"@type":ee,"@context":ae,profile:ye,...ve}=ie,be={};return Z&&(be["@id"]=Z),be["@type"]=getNewType(ie),be["@type"]==="unknown"&&(ae&&ae.length&&(be["@context"]=ae),be["@type"]="Service"),ye&&(be.profile=getProfile(ye)),removeUndefinedProperties({...be,...ve})}function upgradeLayer(ie){return removeUndefinedProperties({...technicalProperties$2(ie),...descriptiveProperties$2(ie),...linkingProperties$2(ie)})}const presentation2to3=new Traverse({collection:[upgradeCollection],manifest:[upgradeManifest],canvas:[upgradeCanvas],annotationList:[upgradeAnnotationList],sequence:[upgradeSequence],annotation:[upgradeAnnotation],contentResource:[upgradeContentResource],choice:[upgradeChoice],range:[upgradeRange],service:[upgradeService],layer:[upgradeLayer]});function convertPresentation2(ie){return ie&&ie["@context"]&&(ie["@context"]==="http://iiif.io/api/presentation/2/context.json"||ie["@context"].indexOf("http://iiif.io/api/presentation/2/context.json")!==-1||ie["@context"]==="http://www.shared-canvas.org/ns/context.json")||ie["@context"]==="http://iiif.io/api/image/2/context.json"?presentation2to3.traverseUnknown(ie):ie}function upgradeSelector(ie){if((Array.isArray(ie["@type"])&&ie["@type"].includes("oa:SvgSelector")||ie["@type"]=="oa:SvgSelector")&&("chars"in ie||"value"in ie))return{type:"SvgSelector",value:"chars"in ie?ie.chars:ie.value};if(ie["@type"]==="oa:FragmentSelector")return{type:"FragmentSelector",value:ie.value};if(ie["@type"]==="oa:Choice")return[upgradeSelector(ie.default),...(Array.isArray(ie.item)?ie.item:[ie.item]).map(upgradeSelector)];if(ie["@type"]=="iiif:ImageApiSelector")return{type:"ImageApiSelector",region:"region"in ie?ie.region:void 0,rotation:"rotation"in ie?ie.rotation:void 0};throw new Error(`Unsupported selector type: ${ie["@type"]}`)}function getDefaultEntities$1(){return{Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}}}function getResource(ie,Z){if(typeof ie=="string")return{id:ie,type:Z};if(!ie.id)throw new Error(`Invalid resource does not have an ID (${Z})`);return ie}function mapToEntities(ie){return(Z,ee)=>{const ae=ie[Z]?ie[Z]:{};return ye=>{const ve=getResource(ye,ee||Z);return ve&&ve.id&&Z?(ae[ve.id]=ae[ve.id]?mergeEntities(ae[ve.id],ve):Object.assign({},ve),{id:ve.id,type:Z==="ContentResource"?Z:ve.type}):ve}}}function merge(ie,Z){if(!Z)return ie;if(Array.isArray(ie)){if(!Array.isArray(Z))throw new Error("Cannot merge array with non-array");const ee=[...ie];for(const ae of Z)if(ae!=null)if(Array.isArray(ae))ee.push(ae);else if(typeof ae=="object"&&ae.id&&ae.type){const ye=ee.findIndex(ve=>ve.id===ae.id&&ve.type===ae.type);ye>=0&&(ee[ye]=merge(ee[ye],ae))}else ie.indexOf(ae)===-1&&ee.push(ae);return ee}else if(typeof ie=="object"){if(Array.isArray(Z)||typeof Z!="object")throw new Error("Cannot merge object with non-object");const ee={...ie};for(const[ae,ye]of Object.entries(Z)){const ve=ee[ae];ve===EMPTY||!ve?ee[ae]=ye:ee[ae]=merge(ve,ye)}return ee}else if(ie)return ie;return Z}function mergeEntities(ie,Z){if(typeof ie=="string")return ie;if(Z.id!==ie.id||Z.type!==ie.type)throw new Error("Can only merge entities with identical identifiers and type!");return merge({...ie},Z)}function recordTypeInMapping(ie){return(Z,ee)=>ae=>{const{id:ye,type:ve}=getResource(ae,ee||Z);if(typeof ye>"u")throw new Error("Found invalid entity without an ID.");return Z==="ContentResource"?ie[ye]=Z:ie[ye]=ve,ae}}function hash$1(ie){const Z=JSON.stringify(ie);let ee=5381,ae=Z.length;for(;ae;)ee=ee*33^Z.charCodeAt(--ae);const ye=(ee>>>0).toString(16);return ye.length%2?"0"+ye:ye}function addMissingIdToContentResource(ie){return Z=>typeof Z=="string"?{id:Z,type:ie}:Z.id?Z.type?Z:{type:ie,...Z}:{id:`vault://${hash$1(Z)}`,type:ie,...Z}}function ensureDefaultFields(ie){return Z=>({...ie,...Z})}function ensureArray(ie){return Array.isArray(ie)?ie:[ie]}function ensureArrayOnAnnotation(ie){return ie.body&&(ie.body=ensureArray(ie.body)),ie.seeAlso&&(ie.seeAlso=ensureArray(ie.seeAlso)),ie.body&&(ie.body=ensureArray(ie.body)),ie.audience&&(ie.audience=ensureArray(ie.audience)),ie.accessibility&&(ie.accessibility=ensureArray(ie.accessibility)),ie.motivation&&(ie.motivation=ensureArray(ie.motivation)),ie}function normalize(ie){const Z=convertPresentation2(ie),ee=getDefaultEntities$1(),ae={},ye=mapToEntities(ee),ve=recordTypeInMapping(ae),be=new Traverse$1({collection:[ensureDefaultFields(emptyCollection),ve("Collection"),ye("Collection")],manifest:[ensureDefaultFields(emptyManifest),ve("Manifest"),ye("Manifest")],canvas:[ensureDefaultFields(emptyCanvas),ve("Canvas"),ye("Canvas")],annotationPage:[addMissingIdToContentResource("AnnotationPage"),ensureDefaultFields(emptyAnnotationPage),ve("AnnotationPage"),ye("AnnotationPage")],annotation:[addMissingIdToContentResource("Annotation"),ensureArrayOnAnnotation,ve("Annotation"),ye("Annotation")],contentResource:[addMissingIdToContentResource("ContentResource"),ve("ContentResource"),ye("ContentResource")],range:[ensureDefaultFields(emptyRange),ve("Range","Canvas"),ye("Range","Canvas")],agent:[ensureDefaultFields(emptyAgent),ve("Agent"),ye("Agent")]}).traverseUnknown(Z);return{entities:ee,resource:be,mapping:ae}}const UNSET="__$UNSET$__",UNWRAP="__$UNWRAP$__";function resolveIfExists$1(ie,Z){const ee=ie.requests[Z],ae=ie.mapping[Z];if(!(!ae||ee&&ee.resourceUri&&!ie.entities[ae][ee.resourceUri]))return ie.entities[ae][ee?ee.resourceUri:Z]}function serializedFieldsToObject(ie){const Z={};for(const[ee,ae]of ie){if(ee===UNWRAP&&ae!==UNSET)return ae;ae!==UNSET&&typeof ae<"u"&&ae!==null&&(Z[ee]=ae)}return Z}function serialize(ie,Z,ee){if(!Z.type||!Z.id)throw new Error("Unknown entity");if(!ee[Z.type])throw new Error(`Serializer not found for ${Z.type}`);function ae(ye){const ve=ee[ye.type];if(!ve)return UNSET;const be=resolveIfExists$1(ie,ye.id)||(ye.id&&ye.type?ye:null);if(!be)return UNSET;const Ye=ve(be,ie,{isTopLevel:Z.id===ye.id});let Ke=Ye.next();for(;!Ke.done;){const Xe=Ke.value;let Je=UNSET;if(Xe)if(Array.isArray(Xe)){const rt=[];for(const nt of Xe)rt.push(ae(nt));Je=rt}else Je=ae(Xe);Ke=Ye.next(Je)}return Ke.value===UNSET?UNSET:serializedFieldsToObject(Ke.value)}return ae(Z)}function languageString2to3(ie){if(!ie)return;const Z=Object.keys(ie);if(Z.length!==0){if(Z.length===1){const ee=Z[0];if(!ee)return"";const ae=(ie[ee]||[]).join("");return ee==="@none"||ee==="none"||ee==="en"?ae:{"@language":ee,"@value":ae}}return Z.map(ee=>({"@language":ee,"@value":(ie[ee]||[]).join("")}))}}function parseCanvasTarget(ie){return Array.isArray(ie)?ie.map(Z=>parseCanvasTarget(Z)):typeof ie=="string"?ie:ie.type&&ie.type==="Canvas"?ie.id:ie}function unNestArray(ie,Z=!1){if(ie)return ie.length>1&&!Z?ie:ie[0]||void 0}function convertService(ie){if(ie){if(typeof ie=="string")return{"@id":ie};if("@id"in ie){const Z={...ie};return delete Z["@type"],Z}return{"@context":"http://iiif.io/api/image/2/context.json","@id":ie.id,profile:`http://iiif.io/api/image/2/profiles/${ie.profile}.json`}}}function technicalProperties$1(ie,Z){return[["@id",ie.id],["@type",Z],["format",ie.format],["height",ie.height],["width",ie.width],["viewingDirection",ie.viewingDirection!=="left-to-right"?ie.viewingDirection:void 0]]}function*descriptiveProperties$1(ie){const Z=ie.provider?yield ie.provider[0]:void 0;return[["label",languageString2to3(ie.label)],["metadata",ie.metadata&&ie.metadata.length?ie.metadata.map(ee=>({label:languageString2to3(ee.label)||"",value:languageString2to3(ee.value)||""})):void 0],["description",languageString2to3(ie.summary)],["thumbnail",unNestArray(yield ie.thumbnail)],["navDate",ie.navDate],["logo",Z?unNestArray(Z.logo):void 0],["homepage",Z?Z.homepage:void 0],["attribution",ie.requiredStatement?languageString2to3(ie.requiredStatement.value):void 0]]}function*linkingProperties$1(ie){return[["seeAlso",unNestArray(yield ie.seeAlso)],["service",unNestArray((ie.service||[]).map(convertService))],["rendering",unNestArray(yield ie.rendering)],["startCanvas",ie.start?ie.start.id:void 0]]}const serializeConfigPresentation2={Manifest:function*(ie){return[...technicalProperties$1(ie,"sc:Manifest"),...yield*descriptiveProperties$1(ie),...yield*linkingProperties$1(ie),["sequences",[{"@id":`${ie.id}/sequence0`,"@type":"sc:Sequence",canvases:yield ie.items}]],["structures",yield ie.structures]]},Canvas:function*(ie){const Z=(yield ie.items)[0];return[...technicalProperties$1(ie,"sc:Canvas"),...yield*descriptiveProperties$1(ie),...yield*linkingProperties$1(ie),["images",Z?[Z.resources]:void 0],["annotations",ie.annotations&&ie.annotations.length?unNestArray(yield ie.annotations):void 0]]},AnnotationPage:function*(ie){return[...technicalProperties$1(ie,"sc:AnnotationList"),...yield*descriptiveProperties$1(ie),["resources",ie.items&&ie.items.length?unNestArray(yield ie.items):void 0]]},Annotation:function*(ie){return[["@id",ie.id],["@type","oa:Annotation"],["motivation","sc:painting"],["on",parseCanvasTarget(ie.target)],["resource",unNestArray(yield ie.body,!0)]]},ContentResource:function*(ie){switch(ie.type){case"Image":return[...technicalProperties$1(ie,"dctypes:Image"),...yield*descriptiveProperties$1(ie),...yield*linkingProperties$1(ie)];case"Text":case"Dataset":default:return[...technicalProperties$1(ie,void 0),...yield*descriptiveProperties$1(ie)]}},AnnotationCollection:function*(ie){return[["@id",ie.id],["@type","sc:Layer"],["label",languageString2to3(ie.label)]]},Collection:function*(ie){return[...technicalProperties$1(ie,"sc:Collection"),...yield*descriptiveProperties$1(ie),...yield*linkingProperties$1(ie),["members",yield*ie.items]]},Range:function*(ie){const Z=[],ee=[];if(ie.items)for(const ae of ie.items){const ye=yield ae;Z.push({"@id":ae.id,"@type":ae.type,label:ye?ye.label:void 0,within:ie.id}),ae.type==="Canvas"&&ee.push(ae.id)}return[...technicalProperties$1(ie,"sc:Range"),...yield*descriptiveProperties$1(ie),...yield*linkingProperties$1(ie),["canvases",ee.length===Z.length?ee:void 0],["members",ee.length!==Z.length?Z:void 0]]}};function technicalProperties(ie){var Z;return[["id",(Z=ie.id)!=null&&Z.startsWith("vault://")?void 0:ie.id],["type",ie.type],["format",ie.format],["profile",ie.profile],["height",ie.height],["width",ie.width],["duration",ie.duration||void 0],["viewingDirection",ie.viewingDirection!=="left-to-right"?ie.viewingDirection:void 0],["behavior",ie.behavior&&ie.behavior.length?ie.behavior:void 0],["timeMode",ie.timeMode],["motivation",Array.isArray(ie.motivation)?ie.motivation[0]:ie.motivation]]}function filterEmpty(ie){if(!(!ie||ie.length===0))return ie}function service2compat(ie){if(ie&&ie.type&&ie.type==="ImageService2"){const{id:Z,type:ee,profile:ae,...ye}=ie,ve=typeof ae=="string"?ae:Array.isArray(ae)?ae.find(be=>typeof be=="string"):"";return{"@id":Z,"@type":ee,profile:ve?ve.startsWith("http")?ve:`http://iiif.io/api/image/2/${ve}.json`:"http://iiif.io/api/image/2/level0.json",...ye}}return ie}function filterService2Compat(ie){if(!(!ie||ie.length===0))return ie.map(service2compat)}function*descriptiveProperties(ie){return[["label",ie.label],["metadata",filterEmpty(ie.metadata)],["summary",ie.summary],["requiredStatement",ie.requiredStatement],["rights",ie.rights],["navDate",ie.navDate],["language",ie.language],["thumbnail",filterEmpty(yield ie.thumbnail)],["placeholderCanvas",yield ie.placeholderCanvas],["accompanyingCanvas",yield ie.accompanyingCanvas],["provider",filterEmpty(yield ie.provider)]]}function*linkingProperties(ie){return[["seeAlso",filterEmpty(yield ie.seeAlso)],["service",filterService2Compat(ie.service)],["services",filterService2Compat(ie.services)],["rendering",filterEmpty(yield ie.rendering)],["supplementary",filterEmpty(yield ie.supplementary)],["homepage",filterEmpty(yield ie.homepage)],["logo",filterEmpty(yield ie.logo)],["partOf",filterEmpty(yield ie.partOf)],["start",ie.start]]}const serializeConfigPresentation3={Manifest:function*(ie,Z,{isTopLevel:ee}){return ee?[["@context","http://iiif.io/api/presentation/3/context.json"],...technicalProperties(ie),...yield*descriptiveProperties(ie),...yield*linkingProperties(ie),["items",yield ie.items],["structures",filterEmpty(yield ie.structures)],["annotations",filterEmpty(yield ie.annotations)]]:[...technicalProperties(ie),...yield*descriptiveProperties(ie)]},Canvas:function*(ie){return[...technicalProperties(ie),...yield*descriptiveProperties(ie),...yield*linkingProperties(ie),["items",yield ie.items],["annotations",filterEmpty(yield ie.annotations)]]},Agent:function*(ie){return[["id",ie.id],["type","Agent"],["label",ie.label],...yield*linkingProperties(ie)]},AnnotationPage:function*(ie){return[...Object.entries(ie).map(([Z,ee])=>[Z,Array.isArray(ee)?filterEmpty(ee):ee]).filter(([Z,ee])=>Z!=="items"),...yield*linkingProperties(ie),["items",yield ie.items]]},Service:function*(ie){return[[UNWRAP,service2compat(ie)]]},Annotation:function*(ie){const Z=Object.entries(ie).map(([ae,ye])=>ae==="motivation"?[ae,Array.isArray(ye)?ye[0]:ye]:[ae,Array.isArray(ye)?filterEmpty(ye):ye]).filter(([ae])=>ae!=="body"),ee=yield ie.body;return[...Z,["body",ee.length===1?ee[0]:ee]]},ContentResource:function*(ie){return[...technicalProperties(ie),...yield*descriptiveProperties(ie),...yield*linkingProperties(ie),["annotations",filterEmpty(yield ie.annotations)],["items",filterEmpty(yield ie.items)]]},AnnotationCollection:function*(ie){return[["id",ie.id],["type","AnnotationCollection"],["label",ie.label]]},Collection:function*(ie,Z,{isTopLevel:ee}){return ee?[["@context","http://iiif.io/api/presentation/3/context.json"],...technicalProperties(ie),...yield*descriptiveProperties(ie),...yield*linkingProperties(ie),["items",filterEmpty(yield ie.items)]]:[...technicalProperties(ie),...yield*descriptiveProperties(ie)]},Range:function*(ie){const Z=[];for(const ee of ie.items)ee.type==="Range"?Z.push(yield ee):Z.push(ee);return[...technicalProperties(ie),...yield*descriptiveProperties(ie),...yield*linkingProperties(ie),["items",Z],["annotations",filterEmpty(yield ie.annotations)]]}};function n$1(ie){return ie==null}function t$1(ie){throw new Error("Argument "+ie+" is empty.")}function o$1(ie){return typeof ie=="string"||typeof ie=="symbol"}function u$1(ie){return!o$1(ie)}function a$1(ie){throw new Error("Argument "+ie+" is invalid, it should be an action type of type: string | symbol")}function s$1(ie,Z){return n$1(ie)&&t$1(1),u$1(ie)&&a$1(1),Object.assign(function(){var ee=Z!=null?Z.apply(void 0,arguments):void 0;return Object.assign({type:ie},ee)},{getType:function(){return ie},toString:function(){return ie}})}function y$1(ie,Z,ee){return n$1(ie)&&t$1(1),u$1(ie)&&a$1(1),function(){return s$1(ie,function(){var ae=arguments.length<=0?void 0:arguments[0],ye=arguments.length<=1?void 0:arguments[1];return Object.assign({},ae!==void 0&&{payload:ae},{},ye!==void 0&&{meta:ye})})}}function _typeof(ie){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Z){return typeof Z}:function(Z){return Z&&typeof Symbol=="function"&&Z.constructor===Symbol&&Z!==Symbol.prototype?"symbol":typeof Z},_typeof(ie)}function toPrimitive(ie,Z){if(_typeof(ie)!="object"||!ie)return ie;var ee=ie[Symbol.toPrimitive];if(ee!==void 0){var ae=ee.call(ie,Z||"default");if(_typeof(ae)!="object")return ae;throw new TypeError("@@toPrimitive must return a primitive value.")}return(Z==="string"?String:Number)(ie)}function toPropertyKey(ie){var Z=toPrimitive(ie,"string");return _typeof(Z)=="symbol"?Z:String(Z)}function _defineProperty$1(ie,Z,ee){return Z=toPropertyKey(Z),Z in ie?Object.defineProperty(ie,Z,{value:ee,enumerable:!0,configurable:!0,writable:!0}):ie[Z]=ee,ie}function ownKeys$1(ie,Z){var ee=Object.keys(ie);if(Object.getOwnPropertySymbols){var ae=Object.getOwnPropertySymbols(ie);Z&&(ae=ae.filter(function(ye){return Object.getOwnPropertyDescriptor(ie,ye).enumerable})),ee.push.apply(ee,ae)}return ee}function _objectSpread2$1(ie){for(var Z=1;Z<arguments.length;Z++){var ee=arguments[Z]!=null?arguments[Z]:{};Z%2?ownKeys$1(Object(ee),!0).forEach(function(ae){_defineProperty$1(ie,ae,ee[ae])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ie,Object.getOwnPropertyDescriptors(ee)):ownKeys$1(Object(ee)).forEach(function(ae){Object.defineProperty(ie,ae,Object.getOwnPropertyDescriptor(ee,ae))})}return ie}function formatProdErrorMessage(ie){return"Minified Redux error #"+ie+"; visit https://redux.js.org/Errors?code="+ie+" for the full message or use the non-minified dev environment for full errors. "}var $$observable=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),randomString=function(){return Math.random().toString(36).substring(7).split("").join(".")},ActionTypes={INIT:"@@redux/INIT"+randomString(),REPLACE:"@@redux/REPLACE"+randomString(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+randomString()}};function isPlainObject$3(ie){if(typeof ie!="object"||ie===null)return!1;for(var Z=ie;Object.getPrototypeOf(Z)!==null;)Z=Object.getPrototypeOf(Z);return Object.getPrototypeOf(ie)===Z}function createStore$1(ie,Z,ee){var ae;if(typeof Z=="function"&&typeof ee=="function"||typeof ee=="function"&&typeof arguments[3]=="function")throw new Error(formatProdErrorMessage(0));if(typeof Z=="function"&&typeof ee>"u"&&(ee=Z,Z=void 0),typeof ee<"u"){if(typeof ee!="function")throw new Error(formatProdErrorMessage(1));return ee(createStore$1)(ie,Z)}if(typeof ie!="function")throw new Error(formatProdErrorMessage(2));var ye=ie,ve=Z,be=[],Ye=be,Ke=!1;function Xe(){Ye===be&&(Ye=be.slice())}function Je(){if(Ke)throw new Error(formatProdErrorMessage(3));return ve}function rt(ct){if(typeof ct!="function")throw new Error(formatProdErrorMessage(4));if(Ke)throw new Error(formatProdErrorMessage(5));var ot=!0;return Xe(),Ye.push(ct),function(){if(ot){if(Ke)throw new Error(formatProdErrorMessage(6));ot=!1,Xe();var dt=Ye.indexOf(ct);Ye.splice(dt,1),be=null}}}function nt(ct){if(!isPlainObject$3(ct))throw new Error(formatProdErrorMessage(7));if(typeof ct.type>"u")throw new Error(formatProdErrorMessage(8));if(Ke)throw new Error(formatProdErrorMessage(9));try{Ke=!0,ve=ye(ve,ct)}finally{Ke=!1}for(var ot=be=Ye,dt=0;dt<ot.length;dt++){var ft=ot[dt];ft()}return ct}function it(ct){if(typeof ct!="function")throw new Error(formatProdErrorMessage(10));ye=ct,nt({type:ActionTypes.REPLACE})}function lt(){var ct,ot=rt;return ct={subscribe:function(dt){if(typeof dt!="object"||dt===null)throw new Error(formatProdErrorMessage(11));function ft(){dt.next&&dt.next(Je())}ft();var gt=ot(ft);return{unsubscribe:gt}}},ct[$$observable]=function(){return this},ct}return nt({type:ActionTypes.INIT}),ae={dispatch:nt,subscribe:rt,getState:Je,replaceReducer:it},ae[$$observable]=lt,ae}function assertReducerShape(ie){Object.keys(ie).forEach(function(Z){var ee=ie[Z],ae=ee(void 0,{type:ActionTypes.INIT});if(typeof ae>"u")throw new Error(formatProdErrorMessage(12));if(typeof ee(void 0,{type:ActionTypes.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(formatProdErrorMessage(13))})}function combineReducers(ie){for(var Z=Object.keys(ie),ee={},ae=0;ae<Z.length;ae++){var ye=Z[ae];typeof ie[ye]=="function"&&(ee[ye]=ie[ye])}var ve=Object.keys(ee),be;try{assertReducerShape(ee)}catch(Ye){be=Ye}return function(Ye,Ke){if(Ye===void 0&&(Ye={}),be)throw be;for(var Xe=!1,Je={},rt=0;rt<ve.length;rt++){var nt=ve[rt],it=ee[nt],lt=Ye[nt],ct=it(lt,Ke);if(typeof ct>"u")throw Ke&&Ke.type,new Error(formatProdErrorMessage(14));Je[nt]=ct,Xe=Xe||ct!==lt}return Xe=Xe||ve.length!==Object.keys(Ye).length,Xe?Je:Ye}}function compose(){for(var ie=arguments.length,Z=new Array(ie),ee=0;ee<ie;ee++)Z[ee]=arguments[ee];return Z.length===0?function(ae){return ae}:Z.length===1?Z[0]:Z.reduce(function(ae,ye){return function(){return ae(ye.apply(void 0,arguments))}})}function applyMiddleware(){for(var ie=arguments.length,Z=new Array(ie),ee=0;ee<ie;ee++)Z[ee]=arguments[ee];return function(ae){return function(){var ye=ae.apply(void 0,arguments),ve=function(){throw new Error(formatProdErrorMessage(15))},be={getState:ye.getState,dispatch:function(){return ve.apply(void 0,arguments)}},Ye=Z.map(function(Ke){return Ke(be)});return ve=compose.apply(void 0,Ye)(ye.dispatch),_objectSpread2$1(_objectSpread2$1({},ye),{},{dispatch:ve})}}}const IMPORT_ENTITIES="@iiif/IMPORT_ENTITIES",MODIFY_ENTITY_FIELD="@iiif/MODIFY_ENTITY_FIELD",REORDER_ENTITY_FIELD="@iiif/REORDER_ENTITY_FIELD",ADD_REFERENCE="@iiif/ADD_REFERENCE",REMOVE_REFERENCE="@iiif/REMOVE_REFERENCE",importEntities=y$1(IMPORT_ENTITIES)(),modifyEntityField=y$1(MODIFY_ENTITY_FIELD)(),reorderEntityField=y$1(REORDER_ENTITY_FIELD)(),addReference=y$1(ADD_REFERENCE)(),removeReference=y$1(REMOVE_REFERENCE)(),entityActions={importEntities,modifyEntityField,reorderEntityField,addReference,removeReference},ADD_MAPPING="@iiif/ADD_MAPPING",ADD_MAPPINGS="@iiif/ADD_MAPPINGS",addMapping=y$1(ADD_MAPPING)(),addMappings=y$1(ADD_MAPPINGS)(),SET_META_VALUE="@iiif/SET_META_VALUE",SET_META_VALUE_DYNAMIC="@iiif/SET_META_VALUE_DYNAMIC",UNSET_META_VALUE="@iiif/UNSET_META_VALUE",setMetaValue=y$1(SET_META_VALUE)(),setMetaValueDynamic=y$1(SET_META_VALUE_DYNAMIC)(),unsetMetaValue=y$1(UNSET_META_VALUE)(),metaActions={setMetaValue,setMetaValueDynamic,unsetMetaValue},RESOURCE_ERROR="RESOURCE_ERROR",RESOURCE_LOADING="RESOURCE_LOADING",RESOURCE_READY="RESOURCE_READY",REQUEST_RESOURCE="@iiif/REQUEST_RESOURCE",REQUEST_ERROR="@iiif/REQUEST_ERROR",REQUEST_MISMATCH="@iiif/REQUEST_MISMATCH",REQUEST_COMPLETE="@iiif/REQUEST_COMPLETE",REQUEST_OFFLINE_RESOURCE="@iiif/REQUEST_OFFLINE_RESOURCE",requestResource=y$1(REQUEST_RESOURCE)(),requestError=y$1(REQUEST_ERROR)(),requestMismatch=y$1(REQUEST_MISMATCH)(),requestComplete=y$1(REQUEST_COMPLETE)();y$1(REQUEST_OFFLINE_RESOURCE)();const BATCH_ACTIONS="@iiif/BATCH",BATCH_IMPORT="@iiif/BATCH_IMPORT",batchActions=y$1(BATCH_ACTIONS)();y$1(BATCH_IMPORT)();const actionListFromResource=(ie,Z)=>{const{entities:ee,resource:ae,mapping:ye}=normalize(Z);if(ae.id===void 0)return[requestError({id:ie,message:"ID is not defined in resource."})];const ve=[importEntities({entities:ee}),addMappings({mapping:ye})];return ae.id!==ie&&(ve.push(addMapping({id:ie,type:ae.type})),ve.push(requestMismatch({requestId:ie,actualId:ae.id}))),ve.push(requestComplete({id:ie})),ve},safeIsNaN=Number.isNaN||function(ie){return typeof ie=="number"&&ie!==ie};function isEqual(ie,Z){return!!(ie===Z||safeIsNaN(ie)&&safeIsNaN(Z))}function areInputsEqual(ie,Z){if(!Array.isArray(ie)||!Array.isArray(Z))return ie===Z;if(ie.length!==Z.length)return!1;for(let ee=0;ee<ie.length;ee++)if(!isEqual(ie[ee],Z[ee]))return!1;return!0}function resolveIfExists(ie,Z){const ee=ie.iiif.requests[Z],ae=ie.iiif.mapping[Z];if(!(!ae||!ie.iiif.entities[ae][ee.resourceUri]))return ie.iiif.entities[ae][ee.resourceUri]}function createFetchHelper(ie,Z,{waitTimeout:ee=30}={}){return async(ae,ye)=>{const ve=ie.getState(),be=ve.iiif.requests[ae];if(be)switch(be.loadingState){case RESOURCE_ERROR:break;case RESOURCE_LOADING:{let Ye,Ke=!1;try{const Xe=await Promise.race([new Promise((Je,rt)=>{Ke||(Ye=ie.subscribe(()=>{const nt=ie.getState();if(nt.iiif.requests[ae].loadingState===RESOURCE_ERROR){rt();return}if(nt.iiif.requests[ae].loadingState===RESOURCE_READY){const it=resolveIfExists(nt,ae);it?Je(it):rt()}}))}),new Promise((Je,rt)=>setTimeout(()=>{Ke=!0,rt()},ee*60))]);if(Ye&&Ye(),Xe)return Xe}catch{Ye&&Ye();break}break}case RESOURCE_READY:{const Ye=resolveIfExists(ve,ae);if(Ye)return Ye;break}}ie.dispatch(requestResource({id:ae}));try{const Ye=await Z(ae,ye);!Ye.id&&!Ye["@id"]&&(Ye["@type"]&&(Ye["@id"]=ae),Ye.id=ae);const Ke=actionListFromResource(ae,Ye);return ie.dispatch(batchActions({actions:Ke})),resolveIfExists(ie.getState(),ae)}catch(Ye){throw ie.dispatch(requestError({id:ae,message:Ye.toString()})),Ye}}}function getDefaultEntities(){return{Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}}}const mappingReducer=(ie={},Z)=>{switch(Z.type){case ADD_MAPPING:return{...ie,[Z.payload.id]:Z.payload.type};case ADD_MAPPINGS:return{...ie,...Z.payload.mapping};default:return ie}};function isReferenceList(ie,Z,ee,ae){return!(!ie[ee]||!ie[ee][Z]||!ie[ee][Z][ae]||!Array.isArray(ie[ee][Z][ae]))}function quickMerge(ie,Z){const ee={},ae=[];for(const[ye,ve]of Object.entries(ie||{})){ae.push(ye);const be=(Z||{})[ye];if(!be||be.length===0){ee[ye]=ve;continue}ee[ye]=be}for(const[ye,ve]of Object.entries(Z||{}))ae.indexOf(ye)===-1&&(ee[ye]=ve);return ee}const entitiesReducer=(ie=getDefaultEntities(),Z)=>{var ee;switch(Z.type){case MODIFY_ENTITY_FIELD:{if(!ie[Z.payload.type]||!ie[Z.payload.type][Z.payload.id])return ie;const ae=ie[Z.payload.type][Z.payload.id];return typeof ae=="string"?ie:{...ie,[Z.payload.type]:{...ie[Z.payload.type],[Z.payload.id]:{...ae,[Z.payload.key]:Z.payload.value}}}}case REORDER_ENTITY_FIELD:{if(!isReferenceList(ie,Z.payload.id,Z.payload.type,Z.payload.key))return ie;const ae=ie[Z.payload.type][Z.payload.id];if(typeof ae=="string")return ie;const ye=Array.from(ae[Z.payload.key]),[ve]=ye.splice(Z.payload.startIndex,1);return ye.splice(Z.payload.endIndex,0,ve),{...ie,[Z.payload.type]:{...ie[Z.payload.type],[Z.payload.id]:{...ae,[Z.payload.key]:ye}}}}case IMPORT_ENTITIES:{const ae=Object.keys(Z.payload.entities),ye={...ie};for(const ve of ae){const be=Z.payload.entities[ve],Ye={...ie[ve]||{}};let Ke=!1;const Xe=Object.keys(be||{})||[];if(be&&Xe){for(const Je of Xe)Ke=!0,Ye[Je]=ie[ve][Je]?quickMerge(ie[ve][Je],be[Je]):be[Je];Ke&&(ye[ve]=Ye)}}return ye}case ADD_REFERENCE:{if(!isReferenceList(ie,Z.payload.id,Z.payload.type,Z.payload.key))return ie;const ae=ie[Z.payload.type][Z.payload.id],ye=Array.from(ae[Z.payload.key]);return ye.splice(Z.payload.index||ye.length+1,0,Z.payload.reference),{...ie,[Z.payload.type]:{...ie[Z.payload.type],[Z.payload.id]:{...ae,[Z.payload.key]:ye}}}}case REMOVE_REFERENCE:{if(!isReferenceList(ie,Z.payload.id,Z.payload.type,Z.payload.key))return ie;const ae=ie[Z.payload.type][Z.payload.id],ye=Array.from(ae[Z.payload.key]),ve=Z.payload.index||ye.findIndex(be=>be&&be.id===Z.payload.reference.id);return ve===-1||((ee=ye[ve])==null?void 0:ee.id)!==Z.payload.reference.id?ie:(ye.splice(ve,1),{...ie,[Z.payload.type]:{...ie[Z.payload.type],[Z.payload.id]:{...ae,[Z.payload.key]:ye}}})}default:return ie}},requestReducer=(ie={},Z)=>{switch(Z.type){case REQUEST_RESOURCE:case REQUEST_OFFLINE_RESOURCE:return{...ie,[Z.payload.id]:{requestUri:Z.payload.id,loadingState:RESOURCE_LOADING,uriMismatch:!1,resourceUri:Z.payload.id}};case REQUEST_MISMATCH:return{...ie,[Z.payload.requestId]:{...ie[Z.payload.requestId]||{},uriMismatch:!0,resourceUri:Z.payload.actualId},[Z.payload.actualId]:{requestUri:Z.payload.requestId,loadingState:ie[Z.payload.requestId].loadingState,uriMismatch:!0,resourceUri:Z.payload.actualId}};case REQUEST_ERROR:return{...ie,[Z.payload.id]:{...ie[Z.payload.id]||{},loadingState:RESOURCE_ERROR,error:Z.payload.message}};case REQUEST_COMPLETE:return{...ie,[Z.payload.id]:{...ie[Z.payload.id]||{},loadingState:RESOURCE_READY,error:void 0}}}return ie},metaReducer=(ie={},Z)=>{const{id:ee,updateValue:ae,value:ye,meta:ve,key:be}=Z&&Z.payload||{};switch(Z.type){case SET_META_VALUE:return{...ie,[ee]:{...ie[ee]||{},[ve]:{...ie[ee]?ie[ee][ve]||{}:{},[be]:ye}}};case SET_META_VALUE_DYNAMIC:return{...ie,[ee]:{...ie[ee]||{},[ve]:{...ie[ee]?ie[ee][ve]||{}:{},[be]:ie[ee]&&ie[ee][ve]?ae(ie[ee][ve][be]):ae(void 0)}}};case UNSET_META_VALUE:return ie[ee]&&ie[ee][ve]&&ie[ee][ve][be]?{...ie,[ee]:{...ie[ee]||{},[ve]:{...ie[ee]?ie[ee][ve]||{}:{},[be]:void 0}}}:ie;default:return ie}};function createBatchReducer(ie){return(Z,ee)=>ee&&ee.type===BATCH_ACTIONS?ee.payload.actions.reduce(ie,Z):ee&&ee.type===BATCH_IMPORT?ee.payload.state:ie(Z,ee)}const reducers=combineReducers({mapping:mappingReducer,entities:entitiesReducer,requests:requestReducer,meta:metaReducer}),composeEnhancers=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||compose;function createStore(ie={}){const{enableDevtools:Z=!0,iiifStoreName:ee="iiif",defaultState:ae={},extraMiddleware:ye=[],customReducers:ve={}}=ie,be=combineReducers({[ee]:reducers,...ve});return createStore$1(createBatchReducer(be),ae,Z?composeEnhancers(applyMiddleware(...ye)):compose(applyMiddleware(...ye)))}function mitt(ie){return{all:ie=ie||new Map,on:function(Z,ee){var ae=ie.get(Z);ae?ae.push(ee):ie.set(Z,[ee])},off:function(Z,ee){var ae=ie.get(Z);ae&&(ee?ae.splice(ae.indexOf(ee)>>>0,1):ie.set(Z,[]))},emit:function(Z,ee){var ae=ie.get(Z);ae&&ae.slice().map(function(ye){ye(ee)}),(ae=ie.get("*"))&&ae.slice().map(function(ye){ye(Z,ee)})}}}class Vault{constructor(Z,ee){Sc(this,"options"),Sc(this,"store"),Sc(this,"emitter"),Sc(this,"isBatching",!1),Sc(this,"batchQueue",[]),Sc(this,"remoteFetcher"),Sc(this,"staticFetcher"),Sc(this,"defaultFetcher",ae=>fetch(ae).then(ye=>ye.json())),Sc(this,"middleware",ae=>ye=>ve=>{if(ve.type===BATCH_ACTIONS){for(const Ke of ve.payload.actions)this.emitter.emit(Ke.type,{realAction:Ke,state:ae.getState()});const Ye=ye(ve);for(const Ke of ve.payload.actions)this.emitter.emit(`after:${ve.type}`,{action:ve,state:Ye});return Ye}this.emitter.emit(ve.type,{action:ve,state:ae.getState()});const be=ye(ve);return this.emitter.emit(`after:${ve.type}`,{action:ve,state:be}),be}),this.options=Object.assign({reducers:{},middleware:[],defaultState:{},customFetcher:this.defaultFetcher,enableDevtools:!0},Z||{}),this.store=ee||createStore({customReducers:this.options.reducers,extraMiddleware:[...this.options.middleware,this.middleware],defaultState:this.options.defaultState,enableDevtools:this.options.enableDevtools}),this.emitter=mitt(),this.remoteFetcher=createFetchHelper(this.store,this.options.customFetcher),this.staticFetcher=createFetchHelper(this.store,(ae,ye)=>ye)}batch(Z){this.isBatching=!0;try{Z(this),this.store.dispatch(batchActions({actions:this.batchQueue}))}catch(ee){throw this.batchQueue=[],this.isBatching=!1,ee}this.batchQueue=[],this.isBatching=!1}async asyncBatch(Z){this.isBatching=!0;try{await Z(this),this.store.dispatch(batchActions({actions:this.batchQueue}))}catch(ee){throw this.batchQueue=[],this.isBatching=!1,ee}this.batchQueue=[],this.isBatching=!1}modifyEntityField(Z,ee,ae){this.dispatch(entityActions.modifyEntityField({id:Z.id,type:Z.type,key:ee,value:ae}))}dispatch(Z){this.isBatching?this.batchQueue.push(Z):this.store.dispatch(Z)}serialize(Z,ee){return serialize(this.getState().iiif,Z,ee)}toPresentation2(Z){return this.serialize(Z,serializeConfigPresentation2)}toPresentation3(Z){return this.serialize(Z,serializeConfigPresentation3)}hydrate(Z,ee){return this.get(Z,ee,{skipSelfReturn:!1})}get(Z,ee,ae={}){typeof ee!="string"&&(ae=ee||{},ee=void 0);const{skipSelfReturn:ye=!0}=ae||{};if(Array.isArray(Z))return Z.map(Xe=>this.get(Xe,ae));const ve=this.getState();if(typeof Z=="string"){const Xe=ee||ve.iiif.mapping[Z];if(!Xe)return ye?null:{id:Z,type:"unknown"};Z={id:Z,type:Xe}}const be=ee||Z.type,Ye=Z.id,Ke=ve.iiif.entities[be];if(!Ke){const Xe=ve.iiif.requests[Ye];return Xe&&Xe.resourceUri!==Ye?this.get(Xe.resourceUri,ae):ye?null:Z}return Ke[Z.id]||(ye?null:Z)}select(Z){return Z(this.getState())}getStore(){return this.store}getState(){return this.store.getState()}loadManifest(Z,ee){const ae=typeof Z=="string"?Z:Z.id;return this.load(ae,ee)}loadCollection(Z,ee){const ae=typeof Z=="string"?Z:Z.id;return this.load(ae,ee)}load(Z,ee){const ae=typeof Z=="string"?Z:Z.id;return ee?this.staticFetcher(ae,ee):this.remoteFetcher(ae)}areInputsEqual(Z,ee){return areInputsEqual(Z,ee)}subscribe(Z,ee,ae){typeof ae>"u"&&(typeof ee>"u"||ee===!1||ee===!0)&&(ae=ee,ee=Z,Z=ve=>ve);let ye=ae?null:Z(this.store.getState());return ae||ee(ye,this),this.store.subscribe(()=>{const ve=this.store.getState(),be=Z(ve);ye!==be&&!areInputsEqual(ye,be)&&ee(be,this),ye=be})}async ensureLoaded(Z){const ee=typeof Z=="string"?Z:Z.id;this.requestStatus(ee)||await this.load(ee)}requestStatus(Z){return this.select(ee=>ee.iiif.requests[Z])}getResourceMeta(Z,ee){const ae=this.getState().iiif.meta[Z];if(ae)return ee?ae[ee]:ae}setMetaValue([Z,ee,ae],ye){this.dispatch(typeof ye=="function"?metaActions.setMetaValueDynamic({id:Z,meta:ee,key:ae,updateValue:ye}):metaActions.setMetaValue({id:Z,meta:ee,key:ae,value:ye}))}}function _extends$1(){return _extends$1=Object.assign?Object.assign.bind():function(ie){for(var Z=1;Z<arguments.length;Z++){var ee=arguments[Z];for(var ae in ee)Object.prototype.hasOwnProperty.call(ee,ae)&&(ie[ae]=ee[ae])}return ie},_extends$1.apply(this,arguments)}function $e42e1063c40fb3ef$export$b9ecd428b558ff10(ie,Z,{checkForDefaultPrevented:ee=!0}={}){return function(ae){if(ie==null||ie(ae),ee===!1||!ae.defaultPrevented)return Z==null?void 0:Z(ae)}}function $c512c27ab02ef895$export$50c7b4e9d9f19c1(ie,Z=[]){let ee=[];function ae(ve,be){const Ye=reactExports.createContext(be),Ke=ee.length;ee=[...ee,be];function Xe(rt){const{scope:nt,children:it,...lt}=rt,ct=(nt==null?void 0:nt[ie][Ke])||Ye,ot=reactExports.useMemo(()=>lt,Object.values(lt));return reactExports.createElement(ct.Provider,{value:ot},it)}function Je(rt,nt){const it=(nt==null?void 0:nt[ie][Ke])||Ye,lt=reactExports.useContext(it);if(lt)return lt;if(be!==void 0)return be;throw new Error(`\`${rt}\` must be used within \`${ve}\``)}return Xe.displayName=ve+"Provider",[Xe,Je]}const ye=()=>{const ve=ee.map(be=>reactExports.createContext(be));return function(be){const Ye=(be==null?void 0:be[ie])||ve;return reactExports.useMemo(()=>({[`__scope${ie}`]:{...be,[ie]:Ye}}),[be,Ye])}};return ye.scopeName=ie,[ae,$c512c27ab02ef895$var$composeContextScopes(ye,...Z)]}function $c512c27ab02ef895$var$composeContextScopes(...ie){const Z=ie[0];if(ie.length===1)return Z;const ee=()=>{const ae=ie.map(ye=>({useScope:ye(),scopeName:ye.scopeName}));return function(ye){const ve=ae.reduce((be,{useScope:Ye,scopeName:Ke})=>{const Xe=Ye(ye)[`__scope${Ke}`];return{...be,...Xe}},{});return reactExports.useMemo(()=>({[`__scope${Z.scopeName}`]:ve}),[ve])}};return ee.scopeName=Z.scopeName,ee}function $b1b2314f5f9a1d84$export$25bec8c6f54ee79a(ie){const Z=reactExports.useRef(ie);return reactExports.useEffect(()=>{Z.current=ie}),reactExports.useMemo(()=>(...ee)=>{var ae;return(ae=Z.current)===null||ae===void 0?void 0:ae.call(Z,...ee)},[])}function $71cd76cc60e0454e$export$6f32135080cb4c3({prop:ie,defaultProp:Z,onChange:ee=()=>{}}){const[ae,ye]=$71cd76cc60e0454e$var$useUncontrolledState({defaultProp:Z,onChange:ee}),ve=ie!==void 0,be=ve?ie:ae,Ye=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(ee),Ke=reactExports.useCallback(Xe=>{if(ve){const Je=typeof Xe=="function"?Xe(ie):Xe;Je!==ie&&Ye(Je)}else ye(Xe)},[ve,ie,ye,Ye]);return[be,Ke]}function $71cd76cc60e0454e$var$useUncontrolledState({defaultProp:ie,onChange:Z}){const ee=reactExports.useState(ie),[ae]=ee,ye=reactExports.useRef(ae),ve=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(Z);return reactExports.useEffect(()=>{ye.current!==ae&&(ve(ae),ye.current=ae)},[ae,ye,ve]),ee}const $9f79659886946c16$export$e5c5a5f917a5871c=globalThis!=null&&globalThis.document?reactExports.useLayoutEffect:()=>{};function $6ed0406888f73fc4$var$setRef(ie,Z){typeof ie=="function"?ie(Z):ie!=null&&(ie.current=Z)}function $6ed0406888f73fc4$export$43e446d32b3d21af(...ie){return Z=>ie.forEach(ee=>$6ed0406888f73fc4$var$setRef(ee,Z))}function $6ed0406888f73fc4$export$c7b2cbe3552a0d05(...ie){return reactExports.useCallback($6ed0406888f73fc4$export$43e446d32b3d21af(...ie),ie)}const $5e63c961fc1ce211$export$8c6ed5c666ac1360=reactExports.forwardRef((ie,Z)=>{const{children:ee,...ae}=ie,ye=reactExports.Children.toArray(ee),ve=ye.find($5e63c961fc1ce211$var$isSlottable);if(ve){const be=ve.props.children,Ye=ye.map(Ke=>Ke===ve?reactExports.Children.count(be)>1?reactExports.Children.only(null):reactExports.isValidElement(be)?be.props.children:null:Ke);return reactExports.createElement($5e63c961fc1ce211$var$SlotClone,_extends$1({},ae,{ref:Z}),reactExports.isValidElement(be)?reactExports.cloneElement(be,void 0,Ye):null)}return reactExports.createElement($5e63c961fc1ce211$var$SlotClone,_extends$1({},ae,{ref:Z}),ee)});$5e63c961fc1ce211$export$8c6ed5c666ac1360.displayName="Slot";const $5e63c961fc1ce211$var$SlotClone=reactExports.forwardRef((ie,Z)=>{const{children:ee,...ae}=ie;return reactExports.isValidElement(ee)?reactExports.cloneElement(ee,{...$5e63c961fc1ce211$var$mergeProps(ae,ee.props),ref:Z?$6ed0406888f73fc4$export$43e446d32b3d21af(Z,ee.ref):ee.ref}):reactExports.Children.count(ee)>1?reactExports.Children.only(null):null});$5e63c961fc1ce211$var$SlotClone.displayName="SlotClone";const $5e63c961fc1ce211$export$d9f1ccf0bdb05d45=({children:ie})=>reactExports.createElement(reactExports.Fragment,null,ie);function $5e63c961fc1ce211$var$isSlottable(ie){return reactExports.isValidElement(ie)&&ie.type===$5e63c961fc1ce211$export$d9f1ccf0bdb05d45}function $5e63c961fc1ce211$var$mergeProps(ie,Z){const ee={...Z};for(const ae in Z){const ye=ie[ae],ve=Z[ae];/^on[A-Z]/.test(ae)?ye&&ve?ee[ae]=(...be)=>{ve(...be),ye(...be)}:ye&&(ee[ae]=ye):ae==="style"?ee[ae]={...ye,...ve}:ae==="className"&&(ee[ae]=[ye,ve].filter(Boolean).join(" "))}return{...ie,...ee}}const $8927f6f2acc4f386$var$NODES=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],$8927f6f2acc4f386$export$250ffa63cdc0d034=$8927f6f2acc4f386$var$NODES.reduce((ie,Z)=>{const ee=reactExports.forwardRef((ae,ye)=>{const{asChild:ve,...be}=ae,Ye=ve?$5e63c961fc1ce211$export$8c6ed5c666ac1360:Z;return reactExports.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),reactExports.createElement(Ye,_extends$1({},be,{ref:ye}))});return ee.displayName=`Primitive.${Z}`,{...ie,[Z]:ee}},{});function $8927f6f2acc4f386$export$6d1a0317bde7de7f(ie,Z){ie&&reactDomExports.flushSync(()=>ie.dispatchEvent(Z))}function $fe963b355347cc68$export$3e6543de14f8614f(ie,Z){return reactExports.useReducer((ee,ae)=>Z[ee][ae]??ee,ie)}const $921a889cee6df7e8$export$99c2b779aa4e8b8b=ie=>{const{present:Z,children:ee}=ie,ae=$921a889cee6df7e8$var$usePresence(Z),ye=typeof ee=="function"?ee({present:ae.isPresent}):reactExports.Children.only(ee),ve=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(ae.ref,ye.ref);return typeof ee=="function"||ae.isPresent?reactExports.cloneElement(ye,{ref:ve}):null};$921a889cee6df7e8$export$99c2b779aa4e8b8b.displayName="Presence";function $921a889cee6df7e8$var$usePresence(ie){const[Z,ee]=reactExports.useState(),ae=reactExports.useRef({}),ye=reactExports.useRef(ie),ve=reactExports.useRef("none"),be=ie?"mounted":"unmounted",[Ye,Ke]=$fe963b355347cc68$export$3e6543de14f8614f(be,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return reactExports.useEffect(()=>{const Xe=$921a889cee6df7e8$var$getAnimationName(ae.current);ve.current=Ye==="mounted"?Xe:"none"},[Ye]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{const Xe=ae.current,Je=ye.current;if(Je!==ie){const rt=ve.current,nt=$921a889cee6df7e8$var$getAnimationName(Xe);ie?Ke("MOUNT"):nt==="none"||(Xe==null?void 0:Xe.display)==="none"?Ke("UNMOUNT"):Ke(Je&&rt!==nt?"ANIMATION_OUT":"UNMOUNT"),ye.current=ie}},[ie,Ke]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{if(Z){const Xe=rt=>{const nt=$921a889cee6df7e8$var$getAnimationName(ae.current).includes(rt.animationName);rt.target===Z&&nt&&reactDomExports.flushSync(()=>Ke("ANIMATION_END"))},Je=rt=>{rt.target===Z&&(ve.current=$921a889cee6df7e8$var$getAnimationName(ae.current))};return Z.addEventListener("animationstart",Je),Z.addEventListener("animationcancel",Xe),Z.addEventListener("animationend",Xe),()=>{Z.removeEventListener("animationstart",Je),Z.removeEventListener("animationcancel",Xe),Z.removeEventListener("animationend",Xe)}}else Ke("ANIMATION_END")},[Z,Ke]),{isPresent:["mounted","unmountSuspended"].includes(Ye),ref:reactExports.useCallback(Xe=>{Xe&&(ae.current=getComputedStyle(Xe)),ee(Xe)},[])}}function $921a889cee6df7e8$var$getAnimationName(ie){return(ie==null?void 0:ie.animationName)||"none"}const $1746a345f3d73bb7$var$useReactId=$2AODx$react.useId||(()=>{});let $1746a345f3d73bb7$var$count=0;function $1746a345f3d73bb7$export$f680877a34711e37(ie){const[Z,ee]=reactExports.useState($1746a345f3d73bb7$var$useReactId());return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{ie||ee(ae=>ae??String($1746a345f3d73bb7$var$count++))},[ie]),ie||(Z?`radix-${Z}`:"")}const $409067139f391064$var$COLLAPSIBLE_NAME="Collapsible",[$409067139f391064$var$createCollapsibleContext,$409067139f391064$export$952b32dcbe73087a]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($409067139f391064$var$COLLAPSIBLE_NAME),[$409067139f391064$var$CollapsibleProvider,$409067139f391064$var$useCollapsibleContext]=$409067139f391064$var$createCollapsibleContext($409067139f391064$var$COLLAPSIBLE_NAME),$409067139f391064$export$6eb0f7ddcda6131f=reactExports.forwardRef((ie,Z)=>{const{__scopeCollapsible:ee,open:ae,defaultOpen:ye,disabled:ve,onOpenChange:be,...Ye}=ie,[Ke=!1,Xe]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:ae,defaultProp:ye,onChange:be});return reactExports.createElement($409067139f391064$var$CollapsibleProvider,{scope:ee,disabled:ve,contentId:$1746a345f3d73bb7$export$f680877a34711e37(),open:Ke,onOpenToggle:reactExports.useCallback(()=>Xe(Je=>!Je),[Xe])},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"data-state":$409067139f391064$var$getState(Ke),"data-disabled":ve?"":void 0},Ye,{ref:Z})))}),$409067139f391064$var$TRIGGER_NAME="CollapsibleTrigger",$409067139f391064$export$c135dce7b15bbbdc=reactExports.forwardRef((ie,Z)=>{const{__scopeCollapsible:ee,...ae}=ie,ye=$409067139f391064$var$useCollapsibleContext($409067139f391064$var$TRIGGER_NAME,ee);return reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button","aria-controls":ye.contentId,"aria-expanded":ye.open||!1,"data-state":$409067139f391064$var$getState(ye.open),"data-disabled":ye.disabled?"":void 0,disabled:ye.disabled},ae,{ref:Z,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onClick,ye.onOpenToggle)}))}),$409067139f391064$var$CONTENT_NAME="CollapsibleContent",$409067139f391064$export$aadde00976f34151=reactExports.forwardRef((ie,Z)=>{const{forceMount:ee,...ae}=ie,ye=$409067139f391064$var$useCollapsibleContext($409067139f391064$var$CONTENT_NAME,ie.__scopeCollapsible);return reactExports.createElement($921a889cee6df7e8$export$99c2b779aa4e8b8b,{present:ee||ye.open},({present:ve})=>reactExports.createElement($409067139f391064$var$CollapsibleContentImpl,_extends$1({},ae,{ref:Z,present:ve})))}),$409067139f391064$var$CollapsibleContentImpl=reactExports.forwardRef((ie,Z)=>{const{__scopeCollapsible:ee,present:ae,children:ye,...ve}=ie,be=$409067139f391064$var$useCollapsibleContext($409067139f391064$var$CONTENT_NAME,ee),[Ye,Ke]=reactExports.useState(ae),Xe=reactExports.useRef(null),Je=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,Xe),rt=reactExports.useRef(0),nt=rt.current,it=reactExports.useRef(0),lt=it.current,ct=be.open||Ye,ot=reactExports.useRef(ct),dt=reactExports.useRef();return reactExports.useEffect(()=>{const ft=requestAnimationFrame(()=>ot.current=!1);return()=>cancelAnimationFrame(ft)},[]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{const ft=Xe.current;if(ft){dt.current=dt.current||{transitionDuration:ft.style.transitionDuration,animationName:ft.style.animationName},ft.style.transitionDuration="0s",ft.style.animationName="none";const gt=ft.getBoundingClientRect();rt.current=gt.height,it.current=gt.width,ot.current||(ft.style.transitionDuration=dt.current.transitionDuration,ft.style.animationName=dt.current.animationName),Ke(ae)}},[be.open,ae]),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"data-state":$409067139f391064$var$getState(be.open),"data-disabled":be.disabled?"":void 0,id:be.contentId,hidden:!ct},ve,{ref:Je,style:{"--radix-collapsible-content-height":nt?`${nt}px`:void 0,"--radix-collapsible-content-width":lt?`${lt}px`:void 0,...ie.style}}),ct&&ye)});function $409067139f391064$var$getState(ie){return ie?"open":"closed"}const $409067139f391064$export$be92b6f5f03c0fe9=$409067139f391064$export$6eb0f7ddcda6131f,$409067139f391064$export$41fb9f06171c75f4=$409067139f391064$export$c135dce7b15bbbdc,$409067139f391064$export$7c6e2c02157bb7d2=$409067139f391064$export$aadde00976f34151,ErrorBoundaryContext=reactExports.createContext(null),initialState={didCatch:!1,error:null};class ErrorBoundary extends reactExports.Component{constructor(Z){super(Z),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=initialState}static getDerivedStateFromError(Z){return{didCatch:!0,error:Z}}resetErrorBoundary(){const{error:Z}=this.state;if(Z!==null){for(var ee,ae,ye=arguments.length,ve=new Array(ye),be=0;be<ye;be++)ve[be]=arguments[be];(ee=(ae=this.props).onReset)===null||ee===void 0||ee.call(ae,{args:ve,reason:"imperative-api"}),this.setState(initialState)}}componentDidCatch(Z,ee){var ae,ye;(ae=(ye=this.props).onError)===null||ae===void 0||ae.call(ye,Z,ee)}componentDidUpdate(Z,ee){const{didCatch:ae}=this.state,{resetKeys:ye}=this.props;if(ae&&ee.error!==null&&hasArrayChanged(Z.resetKeys,ye)){var ve,be;(ve=(be=this.props).onReset)===null||ve===void 0||ve.call(be,{next:ye,prev:Z.resetKeys,reason:"keys"}),this.setState(initialState)}}render(){const{children:Z,fallbackRender:ee,FallbackComponent:ae,fallback:ye}=this.props,{didCatch:ve,error:be}=this.state;let Ye=Z;if(ve){const Ke={error:be,resetErrorBoundary:this.resetErrorBoundary};if(typeof ee=="function")Ye=ee(Ke);else if(ae)Ye=reactExports.createElement(ae,Ke);else if(ye===null||reactExports.isValidElement(ye))Ye=ye;else throw be}return reactExports.createElement(ErrorBoundaryContext.Provider,{value:{didCatch:ve,error:be,resetErrorBoundary:this.resetErrorBoundary}},Ye)}}function hasArrayChanged(){let ie=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],Z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return ie.length!==Z.length||ie.some((ee,ae)=>!Object.is(ee,Z[ae]))}var e="colors",t="sizes",r="space",n={gap:r,gridGap:r,columnGap:r,gridColumnGap:r,rowGap:r,gridRowGap:r,inset:r,insetBlock:r,insetBlockEnd:r,insetBlockStart:r,insetInline:r,insetInlineEnd:r,insetInlineStart:r,margin:r,marginTop:r,marginRight:r,marginBottom:r,marginLeft:r,marginBlock:r,marginBlockEnd:r,marginBlockStart:r,marginInline:r,marginInlineEnd:r,marginInlineStart:r,padding:r,paddingTop:r,paddingRight:r,paddingBottom:r,paddingLeft:r,paddingBlock:r,paddingBlockEnd:r,paddingBlockStart:r,paddingInline:r,paddingInlineEnd:r,paddingInlineStart:r,top:r,right:r,bottom:r,left:r,scrollMargin:r,scrollMarginTop:r,scrollMarginRight:r,scrollMarginBottom:r,scrollMarginLeft:r,scrollMarginX:r,scrollMarginY:r,scrollMarginBlock:r,scrollMarginBlockEnd:r,scrollMarginBlockStart:r,scrollMarginInline:r,scrollMarginInlineEnd:r,scrollMarginInlineStart:r,scrollPadding:r,scrollPaddingTop:r,scrollPaddingRight:r,scrollPaddingBottom:r,scrollPaddingLeft:r,scrollPaddingX:r,scrollPaddingY:r,scrollPaddingBlock:r,scrollPaddingBlockEnd:r,scrollPaddingBlockStart:r,scrollPaddingInline:r,scrollPaddingInlineEnd:r,scrollPaddingInlineStart:r,fontSize:"fontSizes",background:e,backgroundColor:e,backgroundImage:e,borderImage:e,border:e,borderBlock:e,borderBlockEnd:e,borderBlockStart:e,borderBottom:e,borderBottomColor:e,borderColor:e,borderInline:e,borderInlineEnd:e,borderInlineStart:e,borderLeft:e,borderLeftColor:e,borderRight:e,borderRightColor:e,borderTop:e,borderTopColor:e,caretColor:e,color:e,columnRuleColor:e,fill:e,outline:e,outlineColor:e,stroke:e,textDecorationColor:e,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:t,minBlockSize:t,maxBlockSize:t,inlineSize:t,minInlineSize:t,maxInlineSize:t,width:t,minWidth:t,maxWidth:t,height:t,minHeight:t,maxHeight:t,flexBasis:t,gridTemplateColumns:t,gridTemplateRows:t,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},i=(ie,Z)=>typeof Z=="function"?{"()":Function.prototype.toString.call(Z)}:Z,o=()=>{const ie=Object.create(null);return(Z,ee,...ae)=>{const ye=(ve=>JSON.stringify(ve,i))(Z);return ye in ie?ie[ye]:ie[ye]=ee(Z,...ae)}},l=Symbol.for("sxs.internal"),s=(ie,Z)=>Object.defineProperties(ie,Object.getOwnPropertyDescriptors(Z)),a=ie=>{for(const Z in ie)return!0;return!1},{hasOwnProperty:c}=Object.prototype,d=ie=>ie.includes("-")?ie:ie.replace(/[A-Z]/g,Z=>"-"+Z.toLowerCase()),g=/\s+(?![^()]*\))/,p=ie=>Z=>ie(...typeof Z=="string"?String(Z).split(g):[Z]),u={appearance:ie=>({WebkitAppearance:ie,appearance:ie}),backfaceVisibility:ie=>({WebkitBackfaceVisibility:ie,backfaceVisibility:ie}),backdropFilter:ie=>({WebkitBackdropFilter:ie,backdropFilter:ie}),backgroundClip:ie=>({WebkitBackgroundClip:ie,backgroundClip:ie}),boxDecorationBreak:ie=>({WebkitBoxDecorationBreak:ie,boxDecorationBreak:ie}),clipPath:ie=>({WebkitClipPath:ie,clipPath:ie}),content:ie=>({content:ie.includes('"')||ie.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(ie)?ie:`"${ie}"`}),hyphens:ie=>({WebkitHyphens:ie,hyphens:ie}),maskImage:ie=>({WebkitMaskImage:ie,maskImage:ie}),maskSize:ie=>({WebkitMaskSize:ie,maskSize:ie}),tabSize:ie=>({MozTabSize:ie,tabSize:ie}),textSizeAdjust:ie=>({WebkitTextSizeAdjust:ie,textSizeAdjust:ie}),userSelect:ie=>({WebkitUserSelect:ie,userSelect:ie}),marginBlock:p((ie,Z)=>({marginBlockStart:ie,marginBlockEnd:Z||ie})),marginInline:p((ie,Z)=>({marginInlineStart:ie,marginInlineEnd:Z||ie})),maxSize:p((ie,Z)=>({maxBlockSize:ie,maxInlineSize:Z||ie})),minSize:p((ie,Z)=>({minBlockSize:ie,minInlineSize:Z||ie})),paddingBlock:p((ie,Z)=>({paddingBlockStart:ie,paddingBlockEnd:Z||ie})),paddingInline:p((ie,Z)=>({paddingInlineStart:ie,paddingInlineEnd:Z||ie}))},h=/([\d.]+)([^]*)/,f=(ie,Z)=>ie.length?ie.reduce((ee,ae)=>(ee.push(...Z.map(ye=>ye.includes("&")?ye.replace(/&/g,/[ +>|~]/.test(ae)&&/&.*&/.test(ye)?`:is(${ae})`:ae):ae+" "+ye)),ee),[]):Z,m$1=(ie,Z)=>ie in b&&typeof Z=="string"?Z.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,(ee,ae,ye,ve)=>ae+(ye==="stretch"?`-moz-available${ve};${d(ie)}:${ae}-webkit-fill-available`:`-moz-fit-content${ve};${d(ie)}:${ae}fit-content`)+ve):String(Z),b={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},S$1=ie=>ie?ie+"-":"",k$1=(ie,Z,ee)=>ie.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,(ae,ye,ve,be,Ye)=>be=="$"==!!ve?ae:(ye||be=="--"?"calc(":"")+"var(--"+(be==="$"?S$1(Z)+(Ye.includes("$")?"":S$1(ee))+Ye.replace(/\$/g,"-"):Ye)+")"+(ye||be=="--"?"*"+(ye||"")+(ve||"1")+")":"")),y=/\s*,\s*(?![^()]*\))/,B=Object.prototype.toString,$=(ie,Z,ee,ae,ye)=>{let ve,be,Ye;const Ke=(Xe,Je,rt)=>{let nt,it;const lt=ct=>{for(nt in ct){const ft=nt.charCodeAt(0)===64,gt=ft&&Array.isArray(ct[nt])?ct[nt]:[ct[nt]];for(it of gt){const mt=/[A-Z]/.test(dt=nt)?dt:dt.replace(/-[^]/g,Qr=>Qr[1].toUpperCase()),Yr=typeof it=="object"&&it&&it.toString===B&&(!ae.utils[mt]||!Je.length);if(mt in ae.utils&&!Yr){const Qr=ae.utils[mt];if(Qr!==be){be=Qr,lt(Qr(it)),be=null;continue}}else if(mt in u){const Qr=u[mt];if(Qr!==Ye){Ye=Qr,lt(Qr(it)),Ye=null;continue}}if(ft&&(ot=nt.slice(1)in ae.media?"@media "+ae.media[nt.slice(1)]:nt,nt=ot.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,(Qr,Xr,Jr,ai,oi,ni)=>{const li=h.test(Xr),ui=.0625*(li?-1:1),[mi,ii]=li?[ai,Xr]:[Xr,ai];return"("+(Jr[0]==="="?"":Jr[0]===">"===li?"max-":"min-")+mi+":"+(Jr[0]!=="="&&Jr.length===1?ii.replace(h,(hi,ri,ci)=>Number(ri)+ui*(Jr===">"?1:-1)+ci):ii)+(oi?") and ("+(oi[0]===">"?"min-":"max-")+mi+":"+(oi.length===1?ni.replace(h,(hi,ri,ci)=>Number(ri)+ui*(oi===">"?-1:1)+ci):ni):"")+")"})),Yr){const Qr=ft?rt.concat(nt):[...rt],Xr=ft?[...Je]:f(Je,nt.split(y));ve!==void 0&&ye(x$1(...ve)),ve=void 0,Ke(it,Xr,Qr)}else ve===void 0&&(ve=[[],Je,rt]),nt=ft||nt.charCodeAt(0)!==36?nt:`--${S$1(ae.prefix)}${nt.slice(1).replace(/\$/g,"-")}`,it=Yr?it:typeof it=="number"?it&&mt in I?String(it)+"px":String(it):k$1(m$1(mt,it??""),ae.prefix,ae.themeMap[mt]),ve[0].push(`${ft?`${nt} `:`${d(nt)}:`}${it}`)}}var ot,dt};lt(Xe),ve!==void 0&&ye(x$1(...ve)),ve=void 0};Ke(ie,Z,ee)},x$1=(ie,Z,ee)=>`${ee.map(ae=>`${ae}{`).join("")}${Z.length?`${Z.join(",")}{`:""}${ie.join(";")}${Z.length?"}":""}${Array(ee.length?ee.length+1:0).join("}")}`,I={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},R$1=ie=>String.fromCharCode(ie+(ie>25?39:97)),z$1=ie=>(Z=>{let ee,ae="";for(ee=Math.abs(Z);ee>52;ee=ee/52|0)ae=R$1(ee%52)+ae;return R$1(ee%52)+ae})(((Z,ee)=>{let ae=ee.length;for(;ae;)Z=33*Z^ee.charCodeAt(--ae);return Z})(5381,JSON.stringify(ie))>>>0),W$1=["themed","global","styled","onevar","resonevar","allvar","inline"],j$1=ie=>{if(ie.href&&!ie.href.startsWith(location.origin))return!1;try{return!!ie.cssRules}catch{return!1}},E=ie=>{let Z;const ee=()=>{const{cssRules:ye}=Z.sheet;return[].map.call(ye,(ve,be)=>{const{cssText:Ye}=ve;let Ke="";if(Ye.startsWith("--sxs"))return"";if(ye[be-1]&&(Ke=ye[be-1].cssText).startsWith("--sxs")){if(!ve.cssRules.length)return"";for(const Xe in Z.rules)if(Z.rules[Xe].group===ve)return`--sxs{--sxs:${[...Z.rules[Xe].cache].join(" ")}}${Ye}`;return ve.cssRules.length?`${Ke}${Ye}`:""}return Ye}).join("")},ae=()=>{if(Z){const{rules:Ye,sheet:Ke}=Z;if(!Ke.deleteRule){for(;Object(Object(Ke.cssRules)[0]).type===3;)Ke.cssRules.splice(0,1);Ke.cssRules=[]}for(const Xe in Ye)delete Ye[Xe]}const ye=Object(ie).styleSheets||[];for(const Ye of ye)if(j$1(Ye)){for(let Ke=0,Xe=Ye.cssRules;Xe[Ke];++Ke){const Je=Object(Xe[Ke]);if(Je.type!==1)continue;const rt=Object(Xe[Ke+1]);if(rt.type!==4)continue;++Ke;const{cssText:nt}=Je;if(!nt.startsWith("--sxs"))continue;const it=nt.slice(14,-3).trim().split(/\s+/),lt=W$1[it[0]];lt&&(Z||(Z={sheet:Ye,reset:ae,rules:{},toString:ee}),Z.rules[lt]={group:rt,index:Ke,cache:new Set(it)})}if(Z)break}if(!Z){const Ye=(Ke,Xe)=>({type:Xe,cssRules:[],insertRule(Je,rt){this.cssRules.splice(rt,0,Ye(Je,{import:3,undefined:1}[(Je.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return Ke==="@media{}"?`@media{${[].map.call(this.cssRules,Je=>Je.cssText).join("")}}`:Ke}});Z={sheet:ie?(ie.head||ie).appendChild(document.createElement("style")).sheet:Ye("","text/css"),rules:{},reset:ae,toString:ee}}const{sheet:ve,rules:be}=Z;for(let Ye=W$1.length-1;Ye>=0;--Ye){const Ke=W$1[Ye];if(!be[Ke]){const Xe=W$1[Ye+1],Je=be[Xe]?be[Xe].index:ve.cssRules.length;ve.insertRule("@media{}",Je),ve.insertRule(`--sxs{--sxs:${Ye}}`,Je),be[Ke]={group:ve.cssRules[Je+1],index:Je,cache:new Set([Ye])}}v(be[Ke])}};return ae(),Z},v=ie=>{const Z=ie.group;let ee=Z.cssRules.length;ie.apply=ae=>{try{Z.insertRule(ae,ee),++ee}catch{}}},T$1=Symbol(),w=o(),M=(ie,Z)=>w(ie,()=>(...ee)=>{let ae={type:null,composers:new Set};for(const ye of ee)if(ye!=null)if(ye[l]){ae.type==null&&(ae.type=ye[l].type);for(const ve of ye[l].composers)ae.composers.add(ve)}else ye.constructor!==Object||ye.$$typeof?ae.type==null&&(ae.type=ye):ae.composers.add(C(ye,ie));return ae.type==null&&(ae.type="span"),ae.composers.size||ae.composers.add(["PJLV",{},[],[],{},[]]),P(ie,ae,Z)}),C=({variants:ie,compoundVariants:Z,defaultVariants:ee,...ae},ye)=>{const ve=`${S$1(ye.prefix)}c-${z$1(ae)}`,be=[],Ye=[],Ke=Object.create(null),Xe=[];for(const nt in ee)Ke[nt]=String(ee[nt]);if(typeof ie=="object"&&ie)for(const nt in ie){Je=Ke,rt=nt,c.call(Je,rt)||(Ke[nt]="undefined");const it=ie[nt];for(const lt in it){const ct={[nt]:String(lt)};String(lt)==="undefined"&&Xe.push(nt);const ot=it[lt],dt=[ct,ot,!a(ot)];be.push(dt)}}var Je,rt;if(typeof Z=="object"&&Z)for(const nt of Z){let{css:it,...lt}=nt;it=typeof it=="object"&&it||{};for(const ot in lt)lt[ot]=String(lt[ot]);const ct=[lt,it,!a(it)];Ye.push(ct)}return[ve,ae,be,Ye,Ke,Xe]},P=(ie,Z,ee)=>{const[ae,ye,ve,be]=L$1(Z.composers),Ye=typeof Z.type=="function"||Z.type.$$typeof?(rt=>{function nt(){for(let it=0;it<nt[T$1].length;it++){const[lt,ct]=nt[T$1][it];rt.rules[lt].apply(ct)}return nt[T$1]=[],null}return nt[T$1]=[],nt.rules={},W$1.forEach(it=>nt.rules[it]={apply:lt=>nt[T$1].push([it,lt])}),nt})(ee):null,Ke=(Ye||ee).rules,Xe=`.${ae}${ye.length>1?`:where(.${ye.slice(1).join(".")})`:""}`,Je=rt=>{rt=typeof rt=="object"&&rt||A;const{css:nt,...it}=rt,lt={};for(const dt in ve)if(delete it[dt],dt in rt){let ft=rt[dt];typeof ft=="object"&&ft?lt[dt]={"@initial":ve[dt],...ft}:(ft=String(ft),lt[dt]=ft!=="undefined"||be.has(dt)?ft:ve[dt])}else lt[dt]=ve[dt];const ct=new Set([...ye]);for(const[dt,ft,gt,mt]of Z.composers){ee.rules.styled.cache.has(dt)||(ee.rules.styled.cache.add(dt),$(ft,[`.${dt}`],[],ie,Xr=>{Ke.styled.apply(Xr)}));const Yr=O$1(gt,lt,ie.media),Qr=O$1(mt,lt,ie.media,!0);for(const Xr of Yr)if(Xr!==void 0)for(const[Jr,ai,oi]of Xr){const ni=`${dt}-${z$1(ai)}-${Jr}`;ct.add(ni);const li=(oi?ee.rules.resonevar:ee.rules.onevar).cache,ui=oi?Ke.resonevar:Ke.onevar;li.has(ni)||(li.add(ni),$(ai,[`.${ni}`],[],ie,mi=>{ui.apply(mi)}))}for(const Xr of Qr)if(Xr!==void 0)for(const[Jr,ai]of Xr){const oi=`${dt}-${z$1(ai)}-${Jr}`;ct.add(oi),ee.rules.allvar.cache.has(oi)||(ee.rules.allvar.cache.add(oi),$(ai,[`.${oi}`],[],ie,ni=>{Ke.allvar.apply(ni)}))}}if(typeof nt=="object"&&nt){const dt=`${ae}-i${z$1(nt)}-css`;ct.add(dt),ee.rules.inline.cache.has(dt)||(ee.rules.inline.cache.add(dt),$(nt,[`.${dt}`],[],ie,ft=>{Ke.inline.apply(ft)}))}for(const dt of String(rt.className||"").trim().split(/\s+/))dt&&ct.add(dt);const ot=it.className=[...ct].join(" ");return{type:Z.type,className:ot,selector:Xe,props:it,toString:()=>ot,deferredInjector:Ye}};return s(Je,{className:ae,selector:Xe,[l]:Z,toString:()=>(ee.rules.styled.cache.has(ae)||Je(),ae)})},L$1=ie=>{let Z="";const ee=[],ae={},ye=[];for(const[ve,,,,be,Ye]of ie){Z===""&&(Z=ve),ee.push(ve),ye.push(...Ye);for(const Ke in be){const Xe=be[Ke];(ae[Ke]===void 0||Xe!=="undefined"||Ye.includes(Xe))&&(ae[Ke]=Xe)}}return[Z,ee,ae,new Set(ye)]},O$1=(ie,Z,ee,ae)=>{const ye=[];e:for(let[ve,be,Ye]of ie){if(Ye)continue;let Ke,Xe=0,Je=!1;for(Ke in ve){const rt=ve[Ke];let nt=Z[Ke];if(nt!==rt){if(typeof nt!="object"||!nt)continue e;{let it,lt,ct=0;for(const ot in nt){if(rt===String(nt[ot])){if(ot!=="@initial"){const dt=ot.slice(1);(lt=lt||[]).push(dt in ee?ee[dt]:ot.replace(/^@media ?/,"")),Je=!0}Xe+=ct,it=!0}++ct}if(lt&&lt.length&&(be={["@media "+lt.join(", ")]:be}),!it)continue e}}}(ye[Xe]=ye[Xe]||[]).push([ae?"cv":`${Ke}-${ve[Ke]}`,be,Je])}return ye},A={},N$1=o(),D$1=(ie,Z)=>N$1(ie,()=>(...ee)=>{const ae=()=>{for(let ye of ee){ye=typeof ye=="object"&&ye||{};let ve=z$1(ye);if(!Z.rules.global.cache.has(ve)){if(Z.rules.global.cache.add(ve),"@import"in ye){let be=[].indexOf.call(Z.sheet.cssRules,Z.rules.themed.group)-1;for(let Ye of[].concat(ye["@import"]))Ye=Ye.includes('"')||Ye.includes("'")?Ye:`"${Ye}"`,Z.sheet.insertRule(`@import ${Ye};`,be++);delete ye["@import"]}$(ye,[],[],ie,be=>{Z.rules.global.apply(be)})}}return""};return s(ae,{toString:ae})}),H=o(),V=(ie,Z)=>H(ie,()=>ee=>{const ae=`${S$1(ie.prefix)}k-${z$1(ee)}`,ye=()=>{if(!Z.rules.global.cache.has(ae)){Z.rules.global.cache.add(ae);const ve=[];$(ee,[],[],ie,Ye=>ve.push(Ye));const be=`@keyframes ${ae}{${ve.join("")}}`;Z.rules.global.apply(be)}return ae};return s(ye,{get name(){return ye()},toString:ye})}),G=class{constructor(ie,Z,ee,ae){this.token=ie==null?"":String(ie),this.value=Z==null?"":String(Z),this.scale=ee==null?"":String(ee),this.prefix=ae==null?"":String(ae)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+S$1(this.prefix)+S$1(this.scale)+this.token}toString(){return this.computedValue}},F=o(),J$1=(ie,Z)=>F(ie,()=>(ee,ae)=>{ae=typeof ee=="object"&&ee||Object(ae);const ye=`.${ee=(ee=typeof ee=="string"?ee:"")||`${S$1(ie.prefix)}t-${z$1(ae)}`}`,ve={},be=[];for(const Ke in ae){ve[Ke]={};for(const Xe in ae[Ke]){const Je=`--${S$1(ie.prefix)}${Ke}-${Xe}`,rt=k$1(String(ae[Ke][Xe]),ie.prefix,Ke);ve[Ke][Xe]=new G(Xe,rt,Ke,ie.prefix),be.push(`${Je}:${rt}`)}}const Ye=()=>{if(be.length&&!Z.rules.themed.cache.has(ee)){Z.rules.themed.cache.add(ee);const Ke=`${ae===ie.theme?":root,":""}.${ee}{${be.join(";")}}`;Z.rules.themed.apply(Ke)}return ee};return{...ve,get className(){return Ye()},selector:ye,toString:Ye}}),U=o(),X$1,Y$1=o(),q=ie=>{const Z=(ee=>{let ae=!1;const ye=U(ee,ve=>{ae=!0;const be="prefix"in(ve=typeof ve=="object"&&ve||{})?String(ve.prefix):"",Ye=typeof ve.media=="object"&&ve.media||{},Ke=typeof ve.root=="object"?ve.root||null:globalThis.document||null,Xe=typeof ve.theme=="object"&&ve.theme||{},Je={prefix:be,media:Ye,theme:Xe,themeMap:typeof ve.themeMap=="object"&&ve.themeMap||{...n},utils:typeof ve.utils=="object"&&ve.utils||{}},rt=E(Ke),nt={css:M(Je,rt),globalCss:D$1(Je,rt),keyframes:V(Je,rt),createTheme:J$1(Je,rt),reset(){rt.reset(),nt.theme.toString()},theme:{},sheet:rt,config:Je,prefix:be,getCssText:rt.toString,toString:rt.toString};return String(nt.theme=nt.createTheme(Xe)),nt});return ae||ye.reset(),ye})(ie);return Z.styled=(({config:ee,sheet:ae})=>Y$1(ee,()=>{const ye=M(ee,ae);return(...ve)=>{const be=ye(...ve),Ye=be[l].type,Ke=e$1.forwardRef((Xe,Je)=>{const rt=Xe&&Xe.as||Ye,{props:nt,deferredInjector:it}=be(Xe);return delete nt.as,nt.ref=Je,it?e$1.createElement(e$1.Fragment,null,e$1.createElement(rt,nt),e$1.createElement(it,null)):e$1.createElement(rt,nt)});return Ke.className=be.className,Ke.displayName=`Styled.${Ye.displayName||Ye.name||Ye}`,Ke.selector=be.selector,Ke.toString=()=>be.selector,Ke[l]=be[l],Ke}}))(Z),Z},K$1=()=>X$1||(X$1=q()),Q$1=(...ie)=>K$1().createTheme(...ie);function $e02a7d9cb1dc128c$export$c74125a8e3af6bb2(ie){const Z=ie+"CollectionProvider",[ee,ae]=$c512c27ab02ef895$export$50c7b4e9d9f19c1(Z),[ye,ve]=ee(Z,{collectionRef:{current:null},itemMap:new Map}),be=it=>{const{scope:lt,children:ct}=it,ot=e$1.useRef(null),dt=e$1.useRef(new Map).current;return e$1.createElement(ye,{scope:lt,itemMap:dt,collectionRef:ot},ct)},Ye=ie+"CollectionSlot",Ke=e$1.forwardRef((it,lt)=>{const{scope:ct,children:ot}=it,dt=ve(Ye,ct),ft=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(lt,dt.collectionRef);return e$1.createElement($5e63c961fc1ce211$export$8c6ed5c666ac1360,{ref:ft},ot)}),Xe=ie+"CollectionItemSlot",Je="data-radix-collection-item",rt=e$1.forwardRef((it,lt)=>{const{scope:ct,children:ot,...dt}=it,ft=e$1.useRef(null),gt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(lt,ft),mt=ve(Xe,ct);return e$1.useEffect(()=>(mt.itemMap.set(ft,{ref:ft,...dt}),()=>void mt.itemMap.delete(ft))),e$1.createElement($5e63c961fc1ce211$export$8c6ed5c666ac1360,{[Je]:"",ref:gt},ot)});function nt(it){const lt=ve(ie+"CollectionConsumer",it);return e$1.useCallback(()=>{const ct=lt.collectionRef.current;if(!ct)return[];const ot=Array.from(ct.querySelectorAll(`[${Je}]`));return Array.from(lt.itemMap.values()).sort((dt,ft)=>ot.indexOf(dt.ref.current)-ot.indexOf(ft.ref.current))},[lt.collectionRef,lt.itemMap])}return[{Provider:be,Slot:Ke,ItemSlot:rt},nt,ae]}const $f631663db3294ace$var$DirectionContext=reactExports.createContext(void 0);function $f631663db3294ace$export$b39126d51d94e6f3(ie){const Z=reactExports.useContext($f631663db3294ace$var$DirectionContext);return ie||Z||"ltr"}const $d7bdfb9eb0fdf311$var$ENTRY_FOCUS="rovingFocusGroup.onEntryFocus",$d7bdfb9eb0fdf311$var$EVENT_OPTIONS={bubbles:!1,cancelable:!0},$d7bdfb9eb0fdf311$var$GROUP_NAME="RovingFocusGroup",[$d7bdfb9eb0fdf311$var$Collection,$d7bdfb9eb0fdf311$var$useCollection,$d7bdfb9eb0fdf311$var$createCollectionScope]=$e02a7d9cb1dc128c$export$c74125a8e3af6bb2($d7bdfb9eb0fdf311$var$GROUP_NAME),[$d7bdfb9eb0fdf311$var$createRovingFocusGroupContext,$d7bdfb9eb0fdf311$export$c7109489551a4f4]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($d7bdfb9eb0fdf311$var$GROUP_NAME,[$d7bdfb9eb0fdf311$var$createCollectionScope]),[$d7bdfb9eb0fdf311$var$RovingFocusProvider,$d7bdfb9eb0fdf311$var$useRovingFocusContext]=$d7bdfb9eb0fdf311$var$createRovingFocusGroupContext($d7bdfb9eb0fdf311$var$GROUP_NAME),$d7bdfb9eb0fdf311$export$8699f7c8af148338=reactExports.forwardRef((ie,Z)=>reactExports.createElement($d7bdfb9eb0fdf311$var$Collection.Provider,{scope:ie.__scopeRovingFocusGroup},reactExports.createElement($d7bdfb9eb0fdf311$var$Collection.Slot,{scope:ie.__scopeRovingFocusGroup},reactExports.createElement($d7bdfb9eb0fdf311$var$RovingFocusGroupImpl,_extends$1({},ie,{ref:Z}))))),$d7bdfb9eb0fdf311$var$RovingFocusGroupImpl=reactExports.forwardRef((ie,Z)=>{const{__scopeRovingFocusGroup:ee,orientation:ae,loop:ye=!1,dir:ve,currentTabStopId:be,defaultCurrentTabStopId:Ye,onCurrentTabStopIdChange:Ke,onEntryFocus:Xe,...Je}=ie,rt=reactExports.useRef(null),nt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,rt),it=$f631663db3294ace$export$b39126d51d94e6f3(ve),[lt=null,ct]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:be,defaultProp:Ye,onChange:Ke}),[ot,dt]=reactExports.useState(!1),ft=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(Xe),gt=$d7bdfb9eb0fdf311$var$useCollection(ee),mt=reactExports.useRef(!1),[Yr,Qr]=reactExports.useState(0);return reactExports.useEffect(()=>{const Xr=rt.current;if(Xr)return Xr.addEventListener($d7bdfb9eb0fdf311$var$ENTRY_FOCUS,ft),()=>Xr.removeEventListener($d7bdfb9eb0fdf311$var$ENTRY_FOCUS,ft)},[ft]),reactExports.createElement($d7bdfb9eb0fdf311$var$RovingFocusProvider,{scope:ee,orientation:ae,dir:it,loop:ye,currentTabStopId:lt,onItemFocus:reactExports.useCallback(Xr=>ct(Xr),[ct]),onItemShiftTab:reactExports.useCallback(()=>dt(!0),[]),onFocusableItemAdd:reactExports.useCallback(()=>Qr(Xr=>Xr+1),[]),onFocusableItemRemove:reactExports.useCallback(()=>Qr(Xr=>Xr-1),[])},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({tabIndex:ot||Yr===0?-1:0,"data-orientation":ae},Je,{ref:nt,style:{outline:"none",...ie.style},onMouseDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onMouseDown,()=>{mt.current=!0}),onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onFocus,Xr=>{const Jr=!mt.current;if(Xr.target===Xr.currentTarget&&Jr&&!ot){const ai=new CustomEvent($d7bdfb9eb0fdf311$var$ENTRY_FOCUS,$d7bdfb9eb0fdf311$var$EVENT_OPTIONS);if(Xr.currentTarget.dispatchEvent(ai),!ai.defaultPrevented){const oi=gt().filter(mi=>mi.focusable),ni=oi.find(mi=>mi.active),li=oi.find(mi=>mi.id===lt),ui=[ni,li,...oi].filter(Boolean).map(mi=>mi.ref.current);$d7bdfb9eb0fdf311$var$focusFirst(ui)}}mt.current=!1}),onBlur:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onBlur,()=>dt(!1))})))}),$d7bdfb9eb0fdf311$var$ITEM_NAME="RovingFocusGroupItem",$d7bdfb9eb0fdf311$export$ab9df7c53fe8454=reactExports.forwardRef((ie,Z)=>{const{__scopeRovingFocusGroup:ee,focusable:ae=!0,active:ye=!1,tabStopId:ve,...be}=ie,Ye=$1746a345f3d73bb7$export$f680877a34711e37(),Ke=ve||Ye,Xe=$d7bdfb9eb0fdf311$var$useRovingFocusContext($d7bdfb9eb0fdf311$var$ITEM_NAME,ee),Je=Xe.currentTabStopId===Ke,rt=$d7bdfb9eb0fdf311$var$useCollection(ee),{onFocusableItemAdd:nt,onFocusableItemRemove:it}=Xe;return reactExports.useEffect(()=>{if(ae)return nt(),()=>it()},[ae,nt,it]),reactExports.createElement($d7bdfb9eb0fdf311$var$Collection.ItemSlot,{scope:ee,id:Ke,focusable:ae,active:ye},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({tabIndex:Je?0:-1,"data-orientation":Xe.orientation},be,{ref:Z,onMouseDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onMouseDown,lt=>{ae?Xe.onItemFocus(Ke):lt.preventDefault()}),onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onFocus,()=>Xe.onItemFocus(Ke)),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onKeyDown,lt=>{if(lt.key==="Tab"&&lt.shiftKey){Xe.onItemShiftTab();return}if(lt.target!==lt.currentTarget)return;const ct=$d7bdfb9eb0fdf311$var$getFocusIntent(lt,Xe.orientation,Xe.dir);if(ct!==void 0){lt.preventDefault();let ot=rt().filter(dt=>dt.focusable).map(dt=>dt.ref.current);if(ct==="last")ot.reverse();else if(ct==="prev"||ct==="next"){ct==="prev"&&ot.reverse();const dt=ot.indexOf(lt.currentTarget);ot=Xe.loop?$d7bdfb9eb0fdf311$var$wrapArray(ot,dt+1):ot.slice(dt+1)}setTimeout(()=>$d7bdfb9eb0fdf311$var$focusFirst(ot))}})})))}),$d7bdfb9eb0fdf311$var$MAP_KEY_TO_FOCUS_INTENT={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function $d7bdfb9eb0fdf311$var$getDirectionAwareKey(ie,Z){return Z!=="rtl"?ie:ie==="ArrowLeft"?"ArrowRight":ie==="ArrowRight"?"ArrowLeft":ie}function $d7bdfb9eb0fdf311$var$getFocusIntent(ie,Z,ee){const ae=$d7bdfb9eb0fdf311$var$getDirectionAwareKey(ie.key,ee);if(!(Z==="vertical"&&["ArrowLeft","ArrowRight"].includes(ae))&&!(Z==="horizontal"&&["ArrowUp","ArrowDown"].includes(ae)))return $d7bdfb9eb0fdf311$var$MAP_KEY_TO_FOCUS_INTENT[ae]}function $d7bdfb9eb0fdf311$var$focusFirst(ie){const Z=document.activeElement;for(const ee of ie)if(ee===Z||(ee.focus(),document.activeElement!==Z))return}function $d7bdfb9eb0fdf311$var$wrapArray(ie,Z){return ie.map((ee,ae)=>ie[(Z+ae)%ie.length])}const $d7bdfb9eb0fdf311$export$be92b6f5f03c0fe9=$d7bdfb9eb0fdf311$export$8699f7c8af148338,$d7bdfb9eb0fdf311$export$6d08773d2e66f8f2=$d7bdfb9eb0fdf311$export$ab9df7c53fe8454,$69cb30bb0017df05$var$TABS_NAME="Tabs",[$69cb30bb0017df05$var$createTabsContext,$69cb30bb0017df05$export$355f5bd209d7b13a]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($69cb30bb0017df05$var$TABS_NAME,[$d7bdfb9eb0fdf311$export$c7109489551a4f4]),$69cb30bb0017df05$var$useRovingFocusGroupScope=$d7bdfb9eb0fdf311$export$c7109489551a4f4(),[$69cb30bb0017df05$var$TabsProvider,$69cb30bb0017df05$var$useTabsContext]=$69cb30bb0017df05$var$createTabsContext($69cb30bb0017df05$var$TABS_NAME),$69cb30bb0017df05$export$b2539bed5023c21c=reactExports.forwardRef((ie,Z)=>{const{__scopeTabs:ee,value:ae,onValueChange:ye,defaultValue:ve,orientation:be="horizontal",dir:Ye,activationMode:Ke="automatic",...Xe}=ie,Je=$f631663db3294ace$export$b39126d51d94e6f3(Ye),[rt,nt]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:ae,onChange:ye,defaultProp:ve});return reactExports.createElement($69cb30bb0017df05$var$TabsProvider,{scope:ee,baseId:$1746a345f3d73bb7$export$f680877a34711e37(),value:rt,onValueChange:nt,orientation:be,dir:Je,activationMode:Ke},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({dir:Je,"data-orientation":be},Xe,{ref:Z})))}),$69cb30bb0017df05$var$TAB_LIST_NAME="TabsList",$69cb30bb0017df05$export$9712d22edc0d78c1=reactExports.forwardRef((ie,Z)=>{const{__scopeTabs:ee,loop:ae=!0,...ye}=ie,ve=$69cb30bb0017df05$var$useTabsContext($69cb30bb0017df05$var$TAB_LIST_NAME,ee),be=$69cb30bb0017df05$var$useRovingFocusGroupScope(ee);return reactExports.createElement($d7bdfb9eb0fdf311$export$be92b6f5f03c0fe9,_extends$1({asChild:!0},be,{orientation:ve.orientation,dir:ve.dir,loop:ae}),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({role:"tablist","aria-orientation":ve.orientation},ye,{ref:Z})))}),$69cb30bb0017df05$var$TRIGGER_NAME="TabsTrigger",$69cb30bb0017df05$export$8114b9fdfdf9f3ba=reactExports.forwardRef((ie,Z)=>{const{__scopeTabs:ee,value:ae,disabled:ye=!1,...ve}=ie,be=$69cb30bb0017df05$var$useTabsContext($69cb30bb0017df05$var$TRIGGER_NAME,ee),Ye=$69cb30bb0017df05$var$useRovingFocusGroupScope(ee),Ke=$69cb30bb0017df05$var$makeTriggerId(be.baseId,ae),Xe=$69cb30bb0017df05$var$makeContentId(be.baseId,ae),Je=ae===be.value;return reactExports.createElement($d7bdfb9eb0fdf311$export$6d08773d2e66f8f2,_extends$1({asChild:!0},Ye,{focusable:!ye,active:Je}),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button",role:"tab","aria-selected":Je,"aria-controls":Xe,"data-state":Je?"active":"inactive","data-disabled":ye?"":void 0,disabled:ye,id:Ke},ve,{ref:Z,onMouseDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onMouseDown,rt=>{!ye&&rt.button===0&&rt.ctrlKey===!1?be.onValueChange(ae):rt.preventDefault()}),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onKeyDown,rt=>{[" ","Enter"].includes(rt.key)&&be.onValueChange(ae)}),onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onFocus,()=>{const rt=be.activationMode!=="manual";!Je&&!ye&&rt&&be.onValueChange(ae)})})))}),$69cb30bb0017df05$var$CONTENT_NAME="TabsContent",$69cb30bb0017df05$export$bd905d70e8fd2ebb=reactExports.forwardRef((ie,Z)=>{const{__scopeTabs:ee,value:ae,forceMount:ye,children:ve,...be}=ie,Ye=$69cb30bb0017df05$var$useTabsContext($69cb30bb0017df05$var$CONTENT_NAME,ee),Ke=$69cb30bb0017df05$var$makeTriggerId(Ye.baseId,ae),Xe=$69cb30bb0017df05$var$makeContentId(Ye.baseId,ae),Je=ae===Ye.value,rt=reactExports.useRef(Je);return reactExports.useEffect(()=>{const nt=requestAnimationFrame(()=>rt.current=!1);return()=>cancelAnimationFrame(nt)},[]),reactExports.createElement($921a889cee6df7e8$export$99c2b779aa4e8b8b,{present:ye||Je},({present:nt})=>reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"data-state":Je?"active":"inactive","data-orientation":Ye.orientation,role:"tabpanel","aria-labelledby":Ke,hidden:!nt,id:Xe,tabIndex:0},be,{ref:Z,style:{...ie.style,animationDuration:rt.current?"0s":void 0}}),nt&&ve))});function $69cb30bb0017df05$var$makeTriggerId(ie,Z){return`${ie}-trigger-${Z}`}function $69cb30bb0017df05$var$makeContentId(ie,Z){return`${ie}-content-${Z}`}const $69cb30bb0017df05$export$be92b6f5f03c0fe9=$69cb30bb0017df05$export$b2539bed5023c21c,$69cb30bb0017df05$export$54c2e3dc7acea9f5=$69cb30bb0017df05$export$9712d22edc0d78c1,$69cb30bb0017df05$export$41fb9f06171c75f4=$69cb30bb0017df05$export$8114b9fdfdf9f3ba,$69cb30bb0017df05$export$7c6e2c02157bb7d2=$69cb30bb0017df05$export$bd905d70e8fd2ebb;var lib$5={},Parser$3={},Tokenizer={},decode={},decodeDataHtml={};Object.defineProperty(decodeDataHtml,"__esModule",{value:!0});decodeDataHtml.default=new Uint16Array('ᵁ<Õıʊҝջאٵ۞ޢߖࠏ੊ઑඡ๭༉༦჊ረዡᐕᒝᓃᓟᔥ\0\0\0\0\0\0ᕫᛍᦍᰒᷝ὾⁠↰⊍⏀⏻⑂⠤⤒ⴈ⹈⿎〖㊺㘹㞬㣾㨨㩱㫠㬮ࠀEMabcfglmnoprstu\\bfms¦³¹ÈÏlig耻Æ䃆P耻&䀦cute耻Á䃁reve;䄂Āiyx}rc耻Â䃂;䐐r;쀀𝔄rave耻À䃀pha;䎑acr;䄀d;橓Āgp¡on;䄄f;쀀𝔸plyFunction;恡ing耻Å䃅Ācs¾Ãr;쀀𝒜ign;扔ilde耻Ã䃃ml耻Ä䃄ЀaceforsuåûþėĜĢħĪĀcrêòkslash;或Ŷöø;櫧ed;挆y;䐑ƀcrtąċĔause;戵noullis;愬a;䎒r;쀀𝔅pf;쀀𝔹eve;䋘còēmpeq;扎܀HOacdefhilorsuōőŖƀƞƢƵƷƺǜȕɳɸɾcy;䐧PY耻©䂩ƀcpyŝŢźute;䄆Ā;iŧŨ拒talDifferentialD;慅leys;愭ȀaeioƉƎƔƘron;䄌dil耻Ç䃇rc;䄈nint;戰ot;䄊ĀdnƧƭilla;䂸terDot;䂷òſi;䎧rcleȀDMPTǇǋǑǖot;抙inus;抖lus;投imes;抗oĀcsǢǸkwiseContourIntegral;戲eCurlyĀDQȃȏoubleQuote;思uote;怙ȀlnpuȞȨɇɕonĀ;eȥȦ户;橴ƀgitȯȶȺruent;扡nt;戯ourIntegral;戮ĀfrɌɎ;愂oduct;成nterClockwiseContourIntegral;戳oss;樯cr;쀀𝒞pĀ;Cʄʅ拓ap;才րDJSZacefiosʠʬʰʴʸˋ˗ˡ˦̳ҍĀ;oŹʥtrahd;椑cy;䐂cy;䐅cy;䐏ƀgrsʿ˄ˇger;怡r;憡hv;櫤Āayː˕ron;䄎;䐔lĀ;t˝˞戇a;䎔r;쀀𝔇Āaf˫̧Ācm˰̢riticalȀADGT̖̜̀̆cute;䂴oŴ̋̍;䋙bleAcute;䋝rave;䁠ilde;䋜ond;拄ferentialD;慆Ѱ̽\0\0\0͔͂\0Ѕf;쀀𝔻ƀ;DE͈͉͍䂨ot;惜qual;扐blèCDLRUVͣͲ΂ϏϢϸontourIntegraìȹoɴ͹\0\0ͻ»͉nArrow;懓Āeo·ΤftƀARTΐΖΡrrow;懐ightArrow;懔eåˊngĀLRΫτeftĀARγιrrow;柸ightArrow;柺ightArrow;柹ightĀATϘϞrrow;懒ee;抨pɁϩ\0\0ϯrrow;懑ownArrow;懕erticalBar;戥ǹABLRTaВЪаўѿͼrrowƀ;BUНОТ憓ar;椓pArrow;懵reve;䌑eft˒к\0ц\0ѐightVector;楐eeVector;楞ectorĀ;Bљњ憽ar;楖ightǔѧ\0ѱeeVector;楟ectorĀ;BѺѻ懁ar;楗eeĀ;A҆҇护rrow;憧ĀctҒҗr;쀀𝒟rok;䄐ࠀNTacdfglmopqstuxҽӀӄӋӞӢӧӮӵԡԯԶՒ՝ՠեG;䅊H耻Ð䃐cute耻É䃉ƀaiyӒӗӜron;䄚rc耻Ê䃊;䐭ot;䄖r;쀀𝔈rave耻È䃈ement;戈ĀapӺӾcr;䄒tyɓԆ\0\0ԒmallSquare;旻erySmallSquare;斫ĀgpԦԪon;䄘f;쀀𝔼silon;䎕uĀaiԼՉlĀ;TՂՃ橵ilde;扂librium;懌Āci՗՚r;愰m;橳a;䎗ml耻Ë䃋Āipժկsts;戃onentialE;慇ʀcfiosօֈ֍ֲ׌y;䐤r;쀀𝔉lledɓ֗\0\0֣mallSquare;旼erySmallSquare;斪Ͱֺ\0ֿ\0\0ׄf;쀀𝔽All;戀riertrf;愱cò׋؀JTabcdfgorstר׬ׯ׺؀ؒؖ؛؝أ٬ٲcy;䐃耻>䀾mmaĀ;d׷׸䎓;䏜reve;䄞ƀeiy؇،ؐdil;䄢rc;䄜;䐓ot;䄠r;쀀𝔊;拙pf;쀀𝔾eater̀EFGLSTصلَٖٛ٦qualĀ;Lؾؿ扥ess;招ullEqual;执reater;檢ess;扷lantEqual;橾ilde;扳cr;쀀𝒢;扫ЀAacfiosuڅڋږڛڞڪھۊRDcy;䐪Āctڐڔek;䋇;䁞irc;䄤r;愌lbertSpace;愋ǰگ\0ڲf;愍izontalLine;攀Āctۃۅòکrok;䄦mpńېۘownHumðįqual;扏܀EJOacdfgmnostuۺ۾܃܇܎ܚܞܡܨ݄ݸދޏޕcy;䐕lig;䄲cy;䐁cute耻Í䃍Āiyܓܘrc耻Î䃎;䐘ot;䄰r;愑rave耻Ì䃌ƀ;apܠܯܿĀcgܴܷr;䄪inaryI;慈lieóϝǴ݉\0ݢĀ;eݍݎ戬Āgrݓݘral;戫section;拂isibleĀCTݬݲomma;恣imes;恢ƀgptݿރވon;䄮f;쀀𝕀a;䎙cr;愐ilde;䄨ǫޚ\0ޞcy;䐆l耻Ï䃏ʀcfosuެ޷޼߂ߐĀiyޱ޵rc;䄴;䐙r;쀀𝔍pf;쀀𝕁ǣ߇\0ߌr;쀀𝒥rcy;䐈kcy;䐄΀HJacfosߤߨ߽߬߱ࠂࠈcy;䐥cy;䐌ppa;䎚Āey߶߻dil;䄶;䐚r;쀀𝔎pf;쀀𝕂cr;쀀𝒦րJTaceflmostࠥࠩࠬࡐࡣ঳সে্਷ੇcy;䐉耻<䀼ʀcmnpr࠷࠼ࡁࡄࡍute;䄹bda;䎛g;柪lacetrf;愒r;憞ƀaeyࡗ࡜ࡡron;䄽dil;䄻;䐛Āfsࡨ॰tԀACDFRTUVarࡾࢩࢱࣦ࣠ࣼयज़ΐ४Ānrࢃ࢏gleBracket;柨rowƀ;BR࢙࢚࢞憐ar;懤ightArrow;懆eiling;挈oǵࢷ\0ࣃbleBracket;柦nǔࣈ\0࣒eeVector;楡ectorĀ;Bࣛࣜ懃ar;楙loor;挊ightĀAV࣯ࣵrrow;憔ector;楎Āerँगeƀ;AVउऊऐ抣rrow;憤ector;楚iangleƀ;BEतथऩ抲ar;槏qual;抴pƀDTVषूौownVector;楑eeVector;楠ectorĀ;Bॖॗ憿ar;楘ectorĀ;B॥०憼ar;楒ightáΜs̀EFGLSTॾঋকঝঢভqualGreater;拚ullEqual;扦reater;扶ess;檡lantEqual;橽ilde;扲r;쀀𝔏Ā;eঽা拘ftarrow;懚idot;䄿ƀnpw৔ਖਛgȀLRlr৞৷ਂਐeftĀAR০৬rrow;柵ightArrow;柷ightArrow;柶eftĀarγਊightáοightáϊf;쀀𝕃erĀLRਢਬeftArrow;憙ightArrow;憘ƀchtਾੀੂòࡌ;憰rok;䅁;扪Ѐacefiosuਗ਼੝੠੷੼અઋ઎p;椅y;䐜Ādl੥੯iumSpace;恟lintrf;愳r;쀀𝔐nusPlus;戓pf;쀀𝕄cò੶;䎜ҀJacefostuણધભીଔଙඑ඗ඞcy;䐊cute;䅃ƀaey઴હાron;䅇dil;䅅;䐝ƀgswે૰଎ativeƀMTV૓૟૨ediumSpace;怋hiĀcn૦૘ë૙eryThiî૙tedĀGL૸ଆreaterGreateòٳessLesóੈLine;䀊r;쀀𝔑ȀBnptଢନଷ଺reak;恠BreakingSpace;䂠f;愕ڀ;CDEGHLNPRSTV୕ୖ୪୼஡௫ఄ౞಄ದ೘ൡඅ櫬Āou୛୤ngruent;扢pCap;扭oubleVerticalBar;戦ƀlqxஃஊ஛ement;戉ualĀ;Tஒஓ扠ilde;쀀≂̸ists;戄reater΀;EFGLSTஶஷ஽௉௓௘௥扯qual;扱ullEqual;쀀≧̸reater;쀀≫̸ess;批lantEqual;쀀⩾̸ilde;扵umpń௲௽ownHump;쀀≎̸qual;쀀≏̸eĀfsఊధtTriangleƀ;BEచఛడ拪ar;쀀⧏̸qual;括s̀;EGLSTవశ఼ౄోౘ扮qual;扰reater;扸ess;쀀≪̸lantEqual;쀀⩽̸ilde;扴estedĀGL౨౹reaterGreater;쀀⪢̸essLess;쀀⪡̸recedesƀ;ESಒಓಛ技qual;쀀⪯̸lantEqual;拠ĀeiಫಹverseElement;戌ghtTriangleƀ;BEೋೌ೒拫ar;쀀⧐̸qual;拭ĀquೝഌuareSuĀbp೨೹setĀ;E೰ೳ쀀⊏̸qual;拢ersetĀ;Eഃആ쀀⊐̸qual;拣ƀbcpഓതൎsetĀ;Eഛഞ쀀⊂⃒qual;抈ceedsȀ;ESTലള഻െ抁qual;쀀⪰̸lantEqual;拡ilde;쀀≿̸ersetĀ;E൘൛쀀⊃⃒qual;抉ildeȀ;EFT൮൯൵ൿ扁qual;扄ullEqual;扇ilde;扉erticalBar;戤cr;쀀𝒩ilde耻Ñ䃑;䎝܀Eacdfgmoprstuvලෂ෉෕ෛ෠෧෼ขภยา฿ไlig;䅒cute耻Ó䃓Āiy෎ීrc耻Ô䃔;䐞blac;䅐r;쀀𝔒rave耻Ò䃒ƀaei෮ෲ෶cr;䅌ga;䎩cron;䎟pf;쀀𝕆enCurlyĀDQฎบoubleQuote;怜uote;怘;橔Āclวฬr;쀀𝒪ash耻Ø䃘iŬื฼de耻Õ䃕es;樷ml耻Ö䃖erĀBP๋๠Āar๐๓r;怾acĀek๚๜;揞et;掴arenthesis;揜Ҁacfhilors๿ງຊຏຒດຝະ໼rtialD;戂y;䐟r;쀀𝔓i;䎦;䎠usMinus;䂱Āipຢອncareplanåڝf;愙Ȁ;eio຺ູ໠໤檻cedesȀ;EST່້໏໚扺qual;檯lantEqual;扼ilde;找me;怳Ādp໩໮uct;戏ortionĀ;aȥ໹l;戝Āci༁༆r;쀀𝒫;䎨ȀUfos༑༖༛༟OT耻"䀢r;쀀𝔔pf;愚cr;쀀𝒬؀BEacefhiorsu༾གྷཇའཱིྦྷྪྭ႖ႩႴႾarr;椐G耻®䂮ƀcnrཎནབute;䅔g;柫rĀ;tཛྷཝ憠l;椖ƀaeyཧཬཱron;䅘dil;䅖;䐠Ā;vླྀཹ愜erseĀEUྂྙĀlq྇ྎement;戋uilibrium;懋pEquilibrium;楯r»ཹo;䎡ghtЀACDFTUVa࿁࿫࿳ဢဨၛႇϘĀnr࿆࿒gleBracket;柩rowƀ;BL࿜࿝࿡憒ar;懥eftArrow;懄eiling;按oǵ࿹\0စbleBracket;柧nǔည\0နeeVector;楝ectorĀ;Bဝသ懂ar;楕loor;挋Āerိ၃eƀ;AVဵံြ抢rrow;憦ector;楛iangleƀ;BEၐၑၕ抳ar;槐qual;抵pƀDTVၣၮၸownVector;楏eeVector;楜ectorĀ;Bႂႃ憾ar;楔ectorĀ;B႑႒懀ar;楓Āpuႛ႞f;愝ndImplies;楰ightarrow;懛ĀchႹႼr;愛;憱leDelayed;槴ڀHOacfhimoqstuფჱჷჽᄙᄞᅑᅖᅡᅧᆵᆻᆿĀCcჩხHcy;䐩y;䐨FTcy;䐬cute;䅚ʀ;aeiyᄈᄉᄎᄓᄗ檼ron;䅠dil;䅞rc;䅜;䐡r;쀀𝔖ortȀDLRUᄪᄴᄾᅉownArrow»ОeftArrow»࢚ightArrow»࿝pArrow;憑gma;䎣allCircle;战pf;쀀𝕊ɲᅭ\0\0ᅰt;戚areȀ;ISUᅻᅼᆉᆯ斡ntersection;抓uĀbpᆏᆞsetĀ;Eᆗᆘ抏qual;抑ersetĀ;Eᆨᆩ抐qual;抒nion;抔cr;쀀𝒮ar;拆ȀbcmpᇈᇛሉላĀ;sᇍᇎ拐etĀ;Eᇍᇕqual;抆ĀchᇠህeedsȀ;ESTᇭᇮᇴᇿ扻qual;檰lantEqual;扽ilde;承Tháྌ;我ƀ;esሒሓሣ拑rsetĀ;Eሜም抃qual;抇et»ሓրHRSacfhiorsሾቄ቉ቕ቞ቱቶኟዂወዑORN耻Þ䃞ADE;愢ĀHc቎ቒcy;䐋y;䐦Ābuቚቜ;䀉;䎤ƀaeyብቪቯron;䅤dil;䅢;䐢r;쀀𝔗Āeiቻ኉ǲኀ\0ኇefore;戴a;䎘Ācn኎ኘkSpace;쀀  Space;怉ldeȀ;EFTካኬኲኼ戼qual;扃ullEqual;扅ilde;扈pf;쀀𝕋ipleDot;惛Āctዖዛr;쀀𝒯rok;䅦ૡዷጎጚጦ\0ጬጱ\0\0\0\0\0ጸጽ፷ᎅ\0᏿ᐄᐊᐐĀcrዻጁute耻Ú䃚rĀ;oጇገ憟cir;楉rǣጓ\0጖y;䐎ve;䅬Āiyጞጣrc耻Û䃛;䐣blac;䅰r;쀀𝔘rave耻Ù䃙acr;䅪Ādiፁ፩erĀBPፈ፝Āarፍፐr;䁟acĀekፗፙ;揟et;掵arenthesis;揝onĀ;P፰፱拃lus;抎Āgp፻፿on;䅲f;쀀𝕌ЀADETadps᎕ᎮᎸᏄϨᏒᏗᏳrrowƀ;BDᅐᎠᎤar;椒ownArrow;懅ownArrow;憕quilibrium;楮eeĀ;AᏋᏌ报rrow;憥ownáϳerĀLRᏞᏨeftArrow;憖ightArrow;憗iĀ;lᏹᏺ䏒on;䎥ing;䅮cr;쀀𝒰ilde;䅨ml耻Ü䃜ҀDbcdefosvᐧᐬᐰᐳᐾᒅᒊᒐᒖash;披ar;櫫y;䐒ashĀ;lᐻᐼ抩;櫦Āerᑃᑅ;拁ƀbtyᑌᑐᑺar;怖Ā;iᑏᑕcalȀBLSTᑡᑥᑪᑴar;戣ine;䁼eparator;杘ilde;所ThinSpace;怊r;쀀𝔙pf;쀀𝕍cr;쀀𝒱dash;抪ʀcefosᒧᒬᒱᒶᒼirc;䅴dge;拀r;쀀𝔚pf;쀀𝕎cr;쀀𝒲Ȁfiosᓋᓐᓒᓘr;쀀𝔛;䎞pf;쀀𝕏cr;쀀𝒳ҀAIUacfosuᓱᓵᓹᓽᔄᔏᔔᔚᔠcy;䐯cy;䐇cy;䐮cute耻Ý䃝Āiyᔉᔍrc;䅶;䐫r;쀀𝔜pf;쀀𝕐cr;쀀𝒴ml;䅸ЀHacdefosᔵᔹᔿᕋᕏᕝᕠᕤcy;䐖cute;䅹Āayᕄᕉron;䅽;䐗ot;䅻ǲᕔ\0ᕛoWidtè૙a;䎖r;愨pf;愤cr;쀀𝒵௡ᖃᖊᖐ\0ᖰᖶᖿ\0\0\0\0ᗆᗛᗫᙟ᙭\0ᚕ᚛ᚲᚹ\0ᚾcute耻á䃡reve;䄃̀;Ediuyᖜᖝᖡᖣᖨᖭ戾;쀀∾̳;房rc耻â䃢te肻´̆;䐰lig耻æ䃦Ā;r²ᖺ;쀀𝔞rave耻à䃠ĀepᗊᗖĀfpᗏᗔsym;愵èᗓha;䎱ĀapᗟcĀclᗤᗧr;䄁g;樿ɤᗰ\0\0ᘊʀ;adsvᗺᗻᗿᘁᘇ戧nd;橕;橜lope;橘;橚΀;elmrszᘘᘙᘛᘞᘿᙏᙙ戠;榤e»ᘙsdĀ;aᘥᘦ戡ѡᘰᘲᘴᘶᘸᘺᘼᘾ;榨;榩;榪;榫;榬;榭;榮;榯tĀ;vᙅᙆ戟bĀ;dᙌᙍ抾;榝Āptᙔᙗh;戢»¹arr;捼Āgpᙣᙧon;䄅f;쀀𝕒΀;Eaeiop዁ᙻᙽᚂᚄᚇᚊ;橰cir;橯;扊d;手s;䀧roxĀ;e዁ᚒñᚃing耻å䃥ƀctyᚡᚦᚨr;쀀𝒶;䀪mpĀ;e዁ᚯñʈilde耻ã䃣ml耻ä䃤Āciᛂᛈoninôɲnt;樑ࠀNabcdefiklnoprsu᛭ᛱᜰ᜼ᝃᝈ᝸᝽០៦ᠹᡐᜍ᤽᥈ᥰot;櫭Ācrᛶ᜞kȀcepsᜀᜅᜍᜓong;扌psilon;䏶rime;怵imĀ;e᜚᜛戽q;拍Ŷᜢᜦee;抽edĀ;gᜬᜭ挅e»ᜭrkĀ;t፜᜷brk;掶Āoyᜁᝁ;䐱quo;怞ʀcmprtᝓ᝛ᝡᝤᝨausĀ;eĊĉptyv;榰séᜌnoõēƀahwᝯ᝱ᝳ;䎲;愶een;扬r;쀀𝔟g΀costuvwឍឝឳេ៕៛៞ƀaiuបពរðݠrc;旯p»፱ƀdptឤឨឭot;樀lus;樁imes;樂ɱឹ\0\0ើcup;樆ar;昅riangleĀdu៍្own;施p;斳plus;樄eåᑄåᒭarow;植ƀako៭ᠦᠵĀcn៲ᠣkƀlst៺֫᠂ozenge;槫riangleȀ;dlr᠒᠓᠘᠝斴own;斾eft;旂ight;斸k;搣Ʊᠫ\0ᠳƲᠯ\0ᠱ;斒;斑4;斓ck;斈ĀeoᠾᡍĀ;qᡃᡆ쀀=⃥uiv;쀀≡⃥t;挐Ȁptwxᡙᡞᡧᡬf;쀀𝕓Ā;tᏋᡣom»Ꮜtie;拈؀DHUVbdhmptuvᢅᢖᢪᢻᣗᣛᣬ᣿ᤅᤊᤐᤡȀLRlrᢎᢐᢒᢔ;敗;敔;敖;敓ʀ;DUduᢡᢢᢤᢦᢨ敐;敦;敩;敤;敧ȀLRlrᢳᢵᢷᢹ;敝;敚;敜;教΀;HLRhlrᣊᣋᣍᣏᣑᣓᣕ救;敬;散;敠;敫;敢;敟ox;槉ȀLRlrᣤᣦᣨᣪ;敕;敒;攐;攌ʀ;DUduڽ᣷᣹᣻᣽;敥;敨;攬;攴inus;抟lus;択imes;抠ȀLRlrᤙᤛᤝ᤟;敛;敘;攘;攔΀;HLRhlrᤰᤱᤳᤵᤷ᤻᤹攂;敪;敡;敞;攼;攤;攜Āevģ᥂bar耻¦䂦Ȁceioᥑᥖᥚᥠr;쀀𝒷mi;恏mĀ;e᜚᜜lƀ;bhᥨᥩᥫ䁜;槅sub;柈Ŭᥴ᥾lĀ;e᥹᥺怢t»᥺pƀ;Eeįᦅᦇ;檮Ā;qۜۛೡᦧ\0᧨ᨑᨕᨲ\0ᨷᩐ\0\0᪴\0\0᫁\0\0ᬡᬮ᭍᭒\0᯽\0ᰌƀcpr᦭ᦲ᧝ute;䄇̀;abcdsᦿᧀᧄ᧊᧕᧙戩nd;橄rcup;橉Āau᧏᧒p;橋p;橇ot;橀;쀀∩︀Āeo᧢᧥t;恁îړȀaeiu᧰᧻ᨁᨅǰ᧵\0᧸s;橍on;䄍dil耻ç䃧rc;䄉psĀ;sᨌᨍ橌m;橐ot;䄋ƀdmnᨛᨠᨦil肻¸ƭptyv;榲t脀¢;eᨭᨮ䂢räƲr;쀀𝔠ƀceiᨽᩀᩍy;䑇ckĀ;mᩇᩈ朓ark»ᩈ;䏇r΀;Ecefms᩟᩠ᩢᩫ᪤᪪᪮旋;槃ƀ;elᩩᩪᩭ䋆q;扗eɡᩴ\0\0᪈rrowĀlr᩼᪁eft;憺ight;憻ʀRSacd᪒᪔᪖᪚᪟»ཇ;擈st;抛irc;抚ash;抝nint;樐id;櫯cir;槂ubsĀ;u᪻᪼晣it»᪼ˬ᫇᫔᫺\0ᬊonĀ;eᫍᫎ䀺Ā;qÇÆɭ᫙\0\0᫢aĀ;t᫞᫟䀬;䁀ƀ;fl᫨᫩᫫戁îᅠeĀmx᫱᫶ent»᫩eóɍǧ᫾\0ᬇĀ;dኻᬂot;橭nôɆƀfryᬐᬔᬗ;쀀𝕔oäɔ脀©;sŕᬝr;愗Āaoᬥᬩrr;憵ss;朗Ācuᬲᬷr;쀀𝒸Ābpᬼ᭄Ā;eᭁᭂ櫏;櫑Ā;eᭉᭊ櫐;櫒dot;拯΀delprvw᭠᭬᭷ᮂᮬᯔ᯹arrĀlr᭨᭪;椸;椵ɰ᭲\0\0᭵r;拞c;拟arrĀ;p᭿ᮀ憶;椽̀;bcdosᮏᮐᮖᮡᮥᮨ截rcap;橈Āauᮛᮞp;橆p;橊ot;抍r;橅;쀀∪︀Ȁalrv᮵ᮿᯞᯣrrĀ;mᮼᮽ憷;椼yƀevwᯇᯔᯘqɰᯎ\0\0ᯒreã᭳uã᭵ee;拎edge;拏en耻¤䂤earrowĀlrᯮ᯳eft»ᮀight»ᮽeäᯝĀciᰁᰇoninôǷnt;戱lcty;挭ঀAHabcdefhijlorstuwz᰸᰻᰿ᱝᱩᱵᲊᲞᲬᲷ᳻᳿ᴍᵻᶑᶫᶻ᷆᷍rò΁ar;楥Ȁglrs᱈ᱍ᱒᱔ger;怠eth;愸òᄳhĀ;vᱚᱛ怐»ऊūᱡᱧarow;椏aã̕Āayᱮᱳron;䄏;䐴ƀ;ao̲ᱼᲄĀgrʿᲁr;懊tseq;橷ƀglmᲑᲔᲘ耻°䂰ta;䎴ptyv;榱ĀirᲣᲨsht;楿;쀀𝔡arĀlrᲳᲵ»ࣜ»သʀaegsv᳂͸᳖᳜᳠mƀ;oș᳊᳔ndĀ;ș᳑uit;晦amma;䏝in;拲ƀ;io᳧᳨᳸䃷de脀÷;o᳧ᳰntimes;拇nø᳷cy;䑒cɯᴆ\0\0ᴊrn;挞op;挍ʀlptuwᴘᴝᴢᵉᵕlar;䀤f;쀀𝕕ʀ;emps̋ᴭᴷᴽᵂqĀ;d͒ᴳot;扑inus;戸lus;戔quare;抡blebarwedgåúnƀadhᄮᵝᵧownarrowóᲃarpoonĀlrᵲᵶefôᲴighôᲶŢᵿᶅkaro÷གɯᶊ\0\0ᶎrn;挟op;挌ƀcotᶘᶣᶦĀryᶝᶡ;쀀𝒹;䑕l;槶rok;䄑Ādrᶰᶴot;拱iĀ;fᶺ᠖斿Āah᷀᷃ròЩaòྦangle;榦Āci᷒ᷕy;䑟grarr;柿ऀDacdefglmnopqrstuxḁḉḙḸոḼṉṡṾấắẽỡἪἷὄ὎὚ĀDoḆᴴoôᲉĀcsḎḔute耻é䃩ter;橮ȀaioyḢḧḱḶron;䄛rĀ;cḭḮ扖耻ê䃪lon;払;䑍ot;䄗ĀDrṁṅot;扒;쀀𝔢ƀ;rsṐṑṗ檚ave耻è䃨Ā;dṜṝ檖ot;檘Ȁ;ilsṪṫṲṴ檙nters;揧;愓Ā;dṹṺ檕ot;檗ƀapsẅẉẗcr;䄓tyƀ;svẒẓẕ戅et»ẓpĀ1;ẝẤĳạả;怄;怅怃ĀgsẪẬ;䅋p;怂ĀgpẴẸon;䄙f;쀀𝕖ƀalsỄỎỒrĀ;sỊị拕l;槣us;橱iƀ;lvỚớở䎵on»ớ;䏵ȀcsuvỪỳἋἣĀioữḱrc»Ḯɩỹ\0\0ỻíՈantĀglἂἆtr»ṝess»Ṻƀaeiἒ἖Ἒls;䀽st;扟vĀ;DȵἠD;橸parsl;槥ĀDaἯἳot;打rr;楱ƀcdiἾὁỸr;愯oô͒ĀahὉὋ;䎷耻ð䃰Āmrὓὗl耻ë䃫o;悬ƀcipὡὤὧl;䀡sôծĀeoὬὴctatioîՙnentialåչৡᾒ\0ᾞ\0ᾡᾧ\0\0ῆῌ\0ΐ\0ῦῪ \0 ⁚llingdotseñṄy;䑄male;晀ƀilrᾭᾳ῁lig;耀ﬃɩᾹ\0\0᾽g;耀ﬀig;耀ﬄ;쀀𝔣lig;耀ﬁlig;쀀fjƀaltῙ῜ῡt;晭ig;耀ﬂns;斱of;䆒ǰ΅\0ῳf;쀀𝕗ĀakֿῷĀ;vῼ´拔;櫙artint;樍Āao‌⁕Ācs‑⁒α‚‰‸⁅⁈\0⁐β•‥‧‪‬\0‮耻½䂽;慓耻¼䂼;慕;慙;慛Ƴ‴\0‶;慔;慖ʴ‾⁁\0\0⁃耻¾䂾;慗;慜5;慘ƶ⁌\0⁎;慚;慝8;慞l;恄wn;挢cr;쀀𝒻ࢀEabcdefgijlnorstv₂₉₟₥₰₴⃰⃵⃺⃿℃ℒℸ̗ℾ⅒↞Ā;lٍ₇;檌ƀcmpₐₕ₝ute;䇵maĀ;dₜ᳚䎳;檆reve;䄟Āiy₪₮rc;䄝;䐳ot;䄡Ȁ;lqsؾق₽⃉ƀ;qsؾٌ⃄lanô٥Ȁ;cdl٥⃒⃥⃕c;檩otĀ;o⃜⃝檀Ā;l⃢⃣檂;檄Ā;e⃪⃭쀀⋛︀s;檔r;쀀𝔤Ā;gٳ؛mel;愷cy;䑓Ȁ;Eajٚℌℎℐ;檒;檥;檤ȀEaesℛℝ℩ℴ;扩pĀ;p℣ℤ檊rox»ℤĀ;q℮ℯ檈Ā;q℮ℛim;拧pf;쀀𝕘Āci⅃ⅆr;愊mƀ;el٫ⅎ⅐;檎;檐茀>;cdlqr׮ⅠⅪⅮⅳⅹĀciⅥⅧ;檧r;橺ot;拗Par;榕uest;橼ʀadelsↄⅪ←ٖ↛ǰ↉\0↎proø₞r;楸qĀlqؿ↖lesó₈ií٫Āen↣↭rtneqq;쀀≩︀Å↪ԀAabcefkosy⇄⇇⇱⇵⇺∘∝∯≨≽ròΠȀilmr⇐⇔⇗⇛rsðᒄf»․ilôکĀdr⇠⇤cy;䑊ƀ;cwࣴ⇫⇯ir;楈;憭ar;意irc;䄥ƀalr∁∎∓rtsĀ;u∉∊晥it»∊lip;怦con;抹r;쀀𝔥sĀew∣∩arow;椥arow;椦ʀamopr∺∾≃≞≣rr;懿tht;戻kĀlr≉≓eftarrow;憩ightarrow;憪f;쀀𝕙bar;怕ƀclt≯≴≸r;쀀𝒽asè⇴rok;䄧Ābp⊂⊇ull;恃hen»ᱛૡ⊣\0⊪\0⊸⋅⋎\0⋕⋳\0\0⋸⌢⍧⍢⍿\0⎆⎪⎴cute耻í䃭ƀ;iyݱ⊰⊵rc耻î䃮;䐸Ācx⊼⊿y;䐵cl耻¡䂡ĀfrΟ⋉;쀀𝔦rave耻ì䃬Ȁ;inoܾ⋝⋩⋮Āin⋢⋦nt;樌t;戭fin;槜ta;愩lig;䄳ƀaop⋾⌚⌝ƀcgt⌅⌈⌗r;䄫ƀelpܟ⌏⌓inåގarôܠh;䄱f;抷ed;䆵ʀ;cfotӴ⌬⌱⌽⍁are;愅inĀ;t⌸⌹戞ie;槝doô⌙ʀ;celpݗ⍌⍐⍛⍡al;抺Āgr⍕⍙eróᕣã⍍arhk;樗rod;樼Ȁcgpt⍯⍲⍶⍻y;䑑on;䄯f;쀀𝕚a;䎹uest耻¿䂿Āci⎊⎏r;쀀𝒾nʀ;EdsvӴ⎛⎝⎡ӳ;拹ot;拵Ā;v⎦⎧拴;拳Ā;iݷ⎮lde;䄩ǫ⎸\0⎼cy;䑖l耻ï䃯̀cfmosu⏌⏗⏜⏡⏧⏵Āiy⏑⏕rc;䄵;䐹r;쀀𝔧ath;䈷pf;쀀𝕛ǣ⏬\0⏱r;쀀𝒿rcy;䑘kcy;䑔Ѐacfghjos␋␖␢␧␭␱␵␻ppaĀ;v␓␔䎺;䏰Āey␛␠dil;䄷;䐺r;쀀𝔨reen;䄸cy;䑅cy;䑜pf;쀀𝕜cr;쀀𝓀஀ABEHabcdefghjlmnoprstuv⑰⒁⒆⒍⒑┎┽╚▀♎♞♥♹♽⚚⚲⛘❝❨➋⟀⠁⠒ƀart⑷⑺⑼rò৆òΕail;椛arr;椎Ā;gঔ⒋;檋ar;楢ॣ⒥\0⒪\0⒱\0\0\0\0\0⒵Ⓔ\0ⓆⓈⓍ\0⓹ute;䄺mptyv;榴raîࡌbda;䎻gƀ;dlࢎⓁⓃ;榑åࢎ;檅uo耻«䂫rЀ;bfhlpst࢙ⓞⓦⓩ⓫⓮⓱⓵Ā;f࢝ⓣs;椟s;椝ë≒p;憫l;椹im;楳l;憢ƀ;ae⓿─┄檫il;椙Ā;s┉┊檭;쀀⪭︀ƀabr┕┙┝rr;椌rk;杲Āak┢┬cĀek┨┪;䁻;䁛Āes┱┳;榋lĀdu┹┻;榏;榍Ȁaeuy╆╋╖╘ron;䄾Ādi═╔il;䄼ìࢰâ┩;䐻Ȁcqrs╣╦╭╽a;椶uoĀ;rนᝆĀdu╲╷har;楧shar;楋h;憲ʀ;fgqs▋▌উ◳◿扤tʀahlrt▘▤▷◂◨rrowĀ;t࢙□aé⓶arpoonĀdu▯▴own»њp»०eftarrows;懇ightƀahs◍◖◞rrowĀ;sࣴࢧarpoonó྘quigarro÷⇰hreetimes;拋ƀ;qs▋ও◺lanôবʀ;cdgsব☊☍☝☨c;檨otĀ;o☔☕橿Ā;r☚☛檁;檃Ā;e☢☥쀀⋚︀s;檓ʀadegs☳☹☽♉♋pproøⓆot;拖qĀgq♃♅ôউgtò⒌ôছiíলƀilr♕࣡♚sht;楼;쀀𝔩Ā;Eজ♣;檑š♩♶rĀdu▲♮Ā;l॥♳;楪lk;斄cy;䑙ʀ;achtੈ⚈⚋⚑⚖rò◁orneòᴈard;楫ri;旺Āio⚟⚤dot;䅀ustĀ;a⚬⚭掰che»⚭ȀEaes⚻⚽⛉⛔;扨pĀ;p⛃⛄檉rox»⛄Ā;q⛎⛏檇Ā;q⛎⚻im;拦Ѐabnoptwz⛩⛴⛷✚✯❁❇❐Ānr⛮⛱g;柬r;懽rëࣁgƀlmr⛿✍✔eftĀar০✇ightá৲apsto;柼ightá৽parrowĀlr✥✩efô⓭ight;憬ƀafl✶✹✽r;榅;쀀𝕝us;樭imes;樴š❋❏st;戗áፎƀ;ef❗❘᠀旊nge»❘arĀ;l❤❥䀨t;榓ʀachmt❳❶❼➅➇ròࢨorneòᶌarĀ;d྘➃;業;怎ri;抿̀achiqt➘➝ੀ➢➮➻quo;怹r;쀀𝓁mƀ;egল➪➬;檍;檏Ābu┪➳oĀ;rฟ➹;怚rok;䅂萀<;cdhilqrࠫ⟒☹⟜⟠⟥⟪⟰Āci⟗⟙;檦r;橹reå◲mes;拉arr;楶uest;橻ĀPi⟵⟹ar;榖ƀ;ef⠀भ᠛旃rĀdu⠇⠍shar;楊har;楦Āen⠗⠡rtneqq;쀀≨︀Å⠞܀Dacdefhilnopsu⡀⡅⢂⢎⢓⢠⢥⢨⣚⣢⣤ઃ⣳⤂Dot;戺Ȁclpr⡎⡒⡣⡽r耻¯䂯Āet⡗⡙;時Ā;e⡞⡟朠se»⡟Ā;sျ⡨toȀ;dluျ⡳⡷⡻owîҌefôएðᏑker;斮Āoy⢇⢌mma;権;䐼ash;怔asuredangle»ᘦr;쀀𝔪o;愧ƀcdn⢯⢴⣉ro耻µ䂵Ȁ;acdᑤ⢽⣀⣄sôᚧir;櫰ot肻·Ƶusƀ;bd⣒ᤃ⣓戒Ā;uᴼ⣘;横ţ⣞⣡p;櫛ò−ðઁĀdp⣩⣮els;抧f;쀀𝕞Āct⣸⣽r;쀀𝓂pos»ᖝƀ;lm⤉⤊⤍䎼timap;抸ఀGLRVabcdefghijlmoprstuvw⥂⥓⥾⦉⦘⧚⧩⨕⨚⩘⩝⪃⪕⪤⪨⬄⬇⭄⭿⮮ⰴⱧⱼ⳩Āgt⥇⥋;쀀⋙̸Ā;v⥐௏쀀≫⃒ƀelt⥚⥲⥶ftĀar⥡⥧rrow;懍ightarrow;懎;쀀⋘̸Ā;v⥻ే쀀≪⃒ightarrow;懏ĀDd⦎⦓ash;抯ash;抮ʀbcnpt⦣⦧⦬⦱⧌la»˞ute;䅄g;쀀∠⃒ʀ;Eiop඄⦼⧀⧅⧈;쀀⩰̸d;쀀≋̸s;䅉roø඄urĀ;a⧓⧔普lĀ;s⧓ସǳ⧟\0⧣p肻 ଷmpĀ;e௹ఀʀaeouy⧴⧾⨃⨐⨓ǰ⧹\0⧻;橃on;䅈dil;䅆ngĀ;dൾ⨊ot;쀀⩭̸p;橂;䐽ash;怓΀;Aadqsxஒ⨩⨭⨻⩁⩅⩐rr;懗rĀhr⨳⨶k;椤Ā;oᏲᏰot;쀀≐̸uiöୣĀei⩊⩎ar;椨í஘istĀ;s஠டr;쀀𝔫ȀEest௅⩦⩹⩼ƀ;qs஼⩭௡ƀ;qs஼௅⩴lanô௢ií௪Ā;rஶ⪁»ஷƀAap⪊⪍⪑rò⥱rr;憮ar;櫲ƀ;svྍ⪜ྌĀ;d⪡⪢拼;拺cy;䑚΀AEadest⪷⪺⪾⫂⫅⫶⫹rò⥦;쀀≦̸rr;憚r;急Ȁ;fqs఻⫎⫣⫯tĀar⫔⫙rro÷⫁ightarro÷⪐ƀ;qs఻⪺⫪lanôౕĀ;sౕ⫴»శiíౝĀ;rవ⫾iĀ;eచథiäඐĀpt⬌⬑f;쀀𝕟膀¬;in⬙⬚⬶䂬nȀ;Edvஉ⬤⬨⬮;쀀⋹̸ot;쀀⋵̸ǡஉ⬳⬵;拷;拶iĀ;vಸ⬼ǡಸ⭁⭃;拾;拽ƀaor⭋⭣⭩rȀ;ast୻⭕⭚⭟lleì୻l;쀀⫽⃥;쀀∂̸lint;樔ƀ;ceಒ⭰⭳uåಥĀ;cಘ⭸Ā;eಒ⭽ñಘȀAait⮈⮋⮝⮧rò⦈rrƀ;cw⮔⮕⮙憛;쀀⤳̸;쀀↝̸ghtarrow»⮕riĀ;eೋೖ΀chimpqu⮽⯍⯙⬄୸⯤⯯Ȁ;cerല⯆ഷ⯉uå൅;쀀𝓃ortɭ⬅\0\0⯖ará⭖mĀ;e൮⯟Ā;q൴൳suĀbp⯫⯭å೸åഋƀbcp⯶ⰑⰙȀ;Ees⯿ⰀഢⰄ抄;쀀⫅̸etĀ;eഛⰋqĀ;qണⰀcĀ;eലⰗñസȀ;EesⰢⰣൟⰧ抅;쀀⫆̸etĀ;e൘ⰮqĀ;qൠⰣȀgilrⰽⰿⱅⱇìௗlde耻ñ䃱çృiangleĀlrⱒⱜeftĀ;eచⱚñదightĀ;eೋⱥñ೗Ā;mⱬⱭ䎽ƀ;esⱴⱵⱹ䀣ro;愖p;怇ҀDHadgilrsⲏⲔⲙⲞⲣⲰⲶⳓⳣash;抭arr;椄p;쀀≍⃒ash;抬ĀetⲨⲬ;쀀≥⃒;쀀>⃒nfin;槞ƀAetⲽⳁⳅrr;椂;쀀≤⃒Ā;rⳊⳍ쀀<⃒ie;쀀⊴⃒ĀAtⳘⳜrr;椃rie;쀀⊵⃒im;쀀∼⃒ƀAan⳰⳴ⴂrr;懖rĀhr⳺⳽k;椣Ā;oᏧᏥear;椧ቓ᪕\0\0\0\0\0\0\0\0\0\0\0\0\0ⴭ\0ⴸⵈⵠⵥ⵲ⶄᬇ\0\0ⶍⶫ\0ⷈⷎ\0ⷜ⸙⸫⸾⹃Ācsⴱ᪗ute耻ó䃳ĀiyⴼⵅrĀ;c᪞ⵂ耻ô䃴;䐾ʀabios᪠ⵒⵗǈⵚlac;䅑v;樸old;榼lig;䅓Ācr⵩⵭ir;榿;쀀𝔬ͯ⵹\0\0⵼\0ⶂn;䋛ave耻ò䃲;槁Ābmⶈ෴ar;榵Ȁacitⶕ⶘ⶥⶨrò᪀Āir⶝ⶠr;榾oss;榻nå๒;槀ƀaeiⶱⶵⶹcr;䅍ga;䏉ƀcdnⷀⷅǍron;䎿;榶pf;쀀𝕠ƀaelⷔ⷗ǒr;榷rp;榹΀;adiosvⷪⷫⷮ⸈⸍⸐⸖戨rò᪆Ȁ;efmⷷⷸ⸂⸅橝rĀ;oⷾⷿ愴f»ⷿ耻ª䂪耻º䂺gof;抶r;橖lope;橗;橛ƀclo⸟⸡⸧ò⸁ash耻ø䃸l;折iŬⸯ⸴de耻õ䃵esĀ;aǛ⸺s;樶ml耻ö䃶bar;挽ૡ⹞\0⹽\0⺀⺝\0⺢⺹\0\0⻋ຜ\0⼓\0\0⼫⾼\0⿈rȀ;astЃ⹧⹲຅脀¶;l⹭⹮䂶leìЃɩ⹸\0\0⹻m;櫳;櫽y;䐿rʀcimpt⺋⺏⺓ᡥ⺗nt;䀥od;䀮il;怰enk;怱r;쀀𝔭ƀimo⺨⺰⺴Ā;v⺭⺮䏆;䏕maô੶ne;明ƀ;tv⺿⻀⻈䏀chfork»´;䏖Āau⻏⻟nĀck⻕⻝kĀ;h⇴⻛;愎ö⇴sҀ;abcdemst⻳⻴ᤈ⻹⻽⼄⼆⼊⼎䀫cir;樣ir;樢Āouᵀ⼂;樥;橲n肻±ຝim;樦wo;樧ƀipu⼙⼠⼥ntint;樕f;쀀𝕡nd耻£䂣Ԁ;Eaceinosu່⼿⽁⽄⽇⾁⾉⾒⽾⾶;檳p;檷uå໙Ā;c໎⽌̀;acens່⽙⽟⽦⽨⽾pproø⽃urlyeñ໙ñ໎ƀaes⽯⽶⽺pprox;檹qq;檵im;拨iíໟmeĀ;s⾈ຮ怲ƀEas⽸⾐⽺ð⽵ƀdfp໬⾙⾯ƀals⾠⾥⾪lar;挮ine;挒urf;挓Ā;t໻⾴ï໻rel;抰Āci⿀⿅r;쀀𝓅;䏈ncsp;怈̀fiopsu⿚⋢⿟⿥⿫⿱r;쀀𝔮pf;쀀𝕢rime;恗cr;쀀𝓆ƀaeo⿸〉〓tĀei⿾々rnionóڰnt;樖stĀ;e【】䀿ñἙô༔઀ABHabcdefhilmnoprstux぀けさすムㄎㄫㅇㅢㅲㆎ㈆㈕㈤㈩㉘㉮㉲㊐㊰㊷ƀartぇおがròႳòϝail;検aròᱥar;楤΀cdenqrtとふへみわゔヌĀeuねぱ;쀀∽̱te;䅕iãᅮmptyv;榳gȀ;del࿑らるろ;榒;榥å࿑uo耻»䂻rր;abcfhlpstw࿜ガクシスゼゾダッデナp;極Ā;f࿠ゴs;椠;椳s;椞ë≝ð✮l;楅im;楴l;憣;憝Āaiパフil;椚oĀ;nホボ戶aló༞ƀabrョリヮrò៥rk;杳ĀakンヽcĀekヹ・;䁽;䁝Āes㄂㄄;榌lĀduㄊㄌ;榎;榐Ȁaeuyㄗㄜㄧㄩron;䅙Ādiㄡㄥil;䅗ì࿲âヺ;䑀Ȁclqsㄴㄷㄽㅄa;椷dhar;楩uoĀ;rȎȍh;憳ƀacgㅎㅟངlȀ;ipsླྀㅘㅛႜnåႻarôྩt;断ƀilrㅩဣㅮsht;楽;쀀𝔯ĀaoㅷㆆrĀduㅽㅿ»ѻĀ;l႑ㆄ;楬Ā;vㆋㆌ䏁;䏱ƀgns㆕ㇹㇼht̀ahlrstㆤㆰ㇂㇘㇤㇮rrowĀ;t࿜ㆭaéトarpoonĀduㆻㆿowîㅾp»႒eftĀah㇊㇐rrowó࿪arpoonóՑightarrows;應quigarro÷ニhreetimes;拌g;䋚ingdotseñἲƀahm㈍㈐㈓rò࿪aòՑ;怏oustĀ;a㈞㈟掱che»㈟mid;櫮Ȁabpt㈲㈽㉀㉒Ānr㈷㈺g;柭r;懾rëဃƀafl㉇㉊㉎r;榆;쀀𝕣us;樮imes;樵Āap㉝㉧rĀ;g㉣㉤䀩t;榔olint;樒arò㇣Ȁachq㉻㊀Ⴜ㊅quo;怺r;쀀𝓇Ābu・㊊oĀ;rȔȓƀhir㊗㊛㊠reåㇸmes;拊iȀ;efl㊪ၙᠡ㊫方tri;槎luhar;楨;愞ൡ㋕㋛㋟㌬㌸㍱\0㍺㎤\0\0㏬㏰\0㐨㑈㑚㒭㒱㓊㓱\0㘖\0\0㘳cute;䅛quï➺Ԁ;Eaceinpsyᇭ㋳㋵㋿㌂㌋㌏㌟㌦㌩;檴ǰ㋺\0㋼;檸on;䅡uåᇾĀ;dᇳ㌇il;䅟rc;䅝ƀEas㌖㌘㌛;檶p;檺im;择olint;樓iíሄ;䑁otƀ;be㌴ᵇ㌵担;橦΀Aacmstx㍆㍊㍗㍛㍞㍣㍭rr;懘rĀhr㍐㍒ë∨Ā;oਸ਼਴t耻§䂧i;䀻war;椩mĀin㍩ðnuóñt;朶rĀ;o㍶⁕쀀𝔰Ȁacoy㎂㎆㎑㎠rp;景Āhy㎋㎏cy;䑉;䑈rtɭ㎙\0\0㎜iäᑤaraì⹯耻­䂭Āgm㎨㎴maƀ;fv㎱㎲㎲䏃;䏂Ѐ;deglnprካ㏅㏉㏎㏖㏞㏡㏦ot;橪Ā;q኱ኰĀ;E㏓㏔檞;檠Ā;E㏛㏜檝;檟e;扆lus;樤arr;楲aròᄽȀaeit㏸㐈㐏㐗Āls㏽㐄lsetmé㍪hp;樳parsl;槤Ādlᑣ㐔e;挣Ā;e㐜㐝檪Ā;s㐢㐣檬;쀀⪬︀ƀflp㐮㐳㑂tcy;䑌Ā;b㐸㐹䀯Ā;a㐾㐿槄r;挿f;쀀𝕤aĀdr㑍ЂesĀ;u㑔㑕晠it»㑕ƀcsu㑠㑹㒟Āau㑥㑯pĀ;sᆈ㑫;쀀⊓︀pĀ;sᆴ㑵;쀀⊔︀uĀbp㑿㒏ƀ;esᆗᆜ㒆etĀ;eᆗ㒍ñᆝƀ;esᆨᆭ㒖etĀ;eᆨ㒝ñᆮƀ;afᅻ㒦ְrť㒫ֱ»ᅼaròᅈȀcemt㒹㒾㓂㓅r;쀀𝓈tmîñiì㐕aræᆾĀar㓎㓕rĀ;f㓔ឿ昆Āan㓚㓭ightĀep㓣㓪psiloîỠhé⺯s»⡒ʀbcmnp㓻㕞ሉ㖋㖎Ҁ;Edemnprs㔎㔏㔑㔕㔞㔣㔬㔱㔶抂;櫅ot;檽Ā;dᇚ㔚ot;櫃ult;櫁ĀEe㔨㔪;櫋;把lus;檿arr;楹ƀeiu㔽㕒㕕tƀ;en㔎㕅㕋qĀ;qᇚ㔏eqĀ;q㔫㔨m;櫇Ābp㕚㕜;櫕;櫓c̀;acensᇭ㕬㕲㕹㕻㌦pproø㋺urlyeñᇾñᇳƀaes㖂㖈㌛pproø㌚qñ㌗g;晪ڀ123;Edehlmnps㖩㖬㖯ሜ㖲㖴㗀㗉㗕㗚㗟㗨㗭耻¹䂹耻²䂲耻³䂳;櫆Āos㖹㖼t;檾ub;櫘Ā;dሢ㗅ot;櫄sĀou㗏㗒l;柉b;櫗arr;楻ult;櫂ĀEe㗤㗦;櫌;抋lus;櫀ƀeiu㗴㘉㘌tƀ;enሜ㗼㘂qĀ;qሢ㖲eqĀ;q㗧㗤m;櫈Ābp㘑㘓;櫔;櫖ƀAan㘜㘠㘭rr;懙rĀhr㘦㘨ë∮Ā;oਫ਩war;椪lig耻ß䃟௡㙑㙝㙠ዎ㙳㙹\0㙾㛂\0\0\0\0\0㛛㜃\0㜉㝬\0\0\0㞇ɲ㙖\0\0㙛get;挖;䏄rë๟ƀaey㙦㙫㙰ron;䅥dil;䅣;䑂lrec;挕r;쀀𝔱Ȁeiko㚆㚝㚵㚼ǲ㚋\0㚑eĀ4fኄኁaƀ;sv㚘㚙㚛䎸ym;䏑Ācn㚢㚲kĀas㚨㚮pproø዁im»ኬsðኞĀas㚺㚮ð዁rn耻þ䃾Ǭ̟㛆⋧es膀×;bd㛏㛐㛘䃗Ā;aᤏ㛕r;樱;樰ƀeps㛡㛣㜀á⩍Ȁ;bcf҆㛬㛰㛴ot;挶ir;櫱Ā;o㛹㛼쀀𝕥rk;櫚á㍢rime;怴ƀaip㜏㜒㝤dåቈ΀adempst㜡㝍㝀㝑㝗㝜㝟ngleʀ;dlqr㜰㜱㜶㝀㝂斵own»ᶻeftĀ;e⠀㜾ñम;扜ightĀ;e㊪㝋ñၚot;旬inus;樺lus;樹b;槍ime;樻ezium;揢ƀcht㝲㝽㞁Āry㝷㝻;쀀𝓉;䑆cy;䑛rok;䅧Āio㞋㞎xô᝷headĀlr㞗㞠eftarro÷ࡏightarrow»ཝऀAHabcdfghlmoprstuw㟐㟓㟗㟤㟰㟼㠎㠜㠣㠴㡑㡝㡫㢩㣌㣒㣪㣶ròϭar;楣Ācr㟜㟢ute耻ú䃺òᅐrǣ㟪\0㟭y;䑞ve;䅭Āiy㟵㟺rc耻û䃻;䑃ƀabh㠃㠆㠋ròᎭlac;䅱aòᏃĀir㠓㠘sht;楾;쀀𝔲rave耻ù䃹š㠧㠱rĀlr㠬㠮»ॗ»ႃlk;斀Āct㠹㡍ɯ㠿\0\0㡊rnĀ;e㡅㡆挜r»㡆op;挏ri;旸Āal㡖㡚cr;䅫肻¨͉Āgp㡢㡦on;䅳f;쀀𝕦̀adhlsuᅋ㡸㡽፲㢑㢠ownáᎳarpoonĀlr㢈㢌efô㠭ighô㠯iƀ;hl㢙㢚㢜䏅»ᏺon»㢚parrows;懈ƀcit㢰㣄㣈ɯ㢶\0\0㣁rnĀ;e㢼㢽挝r»㢽op;挎ng;䅯ri;旹cr;쀀𝓊ƀdir㣙㣝㣢ot;拰lde;䅩iĀ;f㜰㣨»᠓Āam㣯㣲rò㢨l耻ü䃼angle;榧ހABDacdeflnoprsz㤜㤟㤩㤭㦵㦸㦽㧟㧤㧨㧳㧹㧽㨁㨠ròϷarĀ;v㤦㤧櫨;櫩asèϡĀnr㤲㤷grt;榜΀eknprst㓣㥆㥋㥒㥝㥤㦖appá␕othinçẖƀhir㓫⻈㥙opô⾵Ā;hᎷ㥢ïㆍĀiu㥩㥭gmá㎳Ābp㥲㦄setneqĀ;q㥽㦀쀀⊊︀;쀀⫋︀setneqĀ;q㦏㦒쀀⊋︀;쀀⫌︀Āhr㦛㦟etá㚜iangleĀlr㦪㦯eft»थight»ၑy;䐲ash»ံƀelr㧄㧒㧗ƀ;beⷪ㧋㧏ar;抻q;扚lip;拮Ābt㧜ᑨaòᑩr;쀀𝔳tré㦮suĀbp㧯㧱»ജ»൙pf;쀀𝕧roð໻tré㦴Ācu㨆㨋r;쀀𝓋Ābp㨐㨘nĀEe㦀㨖»㥾nĀEe㦒㨞»㦐igzag;榚΀cefoprs㨶㨻㩖㩛㩔㩡㩪irc;䅵Ādi㩀㩑Ābg㩅㩉ar;機eĀ;qᗺ㩏;扙erp;愘r;쀀𝔴pf;쀀𝕨Ā;eᑹ㩦atèᑹcr;쀀𝓌ૣណ㪇\0㪋\0㪐㪛\0\0㪝㪨㪫㪯\0\0㫃㫎\0㫘ៜ៟tré៑r;쀀𝔵ĀAa㪔㪗ròσrò৶;䎾ĀAa㪡㪤ròθrò৫að✓is;拻ƀdptឤ㪵㪾Āfl㪺ឩ;쀀𝕩imåឲĀAa㫇㫊ròώròਁĀcq㫒ីr;쀀𝓍Āpt៖㫜ré។Ѐacefiosu㫰㫽㬈㬌㬑㬕㬛㬡cĀuy㫶㫻te耻ý䃽;䑏Āiy㬂㬆rc;䅷;䑋n耻¥䂥r;쀀𝔶cy;䑗pf;쀀𝕪cr;쀀𝓎Ācm㬦㬩y;䑎l耻ÿ䃿Ԁacdefhiosw㭂㭈㭔㭘㭤㭩㭭㭴㭺㮀cute;䅺Āay㭍㭒ron;䅾;䐷ot;䅼Āet㭝㭡træᕟa;䎶r;쀀𝔷cy;䐶grarr;懝pf;쀀𝕫cr;쀀𝓏Ājn㮅㮇;怍j;怌'.split("").map(function(ie){return ie.charCodeAt(0)}));var decodeDataXml={};Object.defineProperty(decodeDataXml,"__esModule",{value:!0});decodeDataXml.default=new Uint16Array("Ȁaglq	\x1Bɭ\0\0p;䀦os;䀧t;䀾t;䀼uot;䀢".split("").map(function(ie){return ie.charCodeAt(0)}));var decode_codepoint={};(function(ie){var Z;Object.defineProperty(ie,"__esModule",{value:!0}),ie.replaceCodePoint=ie.fromCodePoint=void 0;var ee=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]);ie.fromCodePoint=(Z=String.fromCodePoint)!==null&&Z!==void 0?Z:function(ve){var be="";return ve>65535&&(ve-=65536,be+=String.fromCharCode(ve>>>10&1023|55296),ve=56320|ve&1023),be+=String.fromCharCode(ve),be};function ae(ve){var be;return ve>=55296&&ve<=57343||ve>1114111?65533:(be=ee.get(ve))!==null&&be!==void 0?be:ve}ie.replaceCodePoint=ae;function ye(ve){return(0,ie.fromCodePoint)(ae(ve))}ie.default=ye})(decode_codepoint);(function(ie){var Z=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(ni,li,ui,mi){mi===void 0&&(mi=ui);var ii=Object.getOwnPropertyDescriptor(li,ui);(!ii||("get"in ii?!li.__esModule:ii.writable||ii.configurable))&&(ii={enumerable:!0,get:function(){return li[ui]}}),Object.defineProperty(ni,mi,ii)}:function(ni,li,ui,mi){mi===void 0&&(mi=ui),ni[mi]=li[ui]}),ee=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(ni,li){Object.defineProperty(ni,"default",{enumerable:!0,value:li})}:function(ni,li){ni.default=li}),ae=commonjsGlobal&&commonjsGlobal.__importStar||function(ni){if(ni&&ni.__esModule)return ni;var li={};if(ni!=null)for(var ui in ni)ui!=="default"&&Object.prototype.hasOwnProperty.call(ni,ui)&&Z(li,ni,ui);return ee(li,ni),li},ye=commonjsGlobal&&commonjsGlobal.__importDefault||function(ni){return ni&&ni.__esModule?ni:{default:ni}};Object.defineProperty(ie,"__esModule",{value:!0}),ie.decodeXML=ie.decodeHTMLStrict=ie.decodeHTMLAttribute=ie.decodeHTML=ie.determineBranch=ie.EntityDecoder=ie.DecodingMode=ie.BinTrieFlags=ie.fromCodePoint=ie.replaceCodePoint=ie.decodeCodePoint=ie.xmlDecodeTree=ie.htmlDecodeTree=void 0;var ve=ye(decodeDataHtml);ie.htmlDecodeTree=ve.default;var be=ye(decodeDataXml);ie.xmlDecodeTree=be.default;var Ye=ae(decode_codepoint);ie.decodeCodePoint=Ye.default;var Ke=decode_codepoint;Object.defineProperty(ie,"replaceCodePoint",{enumerable:!0,get:function(){return Ke.replaceCodePoint}}),Object.defineProperty(ie,"fromCodePoint",{enumerable:!0,get:function(){return Ke.fromCodePoint}});var Xe;(function(ni){ni[ni.NUM=35]="NUM",ni[ni.SEMI=59]="SEMI",ni[ni.EQUALS=61]="EQUALS",ni[ni.ZERO=48]="ZERO",ni[ni.NINE=57]="NINE",ni[ni.LOWER_A=97]="LOWER_A",ni[ni.LOWER_F=102]="LOWER_F",ni[ni.LOWER_X=120]="LOWER_X",ni[ni.LOWER_Z=122]="LOWER_Z",ni[ni.UPPER_A=65]="UPPER_A",ni[ni.UPPER_F=70]="UPPER_F",ni[ni.UPPER_Z=90]="UPPER_Z"})(Xe||(Xe={}));var Je=32,rt;(function(ni){ni[ni.VALUE_LENGTH=49152]="VALUE_LENGTH",ni[ni.BRANCH_LENGTH=16256]="BRANCH_LENGTH",ni[ni.JUMP_TABLE=127]="JUMP_TABLE"})(rt=ie.BinTrieFlags||(ie.BinTrieFlags={}));function nt(ni){return ni>=Xe.ZERO&&ni<=Xe.NINE}function it(ni){return ni>=Xe.UPPER_A&&ni<=Xe.UPPER_F||ni>=Xe.LOWER_A&&ni<=Xe.LOWER_F}function lt(ni){return ni>=Xe.UPPER_A&&ni<=Xe.UPPER_Z||ni>=Xe.LOWER_A&&ni<=Xe.LOWER_Z||nt(ni)}function ct(ni){return ni===Xe.EQUALS||lt(ni)}var ot;(function(ni){ni[ni.EntityStart=0]="EntityStart",ni[ni.NumericStart=1]="NumericStart",ni[ni.NumericDecimal=2]="NumericDecimal",ni[ni.NumericHex=3]="NumericHex",ni[ni.NamedEntity=4]="NamedEntity"})(ot||(ot={}));var dt;(function(ni){ni[ni.Legacy=0]="Legacy",ni[ni.Strict=1]="Strict",ni[ni.Attribute=2]="Attribute"})(dt=ie.DecodingMode||(ie.DecodingMode={}));var ft=function(){function ni(li,ui,mi){this.decodeTree=li,this.emitCodePoint=ui,this.errors=mi,this.state=ot.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=dt.Strict}return ni.prototype.startEntity=function(li){this.decodeMode=li,this.state=ot.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1},ni.prototype.write=function(li,ui){switch(this.state){case ot.EntityStart:return li.charCodeAt(ui)===Xe.NUM?(this.state=ot.NumericStart,this.consumed+=1,this.stateNumericStart(li,ui+1)):(this.state=ot.NamedEntity,this.stateNamedEntity(li,ui));case ot.NumericStart:return this.stateNumericStart(li,ui);case ot.NumericDecimal:return this.stateNumericDecimal(li,ui);case ot.NumericHex:return this.stateNumericHex(li,ui);case ot.NamedEntity:return this.stateNamedEntity(li,ui)}},ni.prototype.stateNumericStart=function(li,ui){return ui>=li.length?-1:(li.charCodeAt(ui)|Je)===Xe.LOWER_X?(this.state=ot.NumericHex,this.consumed+=1,this.stateNumericHex(li,ui+1)):(this.state=ot.NumericDecimal,this.stateNumericDecimal(li,ui))},ni.prototype.addToNumericResult=function(li,ui,mi,ii){if(ui!==mi){var hi=mi-ui;this.result=this.result*Math.pow(ii,hi)+parseInt(li.substr(ui,hi),ii),this.consumed+=hi}},ni.prototype.stateNumericHex=function(li,ui){for(var mi=ui;ui<li.length;){var ii=li.charCodeAt(ui);if(nt(ii)||it(ii))ui+=1;else return this.addToNumericResult(li,mi,ui,16),this.emitNumericEntity(ii,3)}return this.addToNumericResult(li,mi,ui,16),-1},ni.prototype.stateNumericDecimal=function(li,ui){for(var mi=ui;ui<li.length;){var ii=li.charCodeAt(ui);if(nt(ii))ui+=1;else return this.addToNumericResult(li,mi,ui,10),this.emitNumericEntity(ii,2)}return this.addToNumericResult(li,mi,ui,10),-1},ni.prototype.emitNumericEntity=function(li,ui){var mi;if(this.consumed<=ui)return(mi=this.errors)===null||mi===void 0||mi.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(li===Xe.SEMI)this.consumed+=1;else if(this.decodeMode===dt.Strict)return 0;return this.emitCodePoint((0,Ye.replaceCodePoint)(this.result),this.consumed),this.errors&&(li!==Xe.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed},ni.prototype.stateNamedEntity=function(li,ui){for(var mi=this.decodeTree,ii=mi[this.treeIndex],hi=(ii&rt.VALUE_LENGTH)>>14;ui<li.length;ui++,this.excess++){var ri=li.charCodeAt(ui);if(this.treeIndex=mt(mi,ii,this.treeIndex+Math.max(1,hi),ri),this.treeIndex<0)return this.result===0||this.decodeMode===dt.Attribute&&(hi===0||ct(ri))?0:this.emitNotTerminatedNamedEntity();if(ii=mi[this.treeIndex],hi=(ii&rt.VALUE_LENGTH)>>14,hi!==0){if(ri===Xe.SEMI)return this.emitNamedEntityData(this.treeIndex,hi,this.consumed+this.excess);this.decodeMode!==dt.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1},ni.prototype.emitNotTerminatedNamedEntity=function(){var li,ui=this,mi=ui.result,ii=ui.decodeTree,hi=(ii[mi]&rt.VALUE_LENGTH)>>14;return this.emitNamedEntityData(mi,hi,this.consumed),(li=this.errors)===null||li===void 0||li.missingSemicolonAfterCharacterReference(),this.consumed},ni.prototype.emitNamedEntityData=function(li,ui,mi){var ii=this.decodeTree;return this.emitCodePoint(ui===1?ii[li]&~rt.VALUE_LENGTH:ii[li+1],mi),ui===3&&this.emitCodePoint(ii[li+2],mi),mi},ni.prototype.end=function(){var li;switch(this.state){case ot.NamedEntity:return this.result!==0&&(this.decodeMode!==dt.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case ot.NumericDecimal:return this.emitNumericEntity(0,2);case ot.NumericHex:return this.emitNumericEntity(0,3);case ot.NumericStart:return(li=this.errors)===null||li===void 0||li.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case ot.EntityStart:return 0}},ni}();ie.EntityDecoder=ft;function gt(ni){var li="",ui=new ft(ni,function(mi){return li+=(0,Ye.fromCodePoint)(mi)});return function(mi,ii){for(var hi=0,ri=0;(ri=mi.indexOf("&",ri))>=0;){li+=mi.slice(hi,ri),ui.startEntity(ii);var ci=ui.write(mi,ri+1);if(ci<0){hi=ri+ui.end();break}hi=ri+ci,ri=ci===0?hi+1:hi}var Si=li+mi.slice(hi);return li="",Si}}function mt(ni,li,ui,mi){var ii=(li&rt.BRANCH_LENGTH)>>7,hi=li&rt.JUMP_TABLE;if(ii===0)return hi!==0&&mi===hi?ui:-1;if(hi){var ri=mi-hi;return ri<0||ri>=ii?-1:ni[ui+ri]-1}for(var ci=ui,Si=ci+ii-1;ci<=Si;){var si=ci+Si>>>1,Ei=ni[si];if(Ei<mi)ci=si+1;else if(Ei>mi)Si=si-1;else return ni[si+ii]}return-1}ie.determineBranch=mt;var Yr=gt(ve.default),Qr=gt(be.default);function Xr(ni,li){return li===void 0&&(li=dt.Legacy),Yr(ni,li)}ie.decodeHTML=Xr;function Jr(ni){return Yr(ni,dt.Attribute)}ie.decodeHTMLAttribute=Jr;function ai(ni){return Yr(ni,dt.Strict)}ie.decodeHTMLStrict=ai;function oi(ni){return Qr(ni,dt.Strict)}ie.decodeXML=oi})(decode);(function(ie){Object.defineProperty(ie,"__esModule",{value:!0}),ie.QuoteType=void 0;var Z=decode,ee;(function(nt){nt[nt.Tab=9]="Tab",nt[nt.NewLine=10]="NewLine",nt[nt.FormFeed=12]="FormFeed",nt[nt.CarriageReturn=13]="CarriageReturn",nt[nt.Space=32]="Space",nt[nt.ExclamationMark=33]="ExclamationMark",nt[nt.Number=35]="Number",nt[nt.Amp=38]="Amp",nt[nt.SingleQuote=39]="SingleQuote",nt[nt.DoubleQuote=34]="DoubleQuote",nt[nt.Dash=45]="Dash",nt[nt.Slash=47]="Slash",nt[nt.Zero=48]="Zero",nt[nt.Nine=57]="Nine",nt[nt.Semi=59]="Semi",nt[nt.Lt=60]="Lt",nt[nt.Eq=61]="Eq",nt[nt.Gt=62]="Gt",nt[nt.Questionmark=63]="Questionmark",nt[nt.UpperA=65]="UpperA",nt[nt.LowerA=97]="LowerA",nt[nt.UpperF=70]="UpperF",nt[nt.LowerF=102]="LowerF",nt[nt.UpperZ=90]="UpperZ",nt[nt.LowerZ=122]="LowerZ",nt[nt.LowerX=120]="LowerX",nt[nt.OpeningSquareBracket=91]="OpeningSquareBracket"})(ee||(ee={}));var ae;(function(nt){nt[nt.Text=1]="Text",nt[nt.BeforeTagName=2]="BeforeTagName",nt[nt.InTagName=3]="InTagName",nt[nt.InSelfClosingTag=4]="InSelfClosingTag",nt[nt.BeforeClosingTagName=5]="BeforeClosingTagName",nt[nt.InClosingTagName=6]="InClosingTagName",nt[nt.AfterClosingTagName=7]="AfterClosingTagName",nt[nt.BeforeAttributeName=8]="BeforeAttributeName",nt[nt.InAttributeName=9]="InAttributeName",nt[nt.AfterAttributeName=10]="AfterAttributeName",nt[nt.BeforeAttributeValue=11]="BeforeAttributeValue",nt[nt.InAttributeValueDq=12]="InAttributeValueDq",nt[nt.InAttributeValueSq=13]="InAttributeValueSq",nt[nt.InAttributeValueNq=14]="InAttributeValueNq",nt[nt.BeforeDeclaration=15]="BeforeDeclaration",nt[nt.InDeclaration=16]="InDeclaration",nt[nt.InProcessingInstruction=17]="InProcessingInstruction",nt[nt.BeforeComment=18]="BeforeComment",nt[nt.CDATASequence=19]="CDATASequence",nt[nt.InSpecialComment=20]="InSpecialComment",nt[nt.InCommentLike=21]="InCommentLike",nt[nt.BeforeSpecialS=22]="BeforeSpecialS",nt[nt.SpecialStartSequence=23]="SpecialStartSequence",nt[nt.InSpecialTag=24]="InSpecialTag",nt[nt.BeforeEntity=25]="BeforeEntity",nt[nt.BeforeNumericEntity=26]="BeforeNumericEntity",nt[nt.InNamedEntity=27]="InNamedEntity",nt[nt.InNumericEntity=28]="InNumericEntity",nt[nt.InHexEntity=29]="InHexEntity"})(ae||(ae={}));function ye(nt){return nt===ee.Space||nt===ee.NewLine||nt===ee.Tab||nt===ee.FormFeed||nt===ee.CarriageReturn}function ve(nt){return nt===ee.Slash||nt===ee.Gt||ye(nt)}function be(nt){return nt>=ee.Zero&&nt<=ee.Nine}function Ye(nt){return nt>=ee.LowerA&&nt<=ee.LowerZ||nt>=ee.UpperA&&nt<=ee.UpperZ}function Ke(nt){return nt>=ee.UpperA&&nt<=ee.UpperF||nt>=ee.LowerA&&nt<=ee.LowerF}var Xe;(function(nt){nt[nt.NoValue=0]="NoValue",nt[nt.Unquoted=1]="Unquoted",nt[nt.Single=2]="Single",nt[nt.Double=3]="Double"})(Xe=ie.QuoteType||(ie.QuoteType={}));var Je={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101])},rt=function(){function nt(it,lt){var ct=it.xmlMode,ot=ct===void 0?!1:ct,dt=it.decodeEntities,ft=dt===void 0?!0:dt;this.cbs=lt,this.state=ae.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=ae.Text,this.isSpecial=!1,this.running=!0,this.offset=0,this.currentSequence=void 0,this.sequenceIndex=0,this.trieIndex=0,this.trieCurrent=0,this.entityResult=0,this.entityExcess=0,this.xmlMode=ot,this.decodeEntities=ft,this.entityTrie=ot?Z.xmlDecodeTree:Z.htmlDecodeTree}return nt.prototype.reset=function(){this.state=ae.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=ae.Text,this.currentSequence=void 0,this.running=!0,this.offset=0},nt.prototype.write=function(it){this.offset+=this.buffer.length,this.buffer=it,this.parse()},nt.prototype.end=function(){this.running&&this.finish()},nt.prototype.pause=function(){this.running=!1},nt.prototype.resume=function(){this.running=!0,this.index<this.buffer.length+this.offset&&this.parse()},nt.prototype.getIndex=function(){return this.index},nt.prototype.getSectionStart=function(){return this.sectionStart},nt.prototype.stateText=function(it){it===ee.Lt||!this.decodeEntities&&this.fastForwardTo(ee.Lt)?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=ae.BeforeTagName,this.sectionStart=this.index):this.decodeEntities&&it===ee.Amp&&(this.state=ae.BeforeEntity)},nt.prototype.stateSpecialStartSequence=function(it){var lt=this.sequenceIndex===this.currentSequence.length,ct=lt?ve(it):(it|32)===this.currentSequence[this.sequenceIndex];if(!ct)this.isSpecial=!1;else if(!lt){this.sequenceIndex++;return}this.sequenceIndex=0,this.state=ae.InTagName,this.stateInTagName(it)},nt.prototype.stateInSpecialTag=function(it){if(this.sequenceIndex===this.currentSequence.length){if(it===ee.Gt||ye(it)){var lt=this.index-this.currentSequence.length;if(this.sectionStart<lt){var ct=this.index;this.index=lt,this.cbs.ontext(this.sectionStart,lt),this.index=ct}this.isSpecial=!1,this.sectionStart=lt+2,this.stateInClosingTagName(it);return}this.sequenceIndex=0}(it|32)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:this.sequenceIndex===0?this.currentSequence===Je.TitleEnd?this.decodeEntities&&it===ee.Amp&&(this.state=ae.BeforeEntity):this.fastForwardTo(ee.Lt)&&(this.sequenceIndex=1):this.sequenceIndex=+(it===ee.Lt)},nt.prototype.stateCDATASequence=function(it){it===Je.Cdata[this.sequenceIndex]?++this.sequenceIndex===Je.Cdata.length&&(this.state=ae.InCommentLike,this.currentSequence=Je.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=ae.InDeclaration,this.stateInDeclaration(it))},nt.prototype.fastForwardTo=function(it){for(;++this.index<this.buffer.length+this.offset;)if(this.buffer.charCodeAt(this.index-this.offset)===it)return!0;return this.index=this.buffer.length+this.offset-1,!1},nt.prototype.stateInCommentLike=function(it){it===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===Je.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index,2):this.cbs.oncomment(this.sectionStart,this.index,2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=ae.Text):this.sequenceIndex===0?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):it!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)},nt.prototype.isTagStartChar=function(it){return this.xmlMode?!ve(it):Ye(it)},nt.prototype.startSpecial=function(it,lt){this.isSpecial=!0,this.currentSequence=it,this.sequenceIndex=lt,this.state=ae.SpecialStartSequence},nt.prototype.stateBeforeTagName=function(it){if(it===ee.ExclamationMark)this.state=ae.BeforeDeclaration,this.sectionStart=this.index+1;else if(it===ee.Questionmark)this.state=ae.InProcessingInstruction,this.sectionStart=this.index+1;else if(this.isTagStartChar(it)){var lt=it|32;this.sectionStart=this.index,!this.xmlMode&&lt===Je.TitleEnd[2]?this.startSpecial(Je.TitleEnd,3):this.state=!this.xmlMode&&lt===Je.ScriptEnd[2]?ae.BeforeSpecialS:ae.InTagName}else it===ee.Slash?this.state=ae.BeforeClosingTagName:(this.state=ae.Text,this.stateText(it))},nt.prototype.stateInTagName=function(it){ve(it)&&(this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=ae.BeforeAttributeName,this.stateBeforeAttributeName(it))},nt.prototype.stateBeforeClosingTagName=function(it){ye(it)||(it===ee.Gt?this.state=ae.Text:(this.state=this.isTagStartChar(it)?ae.InClosingTagName:ae.InSpecialComment,this.sectionStart=this.index))},nt.prototype.stateInClosingTagName=function(it){(it===ee.Gt||ye(it))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=ae.AfterClosingTagName,this.stateAfterClosingTagName(it))},nt.prototype.stateAfterClosingTagName=function(it){(it===ee.Gt||this.fastForwardTo(ee.Gt))&&(this.state=ae.Text,this.baseState=ae.Text,this.sectionStart=this.index+1)},nt.prototype.stateBeforeAttributeName=function(it){it===ee.Gt?(this.cbs.onopentagend(this.index),this.isSpecial?(this.state=ae.InSpecialTag,this.sequenceIndex=0):this.state=ae.Text,this.baseState=this.state,this.sectionStart=this.index+1):it===ee.Slash?this.state=ae.InSelfClosingTag:ye(it)||(this.state=ae.InAttributeName,this.sectionStart=this.index)},nt.prototype.stateInSelfClosingTag=function(it){it===ee.Gt?(this.cbs.onselfclosingtag(this.index),this.state=ae.Text,this.baseState=ae.Text,this.sectionStart=this.index+1,this.isSpecial=!1):ye(it)||(this.state=ae.BeforeAttributeName,this.stateBeforeAttributeName(it))},nt.prototype.stateInAttributeName=function(it){(it===ee.Eq||ve(it))&&(this.cbs.onattribname(this.sectionStart,this.index),this.sectionStart=-1,this.state=ae.AfterAttributeName,this.stateAfterAttributeName(it))},nt.prototype.stateAfterAttributeName=function(it){it===ee.Eq?this.state=ae.BeforeAttributeValue:it===ee.Slash||it===ee.Gt?(this.cbs.onattribend(Xe.NoValue,this.index),this.state=ae.BeforeAttributeName,this.stateBeforeAttributeName(it)):ye(it)||(this.cbs.onattribend(Xe.NoValue,this.index),this.state=ae.InAttributeName,this.sectionStart=this.index)},nt.prototype.stateBeforeAttributeValue=function(it){it===ee.DoubleQuote?(this.state=ae.InAttributeValueDq,this.sectionStart=this.index+1):it===ee.SingleQuote?(this.state=ae.InAttributeValueSq,this.sectionStart=this.index+1):ye(it)||(this.sectionStart=this.index,this.state=ae.InAttributeValueNq,this.stateInAttributeValueNoQuotes(it))},nt.prototype.handleInAttributeValue=function(it,lt){it===lt||!this.decodeEntities&&this.fastForwardTo(lt)?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(lt===ee.DoubleQuote?Xe.Double:Xe.Single,this.index),this.state=ae.BeforeAttributeName):this.decodeEntities&&it===ee.Amp&&(this.baseState=this.state,this.state=ae.BeforeEntity)},nt.prototype.stateInAttributeValueDoubleQuotes=function(it){this.handleInAttributeValue(it,ee.DoubleQuote)},nt.prototype.stateInAttributeValueSingleQuotes=function(it){this.handleInAttributeValue(it,ee.SingleQuote)},nt.prototype.stateInAttributeValueNoQuotes=function(it){ye(it)||it===ee.Gt?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(Xe.Unquoted,this.index),this.state=ae.BeforeAttributeName,this.stateBeforeAttributeName(it)):this.decodeEntities&&it===ee.Amp&&(this.baseState=this.state,this.state=ae.BeforeEntity)},nt.prototype.stateBeforeDeclaration=function(it){it===ee.OpeningSquareBracket?(this.state=ae.CDATASequence,this.sequenceIndex=0):this.state=it===ee.Dash?ae.BeforeComment:ae.InDeclaration},nt.prototype.stateInDeclaration=function(it){(it===ee.Gt||this.fastForwardTo(ee.Gt))&&(this.cbs.ondeclaration(this.sectionStart,this.index),this.state=ae.Text,this.sectionStart=this.index+1)},nt.prototype.stateInProcessingInstruction=function(it){(it===ee.Gt||this.fastForwardTo(ee.Gt))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=ae.Text,this.sectionStart=this.index+1)},nt.prototype.stateBeforeComment=function(it){it===ee.Dash?(this.state=ae.InCommentLike,this.currentSequence=Je.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=ae.InDeclaration},nt.prototype.stateInSpecialComment=function(it){(it===ee.Gt||this.fastForwardTo(ee.Gt))&&(this.cbs.oncomment(this.sectionStart,this.index,0),this.state=ae.Text,this.sectionStart=this.index+1)},nt.prototype.stateBeforeSpecialS=function(it){var lt=it|32;lt===Je.ScriptEnd[3]?this.startSpecial(Je.ScriptEnd,4):lt===Je.StyleEnd[3]?this.startSpecial(Je.StyleEnd,4):(this.state=ae.InTagName,this.stateInTagName(it))},nt.prototype.stateBeforeEntity=function(it){this.entityExcess=1,this.entityResult=0,it===ee.Number?this.state=ae.BeforeNumericEntity:it===ee.Amp||(this.trieIndex=0,this.trieCurrent=this.entityTrie[0],this.state=ae.InNamedEntity,this.stateInNamedEntity(it))},nt.prototype.stateInNamedEntity=function(it){if(this.entityExcess+=1,this.trieIndex=(0,Z.determineBranch)(this.entityTrie,this.trieCurrent,this.trieIndex+1,it),this.trieIndex<0){this.emitNamedEntity(),this.index--;return}this.trieCurrent=this.entityTrie[this.trieIndex];var lt=this.trieCurrent&Z.BinTrieFlags.VALUE_LENGTH;if(lt){var ct=(lt>>14)-1;if(!this.allowLegacyEntity()&&it!==ee.Semi)this.trieIndex+=ct;else{var ot=this.index-this.entityExcess+1;ot>this.sectionStart&&this.emitPartial(this.sectionStart,ot),this.entityResult=this.trieIndex,this.trieIndex+=ct,this.entityExcess=0,this.sectionStart=this.index+1,ct===0&&this.emitNamedEntity()}}},nt.prototype.emitNamedEntity=function(){if(this.state=this.baseState,this.entityResult!==0){var it=(this.entityTrie[this.entityResult]&Z.BinTrieFlags.VALUE_LENGTH)>>14;switch(it){case 1:{this.emitCodePoint(this.entityTrie[this.entityResult]&~Z.BinTrieFlags.VALUE_LENGTH);break}case 2:{this.emitCodePoint(this.entityTrie[this.entityResult+1]);break}case 3:this.emitCodePoint(this.entityTrie[this.entityResult+1]),this.emitCodePoint(this.entityTrie[this.entityResult+2])}}},nt.prototype.stateBeforeNumericEntity=function(it){(it|32)===ee.LowerX?(this.entityExcess++,this.state=ae.InHexEntity):(this.state=ae.InNumericEntity,this.stateInNumericEntity(it))},nt.prototype.emitNumericEntity=function(it){var lt=this.index-this.entityExcess-1,ct=lt+2+ +(this.state===ae.InHexEntity);ct!==this.index&&(lt>this.sectionStart&&this.emitPartial(this.sectionStart,lt),this.sectionStart=this.index+Number(it),this.emitCodePoint((0,Z.replaceCodePoint)(this.entityResult))),this.state=this.baseState},nt.prototype.stateInNumericEntity=function(it){it===ee.Semi?this.emitNumericEntity(!0):be(it)?(this.entityResult=this.entityResult*10+(it-ee.Zero),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)},nt.prototype.stateInHexEntity=function(it){it===ee.Semi?this.emitNumericEntity(!0):be(it)?(this.entityResult=this.entityResult*16+(it-ee.Zero),this.entityExcess++):Ke(it)?(this.entityResult=this.entityResult*16+((it|32)-ee.LowerA+10),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)},nt.prototype.allowLegacyEntity=function(){return!this.xmlMode&&(this.baseState===ae.Text||this.baseState===ae.InSpecialTag)},nt.prototype.cleanup=function(){this.running&&this.sectionStart!==this.index&&(this.state===ae.Text||this.state===ae.InSpecialTag&&this.sequenceIndex===0?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):(this.state===ae.InAttributeValueDq||this.state===ae.InAttributeValueSq||this.state===ae.InAttributeValueNq)&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))},nt.prototype.shouldContinue=function(){return this.index<this.buffer.length+this.offset&&this.running},nt.prototype.parse=function(){for(;this.shouldContinue();){var it=this.buffer.charCodeAt(this.index-this.offset);switch(this.state){case ae.Text:{this.stateText(it);break}case ae.SpecialStartSequence:{this.stateSpecialStartSequence(it);break}case ae.InSpecialTag:{this.stateInSpecialTag(it);break}case ae.CDATASequence:{this.stateCDATASequence(it);break}case ae.InAttributeValueDq:{this.stateInAttributeValueDoubleQuotes(it);break}case ae.InAttributeName:{this.stateInAttributeName(it);break}case ae.InCommentLike:{this.stateInCommentLike(it);break}case ae.InSpecialComment:{this.stateInSpecialComment(it);break}case ae.BeforeAttributeName:{this.stateBeforeAttributeName(it);break}case ae.InTagName:{this.stateInTagName(it);break}case ae.InClosingTagName:{this.stateInClosingTagName(it);break}case ae.BeforeTagName:{this.stateBeforeTagName(it);break}case ae.AfterAttributeName:{this.stateAfterAttributeName(it);break}case ae.InAttributeValueSq:{this.stateInAttributeValueSingleQuotes(it);break}case ae.BeforeAttributeValue:{this.stateBeforeAttributeValue(it);break}case ae.BeforeClosingTagName:{this.stateBeforeClosingTagName(it);break}case ae.AfterClosingTagName:{this.stateAfterClosingTagName(it);break}case ae.BeforeSpecialS:{this.stateBeforeSpecialS(it);break}case ae.InAttributeValueNq:{this.stateInAttributeValueNoQuotes(it);break}case ae.InSelfClosingTag:{this.stateInSelfClosingTag(it);break}case ae.InDeclaration:{this.stateInDeclaration(it);break}case ae.BeforeDeclaration:{this.stateBeforeDeclaration(it);break}case ae.BeforeComment:{this.stateBeforeComment(it);break}case ae.InProcessingInstruction:{this.stateInProcessingInstruction(it);break}case ae.InNamedEntity:{this.stateInNamedEntity(it);break}case ae.BeforeEntity:{this.stateBeforeEntity(it);break}case ae.InHexEntity:{this.stateInHexEntity(it);break}case ae.InNumericEntity:{this.stateInNumericEntity(it);break}default:this.stateBeforeNumericEntity(it)}this.index++}this.cleanup()},nt.prototype.finish=function(){this.state===ae.InNamedEntity&&this.emitNamedEntity(),this.sectionStart<this.index&&this.handleTrailingData(),this.cbs.onend()},nt.prototype.handleTrailingData=function(){var it=this.buffer.length+this.offset;this.state===ae.InCommentLike?this.currentSequence===Je.CdataEnd?this.cbs.oncdata(this.sectionStart,it,0):this.cbs.oncomment(this.sectionStart,it,0):this.state===ae.InNumericEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===ae.InHexEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===ae.InTagName||this.state===ae.BeforeAttributeName||this.state===ae.BeforeAttributeValue||this.state===ae.AfterAttributeName||this.state===ae.InAttributeName||this.state===ae.InAttributeValueSq||this.state===ae.InAttributeValueDq||this.state===ae.InAttributeValueNq||this.state===ae.InClosingTagName||this.cbs.ontext(this.sectionStart,it)},nt.prototype.emitPartial=function(it,lt){this.baseState!==ae.Text&&this.baseState!==ae.InSpecialTag?this.cbs.onattribdata(it,lt):this.cbs.ontext(it,lt)},nt.prototype.emitCodePoint=function(it){this.baseState!==ae.Text&&this.baseState!==ae.InSpecialTag?this.cbs.onattribentity(it):this.cbs.ontextentity(it)},nt}();ie.default=rt})(Tokenizer);var __createBinding$1=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(ie,Z,ee,ae){ae===void 0&&(ae=ee);var ye=Object.getOwnPropertyDescriptor(Z,ee);(!ye||("get"in ye?!Z.__esModule:ye.writable||ye.configurable))&&(ye={enumerable:!0,get:function(){return Z[ee]}}),Object.defineProperty(ie,ae,ye)}:function(ie,Z,ee,ae){ae===void 0&&(ae=ee),ie[ae]=Z[ee]}),__setModuleDefault$1=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(ie,Z){Object.defineProperty(ie,"default",{enumerable:!0,value:Z})}:function(ie,Z){ie.default=Z}),__importStar$1=commonjsGlobal&&commonjsGlobal.__importStar||function(ie){if(ie&&ie.__esModule)return ie;var Z={};if(ie!=null)for(var ee in ie)ee!=="default"&&Object.prototype.hasOwnProperty.call(ie,ee)&&__createBinding$1(Z,ie,ee);return __setModuleDefault$1(Z,ie),Z};Object.defineProperty(Parser$3,"__esModule",{value:!0});Parser$3.Parser=void 0;var Tokenizer_js_1=__importStar$1(Tokenizer),decode_js_1=decode,formTags=new Set(["input","option","optgroup","select","button","datalist","textarea"]),pTag=new Set(["p"]),tableSectionTags=new Set(["thead","tbody"]),ddtTags=new Set(["dd","dt"]),rtpTags=new Set(["rt","rp"]),openImpliesClose=new Map([["tr",new Set(["tr","th","td"])],["th",new Set(["th"])],["td",new Set(["thead","th","td"])],["body",new Set(["head","link","script"])],["li",new Set(["li"])],["p",pTag],["h1",pTag],["h2",pTag],["h3",pTag],["h4",pTag],["h5",pTag],["h6",pTag],["select",formTags],["input",formTags],["output",formTags],["button",formTags],["datalist",formTags],["textarea",formTags],["option",new Set(["option"])],["optgroup",new Set(["optgroup","option"])],["dd",ddtTags],["dt",ddtTags],["address",pTag],["article",pTag],["aside",pTag],["blockquote",pTag],["details",pTag],["div",pTag],["dl",pTag],["fieldset",pTag],["figcaption",pTag],["figure",pTag],["footer",pTag],["form",pTag],["header",pTag],["hr",pTag],["main",pTag],["nav",pTag],["ol",pTag],["pre",pTag],["section",pTag],["table",pTag],["ul",pTag],["rt",rtpTags],["rp",rtpTags],["tbody",tableSectionTags],["tfoot",tableSectionTags]]),voidElements=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),foreignContextElements=new Set(["math","svg"]),htmlIntegrationElements=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignobject","desc","title"]),reNameEnd=/\s|\//,Parser$2=function(){function ie(Z,ee){ee===void 0&&(ee={});var ae,ye,ve,be,Ye;this.options=ee,this.startIndex=0,this.endIndex=0,this.openTagStart=0,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.foreignContext=[],this.buffers=[],this.bufferOffset=0,this.writeIndex=0,this.ended=!1,this.cbs=Z??{},this.lowerCaseTagNames=(ae=ee.lowerCaseTags)!==null&&ae!==void 0?ae:!ee.xmlMode,this.lowerCaseAttributeNames=(ye=ee.lowerCaseAttributeNames)!==null&&ye!==void 0?ye:!ee.xmlMode,this.tokenizer=new((ve=ee.Tokenizer)!==null&&ve!==void 0?ve:Tokenizer_js_1.default)(this.options,this),(Ye=(be=this.cbs).onparserinit)===null||Ye===void 0||Ye.call(be,this)}return ie.prototype.ontext=function(Z,ee){var ae,ye,ve=this.getSlice(Z,ee);this.endIndex=ee-1,(ye=(ae=this.cbs).ontext)===null||ye===void 0||ye.call(ae,ve),this.startIndex=ee},ie.prototype.ontextentity=function(Z){var ee,ae,ye=this.tokenizer.getSectionStart();this.endIndex=ye-1,(ae=(ee=this.cbs).ontext)===null||ae===void 0||ae.call(ee,(0,decode_js_1.fromCodePoint)(Z)),this.startIndex=ye},ie.prototype.isVoidElement=function(Z){return!this.options.xmlMode&&voidElements.has(Z)},ie.prototype.onopentagname=function(Z,ee){this.endIndex=ee;var ae=this.getSlice(Z,ee);this.lowerCaseTagNames&&(ae=ae.toLowerCase()),this.emitOpenTag(ae)},ie.prototype.emitOpenTag=function(Z){var ee,ae,ye,ve;this.openTagStart=this.startIndex,this.tagname=Z;var be=!this.options.xmlMode&&openImpliesClose.get(Z);if(be)for(;this.stack.length>0&&be.has(this.stack[this.stack.length-1]);){var Ye=this.stack.pop();(ae=(ee=this.cbs).onclosetag)===null||ae===void 0||ae.call(ee,Ye,!0)}this.isVoidElement(Z)||(this.stack.push(Z),foreignContextElements.has(Z)?this.foreignContext.push(!0):htmlIntegrationElements.has(Z)&&this.foreignContext.push(!1)),(ve=(ye=this.cbs).onopentagname)===null||ve===void 0||ve.call(ye,Z),this.cbs.onopentag&&(this.attribs={})},ie.prototype.endOpenTag=function(Z){var ee,ae;this.startIndex=this.openTagStart,this.attribs&&((ae=(ee=this.cbs).onopentag)===null||ae===void 0||ae.call(ee,this.tagname,this.attribs,Z),this.attribs=null),this.cbs.onclosetag&&this.isVoidElement(this.tagname)&&this.cbs.onclosetag(this.tagname,!0),this.tagname=""},ie.prototype.onopentagend=function(Z){this.endIndex=Z,this.endOpenTag(!1),this.startIndex=Z+1},ie.prototype.onclosetag=function(Z,ee){var ae,ye,ve,be,Ye,Ke;this.endIndex=ee;var Xe=this.getSlice(Z,ee);if(this.lowerCaseTagNames&&(Xe=Xe.toLowerCase()),(foreignContextElements.has(Xe)||htmlIntegrationElements.has(Xe))&&this.foreignContext.pop(),this.isVoidElement(Xe))!this.options.xmlMode&&Xe==="br"&&((ye=(ae=this.cbs).onopentagname)===null||ye===void 0||ye.call(ae,"br"),(be=(ve=this.cbs).onopentag)===null||be===void 0||be.call(ve,"br",{},!0),(Ke=(Ye=this.cbs).onclosetag)===null||Ke===void 0||Ke.call(Ye,"br",!1));else{var Je=this.stack.lastIndexOf(Xe);if(Je!==-1)if(this.cbs.onclosetag)for(var rt=this.stack.length-Je;rt--;)this.cbs.onclosetag(this.stack.pop(),rt!==0);else this.stack.length=Je;else!this.options.xmlMode&&Xe==="p"&&(this.emitOpenTag("p"),this.closeCurrentTag(!0))}this.startIndex=ee+1},ie.prototype.onselfclosingtag=function(Z){this.endIndex=Z,this.options.xmlMode||this.options.recognizeSelfClosing||this.foreignContext[this.foreignContext.length-1]?(this.closeCurrentTag(!1),this.startIndex=Z+1):this.onopentagend(Z)},ie.prototype.closeCurrentTag=function(Z){var ee,ae,ye=this.tagname;this.endOpenTag(Z),this.stack[this.stack.length-1]===ye&&((ae=(ee=this.cbs).onclosetag)===null||ae===void 0||ae.call(ee,ye,!Z),this.stack.pop())},ie.prototype.onattribname=function(Z,ee){this.startIndex=Z;var ae=this.getSlice(Z,ee);this.attribname=this.lowerCaseAttributeNames?ae.toLowerCase():ae},ie.prototype.onattribdata=function(Z,ee){this.attribvalue+=this.getSlice(Z,ee)},ie.prototype.onattribentity=function(Z){this.attribvalue+=(0,decode_js_1.fromCodePoint)(Z)},ie.prototype.onattribend=function(Z,ee){var ae,ye;this.endIndex=ee,(ye=(ae=this.cbs).onattribute)===null||ye===void 0||ye.call(ae,this.attribname,this.attribvalue,Z===Tokenizer_js_1.QuoteType.Double?'"':Z===Tokenizer_js_1.QuoteType.Single?"'":Z===Tokenizer_js_1.QuoteType.NoValue?void 0:null),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribvalue=""},ie.prototype.getInstructionName=function(Z){var ee=Z.search(reNameEnd),ae=ee<0?Z:Z.substr(0,ee);return this.lowerCaseTagNames&&(ae=ae.toLowerCase()),ae},ie.prototype.ondeclaration=function(Z,ee){this.endIndex=ee;var ae=this.getSlice(Z,ee);if(this.cbs.onprocessinginstruction){var ye=this.getInstructionName(ae);this.cbs.onprocessinginstruction("!".concat(ye),"!".concat(ae))}this.startIndex=ee+1},ie.prototype.onprocessinginstruction=function(Z,ee){this.endIndex=ee;var ae=this.getSlice(Z,ee);if(this.cbs.onprocessinginstruction){var ye=this.getInstructionName(ae);this.cbs.onprocessinginstruction("?".concat(ye),"?".concat(ae))}this.startIndex=ee+1},ie.prototype.oncomment=function(Z,ee,ae){var ye,ve,be,Ye;this.endIndex=ee,(ve=(ye=this.cbs).oncomment)===null||ve===void 0||ve.call(ye,this.getSlice(Z,ee-ae)),(Ye=(be=this.cbs).oncommentend)===null||Ye===void 0||Ye.call(be),this.startIndex=ee+1},ie.prototype.oncdata=function(Z,ee,ae){var ye,ve,be,Ye,Ke,Xe,Je,rt,nt,it;this.endIndex=ee;var lt=this.getSlice(Z,ee-ae);this.options.xmlMode||this.options.recognizeCDATA?((ve=(ye=this.cbs).oncdatastart)===null||ve===void 0||ve.call(ye),(Ye=(be=this.cbs).ontext)===null||Ye===void 0||Ye.call(be,lt),(Xe=(Ke=this.cbs).oncdataend)===null||Xe===void 0||Xe.call(Ke)):((rt=(Je=this.cbs).oncomment)===null||rt===void 0||rt.call(Je,"[CDATA[".concat(lt,"]]")),(it=(nt=this.cbs).oncommentend)===null||it===void 0||it.call(nt)),this.startIndex=ee+1},ie.prototype.onend=function(){var Z,ee;if(this.cbs.onclosetag){this.endIndex=this.startIndex;for(var ae=this.stack.length;ae>0;this.cbs.onclosetag(this.stack[--ae],!0));}(ee=(Z=this.cbs).onend)===null||ee===void 0||ee.call(Z)},ie.prototype.reset=function(){var Z,ee,ae,ye;(ee=(Z=this.cbs).onreset)===null||ee===void 0||ee.call(Z),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack.length=0,this.startIndex=0,this.endIndex=0,(ye=(ae=this.cbs).onparserinit)===null||ye===void 0||ye.call(ae,this),this.buffers.length=0,this.bufferOffset=0,this.writeIndex=0,this.ended=!1},ie.prototype.parseComplete=function(Z){this.reset(),this.end(Z)},ie.prototype.getSlice=function(Z,ee){for(;Z-this.bufferOffset>=this.buffers[0].length;)this.shiftBuffer();for(var ae=this.buffers[0].slice(Z-this.bufferOffset,ee-this.bufferOffset);ee-this.bufferOffset>this.buffers[0].length;)this.shiftBuffer(),ae+=this.buffers[0].slice(0,ee-this.bufferOffset);return ae},ie.prototype.shiftBuffer=function(){this.bufferOffset+=this.buffers[0].length,this.writeIndex--,this.buffers.shift()},ie.prototype.write=function(Z){var ee,ae;if(this.ended){(ae=(ee=this.cbs).onerror)===null||ae===void 0||ae.call(ee,new Error(".write() after done!"));return}this.buffers.push(Z),this.tokenizer.running&&(this.tokenizer.write(Z),this.writeIndex++)},ie.prototype.end=function(Z){var ee,ae;if(this.ended){(ae=(ee=this.cbs).onerror)===null||ae===void 0||ae.call(ee,new Error(".end() after done!"));return}Z&&this.write(Z),this.ended=!0,this.tokenizer.end()},ie.prototype.pause=function(){this.tokenizer.pause()},ie.prototype.resume=function(){for(this.tokenizer.resume();this.tokenizer.running&&this.writeIndex<this.buffers.length;)this.tokenizer.write(this.buffers[this.writeIndex++]);this.ended&&this.tokenizer.end()},ie.prototype.parseChunk=function(Z){this.write(Z)},ie.prototype.done=function(Z){this.end(Z)},ie}();Parser$3.Parser=Parser$2;var lib$4={},lib$3={};(function(ie){Object.defineProperty(ie,"__esModule",{value:!0}),ie.Doctype=ie.CDATA=ie.Tag=ie.Style=ie.Script=ie.Comment=ie.Directive=ie.Text=ie.Root=ie.isTag=ie.ElementType=void 0;var Z;(function(ae){ae.Root="root",ae.Text="text",ae.Directive="directive",ae.Comment="comment",ae.Script="script",ae.Style="style",ae.Tag="tag",ae.CDATA="cdata",ae.Doctype="doctype"})(Z=ie.ElementType||(ie.ElementType={}));function ee(ae){return ae.type===Z.Tag||ae.type===Z.Script||ae.type===Z.Style}ie.isTag=ee,ie.Root=Z.Root,ie.Text=Z.Text,ie.Directive=Z.Directive,ie.Comment=Z.Comment,ie.Script=Z.Script,ie.Style=Z.Style,ie.Tag=Z.Tag,ie.CDATA=Z.CDATA,ie.Doctype=Z.Doctype})(lib$3);var node$1={},__extends=commonjsGlobal&&commonjsGlobal.__extends||function(){var ie=function(Z,ee){return ie=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(ae,ye){ae.__proto__=ye}||function(ae,ye){for(var ve in ye)Object.prototype.hasOwnProperty.call(ye,ve)&&(ae[ve]=ye[ve])},ie(Z,ee)};return function(Z,ee){if(typeof ee!="function"&&ee!==null)throw new TypeError("Class extends value "+String(ee)+" is not a constructor or null");ie(Z,ee);function ae(){this.constructor=Z}Z.prototype=ee===null?Object.create(ee):(ae.prototype=ee.prototype,new ae)}}(),__assign$2=commonjsGlobal&&commonjsGlobal.__assign||function(){return __assign$2=Object.assign||function(ie){for(var Z,ee=1,ae=arguments.length;ee<ae;ee++){Z=arguments[ee];for(var ye in Z)Object.prototype.hasOwnProperty.call(Z,ye)&&(ie[ye]=Z[ye])}return ie},__assign$2.apply(this,arguments)};Object.defineProperty(node$1,"__esModule",{value:!0});node$1.cloneNode=node$1.hasChildren=node$1.isDocument=node$1.isDirective=node$1.isComment=node$1.isText=node$1.isCDATA=node$1.isTag=node$1.Element=node$1.Document=node$1.CDATA=node$1.NodeWithChildren=node$1.ProcessingInstruction=node$1.Comment=node$1.Text=node$1.DataNode=node$1.Node=void 0;var domelementtype_1$1=lib$3,Node$6=function(){function ie(){this.parent=null,this.prev=null,this.next=null,this.startIndex=null,this.endIndex=null}return Object.defineProperty(ie.prototype,"parentNode",{get:function(){return this.parent},set:function(Z){this.parent=Z},enumerable:!1,configurable:!0}),Object.defineProperty(ie.prototype,"previousSibling",{get:function(){return this.prev},set:function(Z){this.prev=Z},enumerable:!1,configurable:!0}),Object.defineProperty(ie.prototype,"nextSibling",{get:function(){return this.next},set:function(Z){this.next=Z},enumerable:!1,configurable:!0}),ie.prototype.cloneNode=function(Z){return Z===void 0&&(Z=!1),cloneNode$1(this,Z)},ie}();node$1.Node=Node$6;var DataNode=function(ie){__extends(Z,ie);function Z(ee){var ae=ie.call(this)||this;return ae.data=ee,ae}return Object.defineProperty(Z.prototype,"nodeValue",{get:function(){return this.data},set:function(ee){this.data=ee},enumerable:!1,configurable:!0}),Z}(Node$6);node$1.DataNode=DataNode;var Text=function(ie){__extends(Z,ie);function Z(){var ee=ie!==null&&ie.apply(this,arguments)||this;return ee.type=domelementtype_1$1.ElementType.Text,ee}return Object.defineProperty(Z.prototype,"nodeType",{get:function(){return 3},enumerable:!1,configurable:!0}),Z}(DataNode);node$1.Text=Text;var Comment$5=function(ie){__extends(Z,ie);function Z(){var ee=ie!==null&&ie.apply(this,arguments)||this;return ee.type=domelementtype_1$1.ElementType.Comment,ee}return Object.defineProperty(Z.prototype,"nodeType",{get:function(){return 8},enumerable:!1,configurable:!0}),Z}(DataNode);node$1.Comment=Comment$5;var ProcessingInstruction=function(ie){__extends(Z,ie);function Z(ee,ae){var ye=ie.call(this,ae)||this;return ye.name=ee,ye.type=domelementtype_1$1.ElementType.Directive,ye}return Object.defineProperty(Z.prototype,"nodeType",{get:function(){return 1},enumerable:!1,configurable:!0}),Z}(DataNode);node$1.ProcessingInstruction=ProcessingInstruction;var NodeWithChildren=function(ie){__extends(Z,ie);function Z(ee){var ae=ie.call(this)||this;return ae.children=ee,ae}return Object.defineProperty(Z.prototype,"firstChild",{get:function(){var ee;return(ee=this.children[0])!==null&&ee!==void 0?ee:null},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"lastChild",{get:function(){return this.children.length>0?this.children[this.children.length-1]:null},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"childNodes",{get:function(){return this.children},set:function(ee){this.children=ee},enumerable:!1,configurable:!0}),Z}(Node$6);node$1.NodeWithChildren=NodeWithChildren;var CDATA=function(ie){__extends(Z,ie);function Z(){var ee=ie!==null&&ie.apply(this,arguments)||this;return ee.type=domelementtype_1$1.ElementType.CDATA,ee}return Object.defineProperty(Z.prototype,"nodeType",{get:function(){return 4},enumerable:!1,configurable:!0}),Z}(NodeWithChildren);node$1.CDATA=CDATA;var Document$4=function(ie){__extends(Z,ie);function Z(){var ee=ie!==null&&ie.apply(this,arguments)||this;return ee.type=domelementtype_1$1.ElementType.Root,ee}return Object.defineProperty(Z.prototype,"nodeType",{get:function(){return 9},enumerable:!1,configurable:!0}),Z}(NodeWithChildren);node$1.Document=Document$4;var Element$1=function(ie){__extends(Z,ie);function Z(ee,ae,ye,ve){ye===void 0&&(ye=[]),ve===void 0&&(ve=ee==="script"?domelementtype_1$1.ElementType.Script:ee==="style"?domelementtype_1$1.ElementType.Style:domelementtype_1$1.ElementType.Tag);var be=ie.call(this,ye)||this;return be.name=ee,be.attribs=ae,be.type=ve,be}return Object.defineProperty(Z.prototype,"nodeType",{get:function(){return 1},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"tagName",{get:function(){return this.name},set:function(ee){this.name=ee},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"attributes",{get:function(){var ee=this;return Object.keys(this.attribs).map(function(ae){var ye,ve;return{name:ae,value:ee.attribs[ae],namespace:(ye=ee["x-attribsNamespace"])===null||ye===void 0?void 0:ye[ae],prefix:(ve=ee["x-attribsPrefix"])===null||ve===void 0?void 0:ve[ae]}})},enumerable:!1,configurable:!0}),Z}(NodeWithChildren);node$1.Element=Element$1;function isTag(ie){return(0,domelementtype_1$1.isTag)(ie)}node$1.isTag=isTag;function isCDATA(ie){return ie.type===domelementtype_1$1.ElementType.CDATA}node$1.isCDATA=isCDATA;function isText(ie){return ie.type===domelementtype_1$1.ElementType.Text}node$1.isText=isText;function isComment(ie){return ie.type===domelementtype_1$1.ElementType.Comment}node$1.isComment=isComment;function isDirective(ie){return ie.type===domelementtype_1$1.ElementType.Directive}node$1.isDirective=isDirective;function isDocument(ie){return ie.type===domelementtype_1$1.ElementType.Root}node$1.isDocument=isDocument;function hasChildren(ie){return Object.prototype.hasOwnProperty.call(ie,"children")}node$1.hasChildren=hasChildren;function cloneNode$1(ie,Z){Z===void 0&&(Z=!1);var ee;if(isText(ie))ee=new Text(ie.data);else if(isComment(ie))ee=new Comment$5(ie.data);else if(isTag(ie)){var ae=Z?cloneChildren(ie.children):[],ye=new Element$1(ie.name,__assign$2({},ie.attribs),ae);ae.forEach(function(Ke){return Ke.parent=ye}),ie.namespace!=null&&(ye.namespace=ie.namespace),ie["x-attribsNamespace"]&&(ye["x-attribsNamespace"]=__assign$2({},ie["x-attribsNamespace"])),ie["x-attribsPrefix"]&&(ye["x-attribsPrefix"]=__assign$2({},ie["x-attribsPrefix"])),ee=ye}else if(isCDATA(ie)){var ae=Z?cloneChildren(ie.children):[],ve=new CDATA(ae);ae.forEach(function(Xe){return Xe.parent=ve}),ee=ve}else if(isDocument(ie)){var ae=Z?cloneChildren(ie.children):[],be=new Document$4(ae);ae.forEach(function(Xe){return Xe.parent=be}),ie["x-mode"]&&(be["x-mode"]=ie["x-mode"]),ee=be}else if(isDirective(ie)){var Ye=new ProcessingInstruction(ie.name,ie.data);ie["x-name"]!=null&&(Ye["x-name"]=ie["x-name"],Ye["x-publicId"]=ie["x-publicId"],Ye["x-systemId"]=ie["x-systemId"]),ee=Ye}else throw new Error("Not implemented yet: ".concat(ie.type));return ee.startIndex=ie.startIndex,ee.endIndex=ie.endIndex,ie.sourceCodeLocation!=null&&(ee.sourceCodeLocation=ie.sourceCodeLocation),ee}node$1.cloneNode=cloneNode$1;function cloneChildren(ie){for(var Z=ie.map(function(ae){return cloneNode$1(ae,!0)}),ee=1;ee<Z.length;ee++)Z[ee].prev=Z[ee-1],Z[ee-1].next=Z[ee];return Z}(function(ie){var Z=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(Ye,Ke,Xe,Je){Je===void 0&&(Je=Xe);var rt=Object.getOwnPropertyDescriptor(Ke,Xe);(!rt||("get"in rt?!Ke.__esModule:rt.writable||rt.configurable))&&(rt={enumerable:!0,get:function(){return Ke[Xe]}}),Object.defineProperty(Ye,Je,rt)}:function(Ye,Ke,Xe,Je){Je===void 0&&(Je=Xe),Ye[Je]=Ke[Xe]}),ee=commonjsGlobal&&commonjsGlobal.__exportStar||function(Ye,Ke){for(var Xe in Ye)Xe!=="default"&&!Object.prototype.hasOwnProperty.call(Ke,Xe)&&Z(Ke,Ye,Xe)};Object.defineProperty(ie,"__esModule",{value:!0}),ie.DomHandler=void 0;var ae=lib$3,ye=node$1;ee(node$1,ie);var ve={withStartIndices:!1,withEndIndices:!1,xmlMode:!1},be=function(){function Ye(Ke,Xe,Je){this.dom=[],this.root=new ye.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null,typeof Xe=="function"&&(Je=Xe,Xe=ve),typeof Ke=="object"&&(Xe=Ke,Ke=void 0),this.callback=Ke??null,this.options=Xe??ve,this.elementCB=Je??null}return Ye.prototype.onparserinit=function(Ke){this.parser=Ke},Ye.prototype.onreset=function(){this.dom=[],this.root=new ye.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null},Ye.prototype.onend=function(){this.done||(this.done=!0,this.parser=null,this.handleCallback(null))},Ye.prototype.onerror=function(Ke){this.handleCallback(Ke)},Ye.prototype.onclosetag=function(){this.lastNode=null;var Ke=this.tagStack.pop();this.options.withEndIndices&&(Ke.endIndex=this.parser.endIndex),this.elementCB&&this.elementCB(Ke)},Ye.prototype.onopentag=function(Ke,Xe){var Je=this.options.xmlMode?ae.ElementType.Tag:void 0,rt=new ye.Element(Ke,Xe,void 0,Je);this.addNode(rt),this.tagStack.push(rt)},Ye.prototype.ontext=function(Ke){var Xe=this.lastNode;if(Xe&&Xe.type===ae.ElementType.Text)Xe.data+=Ke,this.options.withEndIndices&&(Xe.endIndex=this.parser.endIndex);else{var Je=new ye.Text(Ke);this.addNode(Je),this.lastNode=Je}},Ye.prototype.oncomment=function(Ke){if(this.lastNode&&this.lastNode.type===ae.ElementType.Comment){this.lastNode.data+=Ke;return}var Xe=new ye.Comment(Ke);this.addNode(Xe),this.lastNode=Xe},Ye.prototype.oncommentend=function(){this.lastNode=null},Ye.prototype.oncdatastart=function(){var Ke=new ye.Text(""),Xe=new ye.CDATA([Ke]);this.addNode(Xe),Ke.parent=Xe,this.lastNode=Ke},Ye.prototype.oncdataend=function(){this.lastNode=null},Ye.prototype.onprocessinginstruction=function(Ke,Xe){var Je=new ye.ProcessingInstruction(Ke,Xe);this.addNode(Je)},Ye.prototype.handleCallback=function(Ke){if(typeof this.callback=="function")this.callback(Ke,this.dom);else if(Ke)throw Ke},Ye.prototype.addNode=function(Ke){var Xe=this.tagStack[this.tagStack.length-1],Je=Xe.children[Xe.children.length-1];this.options.withStartIndices&&(Ke.startIndex=this.parser.startIndex),this.options.withEndIndices&&(Ke.endIndex=this.parser.endIndex),Xe.children.push(Ke),Je&&(Ke.prev=Je,Je.next=Ke),Ke.parent=Xe,this.lastNode=null},Ye}();ie.DomHandler=be,ie.default=be})(lib$4);var lib$2={},stringify$5={},lib$1={},lib={},encode={},encodeHtml={};Object.defineProperty(encodeHtml,"__esModule",{value:!0});function restoreDiff(ie){for(var Z=1;Z<ie.length;Z++)ie[Z][0]+=ie[Z-1][0]+1;return ie}encodeHtml.default=new Map(restoreDiff([[9,"&Tab;"],[0,"&NewLine;"],[22,"&excl;"],[0,"&quot;"],[0,"&num;"],[0,"&dollar;"],[0,"&percnt;"],[0,"&amp;"],[0,"&apos;"],[0,"&lpar;"],[0,"&rpar;"],[0,"&ast;"],[0,"&plus;"],[0,"&comma;"],[1,"&period;"],[0,"&sol;"],[10,"&colon;"],[0,"&semi;"],[0,{v:"&lt;",n:8402,o:"&nvlt;"}],[0,{v:"&equals;",n:8421,o:"&bne;"}],[0,{v:"&gt;",n:8402,o:"&nvgt;"}],[0,"&quest;"],[0,"&commat;"],[26,"&lbrack;"],[0,"&bsol;"],[0,"&rbrack;"],[0,"&Hat;"],[0,"&lowbar;"],[0,"&DiacriticalGrave;"],[5,{n:106,o:"&fjlig;"}],[20,"&lbrace;"],[0,"&verbar;"],[0,"&rbrace;"],[34,"&nbsp;"],[0,"&iexcl;"],[0,"&cent;"],[0,"&pound;"],[0,"&curren;"],[0,"&yen;"],[0,"&brvbar;"],[0,"&sect;"],[0,"&die;"],[0,"&copy;"],[0,"&ordf;"],[0,"&laquo;"],[0,"&not;"],[0,"&shy;"],[0,"&circledR;"],[0,"&macr;"],[0,"&deg;"],[0,"&PlusMinus;"],[0,"&sup2;"],[0,"&sup3;"],[0,"&acute;"],[0,"&micro;"],[0,"&para;"],[0,"&centerdot;"],[0,"&cedil;"],[0,"&sup1;"],[0,"&ordm;"],[0,"&raquo;"],[0,"&frac14;"],[0,"&frac12;"],[0,"&frac34;"],[0,"&iquest;"],[0,"&Agrave;"],[0,"&Aacute;"],[0,"&Acirc;"],[0,"&Atilde;"],[0,"&Auml;"],[0,"&angst;"],[0,"&AElig;"],[0,"&Ccedil;"],[0,"&Egrave;"],[0,"&Eacute;"],[0,"&Ecirc;"],[0,"&Euml;"],[0,"&Igrave;"],[0,"&Iacute;"],[0,"&Icirc;"],[0,"&Iuml;"],[0,"&ETH;"],[0,"&Ntilde;"],[0,"&Ograve;"],[0,"&Oacute;"],[0,"&Ocirc;"],[0,"&Otilde;"],[0,"&Ouml;"],[0,"&times;"],[0,"&Oslash;"],[0,"&Ugrave;"],[0,"&Uacute;"],[0,"&Ucirc;"],[0,"&Uuml;"],[0,"&Yacute;"],[0,"&THORN;"],[0,"&szlig;"],[0,"&agrave;"],[0,"&aacute;"],[0,"&acirc;"],[0,"&atilde;"],[0,"&auml;"],[0,"&aring;"],[0,"&aelig;"],[0,"&ccedil;"],[0,"&egrave;"],[0,"&eacute;"],[0,"&ecirc;"],[0,"&euml;"],[0,"&igrave;"],[0,"&iacute;"],[0,"&icirc;"],[0,"&iuml;"],[0,"&eth;"],[0,"&ntilde;"],[0,"&ograve;"],[0,"&oacute;"],[0,"&ocirc;"],[0,"&otilde;"],[0,"&ouml;"],[0,"&div;"],[0,"&oslash;"],[0,"&ugrave;"],[0,"&uacute;"],[0,"&ucirc;"],[0,"&uuml;"],[0,"&yacute;"],[0,"&thorn;"],[0,"&yuml;"],[0,"&Amacr;"],[0,"&amacr;"],[0,"&Abreve;"],[0,"&abreve;"],[0,"&Aogon;"],[0,"&aogon;"],[0,"&Cacute;"],[0,"&cacute;"],[0,"&Ccirc;"],[0,"&ccirc;"],[0,"&Cdot;"],[0,"&cdot;"],[0,"&Ccaron;"],[0,"&ccaron;"],[0,"&Dcaron;"],[0,"&dcaron;"],[0,"&Dstrok;"],[0,"&dstrok;"],[0,"&Emacr;"],[0,"&emacr;"],[2,"&Edot;"],[0,"&edot;"],[0,"&Eogon;"],[0,"&eogon;"],[0,"&Ecaron;"],[0,"&ecaron;"],[0,"&Gcirc;"],[0,"&gcirc;"],[0,"&Gbreve;"],[0,"&gbreve;"],[0,"&Gdot;"],[0,"&gdot;"],[0,"&Gcedil;"],[1,"&Hcirc;"],[0,"&hcirc;"],[0,"&Hstrok;"],[0,"&hstrok;"],[0,"&Itilde;"],[0,"&itilde;"],[0,"&Imacr;"],[0,"&imacr;"],[2,"&Iogon;"],[0,"&iogon;"],[0,"&Idot;"],[0,"&imath;"],[0,"&IJlig;"],[0,"&ijlig;"],[0,"&Jcirc;"],[0,"&jcirc;"],[0,"&Kcedil;"],[0,"&kcedil;"],[0,"&kgreen;"],[0,"&Lacute;"],[0,"&lacute;"],[0,"&Lcedil;"],[0,"&lcedil;"],[0,"&Lcaron;"],[0,"&lcaron;"],[0,"&Lmidot;"],[0,"&lmidot;"],[0,"&Lstrok;"],[0,"&lstrok;"],[0,"&Nacute;"],[0,"&nacute;"],[0,"&Ncedil;"],[0,"&ncedil;"],[0,"&Ncaron;"],[0,"&ncaron;"],[0,"&napos;"],[0,"&ENG;"],[0,"&eng;"],[0,"&Omacr;"],[0,"&omacr;"],[2,"&Odblac;"],[0,"&odblac;"],[0,"&OElig;"],[0,"&oelig;"],[0,"&Racute;"],[0,"&racute;"],[0,"&Rcedil;"],[0,"&rcedil;"],[0,"&Rcaron;"],[0,"&rcaron;"],[0,"&Sacute;"],[0,"&sacute;"],[0,"&Scirc;"],[0,"&scirc;"],[0,"&Scedil;"],[0,"&scedil;"],[0,"&Scaron;"],[0,"&scaron;"],[0,"&Tcedil;"],[0,"&tcedil;"],[0,"&Tcaron;"],[0,"&tcaron;"],[0,"&Tstrok;"],[0,"&tstrok;"],[0,"&Utilde;"],[0,"&utilde;"],[0,"&Umacr;"],[0,"&umacr;"],[0,"&Ubreve;"],[0,"&ubreve;"],[0,"&Uring;"],[0,"&uring;"],[0,"&Udblac;"],[0,"&udblac;"],[0,"&Uogon;"],[0,"&uogon;"],[0,"&Wcirc;"],[0,"&wcirc;"],[0,"&Ycirc;"],[0,"&ycirc;"],[0,"&Yuml;"],[0,"&Zacute;"],[0,"&zacute;"],[0,"&Zdot;"],[0,"&zdot;"],[0,"&Zcaron;"],[0,"&zcaron;"],[19,"&fnof;"],[34,"&imped;"],[63,"&gacute;"],[65,"&jmath;"],[142,"&circ;"],[0,"&caron;"],[16,"&breve;"],[0,"&DiacriticalDot;"],[0,"&ring;"],[0,"&ogon;"],[0,"&DiacriticalTilde;"],[0,"&dblac;"],[51,"&DownBreve;"],[127,"&Alpha;"],[0,"&Beta;"],[0,"&Gamma;"],[0,"&Delta;"],[0,"&Epsilon;"],[0,"&Zeta;"],[0,"&Eta;"],[0,"&Theta;"],[0,"&Iota;"],[0,"&Kappa;"],[0,"&Lambda;"],[0,"&Mu;"],[0,"&Nu;"],[0,"&Xi;"],[0,"&Omicron;"],[0,"&Pi;"],[0,"&Rho;"],[1,"&Sigma;"],[0,"&Tau;"],[0,"&Upsilon;"],[0,"&Phi;"],[0,"&Chi;"],[0,"&Psi;"],[0,"&ohm;"],[7,"&alpha;"],[0,"&beta;"],[0,"&gamma;"],[0,"&delta;"],[0,"&epsi;"],[0,"&zeta;"],[0,"&eta;"],[0,"&theta;"],[0,"&iota;"],[0,"&kappa;"],[0,"&lambda;"],[0,"&mu;"],[0,"&nu;"],[0,"&xi;"],[0,"&omicron;"],[0,"&pi;"],[0,"&rho;"],[0,"&sigmaf;"],[0,"&sigma;"],[0,"&tau;"],[0,"&upsi;"],[0,"&phi;"],[0,"&chi;"],[0,"&psi;"],[0,"&omega;"],[7,"&thetasym;"],[0,"&Upsi;"],[2,"&phiv;"],[0,"&piv;"],[5,"&Gammad;"],[0,"&digamma;"],[18,"&kappav;"],[0,"&rhov;"],[3,"&epsiv;"],[0,"&backepsilon;"],[10,"&IOcy;"],[0,"&DJcy;"],[0,"&GJcy;"],[0,"&Jukcy;"],[0,"&DScy;"],[0,"&Iukcy;"],[0,"&YIcy;"],[0,"&Jsercy;"],[0,"&LJcy;"],[0,"&NJcy;"],[0,"&TSHcy;"],[0,"&KJcy;"],[1,"&Ubrcy;"],[0,"&DZcy;"],[0,"&Acy;"],[0,"&Bcy;"],[0,"&Vcy;"],[0,"&Gcy;"],[0,"&Dcy;"],[0,"&IEcy;"],[0,"&ZHcy;"],[0,"&Zcy;"],[0,"&Icy;"],[0,"&Jcy;"],[0,"&Kcy;"],[0,"&Lcy;"],[0,"&Mcy;"],[0,"&Ncy;"],[0,"&Ocy;"],[0,"&Pcy;"],[0,"&Rcy;"],[0,"&Scy;"],[0,"&Tcy;"],[0,"&Ucy;"],[0,"&Fcy;"],[0,"&KHcy;"],[0,"&TScy;"],[0,"&CHcy;"],[0,"&SHcy;"],[0,"&SHCHcy;"],[0,"&HARDcy;"],[0,"&Ycy;"],[0,"&SOFTcy;"],[0,"&Ecy;"],[0,"&YUcy;"],[0,"&YAcy;"],[0,"&acy;"],[0,"&bcy;"],[0,"&vcy;"],[0,"&gcy;"],[0,"&dcy;"],[0,"&iecy;"],[0,"&zhcy;"],[0,"&zcy;"],[0,"&icy;"],[0,"&jcy;"],[0,"&kcy;"],[0,"&lcy;"],[0,"&mcy;"],[0,"&ncy;"],[0,"&ocy;"],[0,"&pcy;"],[0,"&rcy;"],[0,"&scy;"],[0,"&tcy;"],[0,"&ucy;"],[0,"&fcy;"],[0,"&khcy;"],[0,"&tscy;"],[0,"&chcy;"],[0,"&shcy;"],[0,"&shchcy;"],[0,"&hardcy;"],[0,"&ycy;"],[0,"&softcy;"],[0,"&ecy;"],[0,"&yucy;"],[0,"&yacy;"],[1,"&iocy;"],[0,"&djcy;"],[0,"&gjcy;"],[0,"&jukcy;"],[0,"&dscy;"],[0,"&iukcy;"],[0,"&yicy;"],[0,"&jsercy;"],[0,"&ljcy;"],[0,"&njcy;"],[0,"&tshcy;"],[0,"&kjcy;"],[1,"&ubrcy;"],[0,"&dzcy;"],[7074,"&ensp;"],[0,"&emsp;"],[0,"&emsp13;"],[0,"&emsp14;"],[1,"&numsp;"],[0,"&puncsp;"],[0,"&ThinSpace;"],[0,"&hairsp;"],[0,"&NegativeMediumSpace;"],[0,"&zwnj;"],[0,"&zwj;"],[0,"&lrm;"],[0,"&rlm;"],[0,"&dash;"],[2,"&ndash;"],[0,"&mdash;"],[0,"&horbar;"],[0,"&Verbar;"],[1,"&lsquo;"],[0,"&CloseCurlyQuote;"],[0,"&lsquor;"],[1,"&ldquo;"],[0,"&CloseCurlyDoubleQuote;"],[0,"&bdquo;"],[1,"&dagger;"],[0,"&Dagger;"],[0,"&bull;"],[2,"&nldr;"],[0,"&hellip;"],[9,"&permil;"],[0,"&pertenk;"],[0,"&prime;"],[0,"&Prime;"],[0,"&tprime;"],[0,"&backprime;"],[3,"&lsaquo;"],[0,"&rsaquo;"],[3,"&oline;"],[2,"&caret;"],[1,"&hybull;"],[0,"&frasl;"],[10,"&bsemi;"],[7,"&qprime;"],[7,{v:"&MediumSpace;",n:8202,o:"&ThickSpace;"}],[0,"&NoBreak;"],[0,"&af;"],[0,"&InvisibleTimes;"],[0,"&ic;"],[72,"&euro;"],[46,"&tdot;"],[0,"&DotDot;"],[37,"&complexes;"],[2,"&incare;"],[4,"&gscr;"],[0,"&hamilt;"],[0,"&Hfr;"],[0,"&Hopf;"],[0,"&planckh;"],[0,"&hbar;"],[0,"&imagline;"],[0,"&Ifr;"],[0,"&lagran;"],[0,"&ell;"],[1,"&naturals;"],[0,"&numero;"],[0,"&copysr;"],[0,"&weierp;"],[0,"&Popf;"],[0,"&Qopf;"],[0,"&realine;"],[0,"&real;"],[0,"&reals;"],[0,"&rx;"],[3,"&trade;"],[1,"&integers;"],[2,"&mho;"],[0,"&zeetrf;"],[0,"&iiota;"],[2,"&bernou;"],[0,"&Cayleys;"],[1,"&escr;"],[0,"&Escr;"],[0,"&Fouriertrf;"],[1,"&Mellintrf;"],[0,"&order;"],[0,"&alefsym;"],[0,"&beth;"],[0,"&gimel;"],[0,"&daleth;"],[12,"&CapitalDifferentialD;"],[0,"&dd;"],[0,"&ee;"],[0,"&ii;"],[10,"&frac13;"],[0,"&frac23;"],[0,"&frac15;"],[0,"&frac25;"],[0,"&frac35;"],[0,"&frac45;"],[0,"&frac16;"],[0,"&frac56;"],[0,"&frac18;"],[0,"&frac38;"],[0,"&frac58;"],[0,"&frac78;"],[49,"&larr;"],[0,"&ShortUpArrow;"],[0,"&rarr;"],[0,"&darr;"],[0,"&harr;"],[0,"&updownarrow;"],[0,"&nwarr;"],[0,"&nearr;"],[0,"&LowerRightArrow;"],[0,"&LowerLeftArrow;"],[0,"&nlarr;"],[0,"&nrarr;"],[1,{v:"&rarrw;",n:824,o:"&nrarrw;"}],[0,"&Larr;"],[0,"&Uarr;"],[0,"&Rarr;"],[0,"&Darr;"],[0,"&larrtl;"],[0,"&rarrtl;"],[0,"&LeftTeeArrow;"],[0,"&mapstoup;"],[0,"&map;"],[0,"&DownTeeArrow;"],[1,"&hookleftarrow;"],[0,"&hookrightarrow;"],[0,"&larrlp;"],[0,"&looparrowright;"],[0,"&harrw;"],[0,"&nharr;"],[1,"&lsh;"],[0,"&rsh;"],[0,"&ldsh;"],[0,"&rdsh;"],[1,"&crarr;"],[0,"&cularr;"],[0,"&curarr;"],[2,"&circlearrowleft;"],[0,"&circlearrowright;"],[0,"&leftharpoonup;"],[0,"&DownLeftVector;"],[0,"&RightUpVector;"],[0,"&LeftUpVector;"],[0,"&rharu;"],[0,"&DownRightVector;"],[0,"&dharr;"],[0,"&dharl;"],[0,"&RightArrowLeftArrow;"],[0,"&udarr;"],[0,"&LeftArrowRightArrow;"],[0,"&leftleftarrows;"],[0,"&upuparrows;"],[0,"&rightrightarrows;"],[0,"&ddarr;"],[0,"&leftrightharpoons;"],[0,"&Equilibrium;"],[0,"&nlArr;"],[0,"&nhArr;"],[0,"&nrArr;"],[0,"&DoubleLeftArrow;"],[0,"&DoubleUpArrow;"],[0,"&DoubleRightArrow;"],[0,"&dArr;"],[0,"&DoubleLeftRightArrow;"],[0,"&DoubleUpDownArrow;"],[0,"&nwArr;"],[0,"&neArr;"],[0,"&seArr;"],[0,"&swArr;"],[0,"&lAarr;"],[0,"&rAarr;"],[1,"&zigrarr;"],[6,"&larrb;"],[0,"&rarrb;"],[15,"&DownArrowUpArrow;"],[7,"&loarr;"],[0,"&roarr;"],[0,"&hoarr;"],[0,"&forall;"],[0,"&comp;"],[0,{v:"&part;",n:824,o:"&npart;"}],[0,"&exist;"],[0,"&nexist;"],[0,"&empty;"],[1,"&Del;"],[0,"&Element;"],[0,"&NotElement;"],[1,"&ni;"],[0,"&notni;"],[2,"&prod;"],[0,"&coprod;"],[0,"&sum;"],[0,"&minus;"],[0,"&MinusPlus;"],[0,"&dotplus;"],[1,"&Backslash;"],[0,"&lowast;"],[0,"&compfn;"],[1,"&radic;"],[2,"&prop;"],[0,"&infin;"],[0,"&angrt;"],[0,{v:"&ang;",n:8402,o:"&nang;"}],[0,"&angmsd;"],[0,"&angsph;"],[0,"&mid;"],[0,"&nmid;"],[0,"&DoubleVerticalBar;"],[0,"&NotDoubleVerticalBar;"],[0,"&and;"],[0,"&or;"],[0,{v:"&cap;",n:65024,o:"&caps;"}],[0,{v:"&cup;",n:65024,o:"&cups;"}],[0,"&int;"],[0,"&Int;"],[0,"&iiint;"],[0,"&conint;"],[0,"&Conint;"],[0,"&Cconint;"],[0,"&cwint;"],[0,"&ClockwiseContourIntegral;"],[0,"&awconint;"],[0,"&there4;"],[0,"&becaus;"],[0,"&ratio;"],[0,"&Colon;"],[0,"&dotminus;"],[1,"&mDDot;"],[0,"&homtht;"],[0,{v:"&sim;",n:8402,o:"&nvsim;"}],[0,{v:"&backsim;",n:817,o:"&race;"}],[0,{v:"&ac;",n:819,o:"&acE;"}],[0,"&acd;"],[0,"&VerticalTilde;"],[0,"&NotTilde;"],[0,{v:"&eqsim;",n:824,o:"&nesim;"}],[0,"&sime;"],[0,"&NotTildeEqual;"],[0,"&cong;"],[0,"&simne;"],[0,"&ncong;"],[0,"&ap;"],[0,"&nap;"],[0,"&ape;"],[0,{v:"&apid;",n:824,o:"&napid;"}],[0,"&backcong;"],[0,{v:"&asympeq;",n:8402,o:"&nvap;"}],[0,{v:"&bump;",n:824,o:"&nbump;"}],[0,{v:"&bumpe;",n:824,o:"&nbumpe;"}],[0,{v:"&doteq;",n:824,o:"&nedot;"}],[0,"&doteqdot;"],[0,"&efDot;"],[0,"&erDot;"],[0,"&Assign;"],[0,"&ecolon;"],[0,"&ecir;"],[0,"&circeq;"],[1,"&wedgeq;"],[0,"&veeeq;"],[1,"&triangleq;"],[2,"&equest;"],[0,"&ne;"],[0,{v:"&Congruent;",n:8421,o:"&bnequiv;"}],[0,"&nequiv;"],[1,{v:"&le;",n:8402,o:"&nvle;"}],[0,{v:"&ge;",n:8402,o:"&nvge;"}],[0,{v:"&lE;",n:824,o:"&nlE;"}],[0,{v:"&gE;",n:824,o:"&ngE;"}],[0,{v:"&lnE;",n:65024,o:"&lvertneqq;"}],[0,{v:"&gnE;",n:65024,o:"&gvertneqq;"}],[0,{v:"&ll;",n:new Map(restoreDiff([[824,"&nLtv;"],[7577,"&nLt;"]]))}],[0,{v:"&gg;",n:new Map(restoreDiff([[824,"&nGtv;"],[7577,"&nGt;"]]))}],[0,"&between;"],[0,"&NotCupCap;"],[0,"&nless;"],[0,"&ngt;"],[0,"&nle;"],[0,"&nge;"],[0,"&lesssim;"],[0,"&GreaterTilde;"],[0,"&nlsim;"],[0,"&ngsim;"],[0,"&LessGreater;"],[0,"&gl;"],[0,"&NotLessGreater;"],[0,"&NotGreaterLess;"],[0,"&pr;"],[0,"&sc;"],[0,"&prcue;"],[0,"&sccue;"],[0,"&PrecedesTilde;"],[0,{v:"&scsim;",n:824,o:"&NotSucceedsTilde;"}],[0,"&NotPrecedes;"],[0,"&NotSucceeds;"],[0,{v:"&sub;",n:8402,o:"&NotSubset;"}],[0,{v:"&sup;",n:8402,o:"&NotSuperset;"}],[0,"&nsub;"],[0,"&nsup;"],[0,"&sube;"],[0,"&supe;"],[0,"&NotSubsetEqual;"],[0,"&NotSupersetEqual;"],[0,{v:"&subne;",n:65024,o:"&varsubsetneq;"}],[0,{v:"&supne;",n:65024,o:"&varsupsetneq;"}],[1,"&cupdot;"],[0,"&UnionPlus;"],[0,{v:"&sqsub;",n:824,o:"&NotSquareSubset;"}],[0,{v:"&sqsup;",n:824,o:"&NotSquareSuperset;"}],[0,"&sqsube;"],[0,"&sqsupe;"],[0,{v:"&sqcap;",n:65024,o:"&sqcaps;"}],[0,{v:"&sqcup;",n:65024,o:"&sqcups;"}],[0,"&CirclePlus;"],[0,"&CircleMinus;"],[0,"&CircleTimes;"],[0,"&osol;"],[0,"&CircleDot;"],[0,"&circledcirc;"],[0,"&circledast;"],[1,"&circleddash;"],[0,"&boxplus;"],[0,"&boxminus;"],[0,"&boxtimes;"],[0,"&dotsquare;"],[0,"&RightTee;"],[0,"&dashv;"],[0,"&DownTee;"],[0,"&bot;"],[1,"&models;"],[0,"&DoubleRightTee;"],[0,"&Vdash;"],[0,"&Vvdash;"],[0,"&VDash;"],[0,"&nvdash;"],[0,"&nvDash;"],[0,"&nVdash;"],[0,"&nVDash;"],[0,"&prurel;"],[1,"&LeftTriangle;"],[0,"&RightTriangle;"],[0,{v:"&LeftTriangleEqual;",n:8402,o:"&nvltrie;"}],[0,{v:"&RightTriangleEqual;",n:8402,o:"&nvrtrie;"}],[0,"&origof;"],[0,"&imof;"],[0,"&multimap;"],[0,"&hercon;"],[0,"&intcal;"],[0,"&veebar;"],[1,"&barvee;"],[0,"&angrtvb;"],[0,"&lrtri;"],[0,"&bigwedge;"],[0,"&bigvee;"],[0,"&bigcap;"],[0,"&bigcup;"],[0,"&diam;"],[0,"&sdot;"],[0,"&sstarf;"],[0,"&divideontimes;"],[0,"&bowtie;"],[0,"&ltimes;"],[0,"&rtimes;"],[0,"&leftthreetimes;"],[0,"&rightthreetimes;"],[0,"&backsimeq;"],[0,"&curlyvee;"],[0,"&curlywedge;"],[0,"&Sub;"],[0,"&Sup;"],[0,"&Cap;"],[0,"&Cup;"],[0,"&fork;"],[0,"&epar;"],[0,"&lessdot;"],[0,"&gtdot;"],[0,{v:"&Ll;",n:824,o:"&nLl;"}],[0,{v:"&Gg;",n:824,o:"&nGg;"}],[0,{v:"&leg;",n:65024,o:"&lesg;"}],[0,{v:"&gel;",n:65024,o:"&gesl;"}],[2,"&cuepr;"],[0,"&cuesc;"],[0,"&NotPrecedesSlantEqual;"],[0,"&NotSucceedsSlantEqual;"],[0,"&NotSquareSubsetEqual;"],[0,"&NotSquareSupersetEqual;"],[2,"&lnsim;"],[0,"&gnsim;"],[0,"&precnsim;"],[0,"&scnsim;"],[0,"&nltri;"],[0,"&NotRightTriangle;"],[0,"&nltrie;"],[0,"&NotRightTriangleEqual;"],[0,"&vellip;"],[0,"&ctdot;"],[0,"&utdot;"],[0,"&dtdot;"],[0,"&disin;"],[0,"&isinsv;"],[0,"&isins;"],[0,{v:"&isindot;",n:824,o:"&notindot;"}],[0,"&notinvc;"],[0,"&notinvb;"],[1,{v:"&isinE;",n:824,o:"&notinE;"}],[0,"&nisd;"],[0,"&xnis;"],[0,"&nis;"],[0,"&notnivc;"],[0,"&notnivb;"],[6,"&barwed;"],[0,"&Barwed;"],[1,"&lceil;"],[0,"&rceil;"],[0,"&LeftFloor;"],[0,"&rfloor;"],[0,"&drcrop;"],[0,"&dlcrop;"],[0,"&urcrop;"],[0,"&ulcrop;"],[0,"&bnot;"],[1,"&profline;"],[0,"&profsurf;"],[1,"&telrec;"],[0,"&target;"],[5,"&ulcorn;"],[0,"&urcorn;"],[0,"&dlcorn;"],[0,"&drcorn;"],[2,"&frown;"],[0,"&smile;"],[9,"&cylcty;"],[0,"&profalar;"],[7,"&topbot;"],[6,"&ovbar;"],[1,"&solbar;"],[60,"&angzarr;"],[51,"&lmoustache;"],[0,"&rmoustache;"],[2,"&OverBracket;"],[0,"&bbrk;"],[0,"&bbrktbrk;"],[37,"&OverParenthesis;"],[0,"&UnderParenthesis;"],[0,"&OverBrace;"],[0,"&UnderBrace;"],[2,"&trpezium;"],[4,"&elinters;"],[59,"&blank;"],[164,"&circledS;"],[55,"&boxh;"],[1,"&boxv;"],[9,"&boxdr;"],[3,"&boxdl;"],[3,"&boxur;"],[3,"&boxul;"],[3,"&boxvr;"],[7,"&boxvl;"],[7,"&boxhd;"],[7,"&boxhu;"],[7,"&boxvh;"],[19,"&boxH;"],[0,"&boxV;"],[0,"&boxdR;"],[0,"&boxDr;"],[0,"&boxDR;"],[0,"&boxdL;"],[0,"&boxDl;"],[0,"&boxDL;"],[0,"&boxuR;"],[0,"&boxUr;"],[0,"&boxUR;"],[0,"&boxuL;"],[0,"&boxUl;"],[0,"&boxUL;"],[0,"&boxvR;"],[0,"&boxVr;"],[0,"&boxVR;"],[0,"&boxvL;"],[0,"&boxVl;"],[0,"&boxVL;"],[0,"&boxHd;"],[0,"&boxhD;"],[0,"&boxHD;"],[0,"&boxHu;"],[0,"&boxhU;"],[0,"&boxHU;"],[0,"&boxvH;"],[0,"&boxVh;"],[0,"&boxVH;"],[19,"&uhblk;"],[3,"&lhblk;"],[3,"&block;"],[8,"&blk14;"],[0,"&blk12;"],[0,"&blk34;"],[13,"&square;"],[8,"&blacksquare;"],[0,"&EmptyVerySmallSquare;"],[1,"&rect;"],[0,"&marker;"],[2,"&fltns;"],[1,"&bigtriangleup;"],[0,"&blacktriangle;"],[0,"&triangle;"],[2,"&blacktriangleright;"],[0,"&rtri;"],[3,"&bigtriangledown;"],[0,"&blacktriangledown;"],[0,"&dtri;"],[2,"&blacktriangleleft;"],[0,"&ltri;"],[6,"&loz;"],[0,"&cir;"],[32,"&tridot;"],[2,"&bigcirc;"],[8,"&ultri;"],[0,"&urtri;"],[0,"&lltri;"],[0,"&EmptySmallSquare;"],[0,"&FilledSmallSquare;"],[8,"&bigstar;"],[0,"&star;"],[7,"&phone;"],[49,"&female;"],[1,"&male;"],[29,"&spades;"],[2,"&clubs;"],[1,"&hearts;"],[0,"&diamondsuit;"],[3,"&sung;"],[2,"&flat;"],[0,"&natural;"],[0,"&sharp;"],[163,"&check;"],[3,"&cross;"],[8,"&malt;"],[21,"&sext;"],[33,"&VerticalSeparator;"],[25,"&lbbrk;"],[0,"&rbbrk;"],[84,"&bsolhsub;"],[0,"&suphsol;"],[28,"&LeftDoubleBracket;"],[0,"&RightDoubleBracket;"],[0,"&lang;"],[0,"&rang;"],[0,"&Lang;"],[0,"&Rang;"],[0,"&loang;"],[0,"&roang;"],[7,"&longleftarrow;"],[0,"&longrightarrow;"],[0,"&longleftrightarrow;"],[0,"&DoubleLongLeftArrow;"],[0,"&DoubleLongRightArrow;"],[0,"&DoubleLongLeftRightArrow;"],[1,"&longmapsto;"],[2,"&dzigrarr;"],[258,"&nvlArr;"],[0,"&nvrArr;"],[0,"&nvHarr;"],[0,"&Map;"],[6,"&lbarr;"],[0,"&bkarow;"],[0,"&lBarr;"],[0,"&dbkarow;"],[0,"&drbkarow;"],[0,"&DDotrahd;"],[0,"&UpArrowBar;"],[0,"&DownArrowBar;"],[2,"&Rarrtl;"],[2,"&latail;"],[0,"&ratail;"],[0,"&lAtail;"],[0,"&rAtail;"],[0,"&larrfs;"],[0,"&rarrfs;"],[0,"&larrbfs;"],[0,"&rarrbfs;"],[2,"&nwarhk;"],[0,"&nearhk;"],[0,"&hksearow;"],[0,"&hkswarow;"],[0,"&nwnear;"],[0,"&nesear;"],[0,"&seswar;"],[0,"&swnwar;"],[8,{v:"&rarrc;",n:824,o:"&nrarrc;"}],[1,"&cudarrr;"],[0,"&ldca;"],[0,"&rdca;"],[0,"&cudarrl;"],[0,"&larrpl;"],[2,"&curarrm;"],[0,"&cularrp;"],[7,"&rarrpl;"],[2,"&harrcir;"],[0,"&Uarrocir;"],[0,"&lurdshar;"],[0,"&ldrushar;"],[2,"&LeftRightVector;"],[0,"&RightUpDownVector;"],[0,"&DownLeftRightVector;"],[0,"&LeftUpDownVector;"],[0,"&LeftVectorBar;"],[0,"&RightVectorBar;"],[0,"&RightUpVectorBar;"],[0,"&RightDownVectorBar;"],[0,"&DownLeftVectorBar;"],[0,"&DownRightVectorBar;"],[0,"&LeftUpVectorBar;"],[0,"&LeftDownVectorBar;"],[0,"&LeftTeeVector;"],[0,"&RightTeeVector;"],[0,"&RightUpTeeVector;"],[0,"&RightDownTeeVector;"],[0,"&DownLeftTeeVector;"],[0,"&DownRightTeeVector;"],[0,"&LeftUpTeeVector;"],[0,"&LeftDownTeeVector;"],[0,"&lHar;"],[0,"&uHar;"],[0,"&rHar;"],[0,"&dHar;"],[0,"&luruhar;"],[0,"&ldrdhar;"],[0,"&ruluhar;"],[0,"&rdldhar;"],[0,"&lharul;"],[0,"&llhard;"],[0,"&rharul;"],[0,"&lrhard;"],[0,"&udhar;"],[0,"&duhar;"],[0,"&RoundImplies;"],[0,"&erarr;"],[0,"&simrarr;"],[0,"&larrsim;"],[0,"&rarrsim;"],[0,"&rarrap;"],[0,"&ltlarr;"],[1,"&gtrarr;"],[0,"&subrarr;"],[1,"&suplarr;"],[0,"&lfisht;"],[0,"&rfisht;"],[0,"&ufisht;"],[0,"&dfisht;"],[5,"&lopar;"],[0,"&ropar;"],[4,"&lbrke;"],[0,"&rbrke;"],[0,"&lbrkslu;"],[0,"&rbrksld;"],[0,"&lbrksld;"],[0,"&rbrkslu;"],[0,"&langd;"],[0,"&rangd;"],[0,"&lparlt;"],[0,"&rpargt;"],[0,"&gtlPar;"],[0,"&ltrPar;"],[3,"&vzigzag;"],[1,"&vangrt;"],[0,"&angrtvbd;"],[6,"&ange;"],[0,"&range;"],[0,"&dwangle;"],[0,"&uwangle;"],[0,"&angmsdaa;"],[0,"&angmsdab;"],[0,"&angmsdac;"],[0,"&angmsdad;"],[0,"&angmsdae;"],[0,"&angmsdaf;"],[0,"&angmsdag;"],[0,"&angmsdah;"],[0,"&bemptyv;"],[0,"&demptyv;"],[0,"&cemptyv;"],[0,"&raemptyv;"],[0,"&laemptyv;"],[0,"&ohbar;"],[0,"&omid;"],[0,"&opar;"],[1,"&operp;"],[1,"&olcross;"],[0,"&odsold;"],[1,"&olcir;"],[0,"&ofcir;"],[0,"&olt;"],[0,"&ogt;"],[0,"&cirscir;"],[0,"&cirE;"],[0,"&solb;"],[0,"&bsolb;"],[3,"&boxbox;"],[3,"&trisb;"],[0,"&rtriltri;"],[0,{v:"&LeftTriangleBar;",n:824,o:"&NotLeftTriangleBar;"}],[0,{v:"&RightTriangleBar;",n:824,o:"&NotRightTriangleBar;"}],[11,"&iinfin;"],[0,"&infintie;"],[0,"&nvinfin;"],[4,"&eparsl;"],[0,"&smeparsl;"],[0,"&eqvparsl;"],[5,"&blacklozenge;"],[8,"&RuleDelayed;"],[1,"&dsol;"],[9,"&bigodot;"],[0,"&bigoplus;"],[0,"&bigotimes;"],[1,"&biguplus;"],[1,"&bigsqcup;"],[5,"&iiiint;"],[0,"&fpartint;"],[2,"&cirfnint;"],[0,"&awint;"],[0,"&rppolint;"],[0,"&scpolint;"],[0,"&npolint;"],[0,"&pointint;"],[0,"&quatint;"],[0,"&intlarhk;"],[10,"&pluscir;"],[0,"&plusacir;"],[0,"&simplus;"],[0,"&plusdu;"],[0,"&plussim;"],[0,"&plustwo;"],[1,"&mcomma;"],[0,"&minusdu;"],[2,"&loplus;"],[0,"&roplus;"],[0,"&Cross;"],[0,"&timesd;"],[0,"&timesbar;"],[1,"&smashp;"],[0,"&lotimes;"],[0,"&rotimes;"],[0,"&otimesas;"],[0,"&Otimes;"],[0,"&odiv;"],[0,"&triplus;"],[0,"&triminus;"],[0,"&tritime;"],[0,"&intprod;"],[2,"&amalg;"],[0,"&capdot;"],[1,"&ncup;"],[0,"&ncap;"],[0,"&capand;"],[0,"&cupor;"],[0,"&cupcap;"],[0,"&capcup;"],[0,"&cupbrcap;"],[0,"&capbrcup;"],[0,"&cupcup;"],[0,"&capcap;"],[0,"&ccups;"],[0,"&ccaps;"],[2,"&ccupssm;"],[2,"&And;"],[0,"&Or;"],[0,"&andand;"],[0,"&oror;"],[0,"&orslope;"],[0,"&andslope;"],[1,"&andv;"],[0,"&orv;"],[0,"&andd;"],[0,"&ord;"],[1,"&wedbar;"],[6,"&sdote;"],[3,"&simdot;"],[2,{v:"&congdot;",n:824,o:"&ncongdot;"}],[0,"&easter;"],[0,"&apacir;"],[0,{v:"&apE;",n:824,o:"&napE;"}],[0,"&eplus;"],[0,"&pluse;"],[0,"&Esim;"],[0,"&Colone;"],[0,"&Equal;"],[1,"&ddotseq;"],[0,"&equivDD;"],[0,"&ltcir;"],[0,"&gtcir;"],[0,"&ltquest;"],[0,"&gtquest;"],[0,{v:"&leqslant;",n:824,o:"&nleqslant;"}],[0,{v:"&geqslant;",n:824,o:"&ngeqslant;"}],[0,"&lesdot;"],[0,"&gesdot;"],[0,"&lesdoto;"],[0,"&gesdoto;"],[0,"&lesdotor;"],[0,"&gesdotol;"],[0,"&lap;"],[0,"&gap;"],[0,"&lne;"],[0,"&gne;"],[0,"&lnap;"],[0,"&gnap;"],[0,"&lEg;"],[0,"&gEl;"],[0,"&lsime;"],[0,"&gsime;"],[0,"&lsimg;"],[0,"&gsiml;"],[0,"&lgE;"],[0,"&glE;"],[0,"&lesges;"],[0,"&gesles;"],[0,"&els;"],[0,"&egs;"],[0,"&elsdot;"],[0,"&egsdot;"],[0,"&el;"],[0,"&eg;"],[2,"&siml;"],[0,"&simg;"],[0,"&simlE;"],[0,"&simgE;"],[0,{v:"&LessLess;",n:824,o:"&NotNestedLessLess;"}],[0,{v:"&GreaterGreater;",n:824,o:"&NotNestedGreaterGreater;"}],[1,"&glj;"],[0,"&gla;"],[0,"&ltcc;"],[0,"&gtcc;"],[0,"&lescc;"],[0,"&gescc;"],[0,"&smt;"],[0,"&lat;"],[0,{v:"&smte;",n:65024,o:"&smtes;"}],[0,{v:"&late;",n:65024,o:"&lates;"}],[0,"&bumpE;"],[0,{v:"&PrecedesEqual;",n:824,o:"&NotPrecedesEqual;"}],[0,{v:"&sce;",n:824,o:"&NotSucceedsEqual;"}],[2,"&prE;"],[0,"&scE;"],[0,"&precneqq;"],[0,"&scnE;"],[0,"&prap;"],[0,"&scap;"],[0,"&precnapprox;"],[0,"&scnap;"],[0,"&Pr;"],[0,"&Sc;"],[0,"&subdot;"],[0,"&supdot;"],[0,"&subplus;"],[0,"&supplus;"],[0,"&submult;"],[0,"&supmult;"],[0,"&subedot;"],[0,"&supedot;"],[0,{v:"&subE;",n:824,o:"&nsubE;"}],[0,{v:"&supE;",n:824,o:"&nsupE;"}],[0,"&subsim;"],[0,"&supsim;"],[2,{v:"&subnE;",n:65024,o:"&varsubsetneqq;"}],[0,{v:"&supnE;",n:65024,o:"&varsupsetneqq;"}],[2,"&csub;"],[0,"&csup;"],[0,"&csube;"],[0,"&csupe;"],[0,"&subsup;"],[0,"&supsub;"],[0,"&subsub;"],[0,"&supsup;"],[0,"&suphsub;"],[0,"&supdsub;"],[0,"&forkv;"],[0,"&topfork;"],[0,"&mlcp;"],[8,"&Dashv;"],[1,"&Vdashl;"],[0,"&Barv;"],[0,"&vBar;"],[0,"&vBarv;"],[1,"&Vbar;"],[0,"&Not;"],[0,"&bNot;"],[0,"&rnmid;"],[0,"&cirmid;"],[0,"&midcir;"],[0,"&topcir;"],[0,"&nhpar;"],[0,"&parsim;"],[9,{v:"&parsl;",n:8421,o:"&nparsl;"}],[44343,{n:new Map(restoreDiff([[56476,"&Ascr;"],[1,"&Cscr;"],[0,"&Dscr;"],[2,"&Gscr;"],[2,"&Jscr;"],[0,"&Kscr;"],[2,"&Nscr;"],[0,"&Oscr;"],[0,"&Pscr;"],[0,"&Qscr;"],[1,"&Sscr;"],[0,"&Tscr;"],[0,"&Uscr;"],[0,"&Vscr;"],[0,"&Wscr;"],[0,"&Xscr;"],[0,"&Yscr;"],[0,"&Zscr;"],[0,"&ascr;"],[0,"&bscr;"],[0,"&cscr;"],[0,"&dscr;"],[1,"&fscr;"],[1,"&hscr;"],[0,"&iscr;"],[0,"&jscr;"],[0,"&kscr;"],[0,"&lscr;"],[0,"&mscr;"],[0,"&nscr;"],[1,"&pscr;"],[0,"&qscr;"],[0,"&rscr;"],[0,"&sscr;"],[0,"&tscr;"],[0,"&uscr;"],[0,"&vscr;"],[0,"&wscr;"],[0,"&xscr;"],[0,"&yscr;"],[0,"&zscr;"],[52,"&Afr;"],[0,"&Bfr;"],[1,"&Dfr;"],[0,"&Efr;"],[0,"&Ffr;"],[0,"&Gfr;"],[2,"&Jfr;"],[0,"&Kfr;"],[0,"&Lfr;"],[0,"&Mfr;"],[0,"&Nfr;"],[0,"&Ofr;"],[0,"&Pfr;"],[0,"&Qfr;"],[1,"&Sfr;"],[0,"&Tfr;"],[0,"&Ufr;"],[0,"&Vfr;"],[0,"&Wfr;"],[0,"&Xfr;"],[0,"&Yfr;"],[1,"&afr;"],[0,"&bfr;"],[0,"&cfr;"],[0,"&dfr;"],[0,"&efr;"],[0,"&ffr;"],[0,"&gfr;"],[0,"&hfr;"],[0,"&ifr;"],[0,"&jfr;"],[0,"&kfr;"],[0,"&lfr;"],[0,"&mfr;"],[0,"&nfr;"],[0,"&ofr;"],[0,"&pfr;"],[0,"&qfr;"],[0,"&rfr;"],[0,"&sfr;"],[0,"&tfr;"],[0,"&ufr;"],[0,"&vfr;"],[0,"&wfr;"],[0,"&xfr;"],[0,"&yfr;"],[0,"&zfr;"],[0,"&Aopf;"],[0,"&Bopf;"],[1,"&Dopf;"],[0,"&Eopf;"],[0,"&Fopf;"],[0,"&Gopf;"],[1,"&Iopf;"],[0,"&Jopf;"],[0,"&Kopf;"],[0,"&Lopf;"],[0,"&Mopf;"],[1,"&Oopf;"],[3,"&Sopf;"],[0,"&Topf;"],[0,"&Uopf;"],[0,"&Vopf;"],[0,"&Wopf;"],[0,"&Xopf;"],[0,"&Yopf;"],[1,"&aopf;"],[0,"&bopf;"],[0,"&copf;"],[0,"&dopf;"],[0,"&eopf;"],[0,"&fopf;"],[0,"&gopf;"],[0,"&hopf;"],[0,"&iopf;"],[0,"&jopf;"],[0,"&kopf;"],[0,"&lopf;"],[0,"&mopf;"],[0,"&nopf;"],[0,"&oopf;"],[0,"&popf;"],[0,"&qopf;"],[0,"&ropf;"],[0,"&sopf;"],[0,"&topf;"],[0,"&uopf;"],[0,"&vopf;"],[0,"&wopf;"],[0,"&xopf;"],[0,"&yopf;"],[0,"&zopf;"]]))}],[8906,"&fflig;"],[0,"&filig;"],[0,"&fllig;"],[0,"&ffilig;"],[0,"&ffllig;"]]));var _escape={};(function(ie){Object.defineProperty(ie,"__esModule",{value:!0}),ie.escapeText=ie.escapeAttribute=ie.escapeUTF8=ie.escape=ie.encodeXML=ie.getCodePoint=ie.xmlReplacer=void 0,ie.xmlReplacer=/["&'<>$\x80-\uFFFF]/g;var Z=new Map([[34,"&quot;"],[38,"&amp;"],[39,"&apos;"],[60,"&lt;"],[62,"&gt;"]]);ie.getCodePoint=String.prototype.codePointAt!=null?function(ye,ve){return ye.codePointAt(ve)}:function(ye,ve){return(ye.charCodeAt(ve)&64512)===55296?(ye.charCodeAt(ve)-55296)*1024+ye.charCodeAt(ve+1)-56320+65536:ye.charCodeAt(ve)};function ee(ye){for(var ve="",be=0,Ye;(Ye=ie.xmlReplacer.exec(ye))!==null;){var Ke=Ye.index,Xe=ye.charCodeAt(Ke),Je=Z.get(Xe);Je!==void 0?(ve+=ye.substring(be,Ke)+Je,be=Ke+1):(ve+="".concat(ye.substring(be,Ke),"&#x").concat((0,ie.getCodePoint)(ye,Ke).toString(16),";"),be=ie.xmlReplacer.lastIndex+=+((Xe&64512)===55296))}return ve+ye.substr(be)}ie.encodeXML=ee,ie.escape=ee;function ae(ye,ve){return function(be){for(var Ye,Ke=0,Xe="";Ye=ye.exec(be);)Ke!==Ye.index&&(Xe+=be.substring(Ke,Ye.index)),Xe+=ve.get(Ye[0].charCodeAt(0)),Ke=Ye.index+1;return Xe+be.substring(Ke)}}ie.escapeUTF8=ae(/[&<>'"]/g,Z),ie.escapeAttribute=ae(/["&\u00A0]/g,new Map([[34,"&quot;"],[38,"&amp;"],[160,"&nbsp;"]])),ie.escapeText=ae(/[&<>\u00A0]/g,new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[160,"&nbsp;"]]))})(_escape);var __importDefault$1=commonjsGlobal&&commonjsGlobal.__importDefault||function(ie){return ie&&ie.__esModule?ie:{default:ie}};Object.defineProperty(encode,"__esModule",{value:!0});encode.encodeNonAsciiHTML=encode.encodeHTML=void 0;var encode_html_js_1=__importDefault$1(encodeHtml),escape_js_1=_escape,htmlReplacer=/[\t\n!-,./:-@[-`\f{-}$\x80-\uFFFF]/g;function encodeHTML(ie){return encodeHTMLTrieRe(htmlReplacer,ie)}encode.encodeHTML=encodeHTML;function encodeNonAsciiHTML(ie){return encodeHTMLTrieRe(escape_js_1.xmlReplacer,ie)}encode.encodeNonAsciiHTML=encodeNonAsciiHTML;function encodeHTMLTrieRe(ie,Z){for(var ee="",ae=0,ye;(ye=ie.exec(Z))!==null;){var ve=ye.index;ee+=Z.substring(ae,ve);var be=Z.charCodeAt(ve),Ye=encode_html_js_1.default.get(be);if(typeof Ye=="object"){if(ve+1<Z.length){var Ke=Z.charCodeAt(ve+1),Xe=typeof Ye.n=="number"?Ye.n===Ke?Ye.o:void 0:Ye.n.get(Ke);if(Xe!==void 0){ee+=Xe,ae=ie.lastIndex+=1;continue}}Ye=Ye.v}if(Ye!==void 0)ee+=Ye,ae=ve+1;else{var Je=(0,escape_js_1.getCodePoint)(Z,ve);ee+="&#x".concat(Je.toString(16),";"),ae=ie.lastIndex+=+(Je!==be)}}return ee+Z.substr(ae)}(function(ie){Object.defineProperty(ie,"__esModule",{value:!0}),ie.decodeXMLStrict=ie.decodeHTML5Strict=ie.decodeHTML4Strict=ie.decodeHTML5=ie.decodeHTML4=ie.decodeHTMLAttribute=ie.decodeHTMLStrict=ie.decodeHTML=ie.decodeXML=ie.DecodingMode=ie.EntityDecoder=ie.encodeHTML5=ie.encodeHTML4=ie.encodeNonAsciiHTML=ie.encodeHTML=ie.escapeText=ie.escapeAttribute=ie.escapeUTF8=ie.escape=ie.encodeXML=ie.encode=ie.decodeStrict=ie.decode=ie.EncodingMode=ie.EntityLevel=void 0;var Z=decode,ee=encode,ae=_escape,ye;(function(nt){nt[nt.XML=0]="XML",nt[nt.HTML=1]="HTML"})(ye=ie.EntityLevel||(ie.EntityLevel={}));var ve;(function(nt){nt[nt.UTF8=0]="UTF8",nt[nt.ASCII=1]="ASCII",nt[nt.Extensive=2]="Extensive",nt[nt.Attribute=3]="Attribute",nt[nt.Text=4]="Text"})(ve=ie.EncodingMode||(ie.EncodingMode={}));function be(nt,it){it===void 0&&(it=ye.XML);var lt=typeof it=="number"?it:it.level;if(lt===ye.HTML){var ct=typeof it=="object"?it.mode:void 0;return(0,Z.decodeHTML)(nt,ct)}return(0,Z.decodeXML)(nt)}ie.decode=be;function Ye(nt,it){var lt;it===void 0&&(it=ye.XML);var ct=typeof it=="number"?{level:it}:it;return(lt=ct.mode)!==null&&lt!==void 0||(ct.mode=Z.DecodingMode.Strict),be(nt,ct)}ie.decodeStrict=Ye;function Ke(nt,it){it===void 0&&(it=ye.XML);var lt=typeof it=="number"?{level:it}:it;return lt.mode===ve.UTF8?(0,ae.escapeUTF8)(nt):lt.mode===ve.Attribute?(0,ae.escapeAttribute)(nt):lt.mode===ve.Text?(0,ae.escapeText)(nt):lt.level===ye.HTML?lt.mode===ve.ASCII?(0,ee.encodeNonAsciiHTML)(nt):(0,ee.encodeHTML)(nt):(0,ae.encodeXML)(nt)}ie.encode=Ke;var Xe=_escape;Object.defineProperty(ie,"encodeXML",{enumerable:!0,get:function(){return Xe.encodeXML}}),Object.defineProperty(ie,"escape",{enumerable:!0,get:function(){return Xe.escape}}),Object.defineProperty(ie,"escapeUTF8",{enumerable:!0,get:function(){return Xe.escapeUTF8}}),Object.defineProperty(ie,"escapeAttribute",{enumerable:!0,get:function(){return Xe.escapeAttribute}}),Object.defineProperty(ie,"escapeText",{enumerable:!0,get:function(){return Xe.escapeText}});var Je=encode;Object.defineProperty(ie,"encodeHTML",{enumerable:!0,get:function(){return Je.encodeHTML}}),Object.defineProperty(ie,"encodeNonAsciiHTML",{enumerable:!0,get:function(){return Je.encodeNonAsciiHTML}}),Object.defineProperty(ie,"encodeHTML4",{enumerable:!0,get:function(){return Je.encodeHTML}}),Object.defineProperty(ie,"encodeHTML5",{enumerable:!0,get:function(){return Je.encodeHTML}});var rt=decode;Object.defineProperty(ie,"EntityDecoder",{enumerable:!0,get:function(){return rt.EntityDecoder}}),Object.defineProperty(ie,"DecodingMode",{enumerable:!0,get:function(){return rt.DecodingMode}}),Object.defineProperty(ie,"decodeXML",{enumerable:!0,get:function(){return rt.decodeXML}}),Object.defineProperty(ie,"decodeHTML",{enumerable:!0,get:function(){return rt.decodeHTML}}),Object.defineProperty(ie,"decodeHTMLStrict",{enumerable:!0,get:function(){return rt.decodeHTMLStrict}}),Object.defineProperty(ie,"decodeHTMLAttribute",{enumerable:!0,get:function(){return rt.decodeHTMLAttribute}}),Object.defineProperty(ie,"decodeHTML4",{enumerable:!0,get:function(){return rt.decodeHTML}}),Object.defineProperty(ie,"decodeHTML5",{enumerable:!0,get:function(){return rt.decodeHTML}}),Object.defineProperty(ie,"decodeHTML4Strict",{enumerable:!0,get:function(){return rt.decodeHTMLStrict}}),Object.defineProperty(ie,"decodeHTML5Strict",{enumerable:!0,get:function(){return rt.decodeHTMLStrict}}),Object.defineProperty(ie,"decodeXMLStrict",{enumerable:!0,get:function(){return rt.decodeXML}})})(lib);var foreignNames={};Object.defineProperty(foreignNames,"__esModule",{value:!0});foreignNames.attributeNames=foreignNames.elementNames=void 0;foreignNames.elementNames=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(function(ie){return[ie.toLowerCase(),ie]}));foreignNames.attributeNames=new Map(["definitionURL","attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(function(ie){return[ie.toLowerCase(),ie]}));var __assign$1=commonjsGlobal&&commonjsGlobal.__assign||function(){return __assign$1=Object.assign||function(ie){for(var Z,ee=1,ae=arguments.length;ee<ae;ee++){Z=arguments[ee];for(var ye in Z)Object.prototype.hasOwnProperty.call(Z,ye)&&(ie[ye]=Z[ye])}return ie},__assign$1.apply(this,arguments)},__createBinding=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(ie,Z,ee,ae){ae===void 0&&(ae=ee);var ye=Object.getOwnPropertyDescriptor(Z,ee);(!ye||("get"in ye?!Z.__esModule:ye.writable||ye.configurable))&&(ye={enumerable:!0,get:function(){return Z[ee]}}),Object.defineProperty(ie,ae,ye)}:function(ie,Z,ee,ae){ae===void 0&&(ae=ee),ie[ae]=Z[ee]}),__setModuleDefault=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(ie,Z){Object.defineProperty(ie,"default",{enumerable:!0,value:Z})}:function(ie,Z){ie.default=Z}),__importStar=commonjsGlobal&&commonjsGlobal.__importStar||function(ie){if(ie&&ie.__esModule)return ie;var Z={};if(ie!=null)for(var ee in ie)ee!=="default"&&Object.prototype.hasOwnProperty.call(ie,ee)&&__createBinding(Z,ie,ee);return __setModuleDefault(Z,ie),Z};Object.defineProperty(lib$1,"__esModule",{value:!0});lib$1.render=void 0;var ElementType=__importStar(lib$3),entities_1=lib,foreignNames_js_1=foreignNames,unencodedElements=new Set(["style","script","xmp","iframe","noembed","noframes","plaintext","noscript"]);function replaceQuotes(ie){return ie.replace(/"/g,"&quot;")}function formatAttributes(ie,Z){var ee;if(ie){var ae=((ee=Z.encodeEntities)!==null&&ee!==void 0?ee:Z.decodeEntities)===!1?replaceQuotes:Z.xmlMode||Z.encodeEntities!=="utf8"?entities_1.encodeXML:entities_1.escapeAttribute;return Object.keys(ie).map(function(ye){var ve,be,Ye=(ve=ie[ye])!==null&&ve!==void 0?ve:"";return Z.xmlMode==="foreign"&&(ye=(be=foreignNames_js_1.attributeNames.get(ye))!==null&&be!==void 0?be:ye),!Z.emptyAttrs&&!Z.xmlMode&&Ye===""?ye:"".concat(ye,'="').concat(ae(Ye),'"')}).join(" ")}}var singleTag=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]);function render(ie,Z){Z===void 0&&(Z={});for(var ee=("length"in ie)?ie:[ie],ae="",ye=0;ye<ee.length;ye++)ae+=renderNode(ee[ye],Z);return ae}lib$1.render=render;lib$1.default=render;function renderNode(ie,Z){switch(ie.type){case ElementType.Root:return render(ie.children,Z);case ElementType.Doctype:case ElementType.Directive:return renderDirective(ie);case ElementType.Comment:return renderComment(ie);case ElementType.CDATA:return renderCdata(ie);case ElementType.Script:case ElementType.Style:case ElementType.Tag:return renderTag(ie,Z);case ElementType.Text:return renderText(ie,Z)}}var foreignModeIntegrationPoints=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"]),foreignElements=new Set(["svg","math"]);function renderTag(ie,Z){var ee;Z.xmlMode==="foreign"&&(ie.name=(ee=foreignNames_js_1.elementNames.get(ie.name))!==null&&ee!==void 0?ee:ie.name,ie.parent&&foreignModeIntegrationPoints.has(ie.parent.name)&&(Z=__assign$1(__assign$1({},Z),{xmlMode:!1}))),!Z.xmlMode&&foreignElements.has(ie.name)&&(Z=__assign$1(__assign$1({},Z),{xmlMode:"foreign"}));var ae="<".concat(ie.name),ye=formatAttributes(ie.attribs,Z);return ye&&(ae+=" ".concat(ye)),ie.children.length===0&&(Z.xmlMode?Z.selfClosingTags!==!1:Z.selfClosingTags&&singleTag.has(ie.name))?(Z.xmlMode||(ae+=" "),ae+="/>"):(ae+=">",ie.children.length>0&&(ae+=render(ie.children,Z)),(Z.xmlMode||!singleTag.has(ie.name))&&(ae+="</".concat(ie.name,">"))),ae}function renderDirective(ie){return"<".concat(ie.data,">")}function renderText(ie,Z){var ee,ae=ie.data||"";return((ee=Z.encodeEntities)!==null&&ee!==void 0?ee:Z.decodeEntities)!==!1&&!(!Z.xmlMode&&ie.parent&&unencodedElements.has(ie.parent.name))&&(ae=Z.xmlMode||Z.encodeEntities!=="utf8"?(0,entities_1.encodeXML)(ae):(0,entities_1.escapeText)(ae)),ae}function renderCdata(ie){return"<![CDATA[".concat(ie.children[0].data,"]]>")}function renderComment(ie){return"<!--".concat(ie.data,"-->")}var __importDefault=commonjsGlobal&&commonjsGlobal.__importDefault||function(ie){return ie&&ie.__esModule?ie:{default:ie}};Object.defineProperty(stringify$5,"__esModule",{value:!0});stringify$5.innerText=stringify$5.textContent=stringify$5.getText=stringify$5.getInnerHTML=stringify$5.getOuterHTML=void 0;var domhandler_1$3=lib$4,dom_serializer_1=__importDefault(lib$1),domelementtype_1=lib$3;function getOuterHTML(ie,Z){return(0,dom_serializer_1.default)(ie,Z)}stringify$5.getOuterHTML=getOuterHTML;function getInnerHTML(ie,Z){return(0,domhandler_1$3.hasChildren)(ie)?ie.children.map(function(ee){return getOuterHTML(ee,Z)}).join(""):""}stringify$5.getInnerHTML=getInnerHTML;function getText(ie){return Array.isArray(ie)?ie.map(getText).join(""):(0,domhandler_1$3.isTag)(ie)?ie.name==="br"?`
`:getText(ie.children):(0,domhandler_1$3.isCDATA)(ie)?getText(ie.children):(0,domhandler_1$3.isText)(ie)?ie.data:""}stringify$5.getText=getText;function textContent(ie){return Array.isArray(ie)?ie.map(textContent).join(""):(0,domhandler_1$3.hasChildren)(ie)&&!(0,domhandler_1$3.isComment)(ie)?textContent(ie.children):(0,domhandler_1$3.isText)(ie)?ie.data:""}stringify$5.textContent=textContent;function innerText(ie){return Array.isArray(ie)?ie.map(innerText).join(""):(0,domhandler_1$3.hasChildren)(ie)&&(ie.type===domelementtype_1.ElementType.Tag||(0,domhandler_1$3.isCDATA)(ie))?innerText(ie.children):(0,domhandler_1$3.isText)(ie)?ie.data:""}stringify$5.innerText=innerText;var traversal={};Object.defineProperty(traversal,"__esModule",{value:!0});traversal.prevElementSibling=traversal.nextElementSibling=traversal.getName=traversal.hasAttrib=traversal.getAttributeValue=traversal.getSiblings=traversal.getParent=traversal.getChildren=void 0;var domhandler_1$2=lib$4;function getChildren(ie){return(0,domhandler_1$2.hasChildren)(ie)?ie.children:[]}traversal.getChildren=getChildren;function getParent(ie){return ie.parent||null}traversal.getParent=getParent;function getSiblings(ie){var Z,ee,ae=getParent(ie);if(ae!=null)return getChildren(ae);for(var ye=[ie],ve=ie.prev,be=ie.next;ve!=null;)ye.unshift(ve),Z=ve,ve=Z.prev;for(;be!=null;)ye.push(be),ee=be,be=ee.next;return ye}traversal.getSiblings=getSiblings;function getAttributeValue(ie,Z){var ee;return(ee=ie.attribs)===null||ee===void 0?void 0:ee[Z]}traversal.getAttributeValue=getAttributeValue;function hasAttrib(ie,Z){return ie.attribs!=null&&Object.prototype.hasOwnProperty.call(ie.attribs,Z)&&ie.attribs[Z]!=null}traversal.hasAttrib=hasAttrib;function getName(ie){return ie.name}traversal.getName=getName;function nextElementSibling(ie){for(var Z,ee=ie.next;ee!==null&&!(0,domhandler_1$2.isTag)(ee);)Z=ee,ee=Z.next;return ee}traversal.nextElementSibling=nextElementSibling;function prevElementSibling(ie){for(var Z,ee=ie.prev;ee!==null&&!(0,domhandler_1$2.isTag)(ee);)Z=ee,ee=Z.prev;return ee}traversal.prevElementSibling=prevElementSibling;var manipulation={};Object.defineProperty(manipulation,"__esModule",{value:!0});manipulation.prepend=manipulation.prependChild=manipulation.append=manipulation.appendChild=manipulation.replaceElement=manipulation.removeElement=void 0;function removeElement(ie){if(ie.prev&&(ie.prev.next=ie.next),ie.next&&(ie.next.prev=ie.prev),ie.parent){var Z=ie.parent.children,ee=Z.lastIndexOf(ie);ee>=0&&Z.splice(ee,1)}ie.next=null,ie.prev=null,ie.parent=null}manipulation.removeElement=removeElement;function replaceElement(ie,Z){var ee=Z.prev=ie.prev;ee&&(ee.next=Z);var ae=Z.next=ie.next;ae&&(ae.prev=Z);var ye=Z.parent=ie.parent;if(ye){var ve=ye.children;ve[ve.lastIndexOf(ie)]=Z,ie.parent=null}}manipulation.replaceElement=replaceElement;function appendChild(ie,Z){if(removeElement(Z),Z.next=null,Z.parent=ie,ie.children.push(Z)>1){var ee=ie.children[ie.children.length-2];ee.next=Z,Z.prev=ee}else Z.prev=null}manipulation.appendChild=appendChild;function append(ie,Z){removeElement(Z);var ee=ie.parent,ae=ie.next;if(Z.next=ae,Z.prev=ie,ie.next=Z,Z.parent=ee,ae){if(ae.prev=Z,ee){var ye=ee.children;ye.splice(ye.lastIndexOf(ae),0,Z)}}else ee&&ee.children.push(Z)}manipulation.append=append;function prependChild(ie,Z){if(removeElement(Z),Z.parent=ie,Z.prev=null,ie.children.unshift(Z)!==1){var ee=ie.children[1];ee.prev=Z,Z.next=ee}else Z.next=null}manipulation.prependChild=prependChild;function prepend(ie,Z){removeElement(Z);var ee=ie.parent;if(ee){var ae=ee.children;ae.splice(ae.indexOf(ie),0,Z)}ie.prev&&(ie.prev.next=Z),Z.parent=ee,Z.prev=ie.prev,Z.next=ie,ie.prev=Z}manipulation.prepend=prepend;var querying={};Object.defineProperty(querying,"__esModule",{value:!0});querying.findAll=querying.existsOne=querying.findOne=querying.findOneChild=querying.find=querying.filter=void 0;var domhandler_1$1=lib$4;function filter$1(ie,Z,ee,ae){return ee===void 0&&(ee=!0),ae===void 0&&(ae=1/0),find(ie,Array.isArray(Z)?Z:[Z],ee,ae)}querying.filter=filter$1;function find(ie,Z,ee,ae){for(var ye=[],ve=[Z],be=[0];;){if(be[0]>=ve[0].length){if(be.length===1)return ye;ve.shift(),be.shift();continue}var Ye=ve[0][be[0]++];if(ie(Ye)&&(ye.push(Ye),--ae<=0))return ye;ee&&(0,domhandler_1$1.hasChildren)(Ye)&&Ye.children.length>0&&(be.unshift(0),ve.unshift(Ye.children))}}querying.find=find;function findOneChild(ie,Z){return Z.find(ie)}querying.findOneChild=findOneChild;function findOne(ie,Z,ee){ee===void 0&&(ee=!0);for(var ae=null,ye=0;ye<Z.length&&!ae;ye++){var ve=Z[ye];if((0,domhandler_1$1.isTag)(ve))ie(ve)?ae=ve:ee&&ve.children.length>0&&(ae=findOne(ie,ve.children,!0));else continue}return ae}querying.findOne=findOne;function existsOne(ie,Z){return Z.some(function(ee){return(0,domhandler_1$1.isTag)(ee)&&(ie(ee)||existsOne(ie,ee.children))})}querying.existsOne=existsOne;function findAll(ie,Z){for(var ee=[],ae=[Z],ye=[0];;){if(ye[0]>=ae[0].length){if(ae.length===1)return ee;ae.shift(),ye.shift();continue}var ve=ae[0][ye[0]++];(0,domhandler_1$1.isTag)(ve)&&(ie(ve)&&ee.push(ve),ve.children.length>0&&(ye.unshift(0),ae.unshift(ve.children)))}}querying.findAll=findAll;var legacy={};Object.defineProperty(legacy,"__esModule",{value:!0});legacy.getElementsByTagType=legacy.getElementsByTagName=legacy.getElementById=legacy.getElements=legacy.testElement=void 0;var domhandler_1=lib$4,querying_js_1=querying,Checks={tag_name:function(ie){return typeof ie=="function"?function(Z){return(0,domhandler_1.isTag)(Z)&&ie(Z.name)}:ie==="*"?domhandler_1.isTag:function(Z){return(0,domhandler_1.isTag)(Z)&&Z.name===ie}},tag_type:function(ie){return typeof ie=="function"?function(Z){return ie(Z.type)}:function(Z){return Z.type===ie}},tag_contains:function(ie){return typeof ie=="function"?function(Z){return(0,domhandler_1.isText)(Z)&&ie(Z.data)}:function(Z){return(0,domhandler_1.isText)(Z)&&Z.data===ie}}};function getAttribCheck(ie,Z){return typeof Z=="function"?function(ee){return(0,domhandler_1.isTag)(ee)&&Z(ee.attribs[ie])}:function(ee){return(0,domhandler_1.isTag)(ee)&&ee.attribs[ie]===Z}}function combineFuncs(ie,Z){return function(ee){return ie(ee)||Z(ee)}}function compileTest(ie){var Z=Object.keys(ie).map(function(ee){var ae=ie[ee];return Object.prototype.hasOwnProperty.call(Checks,ee)?Checks[ee](ae):getAttribCheck(ee,ae)});return Z.length===0?null:Z.reduce(combineFuncs)}function testElement(ie,Z){var ee=compileTest(ie);return ee?ee(Z):!0}legacy.testElement=testElement;function getElements(ie,Z,ee,ae){ae===void 0&&(ae=1/0);var ye=compileTest(ie);return ye?(0,querying_js_1.filter)(ye,Z,ee,ae):[]}legacy.getElements=getElements;function getElementById(ie,Z,ee){return ee===void 0&&(ee=!0),Array.isArray(Z)||(Z=[Z]),(0,querying_js_1.findOne)(getAttribCheck("id",ie),Z,ee)}legacy.getElementById=getElementById;function getElementsByTagName(ie,Z,ee,ae){return ee===void 0&&(ee=!0),ae===void 0&&(ae=1/0),(0,querying_js_1.filter)(Checks.tag_name(ie),Z,ee,ae)}legacy.getElementsByTagName=getElementsByTagName;function getElementsByTagType(ie,Z,ee,ae){return ee===void 0&&(ee=!0),ae===void 0&&(ae=1/0),(0,querying_js_1.filter)(Checks.tag_type(ie),Z,ee,ae)}legacy.getElementsByTagType=getElementsByTagType;var helpers={};(function(ie){Object.defineProperty(ie,"__esModule",{value:!0}),ie.uniqueSort=ie.compareDocumentPosition=ie.DocumentPosition=ie.removeSubsets=void 0;var Z=lib$4;function ee(be){for(var Ye=be.length;--Ye>=0;){var Ke=be[Ye];if(Ye>0&&be.lastIndexOf(Ke,Ye-1)>=0){be.splice(Ye,1);continue}for(var Xe=Ke.parent;Xe;Xe=Xe.parent)if(be.includes(Xe)){be.splice(Ye,1);break}}return be}ie.removeSubsets=ee;var ae;(function(be){be[be.DISCONNECTED=1]="DISCONNECTED",be[be.PRECEDING=2]="PRECEDING",be[be.FOLLOWING=4]="FOLLOWING",be[be.CONTAINS=8]="CONTAINS",be[be.CONTAINED_BY=16]="CONTAINED_BY"})(ae=ie.DocumentPosition||(ie.DocumentPosition={}));function ye(be,Ye){var Ke=[],Xe=[];if(be===Ye)return 0;for(var Je=(0,Z.hasChildren)(be)?be:be.parent;Je;)Ke.unshift(Je),Je=Je.parent;for(Je=(0,Z.hasChildren)(Ye)?Ye:Ye.parent;Je;)Xe.unshift(Je),Je=Je.parent;for(var rt=Math.min(Ke.length,Xe.length),nt=0;nt<rt&&Ke[nt]===Xe[nt];)nt++;if(nt===0)return ae.DISCONNECTED;var it=Ke[nt-1],lt=it.children,ct=Ke[nt],ot=Xe[nt];return lt.indexOf(ct)>lt.indexOf(ot)?it===Ye?ae.FOLLOWING|ae.CONTAINED_BY:ae.FOLLOWING:it===be?ae.PRECEDING|ae.CONTAINS:ae.PRECEDING}ie.compareDocumentPosition=ye;function ve(be){return be=be.filter(function(Ye,Ke,Xe){return!Xe.includes(Ye,Ke+1)}),be.sort(function(Ye,Ke){var Xe=ye(Ye,Ke);return Xe&ae.PRECEDING?-1:Xe&ae.FOLLOWING?1:0}),be}ie.uniqueSort=ve})(helpers);var feeds={};Object.defineProperty(feeds,"__esModule",{value:!0});feeds.getFeed=void 0;var stringify_js_1=stringify$5,legacy_js_1=legacy;function getFeed(ie){var Z=getOneElement(isValidFeed,ie);return Z?Z.name==="feed"?getAtomFeed(Z):getRssFeed(Z):null}feeds.getFeed=getFeed;function getAtomFeed(ie){var Z,ee=ie.children,ae={type:"atom",items:(0,legacy_js_1.getElementsByTagName)("entry",ee).map(function(be){var Ye,Ke=be.children,Xe={media:getMediaElements(Ke)};addConditionally(Xe,"id","id",Ke),addConditionally(Xe,"title","title",Ke);var Je=(Ye=getOneElement("link",Ke))===null||Ye===void 0?void 0:Ye.attribs.href;Je&&(Xe.link=Je);var rt=fetch$1("summary",Ke)||fetch$1("content",Ke);rt&&(Xe.description=rt);var nt=fetch$1("updated",Ke);return nt&&(Xe.pubDate=new Date(nt)),Xe})};addConditionally(ae,"id","id",ee),addConditionally(ae,"title","title",ee);var ye=(Z=getOneElement("link",ee))===null||Z===void 0?void 0:Z.attribs.href;ye&&(ae.link=ye),addConditionally(ae,"description","subtitle",ee);var ve=fetch$1("updated",ee);return ve&&(ae.updated=new Date(ve)),addConditionally(ae,"author","email",ee,!0),ae}function getRssFeed(ie){var Z,ee,ae=(ee=(Z=getOneElement("channel",ie.children))===null||Z===void 0?void 0:Z.children)!==null&&ee!==void 0?ee:[],ye={type:ie.name.substr(0,3),id:"",items:(0,legacy_js_1.getElementsByTagName)("item",ie.children).map(function(be){var Ye=be.children,Ke={media:getMediaElements(Ye)};addConditionally(Ke,"id","guid",Ye),addConditionally(Ke,"title","title",Ye),addConditionally(Ke,"link","link",Ye),addConditionally(Ke,"description","description",Ye);var Xe=fetch$1("pubDate",Ye)||fetch$1("dc:date",Ye);return Xe&&(Ke.pubDate=new Date(Xe)),Ke})};addConditionally(ye,"title","title",ae),addConditionally(ye,"link","link",ae),addConditionally(ye,"description","description",ae);var ve=fetch$1("lastBuildDate",ae);return ve&&(ye.updated=new Date(ve)),addConditionally(ye,"author","managingEditor",ae,!0),ye}var MEDIA_KEYS_STRING=["url","type","lang"],MEDIA_KEYS_INT=["fileSize","bitrate","framerate","samplingrate","channels","duration","height","width"];function getMediaElements(ie){return(0,legacy_js_1.getElementsByTagName)("media:content",ie).map(function(Z){for(var ee=Z.attribs,ae={medium:ee.medium,isDefault:!!ee.isDefault},ye=0,ve=MEDIA_KEYS_STRING;ye<ve.length;ye++){var be=ve[ye];ee[be]&&(ae[be]=ee[be])}for(var Ye=0,Ke=MEDIA_KEYS_INT;Ye<Ke.length;Ye++){var be=Ke[Ye];ee[be]&&(ae[be]=parseInt(ee[be],10))}return ee.expression&&(ae.expression=ee.expression),ae})}function getOneElement(ie,Z){return(0,legacy_js_1.getElementsByTagName)(ie,Z,!0,1)[0]}function fetch$1(ie,Z,ee){return ee===void 0&&(ee=!1),(0,stringify_js_1.textContent)((0,legacy_js_1.getElementsByTagName)(ie,Z,ee,1)).trim()}function addConditionally(ie,Z,ee,ae,ye){ye===void 0&&(ye=!1);var ve=fetch$1(ee,ae,ye);ve&&(ie[Z]=ve)}function isValidFeed(ie){return ie==="rss"||ie==="feed"||ie==="rdf:RDF"}(function(ie){var Z=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(ye,ve,be,Ye){Ye===void 0&&(Ye=be);var Ke=Object.getOwnPropertyDescriptor(ve,be);(!Ke||("get"in Ke?!ve.__esModule:Ke.writable||Ke.configurable))&&(Ke={enumerable:!0,get:function(){return ve[be]}}),Object.defineProperty(ye,Ye,Ke)}:function(ye,ve,be,Ye){Ye===void 0&&(Ye=be),ye[Ye]=ve[be]}),ee=commonjsGlobal&&commonjsGlobal.__exportStar||function(ye,ve){for(var be in ye)be!=="default"&&!Object.prototype.hasOwnProperty.call(ve,be)&&Z(ve,ye,be)};Object.defineProperty(ie,"__esModule",{value:!0}),ie.hasChildren=ie.isDocument=ie.isComment=ie.isText=ie.isCDATA=ie.isTag=void 0,ee(stringify$5,ie),ee(traversal,ie),ee(manipulation,ie),ee(querying,ie),ee(legacy,ie),ee(helpers,ie),ee(feeds,ie);var ae=lib$4;Object.defineProperty(ie,"isTag",{enumerable:!0,get:function(){return ae.isTag}}),Object.defineProperty(ie,"isCDATA",{enumerable:!0,get:function(){return ae.isCDATA}}),Object.defineProperty(ie,"isText",{enumerable:!0,get:function(){return ae.isText}}),Object.defineProperty(ie,"isComment",{enumerable:!0,get:function(){return ae.isComment}}),Object.defineProperty(ie,"isDocument",{enumerable:!0,get:function(){return ae.isDocument}}),Object.defineProperty(ie,"hasChildren",{enumerable:!0,get:function(){return ae.hasChildren}})})(lib$2);(function(ie){var Z=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(dt,ft,gt,mt){mt===void 0&&(mt=gt);var Yr=Object.getOwnPropertyDescriptor(ft,gt);(!Yr||("get"in Yr?!ft.__esModule:Yr.writable||Yr.configurable))&&(Yr={enumerable:!0,get:function(){return ft[gt]}}),Object.defineProperty(dt,mt,Yr)}:function(dt,ft,gt,mt){mt===void 0&&(mt=gt),dt[mt]=ft[gt]}),ee=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(dt,ft){Object.defineProperty(dt,"default",{enumerable:!0,value:ft})}:function(dt,ft){dt.default=ft}),ae=commonjsGlobal&&commonjsGlobal.__importStar||function(dt){if(dt&&dt.__esModule)return dt;var ft={};if(dt!=null)for(var gt in dt)gt!=="default"&&Object.prototype.hasOwnProperty.call(dt,gt)&&Z(ft,dt,gt);return ee(ft,dt),ft},ye=commonjsGlobal&&commonjsGlobal.__importDefault||function(dt){return dt&&dt.__esModule?dt:{default:dt}};Object.defineProperty(ie,"__esModule",{value:!0}),ie.DomUtils=ie.parseFeed=ie.getFeed=ie.ElementType=ie.Tokenizer=ie.createDomStream=ie.parseDOM=ie.parseDocument=ie.DefaultHandler=ie.DomHandler=ie.Parser=void 0;var ve=Parser$3,be=Parser$3;Object.defineProperty(ie,"Parser",{enumerable:!0,get:function(){return be.Parser}});var Ye=lib$4,Ke=lib$4;Object.defineProperty(ie,"DomHandler",{enumerable:!0,get:function(){return Ke.DomHandler}}),Object.defineProperty(ie,"DefaultHandler",{enumerable:!0,get:function(){return Ke.DomHandler}});function Xe(dt,ft){var gt=new Ye.DomHandler(void 0,ft);return new ve.Parser(gt,ft).end(dt),gt.root}ie.parseDocument=Xe;function Je(dt,ft){return Xe(dt,ft).children}ie.parseDOM=Je;function rt(dt,ft,gt){var mt=new Ye.DomHandler(dt,ft,gt);return new ve.Parser(mt,ft)}ie.createDomStream=rt;var nt=Tokenizer;Object.defineProperty(ie,"Tokenizer",{enumerable:!0,get:function(){return ye(nt).default}}),ie.ElementType=ae(lib$3);var it=lib$2,lt=lib$2;Object.defineProperty(ie,"getFeed",{enumerable:!0,get:function(){return lt.getFeed}});var ct={xmlMode:!0};function ot(dt,ft){return ft===void 0&&(ft=ct),(0,it.getFeed)(Je(dt,ft))}ie.parseFeed=ot,ie.DomUtils=ae(lib$2)})(lib$5);var escapeStringRegexp$1=ie=>{if(typeof ie!="string")throw new TypeError("Expected a string");return ie.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")},isPlainObject$2={};Object.defineProperty(isPlainObject$2,"__esModule",{value:!0});/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */function isObject(ie){return Object.prototype.toString.call(ie)==="[object Object]"}function isPlainObject$1(ie){var Z,ee;return isObject(ie)===!1?!1:(Z=ie.constructor,Z===void 0?!0:(ee=Z.prototype,!(isObject(ee)===!1||ee.hasOwnProperty("isPrototypeOf")===!1)))}isPlainObject$2.isPlainObject=isPlainObject$1;var isMergeableObject=function(ie){return isNonNullObject(ie)&&!isSpecial(ie)};function isNonNullObject(ie){return!!ie&&typeof ie=="object"}function isSpecial(ie){var Z=Object.prototype.toString.call(ie);return Z==="[object RegExp]"||Z==="[object Date]"||isReactElement(ie)}var canUseSymbol=typeof Symbol=="function"&&Symbol.for,REACT_ELEMENT_TYPE=canUseSymbol?Symbol.for("react.element"):60103;function isReactElement(ie){return ie.$$typeof===REACT_ELEMENT_TYPE}function emptyTarget(ie){return Array.isArray(ie)?[]:{}}function cloneUnlessOtherwiseSpecified(ie,Z){return Z.clone!==!1&&Z.isMergeableObject(ie)?deepmerge$1(emptyTarget(ie),ie,Z):ie}function defaultArrayMerge(ie,Z,ee){return ie.concat(Z).map(function(ae){return cloneUnlessOtherwiseSpecified(ae,ee)})}function getMergeFunction(ie,Z){if(!Z.customMerge)return deepmerge$1;var ee=Z.customMerge(ie);return typeof ee=="function"?ee:deepmerge$1}function getEnumerableOwnPropertySymbols(ie){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(ie).filter(function(Z){return Object.propertyIsEnumerable.call(ie,Z)}):[]}function getKeys(ie){return Object.keys(ie).concat(getEnumerableOwnPropertySymbols(ie))}function propertyIsOnObject(ie,Z){try{return Z in ie}catch{return!1}}function propertyIsUnsafe(ie,Z){return propertyIsOnObject(ie,Z)&&!(Object.hasOwnProperty.call(ie,Z)&&Object.propertyIsEnumerable.call(ie,Z))}function mergeObject(ie,Z,ee){var ae={};return ee.isMergeableObject(ie)&&getKeys(ie).forEach(function(ye){ae[ye]=cloneUnlessOtherwiseSpecified(ie[ye],ee)}),getKeys(Z).forEach(function(ye){propertyIsUnsafe(ie,ye)||(propertyIsOnObject(ie,ye)&&ee.isMergeableObject(Z[ye])?ae[ye]=getMergeFunction(ye,ee)(ie[ye],Z[ye],ee):ae[ye]=cloneUnlessOtherwiseSpecified(Z[ye],ee))}),ae}function deepmerge$1(ie,Z,ee){ee=ee||{},ee.arrayMerge=ee.arrayMerge||defaultArrayMerge,ee.isMergeableObject=ee.isMergeableObject||isMergeableObject,ee.cloneUnlessOtherwiseSpecified=cloneUnlessOtherwiseSpecified;var ae=Array.isArray(Z),ye=Array.isArray(ie),ve=ae===ye;return ve?ae?ee.arrayMerge(ie,Z,ee):mergeObject(ie,Z,ee):cloneUnlessOtherwiseSpecified(Z,ee)}deepmerge$1.all=function(ie,Z){if(!Array.isArray(ie))throw new Error("first argument should be an array");return ie.reduce(function(ee,ae){return deepmerge$1(ee,ae,Z)},{})};var deepmerge_1=deepmerge$1,cjs=deepmerge_1,parseSrcset$1={exports:{}};(function(ie){(function(Z,ee){ie.exports?ie.exports=ee():Z.parseSrcset=ee()})(commonjsGlobal,function(){return function(Z){function ee(mt){return mt===" "||mt==="	"||mt===`
`||mt==="\f"||mt==="\r"}function ae(mt){var Yr,Qr=mt.exec(Z.substring(ot));if(Qr)return Yr=Qr[0],ot+=Yr.length,Yr}for(var ye=Z.length,ve=/^[ \t\n\r\u000c]+/,be=/^[, \t\n\r\u000c]+/,Ye=/^[^ \t\n\r\u000c]+/,Ke=/[,]+$/,Xe=/^\d+$/,Je=/^-?(?:[0-9]+|[0-9]*\.[0-9]+)(?:[eE][+-]?[0-9]+)?$/,rt,nt,it,lt,ct,ot=0,dt=[];;){if(ae(be),ot>=ye)return dt;rt=ae(Ye),nt=[],rt.slice(-1)===","?(rt=rt.replace(Ke,""),gt()):ft()}function ft(){for(ae(ve),it="",lt="in descriptor";;){if(ct=Z.charAt(ot),lt==="in descriptor")if(ee(ct))it&&(nt.push(it),it="",lt="after descriptor");else if(ct===","){ot+=1,it&&nt.push(it),gt();return}else if(ct==="(")it=it+ct,lt="in parens";else if(ct===""){it&&nt.push(it),gt();return}else it=it+ct;else if(lt==="in parens")if(ct===")")it=it+ct,lt="in descriptor";else if(ct===""){nt.push(it),gt();return}else it=it+ct;else if(lt==="after descriptor"&&!ee(ct))if(ct===""){gt();return}else lt="in descriptor",ot-=1;ot+=1}}function gt(){var mt=!1,Yr,Qr,Xr,Jr,ai={},oi,ni,li,ui,mi;for(Jr=0;Jr<nt.length;Jr++)oi=nt[Jr],ni=oi[oi.length-1],li=oi.substring(0,oi.length-1),ui=parseInt(li,10),mi=parseFloat(li),Xe.test(li)&&ni==="w"?((Yr||Qr)&&(mt=!0),ui===0?mt=!0:Yr=ui):Je.test(li)&&ni==="x"?((Yr||Qr||Xr)&&(mt=!0),mi<0?mt=!0:Qr=mi):Xe.test(li)&&ni==="h"?((Xr||Qr)&&(mt=!0),ui===0?mt=!0:Xr=ui):mt=!0;mt?console&&console.log&&console.log("Invalid srcset descriptor found in '"+Z+"' at '"+oi+"'."):(ai.url=rt,Yr&&(ai.w=Yr),Qr&&(ai.d=Qr),Xr&&(ai.h=Xr),dt.push(ai))}}})})(parseSrcset$1);var parseSrcsetExports=parseSrcset$1.exports,picocolors_browser={exports:{}},x=String,create=function(){return{isColorSupported:!1,reset:x,bold:x,dim:x,italic:x,underline:x,inverse:x,hidden:x,strikethrough:x,black:x,red:x,green:x,yellow:x,blue:x,magenta:x,cyan:x,white:x,gray:x,bgBlack:x,bgRed:x,bgGreen:x,bgYellow:x,bgBlue:x,bgMagenta:x,bgCyan:x,bgWhite:x}};picocolors_browser.exports=create();picocolors_browser.exports.createColors=create;var picocolors_browserExports=picocolors_browser.exports;const require$$2=getAugmentedNamespace(__viteBrowserExternal);let pico=picocolors_browserExports,terminalHighlight$1=require$$2,CssSyntaxError$3=class Xf extends Error{constructor(Z,ee,ae,ye,ve,be){super(Z),this.name="CssSyntaxError",this.reason=Z,ve&&(this.file=ve),ye&&(this.source=ye),be&&(this.plugin=be),typeof ee<"u"&&typeof ae<"u"&&(typeof ee=="number"?(this.line=ee,this.column=ae):(this.line=ee.line,this.column=ee.column,this.endLine=ae.line,this.endColumn=ae.column)),this.setMessage(),Error.captureStackTrace&&Error.captureStackTrace(this,Xf)}setMessage(){this.message=this.plugin?this.plugin+": ":"",this.message+=this.file?this.file:"<css input>",typeof this.line<"u"&&(this.message+=":"+this.line+":"+this.column),this.message+=": "+this.reason}showSourceCode(Z){if(!this.source)return"";let ee=this.source;Z==null&&(Z=pico.isColorSupported),terminalHighlight$1&&Z&&(ee=terminalHighlight$1(ee));let ae=ee.split(/\r?\n/),ye=Math.max(this.line-3,0),ve=Math.min(this.line+2,ae.length),be=String(ve).length,Ye,Ke;if(Z){let{bold:Xe,gray:Je,red:rt}=pico.createColors(!0);Ye=nt=>Xe(rt(nt)),Ke=nt=>Je(nt)}else Ye=Ke=Xe=>Xe;return ae.slice(ye,ve).map((Xe,Je)=>{let rt=ye+1+Je,nt=" "+(" "+rt).slice(-be)+" | ";if(rt===this.line){let it=Ke(nt.replace(/\d/g," "))+Xe.slice(0,this.column-1).replace(/[^\t]/g," ");return Ye(">")+Ke(nt)+Xe+`
 `+it+Ye("^")}return" "+Ke(nt)+Xe}).join(`
`)}toString(){let Z=this.showSourceCode();return Z&&(Z=`

`+Z+`
`),this.name+": "+this.message+Z}};var cssSyntaxError=CssSyntaxError$3;CssSyntaxError$3.default=CssSyntaxError$3;var symbols={};symbols.isClean=Symbol("isClean");symbols.my=Symbol("my");const DEFAULT_RAW={after:`
`,beforeClose:`
`,beforeComment:`
`,beforeDecl:`
`,beforeOpen:" ",beforeRule:`
`,colon:": ",commentLeft:" ",commentRight:" ",emptyBody:"",indent:"    ",semicolon:!1};function capitalize(ie){return ie[0].toUpperCase()+ie.slice(1)}let Stringifier$2=class{constructor(ie){this.builder=ie}atrule(ie,Z){let ee="@"+ie.name,ae=ie.params?this.rawValue(ie,"params"):"";if(typeof ie.raws.afterName<"u"?ee+=ie.raws.afterName:ae&&(ee+=" "),ie.nodes)this.block(ie,ee+ae);else{let ye=(ie.raws.between||"")+(Z?";":"");this.builder(ee+ae+ye,ie)}}beforeAfter(ie,Z){let ee;ie.type==="decl"?ee=this.raw(ie,null,"beforeDecl"):ie.type==="comment"?ee=this.raw(ie,null,"beforeComment"):Z==="before"?ee=this.raw(ie,null,"beforeRule"):ee=this.raw(ie,null,"beforeClose");let ae=ie.parent,ye=0;for(;ae&&ae.type!=="root";)ye+=1,ae=ae.parent;if(ee.includes(`
`)){let ve=this.raw(ie,null,"indent");if(ve.length)for(let be=0;be<ye;be++)ee+=ve}return ee}block(ie,Z){let ee=this.raw(ie,"between","beforeOpen");this.builder(Z+ee+"{",ie,"start");let ae;ie.nodes&&ie.nodes.length?(this.body(ie),ae=this.raw(ie,"after")):ae=this.raw(ie,"after","emptyBody"),ae&&this.builder(ae),this.builder("}",ie,"end")}body(ie){let Z=ie.nodes.length-1;for(;Z>0&&ie.nodes[Z].type==="comment";)Z-=1;let ee=this.raw(ie,"semicolon");for(let ae=0;ae<ie.nodes.length;ae++){let ye=ie.nodes[ae],ve=this.raw(ye,"before");ve&&this.builder(ve),this.stringify(ye,Z!==ae||ee)}}comment(ie){let Z=this.raw(ie,"left","commentLeft"),ee=this.raw(ie,"right","commentRight");this.builder("/*"+Z+ie.text+ee+"*/",ie)}decl(ie,Z){let ee=this.raw(ie,"between","colon"),ae=ie.prop+ee+this.rawValue(ie,"value");ie.important&&(ae+=ie.raws.important||" !important"),Z&&(ae+=";"),this.builder(ae,ie)}document(ie){this.body(ie)}raw(ie,Z,ee){let ae;if(ee||(ee=Z),Z&&(ae=ie.raws[Z],typeof ae<"u"))return ae;let ye=ie.parent;if(ee==="before"&&(!ye||ye.type==="root"&&ye.first===ie||ye&&ye.type==="document"))return"";if(!ye)return DEFAULT_RAW[ee];let ve=ie.root();if(ve.rawCache||(ve.rawCache={}),typeof ve.rawCache[ee]<"u")return ve.rawCache[ee];if(ee==="before"||ee==="after")return this.beforeAfter(ie,ee);{let be="raw"+capitalize(ee);this[be]?ae=this[be](ve,ie):ve.walk(Ye=>{if(ae=Ye.raws[Z],typeof ae<"u")return!1})}return typeof ae>"u"&&(ae=DEFAULT_RAW[ee]),ve.rawCache[ee]=ae,ae}rawBeforeClose(ie){let Z;return ie.walk(ee=>{if(ee.nodes&&ee.nodes.length>0&&typeof ee.raws.after<"u")return Z=ee.raws.after,Z.includes(`
`)&&(Z=Z.replace(/[^\n]+$/,"")),!1}),Z&&(Z=Z.replace(/\S/g,"")),Z}rawBeforeComment(ie,Z){let ee;return ie.walkComments(ae=>{if(typeof ae.raws.before<"u")return ee=ae.raws.before,ee.includes(`
`)&&(ee=ee.replace(/[^\n]+$/,"")),!1}),typeof ee>"u"?ee=this.raw(Z,null,"beforeDecl"):ee&&(ee=ee.replace(/\S/g,"")),ee}rawBeforeDecl(ie,Z){let ee;return ie.walkDecls(ae=>{if(typeof ae.raws.before<"u")return ee=ae.raws.before,ee.includes(`
`)&&(ee=ee.replace(/[^\n]+$/,"")),!1}),typeof ee>"u"?ee=this.raw(Z,null,"beforeRule"):ee&&(ee=ee.replace(/\S/g,"")),ee}rawBeforeOpen(ie){let Z;return ie.walk(ee=>{if(ee.type!=="decl"&&(Z=ee.raws.between,typeof Z<"u"))return!1}),Z}rawBeforeRule(ie){let Z;return ie.walk(ee=>{if(ee.nodes&&(ee.parent!==ie||ie.first!==ee)&&typeof ee.raws.before<"u")return Z=ee.raws.before,Z.includes(`
`)&&(Z=Z.replace(/[^\n]+$/,"")),!1}),Z&&(Z=Z.replace(/\S/g,"")),Z}rawColon(ie){let Z;return ie.walkDecls(ee=>{if(typeof ee.raws.between<"u")return Z=ee.raws.between.replace(/[^\s:]/g,""),!1}),Z}rawEmptyBody(ie){let Z;return ie.walk(ee=>{if(ee.nodes&&ee.nodes.length===0&&(Z=ee.raws.after,typeof Z<"u"))return!1}),Z}rawIndent(ie){if(ie.raws.indent)return ie.raws.indent;let Z;return ie.walk(ee=>{let ae=ee.parent;if(ae&&ae!==ie&&ae.parent&&ae.parent===ie&&typeof ee.raws.before<"u"){let ye=ee.raws.before.split(`
`);return Z=ye[ye.length-1],Z=Z.replace(/\S/g,""),!1}}),Z}rawSemicolon(ie){let Z;return ie.walk(ee=>{if(ee.nodes&&ee.nodes.length&&ee.last.type==="decl"&&(Z=ee.raws.semicolon,typeof Z<"u"))return!1}),Z}rawValue(ie,Z){let ee=ie[Z],ae=ie.raws[Z];return ae&&ae.value===ee?ae.raw:ee}root(ie){this.body(ie),ie.raws.after&&this.builder(ie.raws.after)}rule(ie){this.block(ie,this.rawValue(ie,"selector")),ie.raws.ownSemicolon&&this.builder(ie.raws.ownSemicolon,ie,"end")}stringify(ie,Z){if(!this[ie.type])throw new Error("Unknown AST node type "+ie.type+". Maybe you need to change PostCSS stringifier.");this[ie.type](ie,Z)}};var stringifier=Stringifier$2;Stringifier$2.default=Stringifier$2;let Stringifier$1=stringifier;function stringify$4(ie,Z){new Stringifier$1(Z).stringify(ie)}var stringify_1=stringify$4;stringify$4.default=stringify$4;let{isClean:isClean$2,my:my$2}=symbols,CssSyntaxError$2=cssSyntaxError,Stringifier=stringifier,stringify$3=stringify_1;function cloneNode(ie,Z){let ee=new ie.constructor;for(let ae in ie){if(!Object.prototype.hasOwnProperty.call(ie,ae)||ae==="proxyCache")continue;let ye=ie[ae],ve=typeof ye;ae==="parent"&&ve==="object"?Z&&(ee[ae]=Z):ae==="source"?ee[ae]=ye:Array.isArray(ye)?ee[ae]=ye.map(be=>cloneNode(be,ee)):(ve==="object"&&ye!==null&&(ye=cloneNode(ye)),ee[ae]=ye)}return ee}let Node$5=class{constructor(ie={}){this.raws={},this[isClean$2]=!1,this[my$2]=!0;for(let Z in ie)if(Z==="nodes"){this.nodes=[];for(let ee of ie[Z])typeof ee.clone=="function"?this.append(ee.clone()):this.append(ee)}else this[Z]=ie[Z]}addToError(ie){if(ie.postcssNode=this,ie.stack&&this.source&&/\n\s{4}at /.test(ie.stack)){let Z=this.source;ie.stack=ie.stack.replace(/\n\s{4}at /,`$&${Z.input.from}:${Z.start.line}:${Z.start.column}$&`)}return ie}after(ie){return this.parent.insertAfter(this,ie),this}assign(ie={}){for(let Z in ie)this[Z]=ie[Z];return this}before(ie){return this.parent.insertBefore(this,ie),this}cleanRaws(ie){delete this.raws.before,delete this.raws.after,ie||delete this.raws.between}clone(ie={}){let Z=cloneNode(this);for(let ee in ie)Z[ee]=ie[ee];return Z}cloneAfter(ie={}){let Z=this.clone(ie);return this.parent.insertAfter(this,Z),Z}cloneBefore(ie={}){let Z=this.clone(ie);return this.parent.insertBefore(this,Z),Z}error(ie,Z={}){if(this.source){let{end:ee,start:ae}=this.rangeBy(Z);return this.source.input.error(ie,{column:ae.column,line:ae.line},{column:ee.column,line:ee.line},Z)}return new CssSyntaxError$2(ie)}getProxyProcessor(){return{get(ie,Z){return Z==="proxyOf"?ie:Z==="root"?()=>ie.root().toProxy():ie[Z]},set(ie,Z,ee){return ie[Z]===ee||(ie[Z]=ee,(Z==="prop"||Z==="value"||Z==="name"||Z==="params"||Z==="important"||Z==="text")&&ie.markDirty()),!0}}}markDirty(){if(this[isClean$2]){this[isClean$2]=!1;let ie=this;for(;ie=ie.parent;)ie[isClean$2]=!1}}next(){if(!this.parent)return;let ie=this.parent.index(this);return this.parent.nodes[ie+1]}positionBy(ie,Z){let ee=this.source.start;if(ie.index)ee=this.positionInside(ie.index,Z);else if(ie.word){Z=this.toString();let ae=Z.indexOf(ie.word);ae!==-1&&(ee=this.positionInside(ae,Z))}return ee}positionInside(ie,Z){let ee=Z||this.toString(),ae=this.source.start.column,ye=this.source.start.line;for(let ve=0;ve<ie;ve++)ee[ve]===`
`?(ae=1,ye+=1):ae+=1;return{column:ae,line:ye}}prev(){if(!this.parent)return;let ie=this.parent.index(this);return this.parent.nodes[ie-1]}rangeBy(ie){let Z={column:this.source.start.column,line:this.source.start.line},ee=this.source.end?{column:this.source.end.column+1,line:this.source.end.line}:{column:Z.column+1,line:Z.line};if(ie.word){let ae=this.toString(),ye=ae.indexOf(ie.word);ye!==-1&&(Z=this.positionInside(ye,ae),ee=this.positionInside(ye+ie.word.length,ae))}else ie.start?Z={column:ie.start.column,line:ie.start.line}:ie.index&&(Z=this.positionInside(ie.index)),ie.end?ee={column:ie.end.column,line:ie.end.line}:ie.endIndex?ee=this.positionInside(ie.endIndex):ie.index&&(ee=this.positionInside(ie.index+1));return(ee.line<Z.line||ee.line===Z.line&&ee.column<=Z.column)&&(ee={column:Z.column+1,line:Z.line}),{end:ee,start:Z}}raw(ie,Z){return new Stringifier().raw(this,ie,Z)}remove(){return this.parent&&this.parent.removeChild(this),this.parent=void 0,this}replaceWith(...ie){if(this.parent){let Z=this,ee=!1;for(let ae of ie)ae===this?ee=!0:ee?(this.parent.insertAfter(Z,ae),Z=ae):this.parent.insertBefore(Z,ae);ee||this.remove()}return this}root(){let ie=this;for(;ie.parent&&ie.parent.type!=="document";)ie=ie.parent;return ie}toJSON(ie,Z){let ee={},ae=Z==null;Z=Z||new Map;let ye=0;for(let ve in this){if(!Object.prototype.hasOwnProperty.call(this,ve)||ve==="parent"||ve==="proxyCache")continue;let be=this[ve];if(Array.isArray(be))ee[ve]=be.map(Ye=>typeof Ye=="object"&&Ye.toJSON?Ye.toJSON(null,Z):Ye);else if(typeof be=="object"&&be.toJSON)ee[ve]=be.toJSON(null,Z);else if(ve==="source"){let Ye=Z.get(be.input);Ye==null&&(Ye=ye,Z.set(be.input,ye),ye++),ee[ve]={end:be.end,inputId:Ye,start:be.start}}else ee[ve]=be}return ae&&(ee.inputs=[...Z.keys()].map(ve=>ve.toJSON())),ee}toProxy(){return this.proxyCache||(this.proxyCache=new Proxy(this,this.getProxyProcessor())),this.proxyCache}toString(ie=stringify$3){ie.stringify&&(ie=ie.stringify);let Z="";return ie(this,ee=>{Z+=ee}),Z}warn(ie,Z,ee){let ae={node:this};for(let ye in ee)ae[ye]=ee[ye];return ie.warn(Z,ae)}get proxyOf(){return this}};var node=Node$5;Node$5.default=Node$5;let Node$4=node,Declaration$4=class extends Node$4{constructor(ie){ie&&typeof ie.value<"u"&&typeof ie.value!="string"&&(ie={...ie,value:String(ie.value)}),super(ie),this.type="decl"}get variable(){return this.prop.startsWith("--")||this.prop[0]==="$"}};var declaration=Declaration$4;Declaration$4.default=Declaration$4;let urlAlphabet="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",customAlphabet=(ie,Z=21)=>(ee=Z)=>{let ae="",ye=ee;for(;ye--;)ae+=ie[Math.random()*ie.length|0];return ae},nanoid$1=(ie=21)=>{let Z="",ee=ie;for(;ee--;)Z+=urlAlphabet[Math.random()*64|0];return Z};var nonSecure={nanoid:nanoid$1,customAlphabet};let{SourceMapConsumer:SourceMapConsumer$2,SourceMapGenerator:SourceMapGenerator$2}=require$$2,{existsSync,readFileSync}=require$$2,{dirname:dirname$1,join}=require$$2;function fromBase64(ie){return Buffer?Buffer.from(ie,"base64").toString():window.atob(ie)}let PreviousMap$2=class{constructor(ie,Z){if(Z.map===!1)return;this.loadAnnotation(ie),this.inline=this.startWith(this.annotation,"data:");let ee=Z.map?Z.map.prev:void 0,ae=this.loadMap(Z.from,ee);!this.mapFile&&Z.from&&(this.mapFile=Z.from),this.mapFile&&(this.root=dirname$1(this.mapFile)),ae&&(this.text=ae)}consumer(){return this.consumerCache||(this.consumerCache=new SourceMapConsumer$2(this.text)),this.consumerCache}decodeInline(ie){let Z=/^data:application\/json;charset=utf-?8;base64,/,ee=/^data:application\/json;base64,/,ae=/^data:application\/json;charset=utf-?8,/,ye=/^data:application\/json,/;if(ae.test(ie)||ye.test(ie))return decodeURIComponent(ie.substr(RegExp.lastMatch.length));if(Z.test(ie)||ee.test(ie))return fromBase64(ie.substr(RegExp.lastMatch.length));let ve=ie.match(/data:application\/json;([^,]+),/)[1];throw new Error("Unsupported source map encoding "+ve)}getAnnotationURL(ie){return ie.replace(/^\/\*\s*# sourceMappingURL=/,"").trim()}isMap(ie){return typeof ie!="object"?!1:typeof ie.mappings=="string"||typeof ie._mappings=="string"||Array.isArray(ie.sections)}loadAnnotation(ie){let Z=ie.match(/\/\*\s*# sourceMappingURL=/gm);if(!Z)return;let ee=ie.lastIndexOf(Z.pop()),ae=ie.indexOf("*/",ee);ee>-1&&ae>-1&&(this.annotation=this.getAnnotationURL(ie.substring(ee,ae)))}loadFile(ie){if(this.root=dirname$1(ie),existsSync(ie))return this.mapFile=ie,readFileSync(ie,"utf-8").toString().trim()}loadMap(ie,Z){if(Z===!1)return!1;if(Z){if(typeof Z=="string")return Z;if(typeof Z=="function"){let ee=Z(ie);if(ee){let ae=this.loadFile(ee);if(!ae)throw new Error("Unable to load previous source map: "+ee.toString());return ae}}else{if(Z instanceof SourceMapConsumer$2)return SourceMapGenerator$2.fromSourceMap(Z).toString();if(Z instanceof SourceMapGenerator$2)return Z.toString();if(this.isMap(Z))return JSON.stringify(Z);throw new Error("Unsupported previous source map format: "+Z.toString())}}else{if(this.inline)return this.decodeInline(this.annotation);if(this.annotation){let ee=this.annotation;return ie&&(ee=join(dirname$1(ie),ee)),this.loadFile(ee)}}}startWith(ie,Z){return ie?ie.substr(0,Z.length)===Z:!1}withContent(){return!!(this.consumer().sourcesContent&&this.consumer().sourcesContent.length>0)}};var previousMap=PreviousMap$2;PreviousMap$2.default=PreviousMap$2;let{SourceMapConsumer:SourceMapConsumer$1,SourceMapGenerator:SourceMapGenerator$1}=require$$2,{fileURLToPath,pathToFileURL:pathToFileURL$1}=require$$2,{isAbsolute,resolve:resolve$1}=require$$2,{nanoid}=nonSecure,terminalHighlight=require$$2,CssSyntaxError$1=cssSyntaxError,PreviousMap$1=previousMap,fromOffsetCache=Symbol("fromOffsetCache"),sourceMapAvailable$1=!!(SourceMapConsumer$1&&SourceMapGenerator$1),pathAvailable$1=!!(resolve$1&&isAbsolute),Input$4=class{constructor(ie,Z={}){if(ie===null||typeof ie>"u"||typeof ie=="object"&&!ie.toString)throw new Error(`PostCSS received ${ie} instead of CSS string`);if(this.css=ie.toString(),this.css[0]==="\uFEFF"||this.css[0]==="￾"?(this.hasBOM=!0,this.css=this.css.slice(1)):this.hasBOM=!1,Z.from&&(!pathAvailable$1||/^\w+:\/\//.test(Z.from)||isAbsolute(Z.from)?this.file=Z.from:this.file=resolve$1(Z.from)),pathAvailable$1&&sourceMapAvailable$1){let ee=new PreviousMap$1(this.css,Z);if(ee.text){this.map=ee;let ae=ee.consumer().file;!this.file&&ae&&(this.file=this.mapResolve(ae))}}this.file||(this.id="<input css "+nanoid(6)+">"),this.map&&(this.map.file=this.from)}error(ie,Z,ee,ae={}){let ye,ve,be;if(Z&&typeof Z=="object"){let Ke=Z,Xe=ee;if(typeof Ke.offset=="number"){let Je=this.fromOffset(Ke.offset);Z=Je.line,ee=Je.col}else Z=Ke.line,ee=Ke.column;if(typeof Xe.offset=="number"){let Je=this.fromOffset(Xe.offset);ve=Je.line,be=Je.col}else ve=Xe.line,be=Xe.column}else if(!ee){let Ke=this.fromOffset(Z);Z=Ke.line,ee=Ke.col}let Ye=this.origin(Z,ee,ve,be);return Ye?ye=new CssSyntaxError$1(ie,Ye.endLine===void 0?Ye.line:{column:Ye.column,line:Ye.line},Ye.endLine===void 0?Ye.column:{column:Ye.endColumn,line:Ye.endLine},Ye.source,Ye.file,ae.plugin):ye=new CssSyntaxError$1(ie,ve===void 0?Z:{column:ee,line:Z},ve===void 0?ee:{column:be,line:ve},this.css,this.file,ae.plugin),ye.input={column:ee,endColumn:be,endLine:ve,line:Z,source:this.css},this.file&&(pathToFileURL$1&&(ye.input.url=pathToFileURL$1(this.file).toString()),ye.input.file=this.file),ye}fromOffset(ie){let Z,ee;if(this[fromOffsetCache])ee=this[fromOffsetCache];else{let ye=this.css.split(`
`);ee=new Array(ye.length);let ve=0;for(let be=0,Ye=ye.length;be<Ye;be++)ee[be]=ve,ve+=ye[be].length+1;this[fromOffsetCache]=ee}Z=ee[ee.length-1];let ae=0;if(ie>=Z)ae=ee.length-1;else{let ye=ee.length-2,ve;for(;ae<ye;)if(ve=ae+(ye-ae>>1),ie<ee[ve])ye=ve-1;else if(ie>=ee[ve+1])ae=ve+1;else{ae=ve;break}}return{col:ie-ee[ae]+1,line:ae+1}}mapResolve(ie){return/^\w+:\/\//.test(ie)?ie:resolve$1(this.map.consumer().sourceRoot||this.map.root||".",ie)}origin(ie,Z,ee,ae){if(!this.map)return!1;let ye=this.map.consumer(),ve=ye.originalPositionFor({column:Z,line:ie});if(!ve.source)return!1;let be;typeof ee=="number"&&(be=ye.originalPositionFor({column:ae,line:ee}));let Ye;isAbsolute(ve.source)?Ye=pathToFileURL$1(ve.source):Ye=new URL(ve.source,this.map.consumer().sourceRoot||pathToFileURL$1(this.map.mapFile));let Ke={column:ve.column,endColumn:be&&be.column,endLine:be&&be.line,line:ve.line,url:Ye.toString()};if(Ye.protocol==="file:")if(fileURLToPath)Ke.file=fileURLToPath(Ye);else throw new Error("file: protocol is not available in this PostCSS build");let Xe=ye.sourceContentFor(ve.source);return Xe&&(Ke.source=Xe),Ke}toJSON(){let ie={};for(let Z of["hasBOM","css","file","id"])this[Z]!=null&&(ie[Z]=this[Z]);return this.map&&(ie.map={...this.map},ie.map.consumerCache&&(ie.map.consumerCache=void 0)),ie}get from(){return this.file||this.id}};var input=Input$4;Input$4.default=Input$4;terminalHighlight&&terminalHighlight.registerInput&&terminalHighlight.registerInput(Input$4);let{SourceMapConsumer,SourceMapGenerator}=require$$2,{dirname,relative,resolve,sep}=require$$2,{pathToFileURL}=require$$2,Input$3=input,sourceMapAvailable=!!(SourceMapConsumer&&SourceMapGenerator),pathAvailable=!!(dirname&&resolve&&relative&&sep),MapGenerator$2=class{constructor(ie,Z,ee,ae){this.stringify=ie,this.mapOpts=ee.map||{},this.root=Z,this.opts=ee,this.css=ae,this.originalCSS=ae,this.usesFileUrls=!this.mapOpts.from&&this.mapOpts.absolute,this.memoizedFileURLs=new Map,this.memoizedPaths=new Map,this.memoizedURLs=new Map}addAnnotation(){let ie;this.isInline()?ie="data:application/json;base64,"+this.toBase64(this.map.toString()):typeof this.mapOpts.annotation=="string"?ie=this.mapOpts.annotation:typeof this.mapOpts.annotation=="function"?ie=this.mapOpts.annotation(this.opts.to,this.root):ie=this.outputFile()+".map";let Z=`
`;this.css.includes(`\r
`)&&(Z=`\r
`),this.css+=Z+"/*# sourceMappingURL="+ie+" */"}applyPrevMaps(){for(let ie of this.previous()){let Z=this.toUrl(this.path(ie.file)),ee=ie.root||dirname(ie.file),ae;this.mapOpts.sourcesContent===!1?(ae=new SourceMapConsumer(ie.text),ae.sourcesContent&&(ae.sourcesContent=ae.sourcesContent.map(()=>null))):ae=ie.consumer(),this.map.applySourceMap(ae,Z,this.toUrl(this.path(ee)))}}clearAnnotation(){if(this.mapOpts.annotation!==!1)if(this.root){let ie;for(let Z=this.root.nodes.length-1;Z>=0;Z--)ie=this.root.nodes[Z],ie.type==="comment"&&ie.text.indexOf("# sourceMappingURL=")===0&&this.root.removeChild(Z)}else this.css&&(this.css=this.css.replace(/\n*?\/\*#[\S\s]*?\*\/$/gm,""))}generate(){if(this.clearAnnotation(),pathAvailable&&sourceMapAvailable&&this.isMap())return this.generateMap();{let ie="";return this.stringify(this.root,Z=>{ie+=Z}),[ie]}}generateMap(){if(this.root)this.generateString();else if(this.previous().length===1){let ie=this.previous()[0].consumer();ie.file=this.outputFile(),this.map=SourceMapGenerator.fromSourceMap(ie)}else this.map=new SourceMapGenerator({file:this.outputFile()}),this.map.addMapping({generated:{column:0,line:1},original:{column:0,line:1},source:this.opts.from?this.toUrl(this.path(this.opts.from)):"<no source>"});return this.isSourcesContent()&&this.setSourcesContent(),this.root&&this.previous().length>0&&this.applyPrevMaps(),this.isAnnotation()&&this.addAnnotation(),this.isInline()?[this.css]:[this.css,this.map]}generateString(){this.css="",this.map=new SourceMapGenerator({file:this.outputFile()});let ie=1,Z=1,ee="<no source>",ae={generated:{column:0,line:0},original:{column:0,line:0},source:""},ye,ve;this.stringify(this.root,(be,Ye,Ke)=>{if(this.css+=be,Ye&&Ke!=="end"&&(ae.generated.line=ie,ae.generated.column=Z-1,Ye.source&&Ye.source.start?(ae.source=this.sourcePath(Ye),ae.original.line=Ye.source.start.line,ae.original.column=Ye.source.start.column-1,this.map.addMapping(ae)):(ae.source=ee,ae.original.line=1,ae.original.column=0,this.map.addMapping(ae))),ye=be.match(/\n/g),ye?(ie+=ye.length,ve=be.lastIndexOf(`
`),Z=be.length-ve):Z+=be.length,Ye&&Ke!=="start"){let Xe=Ye.parent||{raws:{}};(!(Ye.type==="decl"||Ye.type==="atrule"&&!Ye.nodes)||Ye!==Xe.last||Xe.raws.semicolon)&&(Ye.source&&Ye.source.end?(ae.source=this.sourcePath(Ye),ae.original.line=Ye.source.end.line,ae.original.column=Ye.source.end.column-1,ae.generated.line=ie,ae.generated.column=Z-2,this.map.addMapping(ae)):(ae.source=ee,ae.original.line=1,ae.original.column=0,ae.generated.line=ie,ae.generated.column=Z-1,this.map.addMapping(ae)))}})}isAnnotation(){return this.isInline()?!0:typeof this.mapOpts.annotation<"u"?this.mapOpts.annotation:this.previous().length?this.previous().some(ie=>ie.annotation):!0}isInline(){if(typeof this.mapOpts.inline<"u")return this.mapOpts.inline;let ie=this.mapOpts.annotation;return typeof ie<"u"&&ie!==!0?!1:this.previous().length?this.previous().some(Z=>Z.inline):!0}isMap(){return typeof this.opts.map<"u"?!!this.opts.map:this.previous().length>0}isSourcesContent(){return typeof this.mapOpts.sourcesContent<"u"?this.mapOpts.sourcesContent:this.previous().length?this.previous().some(ie=>ie.withContent()):!0}outputFile(){return this.opts.to?this.path(this.opts.to):this.opts.from?this.path(this.opts.from):"to.css"}path(ie){if(this.mapOpts.absolute||ie.charCodeAt(0)===60||/^\w+:\/\//.test(ie))return ie;let Z=this.memoizedPaths.get(ie);if(Z)return Z;let ee=this.opts.to?dirname(this.opts.to):".";typeof this.mapOpts.annotation=="string"&&(ee=dirname(resolve(ee,this.mapOpts.annotation)));let ae=relative(ee,ie);return this.memoizedPaths.set(ie,ae),ae}previous(){if(!this.previousMaps)if(this.previousMaps=[],this.root)this.root.walk(ie=>{if(ie.source&&ie.source.input.map){let Z=ie.source.input.map;this.previousMaps.includes(Z)||this.previousMaps.push(Z)}});else{let ie=new Input$3(this.originalCSS,this.opts);ie.map&&this.previousMaps.push(ie.map)}return this.previousMaps}setSourcesContent(){let ie={};if(this.root)this.root.walk(Z=>{if(Z.source){let ee=Z.source.input.from;if(ee&&!ie[ee]){ie[ee]=!0;let ae=this.usesFileUrls?this.toFileUrl(ee):this.toUrl(this.path(ee));this.map.setSourceContent(ae,Z.source.input.css)}}});else if(this.css){let Z=this.opts.from?this.toUrl(this.path(this.opts.from)):"<no source>";this.map.setSourceContent(Z,this.css)}}sourcePath(ie){return this.mapOpts.from?this.toUrl(this.mapOpts.from):this.usesFileUrls?this.toFileUrl(ie.source.input.from):this.toUrl(this.path(ie.source.input.from))}toBase64(ie){return Buffer?Buffer.from(ie).toString("base64"):window.btoa(unescape(encodeURIComponent(ie)))}toFileUrl(ie){let Z=this.memoizedFileURLs.get(ie);if(Z)return Z;if(pathToFileURL){let ee=pathToFileURL(ie).toString();return this.memoizedFileURLs.set(ie,ee),ee}else throw new Error("`map.absolute` option is not available in this PostCSS build")}toUrl(ie){let Z=this.memoizedURLs.get(ie);if(Z)return Z;sep==="\\"&&(ie=ie.replace(/\\/g,"/"));let ee=encodeURI(ie).replace(/[#?]/g,encodeURIComponent);return this.memoizedURLs.set(ie,ee),ee}};var mapGenerator=MapGenerator$2;let Node$3=node,Comment$4=class extends Node$3{constructor(ie){super(ie),this.type="comment"}};var comment=Comment$4;Comment$4.default=Comment$4;let{isClean:isClean$1,my:my$1}=symbols,Declaration$3=declaration,Comment$3=comment,Node$2=node,parse$8,Rule$4,AtRule$4,Root$6;function cleanSource(ie){return ie.map(Z=>(Z.nodes&&(Z.nodes=cleanSource(Z.nodes)),delete Z.source,Z))}function markDirtyUp(ie){if(ie[isClean$1]=!1,ie.proxyOf.nodes)for(let Z of ie.proxyOf.nodes)markDirtyUp(Z)}let Container$7=class Qf extends Node$2{append(...Z){for(let ee of Z){let ae=this.normalize(ee,this.last);for(let ye of ae)this.proxyOf.nodes.push(ye)}return this.markDirty(),this}cleanRaws(Z){if(super.cleanRaws(Z),this.nodes)for(let ee of this.nodes)ee.cleanRaws(Z)}each(Z){if(!this.proxyOf.nodes)return;let ee=this.getIterator(),ae,ye;for(;this.indexes[ee]<this.proxyOf.nodes.length&&(ae=this.indexes[ee],ye=Z(this.proxyOf.nodes[ae],ae),ye!==!1);)this.indexes[ee]+=1;return delete this.indexes[ee],ye}every(Z){return this.nodes.every(Z)}getIterator(){this.lastEach||(this.lastEach=0),this.indexes||(this.indexes={}),this.lastEach+=1;let Z=this.lastEach;return this.indexes[Z]=0,Z}getProxyProcessor(){return{get(Z,ee){return ee==="proxyOf"?Z:Z[ee]?ee==="each"||typeof ee=="string"&&ee.startsWith("walk")?(...ae)=>Z[ee](...ae.map(ye=>typeof ye=="function"?(ve,be)=>ye(ve.toProxy(),be):ye)):ee==="every"||ee==="some"?ae=>Z[ee]((ye,...ve)=>ae(ye.toProxy(),...ve)):ee==="root"?()=>Z.root().toProxy():ee==="nodes"?Z.nodes.map(ae=>ae.toProxy()):ee==="first"||ee==="last"?Z[ee].toProxy():Z[ee]:Z[ee]},set(Z,ee,ae){return Z[ee]===ae||(Z[ee]=ae,(ee==="name"||ee==="params"||ee==="selector")&&Z.markDirty()),!0}}}index(Z){return typeof Z=="number"?Z:(Z.proxyOf&&(Z=Z.proxyOf),this.proxyOf.nodes.indexOf(Z))}insertAfter(Z,ee){let ae=this.index(Z),ye=this.normalize(ee,this.proxyOf.nodes[ae]).reverse();ae=this.index(Z);for(let be of ye)this.proxyOf.nodes.splice(ae+1,0,be);let ve;for(let be in this.indexes)ve=this.indexes[be],ae<ve&&(this.indexes[be]=ve+ye.length);return this.markDirty(),this}insertBefore(Z,ee){let ae=this.index(Z),ye=ae===0?"prepend":!1,ve=this.normalize(ee,this.proxyOf.nodes[ae],ye).reverse();ae=this.index(Z);for(let Ye of ve)this.proxyOf.nodes.splice(ae,0,Ye);let be;for(let Ye in this.indexes)be=this.indexes[Ye],ae<=be&&(this.indexes[Ye]=be+ve.length);return this.markDirty(),this}normalize(Z,ee){if(typeof Z=="string")Z=cleanSource(parse$8(Z).nodes);else if(Array.isArray(Z)){Z=Z.slice(0);for(let ae of Z)ae.parent&&ae.parent.removeChild(ae,"ignore")}else if(Z.type==="root"&&this.type!=="document"){Z=Z.nodes.slice(0);for(let ae of Z)ae.parent&&ae.parent.removeChild(ae,"ignore")}else if(Z.type)Z=[Z];else if(Z.prop){if(typeof Z.value>"u")throw new Error("Value field is missed in node creation");typeof Z.value!="string"&&(Z.value=String(Z.value)),Z=[new Declaration$3(Z)]}else if(Z.selector)Z=[new Rule$4(Z)];else if(Z.name)Z=[new AtRule$4(Z)];else if(Z.text)Z=[new Comment$3(Z)];else throw new Error("Unknown node type in node creation");return Z.map(ae=>(ae[my$1]||Qf.rebuild(ae),ae=ae.proxyOf,ae.parent&&ae.parent.removeChild(ae),ae[isClean$1]&&markDirtyUp(ae),typeof ae.raws.before>"u"&&ee&&typeof ee.raws.before<"u"&&(ae.raws.before=ee.raws.before.replace(/\S/g,"")),ae.parent=this.proxyOf,ae))}prepend(...Z){Z=Z.reverse();for(let ee of Z){let ae=this.normalize(ee,this.first,"prepend").reverse();for(let ye of ae)this.proxyOf.nodes.unshift(ye);for(let ye in this.indexes)this.indexes[ye]=this.indexes[ye]+ae.length}return this.markDirty(),this}push(Z){return Z.parent=this,this.proxyOf.nodes.push(Z),this}removeAll(){for(let Z of this.proxyOf.nodes)Z.parent=void 0;return this.proxyOf.nodes=[],this.markDirty(),this}removeChild(Z){Z=this.index(Z),this.proxyOf.nodes[Z].parent=void 0,this.proxyOf.nodes.splice(Z,1);let ee;for(let ae in this.indexes)ee=this.indexes[ae],ee>=Z&&(this.indexes[ae]=ee-1);return this.markDirty(),this}replaceValues(Z,ee,ae){return ae||(ae=ee,ee={}),this.walkDecls(ye=>{ee.props&&!ee.props.includes(ye.prop)||ee.fast&&!ye.value.includes(ee.fast)||(ye.value=ye.value.replace(Z,ae))}),this.markDirty(),this}some(Z){return this.nodes.some(Z)}walk(Z){return this.each((ee,ae)=>{let ye;try{ye=Z(ee,ae)}catch(ve){throw ee.addToError(ve)}return ye!==!1&&ee.walk&&(ye=ee.walk(Z)),ye})}walkAtRules(Z,ee){return ee?Z instanceof RegExp?this.walk((ae,ye)=>{if(ae.type==="atrule"&&Z.test(ae.name))return ee(ae,ye)}):this.walk((ae,ye)=>{if(ae.type==="atrule"&&ae.name===Z)return ee(ae,ye)}):(ee=Z,this.walk((ae,ye)=>{if(ae.type==="atrule")return ee(ae,ye)}))}walkComments(Z){return this.walk((ee,ae)=>{if(ee.type==="comment")return Z(ee,ae)})}walkDecls(Z,ee){return ee?Z instanceof RegExp?this.walk((ae,ye)=>{if(ae.type==="decl"&&Z.test(ae.prop))return ee(ae,ye)}):this.walk((ae,ye)=>{if(ae.type==="decl"&&ae.prop===Z)return ee(ae,ye)}):(ee=Z,this.walk((ae,ye)=>{if(ae.type==="decl")return ee(ae,ye)}))}walkRules(Z,ee){return ee?Z instanceof RegExp?this.walk((ae,ye)=>{if(ae.type==="rule"&&Z.test(ae.selector))return ee(ae,ye)}):this.walk((ae,ye)=>{if(ae.type==="rule"&&ae.selector===Z)return ee(ae,ye)}):(ee=Z,this.walk((ae,ye)=>{if(ae.type==="rule")return ee(ae,ye)}))}get first(){if(this.proxyOf.nodes)return this.proxyOf.nodes[0]}get last(){if(this.proxyOf.nodes)return this.proxyOf.nodes[this.proxyOf.nodes.length-1]}};Container$7.registerParse=ie=>{parse$8=ie};Container$7.registerRule=ie=>{Rule$4=ie};Container$7.registerAtRule=ie=>{AtRule$4=ie};Container$7.registerRoot=ie=>{Root$6=ie};var container=Container$7;Container$7.default=Container$7;Container$7.rebuild=ie=>{ie.type==="atrule"?Object.setPrototypeOf(ie,AtRule$4.prototype):ie.type==="rule"?Object.setPrototypeOf(ie,Rule$4.prototype):ie.type==="decl"?Object.setPrototypeOf(ie,Declaration$3.prototype):ie.type==="comment"?Object.setPrototypeOf(ie,Comment$3.prototype):ie.type==="root"&&Object.setPrototypeOf(ie,Root$6.prototype),ie[my$1]=!0,ie.nodes&&ie.nodes.forEach(Z=>{Container$7.rebuild(Z)})};let Container$6=container,LazyResult$4,Processor$3,Document$3=class extends Container$6{constructor(ie){super({type:"document",...ie}),this.nodes||(this.nodes=[])}toResult(ie={}){return new LazyResult$4(new Processor$3,this,ie).stringify()}};Document$3.registerLazyResult=ie=>{LazyResult$4=ie};Document$3.registerProcessor=ie=>{Processor$3=ie};var document$1=Document$3;Document$3.default=Document$3;let Warning$2=class{constructor(ie,Z={}){if(this.type="warning",this.text=ie,Z.node&&Z.node.source){let ee=Z.node.rangeBy(Z);this.line=ee.start.line,this.column=ee.start.column,this.endLine=ee.end.line,this.endColumn=ee.end.column}for(let ee in Z)this[ee]=Z[ee]}toString(){return this.node?this.node.error(this.text,{index:this.index,plugin:this.plugin,word:this.word}).message:this.plugin?this.plugin+": "+this.text:this.text}};var warning=Warning$2;Warning$2.default=Warning$2;let Warning$1=warning,Result$3=class{constructor(ie,Z,ee){this.processor=ie,this.messages=[],this.root=Z,this.opts=ee,this.css=void 0,this.map=void 0}toString(){return this.css}warn(ie,Z={}){Z.plugin||this.lastPlugin&&this.lastPlugin.postcssPlugin&&(Z.plugin=this.lastPlugin.postcssPlugin);let ee=new Warning$1(ie,Z);return this.messages.push(ee),ee}warnings(){return this.messages.filter(ie=>ie.type==="warning")}get content(){return this.css}};var result=Result$3;Result$3.default=Result$3;const SINGLE_QUOTE=39,DOUBLE_QUOTE=34,BACKSLASH=92,SLASH=47,NEWLINE=10,SPACE=32,FEED=12,TAB=9,CR=13,OPEN_SQUARE=91,CLOSE_SQUARE=93,OPEN_PARENTHESES=40,CLOSE_PARENTHESES=41,OPEN_CURLY=123,CLOSE_CURLY=125,SEMICOLON=59,ASTERISK=42,COLON=58,AT=64,RE_AT_END=/[\t\n\f\r "#'()/;[\\\]{}]/g,RE_WORD_END=/[\t\n\f\r !"#'():;@[\\\]{}]|\/(?=\*)/g,RE_BAD_BRACKET=/.[\r\n"'(/\\]/,RE_HEX_ESCAPE=/[\da-f]/i;var tokenize=function(ie,Z={}){let ee=ie.css.valueOf(),ae=Z.ignoreErrors,ye,ve,be,Ye,Ke,Xe,Je,rt,nt,it,lt=ee.length,ct=0,ot=[],dt=[];function ft(){return ct}function gt(Xr){throw ie.error("Unclosed "+Xr,ct)}function mt(){return dt.length===0&&ct>=lt}function Yr(Xr){if(dt.length)return dt.pop();if(ct>=lt)return;let Jr=Xr?Xr.ignoreUnclosed:!1;switch(ye=ee.charCodeAt(ct),ye){case NEWLINE:case SPACE:case TAB:case CR:case FEED:{ve=ct;do ve+=1,ye=ee.charCodeAt(ve);while(ye===SPACE||ye===NEWLINE||ye===TAB||ye===CR||ye===FEED);it=["space",ee.slice(ct,ve)],ct=ve-1;break}case OPEN_SQUARE:case CLOSE_SQUARE:case OPEN_CURLY:case CLOSE_CURLY:case COLON:case SEMICOLON:case CLOSE_PARENTHESES:{let ai=String.fromCharCode(ye);it=[ai,ai,ct];break}case OPEN_PARENTHESES:{if(rt=ot.length?ot.pop()[1]:"",nt=ee.charCodeAt(ct+1),rt==="url"&&nt!==SINGLE_QUOTE&&nt!==DOUBLE_QUOTE&&nt!==SPACE&&nt!==NEWLINE&&nt!==TAB&&nt!==FEED&&nt!==CR){ve=ct;do{if(Xe=!1,ve=ee.indexOf(")",ve+1),ve===-1)if(ae||Jr){ve=ct;break}else gt("bracket");for(Je=ve;ee.charCodeAt(Je-1)===BACKSLASH;)Je-=1,Xe=!Xe}while(Xe);it=["brackets",ee.slice(ct,ve+1),ct,ve],ct=ve}else ve=ee.indexOf(")",ct+1),Ye=ee.slice(ct,ve+1),ve===-1||RE_BAD_BRACKET.test(Ye)?it=["(","(",ct]:(it=["brackets",Ye,ct,ve],ct=ve);break}case SINGLE_QUOTE:case DOUBLE_QUOTE:{be=ye===SINGLE_QUOTE?"'":'"',ve=ct;do{if(Xe=!1,ve=ee.indexOf(be,ve+1),ve===-1)if(ae||Jr){ve=ct+1;break}else gt("string");for(Je=ve;ee.charCodeAt(Je-1)===BACKSLASH;)Je-=1,Xe=!Xe}while(Xe);it=["string",ee.slice(ct,ve+1),ct,ve],ct=ve;break}case AT:{RE_AT_END.lastIndex=ct+1,RE_AT_END.test(ee),RE_AT_END.lastIndex===0?ve=ee.length-1:ve=RE_AT_END.lastIndex-2,it=["at-word",ee.slice(ct,ve+1),ct,ve],ct=ve;break}case BACKSLASH:{for(ve=ct,Ke=!0;ee.charCodeAt(ve+1)===BACKSLASH;)ve+=1,Ke=!Ke;if(ye=ee.charCodeAt(ve+1),Ke&&ye!==SLASH&&ye!==SPACE&&ye!==NEWLINE&&ye!==TAB&&ye!==CR&&ye!==FEED&&(ve+=1,RE_HEX_ESCAPE.test(ee.charAt(ve)))){for(;RE_HEX_ESCAPE.test(ee.charAt(ve+1));)ve+=1;ee.charCodeAt(ve+1)===SPACE&&(ve+=1)}it=["word",ee.slice(ct,ve+1),ct,ve],ct=ve;break}default:{ye===SLASH&&ee.charCodeAt(ct+1)===ASTERISK?(ve=ee.indexOf("*/",ct+2)+1,ve===0&&(ae||Jr?ve=ee.length:gt("comment")),it=["comment",ee.slice(ct,ve+1),ct,ve],ct=ve):(RE_WORD_END.lastIndex=ct+1,RE_WORD_END.test(ee),RE_WORD_END.lastIndex===0?ve=ee.length-1:ve=RE_WORD_END.lastIndex-2,it=["word",ee.slice(ct,ve+1),ct,ve],ot.push(it),ct=ve);break}}return ct++,it}function Qr(Xr){dt.push(Xr)}return{back:Qr,endOfFile:mt,nextToken:Yr,position:ft}};let Container$5=container,AtRule$3=class extends Container$5{constructor(ie){super(ie),this.type="atrule"}append(...ie){return this.proxyOf.nodes||(this.nodes=[]),super.append(...ie)}prepend(...ie){return this.proxyOf.nodes||(this.nodes=[]),super.prepend(...ie)}};var atRule=AtRule$3;AtRule$3.default=AtRule$3;Container$5.registerAtRule(AtRule$3);let Container$4=container,LazyResult$3,Processor$2,Root$5=class extends Container$4{constructor(ie){super(ie),this.type="root",this.nodes||(this.nodes=[])}normalize(ie,Z,ee){let ae=super.normalize(ie);if(Z){if(ee==="prepend")this.nodes.length>1?Z.raws.before=this.nodes[1].raws.before:delete Z.raws.before;else if(this.first!==Z)for(let ye of ae)ye.raws.before=Z.raws.before}return ae}removeChild(ie,Z){let ee=this.index(ie);return!Z&&ee===0&&this.nodes.length>1&&(this.nodes[1].raws.before=this.nodes[ee].raws.before),super.removeChild(ie)}toResult(ie={}){return new LazyResult$3(new Processor$2,this,ie).stringify()}};Root$5.registerLazyResult=ie=>{LazyResult$3=ie};Root$5.registerProcessor=ie=>{Processor$2=ie};var root=Root$5;Root$5.default=Root$5;Container$4.registerRoot(Root$5);let list$2={comma(ie){return list$2.split(ie,[","],!0)},space(ie){let Z=[" ",`
`,"	"];return list$2.split(ie,Z)},split(ie,Z,ee){let ae=[],ye="",ve=!1,be=0,Ye=!1,Ke="",Xe=!1;for(let Je of ie)Xe?Xe=!1:Je==="\\"?Xe=!0:Ye?Je===Ke&&(Ye=!1):Je==='"'||Je==="'"?(Ye=!0,Ke=Je):Je==="("?be+=1:Je===")"?be>0&&(be-=1):be===0&&Z.includes(Je)&&(ve=!0),ve?(ye!==""&&ae.push(ye.trim()),ye="",ve=!1):ye+=Je;return(ee||ye!=="")&&ae.push(ye.trim()),ae}};var list_1=list$2;list$2.default=list$2;let Container$3=container,list$1=list_1,Rule$3=class extends Container$3{constructor(ie){super(ie),this.type="rule",this.nodes||(this.nodes=[])}get selectors(){return list$1.comma(this.selector)}set selectors(ie){let Z=this.selector?this.selector.match(/,\s*/):null,ee=Z?Z[0]:","+this.raw("between","beforeOpen");this.selector=ie.join(ee)}};var rule=Rule$3;Rule$3.default=Rule$3;Container$3.registerRule(Rule$3);let Declaration$2=declaration,tokenizer=tokenize,Comment$2=comment,AtRule$2=atRule,Root$4=root,Rule$2=rule;const SAFE_COMMENT_NEIGHBOR={empty:!0,space:!0};function findLastWithPosition(ie){for(let Z=ie.length-1;Z>=0;Z--){let ee=ie[Z],ae=ee[3]||ee[2];if(ae)return ae}}let Parser$1=class{constructor(ie){this.input=ie,this.root=new Root$4,this.current=this.root,this.spaces="",this.semicolon=!1,this.customProperty=!1,this.createTokenizer(),this.root.source={input:ie,start:{column:1,line:1,offset:0}}}atrule(ie){let Z=new AtRule$2;Z.name=ie[1].slice(1),Z.name===""&&this.unnamedAtrule(Z,ie),this.init(Z,ie[2]);let ee,ae,ye,ve=!1,be=!1,Ye=[],Ke=[];for(;!this.tokenizer.endOfFile();){if(ie=this.tokenizer.nextToken(),ee=ie[0],ee==="("||ee==="["?Ke.push(ee==="("?")":"]"):ee==="{"&&Ke.length>0?Ke.push("}"):ee===Ke[Ke.length-1]&&Ke.pop(),Ke.length===0)if(ee===";"){Z.source.end=this.getPosition(ie[2]),Z.source.end.offset++,this.semicolon=!0;break}else if(ee==="{"){be=!0;break}else if(ee==="}"){if(Ye.length>0){for(ye=Ye.length-1,ae=Ye[ye];ae&&ae[0]==="space";)ae=Ye[--ye];ae&&(Z.source.end=this.getPosition(ae[3]||ae[2]),Z.source.end.offset++)}this.end(ie);break}else Ye.push(ie);else Ye.push(ie);if(this.tokenizer.endOfFile()){ve=!0;break}}Z.raws.between=this.spacesAndCommentsFromEnd(Ye),Ye.length?(Z.raws.afterName=this.spacesAndCommentsFromStart(Ye),this.raw(Z,"params",Ye),ve&&(ie=Ye[Ye.length-1],Z.source.end=this.getPosition(ie[3]||ie[2]),Z.source.end.offset++,this.spaces=Z.raws.between,Z.raws.between="")):(Z.raws.afterName="",Z.params=""),be&&(Z.nodes=[],this.current=Z)}checkMissedSemicolon(ie){let Z=this.colon(ie);if(Z===!1)return;let ee=0,ae;for(let ye=Z-1;ye>=0&&(ae=ie[ye],!(ae[0]!=="space"&&(ee+=1,ee===2)));ye--);throw this.input.error("Missed semicolon",ae[0]==="word"?ae[3]+1:ae[2])}colon(ie){let Z=0,ee,ae,ye;for(let[ve,be]of ie.entries()){if(ee=be,ae=ee[0],ae==="("&&(Z+=1),ae===")"&&(Z-=1),Z===0&&ae===":")if(!ye)this.doubleColon(ee);else{if(ye[0]==="word"&&ye[1]==="progid")continue;return ve}ye=ee}return!1}comment(ie){let Z=new Comment$2;this.init(Z,ie[2]),Z.source.end=this.getPosition(ie[3]||ie[2]),Z.source.end.offset++;let ee=ie[1].slice(2,-2);if(/^\s*$/.test(ee))Z.text="",Z.raws.left=ee,Z.raws.right="";else{let ae=ee.match(/^(\s*)([^]*\S)(\s*)$/);Z.text=ae[2],Z.raws.left=ae[1],Z.raws.right=ae[3]}}createTokenizer(){this.tokenizer=tokenizer(this.input)}decl(ie,Z){let ee=new Declaration$2;this.init(ee,ie[0][2]);let ae=ie[ie.length-1];for(ae[0]===";"&&(this.semicolon=!0,ie.pop()),ee.source.end=this.getPosition(ae[3]||ae[2]||findLastWithPosition(ie)),ee.source.end.offset++;ie[0][0]!=="word";)ie.length===1&&this.unknownWord(ie),ee.raws.before+=ie.shift()[1];for(ee.source.start=this.getPosition(ie[0][2]),ee.prop="";ie.length;){let Ye=ie[0][0];if(Ye===":"||Ye==="space"||Ye==="comment")break;ee.prop+=ie.shift()[1]}ee.raws.between="";let ye;for(;ie.length;)if(ye=ie.shift(),ye[0]===":"){ee.raws.between+=ye[1];break}else ye[0]==="word"&&/\w/.test(ye[1])&&this.unknownWord([ye]),ee.raws.between+=ye[1];(ee.prop[0]==="_"||ee.prop[0]==="*")&&(ee.raws.before+=ee.prop[0],ee.prop=ee.prop.slice(1));let ve=[],be;for(;ie.length&&(be=ie[0][0],!(be!=="space"&&be!=="comment"));)ve.push(ie.shift());this.precheckMissedSemicolon(ie);for(let Ye=ie.length-1;Ye>=0;Ye--){if(ye=ie[Ye],ye[1].toLowerCase()==="!important"){ee.important=!0;let Ke=this.stringFrom(ie,Ye);Ke=this.spacesFromEnd(ie)+Ke,Ke!==" !important"&&(ee.raws.important=Ke);break}else if(ye[1].toLowerCase()==="important"){let Ke=ie.slice(0),Xe="";for(let Je=Ye;Je>0;Je--){let rt=Ke[Je][0];if(Xe.trim().indexOf("!")===0&&rt!=="space")break;Xe=Ke.pop()[1]+Xe}Xe.trim().indexOf("!")===0&&(ee.important=!0,ee.raws.important=Xe,ie=Ke)}if(ye[0]!=="space"&&ye[0]!=="comment")break}ie.some(Ye=>Ye[0]!=="space"&&Ye[0]!=="comment")&&(ee.raws.between+=ve.map(Ye=>Ye[1]).join(""),ve=[]),this.raw(ee,"value",ve.concat(ie),Z),ee.value.includes(":")&&!Z&&this.checkMissedSemicolon(ie)}doubleColon(ie){throw this.input.error("Double colon",{offset:ie[2]},{offset:ie[2]+ie[1].length})}emptyRule(ie){let Z=new Rule$2;this.init(Z,ie[2]),Z.selector="",Z.raws.between="",this.current=Z}end(ie){this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.semicolon=!1,this.current.raws.after=(this.current.raws.after||"")+this.spaces,this.spaces="",this.current.parent?(this.current.source.end=this.getPosition(ie[2]),this.current.source.end.offset++,this.current=this.current.parent):this.unexpectedClose(ie)}endFile(){this.current.parent&&this.unclosedBlock(),this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.current.raws.after=(this.current.raws.after||"")+this.spaces,this.root.source.end=this.getPosition(this.tokenizer.position())}freeSemicolon(ie){if(this.spaces+=ie[1],this.current.nodes){let Z=this.current.nodes[this.current.nodes.length-1];Z&&Z.type==="rule"&&!Z.raws.ownSemicolon&&(Z.raws.ownSemicolon=this.spaces,this.spaces="")}}getPosition(ie){let Z=this.input.fromOffset(ie);return{column:Z.col,line:Z.line,offset:ie}}init(ie,Z){this.current.push(ie),ie.source={input:this.input,start:this.getPosition(Z)},ie.raws.before=this.spaces,this.spaces="",ie.type!=="comment"&&(this.semicolon=!1)}other(ie){let Z=!1,ee=null,ae=!1,ye=null,ve=[],be=ie[1].startsWith("--"),Ye=[],Ke=ie;for(;Ke;){if(ee=Ke[0],Ye.push(Ke),ee==="("||ee==="[")ye||(ye=Ke),ve.push(ee==="("?")":"]");else if(be&&ae&&ee==="{")ye||(ye=Ke),ve.push("}");else if(ve.length===0)if(ee===";")if(ae){this.decl(Ye,be);return}else break;else if(ee==="{"){this.rule(Ye);return}else if(ee==="}"){this.tokenizer.back(Ye.pop()),Z=!0;break}else ee===":"&&(ae=!0);else ee===ve[ve.length-1]&&(ve.pop(),ve.length===0&&(ye=null));Ke=this.tokenizer.nextToken()}if(this.tokenizer.endOfFile()&&(Z=!0),ve.length>0&&this.unclosedBracket(ye),Z&&ae){if(!be)for(;Ye.length&&(Ke=Ye[Ye.length-1][0],!(Ke!=="space"&&Ke!=="comment"));)this.tokenizer.back(Ye.pop());this.decl(Ye,be)}else this.unknownWord(Ye)}parse(){let ie;for(;!this.tokenizer.endOfFile();)switch(ie=this.tokenizer.nextToken(),ie[0]){case"space":this.spaces+=ie[1];break;case";":this.freeSemicolon(ie);break;case"}":this.end(ie);break;case"comment":this.comment(ie);break;case"at-word":this.atrule(ie);break;case"{":this.emptyRule(ie);break;default:this.other(ie);break}this.endFile()}precheckMissedSemicolon(){}raw(ie,Z,ee,ae){let ye,ve,be=ee.length,Ye="",Ke=!0,Xe,Je;for(let rt=0;rt<be;rt+=1)ye=ee[rt],ve=ye[0],ve==="space"&&rt===be-1&&!ae?Ke=!1:ve==="comment"?(Je=ee[rt-1]?ee[rt-1][0]:"empty",Xe=ee[rt+1]?ee[rt+1][0]:"empty",!SAFE_COMMENT_NEIGHBOR[Je]&&!SAFE_COMMENT_NEIGHBOR[Xe]?Ye.slice(-1)===","?Ke=!1:Ye+=ye[1]:Ke=!1):Ye+=ye[1];if(!Ke){let rt=ee.reduce((nt,it)=>nt+it[1],"");ie.raws[Z]={raw:rt,value:Ye}}ie[Z]=Ye}rule(ie){ie.pop();let Z=new Rule$2;this.init(Z,ie[0][2]),Z.raws.between=this.spacesAndCommentsFromEnd(ie),this.raw(Z,"selector",ie),this.current=Z}spacesAndCommentsFromEnd(ie){let Z,ee="";for(;ie.length&&(Z=ie[ie.length-1][0],!(Z!=="space"&&Z!=="comment"));)ee=ie.pop()[1]+ee;return ee}spacesAndCommentsFromStart(ie){let Z,ee="";for(;ie.length&&(Z=ie[0][0],!(Z!=="space"&&Z!=="comment"));)ee+=ie.shift()[1];return ee}spacesFromEnd(ie){let Z,ee="";for(;ie.length&&(Z=ie[ie.length-1][0],Z==="space");)ee=ie.pop()[1]+ee;return ee}stringFrom(ie,Z){let ee="";for(let ae=Z;ae<ie.length;ae++)ee+=ie[ae][1];return ie.splice(Z,ie.length-Z),ee}unclosedBlock(){let ie=this.current.source.start;throw this.input.error("Unclosed block",ie.line,ie.column)}unclosedBracket(ie){throw this.input.error("Unclosed bracket",{offset:ie[2]},{offset:ie[2]+1})}unexpectedClose(ie){throw this.input.error("Unexpected }",{offset:ie[2]},{offset:ie[2]+1})}unknownWord(ie){throw this.input.error("Unknown word",{offset:ie[0][2]},{offset:ie[0][2]+ie[0][1].length})}unnamedAtrule(ie,Z){throw this.input.error("At-rule without name",{offset:Z[2]},{offset:Z[2]+Z[1].length})}};var parser$1=Parser$1;let Container$2=container,Parser=parser$1,Input$2=input;function parse$7(ie,Z){let ee=new Input$2(ie,Z),ae=new Parser(ee);try{ae.parse()}catch(ye){throw ye}return ae.root}var parse_1=parse$7;parse$7.default=parse$7;Container$2.registerParse(parse$7);let{isClean,my}=symbols,MapGenerator$1=mapGenerator,stringify$2=stringify_1,Container$1=container,Document$2=document$1,Result$2=result,parse$6=parse_1,Root$3=root;const TYPE_TO_CLASS_NAME={atrule:"AtRule",comment:"Comment",decl:"Declaration",document:"Document",root:"Root",rule:"Rule"},PLUGIN_PROPS={AtRule:!0,AtRuleExit:!0,Comment:!0,CommentExit:!0,Declaration:!0,DeclarationExit:!0,Document:!0,DocumentExit:!0,Once:!0,OnceExit:!0,postcssPlugin:!0,prepare:!0,Root:!0,RootExit:!0,Rule:!0,RuleExit:!0},NOT_VISITORS={Once:!0,postcssPlugin:!0,prepare:!0},CHILDREN=0;function isPromise$1(ie){return typeof ie=="object"&&typeof ie.then=="function"}function getEvents(ie){let Z=!1,ee=TYPE_TO_CLASS_NAME[ie.type];return ie.type==="decl"?Z=ie.prop.toLowerCase():ie.type==="atrule"&&(Z=ie.name.toLowerCase()),Z&&ie.append?[ee,ee+"-"+Z,CHILDREN,ee+"Exit",ee+"Exit-"+Z]:Z?[ee,ee+"-"+Z,ee+"Exit",ee+"Exit-"+Z]:ie.append?[ee,CHILDREN,ee+"Exit"]:[ee,ee+"Exit"]}function toStack(ie){let Z;return ie.type==="document"?Z=["Document",CHILDREN,"DocumentExit"]:ie.type==="root"?Z=["Root",CHILDREN,"RootExit"]:Z=getEvents(ie),{eventIndex:0,events:Z,iterator:0,node:ie,visitorIndex:0,visitors:[]}}function cleanMarks(ie){return ie[isClean]=!1,ie.nodes&&ie.nodes.forEach(Z=>cleanMarks(Z)),ie}let postcss$1={},LazyResult$2=class Jf{constructor(Z,ee,ae){this.stringified=!1,this.processed=!1;let ye;if(typeof ee=="object"&&ee!==null&&(ee.type==="root"||ee.type==="document"))ye=cleanMarks(ee);else if(ee instanceof Jf||ee instanceof Result$2)ye=cleanMarks(ee.root),ee.map&&(typeof ae.map>"u"&&(ae.map={}),ae.map.inline||(ae.map.inline=!1),ae.map.prev=ee.map);else{let ve=parse$6;ae.syntax&&(ve=ae.syntax.parse),ae.parser&&(ve=ae.parser),ve.parse&&(ve=ve.parse);try{ye=ve(ee,ae)}catch(be){this.processed=!0,this.error=be}ye&&!ye[my]&&Container$1.rebuild(ye)}this.result=new Result$2(Z,ye,ae),this.helpers={...postcss$1,postcss:postcss$1,result:this.result},this.plugins=this.processor.plugins.map(ve=>typeof ve=="object"&&ve.prepare?{...ve,...ve.prepare(this.result)}:ve)}async(){return this.error?Promise.reject(this.error):this.processed?Promise.resolve(this.result):(this.processing||(this.processing=this.runAsync()),this.processing)}catch(Z){return this.async().catch(Z)}finally(Z){return this.async().then(Z,Z)}getAsyncError(){throw new Error("Use process(css).then(cb) to work with async plugins")}handleError(Z,ee){let ae=this.result.lastPlugin;try{ee&&ee.addToError(Z),this.error=Z,Z.name==="CssSyntaxError"&&!Z.plugin?(Z.plugin=ae.postcssPlugin,Z.setMessage()):ae.postcssVersion}catch(ye){console&&console.error&&console.error(ye)}return Z}prepareVisitors(){this.listeners={};let Z=(ee,ae,ye)=>{this.listeners[ae]||(this.listeners[ae]=[]),this.listeners[ae].push([ee,ye])};for(let ee of this.plugins)if(typeof ee=="object")for(let ae in ee){if(!PLUGIN_PROPS[ae]&&/^[A-Z]/.test(ae))throw new Error(`Unknown event ${ae} in ${ee.postcssPlugin}. Try to update PostCSS (${this.processor.version} now).`);if(!NOT_VISITORS[ae])if(typeof ee[ae]=="object")for(let ye in ee[ae])ye==="*"?Z(ee,ae,ee[ae][ye]):Z(ee,ae+"-"+ye.toLowerCase(),ee[ae][ye]);else typeof ee[ae]=="function"&&Z(ee,ae,ee[ae])}this.hasListener=Object.keys(this.listeners).length>0}async runAsync(){this.plugin=0;for(let Z=0;Z<this.plugins.length;Z++){let ee=this.plugins[Z],ae=this.runOnRoot(ee);if(isPromise$1(ae))try{await ae}catch(ye){throw this.handleError(ye)}}if(this.prepareVisitors(),this.hasListener){let Z=this.result.root;for(;!Z[isClean];){Z[isClean]=!0;let ee=[toStack(Z)];for(;ee.length>0;){let ae=this.visitTick(ee);if(isPromise$1(ae))try{await ae}catch(ye){let ve=ee[ee.length-1].node;throw this.handleError(ye,ve)}}}if(this.listeners.OnceExit)for(let[ee,ae]of this.listeners.OnceExit){this.result.lastPlugin=ee;try{if(Z.type==="document"){let ye=Z.nodes.map(ve=>ae(ve,this.helpers));await Promise.all(ye)}else await ae(Z,this.helpers)}catch(ye){throw this.handleError(ye)}}}return this.processed=!0,this.stringify()}runOnRoot(Z){this.result.lastPlugin=Z;try{if(typeof Z=="object"&&Z.Once){if(this.result.root.type==="document"){let ee=this.result.root.nodes.map(ae=>Z.Once(ae,this.helpers));return isPromise$1(ee[0])?Promise.all(ee):ee}return Z.Once(this.result.root,this.helpers)}else if(typeof Z=="function")return Z(this.result.root,this.result)}catch(ee){throw this.handleError(ee)}}stringify(){if(this.error)throw this.error;if(this.stringified)return this.result;this.stringified=!0,this.sync();let Z=this.result.opts,ee=stringify$2;Z.syntax&&(ee=Z.syntax.stringify),Z.stringifier&&(ee=Z.stringifier),ee.stringify&&(ee=ee.stringify);let ae=new MapGenerator$1(ee,this.result.root,this.result.opts).generate();return this.result.css=ae[0],this.result.map=ae[1],this.result}sync(){if(this.error)throw this.error;if(this.processed)return this.result;if(this.processed=!0,this.processing)throw this.getAsyncError();for(let Z of this.plugins){let ee=this.runOnRoot(Z);if(isPromise$1(ee))throw this.getAsyncError()}if(this.prepareVisitors(),this.hasListener){let Z=this.result.root;for(;!Z[isClean];)Z[isClean]=!0,this.walkSync(Z);if(this.listeners.OnceExit)if(Z.type==="document")for(let ee of Z.nodes)this.visitSync(this.listeners.OnceExit,ee);else this.visitSync(this.listeners.OnceExit,Z)}return this.result}then(Z,ee){return this.async().then(Z,ee)}toString(){return this.css}visitSync(Z,ee){for(let[ae,ye]of Z){this.result.lastPlugin=ae;let ve;try{ve=ye(ee,this.helpers)}catch(be){throw this.handleError(be,ee.proxyOf)}if(ee.type!=="root"&&ee.type!=="document"&&!ee.parent)return!0;if(isPromise$1(ve))throw this.getAsyncError()}}visitTick(Z){let ee=Z[Z.length-1],{node:ae,visitors:ye}=ee;if(ae.type!=="root"&&ae.type!=="document"&&!ae.parent){Z.pop();return}if(ye.length>0&&ee.visitorIndex<ye.length){let[be,Ye]=ye[ee.visitorIndex];ee.visitorIndex+=1,ee.visitorIndex===ye.length&&(ee.visitors=[],ee.visitorIndex=0),this.result.lastPlugin=be;try{return Ye(ae.toProxy(),this.helpers)}catch(Ke){throw this.handleError(Ke,ae)}}if(ee.iterator!==0){let be=ee.iterator,Ye;for(;Ye=ae.nodes[ae.indexes[be]];)if(ae.indexes[be]+=1,!Ye[isClean]){Ye[isClean]=!0,Z.push(toStack(Ye));return}ee.iterator=0,delete ae.indexes[be]}let ve=ee.events;for(;ee.eventIndex<ve.length;){let be=ve[ee.eventIndex];if(ee.eventIndex+=1,be===CHILDREN){ae.nodes&&ae.nodes.length&&(ae[isClean]=!0,ee.iterator=ae.getIterator());return}else if(this.listeners[be]){ee.visitors=this.listeners[be];return}}Z.pop()}walkSync(Z){Z[isClean]=!0;let ee=getEvents(Z);for(let ae of ee)if(ae===CHILDREN)Z.nodes&&Z.each(ye=>{ye[isClean]||this.walkSync(ye)});else{let ye=this.listeners[ae];if(ye&&this.visitSync(ye,Z.toProxy()))return}}warnings(){return this.sync().warnings()}get content(){return this.stringify().content}get css(){return this.stringify().css}get map(){return this.stringify().map}get messages(){return this.sync().messages}get opts(){return this.result.opts}get processor(){return this.result.processor}get root(){return this.sync().root}get[Symbol.toStringTag](){return"LazyResult"}};LazyResult$2.registerPostcss=ie=>{postcss$1=ie};var lazyResult=LazyResult$2;LazyResult$2.default=LazyResult$2;Root$3.registerLazyResult(LazyResult$2);Document$2.registerLazyResult(LazyResult$2);let MapGenerator=mapGenerator,stringify$1=stringify_1,parse$5=parse_1;const Result$1=result;let NoWorkResult$1=class{constructor(ie,Z,ee){Z=Z.toString(),this.stringified=!1,this._processor=ie,this._css=Z,this._opts=ee,this._map=void 0;let ae,ye=stringify$1;this.result=new Result$1(this._processor,ae,this._opts),this.result.css=Z;let ve=this;Object.defineProperty(this.result,"root",{get(){return ve.root}});let be=new MapGenerator(ye,ae,this._opts,Z);if(be.isMap()){let[Ye,Ke]=be.generate();Ye&&(this.result.css=Ye),Ke&&(this.result.map=Ke)}else be.clearAnnotation(),this.result.css=be.css}async(){return this.error?Promise.reject(this.error):Promise.resolve(this.result)}catch(ie){return this.async().catch(ie)}finally(ie){return this.async().then(ie,ie)}sync(){if(this.error)throw this.error;return this.result}then(ie,Z){return this.async().then(ie,Z)}toString(){return this._css}warnings(){return[]}get content(){return this.result.css}get css(){return this.result.css}get map(){return this.result.map}get messages(){return[]}get opts(){return this.result.opts}get processor(){return this.result.processor}get root(){if(this._root)return this._root;let ie,Z=parse$5;try{ie=Z(this._css,this._opts)}catch(ee){this.error=ee}if(this.error)throw this.error;return this._root=ie,ie}get[Symbol.toStringTag](){return"NoWorkResult"}};var noWorkResult=NoWorkResult$1;NoWorkResult$1.default=NoWorkResult$1;let NoWorkResult=noWorkResult,LazyResult$1=lazyResult,Document$1=document$1,Root$2=root,Processor$1=class{constructor(ie=[]){this.version="8.4.33",this.plugins=this.normalize(ie)}normalize(ie){let Z=[];for(let ee of ie)if(ee.postcss===!0?ee=ee():ee.postcss&&(ee=ee.postcss),typeof ee=="object"&&Array.isArray(ee.plugins))Z=Z.concat(ee.plugins);else if(typeof ee=="object"&&ee.postcssPlugin)Z.push(ee);else if(typeof ee=="function")Z.push(ee);else if(!(typeof ee=="object"&&(ee.parse||ee.stringify)))throw new Error(ee+" is not a PostCSS plugin");return Z}process(ie,Z={}){return!this.plugins.length&&!Z.parser&&!Z.stringifier&&!Z.syntax?new NoWorkResult(this,ie,Z):new LazyResult$1(this,ie,Z)}use(ie){return this.plugins=this.plugins.concat(this.normalize([ie])),this}};var processor=Processor$1;Processor$1.default=Processor$1;Root$2.registerProcessor(Processor$1);Document$1.registerProcessor(Processor$1);let Declaration$1=declaration,PreviousMap=previousMap,Comment$1=comment,AtRule$1=atRule,Input$1=input,Root$1=root,Rule$1=rule;function fromJSON$1(ie,Z){if(Array.isArray(ie))return ie.map(ye=>fromJSON$1(ye));let{inputs:ee,...ae}=ie;if(ee){Z=[];for(let ye of ee){let ve={...ye,__proto__:Input$1.prototype};ve.map&&(ve.map={...ve.map,__proto__:PreviousMap.prototype}),Z.push(ve)}}if(ae.nodes&&(ae.nodes=ie.nodes.map(ye=>fromJSON$1(ye,Z))),ae.source){let{inputId:ye,...ve}=ae.source;ae.source=ve,ye!=null&&(ae.source.input=Z[ye])}if(ae.type==="root")return new Root$1(ae);if(ae.type==="decl")return new Declaration$1(ae);if(ae.type==="rule")return new Rule$1(ae);if(ae.type==="comment")return new Comment$1(ae);if(ae.type==="atrule")return new AtRule$1(ae);throw new Error("Unknown node type: "+ie.type)}var fromJSON_1=fromJSON$1;fromJSON$1.default=fromJSON$1;let CssSyntaxError=cssSyntaxError,Declaration=declaration,LazyResult=lazyResult,Container=container,Processor=processor,stringify=stringify_1,fromJSON=fromJSON_1,Document=document$1,Warning=warning,Comment=comment,AtRule=atRule,Result=result,Input=input,parse$4=parse_1,list=list_1,Rule=rule,Root=root,Node$1=node;function postcss(...ie){return ie.length===1&&Array.isArray(ie[0])&&(ie=ie[0]),new Processor(ie)}postcss.plugin=function(ie,Z){let ee=!1;function ae(...ve){console&&console.warn&&!ee&&(ee=!0,console.warn(ie+`: postcss.plugin was deprecated. Migration guide:
https://evilmartians.com/chronicles/postcss-8-plugin-migration`),define_process_env_default.LANG&&define_process_env_default.LANG.startsWith("cn")&&console.warn(ie+`: 里面 postcss.plugin 被弃用. 迁移指南:
https://www.w3ctech.com/topic/2226`));let be=Z(...ve);return be.postcssPlugin=ie,be.postcssVersion=new Processor().version,be}let ye;return Object.defineProperty(ae,"postcss",{get(){return ye||(ye=ae()),ye}}),ae.process=function(ve,be,Ye){return postcss([ae(Ye)]).process(ve,be)},ae};postcss.stringify=stringify;postcss.parse=parse$4;postcss.fromJSON=fromJSON;postcss.list=list;postcss.comment=ie=>new Comment(ie);postcss.atRule=ie=>new AtRule(ie);postcss.decl=ie=>new Declaration(ie);postcss.rule=ie=>new Rule(ie);postcss.root=ie=>new Root(ie);postcss.document=ie=>new Document(ie);postcss.CssSyntaxError=CssSyntaxError;postcss.Declaration=Declaration;postcss.Container=Container;postcss.Processor=Processor;postcss.Document=Document;postcss.Comment=Comment;postcss.Warning=Warning;postcss.AtRule=AtRule;postcss.Result=Result;postcss.Input=Input;postcss.Rule=Rule;postcss.Root=Root;postcss.Node=Node$1;LazyResult.registerPostcss(postcss);var postcss_1=postcss;postcss.default=postcss;const htmlparser=lib$5,escapeStringRegexp=escapeStringRegexp$1,{isPlainObject}=isPlainObject$2,deepmerge=cjs,parseSrcset=parseSrcsetExports,{parse:postcssParse}=postcss_1,mediaTags=["img","audio","video","picture","svg","object","map","iframe","embed"],vulnerableTags=["script","style"];function each(ie,Z){ie&&Object.keys(ie).forEach(function(ee){Z(ie[ee],ee)})}function has(ie,Z){return{}.hasOwnProperty.call(ie,Z)}function filter(ie,Z){const ee=[];return each(ie,function(ae){Z(ae)&&ee.push(ae)}),ee}function isEmptyObject(ie){for(const Z in ie)if(has(ie,Z))return!1;return!0}function stringifySrcset(ie){return ie.map(function(Z){if(!Z.url)throw new Error("URL missing");return Z.url+(Z.w?` ${Z.w}w`:"")+(Z.h?` ${Z.h}h`:"")+(Z.d?` ${Z.d}x`:"")}).join(", ")}var sanitizeHtml_1=sanitizeHtml;const VALID_HTML_ATTRIBUTE_NAME=/^[^\0\t\n\f\r /<=>]+$/;function sanitizeHtml(ie,Z,ee){if(ie==null)return"";typeof ie=="number"&&(ie=ie.toString());let ae="",ye="";function ve(ii,hi){const ri=this;this.tag=ii,this.attribs=hi||{},this.tagPosition=ae.length,this.text="",this.mediaChildren=[],this.updateParentNodeText=function(){if(ot.length){const ci=ot[ot.length-1];ci.text+=ri.text}},this.updateParentNodeMediaChildren=function(){ot.length&&mediaTags.includes(this.tag)&&ot[ot.length-1].mediaChildren.push(this.tag)}}Z=Object.assign({},sanitizeHtml.defaults,Z),Z.parser=Object.assign({},htmlParserDefaults,Z.parser);const be=function(ii){return Z.allowedTags===!1||(Z.allowedTags||[]).indexOf(ii)>-1};vulnerableTags.forEach(function(ii){be(ii)&&!Z.allowVulnerableTags&&console.warn(`

⚠️ Your \`allowedTags\` option includes, \`${ii}\`, which is inherently
vulnerable to XSS attacks. Please remove it from \`allowedTags\`.
Or, to disable this warning, add the \`allowVulnerableTags\` option
and ensure you are accounting for this risk.

`)});const Ye=Z.nonTextTags||["script","style","textarea","option"];let Ke,Xe;Z.allowedAttributes&&(Ke={},Xe={},each(Z.allowedAttributes,function(ii,hi){Ke[hi]=[];const ri=[];ii.forEach(function(ci){typeof ci=="string"&&ci.indexOf("*")>=0?ri.push(escapeStringRegexp(ci).replace(/\\\*/g,".*")):Ke[hi].push(ci)}),ri.length&&(Xe[hi]=new RegExp("^("+ri.join("|")+")$"))}));const Je={},rt={},nt={};each(Z.allowedClasses,function(ii,hi){if(Ke&&(has(Ke,hi)||(Ke[hi]=[]),Ke[hi].push("class")),Je[hi]=ii,Array.isArray(ii)){const ri=[];Je[hi]=[],nt[hi]=[],ii.forEach(function(ci){typeof ci=="string"&&ci.indexOf("*")>=0?ri.push(escapeStringRegexp(ci).replace(/\\\*/g,".*")):ci instanceof RegExp?nt[hi].push(ci):Je[hi].push(ci)}),ri.length&&(rt[hi]=new RegExp("^("+ri.join("|")+")$"))}});const it={};let lt;each(Z.transformTags,function(ii,hi){let ri;typeof ii=="function"?ri=ii:typeof ii=="string"&&(ri=sanitizeHtml.simpleTransform(ii)),hi==="*"?lt=ri:it[hi]=ri});let ct,ot,dt,ft,gt,mt,Yr=!1;Xr();const Qr=new htmlparser.Parser({onopentag:function(ii,hi){if(Z.enforceHtmlBoundary&&ii==="html"&&Xr(),gt){mt++;return}const ri=new ve(ii,hi);ot.push(ri);let ci=!1;const Si=!!ri.text;let si;if(has(it,ii)&&(si=it[ii](ii,hi),ri.attribs=hi=si.attribs,si.text!==void 0&&(ri.innerText=si.text),ii!==si.tagName&&(ri.name=ii=si.tagName,ft[ct]=si.tagName)),lt&&(si=lt(ii,hi),ri.attribs=hi=si.attribs,ii!==si.tagName&&(ri.name=ii=si.tagName,ft[ct]=si.tagName)),(!be(ii)||Z.disallowedTagsMode==="recursiveEscape"&&!isEmptyObject(dt)||Z.nestingLimit!=null&&ct>=Z.nestingLimit)&&(ci=!0,dt[ct]=!0,Z.disallowedTagsMode==="discard"&&Ye.indexOf(ii)!==-1&&(gt=!0,mt=1),dt[ct]=!0),ct++,ci){if(Z.disallowedTagsMode==="discard")return;ye=ae,ae=""}ae+="<"+ii,ii==="script"&&(Z.allowedScriptHostnames||Z.allowedScriptDomains)&&(ri.innerText=""),(!Ke||has(Ke,ii)||Ke["*"])&&each(hi,function(Ei,yi){if(!VALID_HTML_ATTRIBUTE_NAME.test(yi)){delete ri.attribs[yi];return}if(Ei===""&&(Z.nonBooleanAttributes.includes(yi)||Z.nonBooleanAttributes.includes("*"))){delete ri.attribs[yi];return}let Mi=!1;if(!Ke||has(Ke,ii)&&Ke[ii].indexOf(yi)!==-1||Ke["*"]&&Ke["*"].indexOf(yi)!==-1||has(Xe,ii)&&Xe[ii].test(yi)||Xe["*"]&&Xe["*"].test(yi))Mi=!0;else if(Ke&&Ke[ii]){for(const Ci of Ke[ii])if(isPlainObject(Ci)&&Ci.name&&Ci.name===yi){Mi=!0;let Ri="";if(Ci.multiple===!0){const Ni=Ei.split(" ");for(const Ai of Ni)Ci.values.indexOf(Ai)!==-1&&(Ri===""?Ri=Ai:Ri+=" "+Ai)}else Ci.values.indexOf(Ei)>=0&&(Ri=Ei);Ei=Ri}}if(Mi){if(Z.allowedSchemesAppliedToAttributes.indexOf(yi)!==-1&&ai(ii,Ei)){delete ri.attribs[yi];return}if(ii==="script"&&yi==="src"){let Ci=!0;try{const Ri=oi(Ei);if(Z.allowedScriptHostnames||Z.allowedScriptDomains){const Ni=(Z.allowedScriptHostnames||[]).find(function(ki){return ki===Ri.url.hostname}),Ai=(Z.allowedScriptDomains||[]).find(function(ki){return Ri.url.hostname===ki||Ri.url.hostname.endsWith(`.${ki}`)});Ci=Ni||Ai}}catch{Ci=!1}if(!Ci){delete ri.attribs[yi];return}}if(ii==="iframe"&&yi==="src"){let Ci=!0;try{const Ri=oi(Ei);if(Ri.isRelativeUrl)Ci=has(Z,"allowIframeRelativeUrls")?Z.allowIframeRelativeUrls:!Z.allowedIframeHostnames&&!Z.allowedIframeDomains;else if(Z.allowedIframeHostnames||Z.allowedIframeDomains){const Ni=(Z.allowedIframeHostnames||[]).find(function(ki){return ki===Ri.url.hostname}),Ai=(Z.allowedIframeDomains||[]).find(function(ki){return Ri.url.hostname===ki||Ri.url.hostname.endsWith(`.${ki}`)});Ci=Ni||Ai}}catch{Ci=!1}if(!Ci){delete ri.attribs[yi];return}}if(yi==="srcset")try{let Ci=parseSrcset(Ei);if(Ci.forEach(function(Ri){ai("srcset",Ri.url)&&(Ri.evil=!0)}),Ci=filter(Ci,function(Ri){return!Ri.evil}),Ci.length)Ei=stringifySrcset(filter(Ci,function(Ri){return!Ri.evil})),ri.attribs[yi]=Ei;else{delete ri.attribs[yi];return}}catch{delete ri.attribs[yi];return}if(yi==="class"){const Ci=Je[ii],Ri=Je["*"],Ni=rt[ii],Ai=nt[ii],ki=rt["*"],Yi=[Ni,ki].concat(Ai).filter(function(Ji){return Ji});if(Ci&&Ri?Ei=mi(Ei,deepmerge(Ci,Ri),Yi):Ei=mi(Ei,Ci||Ri,Yi),!Ei.length){delete ri.attribs[yi];return}}if(yi==="style"){if(Z.parseStyleAttributes)try{const Ci=postcssParse(ii+" {"+Ei+"}"),Ri=ni(Ci,Z.allowedStyles);if(Ei=li(Ri),Ei.length===0){delete ri.attribs[yi];return}}catch{typeof window<"u"&&console.warn('Failed to parse "'+ii+" {"+Ei+`}", If you're running this in a browser, we recommend to disable style parsing: options.parseStyleAttributes: false, since this only works in a node environment due to a postcss dependency, More info: https://github.com/apostrophecms/sanitize-html/issues/547`),delete ri.attribs[yi];return}else if(Z.allowedStyles)throw new Error("allowedStyles option cannot be used together with parseStyleAttributes: false.")}ae+=" "+yi,Ei&&Ei.length&&(ae+='="'+Jr(Ei,!0)+'"')}else delete ri.attribs[yi]}),Z.selfClosing.indexOf(ii)!==-1?ae+=" />":(ae+=">",ri.innerText&&!Si&&!Z.textFilter&&(ae+=Jr(ri.innerText),Yr=!0)),ci&&(ae=ye+Jr(ae),ye="")},ontext:function(ii){if(gt)return;const hi=ot[ot.length-1];let ri;if(hi&&(ri=hi.tag,ii=hi.innerText!==void 0?hi.innerText:ii),Z.disallowedTagsMode==="discard"&&(ri==="script"||ri==="style"))ae+=ii;else{const ci=Jr(ii,!1);Z.textFilter&&!Yr?ae+=Z.textFilter(ci,ri):Yr||(ae+=ci)}if(ot.length){const ci=ot[ot.length-1];ci.text+=ii}},onclosetag:function(ii,hi){if(gt)if(mt--,!mt)gt=!1;else return;const ri=ot.pop();if(!ri)return;if(ri.tag!==ii){ot.push(ri);return}gt=Z.enforceHtmlBoundary?ii==="html":!1,ct--;const ci=dt[ct];if(ci){if(delete dt[ct],Z.disallowedTagsMode==="discard"){ri.updateParentNodeText();return}ye=ae,ae=""}if(ft[ct]&&(ii=ft[ct],delete ft[ct]),Z.exclusiveFilter&&Z.exclusiveFilter(ri)){ae=ae.substr(0,ri.tagPosition);return}if(ri.updateParentNodeMediaChildren(),ri.updateParentNodeText(),Z.selfClosing.indexOf(ii)!==-1||hi&&!be(ii)&&["escape","recursiveEscape"].indexOf(Z.disallowedTagsMode)>=0){ci&&(ae=ye,ye="");return}ae+="</"+ii+">",ci&&(ae=ye+Jr(ae),ye=""),Yr=!1}},Z.parser);return Qr.write(ie),Qr.end(),ae;function Xr(){ae="",ct=0,ot=[],dt={},ft={},gt=!1,mt=0}function Jr(ii,hi){return typeof ii!="string"&&(ii=ii+""),Z.parser.decodeEntities&&(ii=ii.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),hi&&(ii=ii.replace(/"/g,"&quot;"))),ii=ii.replace(/&(?![a-zA-Z0-9#]{1,20};)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),hi&&(ii=ii.replace(/"/g,"&quot;")),ii}function ai(ii,hi){for(hi=hi.replace(/[\x00-\x20]+/g,"");;){const Si=hi.indexOf("<!--");if(Si===-1)break;const si=hi.indexOf("-->",Si+4);if(si===-1)break;hi=hi.substring(0,Si)+hi.substring(si+3)}const ri=hi.match(/^([a-zA-Z][a-zA-Z0-9.\-+]*):/);if(!ri)return hi.match(/^[/\\]{2}/)?!Z.allowProtocolRelative:!1;const ci=ri[1].toLowerCase();return has(Z.allowedSchemesByTag,ii)?Z.allowedSchemesByTag[ii].indexOf(ci)===-1:!Z.allowedSchemes||Z.allowedSchemes.indexOf(ci)===-1}function oi(ii){if(ii=ii.replace(/^(\w+:)?\s*[\\/]\s*[\\/]/,"$1//"),ii.startsWith("relative:"))throw new Error("relative: exploit attempt");let hi="relative://relative-site";for(let ci=0;ci<100;ci++)hi+=`/${ci}`;const ri=new URL(ii,hi);return{isRelativeUrl:ri&&ri.hostname==="relative-site"&&ri.protocol==="relative:",url:ri}}function ni(ii,hi){if(!hi)return ii;const ri=ii.nodes[0];let ci;return hi[ri.selector]&&hi["*"]?ci=deepmerge(hi[ri.selector],hi["*"]):ci=hi[ri.selector]||hi["*"],ci&&(ii.nodes[0].nodes=ri.nodes.reduce(ui(ci),[])),ii}function li(ii){return ii.nodes[0].nodes.reduce(function(hi,ri){return hi.push(`${ri.prop}:${ri.value}${ri.important?" !important":""}`),hi},[]).join(";")}function ui(ii){return function(hi,ri){return has(ii,ri.prop)&&ii[ri.prop].some(function(ci){return ci.test(ri.value)})&&hi.push(ri),hi}}function mi(ii,hi,ri){return hi?(ii=ii.split(/\s+/),ii.filter(function(ci){return hi.indexOf(ci)!==-1||ri.some(function(Si){return Si.test(ci)})}).join(" ")):ii}}const htmlParserDefaults={decodeEntities:!0};sanitizeHtml.defaults={allowedTags:["address","article","aside","footer","header","h1","h2","h3","h4","h5","h6","hgroup","main","nav","section","blockquote","dd","div","dl","dt","figcaption","figure","hr","li","main","ol","p","pre","ul","a","abbr","b","bdi","bdo","br","cite","code","data","dfn","em","i","kbd","mark","q","rb","rp","rt","rtc","ruby","s","samp","small","span","strong","sub","sup","time","u","var","wbr","caption","col","colgroup","table","tbody","td","tfoot","th","thead","tr"],nonBooleanAttributes:["abbr","accept","accept-charset","accesskey","action","allow","alt","as","autocapitalize","autocomplete","blocking","charset","cite","class","color","cols","colspan","content","contenteditable","coords","crossorigin","data","datetime","decoding","dir","dirname","download","draggable","enctype","enterkeyhint","fetchpriority","for","form","formaction","formenctype","formmethod","formtarget","headers","height","hidden","high","href","hreflang","http-equiv","id","imagesizes","imagesrcset","inputmode","integrity","is","itemid","itemprop","itemref","itemtype","kind","label","lang","list","loading","low","max","maxlength","media","method","min","minlength","name","nonce","optimum","pattern","ping","placeholder","popover","popovertarget","popovertargetaction","poster","preload","referrerpolicy","rel","rows","rowspan","sandbox","scope","shape","size","sizes","slot","span","spellcheck","src","srcdoc","srclang","srcset","start","step","style","tabindex","target","title","translate","type","usemap","value","width","wrap","onauxclick","onafterprint","onbeforematch","onbeforeprint","onbeforeunload","onbeforetoggle","onblur","oncancel","oncanplay","oncanplaythrough","onchange","onclick","onclose","oncontextlost","oncontextmenu","oncontextrestored","oncopy","oncuechange","oncut","ondblclick","ondrag","ondragend","ondragenter","ondragleave","ondragover","ondragstart","ondrop","ondurationchange","onemptied","onended","onerror","onfocus","onformdata","onhashchange","oninput","oninvalid","onkeydown","onkeypress","onkeyup","onlanguagechange","onload","onloadeddata","onloadedmetadata","onloadstart","onmessage","onmessageerror","onmousedown","onmouseenter","onmouseleave","onmousemove","onmouseout","onmouseover","onmouseup","onoffline","ononline","onpagehide","onpageshow","onpaste","onpause","onplay","onplaying","onpopstate","onprogress","onratechange","onreset","onresize","onrejectionhandled","onscroll","onscrollend","onsecuritypolicyviolation","onseeked","onseeking","onselect","onslotchange","onstalled","onstorage","onsubmit","onsuspend","ontimeupdate","ontoggle","onunhandledrejection","onunload","onvolumechange","onwaiting","onwheel"],disallowedTagsMode:"discard",allowedAttributes:{a:["href","name","target"],img:["src","srcset","alt","title","width","height","loading"]},selfClosing:["img","br","hr","area","base","basefont","input","link","meta"],allowedSchemes:["http","https","ftp","mailto","tel"],allowedSchemesByTag:{},allowedSchemesAppliedToAttributes:["href","src","cite"],allowProtocolRelative:!0,enforceHtmlBoundary:!1,parseStyleAttributes:!0};sanitizeHtml.simpleTransform=function(ie,Z,ee){return ee=ee===void 0?!0:ee,Z=Z||{},function(ae,ye){let ve;if(ee)for(ve in Z)ye[ve]=Z[ve];else ye=Z;return{tagName:ie,attribs:ye}}};const at=getDefaultExportFromCjs$1(sanitizeHtml_1);function getDefaultExportFromCjs(ie){return ie&&ie.__esModule&&Object.prototype.hasOwnProperty.call(ie,"default")?ie.default:ie}var urlToolkit={exports:{}};(function(ie,Z){(function(ee){var ae=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,ye=/^(?=([^\/?#]*))\1([^]*)$/,ve=/(?:\/|^)\.(?=\/)/g,be=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,Ye={buildAbsoluteURL:function(Ke,Xe,Je){if(Je=Je||{},Ke=Ke.trim(),Xe=Xe.trim(),!Xe){if(!Je.alwaysNormalize)return Ke;var rt=Ye.parseURL(Ke);if(!rt)throw new Error("Error trying to parse base URL.");return rt.path=Ye.normalizePath(rt.path),Ye.buildURLFromParts(rt)}var nt=Ye.parseURL(Xe);if(!nt)throw new Error("Error trying to parse relative URL.");if(nt.scheme)return Je.alwaysNormalize?(nt.path=Ye.normalizePath(nt.path),Ye.buildURLFromParts(nt)):Xe;var it=Ye.parseURL(Ke);if(!it)throw new Error("Error trying to parse base URL.");if(!it.netLoc&&it.path&&it.path[0]!=="/"){var lt=ye.exec(it.path);it.netLoc=lt[1],it.path=lt[2]}it.netLoc&&!it.path&&(it.path="/");var ct={scheme:it.scheme,netLoc:nt.netLoc,path:null,params:nt.params,query:nt.query,fragment:nt.fragment};if(!nt.netLoc&&(ct.netLoc=it.netLoc,nt.path[0]!=="/"))if(!nt.path)ct.path=it.path,nt.params||(ct.params=it.params,nt.query||(ct.query=it.query));else{var ot=it.path,dt=ot.substring(0,ot.lastIndexOf("/")+1)+nt.path;ct.path=Ye.normalizePath(dt)}return ct.path===null&&(ct.path=Je.alwaysNormalize?Ye.normalizePath(nt.path):nt.path),Ye.buildURLFromParts(ct)},parseURL:function(Ke){var Xe=ae.exec(Ke);return Xe?{scheme:Xe[1]||"",netLoc:Xe[2]||"",path:Xe[3]||"",params:Xe[4]||"",query:Xe[5]||"",fragment:Xe[6]||""}:null},normalizePath:function(Ke){for(Ke=Ke.split("").reverse().join("").replace(ve,"");Ke.length!==(Ke=Ke.replace(be,"")).length;);return Ke.split("").reverse().join("")},buildURLFromParts:function(Ke){return Ke.scheme+Ke.netLoc+Ke.path+Ke.params+Ke.query+Ke.fragment}};ie.exports=Ye})()})(urlToolkit);var urlToolkitExports=urlToolkit.exports;function ownKeys(ie,Z){var ee=Object.keys(ie);if(Object.getOwnPropertySymbols){var ae=Object.getOwnPropertySymbols(ie);Z&&(ae=ae.filter(function(ye){return Object.getOwnPropertyDescriptor(ie,ye).enumerable})),ee.push.apply(ee,ae)}return ee}function _objectSpread2(ie){for(var Z=1;Z<arguments.length;Z++){var ee=arguments[Z]!=null?arguments[Z]:{};Z%2?ownKeys(Object(ee),!0).forEach(function(ae){_defineProperty(ie,ae,ee[ae])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ie,Object.getOwnPropertyDescriptors(ee)):ownKeys(Object(ee)).forEach(function(ae){Object.defineProperty(ie,ae,Object.getOwnPropertyDescriptor(ee,ae))})}return ie}function _toPrimitive(ie,Z){if(typeof ie!="object"||!ie)return ie;var ee=ie[Symbol.toPrimitive];if(ee!==void 0){var ae=ee.call(ie,Z||"default");if(typeof ae!="object")return ae;throw new TypeError("@@toPrimitive must return a primitive value.")}return(Z==="string"?String:Number)(ie)}function _toPropertyKey(ie){var Z=_toPrimitive(ie,"string");return typeof Z=="symbol"?Z:String(Z)}function _defineProperty(ie,Z,ee){return Z=_toPropertyKey(Z),Z in ie?Object.defineProperty(ie,Z,{value:ee,enumerable:!0,configurable:!0,writable:!0}):ie[Z]=ee,ie}function _extends(){return _extends=Object.assign?Object.assign.bind():function(ie){for(var Z=1;Z<arguments.length;Z++){var ee=arguments[Z];for(var ae in ee)Object.prototype.hasOwnProperty.call(ee,ae)&&(ie[ae]=ee[ae])}return ie},_extends.apply(this,arguments)}const isFiniteNumber=Number.isFinite||function(ie){return typeof ie=="number"&&isFinite(ie)},isSafeInteger=Number.isSafeInteger||function(ie){return typeof ie=="number"&&Math.abs(ie)<=MAX_SAFE_INTEGER},MAX_SAFE_INTEGER=Number.MAX_SAFE_INTEGER||9007199254740991;let Events=function(ie){return ie.MEDIA_ATTACHING="hlsMediaAttaching",ie.MEDIA_ATTACHED="hlsMediaAttached",ie.MEDIA_DETACHING="hlsMediaDetaching",ie.MEDIA_DETACHED="hlsMediaDetached",ie.BUFFER_RESET="hlsBufferReset",ie.BUFFER_CODECS="hlsBufferCodecs",ie.BUFFER_CREATED="hlsBufferCreated",ie.BUFFER_APPENDING="hlsBufferAppending",ie.BUFFER_APPENDED="hlsBufferAppended",ie.BUFFER_EOS="hlsBufferEos",ie.BUFFER_FLUSHING="hlsBufferFlushing",ie.BUFFER_FLUSHED="hlsBufferFlushed",ie.MANIFEST_LOADING="hlsManifestLoading",ie.MANIFEST_LOADED="hlsManifestLoaded",ie.MANIFEST_PARSED="hlsManifestParsed",ie.LEVEL_SWITCHING="hlsLevelSwitching",ie.LEVEL_SWITCHED="hlsLevelSwitched",ie.LEVEL_LOADING="hlsLevelLoading",ie.LEVEL_LOADED="hlsLevelLoaded",ie.LEVEL_UPDATED="hlsLevelUpdated",ie.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",ie.LEVELS_UPDATED="hlsLevelsUpdated",ie.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",ie.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",ie.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",ie.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",ie.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",ie.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",ie.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",ie.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",ie.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",ie.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",ie.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",ie.CUES_PARSED="hlsCuesParsed",ie.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",ie.INIT_PTS_FOUND="hlsInitPtsFound",ie.FRAG_LOADING="hlsFragLoading",ie.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",ie.FRAG_LOADED="hlsFragLoaded",ie.FRAG_DECRYPTED="hlsFragDecrypted",ie.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",ie.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",ie.FRAG_PARSING_METADATA="hlsFragParsingMetadata",ie.FRAG_PARSED="hlsFragParsed",ie.FRAG_BUFFERED="hlsFragBuffered",ie.FRAG_CHANGED="hlsFragChanged",ie.FPS_DROP="hlsFpsDrop",ie.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",ie.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",ie.ERROR="hlsError",ie.DESTROYING="hlsDestroying",ie.KEY_LOADING="hlsKeyLoading",ie.KEY_LOADED="hlsKeyLoaded",ie.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",ie.BACK_BUFFER_REACHED="hlsBackBufferReached",ie.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",ie}({}),ErrorTypes=function(ie){return ie.NETWORK_ERROR="networkError",ie.MEDIA_ERROR="mediaError",ie.KEY_SYSTEM_ERROR="keySystemError",ie.MUX_ERROR="muxError",ie.OTHER_ERROR="otherError",ie}({}),ErrorDetails=function(ie){return ie.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",ie.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",ie.KEY_SYSTEM_NO_SESSION="keySystemNoSession",ie.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",ie.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",ie.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",ie.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",ie.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",ie.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",ie.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",ie.MANIFEST_LOAD_ERROR="manifestLoadError",ie.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",ie.MANIFEST_PARSING_ERROR="manifestParsingError",ie.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",ie.LEVEL_EMPTY_ERROR="levelEmptyError",ie.LEVEL_LOAD_ERROR="levelLoadError",ie.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",ie.LEVEL_PARSING_ERROR="levelParsingError",ie.LEVEL_SWITCH_ERROR="levelSwitchError",ie.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",ie.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",ie.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",ie.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",ie.FRAG_LOAD_ERROR="fragLoadError",ie.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",ie.FRAG_DECRYPT_ERROR="fragDecryptError",ie.FRAG_PARSING_ERROR="fragParsingError",ie.FRAG_GAP="fragGap",ie.REMUX_ALLOC_ERROR="remuxAllocError",ie.KEY_LOAD_ERROR="keyLoadError",ie.KEY_LOAD_TIMEOUT="keyLoadTimeOut",ie.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",ie.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",ie.BUFFER_APPEND_ERROR="bufferAppendError",ie.BUFFER_APPENDING_ERROR="bufferAppendingError",ie.BUFFER_STALLED_ERROR="bufferStalledError",ie.BUFFER_FULL_ERROR="bufferFullError",ie.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",ie.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",ie.INTERNAL_EXCEPTION="internalException",ie.INTERNAL_ABORTED="aborted",ie.UNKNOWN="unknown",ie}({});const noop=function(){},fakeLogger={trace:noop,debug:noop,log:noop,warn:noop,info:noop,error:noop};let exportedLogger=fakeLogger;function consolePrintFn(ie){const Z=self.console[ie];return Z?Z.bind(self.console,`[${ie}] >`):noop}function exportLoggerFunctions(ie,...Z){Z.forEach(function(ee){exportedLogger[ee]=ie[ee]?ie[ee].bind(ie):consolePrintFn(ee)})}function enableLogs(ie,Z){if(typeof console=="object"&&ie===!0||typeof ie=="object"){exportLoggerFunctions(ie,"debug","log","info","warn","error");try{exportedLogger.log(`Debug logs enabled for "${Z}" in hls.js version 1.5.3`)}catch{exportedLogger=fakeLogger}}else exportedLogger=fakeLogger}const logger=exportedLogger,DECIMAL_RESOLUTION_REGEX=/^(\d+)x(\d+)$/,ATTR_LIST_REGEX=/(.+?)=(".*?"|.*?)(?:,|$)/g;class AttrList{constructor(Z){typeof Z=="string"&&(Z=AttrList.parseAttrList(Z)),_extends(this,Z)}get clientAttrs(){return Object.keys(this).filter(Z=>Z.substring(0,2)==="X-")}decimalInteger(Z){const ee=parseInt(this[Z],10);return ee>Number.MAX_SAFE_INTEGER?1/0:ee}hexadecimalInteger(Z){if(this[Z]){let ee=(this[Z]||"0x").slice(2);ee=(ee.length&1?"0":"")+ee;const ae=new Uint8Array(ee.length/2);for(let ye=0;ye<ee.length/2;ye++)ae[ye]=parseInt(ee.slice(ye*2,ye*2+2),16);return ae}else return null}hexadecimalIntegerAsNumber(Z){const ee=parseInt(this[Z],16);return ee>Number.MAX_SAFE_INTEGER?1/0:ee}decimalFloatingPoint(Z){return parseFloat(this[Z])}optionalFloat(Z,ee){const ae=this[Z];return ae?parseFloat(ae):ee}enumeratedString(Z){return this[Z]}bool(Z){return this[Z]==="YES"}decimalResolution(Z){const ee=DECIMAL_RESOLUTION_REGEX.exec(this[Z]);if(ee!==null)return{width:parseInt(ee[1],10),height:parseInt(ee[2],10)}}static parseAttrList(Z){let ee;const ae={},ye='"';for(ATTR_LIST_REGEX.lastIndex=0;(ee=ATTR_LIST_REGEX.exec(Z))!==null;){let ve=ee[2];ve.indexOf(ye)===0&&ve.lastIndexOf(ye)===ve.length-1&&(ve=ve.slice(1,-1));const be=ee[1].trim();ae[be]=ve}return ae}}function isDateRangeCueAttribute(ie){return ie!=="ID"&&ie!=="CLASS"&&ie!=="START-DATE"&&ie!=="DURATION"&&ie!=="END-DATE"&&ie!=="END-ON-NEXT"}function isSCTE35Attribute(ie){return ie==="SCTE35-OUT"||ie==="SCTE35-IN"}class DateRange{constructor(Z,ee){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,ee){const ae=ee.attr;for(const ye in ae)if(Object.prototype.hasOwnProperty.call(Z,ye)&&Z[ye]!==ae[ye]){logger.warn(`DATERANGE tag attribute: "${ye}" does not match for tags with ID: "${Z.ID}"`),this._badValueForSameId=ye;break}Z=_extends(new AttrList({}),ae,Z)}if(this.attr=Z,this._startDate=new Date(Z["START-DATE"]),"END-DATE"in this.attr){const ae=new Date(this.attr["END-DATE"]);isFiniteNumber(ae.getTime())&&(this._endDate=ae)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const Z=this.duration;return Z!==null?new Date(this._startDate.getTime()+Z*1e3):null}get duration(){if("DURATION"in this.attr){const Z=this.attr.decimalFloatingPoint("DURATION");if(isFiniteNumber(Z))return Z}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&isFiniteNumber(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class LoadStats{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var ElementaryStreamTypes={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class BaseSegment{constructor(Z){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[ElementaryStreamTypes.AUDIO]:null,[ElementaryStreamTypes.VIDEO]:null,[ElementaryStreamTypes.AUDIOVIDEO]:null},this.baseurl=Z}setByteRange(Z,ee){const ae=Z.split("@",2);let ye;ae.length===1?ye=(ee==null?void 0:ee.byteRangeEndOffset)||0:ye=parseInt(ae[1]),this._byteRange=[ye,parseInt(ae[0])+ye]}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=urlToolkitExports.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(Z){this._url=Z}}class Fragment extends BaseSegment{constructor(Z,ee){super(ee),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new LoadStats,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=Z}get decryptdata(){const{levelkeys:Z}=this;if(!Z&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const ee=this.levelkeys.identity;if(ee)this._decryptdata=ee.getDecryptData(this.sn);else{const ae=Object.keys(this.levelkeys);if(ae.length===1)return this._decryptdata=this.levelkeys[ae[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null||!isFiniteNumber(this.programDateTime))return null;const Z=isFiniteNumber(this.duration)?this.duration:0;return this.programDateTime+Z*1e3}get encrypted(){var Z;if((Z=this._decryptdata)!=null&&Z.encrypted)return!0;if(this.levelkeys){const ee=Object.keys(this.levelkeys),ae=ee.length;if(ae>1||ae===1&&this.levelkeys[ee[0]].encrypted)return!0}return!1}setKeyFormat(Z){if(this.levelkeys){const ee=this.levelkeys[Z];ee&&!this._decryptdata&&(this._decryptdata=ee.getDecryptData(this.sn))}}abortRequests(){var Z,ee;(Z=this.loader)==null||Z.abort(),(ee=this.keyLoader)==null||ee.abort()}setElementaryStreamInfo(Z,ee,ae,ye,ve,be=!1){const{elementaryStreams:Ye}=this,Ke=Ye[Z];if(!Ke){Ye[Z]={startPTS:ee,endPTS:ae,startDTS:ye,endDTS:ve,partial:be};return}Ke.startPTS=Math.min(Ke.startPTS,ee),Ke.endPTS=Math.max(Ke.endPTS,ae),Ke.startDTS=Math.min(Ke.startDTS,ye),Ke.endDTS=Math.max(Ke.endDTS,ve)}clearElementaryStreamInfo(){const{elementaryStreams:Z}=this;Z[ElementaryStreamTypes.AUDIO]=null,Z[ElementaryStreamTypes.VIDEO]=null,Z[ElementaryStreamTypes.AUDIOVIDEO]=null}}class Part extends BaseSegment{constructor(Z,ee,ae,ye,ve){super(ae),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new LoadStats,this.duration=Z.decimalFloatingPoint("DURATION"),this.gap=Z.bool("GAP"),this.independent=Z.bool("INDEPENDENT"),this.relurl=Z.enumeratedString("URI"),this.fragment=ee,this.index=ye;const be=Z.enumeratedString("BYTERANGE");be&&this.setByteRange(be,ve),ve&&(this.fragOffset=ve.fragOffset+ve.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:Z}=this;return!!(Z.audio||Z.video||Z.audiovideo)}}const DEFAULT_TARGET_DURATION=10;class LevelDetails{constructor(Z){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=Z}reloaded(Z){if(!Z){this.advanced=!0,this.updated=!0;return}const ee=this.lastPartSn-Z.lastPartSn,ae=this.lastPartIndex-Z.lastPartIndex;this.updated=this.endSN!==Z.endSN||!!ae||!!ee||!this.live,this.advanced=this.endSN>Z.endSN||ee>0||ee===0&&ae>0,this.updated||this.advanced?this.misses=Math.floor(Z.misses*.6):this.misses=Z.misses+1,this.availabilityDelay=Z.availabilityDelay}get hasProgramDateTime(){return this.fragments.length?isFiniteNumber(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||DEFAULT_TARGET_DURATION}get drift(){const Z=this.driftEndTime-this.driftStartTime;return Z>0?(this.driftEnd-this.driftStart)*1e3/Z:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var Z;return(Z=this.partList)!=null&&Z.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var Z;return(Z=this.fragments)!=null&&Z.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var Z;return(Z=this.partList)!=null&&Z.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var Z;return(Z=this.partList)!=null&&Z.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function base64Decode(ie){return Uint8Array.from(atob(ie),Z=>Z.charCodeAt(0))}function getKeyIdBytes(ie){const Z=strToUtf8array(ie).subarray(0,16),ee=new Uint8Array(16);return ee.set(Z,16-Z.length),ee}function changeEndianness(ie){const Z=function(ee,ae,ye){const ve=ee[ae];ee[ae]=ee[ye],ee[ye]=ve};Z(ie,0,3),Z(ie,1,2),Z(ie,4,5),Z(ie,6,7)}function convertDataUriToArrayBytes(ie){const Z=ie.split(":");let ee=null;if(Z[0]==="data"&&Z.length===2){const ae=Z[1].split(";"),ye=ae[ae.length-1].split(",");if(ye.length===2){const ve=ye[0]==="base64",be=ye[1];ve?(ae.splice(-1,1),ee=base64Decode(be)):ee=getKeyIdBytes(be)}}return ee}function strToUtf8array(ie){return Uint8Array.from(unescape(encodeURIComponent(ie)),Z=>Z.charCodeAt(0))}const optionalSelf=typeof self<"u"?self:void 0;var KeySystems={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},KeySystemFormats={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function keySystemFormatToKeySystemDomain(ie){switch(ie){case KeySystemFormats.FAIRPLAY:return KeySystems.FAIRPLAY;case KeySystemFormats.PLAYREADY:return KeySystems.PLAYREADY;case KeySystemFormats.WIDEVINE:return KeySystems.WIDEVINE;case KeySystemFormats.CLEARKEY:return KeySystems.CLEARKEY}}var KeySystemIds={WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function keySystemIdToKeySystemDomain(ie){if(ie===KeySystemIds.WIDEVINE)return KeySystems.WIDEVINE}function keySystemDomainToKeySystemFormat(ie){switch(ie){case KeySystems.FAIRPLAY:return KeySystemFormats.FAIRPLAY;case KeySystems.PLAYREADY:return KeySystemFormats.PLAYREADY;case KeySystems.WIDEVINE:return KeySystemFormats.WIDEVINE;case KeySystems.CLEARKEY:return KeySystemFormats.CLEARKEY}}function getKeySystemsForConfig(ie){const{drmSystems:Z,widevineLicenseUrl:ee}=ie,ae=Z?[KeySystems.FAIRPLAY,KeySystems.WIDEVINE,KeySystems.PLAYREADY,KeySystems.CLEARKEY].filter(ye=>!!Z[ye]):[];return!ae[KeySystems.WIDEVINE]&&ee&&ae.push(KeySystems.WIDEVINE),ae}const requestMediaKeySystemAccess=function(ie){return optionalSelf!=null&&(ie=optionalSelf.navigator)!=null&&ie.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function getSupportedMediaKeySystemConfigurations(ie,Z,ee,ae){let ye;switch(ie){case KeySystems.FAIRPLAY:ye=["cenc","sinf"];break;case KeySystems.WIDEVINE:case KeySystems.PLAYREADY:ye=["cenc"];break;case KeySystems.CLEARKEY:ye=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${ie}`)}return createMediaKeySystemConfigurations(ye,Z,ee,ae)}function createMediaKeySystemConfigurations(ie,Z,ee,ae){return[{initDataTypes:ie,persistentState:ae.persistentState||"optional",distinctiveIdentifier:ae.distinctiveIdentifier||"optional",sessionTypes:ae.sessionTypes||[ae.sessionType||"temporary"],audioCapabilities:Z.map(ye=>({contentType:`audio/mp4; codecs="${ye}"`,robustness:ae.audioRobustness||"",encryptionScheme:ae.audioEncryptionScheme||null})),videoCapabilities:ee.map(ye=>({contentType:`video/mp4; codecs="${ye}"`,robustness:ae.videoRobustness||"",encryptionScheme:ae.videoEncryptionScheme||null}))}]}function sliceUint8(ie,Z,ee){return Uint8Array.prototype.slice?ie.slice(Z,ee):new Uint8Array(Array.prototype.slice.call(ie,Z,ee))}const isHeader$2=(ie,Z)=>Z+10<=ie.length&&ie[Z]===73&&ie[Z+1]===68&&ie[Z+2]===51&&ie[Z+3]<255&&ie[Z+4]<255&&ie[Z+6]<128&&ie[Z+7]<128&&ie[Z+8]<128&&ie[Z+9]<128,isFooter=(ie,Z)=>Z+10<=ie.length&&ie[Z]===51&&ie[Z+1]===68&&ie[Z+2]===73&&ie[Z+3]<255&&ie[Z+4]<255&&ie[Z+6]<128&&ie[Z+7]<128&&ie[Z+8]<128&&ie[Z+9]<128,getID3Data=(ie,Z)=>{const ee=Z;let ae=0;for(;isHeader$2(ie,Z);){ae+=10;const ye=readSize(ie,Z+6);ae+=ye,isFooter(ie,Z+10)&&(ae+=10),Z+=ae}if(ae>0)return ie.subarray(ee,ee+ae)},readSize=(ie,Z)=>{let ee=0;return ee=(ie[Z]&127)<<21,ee|=(ie[Z+1]&127)<<14,ee|=(ie[Z+2]&127)<<7,ee|=ie[Z+3]&127,ee},canParse$2=(ie,Z)=>isHeader$2(ie,Z)&&readSize(ie,Z+6)+10<=ie.length-Z,getTimeStamp=ie=>{const Z=getID3Frames(ie);for(let ee=0;ee<Z.length;ee++){const ae=Z[ee];if(isTimeStampFrame(ae))return readTimeStamp(ae)}},isTimeStampFrame=ie=>ie&&ie.key==="PRIV"&&ie.info==="com.apple.streaming.transportStreamTimestamp",getFrameData=ie=>{const Z=String.fromCharCode(ie[0],ie[1],ie[2],ie[3]),ee=readSize(ie,4),ae=10;return{type:Z,size:ee,data:ie.subarray(ae,ae+ee)}},getID3Frames=ie=>{let Z=0;const ee=[];for(;isHeader$2(ie,Z);){const ae=readSize(ie,Z+6);Z+=10;const ye=Z+ae;for(;Z+8<ye;){const ve=getFrameData(ie.subarray(Z)),be=decodeFrame(ve);be&&ee.push(be),Z+=ve.size+10}isFooter(ie,Z)&&(Z+=10)}return ee},decodeFrame=ie=>ie.type==="PRIV"?decodePrivFrame(ie):ie.type[0]==="W"?decodeURLFrame(ie):decodeTextFrame(ie),decodePrivFrame=ie=>{if(ie.size<2)return;const Z=utf8ArrayToStr(ie.data,!0),ee=new Uint8Array(ie.data.subarray(Z.length+1));return{key:ie.type,info:Z,data:ee.buffer}},decodeTextFrame=ie=>{if(ie.size<2)return;if(ie.type==="TXXX"){let ee=1;const ae=utf8ArrayToStr(ie.data.subarray(ee),!0);ee+=ae.length+1;const ye=utf8ArrayToStr(ie.data.subarray(ee));return{key:ie.type,info:ae,data:ye}}const Z=utf8ArrayToStr(ie.data.subarray(1));return{key:ie.type,data:Z}},decodeURLFrame=ie=>{if(ie.type==="WXXX"){if(ie.size<2)return;let ee=1;const ae=utf8ArrayToStr(ie.data.subarray(ee),!0);ee+=ae.length+1;const ye=utf8ArrayToStr(ie.data.subarray(ee));return{key:ie.type,info:ae,data:ye}}const Z=utf8ArrayToStr(ie.data);return{key:ie.type,data:Z}},readTimeStamp=ie=>{if(ie.data.byteLength===8){const Z=new Uint8Array(ie.data),ee=Z[3]&1;let ae=(Z[4]<<23)+(Z[5]<<15)+(Z[6]<<7)+Z[7];return ae/=45,ee&&(ae+=4772185884e-2),Math.round(ae)}},utf8ArrayToStr=(ie,Z=!1)=>{const ee=getTextDecoder();if(ee){const Xe=ee.decode(ie);if(Z){const Je=Xe.indexOf("\0");return Je!==-1?Xe.substring(0,Je):Xe}return Xe.replace(/\0/g,"")}const ae=ie.length;let ye,ve,be,Ye="",Ke=0;for(;Ke<ae;){if(ye=ie[Ke++],ye===0&&Z)return Ye;if(!(ye===0||ye===3))switch(ye>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:Ye+=String.fromCharCode(ye);break;case 12:case 13:ve=ie[Ke++],Ye+=String.fromCharCode((ye&31)<<6|ve&63);break;case 14:ve=ie[Ke++],be=ie[Ke++],Ye+=String.fromCharCode((ye&15)<<12|(ve&63)<<6|(be&63)<<0);break}}return Ye};let decoder;function getTextDecoder(){if(!navigator.userAgent.includes("PlayStation 4"))return!decoder&&typeof self.TextDecoder<"u"&&(decoder=new self.TextDecoder("utf-8")),decoder}const Hex={hexDump:function(ie){let Z="";for(let ee=0;ee<ie.length;ee++){let ae=ie[ee].toString(16);ae.length<2&&(ae="0"+ae),Z+=ae}return Z}},UINT32_MAX$1=Math.pow(2,32)-1,push=[].push,RemuxerTrackIdConfig={video:1,audio:2,id3:3,text:4};function bin2str(ie){return String.fromCharCode.apply(null,ie)}function readUint16(ie,Z){const ee=ie[Z]<<8|ie[Z+1];return ee<0?65536+ee:ee}function readUint32(ie,Z){const ee=readSint32(ie,Z);return ee<0?4294967296+ee:ee}function readSint32(ie,Z){return ie[Z]<<24|ie[Z+1]<<16|ie[Z+2]<<8|ie[Z+3]}function writeUint32(ie,Z,ee){ie[Z]=ee>>24,ie[Z+1]=ee>>16&255,ie[Z+2]=ee>>8&255,ie[Z+3]=ee&255}function hasMoofData(ie){const Z=ie.byteLength;for(let ee=0;ee<Z;){const ae=readUint32(ie,ee);if(ae>8&&ie[ee+4]===109&&ie[ee+5]===111&&ie[ee+6]===111&&ie[ee+7]===102)return!0;ee=ae>1?ee+ae:Z}return!1}function findBox(ie,Z){const ee=[];if(!Z.length)return ee;const ae=ie.byteLength;for(let ye=0;ye<ae;){const ve=readUint32(ie,ye),be=bin2str(ie.subarray(ye+4,ye+8)),Ye=ve>1?ye+ve:ae;if(be===Z[0])if(Z.length===1)ee.push(ie.subarray(ye+8,Ye));else{const Ke=findBox(ie.subarray(ye+8,Ye),Z.slice(1));Ke.length&&push.apply(ee,Ke)}ye=Ye}return ee}function parseSegmentIndex(ie){const Z=[],ee=ie[0];let ae=8;const ye=readUint32(ie,ae);ae+=4;const ve=0,be=0;ee===0?ae+=8:ae+=16,ae+=2;let Ye=ie.length+be;const Ke=readUint16(ie,ae);ae+=2;for(let Xe=0;Xe<Ke;Xe++){let Je=ae;const rt=readUint32(ie,Je);Je+=4;const nt=rt&2147483647;if((rt&2147483648)>>>31===1)return logger.warn("SIDX has hierarchical references (not supported)"),null;const it=readUint32(ie,Je);Je+=4,Z.push({referenceSize:nt,subsegmentDuration:it,info:{duration:it/ye,start:Ye,end:Ye+nt-1}}),Ye+=nt,Je+=4,ae=Je}return{earliestPresentationTime:ve,timescale:ye,version:ee,referencesCount:Ke,references:Z}}function parseInitSegment(ie){const Z=[],ee=findBox(ie,["moov","trak"]);for(let ae=0;ae<ee.length;ae++){const ye=ee[ae],ve=findBox(ye,["tkhd"])[0];if(ve){let be=ve[0];const Ye=readUint32(ve,be===0?12:20),Ke=findBox(ye,["mdia","mdhd"])[0];if(Ke){be=Ke[0];const Xe=readUint32(Ke,be===0?12:20),Je=findBox(ye,["mdia","hdlr"])[0];if(Je){const rt=bin2str(Je.subarray(8,12)),nt={soun:ElementaryStreamTypes.AUDIO,vide:ElementaryStreamTypes.VIDEO}[rt];if(nt){const it=findBox(ye,["mdia","minf","stbl","stsd"])[0],lt=parseStsd(it);Z[Ye]={timescale:Xe,type:nt},Z[nt]=_objectSpread2({timescale:Xe,id:Ye},lt)}}}}}return findBox(ie,["moov","mvex","trex"]).forEach(ae=>{const ye=readUint32(ae,4),ve=Z[ye];ve&&(ve.default={duration:readUint32(ae,12),flags:readUint32(ae,20)})}),Z}function parseStsd(ie){const Z=ie.subarray(8),ee=Z.subarray(86),ae=bin2str(Z.subarray(4,8));let ye=ae;const ve=ae==="enca"||ae==="encv";if(ve){const be=findBox(Z,[ae])[0].subarray(ae==="enca"?28:78);findBox(be,["sinf"]).forEach(Ye=>{const Ke=findBox(Ye,["schm"])[0];if(Ke){const Xe=bin2str(Ke.subarray(4,8));if(Xe==="cbcs"||Xe==="cenc"){const Je=findBox(Ye,["frma"])[0];Je&&(ye=bin2str(Je))}}})}switch(ye){case"avc1":case"avc2":case"avc3":case"avc4":{const be=findBox(ee,["avcC"])[0];ye+="."+toHex(be[1])+toHex(be[2])+toHex(be[3]);break}case"mp4a":{const be=findBox(Z,[ae])[0],Ye=findBox(be.subarray(28),["esds"])[0];if(Ye&&Ye.length>12){let Ke=4;if(Ye[Ke++]!==3)break;Ke=skipBERInteger(Ye,Ke),Ke+=2;const Xe=Ye[Ke++];if(Xe&128&&(Ke+=2),Xe&64&&(Ke+=Ye[Ke++]),Ye[Ke++]!==4)break;Ke=skipBERInteger(Ye,Ke);const Je=Ye[Ke++];if(Je===64)ye+="."+toHex(Je);else break;if(Ke+=12,Ye[Ke++]!==5)break;Ke=skipBERInteger(Ye,Ke);const rt=Ye[Ke++];let nt=(rt&248)>>3;nt===31&&(nt+=1+((rt&7)<<3)+((Ye[Ke]&224)>>5)),ye+="."+nt}break}case"hvc1":case"hev1":{const be=findBox(ee,["hvcC"])[0],Ye=be[1],Ke=["","A","B","C"][Ye>>6],Xe=Ye&31,Je=readUint32(be,2),rt=(Ye&32)>>5?"H":"L",nt=be[12],it=be.subarray(6,12);ye+="."+Ke+Xe,ye+="."+Je.toString(16).toUpperCase(),ye+="."+rt+nt;let lt="";for(let ct=it.length;ct--;){const ot=it[ct];(ot||lt)&&(lt="."+ot.toString(16).toUpperCase()+lt)}ye+=lt;break}case"dvh1":case"dvhe":{const be=findBox(ee,["dvcC"])[0],Ye=be[2]>>1&127,Ke=be[2]<<5&32|be[3]>>3&31;ye+="."+addLeadingZero(Ye)+"."+addLeadingZero(Ke);break}case"vp09":{const be=findBox(ee,["vpcC"])[0],Ye=be[4],Ke=be[5],Xe=be[6]>>4&15;ye+="."+addLeadingZero(Ye)+"."+addLeadingZero(Ke)+"."+addLeadingZero(Xe);break}case"av01":{const be=findBox(ee,["av1C"])[0],Ye=be[1]>>>5,Ke=be[1]&31,Xe=be[2]>>>7?"H":"M",Je=(be[2]&64)>>6,rt=(be[2]&32)>>5,nt=Ye===2&&Je?rt?12:10:Je?10:8,it=(be[2]&16)>>4,lt=(be[2]&8)>>3,ct=(be[2]&4)>>2,ot=be[2]&3;ye+="."+Ye+"."+addLeadingZero(Ke)+Xe+"."+addLeadingZero(nt)+"."+it+"."+lt+ct+ot+"."+addLeadingZero(1)+"."+addLeadingZero(1)+"."+addLeadingZero(1)+".0";break}}return{codec:ye,encrypted:ve}}function skipBERInteger(ie,Z){const ee=Z+5;for(;ie[Z++]&128&&Z<ee;);return Z}function toHex(ie){return("0"+ie.toString(16).toUpperCase()).slice(-2)}function addLeadingZero(ie){return(ie<10?"0":"")+ie}function patchEncyptionData(ie,Z){if(!ie||!Z)return ie;const ee=Z.keyId;return ee&&Z.isCommonEncryption&&findBox(ie,["moov","trak"]).forEach(ae=>{const ye=findBox(ae,["mdia","minf","stbl","stsd"])[0].subarray(8);let ve=findBox(ye,["enca"]);const be=ve.length>0;be||(ve=findBox(ye,["encv"])),ve.forEach(Ye=>{const Ke=be?Ye.subarray(28):Ye.subarray(78);findBox(Ke,["sinf"]).forEach(Xe=>{const Je=parseSinf(Xe);if(Je){const rt=Je.subarray(8,24);rt.some(nt=>nt!==0)||(logger.log(`[eme] Patching keyId in 'enc${be?"a":"v"}>sinf>>tenc' box: ${Hex.hexDump(rt)} -> ${Hex.hexDump(ee)}`),Je.set(ee,8))}})})}),ie}function parseSinf(ie){const Z=findBox(ie,["schm"])[0];if(Z){const ee=bin2str(Z.subarray(4,8));if(ee==="cbcs"||ee==="cenc")return findBox(ie,["schi","tenc"])[0]}return logger.error("[eme] missing 'schm' box"),null}function getStartDTS(ie,Z){return findBox(Z,["moof","traf"]).reduce((ee,ae)=>{const ye=findBox(ae,["tfdt"])[0],ve=ye[0],be=findBox(ae,["tfhd"]).reduce((Ye,Ke)=>{const Xe=readUint32(Ke,4),Je=ie[Xe];if(Je){let rt=readUint32(ye,4);if(ve===1){if(rt===UINT32_MAX$1)return logger.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),Ye;rt*=UINT32_MAX$1+1,rt+=readUint32(ye,8)}const nt=Je.timescale||9e4,it=rt/nt;if(isFiniteNumber(it)&&(Ye===null||it<Ye))return it}return Ye},null);return be!==null&&isFiniteNumber(be)&&(ee===null||be<ee)?be:ee},null)}function getDuration(ie,Z){let ee=0,ae=0,ye=0;const ve=findBox(ie,["moof","traf"]);for(let be=0;be<ve.length;be++){const Ye=ve[be],Ke=findBox(Ye,["tfhd"])[0],Xe=readUint32(Ke,4),Je=Z[Xe];if(!Je)continue;const rt=Je.default,nt=readUint32(Ke,0)|(rt==null?void 0:rt.flags);let it=rt==null?void 0:rt.duration;nt&8&&(nt&2?it=readUint32(Ke,12):it=readUint32(Ke,8));const lt=Je.timescale||9e4,ct=findBox(Ye,["trun"]);for(let ot=0;ot<ct.length;ot++){if(ee=computeRawDurationFromSamples(ct[ot]),!ee&&it){const dt=readUint32(ct[ot],4);ee=it*dt}Je.type===ElementaryStreamTypes.VIDEO?ae+=ee/lt:Je.type===ElementaryStreamTypes.AUDIO&&(ye+=ee/lt)}}if(ae===0&&ye===0){let be=0;const Ye=findBox(ie,["sidx"]);for(let Ke=0;Ke<Ye.length;Ke++){const Xe=parseSegmentIndex(Ye[Ke]);Xe!=null&&Xe.references&&(be+=Xe.references.reduce((Je,rt)=>Je+rt.info.duration||0,0))}return be}return ae||ye}function computeRawDurationFromSamples(ie){const Z=readUint32(ie,0);let ee=8;Z&1&&(ee+=4),Z&4&&(ee+=4);let ae=0;const ye=readUint32(ie,4);for(let ve=0;ve<ye;ve++){if(Z&256){const be=readUint32(ie,ee);ae+=be,ee+=4}Z&512&&(ee+=4),Z&1024&&(ee+=4),Z&2048&&(ee+=4)}return ae}function offsetStartDTS(ie,Z,ee){findBox(Z,["moof","traf"]).forEach(ae=>{findBox(ae,["tfhd"]).forEach(ye=>{const ve=readUint32(ye,4),be=ie[ve];if(!be)return;const Ye=be.timescale||9e4;findBox(ae,["tfdt"]).forEach(Ke=>{const Xe=Ke[0],Je=ee*Ye;if(Je){let rt=readUint32(Ke,4);if(Xe===0)rt-=Je,rt=Math.max(rt,0),writeUint32(Ke,4,rt);else{rt*=Math.pow(2,32),rt+=readUint32(Ke,8),rt-=Je,rt=Math.max(rt,0);const nt=Math.floor(rt/(UINT32_MAX$1+1)),it=Math.floor(rt%(UINT32_MAX$1+1));writeUint32(Ke,4,nt),writeUint32(Ke,8,it)}}})})})}function segmentValidRange(ie){const Z={valid:null,remainder:null},ee=findBox(ie,["moof"]);if(ee.length<2)return Z.remainder=ie,Z;const ae=ee[ee.length-1];return Z.valid=sliceUint8(ie,0,ae.byteOffset-8),Z.remainder=sliceUint8(ie,ae.byteOffset-8),Z}function appendUint8Array(ie,Z){const ee=new Uint8Array(ie.length+Z.length);return ee.set(ie),ee.set(Z,ie.length),ee}function parseSamples(ie,Z){const ee=[],ae=Z.samples,ye=Z.timescale,ve=Z.id;let be=!1;return findBox(ae,["moof"]).map(Ye=>{const Ke=Ye.byteOffset-8;findBox(Ye,["traf"]).map(Xe=>{const Je=findBox(Xe,["tfdt"]).map(rt=>{const nt=rt[0];let it=readUint32(rt,4);return nt===1&&(it*=Math.pow(2,32),it+=readUint32(rt,8)),it/ye})[0];return Je!==void 0&&(ie=Je),findBox(Xe,["tfhd"]).map(rt=>{const nt=readUint32(rt,4),it=readUint32(rt,0)&16777215,lt=(it&1)!==0,ct=(it&2)!==0,ot=(it&8)!==0;let dt=0;const ft=(it&16)!==0;let gt=0;const mt=(it&32)!==0;let Yr=8;nt===ve&&(lt&&(Yr+=8),ct&&(Yr+=4),ot&&(dt=readUint32(rt,Yr),Yr+=4),ft&&(gt=readUint32(rt,Yr),Yr+=4),mt&&(Yr+=4),Z.type==="video"&&(be=isHEVC(Z.codec)),findBox(Xe,["trun"]).map(Qr=>{const Xr=Qr[0],Jr=readUint32(Qr,0)&16777215,ai=(Jr&1)!==0;let oi=0;const ni=(Jr&4)!==0,li=(Jr&256)!==0;let ui=0;const mi=(Jr&512)!==0;let ii=0;const hi=(Jr&1024)!==0,ri=(Jr&2048)!==0;let ci=0;const Si=readUint32(Qr,4);let si=8;ai&&(oi=readUint32(Qr,si),si+=4),ni&&(si+=4);let Ei=oi+Ke;for(let yi=0;yi<Si;yi++){if(li?(ui=readUint32(Qr,si),si+=4):ui=dt,mi?(ii=readUint32(Qr,si),si+=4):ii=gt,hi&&(si+=4),ri&&(Xr===0?ci=readUint32(Qr,si):ci=readSint32(Qr,si),si+=4),Z.type===ElementaryStreamTypes.VIDEO){let Mi=0;for(;Mi<ii;){const Ci=readUint32(ae,Ei);if(Ei+=4,isSEIMessage(be,ae[Ei])){const Ri=ae.subarray(Ei,Ei+Ci);parseSEIMessageFromNALu(Ri,be?2:1,ie+ci/ye,ee)}Ei+=Ci,Mi+=Ci+4}}ie+=ui/ye}}))})})}),ee}function isHEVC(ie){if(!ie)return!1;const Z=ie.indexOf("."),ee=Z<0?ie:ie.substring(0,Z);return ee==="hvc1"||ee==="hev1"||ee==="dvh1"||ee==="dvhe"}function isSEIMessage(ie,Z){if(ie){const ee=Z>>1&63;return ee===39||ee===40}else return(Z&31)===6}function parseSEIMessageFromNALu(ie,Z,ee,ae){const ye=discardEPB(ie);let ve=0;ve+=Z;let be=0,Ye=0,Ke=0;for(;ve<ye.length;){be=0;do{if(ve>=ye.length)break;Ke=ye[ve++],be+=Ke}while(Ke===255);Ye=0;do{if(ve>=ye.length)break;Ke=ye[ve++],Ye+=Ke}while(Ke===255);const Xe=ye.length-ve;let Je=ve;if(Ye<Xe)ve+=Ye;else if(Ye>Xe){logger.error(`Malformed SEI payload. ${Ye} is too small, only ${Xe} bytes left to parse.`);break}if(be===4){if(ye[Je++]===181){const rt=readUint16(ye,Je);if(Je+=2,rt===49){const nt=readUint32(ye,Je);if(Je+=4,nt===1195456820){const it=ye[Je++];if(it===3){const lt=ye[Je++],ct=31&lt,ot=64&lt,dt=ot?2+ct*3:0,ft=new Uint8Array(dt);if(ot){ft[0]=lt;for(let gt=1;gt<dt;gt++)ft[gt]=ye[Je++]}ae.push({type:it,payloadType:be,pts:ee,bytes:ft})}}}}}else if(be===5&&Ye>16){const rt=[];for(let lt=0;lt<16;lt++){const ct=ye[Je++].toString(16);rt.push(ct.length==1?"0"+ct:ct),(lt===3||lt===5||lt===7||lt===9)&&rt.push("-")}const nt=Ye-16,it=new Uint8Array(nt);for(let lt=0;lt<nt;lt++)it[lt]=ye[Je++];ae.push({payloadType:be,pts:ee,uuid:rt.join(""),userData:utf8ArrayToStr(it),userDataBytes:it})}}}function discardEPB(ie){const Z=ie.byteLength,ee=[];let ae=1;for(;ae<Z-2;)ie[ae]===0&&ie[ae+1]===0&&ie[ae+2]===3?(ee.push(ae+2),ae+=2):ae++;if(ee.length===0)return ie;const ye=Z-ee.length,ve=new Uint8Array(ye);let be=0;for(ae=0;ae<ye;be++,ae++)be===ee[0]&&(be++,ee.shift()),ve[ae]=ie[be];return ve}function parseEmsg(ie){const Z=ie[0];let ee="",ae="",ye=0,ve=0,be=0,Ye=0,Ke=0,Xe=0;if(Z===0){for(;bin2str(ie.subarray(Xe,Xe+1))!=="\0";)ee+=bin2str(ie.subarray(Xe,Xe+1)),Xe+=1;for(ee+=bin2str(ie.subarray(Xe,Xe+1)),Xe+=1;bin2str(ie.subarray(Xe,Xe+1))!=="\0";)ae+=bin2str(ie.subarray(Xe,Xe+1)),Xe+=1;ae+=bin2str(ie.subarray(Xe,Xe+1)),Xe+=1,ye=readUint32(ie,12),ve=readUint32(ie,16),Ye=readUint32(ie,20),Ke=readUint32(ie,24),Xe=28}else if(Z===1){Xe+=4,ye=readUint32(ie,Xe),Xe+=4;const rt=readUint32(ie,Xe);Xe+=4;const nt=readUint32(ie,Xe);for(Xe+=4,be=2**32*rt+nt,isSafeInteger(be)||(be=Number.MAX_SAFE_INTEGER,logger.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),Ye=readUint32(ie,Xe),Xe+=4,Ke=readUint32(ie,Xe),Xe+=4;bin2str(ie.subarray(Xe,Xe+1))!=="\0";)ee+=bin2str(ie.subarray(Xe,Xe+1)),Xe+=1;for(ee+=bin2str(ie.subarray(Xe,Xe+1)),Xe+=1;bin2str(ie.subarray(Xe,Xe+1))!=="\0";)ae+=bin2str(ie.subarray(Xe,Xe+1)),Xe+=1;ae+=bin2str(ie.subarray(Xe,Xe+1)),Xe+=1}const Je=ie.subarray(Xe,ie.byteLength);return{schemeIdUri:ee,value:ae,timeScale:ye,presentationTime:be,presentationTimeDelta:ve,eventDuration:Ye,id:Ke,payload:Je}}function mp4Box(ie,...Z){const ee=Z.length;let ae=8,ye=ee;for(;ye--;)ae+=Z[ye].byteLength;const ve=new Uint8Array(ae);for(ve[0]=ae>>24&255,ve[1]=ae>>16&255,ve[2]=ae>>8&255,ve[3]=ae&255,ve.set(ie,4),ye=0,ae=8;ye<ee;ye++)ve.set(Z[ye],ae),ae+=Z[ye].byteLength;return ve}function mp4pssh(ie,Z,ee){if(ie.byteLength!==16)throw new RangeError("Invalid system id");let ae,ye;ae=0,ye=new Uint8Array;let ve;ae>0?(ve=new Uint8Array(4),Z.length>0&&new DataView(ve.buffer).setUint32(0,Z.length,!1)):ve=new Uint8Array;const be=new Uint8Array(4);return ee&&ee.byteLength>0&&new DataView(be.buffer).setUint32(0,ee.byteLength,!1),mp4Box([112,115,115,104],new Uint8Array([ae,0,0,0]),ie,ve,ye,be,ee||new Uint8Array)}function parsePssh(ie){if(!(ie instanceof ArrayBuffer)||ie.byteLength<32)return null;const Z={version:0,systemId:"",kids:null,data:null},ee=new DataView(ie),ae=ee.getUint32(0);if(ie.byteLength!==ae&&ae>44||ee.getUint32(4)!==1886614376||(Z.version=ee.getUint32(8)>>>24,Z.version>1))return null;Z.systemId=Hex.hexDump(new Uint8Array(ie,12,16));const ye=ee.getUint32(28);if(Z.version===0){if(ae-32<ye)return null;Z.data=new Uint8Array(ie,32,ye)}else if(Z.version===1){Z.kids=[];for(let ve=0;ve<ye;ve++)Z.kids.push(new Uint8Array(ie,32+ve*16,16))}return Z}let keyUriToKeyIdMap={};class LevelKey{static clearKeyUriToKeyIdMap(){keyUriToKeyIdMap={}}constructor(Z,ee,ae,ye=[1],ve=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=Z,this.uri=ee,this.keyFormat=ae,this.keyFormatVersions=ye,this.iv=ve,this.encrypted=Z?Z!=="NONE":!1,this.isCommonEncryption=this.encrypted&&Z!=="AES-128"}isSupported(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case KeySystemFormats.FAIRPLAY:case KeySystemFormats.WIDEVINE:case KeySystemFormats.PLAYREADY:case KeySystemFormats.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(Z){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof Z!="number"&&(this.method==="AES-128"&&!this.iv&&logger.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),Z=0);const ae=createInitializationVector(Z);return new LevelKey(this.method,this.uri,"identity",this.keyFormatVersions,ae)}const ee=convertDataUriToArrayBytes(this.uri);if(ee)switch(this.keyFormat){case KeySystemFormats.WIDEVINE:this.pssh=ee,ee.length>=22&&(this.keyId=ee.subarray(ee.length-22,ee.length-6));break;case KeySystemFormats.PLAYREADY:{const ae=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=mp4pssh(ae,null,ee);const ye=new Uint16Array(ee.buffer,ee.byteOffset,ee.byteLength/2),ve=String.fromCharCode.apply(null,Array.from(ye)),be=ve.substring(ve.indexOf("<"),ve.length),Ye=new DOMParser().parseFromString(be,"text/xml").getElementsByTagName("KID")[0];if(Ye){const Ke=Ye.childNodes[0]?Ye.childNodes[0].nodeValue:Ye.getAttribute("VALUE");if(Ke){const Xe=base64Decode(Ke).subarray(0,16);changeEndianness(Xe),this.keyId=Xe}}break}default:{let ae=ee.subarray(0,16);if(ae.length!==16){const ye=new Uint8Array(16);ye.set(ae,16-ae.length),ae=ye}this.keyId=ae;break}}if(!this.keyId||this.keyId.byteLength!==16){let ae=keyUriToKeyIdMap[this.uri];if(!ae){const ye=Object.keys(keyUriToKeyIdMap).length%Number.MAX_SAFE_INTEGER;ae=new Uint8Array(16),new DataView(ae.buffer,12,4).setUint32(0,ye),keyUriToKeyIdMap[this.uri]=ae}this.keyId=ae}return this}}function createInitializationVector(ie){const Z=new Uint8Array(16);for(let ee=12;ee<16;ee++)Z[ee]=ie>>8*(15-ee)&255;return Z}const VARIABLE_REPLACEMENT_REGEX=/\{\$([a-zA-Z0-9-_]+)\}/g;function hasVariableReferences(ie){return VARIABLE_REPLACEMENT_REGEX.test(ie)}function substituteVariablesInAttributes(ie,Z,ee){if(ie.variableList!==null||ie.hasVariableRefs)for(let ae=ee.length;ae--;){const ye=ee[ae],ve=Z[ye];ve&&(Z[ye]=substituteVariables(ie,ve))}}function substituteVariables(ie,Z){if(ie.variableList!==null||ie.hasVariableRefs){const ee=ie.variableList;return Z.replace(VARIABLE_REPLACEMENT_REGEX,ae=>{const ye=ae.substring(2,ae.length-1),ve=ee==null?void 0:ee[ye];return ve===void 0?(ie.playlistParsingError||(ie.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${ye}"`)),ae):ve})}return Z}function addVariableDefinition(ie,Z,ee){let ae=ie.variableList;ae||(ie.variableList=ae={});let ye,ve;if("QUERYPARAM"in Z){ye=Z.QUERYPARAM;try{const be=new self.URL(ee).searchParams;if(be.has(ye))ve=be.get(ye);else throw new Error(`"${ye}" does not match any query parameter in URI: "${ee}"`)}catch(be){ie.playlistParsingError||(ie.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${be.message}`))}}else ye=Z.NAME,ve=Z.VALUE;ye in ae?ie.playlistParsingError||(ie.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${ye}"`)):ae[ye]=ve||""}function importVariableDefinition(ie,Z,ee){const ae=Z.IMPORT;if(ee&&ae in ee){let ye=ie.variableList;ye||(ie.variableList=ye={}),ye[ae]=ee[ae]}else ie.playlistParsingError||(ie.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${ae}"`))}function getMediaSource(ie=!0){return typeof self>"u"?void 0:(ie||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}const sampleEntryCodesISO={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function isCodecType(ie,Z){const ee=sampleEntryCodesISO[Z];return!!ee&&!!ee[ie.slice(0,4)]}function areCodecsMediaSourceSupported(ie,Z,ee=!0){return!ie.split(",").some(ae=>!isCodecMediaSourceSupported(ae,Z,ee))}function isCodecMediaSourceSupported(ie,Z,ee=!0){var ae;const ye=getMediaSource(ee);return(ae=ye==null?void 0:ye.isTypeSupported(mimeTypeForCodec(ie,Z)))!=null?ae:!1}function mimeTypeForCodec(ie,Z){return`${Z}/mp4;codecs="${ie}"`}function videoCodecPreferenceValue(ie){if(ie){const Z=ie.substring(0,4);return sampleEntryCodesISO.video[Z]}return 2}function codecsSetSelectionPreferenceValue(ie){return ie.split(",").reduce((Z,ee)=>{const ae=sampleEntryCodesISO.video[ee];return ae?(ae*2+Z)/(Z?3:2):(sampleEntryCodesISO.audio[ee]+Z)/(Z?2:1)},0)}const CODEC_COMPATIBLE_NAMES={};function getCodecCompatibleNameLower(ie,Z=!0){if(CODEC_COMPATIBLE_NAMES[ie])return CODEC_COMPATIBLE_NAMES[ie];const ee={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"]}[ie];for(let ae=0;ae<ee.length;ae++)if(isCodecMediaSourceSupported(ee[ae],"audio",Z))return CODEC_COMPATIBLE_NAMES[ie]=ee[ae],ee[ae];return ie}const AUDIO_CODEC_REGEXP=/flac|opus/i;function getCodecCompatibleName(ie,Z=!0){return ie.replace(AUDIO_CODEC_REGEXP,ee=>getCodecCompatibleNameLower(ee.toLowerCase(),Z))}function pickMostCompleteCodecName(ie,Z){return ie&&ie!=="mp4a"?ie:Z}function convertAVC1ToAVCOTI(ie){const Z=ie.split(".");if(Z.length>2){let ee=Z.shift()+".";return ee+=parseInt(Z.shift()).toString(16),ee+=("000"+parseInt(Z.shift()).toString(16)).slice(-4),ee}return ie}const MASTER_PLAYLIST_REGEX=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,MASTER_PLAYLIST_MEDIA_REGEX=/#EXT-X-MEDIA:(.*)/g,IS_MEDIA_PLAYLIST=/^#EXT(?:INF|-X-TARGETDURATION):/m,LEVEL_PLAYLIST_REGEX_FAST=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),LEVEL_PLAYLIST_REGEX_SLOW=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class M3U8Parser{static findGroup(Z,ee){for(let ae=0;ae<Z.length;ae++){const ye=Z[ae];if(ye.id===ee)return ye}}static resolve(Z,ee){return urlToolkitExports.buildAbsoluteURL(ee,Z,{alwaysNormalize:!0})}static isMediaPlaylist(Z){return IS_MEDIA_PLAYLIST.test(Z)}static parseMasterPlaylist(Z,ee){const ae=hasVariableReferences(Z),ye={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:ae},ve=[];MASTER_PLAYLIST_REGEX.lastIndex=0;let be;for(;(be=MASTER_PLAYLIST_REGEX.exec(Z))!=null;)if(be[1]){var Ye;const Xe=new AttrList(be[1]);substituteVariablesInAttributes(ye,Xe,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const Je=substituteVariables(ye,be[2]),rt={attrs:Xe,bitrate:Xe.decimalInteger("BANDWIDTH")||Xe.decimalInteger("AVERAGE-BANDWIDTH"),name:Xe.NAME,url:M3U8Parser.resolve(Je,ee)},nt=Xe.decimalResolution("RESOLUTION");nt&&(rt.width=nt.width,rt.height=nt.height),setCodecs(Xe.CODECS,rt),(Ye=rt.unknownCodecs)!=null&&Ye.length||ve.push(rt),ye.levels.push(rt)}else if(be[3]){const Xe=be[3],Je=be[4];switch(Xe){case"SESSION-DATA":{const rt=new AttrList(Je);substituteVariablesInAttributes(ye,rt,["DATA-ID","LANGUAGE","VALUE","URI"]);const nt=rt["DATA-ID"];nt&&(ye.sessionData===null&&(ye.sessionData={}),ye.sessionData[nt]=rt);break}case"SESSION-KEY":{const rt=parseKey(Je,ee,ye);rt.encrypted&&rt.isSupported()?(ye.sessionKeys===null&&(ye.sessionKeys=[]),ye.sessionKeys.push(rt)):logger.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${Je}"`);break}case"DEFINE":{{const rt=new AttrList(Je);substituteVariablesInAttributes(ye,rt,["NAME","VALUE","QUERYPARAM"]),addVariableDefinition(ye,rt,ee)}break}case"CONTENT-STEERING":{const rt=new AttrList(Je);substituteVariablesInAttributes(ye,rt,["SERVER-URI","PATHWAY-ID"]),ye.contentSteering={uri:M3U8Parser.resolve(rt["SERVER-URI"],ee),pathwayId:rt["PATHWAY-ID"]||"."};break}case"START":{ye.startTimeOffset=parseStartTimeOffset(Je);break}}}const Ke=ve.length>0&&ve.length<ye.levels.length;return ye.levels=Ke?ve:ye.levels,ye.levels.length===0&&(ye.playlistParsingError=new Error("no levels found in manifest")),ye}static parseMasterPlaylistMedia(Z,ee,ae){let ye;const ve={},be=ae.levels,Ye={AUDIO:be.map(Xe=>({id:Xe.attrs.AUDIO,audioCodec:Xe.audioCodec})),SUBTITLES:be.map(Xe=>({id:Xe.attrs.SUBTITLES,textCodec:Xe.textCodec})),"CLOSED-CAPTIONS":[]};let Ke=0;for(MASTER_PLAYLIST_MEDIA_REGEX.lastIndex=0;(ye=MASTER_PLAYLIST_MEDIA_REGEX.exec(Z))!==null;){const Xe=new AttrList(ye[1]),Je=Xe.TYPE;if(Je){const rt=Ye[Je],nt=ve[Je]||[];ve[Je]=nt,substituteVariablesInAttributes(ae,Xe,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const it=Xe.LANGUAGE,lt=Xe["ASSOC-LANGUAGE"],ct=Xe.CHANNELS,ot=Xe.CHARACTERISTICS,dt=Xe["INSTREAM-ID"],ft={attrs:Xe,bitrate:0,id:Ke++,groupId:Xe["GROUP-ID"]||"",name:Xe.NAME||it||"",type:Je,default:Xe.bool("DEFAULT"),autoselect:Xe.bool("AUTOSELECT"),forced:Xe.bool("FORCED"),lang:it,url:Xe.URI?M3U8Parser.resolve(Xe.URI,ee):""};if(lt&&(ft.assocLang=lt),ct&&(ft.channels=ct),ot&&(ft.characteristics=ot),dt&&(ft.instreamId=dt),rt!=null&&rt.length){const gt=M3U8Parser.findGroup(rt,ft.groupId)||rt[0];assignCodec(ft,gt,"audioCodec"),assignCodec(ft,gt,"textCodec")}nt.push(ft)}}return ve}static parseLevelPlaylist(Z,ee,ae,ye,ve,be){const Ye=new LevelDetails(ee),Ke=Ye.fragments;let Xe=null,Je=0,rt=0,nt=0,it=0,lt=null,ct=new Fragment(ye,ee),ot,dt,ft,gt=-1,mt=!1,Yr=null;for(LEVEL_PLAYLIST_REGEX_FAST.lastIndex=0,Ye.m3u8=Z,Ye.hasVariableRefs=hasVariableReferences(Z);(ot=LEVEL_PLAYLIST_REGEX_FAST.exec(Z))!==null;){mt&&(mt=!1,ct=new Fragment(ye,ee),ct.start=nt,ct.sn=Je,ct.cc=it,ct.level=ae,Xe&&(ct.initSegment=Xe,ct.rawProgramDateTime=Xe.rawProgramDateTime,Xe.rawProgramDateTime=null,Yr&&(ct.setByteRange(Yr),Yr=null)));const ai=ot[1];if(ai){ct.duration=parseFloat(ai);const oi=(" "+ot[2]).slice(1);ct.title=oi||null,ct.tagList.push(oi?["INF",ai,oi]:["INF",ai])}else if(ot[3]){if(isFiniteNumber(ct.duration)){ct.start=nt,ft&&setFragLevelKeys(ct,ft,Ye),ct.sn=Je,ct.level=ae,ct.cc=it,Ke.push(ct);const oi=(" "+ot[3]).slice(1);ct.relurl=substituteVariables(Ye,oi),assignProgramDateTime(ct,lt),lt=ct,nt+=ct.duration,Je++,rt=0,mt=!0}}else if(ot[4]){const oi=(" "+ot[4]).slice(1);lt?ct.setByteRange(oi,lt):ct.setByteRange(oi)}else if(ot[5])ct.rawProgramDateTime=(" "+ot[5]).slice(1),ct.tagList.push(["PROGRAM-DATE-TIME",ct.rawProgramDateTime]),gt===-1&&(gt=Ke.length);else{if(ot=ot[0].match(LEVEL_PLAYLIST_REGEX_SLOW),!ot){logger.warn("No matches on slow regex match for level playlist!");continue}for(dt=1;dt<ot.length&&!(typeof ot[dt]<"u");dt++);const oi=(" "+ot[dt]).slice(1),ni=(" "+ot[dt+1]).slice(1),li=ot[dt+2]?(" "+ot[dt+2]).slice(1):"";switch(oi){case"PLAYLIST-TYPE":Ye.type=ni.toUpperCase();break;case"MEDIA-SEQUENCE":Je=Ye.startSN=parseInt(ni);break;case"SKIP":{const ui=new AttrList(ni);substituteVariablesInAttributes(Ye,ui,["RECENTLY-REMOVED-DATERANGES"]);const mi=ui.decimalInteger("SKIPPED-SEGMENTS");if(isFiniteNumber(mi)){Ye.skippedSegments=mi;for(let hi=mi;hi--;)Ke.unshift(null);Je+=mi}const ii=ui.enumeratedString("RECENTLY-REMOVED-DATERANGES");ii&&(Ye.recentlyRemovedDateranges=ii.split("	"));break}case"TARGETDURATION":Ye.targetduration=Math.max(parseInt(ni),1);break;case"VERSION":Ye.version=parseInt(ni);break;case"INDEPENDENT-SEGMENTS":case"EXTM3U":break;case"ENDLIST":Ye.live=!1;break;case"#":(ni||li)&&ct.tagList.push(li?[ni,li]:[ni]);break;case"DISCONTINUITY":it++,ct.tagList.push(["DIS"]);break;case"GAP":ct.gap=!0,ct.tagList.push([oi]);break;case"BITRATE":ct.tagList.push([oi,ni]);break;case"DATERANGE":{const ui=new AttrList(ni);substituteVariablesInAttributes(Ye,ui,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),substituteVariablesInAttributes(Ye,ui,ui.clientAttrs);const mi=new DateRange(ui,Ye.dateRanges[ui.ID]);mi.isValid||Ye.skippedSegments?Ye.dateRanges[mi.id]=mi:logger.warn(`Ignoring invalid DATERANGE tag: "${ni}"`),ct.tagList.push(["EXT-X-DATERANGE",ni]);break}case"DEFINE":{{const ui=new AttrList(ni);substituteVariablesInAttributes(Ye,ui,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in ui?importVariableDefinition(Ye,ui,be):addVariableDefinition(Ye,ui,ee)}break}case"DISCONTINUITY-SEQUENCE":it=parseInt(ni);break;case"KEY":{const ui=parseKey(ni,ee,Ye);if(ui.isSupported()){if(ui.method==="NONE"){ft=void 0;break}ft||(ft={}),ft[ui.keyFormat]&&(ft=_extends({},ft)),ft[ui.keyFormat]=ui}else logger.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${ni}"`);break}case"START":Ye.startTimeOffset=parseStartTimeOffset(ni);break;case"MAP":{const ui=new AttrList(ni);if(substituteVariablesInAttributes(Ye,ui,["BYTERANGE","URI"]),ct.duration){const mi=new Fragment(ye,ee);setInitSegment(mi,ui,ae,ft),Xe=mi,ct.initSegment=Xe,Xe.rawProgramDateTime&&!ct.rawProgramDateTime&&(ct.rawProgramDateTime=Xe.rawProgramDateTime)}else{const mi=ct.byteRangeEndOffset;if(mi){const ii=ct.byteRangeStartOffset;Yr=`${mi-ii}@${ii}`}else Yr=null;setInitSegment(ct,ui,ae,ft),Xe=ct,mt=!0}break}case"SERVER-CONTROL":{const ui=new AttrList(ni);Ye.canBlockReload=ui.bool("CAN-BLOCK-RELOAD"),Ye.canSkipUntil=ui.optionalFloat("CAN-SKIP-UNTIL",0),Ye.canSkipDateRanges=Ye.canSkipUntil>0&&ui.bool("CAN-SKIP-DATERANGES"),Ye.partHoldBack=ui.optionalFloat("PART-HOLD-BACK",0),Ye.holdBack=ui.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const ui=new AttrList(ni);Ye.partTarget=ui.decimalFloatingPoint("PART-TARGET");break}case"PART":{let ui=Ye.partList;ui||(ui=Ye.partList=[]);const mi=rt>0?ui[ui.length-1]:void 0,ii=rt++,hi=new AttrList(ni);substituteVariablesInAttributes(Ye,hi,["BYTERANGE","URI"]);const ri=new Part(hi,ct,ee,ii,mi);ui.push(ri),ct.duration+=ri.duration;break}case"PRELOAD-HINT":{const ui=new AttrList(ni);substituteVariablesInAttributes(Ye,ui,["URI"]),Ye.preloadHint=ui;break}case"RENDITION-REPORT":{const ui=new AttrList(ni);substituteVariablesInAttributes(Ye,ui,["URI"]),Ye.renditionReports=Ye.renditionReports||[],Ye.renditionReports.push(ui);break}default:logger.warn(`line parsed but not handled: ${ot}`);break}}}lt&&!lt.relurl?(Ke.pop(),nt-=lt.duration,Ye.partList&&(Ye.fragmentHint=lt)):Ye.partList&&(assignProgramDateTime(ct,lt),ct.cc=it,Ye.fragmentHint=ct,ft&&setFragLevelKeys(ct,ft,Ye));const Qr=Ke.length,Xr=Ke[0],Jr=Ke[Qr-1];if(nt+=Ye.skippedSegments*Ye.targetduration,nt>0&&Qr&&Jr){Ye.averagetargetduration=nt/Qr;const ai=Jr.sn;Ye.endSN=ai!=="initSegment"?ai:0,Ye.live||(Jr.endList=!0),Xr&&(Ye.startCC=Xr.cc)}else Ye.endSN=0,Ye.startCC=0;return Ye.fragmentHint&&(nt+=Ye.fragmentHint.duration),Ye.totalduration=nt,Ye.endCC=it,gt>0&&backfillProgramDateTimes(Ke,gt),Ye}}function parseKey(ie,Z,ee){var ae,ye;const ve=new AttrList(ie);substituteVariablesInAttributes(ee,ve,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const be=(ae=ve.METHOD)!=null?ae:"",Ye=ve.URI,Ke=ve.hexadecimalInteger("IV"),Xe=ve.KEYFORMATVERSIONS,Je=(ye=ve.KEYFORMAT)!=null?ye:"identity";Ye&&ve.IV&&!Ke&&logger.error(`Invalid IV: ${ve.IV}`);const rt=Ye?M3U8Parser.resolve(Ye,Z):"",nt=(Xe||"1").split("/").map(Number).filter(Number.isFinite);return new LevelKey(be,rt,Je,nt,Ke)}function parseStartTimeOffset(ie){const Z=new AttrList(ie).decimalFloatingPoint("TIME-OFFSET");return isFiniteNumber(Z)?Z:null}function setCodecs(ie,Z){let ee=(ie||"").split(/[ ,]+/).filter(ae=>ae);["video","audio","text"].forEach(ae=>{const ye=ee.filter(ve=>isCodecType(ve,ae));ye.length&&(Z[`${ae}Codec`]=ye.join(","),ee=ee.filter(ve=>ye.indexOf(ve)===-1))}),Z.unknownCodecs=ee}function assignCodec(ie,Z,ee){const ae=Z[ee];ae&&(ie[ee]=ae)}function backfillProgramDateTimes(ie,Z){let ee=ie[Z];for(let ae=Z;ae--;){const ye=ie[ae];if(!ye)return;ye.programDateTime=ee.programDateTime-ye.duration*1e3,ee=ye}}function assignProgramDateTime(ie,Z){ie.rawProgramDateTime?ie.programDateTime=Date.parse(ie.rawProgramDateTime):Z!=null&&Z.programDateTime&&(ie.programDateTime=Z.endProgramDateTime),isFiniteNumber(ie.programDateTime)||(ie.programDateTime=null,ie.rawProgramDateTime=null)}function setInitSegment(ie,Z,ee,ae){ie.relurl=Z.URI,Z.BYTERANGE&&ie.setByteRange(Z.BYTERANGE),ie.level=ee,ie.sn="initSegment",ae&&(ie.levelkeys=ae),ie.initSegment=null}function setFragLevelKeys(ie,Z,ee){ie.levelkeys=Z;const{encryptedFragments:ae}=ee;(!ae.length||ae[ae.length-1].levelkeys!==Z)&&Object.keys(Z).some(ye=>Z[ye].isCommonEncryption)&&ae.push(ie)}var PlaylistContextType={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},PlaylistLevelType={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function mapContextToLevelType(ie){const{type:Z}=ie;switch(Z){case PlaylistContextType.AUDIO_TRACK:return PlaylistLevelType.AUDIO;case PlaylistContextType.SUBTITLE_TRACK:return PlaylistLevelType.SUBTITLE;default:return PlaylistLevelType.MAIN}}function getResponseUrl(ie,Z){let ee=ie.url;return(ee===void 0||ee.indexOf("data:")===0)&&(ee=Z.url),ee}class PlaylistLoader{constructor(Z){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=Z,this.registerListeners()}startLoad(Z){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:Z}=this;Z.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.on(Events.LEVEL_LOADING,this.onLevelLoading,this),Z.on(Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),Z.on(Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:Z}=this;Z.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.off(Events.LEVEL_LOADING,this.onLevelLoading,this),Z.off(Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),Z.off(Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(Z){const ee=this.hls.config,ae=ee.pLoader,ye=ee.loader,ve=ae||ye,be=new ve(ee);return this.loaders[Z.type]=be,be}getInternalLoader(Z){return this.loaders[Z.type]}resetInternalLoader(Z){this.loaders[Z]&&delete this.loaders[Z]}destroyInternalLoaders(){for(const Z in this.loaders){const ee=this.loaders[Z];ee&&ee.destroy(),this.resetInternalLoader(Z)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(Z,ee){const{url:ae}=ee;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:PlaylistContextType.MANIFEST,url:ae,deliveryDirectives:null})}onLevelLoading(Z,ee){const{id:ae,level:ye,pathwayId:ve,url:be,deliveryDirectives:Ye}=ee;this.load({id:ae,level:ye,pathwayId:ve,responseType:"text",type:PlaylistContextType.LEVEL,url:be,deliveryDirectives:Ye})}onAudioTrackLoading(Z,ee){const{id:ae,groupId:ye,url:ve,deliveryDirectives:be}=ee;this.load({id:ae,groupId:ye,level:null,responseType:"text",type:PlaylistContextType.AUDIO_TRACK,url:ve,deliveryDirectives:be})}onSubtitleTrackLoading(Z,ee){const{id:ae,groupId:ye,url:ve,deliveryDirectives:be}=ee;this.load({id:ae,groupId:ye,level:null,responseType:"text",type:PlaylistContextType.SUBTITLE_TRACK,url:ve,deliveryDirectives:be})}load(Z){var ee;const ae=this.hls.config;let ye=this.getInternalLoader(Z);if(ye){const Xe=ye.context;if(Xe&&Xe.url===Z.url&&Xe.level===Z.level){logger.trace("[playlist-loader]: playlist request ongoing");return}logger.log(`[playlist-loader]: aborting previous loader for type: ${Z.type}`),ye.abort()}let ve;if(Z.type===PlaylistContextType.MANIFEST?ve=ae.manifestLoadPolicy.default:ve=_extends({},ae.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),ye=this.createInternalLoader(Z),isFiniteNumber((ee=Z.deliveryDirectives)==null?void 0:ee.part)){let Xe;if(Z.type===PlaylistContextType.LEVEL&&Z.level!==null?Xe=this.hls.levels[Z.level].details:Z.type===PlaylistContextType.AUDIO_TRACK&&Z.id!==null?Xe=this.hls.audioTracks[Z.id].details:Z.type===PlaylistContextType.SUBTITLE_TRACK&&Z.id!==null&&(Xe=this.hls.subtitleTracks[Z.id].details),Xe){const Je=Xe.partTarget,rt=Xe.targetduration;if(Je&&rt){const nt=Math.max(Je*3,rt*.8)*1e3;ve=_extends({},ve,{maxTimeToFirstByteMs:Math.min(nt,ve.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(nt,ve.maxTimeToFirstByteMs)})}}}const be=ve.errorRetry||ve.timeoutRetry||{},Ye={loadPolicy:ve,timeout:ve.maxLoadTimeMs,maxRetry:be.maxNumRetry||0,retryDelay:be.retryDelayMs||0,maxRetryDelay:be.maxRetryDelayMs||0},Ke={onSuccess:(Xe,Je,rt,nt)=>{const it=this.getInternalLoader(rt);this.resetInternalLoader(rt.type);const lt=Xe.data;if(lt.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(Xe,rt,new Error("no EXTM3U delimiter"),nt||null,Je);return}Je.parsing.start=performance.now(),M3U8Parser.isMediaPlaylist(lt)?this.handleTrackOrLevelPlaylist(Xe,Je,rt,nt||null,it):this.handleMasterPlaylist(Xe,Je,rt,nt)},onError:(Xe,Je,rt,nt)=>{this.handleNetworkError(Je,rt,!1,Xe,nt)},onTimeout:(Xe,Je,rt)=>{this.handleNetworkError(Je,rt,!0,void 0,Xe)}};ye.load(Z,Ye,Ke)}handleMasterPlaylist(Z,ee,ae,ye){const ve=this.hls,be=Z.data,Ye=getResponseUrl(Z,ae),Ke=M3U8Parser.parseMasterPlaylist(be,Ye);if(Ke.playlistParsingError){this.handleManifestParsingError(Z,ae,Ke.playlistParsingError,ye,ee);return}const{contentSteering:Xe,levels:Je,sessionData:rt,sessionKeys:nt,startTimeOffset:it,variableList:lt}=Ke;this.variableList=lt;const{AUDIO:ct=[],SUBTITLES:ot,"CLOSED-CAPTIONS":dt}=M3U8Parser.parseMasterPlaylistMedia(be,Ye,Ke);ct.length&&!ct.some(ft=>!ft.url)&&Je[0].audioCodec&&!Je[0].attrs.AUDIO&&(logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),ct.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new AttrList({}),bitrate:0,url:""})),ve.trigger(Events.MANIFEST_LOADED,{levels:Je,audioTracks:ct,subtitles:ot,captions:dt,contentSteering:Xe,url:Ye,stats:ee,networkDetails:ye,sessionData:rt,sessionKeys:nt,startTimeOffset:it,variableList:lt})}handleTrackOrLevelPlaylist(Z,ee,ae,ye,ve){const be=this.hls,{id:Ye,level:Ke,type:Xe}=ae,Je=getResponseUrl(Z,ae),rt=0,nt=isFiniteNumber(Ke)?Ke:isFiniteNumber(Ye)?Ye:0,it=mapContextToLevelType(ae),lt=M3U8Parser.parseLevelPlaylist(Z.data,Je,nt,it,rt,this.variableList);if(Xe===PlaylistContextType.MANIFEST){const ct={attrs:new AttrList({}),bitrate:0,details:lt,name:"",url:Je};be.trigger(Events.MANIFEST_LOADED,{levels:[ct],audioTracks:[],url:Je,stats:ee,networkDetails:ye,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}ee.parsing.end=performance.now(),ae.levelDetails=lt,this.handlePlaylistLoaded(lt,Z,ee,ae,ye,ve)}handleManifestParsingError(Z,ee,ae,ye,ve){this.hls.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.MANIFEST_PARSING_ERROR,fatal:ee.type===PlaylistContextType.MANIFEST,url:Z.url,err:ae,error:ae,reason:ae.message,response:Z,context:ee,networkDetails:ye,stats:ve})}handleNetworkError(Z,ee,ae=!1,ye,ve){let be=`A network ${ae?"timeout":"error"+(ye?" (status "+ye.code+")":"")} occurred while loading ${Z.type}`;Z.type===PlaylistContextType.LEVEL?be+=`: ${Z.level} id: ${Z.id}`:(Z.type===PlaylistContextType.AUDIO_TRACK||Z.type===PlaylistContextType.SUBTITLE_TRACK)&&(be+=` id: ${Z.id} group-id: "${Z.groupId}"`);const Ye=new Error(be);logger.warn(`[playlist-loader]: ${be}`);let Ke=ErrorDetails.UNKNOWN,Xe=!1;const Je=this.getInternalLoader(Z);switch(Z.type){case PlaylistContextType.MANIFEST:Ke=ae?ErrorDetails.MANIFEST_LOAD_TIMEOUT:ErrorDetails.MANIFEST_LOAD_ERROR,Xe=!0;break;case PlaylistContextType.LEVEL:Ke=ae?ErrorDetails.LEVEL_LOAD_TIMEOUT:ErrorDetails.LEVEL_LOAD_ERROR,Xe=!1;break;case PlaylistContextType.AUDIO_TRACK:Ke=ae?ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:ErrorDetails.AUDIO_TRACK_LOAD_ERROR,Xe=!1;break;case PlaylistContextType.SUBTITLE_TRACK:Ke=ae?ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:ErrorDetails.SUBTITLE_LOAD_ERROR,Xe=!1;break}Je&&this.resetInternalLoader(Z.type);const rt={type:ErrorTypes.NETWORK_ERROR,details:Ke,fatal:Xe,url:Z.url,loader:Je,context:Z,error:Ye,networkDetails:ee,stats:ve};if(ye){const nt=(ee==null?void 0:ee.url)||Z.url;rt.response=_objectSpread2({url:nt,data:void 0},ye)}this.hls.trigger(Events.ERROR,rt)}handlePlaylistLoaded(Z,ee,ae,ye,ve,be){const Ye=this.hls,{type:Ke,level:Xe,id:Je,groupId:rt,deliveryDirectives:nt}=ye,it=getResponseUrl(ee,ye),lt=mapContextToLevelType(ye),ct=typeof ye.level=="number"&&lt===PlaylistLevelType.MAIN?Xe:void 0;if(!Z.fragments.length){const dt=new Error("No Segments found in Playlist");Ye.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:it,error:dt,reason:dt.message,response:ee,context:ye,level:ct,parent:lt,networkDetails:ve,stats:ae});return}Z.targetduration||(Z.playlistParsingError=new Error("Missing Target Duration"));const ot=Z.playlistParsingError;if(ot){Ye.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.LEVEL_PARSING_ERROR,fatal:!1,url:it,error:ot,reason:ot.message,response:ee,context:ye,level:ct,parent:lt,networkDetails:ve,stats:ae});return}switch(Z.live&&be&&(be.getCacheAge&&(Z.ageHeader=be.getCacheAge()||0),(!be.getCacheAge||isNaN(Z.ageHeader))&&(Z.ageHeader=0)),Ke){case PlaylistContextType.MANIFEST:case PlaylistContextType.LEVEL:Ye.trigger(Events.LEVEL_LOADED,{details:Z,level:ct||0,id:Je||0,stats:ae,networkDetails:ve,deliveryDirectives:nt});break;case PlaylistContextType.AUDIO_TRACK:Ye.trigger(Events.AUDIO_TRACK_LOADED,{details:Z,id:Je||0,groupId:rt||"",stats:ae,networkDetails:ve,deliveryDirectives:nt});break;case PlaylistContextType.SUBTITLE_TRACK:Ye.trigger(Events.SUBTITLE_TRACK_LOADED,{details:Z,id:Je||0,groupId:rt||"",stats:ae,networkDetails:ve,deliveryDirectives:nt});break}}}function sendAddTrackEvent(ie,Z){let ee;try{ee=new Event("addtrack")}catch{ee=document.createEvent("Event"),ee.initEvent("addtrack",!1,!1)}ee.track=ie,Z.dispatchEvent(ee)}function addCueToTrack(ie,Z){const ee=ie.mode;if(ee==="disabled"&&(ie.mode="hidden"),ie.cues&&!ie.cues.getCueById(Z.id))try{if(ie.addCue(Z),!ie.cues.getCueById(Z.id))throw new Error(`addCue is failed for: ${Z}`)}catch(ae){logger.debug(`[texttrack-utils]: ${ae}`);try{const ye=new self.TextTrackCue(Z.startTime,Z.endTime,Z.text);ye.id=Z.id,ie.addCue(ye)}catch(ye){logger.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${ye}`)}}ee==="disabled"&&(ie.mode=ee)}function clearCurrentCues(ie){const Z=ie.mode;if(Z==="disabled"&&(ie.mode="hidden"),ie.cues)for(let ee=ie.cues.length;ee--;)ie.removeCue(ie.cues[ee]);Z==="disabled"&&(ie.mode=Z)}function removeCuesInRange(ie,Z,ee,ae){const ye=ie.mode;if(ye==="disabled"&&(ie.mode="hidden"),ie.cues&&ie.cues.length>0){const ve=getCuesInRange(ie.cues,Z,ee);for(let be=0;be<ve.length;be++)(!ae||ae(ve[be]))&&ie.removeCue(ve[be])}ye==="disabled"&&(ie.mode=ye)}function getFirstCueIndexAfterTime(ie,Z){if(Z<ie[0].startTime)return 0;const ee=ie.length-1;if(Z>ie[ee].endTime)return-1;let ae=0,ye=ee;for(;ae<=ye;){const ve=Math.floor((ye+ae)/2);if(Z<ie[ve].startTime)ye=ve-1;else if(Z>ie[ve].startTime&&ae<ee)ae=ve+1;else return ve}return ie[ae].startTime-Z<Z-ie[ye].startTime?ae:ye}function getCuesInRange(ie,Z,ee){const ae=[],ye=getFirstCueIndexAfterTime(ie,Z);if(ye>-1)for(let ve=ye,be=ie.length;ve<be;ve++){const Ye=ie[ve];if(Ye.startTime>=Z&&Ye.endTime<=ee)ae.push(Ye);else if(Ye.startTime>ee)return ae}return ae}function filterSubtitleTracks(ie){const Z=[];for(let ee=0;ee<ie.length;ee++){const ae=ie[ee];(ae.kind==="subtitles"||ae.kind==="captions")&&ae.label&&Z.push(ie[ee])}return Z}var MetadataSchema={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"};const MIN_CUE_DURATION=.25;function getCueClass(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function createCueWithDataFields(ie,Z,ee,ae,ye){let ve=new ie(Z,ee,"");try{ve.value=ae,ye&&(ve.type=ye)}catch{ve=new ie(Z,ee,JSON.stringify(ye?_objectSpread2({type:ye},ae):ae))}return ve}const MAX_CUE_ENDTIME=(()=>{const ie=getCueClass();try{ie&&new ie(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function dateRangeDateToTimelineSeconds(ie,Z){return ie.getTime()/1e3-Z}function hexToArrayBuffer(ie){return Uint8Array.from(ie.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class ID3TrackController{constructor(Z){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=Z,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:Z}=this;Z.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),Z.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),Z.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.on(Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),Z.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),Z.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:Z}=this;Z.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),Z.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),Z.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.off(Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),Z.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),Z.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(Z,ee){this.media=ee.media}onMediaDetaching(){this.id3Track&&(clearCurrentCues(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(Z){const ee=this.getID3Track(Z.textTracks);return ee.mode="hidden",ee}getID3Track(Z){if(this.media){for(let ee=0;ee<Z.length;ee++){const ae=Z[ee];if(ae.kind==="metadata"&&ae.label==="id3")return sendAddTrackEvent(ae,this.media),ae}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(Z,ee){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:ae,enableID3MetadataCues:ye}}}=this;if(!ae&&!ye)return;const{samples:ve}=ee;this.id3Track||(this.id3Track=this.createTrack(this.media));const be=getCueClass();if(be)for(let Ye=0;Ye<ve.length;Ye++){const Ke=ve[Ye].type;if(Ke===MetadataSchema.emsg&&!ae||!ye)continue;const Xe=getID3Frames(ve[Ye].data);if(Xe){const Je=ve[Ye].pts;let rt=Je+ve[Ye].duration;rt>MAX_CUE_ENDTIME&&(rt=MAX_CUE_ENDTIME),rt-Je<=0&&(rt=Je+MIN_CUE_DURATION);for(let nt=0;nt<Xe.length;nt++){const it=Xe[nt];if(!isTimeStampFrame(it)){this.updateId3CueEnds(Je,Ke);const lt=createCueWithDataFields(be,Je,rt,it,Ke);lt&&this.id3Track.addCue(lt)}}}}}updateId3CueEnds(Z,ee){var ae;const ye=(ae=this.id3Track)==null?void 0:ae.cues;if(ye)for(let ve=ye.length;ve--;){const be=ye[ve];be.type===ee&&be.startTime<Z&&be.endTime===MAX_CUE_ENDTIME&&(be.endTime=Z)}}onBufferFlushing(Z,{startOffset:ee,endOffset:ae,type:ye}){const{id3Track:ve,hls:be}=this;if(!be)return;const{config:{enableEmsgMetadataCues:Ye,enableID3MetadataCues:Ke}}=be;if(ve&&(Ye||Ke)){let Xe;ye==="audio"?Xe=Je=>Je.type===MetadataSchema.audioId3&&Ke:ye==="video"?Xe=Je=>Je.type===MetadataSchema.emsg&&Ye:Xe=Je=>Je.type===MetadataSchema.audioId3&&Ke||Je.type===MetadataSchema.emsg&&Ye,removeCuesInRange(ve,ee,ae,Xe)}}onLevelUpdated(Z,{details:ee}){if(!this.media||!ee.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:ae,id3Track:ye}=this,{dateRanges:ve}=ee,be=Object.keys(ve);if(ye){const Je=Object.keys(ae).filter(rt=>!be.includes(rt));for(let rt=Je.length;rt--;){const nt=Je[rt];Object.keys(ae[nt].cues).forEach(it=>{ye.removeCue(ae[nt].cues[it])}),delete ae[nt]}}const Ye=ee.fragments[ee.fragments.length-1];if(be.length===0||!isFiniteNumber(Ye==null?void 0:Ye.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const Ke=Ye.programDateTime/1e3-Ye.start,Xe=getCueClass();for(let Je=0;Je<be.length;Je++){const rt=be[Je],nt=ve[rt],it=dateRangeDateToTimelineSeconds(nt.startDate,Ke),lt=ae[rt],ct=(lt==null?void 0:lt.cues)||{};let ot=(lt==null?void 0:lt.durationKnown)||!1,dt=MAX_CUE_ENDTIME;const ft=nt.endDate;if(ft)dt=dateRangeDateToTimelineSeconds(ft,Ke),ot=!0;else if(nt.endOnNext&&!ot){const mt=be.reduce((Yr,Qr)=>{if(Qr!==nt.id){const Xr=ve[Qr];if(Xr.class===nt.class&&Xr.startDate>nt.startDate&&(!Yr||nt.startDate<Yr.startDate))return Xr}return Yr},null);mt&&(dt=dateRangeDateToTimelineSeconds(mt.startDate,Ke),ot=!0)}const gt=Object.keys(nt.attr);for(let mt=0;mt<gt.length;mt++){const Yr=gt[mt];if(!isDateRangeCueAttribute(Yr))continue;const Qr=ct[Yr];if(Qr)ot&&!lt.durationKnown&&(Qr.endTime=dt);else if(Xe){let Xr=nt.attr[Yr];isSCTE35Attribute(Yr)&&(Xr=hexToArrayBuffer(Xr));const Jr=createCueWithDataFields(Xe,it,dt,{key:Yr,data:Xr},MetadataSchema.dateRange);Jr&&(Jr.id=rt,this.id3Track.addCue(Jr),ct[Yr]=Jr)}}ae[rt]={cues:ct,dateRange:nt,durationKnown:ot}}}}class LatencyController{constructor(Z){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=Z,this.config=Z.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:Z,levelDetails:ee}=this;return Z.liveMaxLatencyDuration!==void 0?Z.liveMaxLatencyDuration:ee?Z.liveMaxLatencyDurationCount*ee.targetduration:0}get targetLatency(){const{levelDetails:Z}=this;if(Z===null)return null;const{holdBack:ee,partHoldBack:ae,targetduration:ye}=Z,{liveSyncDuration:ve,liveSyncDurationCount:be,lowLatencyMode:Ye}=this.config,Ke=this.hls.userConfig;let Xe=Ye&&ae||ee;(Ke.liveSyncDuration||Ke.liveSyncDurationCount||Xe===0)&&(Xe=ve!==void 0?ve:be*ye);const Je=ye;return Xe+Math.min(this.stallCount*1,Je)}get liveSyncPosition(){const Z=this.estimateLiveEdge(),ee=this.targetLatency,ae=this.levelDetails;if(Z===null||ee===null||ae===null)return null;const ye=ae.edge,ve=Z-ee-this.edgeStalled,be=ye-ae.totalduration,Ye=ye-(this.config.lowLatencyMode&&ae.partTarget||ae.targetduration);return Math.min(Math.max(be,ve),Ye)}get drift(){const{levelDetails:Z}=this;return Z===null?1:Z.drift}get edgeStalled(){const{levelDetails:Z}=this;if(Z===null)return 0;const ee=(this.config.lowLatencyMode&&Z.partTarget||Z.targetduration)*3;return Math.max(Z.age-ee,0)}get forwardBufferLength(){const{media:Z,levelDetails:ee}=this;if(!Z||!ee)return 0;const ae=Z.buffered.length;return(ae?Z.buffered.end(ae-1):ee.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(Events.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(Events.ERROR,this.onError,this)}onMediaAttached(Z,ee){this.media=ee.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(Z,{details:ee}){this.levelDetails=ee,ee.advanced&&this.timeupdate(),!ee.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(Z,ee){var ae;ee.details===ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,(ae=this.levelDetails)!=null&&ae.live&&logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:Z,levelDetails:ee}=this;if(!Z||!ee)return;this.currentTime=Z.currentTime;const ae=this.computeLatency();if(ae===null)return;this._latency=ae;const{lowLatencyMode:ye,maxLiveSyncPlaybackRate:ve}=this.config;if(!ye||ve===1||!ee.live)return;const be=this.targetLatency;if(be===null)return;const Ye=ae-be,Ke=Math.min(this.maxLatency,be+ee.targetduration);if(Ye<Ke&&Ye>.05&&this.forwardBufferLength>1){const Xe=Math.min(2,Math.max(1,ve)),Je=Math.round(2/(1+Math.exp(-.75*Ye-this.edgeStalled))*20)/20;Z.playbackRate=Math.min(Xe,Math.max(1,Je))}else Z.playbackRate!==1&&Z.playbackRate!==0&&(Z.playbackRate=1)}estimateLiveEdge(){const{levelDetails:Z}=this;return Z===null?null:Z.edge+Z.age}computeLatency(){const Z=this.estimateLiveEdge();return Z===null?null:Z-this.currentTime}}const HdcpLevels=["NONE","TYPE-0","TYPE-1",null];function isHdcpLevel(ie){return HdcpLevels.indexOf(ie)>-1}const VideoRangeValues=["SDR","PQ","HLG"];function isVideoRange(ie){return!!ie&&VideoRangeValues.indexOf(ie)>-1}var HlsSkip={No:"",Yes:"YES",v2:"v2"};function getSkipValue(ie,Z){const{canSkipUntil:ee,canSkipDateRanges:ae,endSN:ye}=ie,ve=Z!==void 0?Z-ye:0;return ee&&ve<ee?ae?HlsSkip.v2:HlsSkip.Yes:HlsSkip.No}class HlsUrlParameters{constructor(Z,ee,ae){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=Z,this.part=ee,this.skip=ae}addDirectives(Z){const ee=new self.URL(Z);return this.msn!==void 0&&ee.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&ee.searchParams.set("_HLS_part",this.part.toString()),this.skip&&ee.searchParams.set("_HLS_skip",this.skip),ee.href}}class Level{constructor(Z){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[Z.url],this._attrs=[Z.attrs],this.bitrate=Z.bitrate,Z.details&&(this.details=Z.details),this.id=Z.id||0,this.name=Z.name,this.width=Z.width||0,this.height=Z.height||0,this.frameRate=Z.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=Z.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=Z.audioCodec,this.videoCodec=Z.videoCodec,this.codecSet=[Z.videoCodec,Z.audioCodec].filter(ee=>!!ee).map(ee=>ee.substring(0,4)).join(","),this.addGroupId("audio",Z.attrs.AUDIO),this.addGroupId("text",Z.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(Z){return hasGroup(this._audioGroups,Z)}hasSubtitleGroup(Z){return hasGroup(this._subtitleGroups,Z)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(Z,ee){if(ee){if(Z==="audio"){let ae=this._audioGroups;ae||(ae=this._audioGroups=[]),ae.indexOf(ee)===-1&&ae.push(ee)}else if(Z==="text"){let ae=this._subtitleGroups;ae||(ae=this._subtitleGroups=[]),ae.indexOf(ee)===-1&&ae.push(ee)}}}get urlId(){return 0}set urlId(Z){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var Z;return(Z=this.audioGroups)==null?void 0:Z[0]}get textGroupId(){var Z;return(Z=this.subtitleGroups)==null?void 0:Z[0]}addFallback(){}}function hasGroup(ie,Z){return!Z||!ie?!1:ie.indexOf(Z)!==-1}function updateFromToPTS(ie,Z){const ee=Z.startPTS;if(isFiniteNumber(ee)){let ae=0,ye;Z.sn>ie.sn?(ae=ee-ie.start,ye=ie):(ae=ie.start-ee,ye=Z),ye.duration!==ae&&(ye.duration=ae)}else Z.sn>ie.sn?ie.cc===Z.cc&&ie.minEndPTS?Z.start=ie.start+(ie.minEndPTS-ie.start):Z.start=ie.start+ie.duration:Z.start=Math.max(ie.start-Z.duration,0)}function updateFragPTSDTS(ie,Z,ee,ae,ye,ve){ae-ee<=0&&(logger.warn("Fragment should have a positive duration",Z),ae=ee+Z.duration,ve=ye+Z.duration);let be=ee,Ye=ae;const Ke=Z.startPTS,Xe=Z.endPTS;if(isFiniteNumber(Ke)){const ct=Math.abs(Ke-ee);isFiniteNumber(Z.deltaPTS)?Z.deltaPTS=Math.max(ct,Z.deltaPTS):Z.deltaPTS=ct,be=Math.max(ee,Ke),ee=Math.min(ee,Ke),ye=Math.min(ye,Z.startDTS),Ye=Math.min(ae,Xe),ae=Math.max(ae,Xe),ve=Math.max(ve,Z.endDTS)}const Je=ee-Z.start;Z.start!==0&&(Z.start=ee),Z.duration=ae-Z.start,Z.startPTS=ee,Z.maxStartPTS=be,Z.startDTS=ye,Z.endPTS=ae,Z.minEndPTS=Ye,Z.endDTS=ve;const rt=Z.sn;if(!ie||rt<ie.startSN||rt>ie.endSN)return 0;let nt;const it=rt-ie.startSN,lt=ie.fragments;for(lt[it]=Z,nt=it;nt>0;nt--)updateFromToPTS(lt[nt],lt[nt-1]);for(nt=it;nt<lt.length-1;nt++)updateFromToPTS(lt[nt],lt[nt+1]);return ie.fragmentHint&&updateFromToPTS(lt[lt.length-1],ie.fragmentHint),ie.PTSKnown=ie.alignedSliding=!0,Je}function mergeDetails(ie,Z){let ee=null;const ae=ie.fragments;for(let Ke=ae.length-1;Ke>=0;Ke--){const Xe=ae[Ke].initSegment;if(Xe){ee=Xe;break}}ie.fragmentHint&&delete ie.fragmentHint.endPTS;let ye=0,ve;if(mapFragmentIntersection(ie,Z,(Ke,Xe)=>{Ke.relurl&&(ye=Ke.cc-Xe.cc),isFiniteNumber(Ke.startPTS)&&isFiniteNumber(Ke.endPTS)&&(Xe.start=Xe.startPTS=Ke.startPTS,Xe.startDTS=Ke.startDTS,Xe.maxStartPTS=Ke.maxStartPTS,Xe.endPTS=Ke.endPTS,Xe.endDTS=Ke.endDTS,Xe.minEndPTS=Ke.minEndPTS,Xe.duration=Ke.endPTS-Ke.startPTS,Xe.duration&&(ve=Xe),Z.PTSKnown=Z.alignedSliding=!0),Xe.elementaryStreams=Ke.elementaryStreams,Xe.loader=Ke.loader,Xe.stats=Ke.stats,Ke.initSegment&&(Xe.initSegment=Ke.initSegment,ee=Ke.initSegment)}),ee&&(Z.fragmentHint?Z.fragments.concat(Z.fragmentHint):Z.fragments).forEach(Ke=>{var Xe;Ke&&(!Ke.initSegment||Ke.initSegment.relurl===((Xe=ee)==null?void 0:Xe.relurl))&&(Ke.initSegment=ee)}),Z.skippedSegments)if(Z.deltaUpdateFailed=Z.fragments.some(Ke=>!Ke),Z.deltaUpdateFailed){logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let Ke=Z.skippedSegments;Ke--;)Z.fragments.shift();Z.startSN=Z.fragments[0].sn,Z.startCC=Z.fragments[0].cc}else Z.canSkipDateRanges&&(Z.dateRanges=mergeDateRanges(ie.dateRanges,Z.dateRanges,Z.recentlyRemovedDateranges));const be=Z.fragments;if(ye){logger.warn("discontinuity sliding from playlist, take drift into account");for(let Ke=0;Ke<be.length;Ke++)be[Ke].cc+=ye}Z.skippedSegments&&(Z.startCC=Z.fragments[0].cc),mapPartIntersection(ie.partList,Z.partList,(Ke,Xe)=>{Xe.elementaryStreams=Ke.elementaryStreams,Xe.stats=Ke.stats}),ve?updateFragPTSDTS(Z,ve,ve.startPTS,ve.endPTS,ve.startDTS,ve.endDTS):adjustSliding(ie,Z),be.length&&(Z.totalduration=Z.edge-be[0].start),Z.driftStartTime=ie.driftStartTime,Z.driftStart=ie.driftStart;const Ye=Z.advancedDateTime;if(Z.advanced&&Ye){const Ke=Z.edge;Z.driftStart||(Z.driftStartTime=Ye,Z.driftStart=Ke),Z.driftEndTime=Ye,Z.driftEnd=Ke}else Z.driftEndTime=ie.driftEndTime,Z.driftEnd=ie.driftEnd,Z.advancedDateTime=ie.advancedDateTime}function mergeDateRanges(ie,Z,ee){const ae=_extends({},ie);return ee&&ee.forEach(ye=>{delete ae[ye]}),Object.keys(Z).forEach(ye=>{const ve=new DateRange(Z[ye].attr,ae[ye]);ve.isValid?ae[ye]=ve:logger.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(Z[ye].attr)}"`)}),ae}function mapPartIntersection(ie,Z,ee){if(ie&&Z){let ae=0;for(let ye=0,ve=ie.length;ye<=ve;ye++){const be=ie[ye],Ye=Z[ye+ae];be&&Ye&&be.index===Ye.index&&be.fragment.sn===Ye.fragment.sn?ee(be,Ye):ae--}}}function mapFragmentIntersection(ie,Z,ee){const ae=Z.skippedSegments,ye=Math.max(ie.startSN,Z.startSN)-Z.startSN,ve=(ie.fragmentHint?1:0)+(ae?Z.endSN:Math.min(ie.endSN,Z.endSN))-Z.startSN,be=Z.startSN-ie.startSN,Ye=Z.fragmentHint?Z.fragments.concat(Z.fragmentHint):Z.fragments,Ke=ie.fragmentHint?ie.fragments.concat(ie.fragmentHint):ie.fragments;for(let Xe=ye;Xe<=ve;Xe++){const Je=Ke[be+Xe];let rt=Ye[Xe];ae&&!rt&&Xe<ae&&(rt=Z.fragments[Xe]=Je),Je&&rt&&ee(Je,rt)}}function adjustSliding(ie,Z){const ee=Z.startSN+Z.skippedSegments-ie.startSN,ae=ie.fragments;ee<0||ee>=ae.length||addSliding(Z,ae[ee].start)}function addSliding(ie,Z){if(Z){const ee=ie.fragments;for(let ae=ie.skippedSegments;ae<ee.length;ae++)ee[ae].start+=Z;ie.fragmentHint&&(ie.fragmentHint.start+=Z)}}function computeReloadInterval(ie,Z=1/0){let ee=1e3*ie.targetduration;if(ie.updated){const ae=ie.fragments;if(ae.length&&ee*4>Z){const ye=ae[ae.length-1].duration*1e3;ye<ee&&(ee=ye)}}else ee/=2;return Math.round(ee)}function getFragmentWithSN(ie,Z,ee){if(!(ie!=null&&ie.details))return null;const ae=ie.details;let ye=ae.fragments[Z-ae.startSN];return ye||(ye=ae.fragmentHint,ye&&ye.sn===Z)?ye:Z<ae.startSN&&ee&&ee.sn===Z?ee:null}function getPartWith(ie,Z,ee){var ae;return ie!=null&&ie.details?findPart((ae=ie.details)==null?void 0:ae.partList,Z,ee):null}function findPart(ie,Z,ee){if(ie)for(let ae=ie.length;ae--;){const ye=ie[ae];if(ye.index===ee&&ye.fragment.sn===Z)return ye}return null}function reassignFragmentLevelIndexes(ie){ie.forEach((Z,ee)=>{const{details:ae}=Z;ae!=null&&ae.fragments&&ae.fragments.forEach(ye=>{ye.level=ee})})}function isTimeoutError(ie){switch(ie.details){case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_TIMEOUT:case ErrorDetails.LEVEL_LOAD_TIMEOUT:case ErrorDetails.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function getRetryConfig(ie,Z){const ee=isTimeoutError(Z);return ie.default[`${ee?"timeout":"error"}Retry`]}function getRetryDelay(ie,Z){const ee=ie.backoff==="linear"?1:Math.pow(2,Z);return Math.min(ee*ie.retryDelayMs,ie.maxRetryDelayMs)}function getLoaderConfigWithoutReties(ie){return _objectSpread2(_objectSpread2({},ie),{errorRetry:null,timeoutRetry:null})}function shouldRetry(ie,Z,ee,ae){if(!ie)return!1;const ye=ae==null?void 0:ae.code,ve=Z<ie.maxNumRetry&&(retryForHttpStatus(ye)||!!ee);return ie.shouldRetry?ie.shouldRetry(ie,Z,ee,ae,ve):ve}function retryForHttpStatus(ie){return ie===0&&navigator.onLine===!1||!!ie&&(ie<400||ie>499)}const BinarySearch={search:function(ie,Z){let ee=0,ae=ie.length-1,ye=null,ve=null;for(;ee<=ae;){ye=(ee+ae)/2|0,ve=ie[ye];const be=Z(ve);if(be>0)ee=ye+1;else if(be<0)ae=ye-1;else return ve}return null}};function findFragmentByPDT(ie,Z,ee){if(Z===null||!Array.isArray(ie)||!ie.length||!isFiniteNumber(Z))return null;const ae=ie[0].programDateTime;if(Z<(ae||0))return null;const ye=ie[ie.length-1].endProgramDateTime;if(Z>=(ye||0))return null;ee=ee||0;for(let ve=0;ve<ie.length;++ve){const be=ie[ve];if(pdtWithinToleranceTest(Z,ee,be))return be}return null}function findFragmentByPTS(ie,Z,ee=0,ae=0){let ye=null;if(ie){ye=Z[ie.sn-Z[0].sn+1]||null;const be=ie.endDTS-ee;be>0&&be<15e-7&&(ee+=15e-7)}else ee===0&&Z[0].start===0&&(ye=Z[0]);if(ye&&(!ie||ie.level===ye.level)&&fragmentWithinToleranceTest(ee,ae,ye)===0)return ye;const ve=BinarySearch.search(Z,fragmentWithinToleranceTest.bind(null,ee,ae));return ve&&(ve!==ie||!ye)?ve:ye}function fragmentWithinToleranceTest(ie=0,Z=0,ee){if(ee.start<=ie&&ee.start+ee.duration>ie)return 0;const ae=Math.min(Z,ee.duration+(ee.deltaPTS?ee.deltaPTS:0));return ee.start+ee.duration-ae<=ie?1:ee.start-ae>ie&&ee.start?-1:0}function pdtWithinToleranceTest(ie,Z,ee){const ae=Math.min(Z,ee.duration+(ee.deltaPTS?ee.deltaPTS:0))*1e3;return(ee.endProgramDateTime||0)-ae>ie}function findFragWithCC(ie,Z){return BinarySearch.search(ie,ee=>ee.cc<Z?1:ee.cc>Z?-1:0)}var NetworkErrorAction={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},ErrorActionFlags={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class ErrorController{constructor(Z){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=Z,this.log=logger.log.bind(logger,"[info]:"),this.warn=logger.warn.bind(logger,"[warning]:"),this.error=logger.error.bind(logger,"[error]:"),this.registerListeners()}registerListeners(){const Z=this.hls;Z.on(Events.ERROR,this.onError,this),Z.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const Z=this.hls;Z&&(Z.off(Events.ERROR,this.onError,this),Z.off(Events.ERROR,this.onErrorOut,this),Z.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(Z){}stopLoad(){this.playlistError=0}getVariantLevelIndex(Z){return(Z==null?void 0:Z.type)===PlaylistLevelType.MAIN?Z.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(Z,ee){var ae,ye;if(ee.fatal)return;const ve=this.hls,be=ee.context;switch(ee.details){case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:ee.errorAction=this.getFragRetryOrSwitchAction(ee);return;case ErrorDetails.FRAG_PARSING_ERROR:if((ae=ee.frag)!=null&&ae.gap){ee.errorAction={action:NetworkErrorAction.DoNothing,flags:ErrorActionFlags.None};return}case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_DECRYPT_ERROR:{ee.errorAction=this.getFragRetryOrSwitchAction(ee),ee.errorAction.action=NetworkErrorAction.SendAlternateToPenaltyBox;return}case ErrorDetails.LEVEL_EMPTY_ERROR:case ErrorDetails.LEVEL_PARSING_ERROR:{var Ye,Ke;const Xe=ee.parent===PlaylistLevelType.MAIN?ee.level:ve.loadLevel;ee.details===ErrorDetails.LEVEL_EMPTY_ERROR&&(Ye=ee.context)!=null&&(Ke=Ye.levelDetails)!=null&&Ke.live?ee.errorAction=this.getPlaylistRetryOrSwitchAction(ee,Xe):(ee.levelRetry=!1,ee.errorAction=this.getLevelSwitchAction(ee,Xe))}return;case ErrorDetails.LEVEL_LOAD_ERROR:case ErrorDetails.LEVEL_LOAD_TIMEOUT:typeof(be==null?void 0:be.level)=="number"&&(ee.errorAction=this.getPlaylistRetryOrSwitchAction(ee,be.level));return;case ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case ErrorDetails.SUBTITLE_LOAD_ERROR:case ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:if(be){const Xe=ve.levels[ve.loadLevel];if(Xe&&(be.type===PlaylistContextType.AUDIO_TRACK&&Xe.hasAudioGroup(be.groupId)||be.type===PlaylistContextType.SUBTITLE_TRACK&&Xe.hasSubtitleGroup(be.groupId))){ee.errorAction=this.getPlaylistRetryOrSwitchAction(ee,ve.loadLevel),ee.errorAction.action=NetworkErrorAction.SendAlternateToPenaltyBox,ee.errorAction.flags=ErrorActionFlags.MoveAllAlternatesMatchingHost;return}}return;case ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const Xe=ve.levels[ve.loadLevel],Je=Xe==null?void 0:Xe.attrs["HDCP-LEVEL"];Je?ee.errorAction={action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.MoveAllAlternatesMatchingHDCP,hdcpLevel:Je}:this.keySystemError(ee)}return;case ErrorDetails.BUFFER_ADD_CODEC_ERROR:case ErrorDetails.REMUX_ALLOC_ERROR:case ErrorDetails.BUFFER_APPEND_ERROR:ee.errorAction=this.getLevelSwitchAction(ee,(ye=ee.level)!=null?ye:ve.loadLevel);return;case ErrorDetails.INTERNAL_EXCEPTION:case ErrorDetails.BUFFER_APPENDING_ERROR:case ErrorDetails.BUFFER_FULL_ERROR:case ErrorDetails.LEVEL_SWITCH_ERROR:case ErrorDetails.BUFFER_STALLED_ERROR:case ErrorDetails.BUFFER_SEEK_OVER_HOLE:case ErrorDetails.BUFFER_NUDGE_ON_STALL:ee.errorAction={action:NetworkErrorAction.DoNothing,flags:ErrorActionFlags.None};return}ee.type===ErrorTypes.KEY_SYSTEM_ERROR&&this.keySystemError(ee)}keySystemError(Z){const ee=this.getVariantLevelIndex(Z.frag);Z.levelRetry=!1,Z.errorAction=this.getLevelSwitchAction(Z,ee)}getPlaylistRetryOrSwitchAction(Z,ee){const ae=this.hls,ye=getRetryConfig(ae.config.playlistLoadPolicy,Z),ve=this.playlistError++;if(shouldRetry(ye,ve,isTimeoutError(Z),Z.response))return{action:NetworkErrorAction.RetryRequest,flags:ErrorActionFlags.None,retryConfig:ye,retryCount:ve};const be=this.getLevelSwitchAction(Z,ee);return ye&&(be.retryConfig=ye,be.retryCount=ve),be}getFragRetryOrSwitchAction(Z){const ee=this.hls,ae=this.getVariantLevelIndex(Z.frag),ye=ee.levels[ae],{fragLoadPolicy:ve,keyLoadPolicy:be}=ee.config,Ye=getRetryConfig(Z.details.startsWith("key")?be:ve,Z),Ke=ee.levels.reduce((Je,rt)=>Je+rt.fragmentError,0);if(ye&&(Z.details!==ErrorDetails.FRAG_GAP&&ye.fragmentError++,shouldRetry(Ye,Ke,isTimeoutError(Z),Z.response)))return{action:NetworkErrorAction.RetryRequest,flags:ErrorActionFlags.None,retryConfig:Ye,retryCount:Ke};const Xe=this.getLevelSwitchAction(Z,ae);return Ye&&(Xe.retryConfig=Ye,Xe.retryCount=Ke),Xe}getLevelSwitchAction(Z,ee){const ae=this.hls;ee==null&&(ee=ae.loadLevel);const ye=this.hls.levels[ee];if(ye){var ve,be;const Xe=Z.details;ye.loadError++,Xe===ErrorDetails.BUFFER_APPEND_ERROR&&ye.fragmentError++;let Je=-1;const{levels:rt,loadLevel:nt,minAutoLevel:it,maxAutoLevel:lt}=ae;ae.autoLevelEnabled||(ae.loadLevel=-1);const ct=(ve=Z.frag)==null?void 0:ve.type,ot=(ct===PlaylistLevelType.AUDIO&&Xe===ErrorDetails.FRAG_PARSING_ERROR||Z.sourceBufferName==="audio"&&(Xe===ErrorDetails.BUFFER_ADD_CODEC_ERROR||Xe===ErrorDetails.BUFFER_APPEND_ERROR))&&rt.some(({audioCodec:mt})=>ye.audioCodec!==mt),dt=Z.sourceBufferName==="video"&&(Xe===ErrorDetails.BUFFER_ADD_CODEC_ERROR||Xe===ErrorDetails.BUFFER_APPEND_ERROR)&&rt.some(({codecSet:mt,audioCodec:Yr})=>ye.codecSet!==mt&&ye.audioCodec===Yr),{type:ft,groupId:gt}=(be=Z.context)!=null?be:{};for(let mt=rt.length;mt--;){const Yr=(mt+nt)%rt.length;if(Yr!==nt&&Yr>=it&&Yr<=lt&&rt[Yr].loadError===0){var Ye,Ke;const Qr=rt[Yr];if(Xe===ErrorDetails.FRAG_GAP&&Z.frag){const Xr=rt[Yr].details;if(Xr){const Jr=findFragmentByPTS(Z.frag,Xr.fragments,Z.frag.start);if(Jr!=null&&Jr.gap)continue}}else if(ft===PlaylistContextType.AUDIO_TRACK&&Qr.hasAudioGroup(gt)||ft===PlaylistContextType.SUBTITLE_TRACK&&Qr.hasSubtitleGroup(gt)||ct===PlaylistLevelType.AUDIO&&(Ye=ye.audioGroups)!=null&&Ye.some(Xr=>Qr.hasAudioGroup(Xr))||ct===PlaylistLevelType.SUBTITLE&&(Ke=ye.subtitleGroups)!=null&&Ke.some(Xr=>Qr.hasSubtitleGroup(Xr))||ot&&ye.audioCodec===Qr.audioCodec||!ot&&ye.audioCodec!==Qr.audioCodec||dt&&ye.codecSet===Qr.codecSet)continue;Je=Yr;break}}if(Je>-1&&ae.loadLevel!==Je)return Z.levelRetry=!0,this.playlistError=0,{action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.None,nextAutoLevel:Je}}return{action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.MoveAllAlternatesMatchingHost}}onErrorOut(Z,ee){var ae;switch((ae=ee.errorAction)==null?void 0:ae.action){case NetworkErrorAction.DoNothing:break;case NetworkErrorAction.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(ee),!ee.errorAction.resolved&&ee.details!==ErrorDetails.FRAG_GAP?ee.fatal=!0:/MediaSource readyState: ended/.test(ee.error.message)&&(this.warn(`MediaSource ended after "${ee.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(ee.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(Z){const ee=this.hls,ae=Z.errorAction;if(!ae)return;const{flags:ye,hdcpLevel:ve,nextAutoLevel:be}=ae;switch(ye){case ErrorActionFlags.None:this.switchLevel(Z,be);break;case ErrorActionFlags.MoveAllAlternatesMatchingHDCP:ve&&(ee.maxHdcpLevel=HdcpLevels[HdcpLevels.indexOf(ve)-1],ae.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${ee.maxHdcpLevel}" or lower`);break}ae.resolved||this.switchLevel(Z,be)}switchLevel(Z,ee){ee!==void 0&&Z.errorAction&&(this.warn(`switching to level ${ee} after ${Z.details}`),this.hls.nextAutoLevel=ee,Z.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}}class BasePlaylistController{constructor(Z,ee){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=logger.log.bind(logger,`${ee}:`),this.warn=logger.warn.bind(logger,`${ee}:`),this.hls=Z}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(Z,ee){const ae=ee==null?void 0:ee.renditionReports;if(ae){let ye=-1;for(let ve=0;ve<ae.length;ve++){const be=ae[ve];let Ye;try{Ye=new self.URL(be.URI,ee.url).href}catch(Ke){logger.warn(`Could not construct new URL for Rendition Report: ${Ke}`),Ye=be.URI||""}if(Ye===Z){ye=ve;break}else Ye===Z.substring(0,Ye.length)&&(ye=ve)}if(ye!==-1){const ve=ae[ye],be=parseInt(ve["LAST-MSN"])||(ee==null?void 0:ee.lastPartSn);let Ye=parseInt(ve["LAST-PART"])||(ee==null?void 0:ee.lastPartIndex);if(this.hls.config.lowLatencyMode){const Ke=Math.min(ee.age-ee.partTarget,ee.targetduration);Ye>=0&&Ke>ee.partTarget&&(Ye+=1)}return new HlsUrlParameters(be,Ye>=0?Ye:void 0,HlsSkip.No)}}}loadPlaylist(Z){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(Z){return this.canLoad&&!!Z&&!!Z.url&&(!Z.details||Z.details.live)}shouldReloadPlaylist(Z){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(Z)}playlistLoaded(Z,ee,ae){const{details:ye,stats:ve}=ee,be=self.performance.now(),Ye=ve.loading.first?Math.max(0,be-ve.loading.first):0;if(ye.advancedDateTime=Date.now()-Ye,ye.live||ae!=null&&ae.live){if(ye.reloaded(ae),ae&&this.log(`live playlist ${Z} ${ye.advanced?"REFRESHED "+ye.lastPartSn+"-"+ye.lastPartIndex:ye.updated?"UPDATED":"MISSED"}`),ae&&ye.fragments.length>0&&mergeDetails(ae,ye),!this.canLoad||!ye.live)return;let Ke,Xe,Je;if(ye.canBlockReload&&ye.endSN&&ye.advanced){const ot=this.hls.config.lowLatencyMode,dt=ye.lastPartSn,ft=ye.endSN,gt=ye.lastPartIndex,mt=gt!==-1,Yr=dt===ft,Qr=ot?0:gt;mt?(Xe=Yr?ft+1:dt,Je=Yr?Qr:gt+1):Xe=ft+1;const Xr=ye.age,Jr=Xr+ye.ageHeader;let ai=Math.min(Jr-ye.partTarget,ye.targetduration*1.5);if(ai>0){if(ae&&ai>ae.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${ae.tuneInGoal} to: ${ai} with playlist age: ${ye.age}`),ai=0;else{const oi=Math.floor(ai/ye.targetduration);if(Xe+=oi,Je!==void 0){const ni=Math.round(ai%ye.targetduration/ye.partTarget);Je+=ni}this.log(`CDN Tune-in age: ${ye.ageHeader}s last advanced ${Xr.toFixed(2)}s goal: ${ai} skip sn ${oi} to part ${Je}`)}ye.tuneInGoal=ai}if(Ke=this.getDeliveryDirectives(ye,ee.deliveryDirectives,Xe,Je),ot||!Yr){this.loadPlaylist(Ke);return}}else(ye.canBlockReload||ye.canSkipUntil)&&(Ke=this.getDeliveryDirectives(ye,ee.deliveryDirectives,Xe,Je));const rt=this.hls.mainForwardBufferInfo,nt=rt?rt.end-rt.len:0,it=(ye.edge-nt)*1e3,lt=computeReloadInterval(ye,it);ye.updated&&be>this.requestScheduled+lt&&(this.requestScheduled=ve.loading.start),Xe!==void 0&&ye.canBlockReload?this.requestScheduled=ve.loading.first+lt-(ye.partTarget*1e3||1e3):this.requestScheduled===-1||this.requestScheduled+lt<be?this.requestScheduled=be:this.requestScheduled-be<=0&&(this.requestScheduled+=lt);let ct=this.requestScheduled-be;ct=Math.max(0,ct),this.log(`reload live playlist ${Z} in ${Math.round(ct)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(Ke),ct)}else this.clearTimer()}getDeliveryDirectives(Z,ee,ae,ye){let ve=getSkipValue(Z,ae);return ee!=null&&ee.skip&&Z.deltaUpdateFailed&&(ae=ee.msn,ye=ee.part,ve=HlsSkip.No),new HlsUrlParameters(ae,ye,ve)}checkRetry(Z){const ee=Z.details,ae=isTimeoutError(Z),ye=Z.errorAction,{action:ve,retryCount:be=0,retryConfig:Ye}=ye||{},Ke=!!ye&&!!Ye&&(ve===NetworkErrorAction.RetryRequest||!ye.resolved&&ve===NetworkErrorAction.SendAlternateToPenaltyBox);if(Ke){var Xe;if(this.requestScheduled=-1,be>=Ye.maxNumRetry)return!1;if(ae&&(Xe=Z.context)!=null&&Xe.deliveryDirectives)this.warn(`Retrying playlist loading ${be+1}/${Ye.maxNumRetry} after "${ee}" without delivery-directives`),this.loadPlaylist();else{const Je=getRetryDelay(Ye,be);this.timer=self.setTimeout(()=>this.loadPlaylist(),Je),this.warn(`Retrying playlist loading ${be+1}/${Ye.maxNumRetry} after "${ee}" in ${Je}ms`)}Z.levelRetry=!0,ye.resolved=!0}return Ke}}class EWMA{constructor(Z,ee=0,ae=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=Z,this.alpha_=Z?Math.exp(Math.log(.5)/Z):0,this.estimate_=ee,this.totalWeight_=ae}sample(Z,ee){const ae=Math.pow(this.alpha_,Z);this.estimate_=ee*(1-ae)+ae*this.estimate_,this.totalWeight_+=Z}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const Z=1-Math.pow(this.alpha_,this.totalWeight_);if(Z)return this.estimate_/Z}return this.estimate_}}class EwmaBandWidthEstimator{constructor(Z,ee,ae,ye=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=ae,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new EWMA(Z),this.fast_=new EWMA(ee),this.defaultTTFB_=ye,this.ttfb_=new EWMA(Z)}update(Z,ee){const{slow_:ae,fast_:ye,ttfb_:ve}=this;ae.halfLife!==Z&&(this.slow_=new EWMA(Z,ae.getEstimate(),ae.getTotalWeight())),ye.halfLife!==ee&&(this.fast_=new EWMA(ee,ye.getEstimate(),ye.getTotalWeight())),ve.halfLife!==Z&&(this.ttfb_=new EWMA(Z,ve.getEstimate(),ve.getTotalWeight()))}sample(Z,ee){Z=Math.max(Z,this.minDelayMs_);const ae=8*ee,ye=Z/1e3,ve=ae/ye;this.fast_.sample(ye,ve),this.slow_.sample(ye,ve)}sampleTTFB(Z){const ee=Z/1e3,ae=Math.sqrt(2)*Math.exp(-Math.pow(ee,2)/2);this.ttfb_.sample(ae,Math.max(Z,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}const SUPPORTED_INFO_DEFAULT={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]},SUPPORTED_INFO_CACHE={};function requiresMediaCapabilitiesDecodingInfo(ie,Z,ee,ae,ye,ve){const be=ie.audioCodec?ie.audioGroups:null,Ye=ve==null?void 0:ve.audioCodec,Ke=ve==null?void 0:ve.channels,Xe=Ke?parseInt(Ke):Ye?1/0:2;let Je=null;if(be!=null&&be.length)try{be.length===1&&be[0]?Je=Z.groups[be[0]].channels:Je=be.reduce((rt,nt)=>{if(nt){const it=Z.groups[nt];if(!it)throw new Error(`Audio track group ${nt} not found`);Object.keys(it.channels).forEach(lt=>{rt[lt]=(rt[lt]||0)+it.channels[lt]})}return rt},{2:0})}catch{return!0}return ie.videoCodec!==void 0&&(ie.width>1920&&ie.height>1088||ie.height>1920&&ie.width>1088||ie.frameRate>Math.max(ae,30)||ie.videoRange!=="SDR"&&ie.videoRange!==ee||ie.bitrate>Math.max(ye,8e6))||!!Je&&isFiniteNumber(Xe)&&Object.keys(Je).some(rt=>parseInt(rt)>Xe)}function getMediaDecodingInfoPromise(ie,Z,ee){const ae=ie.videoCodec,ye=ie.audioCodec;if(!ae||!ye||!ee)return Promise.resolve(SUPPORTED_INFO_DEFAULT);const ve={width:ie.width,height:ie.height,bitrate:Math.ceil(Math.max(ie.bitrate*.9,ie.averageBitrate)),framerate:ie.frameRate||30},be=ie.videoRange;be!=="SDR"&&(ve.transferFunction=be.toLowerCase());const Ye=ae.split(",").map(Ke=>({type:"media-source",video:_objectSpread2(_objectSpread2({},ve),{},{contentType:mimeTypeForCodec(Ke,"video")})}));return ye&&ie.audioGroups&&ie.audioGroups.forEach(Ke=>{var Xe;Ke&&((Xe=Z.groups[Ke])==null||Xe.tracks.forEach(Je=>{if(Je.groupId===Ke){const rt=Je.channels||"",nt=parseFloat(rt);isFiniteNumber(nt)&&nt>2&&Ye.push.apply(Ye,ye.split(",").map(it=>({type:"media-source",audio:{contentType:mimeTypeForCodec(it,"audio"),channels:""+nt}})))}}))}),Promise.all(Ye.map(Ke=>{const Xe=getMediaDecodingInfoKey(Ke);return SUPPORTED_INFO_CACHE[Xe]||(SUPPORTED_INFO_CACHE[Xe]=ee.decodingInfo(Ke))})).then(Ke=>({supported:!Ke.some(Xe=>!Xe.supported),configurations:Ye,decodingInfoResults:Ke})).catch(Ke=>({supported:!1,configurations:Ye,decodingInfoResults:[],error:Ke}))}function getMediaDecodingInfoKey(ie){const{audio:Z,video:ee}=ie,ae=ee||Z;if(ae){const ye=ae.contentType.split('"')[1];if(ee)return`r${ee.height}x${ee.width}f${Math.ceil(ee.framerate)}${ee.transferFunction||"sd"}_${ye}_${Math.ceil(ee.bitrate/1e5)}`;if(Z)return`c${Z.channels}${Z.spatialRendering?"s":"n"}_${ye}`}return""}function isHdrSupported(){if(typeof matchMedia=="function"){const ie=matchMedia("(dynamic-range: high)"),Z=matchMedia("bad query");if(ie.media!==Z.media)return ie.matches===!0}return!1}function getVideoSelectionOptions(ie,Z){let ee=!1,ae=[];return ie&&(ee=ie!=="SDR",ae=[ie]),Z&&(ae=Z.allowedVideoRanges||VideoRangeValues.slice(0),ee=Z.preferHDR!==void 0?Z.preferHDR:isHdrSupported(),ee?ae=ae.filter(ye=>ye!=="SDR"):ae=["SDR"]),{preferHDR:ee,allowedVideoRanges:ae}}function getStartCodecTier(ie,Z,ee,ae,ye){const ve=Object.keys(ie),be=ae==null?void 0:ae.channels,Ye=ae==null?void 0:ae.audioCodec,Ke=be&&parseInt(be)===2;let Xe=!0,Je=!1,rt=1/0,nt=1/0,it=1/0,lt=0,ct=[];const{preferHDR:ot,allowedVideoRanges:dt}=getVideoSelectionOptions(Z,ye);for(let mt=ve.length;mt--;){const Yr=ie[ve[mt]];Xe=Yr.channels[2]>0,rt=Math.min(rt,Yr.minHeight),nt=Math.min(nt,Yr.minFramerate),it=Math.min(it,Yr.minBitrate);const Qr=dt.filter(Xr=>Yr.videoRanges[Xr]>0);Qr.length>0&&(Je=!0,ct=Qr)}rt=isFiniteNumber(rt)?rt:0,nt=isFiniteNumber(nt)?nt:0;const ft=Math.max(1080,rt),gt=Math.max(30,nt);return it=isFiniteNumber(it)?it:ee,ee=Math.max(it,ee),Je||(Z=void 0,ct=[]),{codecSet:ve.reduce((mt,Yr)=>{const Qr=ie[Yr];if(Yr===mt)return mt;if(Qr.minBitrate>ee)return logStartCodecCandidateIgnored(Yr,`min bitrate of ${Qr.minBitrate} > current estimate of ${ee}`),mt;if(!Qr.hasDefaultAudio)return logStartCodecCandidateIgnored(Yr,"no renditions with default or auto-select sound found"),mt;if(Ye&&Yr.indexOf(Ye.substring(0,4))%5!==0)return logStartCodecCandidateIgnored(Yr,`audio codec preference "${Ye}" not found`),mt;if(be&&!Ke){if(!Qr.channels[be])return logStartCodecCandidateIgnored(Yr,`no renditions with ${be} channel sound found (channels options: ${Object.keys(Qr.channels)})`),mt}else if((!Ye||Ke)&&Xe&&Qr.channels[2]===0)return logStartCodecCandidateIgnored(Yr,"no renditions with stereo sound found"),mt;return Qr.minHeight>ft?(logStartCodecCandidateIgnored(Yr,`min resolution of ${Qr.minHeight} > maximum of ${ft}`),mt):Qr.minFramerate>gt?(logStartCodecCandidateIgnored(Yr,`min framerate of ${Qr.minFramerate} > maximum of ${gt}`),mt):ct.some(Xr=>Qr.videoRanges[Xr]>0)?Qr.maxScore<lt?(logStartCodecCandidateIgnored(Yr,`max score of ${Qr.maxScore} < selected max of ${lt}`),mt):mt&&(codecsSetSelectionPreferenceValue(Yr)>=codecsSetSelectionPreferenceValue(mt)||Qr.fragmentError>ie[mt].fragmentError)?mt:(lt=Qr.maxScore,Yr):(logStartCodecCandidateIgnored(Yr,`no variants with VIDEO-RANGE of ${JSON.stringify(ct)} found`),mt)},void 0),videoRanges:ct,preferHDR:ot,minFramerate:nt,minBitrate:it}}function logStartCodecCandidateIgnored(ie,Z){logger.log(`[abr] start candidates with "${ie}" ignored because ${Z}`)}function getAudioTracksByGroup(ie){return ie.reduce((Z,ee)=>{let ae=Z.groups[ee.groupId];ae||(ae=Z.groups[ee.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),ae.tracks.push(ee);const ye=ee.channels||"2";return ae.channels[ye]=(ae.channels[ye]||0)+1,ae.hasDefault=ae.hasDefault||ee.default,ae.hasAutoSelect=ae.hasAutoSelect||ee.autoselect,ae.hasDefault&&(Z.hasDefaultAudio=!0),ae.hasAutoSelect&&(Z.hasAutoSelectAudio=!0),Z},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function getCodecTiers(ie,Z,ee,ae){return ie.slice(ee,ae+1).reduce((ye,ve)=>{if(!ve.codecSet)return ye;const be=ve.audioGroups;let Ye=ye[ve.codecSet];Ye||(ye[ve.codecSet]=Ye={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!be,fragmentError:0}),Ye.minBitrate=Math.min(Ye.minBitrate,ve.bitrate);const Ke=Math.min(ve.height,ve.width);return Ye.minHeight=Math.min(Ye.minHeight,Ke),Ye.minFramerate=Math.min(Ye.minFramerate,ve.frameRate),Ye.maxScore=Math.max(Ye.maxScore,ve.score),Ye.fragmentError+=ve.fragmentError,Ye.videoRanges[ve.videoRange]=(Ye.videoRanges[ve.videoRange]||0)+1,be&&be.forEach(Xe=>{if(!Xe)return;const Je=Z.groups[Xe];Ye.hasDefaultAudio=Ye.hasDefaultAudio||Z.hasDefaultAudio?Je.hasDefault:Je.hasAutoSelect||!Z.hasDefaultAudio&&!Z.hasAutoSelectAudio,Object.keys(Je.channels).forEach(rt=>{Ye.channels[rt]=(Ye.channels[rt]||0)+Je.channels[rt]})}),ye},{})}function findMatchingOption(ie,Z,ee){if("attrs"in ie){const ae=Z.indexOf(ie);if(ae!==-1)return ae}for(let ae=0;ae<Z.length;ae++){const ye=Z[ae];if(matchesOption(ie,ye,ee))return ae}return-1}function matchesOption(ie,Z,ee){const{groupId:ae,name:ye,lang:ve,assocLang:be,characteristics:Ye,default:Ke}=ie,Xe=ie.forced;return(ae===void 0||Z.groupId===ae)&&(ye===void 0||Z.name===ye)&&(ve===void 0||Z.lang===ve)&&(ve===void 0||Z.assocLang===be)&&(Ke===void 0||Z.default===Ke)&&(Xe===void 0||Z.forced===Xe)&&(Ye===void 0||characteristicsMatch(Ye,Z.characteristics))&&(ee===void 0||ee(ie,Z))}function characteristicsMatch(ie,Z=""){const ee=ie.split(","),ae=Z.split(",");return ee.length===ae.length&&!ee.some(ye=>ae.indexOf(ye)===-1)}function audioMatchPredicate(ie,Z){const{audioCodec:ee,channels:ae}=ie;return(ee===void 0||(Z.audioCodec||"").substring(0,4)===ee.substring(0,4))&&(ae===void 0||ae===(Z.channels||"2"))}function findClosestLevelWithAudioGroup(ie,Z,ee,ae,ye){const ve=Z[ae],be=Z.reduce((rt,nt,it)=>{const lt=nt.uri;return(rt[lt]||(rt[lt]=[])).push(it),rt},{})[ve.uri];be.length>1&&(ae=Math.max.apply(Math,be));const Ye=ve.videoRange,Ke=ve.frameRate,Xe=ve.codecSet.substring(0,4),Je=searchDownAndUpList(Z,ae,rt=>{if(rt.videoRange!==Ye||rt.frameRate!==Ke||rt.codecSet.substring(0,4)!==Xe)return!1;const nt=rt.audioGroups,it=ee.filter(lt=>!nt||nt.indexOf(lt.groupId)!==-1);return findMatchingOption(ie,it,ye)>-1});return Je>-1?Je:searchDownAndUpList(Z,ae,rt=>{const nt=rt.audioGroups,it=ee.filter(lt=>!nt||nt.indexOf(lt.groupId)!==-1);return findMatchingOption(ie,it,ye)>-1})}function searchDownAndUpList(ie,Z,ee){for(let ae=Z;ae;ae--)if(ee(ie[ae]))return ae;for(let ae=Z+1;ae<ie.length;ae++)if(ee(ie[ae]))return ae;return-1}class AbrController{constructor(Z){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this._abandonRulesCheck=()=>{const{fragCurrent:ee,partCurrent:ae,hls:ye}=this,{autoLevelEnabled:ve,media:be}=ye;if(!ee||!be)return;const Ye=performance.now(),Ke=ae?ae.stats:ee.stats,Xe=ae?ae.duration:ee.duration,Je=Ye-Ke.loading.start,rt=ye.minAutoLevel;if(Ke.aborted||Ke.loaded&&Ke.loaded===Ke.total||ee.level<=rt){this.clearTimer(),this._nextAutoLevel=-1;return}if(!ve||be.paused||!be.playbackRate||!be.readyState)return;const nt=ye.mainForwardBufferInfo;if(nt===null)return;const it=this.bwEstimator.getEstimateTTFB(),lt=Math.abs(be.playbackRate);if(Je<=Math.max(it,1e3*(Xe/(lt*2))))return;const ct=nt.len/lt,ot=Ke.loading.first?Ke.loading.first-Ke.loading.start:-1,dt=Ke.loaded&&ot>-1,ft=this.getBwEstimate(),gt=ye.levels,mt=gt[ee.level],Yr=Ke.total||Math.max(Ke.loaded,Math.round(Xe*mt.averageBitrate/8));let Qr=dt?Je-ot:Je;Qr<1&&dt&&(Qr=Math.min(Je,Ke.loaded*8/ft));const Xr=dt?Ke.loaded*1e3/Qr:0,Jr=Xr?(Yr-Ke.loaded)/Xr:Yr*8/ft+it/1e3;if(Jr<=ct)return;const ai=Xr?Xr*8:ft;let oi=Number.POSITIVE_INFINITY,ni;for(ni=ee.level-1;ni>rt;ni--){const ui=gt[ni].maxBitrate;if(oi=this.getTimeToLoadFrag(it/1e3,ai,Xe*ui,!gt[ni].details),oi<ct)break}if(oi>=Jr||oi>Xe*10)return;ye.nextLoadLevel=ye.nextAutoLevel=ni,dt?this.bwEstimator.sample(Je-Math.min(it,ot),Ke.loaded):this.bwEstimator.sampleTTFB(Je);const li=gt[ni].maxBitrate;this.getBwEstimate()*this.hls.config.abrBandWidthUpFactor>li&&this.resetEstimator(li),this.clearTimer(),logger.warn(`[abr] Fragment ${ee.sn}${ae?" part "+ae.index:""} of level ${ee.level} is loading too slowly;
      Time to underbuffer: ${ct.toFixed(3)} s
      Estimated load time for current fragment: ${Jr.toFixed(3)} s
      Estimated load time for down switch fragment: ${oi.toFixed(3)} s
      TTFB estimate: ${ot|0} ms
      Current BW estimate: ${isFiniteNumber(ft)?ft|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${ni} @ ${li|0} bps`),ye.trigger(Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:ee,part:ae,stats:Ke})},this.hls=Z,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(Z){Z&&(logger.log(`setting initial bwe to ${Z}`),this.hls.config.abrEwmaDefaultEstimate=Z),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const Z=this.hls.config;return new EwmaBandWidthEstimator(Z.abrEwmaSlowVoD,Z.abrEwmaFastVoD,Z.abrEwmaDefaultEstimate)}registerListeners(){const{hls:Z}=this;Z.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.on(Events.FRAG_LOADING,this.onFragLoading,this),Z.on(Events.FRAG_LOADED,this.onFragLoaded,this),Z.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),Z.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),Z.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),Z.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),Z.on(Events.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),Z.on(Events.ERROR,this.onError,this)}unregisterListeners(){const{hls:Z}=this;Z&&(Z.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.off(Events.FRAG_LOADING,this.onFragLoading,this),Z.off(Events.FRAG_LOADED,this.onFragLoaded,this),Z.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),Z.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),Z.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),Z.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),Z.off(Events.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),Z.off(Events.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(Z,ee){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(Z,ee){const ae=ee.frag;if(!this.ignoreFragment(ae)){if(!ae.bitrateTest){var ye;this.fragCurrent=ae,this.partCurrent=(ye=ee.part)!=null?ye:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(Z,ee){this.clearTimer()}onError(Z,ee){if(!ee.fatal)switch(ee.details){case ErrorDetails.BUFFER_ADD_CODEC_ERROR:case ErrorDetails.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case ErrorDetails.FRAG_LOAD_TIMEOUT:{const ae=ee.frag,{fragCurrent:ye,partCurrent:ve}=this;if(ae&&ye&&ae.sn===ye.sn&&ae.level===ye.level){const be=performance.now(),Ye=ve?ve.stats:ae.stats,Ke=be-Ye.loading.start,Xe=Ye.loading.first?Ye.loading.first-Ye.loading.start:-1;if(Ye.loaded&&Xe>-1){const Je=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(Ke-Math.min(Je,Xe),Ye.loaded)}else this.bwEstimator.sampleTTFB(Ke)}break}}}getTimeToLoadFrag(Z,ee,ae,ye){const ve=Z+ae/ee,be=ye?this.lastLevelLoadSec:0;return ve+be}onLevelLoaded(Z,ee){const ae=this.hls.config,{loading:ye}=ee.stats,ve=ye.end-ye.start;isFiniteNumber(ve)&&(this.lastLevelLoadSec=ve/1e3),ee.details.live?this.bwEstimator.update(ae.abrEwmaSlowLive,ae.abrEwmaFastLive):this.bwEstimator.update(ae.abrEwmaSlowVoD,ae.abrEwmaFastVoD)}onFragLoaded(Z,{frag:ee,part:ae}){const ye=ae?ae.stats:ee.stats;if(ee.type===PlaylistLevelType.MAIN&&this.bwEstimator.sampleTTFB(ye.loading.first-ye.loading.start),!this.ignoreFragment(ee)){if(this.clearTimer(),ee.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const ve=ae?ae.duration:ee.duration,be=this.hls.levels[ee.level],Ye=(be.loaded?be.loaded.bytes:0)+ye.loaded,Ke=(be.loaded?be.loaded.duration:0)+ve;be.loaded={bytes:Ye,duration:Ke},be.realBitrate=Math.round(8*Ye/Ke)}if(ee.bitrateTest){const ve={stats:ye,frag:ee,part:ae,id:ee.type};this.onFragBuffered(Events.FRAG_BUFFERED,ve),ee.bitrateTest=!1}else this.lastLoadedFragLevel=ee.level}}onFragBuffered(Z,ee){const{frag:ae,part:ye}=ee,ve=ye!=null&&ye.stats.loaded?ye.stats:ae.stats;if(ve.aborted||this.ignoreFragment(ae))return;const be=ve.parsing.end-ve.loading.start-Math.min(ve.loading.first-ve.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(be,ve.loaded),ve.bwEstimate=this.getBwEstimate(),ae.bitrateTest?this.bitrateTestDelay=be/1e3:this.bitrateTestDelay=0}ignoreFragment(Z){return Z.type!==PlaylistLevelType.MAIN||Z.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:Z,minAutoLevel:ee}=this.hls,ae=this.getBwEstimate(),ye=this.hls.config.maxStarvationDelay,ve=this.findBestLevel(ae,ee,Z,0,ye,1,1);if(ve>-1)return ve;const be=this.hls.firstLevel,Ye=Math.min(Math.max(be,ee),Z);return logger.warn(`[abr] Could not find best starting auto level. Defaulting to first in playlist ${be} clamped to ${Ye}`),Ye}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const Z=this.forcedAutoLevel,ee=this.bwEstimator.canEstimate(),ae=this.lastLoadedFragLevel>-1;if(Z!==-1&&(!ee||!ae||this.nextAutoLevelKey===this.getAutoLevelKey()))return Z;const ye=ee&&ae?this.getNextABRAutoLevel():this.firstAutoLevel;if(Z!==-1){const ve=this.hls.levels;if(ve.length>Math.max(Z,ye)&&ve[Z].loadError<=ve[ye].loadError)return Z}return this._nextAutoLevel=ye,this.nextAutoLevelKey=this.getAutoLevelKey(),ye}getAutoLevelKey(){var Z;return`${this.getBwEstimate()}_${(Z=this.hls.mainForwardBufferInfo)==null?void 0:Z.len}`}getNextABRAutoLevel(){const{fragCurrent:Z,partCurrent:ee,hls:ae}=this,{maxAutoLevel:ye,config:ve,minAutoLevel:be,media:Ye}=ae,Ke=ee?ee.duration:Z?Z.duration:0,Xe=Ye&&Ye.playbackRate!==0?Math.abs(Ye.playbackRate):1,Je=this.getBwEstimate(),rt=ae.mainForwardBufferInfo,nt=(rt?rt.len:0)/Xe;let it=ve.abrBandWidthFactor,lt=ve.abrBandWidthUpFactor;if(nt){const gt=this.findBestLevel(Je,be,ye,nt,0,it,lt);if(gt>=0)return gt}let ct=Ke?Math.min(Ke,ve.maxStarvationDelay):ve.maxStarvationDelay;if(!nt){const gt=this.bitrateTestDelay;gt&&(ct=(Ke?Math.min(Ke,ve.maxLoadingDelay):ve.maxLoadingDelay)-gt,logger.info(`[abr] bitrate test took ${Math.round(1e3*gt)}ms, set first fragment max fetchDuration to ${Math.round(1e3*ct)} ms`),it=lt=1)}const ot=this.findBestLevel(Je,be,ye,nt,ct,it,lt);if(logger.info(`[abr] ${nt?"rebuffering expected":"buffer is empty"}, optimal quality level ${ot}`),ot>-1)return ot;const dt=ae.levels[be],ft=ae.levels[ae.loadLevel];return(dt==null?void 0:dt.bitrate)<(ft==null?void 0:ft.bitrate)?be:ae.loadLevel}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(Z,ee,ae,ye,ve,be,Ye){var Ke;const Xe=ye+ve,Je=this.lastLoadedFragLevel,rt=Je===-1?this.hls.firstLevel:Je,{fragCurrent:nt,partCurrent:it}=this,{levels:lt,allAudioTracks:ct,loadLevel:ot,config:dt}=this.hls;if(lt.length===1)return 0;const ft=lt[rt],gt=!!(ft!=null&&(Ke=ft.details)!=null&&Ke.live),mt=ot===-1||Je===-1;let Yr,Qr="SDR",Xr=(ft==null?void 0:ft.frameRate)||0;const{audioPreference:Jr,videoPreference:ai}=dt,oi=this.audioTracksByGroup||(this.audioTracksByGroup=getAudioTracksByGroup(ct));if(mt){if(this.firstSelection!==-1)return this.firstSelection;const ii=this.codecTiers||(this.codecTiers=getCodecTiers(lt,oi,ee,ae)),hi=getStartCodecTier(ii,Qr,Z,Jr,ai),{codecSet:ri,videoRanges:ci,minFramerate:Si,minBitrate:si,preferHDR:Ei}=hi;Yr=ri,Qr=Ei?ci[ci.length-1]:ci[0],Xr=Si,Z=Math.max(Z,si),logger.log(`[abr] picked start tier ${JSON.stringify(hi)}`)}else Yr=ft==null?void 0:ft.codecSet,Qr=ft==null?void 0:ft.videoRange;const ni=it?it.duration:nt?nt.duration:0,li=this.bwEstimator.getEstimateTTFB()/1e3,ui=[];for(let ii=ae;ii>=ee;ii--){var mi;const hi=lt[ii],ri=ii>rt;if(!hi)continue;if(dt.useMediaCapabilities&&!hi.supportedResult&&!hi.supportedPromise){const Mi=navigator.mediaCapabilities;typeof(Mi==null?void 0:Mi.decodingInfo)=="function"&&requiresMediaCapabilitiesDecodingInfo(hi,oi,Qr,Xr,Z,Jr)?(hi.supportedPromise=getMediaDecodingInfoPromise(hi,oi,Mi),hi.supportedPromise.then(Ci=>{hi.supportedResult=Ci;const Ri=this.hls.levels,Ni=Ri.indexOf(hi);Ci.error?logger.warn(`[abr] MediaCapabilities decodingInfo error: "${Ci.error}" for level ${Ni} ${JSON.stringify(Ci)}`):Ci.supported||(logger.warn(`[abr] Unsupported MediaCapabilities decodingInfo result for level ${Ni} ${JSON.stringify(Ci)}`),Ni>-1&&Ri.length>1&&(logger.log(`[abr] Removing unsupported level ${Ni}`),this.hls.removeLevel(Ni)))})):hi.supportedResult=SUPPORTED_INFO_DEFAULT}if(Yr&&hi.codecSet!==Yr||Qr&&hi.videoRange!==Qr||ri&&Xr>hi.frameRate||!ri&&Xr>0&&Xr<hi.frameRate||hi.supportedResult&&!((mi=hi.supportedResult.decodingInfoResults)!=null&&mi[0].smooth)){ui.push(ii);continue}const ci=hi.details,Si=(it?ci==null?void 0:ci.partTarget:ci==null?void 0:ci.averagetargetduration)||ni;let si;ri?si=Ye*Z:si=be*Z;const Ei=ni&&ye>=ni*2&&ve===0?lt[ii].averageBitrate:lt[ii].maxBitrate,yi=this.getTimeToLoadFrag(li,si,Ei*Si,ci===void 0);if(si>=Ei&&(ii===Je||hi.loadError===0&&hi.fragmentError===0)&&(yi<=li||!isFiniteNumber(yi)||gt&&!this.bitrateTestDelay||yi<Xe)){const Mi=this.forcedAutoLevel;return ii!==ot&&(Mi===-1||Mi!==ot)&&(ui.length&&logger.trace(`[abr] Skipped level(s) ${ui.join(",")} of ${ae} max with CODECS and VIDEO-RANGE:"${lt[ui[0]].codecs}" ${lt[ui[0]].videoRange}; not compatible with "${ft.codecs}" ${Qr}`),logger.info(`[abr] switch candidate:${rt}->${ii} adjustedbw(${Math.round(si)})-bitrate=${Math.round(si-Ei)} ttfb:${li.toFixed(1)} avgDuration:${Si.toFixed(1)} maxFetchDuration:${Xe.toFixed(1)} fetchDuration:${yi.toFixed(1)} firstSelection:${mt} codecSet:${Yr} videoRange:${Qr} hls.loadLevel:${ot}`)),mt&&(this.firstSelection=ii),ii}}return-1}set nextAutoLevel(Z){const ee=Math.max(this.hls.minAutoLevel,Z);this._nextAutoLevel!=ee&&(this.nextAutoLevelKey="",this._nextAutoLevel=ee)}}class TaskLoop{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(Z){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,Z),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}var FragmentState={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class FragmentTracker{constructor(Z){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=Z,this._registerListeners()}_registerListeners(){const{hls:Z}=this;Z.on(Events.BUFFER_APPENDED,this.onBufferAppended,this),Z.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),Z.on(Events.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:Z}=this;Z.off(Events.BUFFER_APPENDED,this.onBufferAppended,this),Z.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),Z.off(Events.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(Z,ee){const ae=this.activePartLists[ee];if(ae)for(let ye=ae.length;ye--;){const ve=ae[ye];if(!ve)break;const be=ve.end;if(ve.start<=Z&&be!==null&&Z<=be)return ve}return this.getBufferedFrag(Z,ee)}getBufferedFrag(Z,ee){const{fragments:ae}=this,ye=Object.keys(ae);for(let ve=ye.length;ve--;){const be=ae[ye[ve]];if((be==null?void 0:be.body.type)===ee&&be.buffered){const Ye=be.body;if(Ye.start<=Z&&Z<=Ye.end)return Ye}}return null}detectEvictedFragments(Z,ee,ae,ye){this.timeRanges&&(this.timeRanges[Z]=ee);const ve=(ye==null?void 0:ye.fragment.sn)||-1;Object.keys(this.fragments).forEach(be=>{const Ye=this.fragments[be];if(!Ye||ve>=Ye.body.sn)return;if(!Ye.buffered&&!Ye.loaded){Ye.body.type===ae&&this.removeFragment(Ye.body);return}const Ke=Ye.range[Z];Ke&&Ke.time.some(Xe=>{const Je=!this.isTimeBuffered(Xe.startPTS,Xe.endPTS,ee);return Je&&this.removeFragment(Ye.body),Je})})}detectPartialFragments(Z){const ee=this.timeRanges,{frag:ae,part:ye}=Z;if(!ee||ae.sn==="initSegment")return;const ve=getFragmentKey(ae),be=this.fragments[ve];if(!be||be.buffered&&ae.gap)return;const Ye=!ae.relurl;Object.keys(ee).forEach(Ke=>{const Xe=ae.elementaryStreams[Ke];if(!Xe)return;const Je=ee[Ke],rt=Ye||Xe.partial===!0;be.range[Ke]=this.getBufferedTimes(ae,ye,rt,Je)}),be.loaded=null,Object.keys(be.range).length?(be.buffered=!0,(be.body.endList=ae.endList||be.body.endList)&&(this.endListFragments[be.body.type]=be),isPartial(be)||this.removeParts(ae.sn-1,ae.type)):this.removeFragment(be.body)}removeParts(Z,ee){const ae=this.activePartLists[ee];ae&&(this.activePartLists[ee]=ae.filter(ye=>ye.fragment.sn>=Z))}fragBuffered(Z,ee){const ae=getFragmentKey(Z);let ye=this.fragments[ae];!ye&&ee&&(ye=this.fragments[ae]={body:Z,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},Z.gap&&(this.hasGaps=!0)),ye&&(ye.loaded=null,ye.buffered=!0)}getBufferedTimes(Z,ee,ae,ye){const ve={time:[],partial:ae},be=Z.start,Ye=Z.end,Ke=Z.minEndPTS||Ye,Xe=Z.maxStartPTS||be;for(let Je=0;Je<ye.length;Je++){const rt=ye.start(Je)-this.bufferPadding,nt=ye.end(Je)+this.bufferPadding;if(Xe>=rt&&Ke<=nt){ve.time.push({startPTS:Math.max(be,ye.start(Je)),endPTS:Math.min(Ye,ye.end(Je))});break}else if(be<nt&&Ye>rt){const it=Math.max(be,ye.start(Je)),lt=Math.min(Ye,ye.end(Je));lt>it&&(ve.partial=!0,ve.time.push({startPTS:it,endPTS:lt}))}else if(Ye<=rt)break}return ve}getPartialFragment(Z){let ee=null,ae,ye,ve,be=0;const{bufferPadding:Ye,fragments:Ke}=this;return Object.keys(Ke).forEach(Xe=>{const Je=Ke[Xe];Je&&isPartial(Je)&&(ye=Je.body.start-Ye,ve=Je.body.end+Ye,Z>=ye&&Z<=ve&&(ae=Math.min(Z-ye,ve-Z),be<=ae&&(ee=Je.body,be=ae)))}),ee}isEndListAppended(Z){const ee=this.endListFragments[Z];return ee!==void 0&&(ee.buffered||isPartial(ee))}getState(Z){const ee=getFragmentKey(Z),ae=this.fragments[ee];return ae?ae.buffered?isPartial(ae)?FragmentState.PARTIAL:FragmentState.OK:FragmentState.APPENDING:FragmentState.NOT_LOADED}isTimeBuffered(Z,ee,ae){let ye,ve;for(let be=0;be<ae.length;be++){if(ye=ae.start(be)-this.bufferPadding,ve=ae.end(be)+this.bufferPadding,Z>=ye&&ee<=ve)return!0;if(ee<=ye)return!1}return!1}onFragLoaded(Z,ee){const{frag:ae,part:ye}=ee;if(ae.sn==="initSegment"||ae.bitrateTest)return;const ve=ye?null:ee,be=getFragmentKey(ae);this.fragments[be]={body:ae,appendedPTS:null,loaded:ve,buffered:!1,range:Object.create(null)}}onBufferAppended(Z,ee){const{frag:ae,part:ye,timeRanges:ve}=ee;if(ae.sn==="initSegment")return;const be=ae.type;if(ye){let Ye=this.activePartLists[be];Ye||(this.activePartLists[be]=Ye=[]),Ye.push(ye)}this.timeRanges=ve,Object.keys(ve).forEach(Ye=>{const Ke=ve[Ye];this.detectEvictedFragments(Ye,Ke,be,ye)})}onFragBuffered(Z,ee){this.detectPartialFragments(ee)}hasFragment(Z){const ee=getFragmentKey(Z);return!!this.fragments[ee]}hasParts(Z){var ee;return!!((ee=this.activePartLists[Z])!=null&&ee.length)}removeFragmentsInRange(Z,ee,ae,ye,ve){ye&&!this.hasGaps||Object.keys(this.fragments).forEach(be=>{const Ye=this.fragments[be];if(!Ye)return;const Ke=Ye.body;Ke.type!==ae||ye&&!Ke.gap||Ke.start<ee&&Ke.end>Z&&(Ye.buffered||ve)&&this.removeFragment(Ke)})}removeFragment(Z){const ee=getFragmentKey(Z);Z.stats.loaded=0,Z.clearElementaryStreamInfo();const ae=this.activePartLists[Z.type];if(ae){const ye=Z.sn;this.activePartLists[Z.type]=ae.filter(ve=>ve.fragment.sn!==ye)}delete this.fragments[ee],Z.endList&&delete this.endListFragments[Z.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function isPartial(ie){var Z,ee,ae;return ie.buffered&&(ie.body.gap||((Z=ie.range.video)==null?void 0:Z.partial)||((ee=ie.range.audio)==null?void 0:ee.partial)||((ae=ie.range.audiovideo)==null?void 0:ae.partial))}function getFragmentKey(ie){return`${ie.type}_${ie.level}_${ie.sn}`}const noopBuffered={length:0,start:()=>0,end:()=>0};class BufferHelper{static isBuffered(Z,ee){try{if(Z){const ae=BufferHelper.getBuffered(Z);for(let ye=0;ye<ae.length;ye++)if(ee>=ae.start(ye)&&ee<=ae.end(ye))return!0}}catch{}return!1}static bufferInfo(Z,ee,ae){try{if(Z){const ye=BufferHelper.getBuffered(Z),ve=[];let be;for(be=0;be<ye.length;be++)ve.push({start:ye.start(be),end:ye.end(be)});return this.bufferedInfo(ve,ee,ae)}}catch{}return{len:0,start:ee,end:ee,nextStart:void 0}}static bufferedInfo(Z,ee,ae){ee=Math.max(0,ee),Z.sort(function(Xe,Je){return Xe.start-Je.start||Je.end-Xe.end});let ye=[];if(ae)for(let Xe=0;Xe<Z.length;Xe++){const Je=ye.length;if(Je){const rt=ye[Je-1].end;Z[Xe].start-rt<ae?Z[Xe].end>rt&&(ye[Je-1].end=Z[Xe].end):ye.push(Z[Xe])}else ye.push(Z[Xe])}else ye=Z;let ve=0,be,Ye=ee,Ke=ee;for(let Xe=0;Xe<ye.length;Xe++){const Je=ye[Xe].start,rt=ye[Xe].end;if(ee+ae>=Je&&ee<rt)Ye=Je,Ke=rt,ve=Ke-ee;else if(ee+ae<Je){be=Je;break}}return{len:ve,start:Ye||0,end:Ke||0,nextStart:be}}static getBuffered(Z){try{return Z.buffered}catch(ee){return logger.log("failed to get media.buffered",ee),noopBuffered}}}class ChunkMetadata{constructor(Z,ee,ae,ye=0,ve=-1,be=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=getNewPerformanceTiming(),this.buffering={audio:getNewPerformanceTiming(),video:getNewPerformanceTiming(),audiovideo:getNewPerformanceTiming()},this.level=Z,this.sn=ee,this.id=ae,this.size=ye,this.part=ve,this.partial=be}}function getNewPerformanceTiming(){return{start:0,executeStart:0,executeEnd:0,end:0}}function findFirstFragWithCC(ie,Z){for(let ae=0,ye=ie.length;ae<ye;ae++){var ee;if(((ee=ie[ae])==null?void 0:ee.cc)===Z)return ie[ae]}return null}function shouldAlignOnDiscontinuities(ie,Z,ee){return!!(Z&&(ee.endCC>ee.startCC||ie&&ie.cc<ee.startCC))}function findDiscontinuousReferenceFrag(ie,Z){const ee=ie.fragments,ae=Z.fragments;if(!ae.length||!ee.length){logger.log("No fragments to align");return}const ye=findFirstFragWithCC(ee,ae[0].cc);if(!ye||ye&&!ye.startPTS){logger.log("No frag in previous level to align on");return}return ye}function adjustFragmentStart(ie,Z){if(ie){const ee=ie.start+Z;ie.start=ie.startPTS=ee,ie.endPTS=ee+ie.duration}}function adjustSlidingStart(ie,Z){const ee=Z.fragments;for(let ae=0,ye=ee.length;ae<ye;ae++)adjustFragmentStart(ee[ae],ie);Z.fragmentHint&&adjustFragmentStart(Z.fragmentHint,ie),Z.alignedSliding=!0}function alignStream(ie,Z,ee){Z&&(alignDiscontinuities(ie,ee,Z),!ee.alignedSliding&&Z&&alignMediaPlaylistByPDT(ee,Z),!ee.alignedSliding&&Z&&!ee.skippedSegments&&adjustSliding(Z,ee))}function alignDiscontinuities(ie,Z,ee){if(shouldAlignOnDiscontinuities(ie,ee,Z)){const ae=findDiscontinuousReferenceFrag(ee,Z);ae&&isFiniteNumber(ae.start)&&(logger.log(`Adjusting PTS using last level due to CC increase within current level ${Z.url}`),adjustSlidingStart(ae.start,Z))}}function alignMediaPlaylistByPDT(ie,Z){if(!ie.hasProgramDateTime||!Z.hasProgramDateTime)return;const ee=ie.fragments,ae=Z.fragments;if(!ee.length||!ae.length)return;let ye,ve;const be=Math.min(Z.endCC,ie.endCC);Z.startCC<be&&ie.startCC<be&&(ye=findFirstFragWithCC(ae,be),ve=findFirstFragWithCC(ee,be)),(!ye||!ve)&&(ye=ae[Math.floor(ae.length/2)],ve=findFirstFragWithCC(ee,ye.cc)||ee[Math.floor(ee.length/2)]);const Ye=ye.programDateTime,Ke=ve.programDateTime;if(!Ye||!Ke)return;const Xe=(Ke-Ye)/1e3-(ve.start-ye.start);adjustSlidingStart(Xe,ie)}const MIN_CHUNK_SIZE=Math.pow(2,17);class FragmentLoader{constructor(Z){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=Z}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(Z,ee){const ae=Z.url;if(!ae)return Promise.reject(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:Z,error:new Error(`Fragment does not have a ${ae?"part list":"url"}`),networkDetails:null}));this.abort();const ye=this.config,ve=ye.fLoader,be=ye.loader;return new Promise((Ye,Ke)=>{if(this.loader&&this.loader.destroy(),Z.gap)if(Z.tagList.some(it=>it[0]==="GAP")){Ke(createGapLoadError(Z));return}else Z.gap=!1;const Xe=this.loader=Z.loader=ve?new ve(ye):new be(ye),Je=createLoaderContext(Z),rt=getLoaderConfigWithoutReties(ye.fragLoadPolicy.default),nt={loadPolicy:rt,timeout:rt.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Z.sn==="initSegment"?1/0:MIN_CHUNK_SIZE};Z.stats=Xe.stats,Xe.load(Je,nt,{onSuccess:(it,lt,ct,ot)=>{this.resetLoader(Z,Xe);let dt=it.data;ct.resetIV&&Z.decryptdata&&(Z.decryptdata.iv=new Uint8Array(dt.slice(0,16)),dt=dt.slice(16)),Ye({frag:Z,part:null,payload:dt,networkDetails:ot})},onError:(it,lt,ct,ot)=>{this.resetLoader(Z,Xe),Ke(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:Z,response:_objectSpread2({url:ae,data:void 0},it),error:new Error(`HTTP Error ${it.code} ${it.text}`),networkDetails:ct,stats:ot}))},onAbort:(it,lt,ct)=>{this.resetLoader(Z,Xe),Ke(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:Z,error:new Error("Aborted"),networkDetails:ct,stats:it}))},onTimeout:(it,lt,ct)=>{this.resetLoader(Z,Xe),Ke(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:Z,error:new Error(`Timeout after ${nt.timeout}ms`),networkDetails:ct,stats:it}))},onProgress:(it,lt,ct,ot)=>{ee&&ee({frag:Z,part:null,payload:ct,networkDetails:ot})}})})}loadPart(Z,ee,ae){this.abort();const ye=this.config,ve=ye.fLoader,be=ye.loader;return new Promise((Ye,Ke)=>{if(this.loader&&this.loader.destroy(),Z.gap||ee.gap){Ke(createGapLoadError(Z,ee));return}const Xe=this.loader=Z.loader=ve?new ve(ye):new be(ye),Je=createLoaderContext(Z,ee),rt=getLoaderConfigWithoutReties(ye.fragLoadPolicy.default),nt={loadPolicy:rt,timeout:rt.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:MIN_CHUNK_SIZE};ee.stats=Xe.stats,Xe.load(Je,nt,{onSuccess:(it,lt,ct,ot)=>{this.resetLoader(Z,Xe),this.updateStatsFromPart(Z,ee);const dt={frag:Z,part:ee,payload:it.data,networkDetails:ot};ae(dt),Ye(dt)},onError:(it,lt,ct,ot)=>{this.resetLoader(Z,Xe),Ke(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:Z,part:ee,response:_objectSpread2({url:Je.url,data:void 0},it),error:new Error(`HTTP Error ${it.code} ${it.text}`),networkDetails:ct,stats:ot}))},onAbort:(it,lt,ct)=>{Z.stats.aborted=ee.stats.aborted,this.resetLoader(Z,Xe),Ke(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:Z,part:ee,error:new Error("Aborted"),networkDetails:ct,stats:it}))},onTimeout:(it,lt,ct)=>{this.resetLoader(Z,Xe),Ke(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:Z,part:ee,error:new Error(`Timeout after ${nt.timeout}ms`),networkDetails:ct,stats:it}))}})})}updateStatsFromPart(Z,ee){const ae=Z.stats,ye=ee.stats,ve=ye.total;if(ae.loaded+=ye.loaded,ve){const Ke=Math.round(Z.duration/ee.duration),Xe=Math.min(Math.round(ae.loaded/ve),Ke),Je=(Ke-Xe)*Math.round(ae.loaded/Xe);ae.total=ae.loaded+Je}else ae.total=Math.max(ae.loaded,ae.total);const be=ae.loading,Ye=ye.loading;be.start?be.first+=Ye.first-Ye.start:(be.start=Ye.start,be.first=Ye.first),be.end=Ye.end}resetLoader(Z,ee){Z.loader=null,this.loader===ee&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),ee.destroy()}}function createLoaderContext(ie,Z=null){const ee=Z||ie,ae={frag:ie,part:Z,responseType:"arraybuffer",url:ee.url,headers:{},rangeStart:0,rangeEnd:0},ye=ee.byteRangeStartOffset,ve=ee.byteRangeEndOffset;if(isFiniteNumber(ye)&&isFiniteNumber(ve)){var be;let Ye=ye,Ke=ve;if(ie.sn==="initSegment"&&((be=ie.decryptdata)==null?void 0:be.method)==="AES-128"){const Xe=ve-ye;Xe%16&&(Ke=ve+(16-Xe%16)),ye!==0&&(ae.resetIV=!0,Ye=ye-16)}ae.rangeStart=Ye,ae.rangeEnd=Ke}return ae}function createGapLoadError(ie,Z){const ee=new Error(`GAP ${ie.gap?"tag":"attribute"} found`),ae={type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_GAP,fatal:!1,frag:ie,error:ee,networkDetails:null};return Z&&(ae.part=Z),(Z||ie).stats.aborted=!0,new LoadError(ae)}class LoadError extends Error{constructor(Z){super(Z.error.message),this.data=void 0,this.data=Z}}class AESCrypto{constructor(Z,ee){this.subtle=void 0,this.aesIV=void 0,this.subtle=Z,this.aesIV=ee}decrypt(Z,ee){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},ee,Z)}}class FastAESKey{constructor(Z,ee){this.subtle=void 0,this.key=void 0,this.subtle=Z,this.key=ee}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}function removePadding(ie){const Z=ie.byteLength,ee=Z&&new DataView(ie.buffer).getUint8(Z-1);return ee?sliceUint8(ie,0,Z-ee):ie}class AESDecryptor{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(Z){const ee=new DataView(Z),ae=new Uint32Array(4);for(let ye=0;ye<4;ye++)ae[ye]=ee.getUint32(ye*4);return ae}initTable(){const Z=this.sBox,ee=this.invSBox,ae=this.subMix,ye=ae[0],ve=ae[1],be=ae[2],Ye=ae[3],Ke=this.invSubMix,Xe=Ke[0],Je=Ke[1],rt=Ke[2],nt=Ke[3],it=new Uint32Array(256);let lt=0,ct=0,ot=0;for(ot=0;ot<256;ot++)ot<128?it[ot]=ot<<1:it[ot]=ot<<1^283;for(ot=0;ot<256;ot++){let dt=ct^ct<<1^ct<<2^ct<<3^ct<<4;dt=dt>>>8^dt&255^99,Z[lt]=dt,ee[dt]=lt;const ft=it[lt],gt=it[ft],mt=it[gt];let Yr=it[dt]*257^dt*16843008;ye[lt]=Yr<<24|Yr>>>8,ve[lt]=Yr<<16|Yr>>>16,be[lt]=Yr<<8|Yr>>>24,Ye[lt]=Yr,Yr=mt*16843009^gt*65537^ft*257^lt*16843008,Xe[dt]=Yr<<24|Yr>>>8,Je[dt]=Yr<<16|Yr>>>16,rt[dt]=Yr<<8|Yr>>>24,nt[dt]=Yr,lt?(lt=ft^it[it[it[mt^ft]]],ct^=it[it[ct]]):lt=ct=1}}expandKey(Z){const ee=this.uint8ArrayToUint32Array_(Z);let ae=!0,ye=0;for(;ye<ee.length&&ae;)ae=ee[ye]===this.key[ye],ye++;if(ae)return;this.key=ee;const ve=this.keySize=ee.length;if(ve!==4&&ve!==6&&ve!==8)throw new Error("Invalid aes key size="+ve);const be=this.ksRows=(ve+6+1)*4;let Ye,Ke;const Xe=this.keySchedule=new Uint32Array(be),Je=this.invKeySchedule=new Uint32Array(be),rt=this.sBox,nt=this.rcon,it=this.invSubMix,lt=it[0],ct=it[1],ot=it[2],dt=it[3];let ft,gt;for(Ye=0;Ye<be;Ye++){if(Ye<ve){ft=Xe[Ye]=ee[Ye];continue}gt=ft,Ye%ve===0?(gt=gt<<8|gt>>>24,gt=rt[gt>>>24]<<24|rt[gt>>>16&255]<<16|rt[gt>>>8&255]<<8|rt[gt&255],gt^=nt[Ye/ve|0]<<24):ve>6&&Ye%ve===4&&(gt=rt[gt>>>24]<<24|rt[gt>>>16&255]<<16|rt[gt>>>8&255]<<8|rt[gt&255]),Xe[Ye]=ft=(Xe[Ye-ve]^gt)>>>0}for(Ke=0;Ke<be;Ke++)Ye=be-Ke,Ke&3?gt=Xe[Ye]:gt=Xe[Ye-4],Ke<4||Ye<=4?Je[Ke]=gt:Je[Ke]=lt[rt[gt>>>24]]^ct[rt[gt>>>16&255]]^ot[rt[gt>>>8&255]]^dt[rt[gt&255]],Je[Ke]=Je[Ke]>>>0}networkToHostOrderSwap(Z){return Z<<24|(Z&65280)<<8|(Z&16711680)>>8|Z>>>24}decrypt(Z,ee,ae){const ye=this.keySize+6,ve=this.invKeySchedule,be=this.invSBox,Ye=this.invSubMix,Ke=Ye[0],Xe=Ye[1],Je=Ye[2],rt=Ye[3],nt=this.uint8ArrayToUint32Array_(ae);let it=nt[0],lt=nt[1],ct=nt[2],ot=nt[3];const dt=new Int32Array(Z),ft=new Int32Array(dt.length);let gt,mt,Yr,Qr,Xr,Jr,ai,oi,ni,li,ui,mi,ii,hi;const ri=this.networkToHostOrderSwap;for(;ee<dt.length;){for(ni=ri(dt[ee]),li=ri(dt[ee+1]),ui=ri(dt[ee+2]),mi=ri(dt[ee+3]),Xr=ni^ve[0],Jr=mi^ve[1],ai=ui^ve[2],oi=li^ve[3],ii=4,hi=1;hi<ye;hi++)gt=Ke[Xr>>>24]^Xe[Jr>>16&255]^Je[ai>>8&255]^rt[oi&255]^ve[ii],mt=Ke[Jr>>>24]^Xe[ai>>16&255]^Je[oi>>8&255]^rt[Xr&255]^ve[ii+1],Yr=Ke[ai>>>24]^Xe[oi>>16&255]^Je[Xr>>8&255]^rt[Jr&255]^ve[ii+2],Qr=Ke[oi>>>24]^Xe[Xr>>16&255]^Je[Jr>>8&255]^rt[ai&255]^ve[ii+3],Xr=gt,Jr=mt,ai=Yr,oi=Qr,ii=ii+4;gt=be[Xr>>>24]<<24^be[Jr>>16&255]<<16^be[ai>>8&255]<<8^be[oi&255]^ve[ii],mt=be[Jr>>>24]<<24^be[ai>>16&255]<<16^be[oi>>8&255]<<8^be[Xr&255]^ve[ii+1],Yr=be[ai>>>24]<<24^be[oi>>16&255]<<16^be[Xr>>8&255]<<8^be[Jr&255]^ve[ii+2],Qr=be[oi>>>24]<<24^be[Xr>>16&255]<<16^be[Jr>>8&255]<<8^be[ai&255]^ve[ii+3],ft[ee]=ri(gt^it),ft[ee+1]=ri(Qr^lt),ft[ee+2]=ri(Yr^ct),ft[ee+3]=ri(mt^ot),it=ni,lt=li,ct=ui,ot=mi,ee=ee+4}return ft.buffer}}const CHUNK_SIZE=16;class Decrypter{constructor(Z,{removePKCS7Padding:ee=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=Z.enableSoftwareAES,this.removePKCS7Padding=ee,ee)try{const ae=self.crypto;ae&&(this.subtle=ae.subtle||ae.webkitSubtle)}catch{}this.subtle===null&&(this.useSoftware=!0)}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:Z,remainderData:ee}=this;if(!Z||ee)return this.reset(),null;const ae=new Uint8Array(Z);return this.reset(),this.removePKCS7Padding?removePadding(ae):ae}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(Z,ee,ae){return this.useSoftware?new Promise((ye,ve)=>{this.softwareDecrypt(new Uint8Array(Z),ee,ae);const be=this.flush();be?ye(be.buffer):ve(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(Z),ee,ae)}softwareDecrypt(Z,ee,ae){const{currentIV:ye,currentResult:ve,remainderData:be}=this;this.logOnce("JS AES decrypt"),be&&(Z=appendUint8Array(be,Z),this.remainderData=null);const Ye=this.getValidChunk(Z);if(!Ye.length)return null;ye&&(ae=ye);let Ke=this.softwareDecrypter;Ke||(Ke=this.softwareDecrypter=new AESDecryptor),Ke.expandKey(ee);const Xe=ve;return this.currentResult=Ke.decrypt(Ye.buffer,0,ae),this.currentIV=sliceUint8(Ye,-16).buffer,Xe||null}webCryptoDecrypt(Z,ee,ae){const ye=this.subtle;return(this.key!==ee||!this.fastAesKey)&&(this.key=ee,this.fastAesKey=new FastAESKey(ye,ee)),this.fastAesKey.expandKey().then(ve=>ye?(this.logOnce("WebCrypto AES decrypt"),new AESCrypto(ye,new Uint8Array(ae)).decrypt(Z.buffer,ve)):Promise.reject(new Error("web crypto not initialized"))).catch(ve=>(logger.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${ve.name}: ${ve.message}`),this.onWebCryptoError(Z,ee,ae)))}onWebCryptoError(Z,ee,ae){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(Z,ee,ae);const ye=this.flush();if(ye)return ye.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(Z){let ee=Z;const ae=Z.length-Z.length%CHUNK_SIZE;return ae!==Z.length&&(ee=sliceUint8(Z,0,ae),this.remainderData=sliceUint8(Z,ae)),ee}logOnce(Z){this.logEnabled&&(logger.log(`[decrypter]: ${Z}`),this.logEnabled=!1)}}const TimeRanges={toString:function(ie){let Z="";const ee=ie.length;for(let ae=0;ae<ee;ae++)Z+=`[${ie.start(ae).toFixed(3)}-${ie.end(ae).toFixed(3)}]`;return Z}},State={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class BaseStreamController extends TaskLoop{constructor(Z,ee,ae,ye,ve){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=State.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=ve,this.logPrefix=ye,this.log=logger.log.bind(logger,`${ye}:`),this.warn=logger.warn.bind(logger,`${ye}:`),this.hls=Z,this.fragmentLoader=new FragmentLoader(Z.config),this.keyLoader=ae,this.fragmentTracker=ee,this.config=Z.config,this.decrypter=new Decrypter(Z.config),Z.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(Z){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const Z=this.fragCurrent;Z!=null&&Z.loader&&(Z.abortRequests(),this.fragmentTracker.removeFragment(Z)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=State.STOPPED}_streamEnded(Z,ee){if(ee.live||Z.nextStart||!Z.end||!this.media)return!1;const ae=ee.partList;if(ae!=null&&ae.length){const ve=ae[ae.length-1];return BufferHelper.isBuffered(this.media,ve.start+ve.duration/2)}const ye=ee.fragments[ee.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(ye)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var Z;return(Z=this.levelLastLoaded)==null?void 0:Z.details}}onMediaAttached(Z,ee){const ae=this.media=this.mediaBuffer=ee.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),ae.addEventListener("seeking",this.onvseeking),ae.addEventListener("ended",this.onvended);const ye=this.config;this.levels&&ye.autoStartLoad&&this.state===State.STOPPED&&this.startLoad(ye.startPosition)}onMediaDetaching(){const Z=this.media;Z!=null&&Z.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),Z&&this.onvseeking&&this.onvended&&(Z.removeEventListener("seeking",this.onvseeking),Z.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:Z,fragCurrent:ee,media:ae,mediaBuffer:ye,state:ve}=this,be=ae?ae.currentTime:0,Ye=BufferHelper.bufferInfo(ye||ae,be,Z.maxBufferHole);if(this.log(`media seeking to ${isFiniteNumber(be)?be.toFixed(3):be}, state: ${ve}`),this.state===State.ENDED)this.resetLoadingState();else if(ee){const Ke=Z.maxFragLookUpTolerance,Xe=ee.start-Ke,Je=ee.start+ee.duration+Ke;if(!Ye.len||Je<Ye.start||Xe>Ye.end){const rt=be>Je;(be<Xe||rt)&&(rt&&ee.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),ee.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}ae&&(this.fragmentTracker.removeFragmentsInRange(be,1/0,this.playlistType,!0),this.lastCurrentTime=be),!this.loadedmetadata&&!Ye.len&&(this.nextLoadPosition=this.startPosition=be),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(Z,ee){this.startTimeOffset=ee.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.hls.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),this.stopLoad(),super.onHandlerDestroying(),this.hls=null}onHandlerDestroyed(){this.state=State.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(Z,ee,ae){this._loadFragForPlayback(Z,ee,ae)}_loadFragForPlayback(Z,ee,ae){const ye=ve=>{if(this.fragContextChanged(Z)){this.warn(`Fragment ${Z.sn}${ve.part?" p: "+ve.part.index:""} of level ${Z.level} was dropped during download.`),this.fragmentTracker.removeFragment(Z);return}Z.stats.chunkCount++,this._handleFragmentLoadProgress(ve)};this._doFragLoad(Z,ee,ae,ye).then(ve=>{if(!ve)return;const be=this.state;if(this.fragContextChanged(Z)){(be===State.FRAG_LOADING||!this.fragCurrent&&be===State.PARSING)&&(this.fragmentTracker.removeFragment(Z),this.state=State.IDLE);return}"payload"in ve&&(this.log(`Loaded fragment ${Z.sn} of level ${Z.level}`),this.hls.trigger(Events.FRAG_LOADED,ve)),this._handleFragmentLoadComplete(ve)}).catch(ve=>{this.state===State.STOPPED||this.state===State.ERROR||(this.warn(ve),this.resetFragmentLoading(Z))})}clearTrackerIfNeeded(Z){var ee;const{fragmentTracker:ae}=this;if(ae.getState(Z)===FragmentState.APPENDING){const ye=Z.type,ve=this.getFwdBufferInfo(this.mediaBuffer,ye),be=Math.max(Z.duration,ve?ve.len:this.config.maxBufferLength);this.reduceMaxBufferLength(be)&&ae.removeFragment(Z)}else((ee=this.mediaBuffer)==null?void 0:ee.buffered.length)===0?ae.removeAllFragments():ae.hasParts(Z.type)&&(ae.detectPartialFragments({frag:Z,part:null,stats:Z.stats,id:Z.type}),ae.getState(Z)===FragmentState.PARTIAL&&ae.removeFragment(Z))}checkLiveUpdate(Z){if(Z.updated&&!Z.live){const ee=Z.fragments[Z.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:ee,part:null,stats:ee.stats,id:ee.type})}Z.fragments[0]||(Z.deltaUpdateFailed=!0)}flushMainBuffer(Z,ee,ae=null){if(!(Z-ee))return;const ye={startOffset:Z,endOffset:ee,type:ae};this.hls.trigger(Events.BUFFER_FLUSHING,ye)}_loadInitSegment(Z,ee){this._doFragLoad(Z,ee).then(ae=>{if(!ae||this.fragContextChanged(Z)||!this.levels)throw new Error("init load aborted");return ae}).then(ae=>{const{hls:ye}=this,{payload:ve}=ae,be=Z.decryptdata;if(ve&&ve.byteLength>0&&be!=null&&be.key&&be.iv&&be.method==="AES-128"){const Ye=self.performance.now();return this.decrypter.decrypt(new Uint8Array(ve),be.key.buffer,be.iv.buffer).catch(Ke=>{throw ye.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!1,error:Ke,reason:Ke.message,frag:Z}),Ke}).then(Ke=>{const Xe=self.performance.now();return ye.trigger(Events.FRAG_DECRYPTED,{frag:Z,payload:Ke,stats:{tstart:Ye,tdecrypt:Xe}}),ae.payload=Ke,this.completeInitSegmentLoad(ae)})}return this.completeInitSegmentLoad(ae)}).catch(ae=>{this.state===State.STOPPED||this.state===State.ERROR||(this.warn(ae),this.resetFragmentLoading(Z))})}completeInitSegmentLoad(Z){const{levels:ee}=this;if(!ee)throw new Error("init load aborted, missing levels");const ae=Z.frag.stats;this.state=State.IDLE,Z.frag.data=new Uint8Array(Z.payload),ae.parsing.start=ae.buffering.start=self.performance.now(),ae.parsing.end=ae.buffering.end=self.performance.now(),this.tick()}fragContextChanged(Z){const{fragCurrent:ee}=this;return!Z||!ee||Z.sn!==ee.sn||Z.level!==ee.level}fragBufferedComplete(Z,ee){var ae,ye,ve,be;const Ye=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${Z.type} sn: ${Z.sn}${ee?" part: "+ee.index:""} of ${this.playlistType===PlaylistLevelType.MAIN?"level":"track"} ${Z.level} (frag:[${((ae=Z.startPTS)!=null?ae:NaN).toFixed(3)}-${((ye=Z.endPTS)!=null?ye:NaN).toFixed(3)}] > buffer:${Ye?TimeRanges.toString(BufferHelper.getBuffered(Ye)):"(detached)"})`),Z.sn!=="initSegment"){var Ke;if(Z.type!==PlaylistLevelType.SUBTITLE){const Je=Z.elementaryStreams;if(!Object.keys(Je).some(rt=>!!Je[rt])){this.state=State.IDLE;return}}const Xe=(Ke=this.levels)==null?void 0:Ke[Z.level];Xe!=null&&Xe.fragmentError&&(this.log(`Resetting level fragment error count of ${Xe.fragmentError} on frag buffered`),Xe.fragmentError=0)}this.state=State.IDLE,Ye&&(!this.loadedmetadata&&Z.type==PlaylistLevelType.MAIN&&Ye.buffered.length&&((ve=this.fragCurrent)==null?void 0:ve.sn)===((be=this.fragPrevious)==null?void 0:be.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(Z){const{transmuxer:ee}=this;if(!ee)return;const{frag:ae,part:ye,partsLoaded:ve}=Z,be=!ve||ve.length===0||ve.some(Ke=>!Ke),Ye=new ChunkMetadata(ae.level,ae.sn,ae.stats.chunkCount+1,0,ye?ye.index:-1,!be);ee.flush(Ye)}_handleFragmentLoadProgress(Z){}_doFragLoad(Z,ee,ae=null,ye){var ve;const be=ee==null?void 0:ee.details;if(!this.levels||!be)throw new Error(`frag load aborted, missing level${be?"":" detail"}s`);let Ye=null;if(Z.encrypted&&!((ve=Z.decryptdata)!=null&&ve.key)?(this.log(`Loading key for ${Z.sn} of [${be.startSN}-${be.endSN}], ${this.logPrefix==="[stream-controller]"?"level":"track"} ${Z.level}`),this.state=State.KEY_LOADING,this.fragCurrent=Z,Ye=this.keyLoader.load(Z).then(Je=>{if(!this.fragContextChanged(Je.frag))return this.hls.trigger(Events.KEY_LOADED,Je),this.state===State.KEY_LOADING&&(this.state=State.IDLE),Je}),this.hls.trigger(Events.KEY_LOADING,{frag:Z}),this.fragCurrent===null&&(Ye=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!Z.encrypted&&be.encryptedFragments.length&&this.keyLoader.loadClear(Z,be.encryptedFragments),ae=Math.max(Z.start,ae||0),this.config.lowLatencyMode&&Z.sn!=="initSegment"){const Je=be.partList;if(Je&&ye){ae>Z.end&&be.fragmentHint&&(Z=be.fragmentHint);const rt=this.getNextPart(Je,Z,ae);if(rt>-1){const nt=Je[rt];this.log(`Loading part sn: ${Z.sn} p: ${nt.index} cc: ${Z.cc} of playlist [${be.startSN}-${be.endSN}] parts [0-${rt}-${Je.length-1}] ${this.logPrefix==="[stream-controller]"?"level":"track"}: ${Z.level}, target: ${parseFloat(ae.toFixed(3))}`),this.nextLoadPosition=nt.start+nt.duration,this.state=State.FRAG_LOADING;let it;return Ye?it=Ye.then(lt=>!lt||this.fragContextChanged(lt.frag)?null:this.doFragPartsLoad(Z,nt,ee,ye)).catch(lt=>this.handleFragLoadError(lt)):it=this.doFragPartsLoad(Z,nt,ee,ye).catch(lt=>this.handleFragLoadError(lt)),this.hls.trigger(Events.FRAG_LOADING,{frag:Z,part:nt,targetBufferTime:ae}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):it}else if(!Z.url||this.loadedEndOfParts(Je,ae))return Promise.resolve(null)}}this.log(`Loading fragment ${Z.sn} cc: ${Z.cc} ${be?"of ["+be.startSN+"-"+be.endSN+"] ":""}${this.logPrefix==="[stream-controller]"?"level":"track"}: ${Z.level}, target: ${parseFloat(ae.toFixed(3))}`),isFiniteNumber(Z.sn)&&!this.bitrateTest&&(this.nextLoadPosition=Z.start+Z.duration),this.state=State.FRAG_LOADING;const Ke=this.config.progressive;let Xe;return Ke&&Ye?Xe=Ye.then(Je=>!Je||this.fragContextChanged(Je==null?void 0:Je.frag)?null:this.fragmentLoader.load(Z,ye)).catch(Je=>this.handleFragLoadError(Je)):Xe=Promise.all([this.fragmentLoader.load(Z,Ke?ye:void 0),Ye]).then(([Je])=>(!Ke&&Je&&ye&&ye(Je),Je)).catch(Je=>this.handleFragLoadError(Je)),this.hls.trigger(Events.FRAG_LOADING,{frag:Z,targetBufferTime:ae}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):Xe}doFragPartsLoad(Z,ee,ae,ye){return new Promise((ve,be)=>{var Ye;const Ke=[],Xe=(Ye=ae.details)==null?void 0:Ye.partList,Je=rt=>{this.fragmentLoader.loadPart(Z,rt,ye).then(nt=>{Ke[rt.index]=nt;const it=nt.part;this.hls.trigger(Events.FRAG_LOADED,nt);const lt=getPartWith(ae,Z.sn,rt.index+1)||findPart(Xe,Z.sn,rt.index+1);if(lt)Je(lt);else return ve({frag:Z,part:it,partsLoaded:Ke})}).catch(be)};Je(ee)})}handleFragLoadError(Z){if("data"in Z){const ee=Z.data;Z.data&&ee.details===ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(ee.frag,ee.part):this.hls.trigger(Events.ERROR,ee)}else this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,err:Z,error:Z,fatal:!0});return null}_handleTransmuxerFlush(Z){const ee=this.getCurrentContext(Z);if(!ee||this.state!==State.PARSING){!this.fragCurrent&&this.state!==State.STOPPED&&this.state!==State.ERROR&&(this.state=State.IDLE);return}const{frag:ae,part:ye,level:ve}=ee,be=self.performance.now();ae.stats.parsing.end=be,ye&&(ye.stats.parsing.end=be),this.updateLevelTiming(ae,ye,ve,Z.partial)}getCurrentContext(Z){const{levels:ee,fragCurrent:ae}=this,{level:ye,sn:ve,part:be}=Z;if(!(ee!=null&&ee[ye]))return this.warn(`Levels object was unset while buffering fragment ${ve} of level ${ye}. The current chunk will not be buffered.`),null;const Ye=ee[ye],Ke=be>-1?getPartWith(Ye,ve,be):null,Xe=Ke?Ke.fragment:getFragmentWithSN(Ye,ve,ae);return Xe?(ae&&ae!==Xe&&(Xe.stats=ae.stats),{frag:Xe,part:Ke,level:Ye}):null}bufferFragmentData(Z,ee,ae,ye,ve){var be;if(!Z||this.state!==State.PARSING)return;const{data1:Ye,data2:Ke}=Z;let Xe=Ye;if(Ye&&Ke&&(Xe=appendUint8Array(Ye,Ke)),!((be=Xe)!=null&&be.length))return;const Je={type:Z.type,frag:ee,part:ae,chunkMeta:ye,parent:ee.type,data:Xe};if(this.hls.trigger(Events.BUFFER_APPENDING,Je),Z.dropped&&Z.independent&&!ae){if(ve)return;this.flushBufferGap(ee)}}flushBufferGap(Z){const ee=this.media;if(!ee)return;if(!BufferHelper.isBuffered(ee,ee.currentTime)){this.flushMainBuffer(0,Z.start);return}const ae=ee.currentTime,ye=BufferHelper.bufferInfo(ee,ae,0),ve=Z.duration,be=Math.min(this.config.maxFragLookUpTolerance*2,ve*.25),Ye=Math.max(Math.min(Z.start-be,ye.end-be),ae+be);Z.start-Ye>be&&this.flushMainBuffer(Ye,Z.start)}getFwdBufferInfo(Z,ee){const ae=this.getLoadPosition();return isFiniteNumber(ae)?this.getFwdBufferInfoAtPos(Z,ae,ee):null}getFwdBufferInfoAtPos(Z,ee,ae){const{config:{maxBufferHole:ye}}=this,ve=BufferHelper.bufferInfo(Z,ee,ye);if(ve.len===0&&ve.nextStart!==void 0){const be=this.fragmentTracker.getBufferedFrag(ee,ae);if(be&&ve.nextStart<be.end)return BufferHelper.bufferInfo(Z,ee,Math.max(ve.nextStart,ye))}return ve}getMaxBufferLength(Z){const{config:ee}=this;let ae;return Z?ae=Math.max(8*ee.maxBufferSize/Z,ee.maxBufferLength):ae=ee.maxBufferLength,Math.min(ae,ee.maxMaxBufferLength)}reduceMaxBufferLength(Z){const ee=this.config,ae=Z||ee.maxBufferLength;return ee.maxMaxBufferLength>=ae?(ee.maxMaxBufferLength/=2,this.warn(`Reduce max buffer length to ${ee.maxMaxBufferLength}s`),!0):!1}getAppendedFrag(Z,ee=PlaylistLevelType.MAIN){const ae=this.fragmentTracker.getAppendedFrag(Z,PlaylistLevelType.MAIN);return ae&&"fragment"in ae?ae.fragment:ae}getNextFragment(Z,ee){const ae=ee.fragments,ye=ae.length;if(!ye)return null;const{config:ve}=this,be=ae[0].start;let Ye;if(ee.live){const Ke=ve.initialLiveManifestSize;if(ye<Ke)return this.warn(`Not enough fragments to start playback (have: ${ye}, need: ${Ke})`),null;(!ee.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||Z<be)&&(Ye=this.getInitialLiveFragment(ee,ae),this.startPosition=this.nextLoadPosition=Ye?this.hls.liveSyncPosition||Ye.start:Z)}else Z<=be&&(Ye=ae[0]);if(!Ye){const Ke=ve.lowLatencyMode?ee.partEnd:ee.fragmentEnd;Ye=this.getFragmentAtPosition(Z,Ke,ee)}return this.mapToInitFragWhenRequired(Ye)}isLoopLoading(Z,ee){const ae=this.fragmentTracker.getState(Z);return(ae===FragmentState.OK||ae===FragmentState.PARTIAL&&!!Z.gap)&&this.nextLoadPosition>ee}getNextFragmentLoopLoading(Z,ee,ae,ye,ve){const be=Z.gap,Ye=this.getNextFragment(this.nextLoadPosition,ee);if(Ye===null)return Ye;if(Z=Ye,be&&Z&&!Z.gap&&ae.nextStart){const Ke=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,ae.nextStart,ye);if(Ke!==null&&ae.len+Ke.len>=ve)return this.log(`buffer full after gaps in "${ye}" playlist starting at sn: ${Z.sn}`),null}return Z}mapToInitFragWhenRequired(Z){return Z!=null&&Z.initSegment&&!(Z!=null&&Z.initSegment.data)&&!this.bitrateTest?Z.initSegment:Z}getNextPart(Z,ee,ae){let ye=-1,ve=!1,be=!0;for(let Ye=0,Ke=Z.length;Ye<Ke;Ye++){const Xe=Z[Ye];if(be=be&&!Xe.independent,ye>-1&&ae<Xe.start)break;const Je=Xe.loaded;Je?ye=-1:(ve||Xe.independent||be)&&Xe.fragment===ee&&(ye=Ye),ve=Je}return ye}loadedEndOfParts(Z,ee){const ae=Z[Z.length-1];return ae&&ee>ae.start&&ae.loaded}getInitialLiveFragment(Z,ee){const ae=this.fragPrevious;let ye=null;if(ae){if(Z.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${ae.programDateTime}`),ye=findFragmentByPDT(ee,ae.endProgramDateTime,this.config.maxFragLookUpTolerance)),!ye){const ve=ae.sn+1;if(ve>=Z.startSN&&ve<=Z.endSN){const be=ee[ve-Z.startSN];ae.cc===be.cc&&(ye=be,this.log(`Live playlist, switching playlist, load frag with next SN: ${ye.sn}`))}ye||(ye=findFragWithCC(ee,ae.cc),ye&&this.log(`Live playlist, switching playlist, load frag with same CC: ${ye.sn}`))}}else{const ve=this.hls.liveSyncPosition;ve!==null&&(ye=this.getFragmentAtPosition(ve,this.bitrateTest?Z.fragmentEnd:Z.edge,Z))}return ye}getFragmentAtPosition(Z,ee,ae){const{config:ye}=this;let{fragPrevious:ve}=this,{fragments:be,endSN:Ye}=ae;const{fragmentHint:Ke}=ae,Xe=ye.maxFragLookUpTolerance,Je=ae.partList,rt=!!(ye.lowLatencyMode&&Je!=null&&Je.length&&Ke);rt&&Ke&&!this.bitrateTest&&(be=be.concat(Ke),Ye=Ke.sn);let nt;if(Z<ee){const it=Z>ee-Xe?0:Xe;nt=findFragmentByPTS(ve,be,Z,it)}else nt=be[be.length-1];if(nt){const it=nt.sn-ae.startSN,lt=this.fragmentTracker.getState(nt);if((lt===FragmentState.OK||lt===FragmentState.PARTIAL&&nt.gap)&&(ve=nt),ve&&nt.sn===ve.sn&&(!rt||Je[0].fragment.sn>nt.sn)&&ve&&nt.level===ve.level){const ct=be[it+1];nt.sn<Ye&&this.fragmentTracker.getState(ct)!==FragmentState.OK?nt=ct:nt=null}}return nt}synchronizeToLiveEdge(Z){const{config:ee,media:ae}=this;if(!ae)return;const ye=this.hls.liveSyncPosition,ve=ae.currentTime,be=Z.fragments[0].start,Ye=Z.edge,Ke=ve>=be-ee.maxFragLookUpTolerance&&ve<=Ye;if(ye!==null&&ae.duration>ye&&(ve<ye||!Ke)){const Xe=ee.liveMaxLatencyDuration!==void 0?ee.liveMaxLatencyDuration:ee.liveMaxLatencyDurationCount*Z.targetduration;(!Ke&&ae.readyState<4||ve<Ye-Xe)&&(this.loadedmetadata||(this.nextLoadPosition=ye),ae.readyState&&(this.warn(`Playback: ${ve.toFixed(3)} is located too far from the end of live sliding playlist: ${Ye}, reset currentTime to : ${ye.toFixed(3)}`),ae.currentTime=ye))}}alignPlaylists(Z,ee,ae){const ye=Z.fragments.length;if(!ye)return this.warn("No fragments in live playlist"),0;const ve=Z.fragments[0].start,be=!ee,Ye=Z.alignedSliding&&isFiniteNumber(ve);if(be||!Ye&&!ve){const{fragPrevious:Ke}=this;alignStream(Ke,ae,Z);const Xe=Z.fragments[0].start;return this.log(`Live playlist sliding: ${Xe.toFixed(2)} start-sn: ${ee?ee.startSN:"na"}->${Z.startSN} prev-sn: ${Ke?Ke.sn:"na"} fragments: ${ye}`),Xe}return ve}waitForCdnTuneIn(Z){return Z.live&&Z.canBlockReload&&Z.partTarget&&Z.tuneInGoal>Math.max(Z.partHoldBack,Z.partTarget*3)}setStartPosition(Z,ee){let ae=this.startPosition;if(ae<ee&&(ae=-1),ae===-1||this.lastCurrentTime===-1){const ye=this.startTimeOffset!==null,ve=ye?this.startTimeOffset:Z.startTimeOffset;ve!==null&&isFiniteNumber(ve)?(ae=ee+ve,ve<0&&(ae+=Z.totalduration),ae=Math.min(Math.max(ee,ae),ee+Z.totalduration),this.log(`Start time offset ${ve} found in ${ye?"multivariant":"media"} playlist, adjust startPosition to ${ae}`),this.startPosition=ae):Z.live?ae=this.hls.liveSyncPosition||ee:this.startPosition=ae=0,this.lastCurrentTime=ae}this.nextLoadPosition=ae}getLoadPosition(){const{media:Z}=this;let ee=0;return this.loadedmetadata&&Z?ee=Z.currentTime:this.nextLoadPosition&&(ee=this.nextLoadPosition),ee}handleFragLoadAborted(Z,ee){this.transmuxer&&Z.sn!=="initSegment"&&Z.stats.aborted&&(this.warn(`Fragment ${Z.sn}${ee?" part "+ee.index:""} of level ${Z.level} was aborted`),this.resetFragmentLoading(Z))}resetFragmentLoading(Z){(!this.fragCurrent||!this.fragContextChanged(Z)&&this.state!==State.FRAG_LOADING_WAITING_RETRY)&&(this.state=State.IDLE)}onFragmentOrKeyLoadError(Z,ee){if(ee.chunkMeta&&!ee.frag){const Je=this.getCurrentContext(ee.chunkMeta);Je&&(ee.frag=Je.frag)}const ae=ee.frag;if(!ae||ae.type!==Z||!this.levels)return;if(this.fragContextChanged(ae)){var ye;this.warn(`Frag load error must match current frag to retry ${ae.url} > ${(ye=this.fragCurrent)==null?void 0:ye.url}`);return}const ve=ee.details===ErrorDetails.FRAG_GAP;ve&&this.fragmentTracker.fragBuffered(ae,!0);const be=ee.errorAction,{action:Ye,retryCount:Ke=0,retryConfig:Xe}=be||{};if(be&&Ye===NetworkErrorAction.RetryRequest&&Xe){this.resetStartWhenNotLoaded(this.levelLastLoaded);const Je=getRetryDelay(Xe,Ke);this.warn(`Fragment ${ae.sn} of ${Z} ${ae.level} errored with ${ee.details}, retrying loading ${Ke+1}/${Xe.maxNumRetry} in ${Je}ms`),be.resolved=!0,this.retryDate=self.performance.now()+Je,this.state=State.FRAG_LOADING_WAITING_RETRY}else if(Xe&&be)if(this.resetFragmentErrors(Z),Ke<Xe.maxNumRetry)!ve&&Ye!==NetworkErrorAction.RemoveAlternatePermanently&&(be.resolved=!0);else{logger.warn(`${ee.details} reached or exceeded max retry (${Ke})`);return}else(be==null?void 0:be.action)===NetworkErrorAction.SendAlternateToPenaltyBox?this.state=State.WAITING_LEVEL:this.state=State.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(Z){if(this.state===State.PARSING||this.state===State.PARSED){const ee=Z.parent,ae=this.getFwdBufferInfo(this.mediaBuffer,ee),ye=ae&&ae.len>.5;ye&&this.reduceMaxBufferLength(ae.len);const ve=!ye;return ve&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${ee} buffer`),Z.frag&&(this.fragmentTracker.removeFragment(Z.frag),this.nextLoadPosition=Z.frag.start),this.resetLoadingState(),ve}return!1}resetFragmentErrors(Z){Z===PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==State.STOPPED&&(this.state=State.IDLE)}afterBufferFlushed(Z,ee,ae){if(!Z)return;const ye=BufferHelper.getBuffered(Z);this.fragmentTracker.detectEvictedFragments(ee,ye,ae),this.state===State.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=State.IDLE}resetStartWhenNotLoaded(Z){if(!this.loadedmetadata){this.startFragRequested=!1;const ee=Z?Z.details:null;ee!=null&&ee.live?(this.startPosition=-1,this.setStartPosition(ee,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(Z){this.warn(`The loading context changed while buffering fragment ${Z.sn} of level ${Z.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(Z=0){this.fragmentTracker.removeFragmentsInRange(Z,1/0,this.playlistType,!1,!0)}updateLevelTiming(Z,ee,ae,ye){var ve;const be=ae.details;if(!be){this.warn("level.details undefined");return}if(!Object.keys(Z.elementaryStreams).reduce((Ye,Ke)=>{const Xe=Z.elementaryStreams[Ke];if(Xe){const Je=Xe.endPTS-Xe.startPTS;if(Je<=0)return this.warn(`Could not parse fragment ${Z.sn} ${Ke} duration reliably (${Je})`),Ye||!1;const rt=ye?0:updateFragPTSDTS(be,Z,Xe.startPTS,Xe.endPTS,Xe.startDTS,Xe.endDTS);return this.hls.trigger(Events.LEVEL_PTS_UPDATED,{details:be,level:ae,drift:rt,type:Ke,frag:Z,start:Xe.startPTS,end:Xe.endPTS}),!0}return Ye},!1)&&((ve=this.transmuxer)==null?void 0:ve.error)===null){const Ye=new Error(`Found no media in fragment ${Z.sn} of level ${Z.level} resetting transmuxer to fallback to playlist timing`);if(ae.fragmentError===0&&(ae.fragmentError++,Z.gap=!0,this.fragmentTracker.removeFragment(Z),this.fragmentTracker.fragBuffered(Z,!0)),this.warn(Ye.message),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:Ye,frag:Z,reason:`Found no media in msn ${Z.sn} of level "${ae.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=State.PARSED,this.hls.trigger(Events.FRAG_PARSED,{frag:Z,part:ee})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(Z){Z.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(Z){const ee=this._state;ee!==Z&&(this._state=Z,this.log(`${ee}->${Z}`))}get state(){return this._state}}class ChunkCache{constructor(){this.chunks=[],this.dataLength=0}push(Z){this.chunks.push(Z),this.dataLength+=Z.length}flush(){const{chunks:Z,dataLength:ee}=this;let ae;if(Z.length)Z.length===1?ae=Z[0]:ae=concatUint8Arrays(Z,ee);else return new Uint8Array(0);return this.reset(),ae}reset(){this.chunks.length=0,this.dataLength=0}}function concatUint8Arrays(ie,Z){const ee=new Uint8Array(Z);let ae=0;for(let ye=0;ye<ie.length;ye++){const ve=ie[ye];ee.set(ve,ae),ae+=ve.length}return ee}function hasUMDWorker(){return typeof __HLS_WORKER_BUNDLE__=="function"}function injectWorker(){const ie=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),Z=self.URL.createObjectURL(ie);return{worker:new self.Worker(Z),objectURL:Z}}function loadWorker(ie){const Z=new self.URL(ie,self.location.href).href;return{worker:new self.Worker(Z),scriptURL:Z}}function dummyTrack(ie="",Z=9e4){return{type:ie,id:-1,pid:-1,inputTimeScale:Z,sequenceNumber:-1,samples:[],dropped:0}}class BaseAudioDemuxer{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(Z,ee,ae,ye){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(Z){this.initPTS=Z,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(Z,ee){return!1}appendFrame(Z,ee,ae){}demux(Z,ee){this.cachedData&&(Z=appendUint8Array(this.cachedData,Z),this.cachedData=null);let ae=getID3Data(Z,0),ye=ae?ae.length:0,ve;const be=this._audioTrack,Ye=this._id3Track,Ke=ae?getTimeStamp(ae):void 0,Xe=Z.length;for((this.basePTS===null||this.frameIndex===0&&isFiniteNumber(Ke))&&(this.basePTS=initPTSFn(Ke,ee,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),ae&&ae.length>0&&Ye.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:ae,type:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});ye<Xe;){if(this.canParse(Z,ye)){const Je=this.appendFrame(be,Z,ye);Je?(this.frameIndex++,this.lastPTS=Je.sample.pts,ye+=Je.length,ve=ye):ye=Xe}else canParse$2(Z,ye)?(ae=getID3Data(Z,ye),Ye.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:ae,type:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),ye+=ae.length,ve=ye):ye++;if(ye===Xe&&ve!==Xe){const Je=sliceUint8(Z,ve);this.cachedData?this.cachedData=appendUint8Array(this.cachedData,Je):this.cachedData=Je}}return{audioTrack:be,videoTrack:dummyTrack(),id3Track:Ye,textTrack:dummyTrack()}}demuxSampleAes(Z,ee,ae){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(Z){const ee=this.cachedData;return ee&&(this.cachedData=null,this.demux(ee,0)),{audioTrack:this._audioTrack,videoTrack:dummyTrack(),id3Track:this._id3Track,textTrack:dummyTrack()}}destroy(){}}const initPTSFn=(ie,Z,ee)=>{if(isFiniteNumber(ie))return ie*90;const ae=ee?ee.baseTime*9e4/ee.timescale:0;return Z*9e4+ae};function getAudioConfig(ie,Z,ee,ae){let ye,ve,be,Ye;const Ke=navigator.userAgent.toLowerCase(),Xe=ae,Je=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];ye=((Z[ee+2]&192)>>>6)+1;const rt=(Z[ee+2]&60)>>>2;if(rt>Je.length-1){const nt=new Error(`invalid ADTS sampling index:${rt}`);ie.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,error:nt,reason:nt.message});return}return be=(Z[ee+2]&1)<<2,be|=(Z[ee+3]&192)>>>6,logger.log(`manifest codec:${ae}, ADTS type:${ye}, samplingIndex:${rt}`),/firefox/i.test(Ke)?rt>=6?(ye=5,Ye=new Array(4),ve=rt-3):(ye=2,Ye=new Array(2),ve=rt):Ke.indexOf("android")!==-1?(ye=2,Ye=new Array(2),ve=rt):(ye=5,Ye=new Array(4),ae&&(ae.indexOf("mp4a.40.29")!==-1||ae.indexOf("mp4a.40.5")!==-1)||!ae&&rt>=6?ve=rt-3:((ae&&ae.indexOf("mp4a.40.2")!==-1&&(rt>=6&&be===1||/vivaldi/i.test(Ke))||!ae&&be===1)&&(ye=2,Ye=new Array(2)),ve=rt)),Ye[0]=ye<<3,Ye[0]|=(rt&14)>>1,Ye[1]|=(rt&1)<<7,Ye[1]|=be<<3,ye===5&&(Ye[1]|=(ve&14)>>1,Ye[2]=(ve&1)<<7,Ye[2]|=8,Ye[3]=0),{config:Ye,samplerate:Je[rt],channelCount:be,codec:"mp4a.40."+ye,manifestCodec:Xe}}function isHeaderPattern$1(ie,Z){return ie[Z]===255&&(ie[Z+1]&246)===240}function getHeaderLength(ie,Z){return ie[Z+1]&1?7:9}function getFullFrameLength(ie,Z){return(ie[Z+3]&3)<<11|ie[Z+4]<<3|(ie[Z+5]&224)>>>5}function canGetFrameLength(ie,Z){return Z+5<ie.length}function isHeader$1(ie,Z){return Z+1<ie.length&&isHeaderPattern$1(ie,Z)}function canParse$1(ie,Z){return canGetFrameLength(ie,Z)&&isHeaderPattern$1(ie,Z)&&getFullFrameLength(ie,Z)<=ie.length-Z}function probe$1(ie,Z){if(isHeader$1(ie,Z)){const ee=getHeaderLength(ie,Z);if(Z+ee>=ie.length)return!1;const ae=getFullFrameLength(ie,Z);if(ae<=ee)return!1;const ye=Z+ae;return ye===ie.length||isHeader$1(ie,ye)}return!1}function initTrackConfig(ie,Z,ee,ae,ye){if(!ie.samplerate){const ve=getAudioConfig(Z,ee,ae,ye);if(!ve)return;ie.config=ve.config,ie.samplerate=ve.samplerate,ie.channelCount=ve.channelCount,ie.codec=ve.codec,ie.manifestCodec=ve.manifestCodec,logger.log(`parsed codec:${ie.codec}, rate:${ve.samplerate}, channels:${ve.channelCount}`)}}function getFrameDuration(ie){return 1024*9e4/ie}function parseFrameHeader(ie,Z){const ee=getHeaderLength(ie,Z);if(Z+ee<=ie.length){const ae=getFullFrameLength(ie,Z)-ee;if(ae>0)return{headerLength:ee,frameLength:ae}}}function appendFrame$2(ie,Z,ee,ae,ye){const ve=getFrameDuration(ie.samplerate),be=ae+ye*ve,Ye=parseFrameHeader(Z,ee);let Ke;if(Ye){const{frameLength:Je,headerLength:rt}=Ye,nt=rt+Je,it=Math.max(0,ee+nt-Z.length);it?(Ke=new Uint8Array(nt-rt),Ke.set(Z.subarray(ee+rt,Z.length),0)):Ke=Z.subarray(ee+rt,ee+nt);const lt={unit:Ke,pts:be};return it||ie.samples.push(lt),{sample:lt,length:nt,missing:it}}const Xe=Z.length-ee;return Ke=new Uint8Array(Xe),Ke.set(Z.subarray(ee,Z.length),0),{sample:{unit:Ke,pts:be},length:Xe,missing:-1}}let chromeVersion$1=null;const BitratesMap=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot=[0,1,1,4];function appendFrame$1(ie,Z,ee,ae,ye){if(ee+24>Z.length)return;const ve=parseHeader(Z,ee);if(ve&&ee+ve.frameLength<=Z.length){const be=ve.samplesPerFrame*9e4/ve.sampleRate,Ye=ae+ye*be,Ke={unit:Z.subarray(ee,ee+ve.frameLength),pts:Ye,dts:Ye};return ie.config=[],ie.channelCount=ve.channelCount,ie.samplerate=ve.sampleRate,ie.samples.push(Ke),{sample:Ke,length:ve.frameLength,missing:0}}}function parseHeader(ie,Z){const ee=ie[Z+1]>>3&3,ae=ie[Z+1]>>1&3,ye=ie[Z+2]>>4&15,ve=ie[Z+2]>>2&3;if(ee!==1&&ye!==0&&ye!==15&&ve!==3){const be=ie[Z+2]>>1&1,Ye=ie[Z+3]>>6,Ke=ee===3?3-ae:ae===3?3:4,Xe=BitratesMap[Ke*14+ye-1]*1e3,Je=SamplingRateMap[(ee===3?0:ee===2?1:2)*3+ve],rt=Ye===3?1:2,nt=SamplesCoefficients[ee][ae],it=BytesInSlot[ae],lt=nt*8*it,ct=Math.floor(nt*Xe/Je+be)*it;if(chromeVersion$1===null){const ot=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);chromeVersion$1=ot?parseInt(ot[1]):0}return chromeVersion$1&&chromeVersion$1<=87&&ae===2&&Xe>=224e3&&Ye===0&&(ie[Z+3]=ie[Z+3]|128),{sampleRate:Je,channelCount:rt,frameLength:ct,samplesPerFrame:lt}}}function isHeaderPattern(ie,Z){return ie[Z]===255&&(ie[Z+1]&224)===224&&(ie[Z+1]&6)!==0}function isHeader(ie,Z){return Z+1<ie.length&&isHeaderPattern(ie,Z)}function canParse(ie,Z){return isHeaderPattern(ie,Z)&&4<=ie.length-Z}function probe(ie,Z){if(Z+1<ie.length&&isHeaderPattern(ie,Z)){const ee=parseHeader(ie,Z);let ae=4;ee!=null&&ee.frameLength&&(ae=ee.frameLength);const ye=Z+ae;return ye===ie.length||isHeader(ie,ye)}return!1}class AACDemuxer extends BaseAudioDemuxer{constructor(Z,ee){super(),this.observer=void 0,this.config=void 0,this.observer=Z,this.config=ee}resetInitSegment(Z,ee,ae,ye){super.resetInitSegment(Z,ee,ae,ye),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:ee,duration:ye,inputTimeScale:9e4,dropped:0}}static probe(Z){if(!Z)return!1;const ee=getID3Data(Z,0);let ae=(ee==null?void 0:ee.length)||0;if(probe(Z,ae))return!1;for(let ye=Z.length;ae<ye;ae++)if(probe$1(Z,ae))return logger.log("ADTS sync word found !"),!0;return!1}canParse(Z,ee){return canParse$1(Z,ee)}appendFrame(Z,ee,ae){initTrackConfig(Z,this.observer,ee,ae,Z.manifestCodec);const ye=appendFrame$2(Z,ee,ae,this.basePTS,this.frameIndex);if(ye&&ye.missing===0)return ye}}const emsgSchemePattern=/\/emsg[-/]ID3/i;class MP4Demuxer{constructor(Z,ee){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=ee}resetTimeStamp(){}resetInitSegment(Z,ee,ae,ye){const ve=this.videoTrack=dummyTrack("video",1),be=this.audioTrack=dummyTrack("audio",1),Ye=this.txtTrack=dummyTrack("text",1);if(this.id3Track=dummyTrack("id3",1),this.timeOffset=0,!(Z!=null&&Z.byteLength))return;const Ke=parseInitSegment(Z);if(Ke.video){const{id:Xe,timescale:Je,codec:rt}=Ke.video;ve.id=Xe,ve.timescale=Ye.timescale=Je,ve.codec=rt}if(Ke.audio){const{id:Xe,timescale:Je,codec:rt}=Ke.audio;be.id=Xe,be.timescale=Je,be.codec=rt}Ye.id=RemuxerTrackIdConfig.text,ve.sampleDuration=0,ve.duration=be.duration=ye}resetContiguity(){this.remainderData=null}static probe(Z){return hasMoofData(Z)}demux(Z,ee){this.timeOffset=ee;let ae=Z;const ye=this.videoTrack,ve=this.txtTrack;if(this.config.progressive){this.remainderData&&(ae=appendUint8Array(this.remainderData,Z));const Ye=segmentValidRange(ae);this.remainderData=Ye.remainder,ye.samples=Ye.valid||new Uint8Array}else ye.samples=ae;const be=this.extractID3Track(ye,ee);return ve.samples=parseSamples(ee,ye),{videoTrack:ye,audioTrack:this.audioTrack,id3Track:be,textTrack:this.txtTrack}}flush(){const Z=this.timeOffset,ee=this.videoTrack,ae=this.txtTrack;ee.samples=this.remainderData||new Uint8Array,this.remainderData=null;const ye=this.extractID3Track(ee,this.timeOffset);return ae.samples=parseSamples(Z,ee),{videoTrack:ee,audioTrack:dummyTrack(),id3Track:ye,textTrack:dummyTrack()}}extractID3Track(Z,ee){const ae=this.id3Track;if(Z.samples.length){const ye=findBox(Z.samples,["emsg"]);ye&&ye.forEach(ve=>{const be=parseEmsg(ve);if(emsgSchemePattern.test(be.schemeIdUri)){const Ye=isFiniteNumber(be.presentationTime)?be.presentationTime/be.timeScale:ee+be.presentationTimeDelta/be.timeScale;let Ke=be.eventDuration===4294967295?Number.POSITIVE_INFINITY:be.eventDuration/be.timeScale;Ke<=.001&&(Ke=Number.POSITIVE_INFINITY);const Xe=be.payload;ae.samples.push({data:Xe,len:Xe.byteLength,dts:Ye,pts:Ye,type:MetadataSchema.emsg,duration:Ke})}})}return ae}demuxSampleAes(Z,ee,ae){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}}const getAudioBSID=(ie,Z)=>{let ee=0,ae=5;Z+=ae;const ye=new Uint32Array(1),ve=new Uint32Array(1),be=new Uint8Array(1);for(;ae>0;){be[0]=ie[Z];const Ye=Math.min(ae,8),Ke=8-Ye;ve[0]=4278190080>>>24+Ke<<Ke,ye[0]=(be[0]&ve[0])>>Ke,ee=ee?ee<<Ye|ye[0]:ye[0],Z+=1,ae-=Ye}return ee};class AC3Demuxer extends BaseAudioDemuxer{constructor(Z){super(),this.observer=void 0,this.observer=Z}resetInitSegment(Z,ee,ae,ye){super.resetInitSegment(Z,ee,ae,ye),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:ee,duration:ye,inputTimeScale:9e4,dropped:0}}canParse(Z,ee){return ee+64<Z.length}appendFrame(Z,ee,ae){const ye=appendFrame(Z,ee,ae,this.basePTS,this.frameIndex);if(ye!==-1)return{sample:Z.samples[Z.samples.length-1],length:ye,missing:0}}static probe(Z){if(!Z)return!1;const ee=getID3Data(Z,0);if(!ee)return!1;const ae=ee.length;return Z[ae]===11&&Z[ae+1]===119&&getTimeStamp(ee)!==void 0&&getAudioBSID(Z,ae)<16}}function appendFrame(ie,Z,ee,ae,ye){if(ee+8>Z.length||Z[ee]!==11||Z[ee+1]!==119)return-1;const ve=Z[ee+4]>>6;if(ve>=3)return-1;const be=[48e3,44100,32e3][ve],Ye=Z[ee+4]&63,Ke=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][Ye*3+ve]*2;if(ee+Ke>Z.length)return-1;const Xe=Z[ee+6]>>5;let Je=0;Xe===2?Je+=2:(Xe&1&&Xe!==1&&(Je+=2),Xe&4&&(Je+=2));const rt=(Z[ee+6]<<8|Z[ee+7])>>12-Je&1,nt=[2,1,2,3,3,4,4,5][Xe]+rt,it=Z[ee+5]>>3,lt=Z[ee+5]&7,ct=new Uint8Array([ve<<6|it<<1|lt>>2,(lt&3)<<6|Xe<<3|rt<<2|Ye>>4,Ye<<4&224]),ot=1536/be*9e4,dt=ae+ye*ot,ft=Z.subarray(ee,ee+Ke);return ie.config=ct,ie.channelCount=nt,ie.samplerate=be,ie.samples.push({unit:ft,pts:dt}),Ke}class BaseVideoParser{constructor(){this.VideoSample=null}createVideoSample(Z,ee,ae,ye){return{key:Z,frame:!1,pts:ee,dts:ae,units:[],debug:ye,length:0}}getLastNalUnit(Z){var ee;let ae=this.VideoSample,ye;if((!ae||ae.units.length===0)&&(ae=Z[Z.length-1]),(ee=ae)!=null&&ee.units){const ve=ae.units;ye=ve[ve.length-1]}return ye}pushAccessUnit(Z,ee){if(Z.units.length&&Z.frame){if(Z.pts===void 0){const ae=ee.samples,ye=ae.length;if(ye){const ve=ae[ye-1];Z.pts=ve.pts,Z.dts=ve.dts}else{ee.dropped++;return}}ee.samples.push(Z)}Z.debug.length&&logger.log(Z.pts+"/"+Z.dts+":"+Z.debug)}}class ExpGolomb{constructor(Z){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=Z,this.bytesAvailable=Z.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const Z=this.data,ee=this.bytesAvailable,ae=Z.byteLength-ee,ye=new Uint8Array(4),ve=Math.min(4,ee);if(ve===0)throw new Error("no bytes available");ye.set(Z.subarray(ae,ae+ve)),this.word=new DataView(ye.buffer).getUint32(0),this.bitsAvailable=ve*8,this.bytesAvailable-=ve}skipBits(Z){let ee;Z=Math.min(Z,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>Z?(this.word<<=Z,this.bitsAvailable-=Z):(Z-=this.bitsAvailable,ee=Z>>3,Z-=ee<<3,this.bytesAvailable-=ee,this.loadWord(),this.word<<=Z,this.bitsAvailable-=Z)}readBits(Z){let ee=Math.min(this.bitsAvailable,Z);const ae=this.word>>>32-ee;if(Z>32&&logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=ee,this.bitsAvailable>0)this.word<<=ee;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return ee=Z-ee,ee>0&&this.bitsAvailable?ae<<ee|this.readBits(ee):ae}skipLZ(){let Z;for(Z=0;Z<this.bitsAvailable;++Z)if(this.word&2147483648>>>Z)return this.word<<=Z,this.bitsAvailable-=Z,Z;return this.loadWord(),Z+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const Z=this.skipLZ();return this.readBits(Z+1)-1}readEG(){const Z=this.readUEG();return 1&Z?1+Z>>>1:-1*(Z>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(Z){let ee=8,ae=8,ye;for(let ve=0;ve<Z;ve++)ae!==0&&(ye=this.readEG(),ae=(ee+ye+256)%256),ee=ae===0?ee:ae}readSPS(){let Z=0,ee=0,ae=0,ye=0,ve,be,Ye;const Ke=this.readUByte.bind(this),Xe=this.readBits.bind(this),Je=this.readUEG.bind(this),rt=this.readBoolean.bind(this),nt=this.skipBits.bind(this),it=this.skipEG.bind(this),lt=this.skipUEG.bind(this),ct=this.skipScalingList.bind(this);Ke();const ot=Ke();if(Xe(5),nt(3),Ke(),lt(),ot===100||ot===110||ot===122||ot===244||ot===44||ot===83||ot===86||ot===118||ot===128){const Qr=Je();if(Qr===3&&nt(1),lt(),lt(),nt(1),rt())for(be=Qr!==3?8:12,Ye=0;Ye<be;Ye++)rt()&&(Ye<6?ct(16):ct(64))}lt();const dt=Je();if(dt===0)Je();else if(dt===1)for(nt(1),it(),it(),ve=Je(),Ye=0;Ye<ve;Ye++)it();lt(),nt(1);const ft=Je(),gt=Je(),mt=Xe(1);mt===0&&nt(1),nt(1),rt()&&(Z=Je(),ee=Je(),ae=Je(),ye=Je());let Yr=[1,1];if(rt()&&rt())switch(Ke()){case 1:Yr=[1,1];break;case 2:Yr=[12,11];break;case 3:Yr=[10,11];break;case 4:Yr=[16,11];break;case 5:Yr=[40,33];break;case 6:Yr=[24,11];break;case 7:Yr=[20,11];break;case 8:Yr=[32,11];break;case 9:Yr=[80,33];break;case 10:Yr=[18,11];break;case 11:Yr=[15,11];break;case 12:Yr=[64,33];break;case 13:Yr=[160,99];break;case 14:Yr=[4,3];break;case 15:Yr=[3,2];break;case 16:Yr=[2,1];break;case 255:{Yr=[Ke()<<8|Ke(),Ke()<<8|Ke()];break}}return{width:Math.ceil((ft+1)*16-Z*2-ee*2),height:(2-mt)*(gt+1)*16-(mt?2:4)*(ae+ye),pixelRatio:Yr}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class AvcVideoParser extends BaseVideoParser{parseAVCPES(Z,ee,ae,ye,ve){const be=this.parseAVCNALu(Z,ae.data);let Ye=this.VideoSample,Ke,Xe=!1;ae.data=null,Ye&&be.length&&!Z.audFound&&(this.pushAccessUnit(Ye,Z),Ye=this.VideoSample=this.createVideoSample(!1,ae.pts,ae.dts,"")),be.forEach(Je=>{var rt;switch(Je.type){case 1:{let ct=!1;Ke=!0;const ot=Je.data;if(Xe&&ot.length>4){const dt=new ExpGolomb(ot).readSliceType();(dt===2||dt===4||dt===7||dt===9)&&(ct=!0)}if(ct){var nt;(nt=Ye)!=null&&nt.frame&&!Ye.key&&(this.pushAccessUnit(Ye,Z),Ye=this.VideoSample=null)}Ye||(Ye=this.VideoSample=this.createVideoSample(!0,ae.pts,ae.dts,"")),Ye.frame=!0,Ye.key=ct;break}case 5:Ke=!0,(rt=Ye)!=null&&rt.frame&&!Ye.key&&(this.pushAccessUnit(Ye,Z),Ye=this.VideoSample=null),Ye||(Ye=this.VideoSample=this.createVideoSample(!0,ae.pts,ae.dts,"")),Ye.key=!0,Ye.frame=!0;break;case 6:{Ke=!0,parseSEIMessageFromNALu(Je.data,1,ae.pts,ee.samples);break}case 7:{var it,lt;Ke=!0,Xe=!0;const ct=Je.data,ot=new ExpGolomb(ct).readSPS();if(!Z.sps||Z.width!==ot.width||Z.height!==ot.height||((it=Z.pixelRatio)==null?void 0:it[0])!==ot.pixelRatio[0]||((lt=Z.pixelRatio)==null?void 0:lt[1])!==ot.pixelRatio[1]){Z.width=ot.width,Z.height=ot.height,Z.pixelRatio=ot.pixelRatio,Z.sps=[ct],Z.duration=ve;const dt=ct.subarray(1,4);let ft="avc1.";for(let gt=0;gt<3;gt++){let mt=dt[gt].toString(16);mt.length<2&&(mt="0"+mt),ft+=mt}Z.codec=ft}break}case 8:Ke=!0,Z.pps=[Je.data];break;case 9:Ke=!0,Z.audFound=!0,Ye&&this.pushAccessUnit(Ye,Z),Ye=this.VideoSample=this.createVideoSample(!1,ae.pts,ae.dts,"");break;case 12:Ke=!0;break;default:Ke=!1,Ye&&(Ye.debug+="unknown NAL "+Je.type+" ");break}Ye&&Ke&&Ye.units.push(Je)}),ye&&Ye&&(this.pushAccessUnit(Ye,Z),this.VideoSample=null)}parseAVCNALu(Z,ee){const ae=ee.byteLength;let ye=Z.naluState||0;const ve=ye,be=[];let Ye=0,Ke,Xe,Je,rt=-1,nt=0;for(ye===-1&&(rt=0,nt=ee[0]&31,ye=0,Ye=1);Ye<ae;){if(Ke=ee[Ye++],!ye){ye=Ke?0:1;continue}if(ye===1){ye=Ke?0:2;continue}if(!Ke)ye=3;else if(Ke===1){if(Xe=Ye-ye-1,rt>=0){const it={data:ee.subarray(rt,Xe),type:nt};be.push(it)}else{const it=this.getLastNalUnit(Z.samples);it&&(ve&&Ye<=4-ve&&it.state&&(it.data=it.data.subarray(0,it.data.byteLength-ve)),Xe>0&&(it.data=appendUint8Array(it.data,ee.subarray(0,Xe)),it.state=0))}Ye<ae?(Je=ee[Ye]&31,rt=Ye,nt=Je,ye=0):ye=-1}else ye=0}if(rt>=0&&ye>=0){const it={data:ee.subarray(rt,ae),type:nt,state:ye};be.push(it)}if(be.length===0){const it=this.getLastNalUnit(Z.samples);it&&(it.data=appendUint8Array(it.data,ee))}return Z.naluState=ye,be}}class SampleAesDecrypter{constructor(Z,ee,ae){this.keyData=void 0,this.decrypter=void 0,this.keyData=ae,this.decrypter=new Decrypter(ee,{removePKCS7Padding:!1})}decryptBuffer(Z){return this.decrypter.decrypt(Z,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(Z,ee,ae){const ye=Z[ee].unit;if(ye.length<=16)return;const ve=ye.subarray(16,ye.length-ye.length%16),be=ve.buffer.slice(ve.byteOffset,ve.byteOffset+ve.length);this.decryptBuffer(be).then(Ye=>{const Ke=new Uint8Array(Ye);ye.set(Ke,16),this.decrypter.isSync()||this.decryptAacSamples(Z,ee+1,ae)})}decryptAacSamples(Z,ee,ae){for(;;ee++){if(ee>=Z.length){ae();return}if(!(Z[ee].unit.length<32)&&(this.decryptAacSample(Z,ee,ae),!this.decrypter.isSync()))return}}getAvcEncryptedData(Z){const ee=Math.floor((Z.length-48)/160)*16+16,ae=new Int8Array(ee);let ye=0;for(let ve=32;ve<Z.length-16;ve+=160,ye+=16)ae.set(Z.subarray(ve,ve+16),ye);return ae}getAvcDecryptedUnit(Z,ee){const ae=new Uint8Array(ee);let ye=0;for(let ve=32;ve<Z.length-16;ve+=160,ye+=16)Z.set(ae.subarray(ye,ye+16),ve);return Z}decryptAvcSample(Z,ee,ae,ye,ve){const be=discardEPB(ve.data),Ye=this.getAvcEncryptedData(be);this.decryptBuffer(Ye.buffer).then(Ke=>{ve.data=this.getAvcDecryptedUnit(be,Ke),this.decrypter.isSync()||this.decryptAvcSamples(Z,ee,ae+1,ye)})}decryptAvcSamples(Z,ee,ae,ye){if(Z instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;ee++,ae=0){if(ee>=Z.length){ye();return}const ve=Z[ee].units;for(;!(ae>=ve.length);ae++){const be=ve[ae];if(!(be.data.length<=48||be.type!==1&&be.type!==5)&&(this.decryptAvcSample(Z,ee,ae,ye,be),!this.decrypter.isSync()))return}}}}const PACKET_LENGTH=188;class TSDemuxer{constructor(Z,ee,ae){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=Z,this.config=ee,this.typeSupported=ae,this.videoParser=new AvcVideoParser}static probe(Z){const ee=TSDemuxer.syncOffset(Z);return ee>0&&logger.warn(`MPEG2-TS detected but first sync word found @ offset ${ee}`),ee!==-1}static syncOffset(Z){const ee=Z.length;let ae=Math.min(PACKET_LENGTH*5,ee-PACKET_LENGTH)+1,ye=0;for(;ye<ae;){let ve=!1,be=-1,Ye=0;for(let Ke=ye;Ke<ee;Ke+=PACKET_LENGTH)if(Z[Ke]===71&&(ee-Ke===PACKET_LENGTH||Z[Ke+PACKET_LENGTH]===71)){if(Ye++,be===-1&&(be=Ke,be!==0&&(ae=Math.min(be+PACKET_LENGTH*99,Z.length-PACKET_LENGTH)+1)),ve||(ve=parsePID(Z,Ke)===0),ve&&Ye>1&&(be===0&&Ye>2||Ke+PACKET_LENGTH>ae))return be}else{if(Ye)return-1;break}ye++}return-1}static createTrack(Z,ee){return{container:Z==="video"||Z==="audio"?"video/mp2t":void 0,type:Z,id:RemuxerTrackIdConfig[Z],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:Z==="audio"?ee:void 0}}resetInitSegment(Z,ee,ae,ye){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=TSDemuxer.createTrack("video"),this._audioTrack=TSDemuxer.createTrack("audio",ye),this._id3Track=TSDemuxer.createTrack("id3"),this._txtTrack=TSDemuxer.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=ee,this.videoCodec=ae,this._duration=ye}resetTimeStamp(){}resetContiguity(){const{_audioTrack:Z,_videoTrack:ee,_id3Track:ae}=this;Z&&(Z.pesData=null),ee&&(ee.pesData=null),ae&&(ae.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(Z,ee,ae=!1,ye=!1){ae||(this.sampleAes=null);let ve;const be=this._videoTrack,Ye=this._audioTrack,Ke=this._id3Track,Xe=this._txtTrack;let Je=be.pid,rt=be.pesData,nt=Ye.pid,it=Ke.pid,lt=Ye.pesData,ct=Ke.pesData,ot=null,dt=this.pmtParsed,ft=this._pmtId,gt=Z.length;if(this.remainderData&&(Z=appendUint8Array(this.remainderData,Z),gt=Z.length,this.remainderData=null),gt<PACKET_LENGTH&&!ye)return this.remainderData=Z,{audioTrack:Ye,videoTrack:be,id3Track:Ke,textTrack:Xe};const mt=Math.max(0,TSDemuxer.syncOffset(Z));gt-=(gt-mt)%PACKET_LENGTH,gt<Z.byteLength&&!ye&&(this.remainderData=new Uint8Array(Z.buffer,gt,Z.buffer.byteLength-gt));let Yr=0;for(let Xr=mt;Xr<gt;Xr+=PACKET_LENGTH)if(Z[Xr]===71){const Jr=!!(Z[Xr+1]&64),ai=parsePID(Z,Xr),oi=(Z[Xr+3]&48)>>4;let ni;if(oi>1){if(ni=Xr+5+Z[Xr+4],ni===Xr+PACKET_LENGTH)continue}else ni=Xr+4;switch(ai){case Je:Jr&&(rt&&(ve=parsePES(rt))&&this.videoParser.parseAVCPES(be,Xe,ve,!1,this._duration),rt={data:[],size:0}),rt&&(rt.data.push(Z.subarray(ni,Xr+PACKET_LENGTH)),rt.size+=Xr+PACKET_LENGTH-ni);break;case nt:if(Jr){if(lt&&(ve=parsePES(lt)))switch(Ye.segmentCodec){case"aac":this.parseAACPES(Ye,ve);break;case"mp3":this.parseMPEGPES(Ye,ve);break;case"ac3":this.parseAC3PES(Ye,ve);break}lt={data:[],size:0}}lt&&(lt.data.push(Z.subarray(ni,Xr+PACKET_LENGTH)),lt.size+=Xr+PACKET_LENGTH-ni);break;case it:Jr&&(ct&&(ve=parsePES(ct))&&this.parseID3PES(Ke,ve),ct={data:[],size:0}),ct&&(ct.data.push(Z.subarray(ni,Xr+PACKET_LENGTH)),ct.size+=Xr+PACKET_LENGTH-ni);break;case 0:Jr&&(ni+=Z[ni]+1),ft=this._pmtId=parsePAT(Z,ni);break;case ft:{Jr&&(ni+=Z[ni]+1);const li=parsePMT(Z,ni,this.typeSupported,ae);Je=li.videoPid,Je>0&&(be.pid=Je,be.segmentCodec=li.segmentVideoCodec),nt=li.audioPid,nt>0&&(Ye.pid=nt,Ye.segmentCodec=li.segmentAudioCodec),it=li.id3Pid,it>0&&(Ke.pid=it),ot!==null&&!dt&&(logger.warn(`MPEG-TS PMT found at ${Xr} after unknown PID '${ot}'. Backtracking to sync byte @${mt} to parse all TS packets.`),ot=null,Xr=mt-188),dt=this.pmtParsed=!0;break}case 17:case 8191:break;default:ot=ai;break}}else Yr++;if(Yr>0){const Xr=new Error(`Found ${Yr} TS packet/s that do not start with 0x47`);this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:Xr,reason:Xr.message})}be.pesData=rt,Ye.pesData=lt,Ke.pesData=ct;const Qr={audioTrack:Ye,videoTrack:be,id3Track:Ke,textTrack:Xe};return ye&&this.extractRemainingSamples(Qr),Qr}flush(){const{remainderData:Z}=this;this.remainderData=null;let ee;return Z?ee=this.demux(Z,-1,!1,!0):ee={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(ee),this.sampleAes?this.decrypt(ee,this.sampleAes):ee}extractRemainingSamples(Z){const{audioTrack:ee,videoTrack:ae,id3Track:ye,textTrack:ve}=Z,be=ae.pesData,Ye=ee.pesData,Ke=ye.pesData;let Xe;if(be&&(Xe=parsePES(be))?(this.videoParser.parseAVCPES(ae,ve,Xe,!0,this._duration),ae.pesData=null):ae.pesData=be,Ye&&(Xe=parsePES(Ye))){switch(ee.segmentCodec){case"aac":this.parseAACPES(ee,Xe);break;case"mp3":this.parseMPEGPES(ee,Xe);break;case"ac3":this.parseAC3PES(ee,Xe);break}ee.pesData=null}else Ye!=null&&Ye.size&&logger.log("last AAC PES packet truncated,might overlap between fragments"),ee.pesData=Ye;Ke&&(Xe=parsePES(Ke))?(this.parseID3PES(ye,Xe),ye.pesData=null):ye.pesData=Ke}demuxSampleAes(Z,ee,ae){const ye=this.demux(Z,ae,!0,!this.config.progressive),ve=this.sampleAes=new SampleAesDecrypter(this.observer,this.config,ee);return this.decrypt(ye,ve)}decrypt(Z,ee){return new Promise(ae=>{const{audioTrack:ye,videoTrack:ve}=Z;ye.samples&&ye.segmentCodec==="aac"?ee.decryptAacSamples(ye.samples,0,()=>{ve.samples?ee.decryptAvcSamples(ve.samples,0,0,()=>{ae(Z)}):ae(Z)}):ve.samples&&ee.decryptAvcSamples(ve.samples,0,0,()=>{ae(Z)})})}destroy(){this._duration=0}parseAACPES(Z,ee){let ae=0;const ye=this.aacOverFlow;let ve=ee.data;if(ye){this.aacOverFlow=null;const rt=ye.missing,nt=ye.sample.unit.byteLength;if(rt===-1)ve=appendUint8Array(ye.sample.unit,ve);else{const it=nt-rt;ye.sample.unit.set(ve.subarray(0,rt),it),Z.samples.push(ye.sample),ae=ye.missing}}let be,Ye;for(be=ae,Ye=ve.length;be<Ye-1&&!isHeader$1(ve,be);be++);if(be!==ae){let rt;const nt=be<Ye-1;nt?rt=`AAC PES did not start with ADTS header,offset:${be}`:rt="No ADTS header found in AAC PES";const it=new Error(rt);if(logger.warn(`parsing error: ${rt}`),this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,levelRetry:nt,error:it,reason:rt}),!nt)return}initTrackConfig(Z,this.observer,ve,be,this.audioCodec);let Ke;if(ee.pts!==void 0)Ke=ee.pts;else if(ye){const rt=getFrameDuration(Z.samplerate);Ke=ye.sample.pts+rt}else{logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let Xe=0,Je;for(;be<Ye;)if(Je=appendFrame$2(Z,ve,be,Ke,Xe),be+=Je.length,Je.missing){this.aacOverFlow=Je;break}else for(Xe++;be<Ye-1&&!isHeader$1(ve,be);be++);}parseMPEGPES(Z,ee){const ae=ee.data,ye=ae.length;let ve=0,be=0;const Ye=ee.pts;if(Ye===void 0){logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;be<ye;)if(isHeader(ae,be)){const Ke=appendFrame$1(Z,ae,be,Ye,ve);if(Ke)be+=Ke.length,ve++;else break}else be++}parseAC3PES(Z,ee){{const ae=ee.data,ye=ee.pts;if(ye===void 0){logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const ve=ae.length;let be=0,Ye=0,Ke;for(;Ye<ve&&(Ke=appendFrame(Z,ae,Ye,ye,be++))>0;)Ye+=Ke}}parseID3PES(Z,ee){if(ee.pts===void 0){logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const ae=_extends({},ee,{type:this._videoTrack?MetadataSchema.emsg:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});Z.samples.push(ae)}}function parsePID(ie,Z){return((ie[Z+1]&31)<<8)+ie[Z+2]}function parsePAT(ie,Z){return(ie[Z+10]&31)<<8|ie[Z+11]}function parsePMT(ie,Z,ee,ae){const ye={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},ve=(ie[Z+1]&15)<<8|ie[Z+2],be=Z+3+ve-4,Ye=(ie[Z+10]&15)<<8|ie[Z+11];for(Z+=12+Ye;Z<be;){const Ke=parsePID(ie,Z),Xe=(ie[Z+3]&15)<<8|ie[Z+4];switch(ie[Z]){case 207:if(!ae){logEncryptedSamplesFoundInUnencryptedStream("ADTS AAC");break}case 15:ye.audioPid===-1&&(ye.audioPid=Ke);break;case 21:ye.id3Pid===-1&&(ye.id3Pid=Ke);break;case 219:if(!ae){logEncryptedSamplesFoundInUnencryptedStream("H.264");break}case 27:ye.videoPid===-1&&(ye.videoPid=Ke,ye.segmentVideoCodec="avc");break;case 3:case 4:!ee.mpeg&&!ee.mp3?logger.log("MPEG audio found, not supported in this browser"):ye.audioPid===-1&&(ye.audioPid=Ke,ye.segmentAudioCodec="mp3");break;case 193:if(!ae){logEncryptedSamplesFoundInUnencryptedStream("AC-3");break}case 129:ee.ac3?ye.audioPid===-1&&(ye.audioPid=Ke,ye.segmentAudioCodec="ac3"):logger.log("AC-3 audio found, not supported in this browser");break;case 6:if(ye.audioPid===-1&&Xe>0){let Je=Z+5,rt=Xe;for(;rt>2;){switch(ie[Je]){case 106:ee.ac3!==!0?logger.log("AC-3 audio found, not supported in this browser for now"):(ye.audioPid=Ke,ye.segmentAudioCodec="ac3");break}const nt=ie[Je+1]+2;Je+=nt,rt-=nt}}break;case 194:case 135:logger.warn("Unsupported EC-3 in M2TS found");break;case 36:logger.warn("Unsupported HEVC in M2TS found");break}Z+=Xe+5}return ye}function logEncryptedSamplesFoundInUnencryptedStream(ie){logger.log(`${ie} with AES-128-CBC encryption found in unencrypted stream`)}function parsePES(ie){let Z=0,ee,ae,ye,ve,be;const Ye=ie.data;if(!ie||ie.size===0)return null;for(;Ye[0].length<19&&Ye.length>1;)Ye[0]=appendUint8Array(Ye[0],Ye[1]),Ye.splice(1,1);if(ee=Ye[0],(ee[0]<<16)+(ee[1]<<8)+ee[2]===1){if(ae=(ee[4]<<8)+ee[5],ae&&ae>ie.size-6)return null;const Ke=ee[7];Ke&192&&(ve=(ee[9]&14)*536870912+(ee[10]&255)*4194304+(ee[11]&254)*16384+(ee[12]&255)*128+(ee[13]&254)/2,Ke&64?(be=(ee[14]&14)*536870912+(ee[15]&255)*4194304+(ee[16]&254)*16384+(ee[17]&255)*128+(ee[18]&254)/2,ve-be>60*9e4&&(logger.warn(`${Math.round((ve-be)/9e4)}s delta between PTS and DTS, align them`),ve=be)):be=ve),ye=ee[8];let Xe=ye+9;if(ie.size<=Xe)return null;ie.size-=Xe;const Je=new Uint8Array(ie.size);for(let rt=0,nt=Ye.length;rt<nt;rt++){ee=Ye[rt];let it=ee.byteLength;if(Xe)if(Xe>it){Xe-=it;continue}else ee=ee.subarray(Xe),it-=Xe,Xe=0;Je.set(ee,Z),Z+=it}return ae&&(ae-=ye+3),{data:Je,pts:ve,dts:be,len:ae}}return null}class MP3Demuxer extends BaseAudioDemuxer{resetInitSegment(Z,ee,ae,ye){super.resetInitSegment(Z,ee,ae,ye),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:ee,duration:ye,inputTimeScale:9e4,dropped:0}}static probe(Z){if(!Z)return!1;const ee=getID3Data(Z,0);let ae=(ee==null?void 0:ee.length)||0;if(ee&&Z[ae]===11&&Z[ae+1]===119&&getTimeStamp(ee)!==void 0&&getAudioBSID(Z,ae)<=16)return!1;for(let ye=Z.length;ae<ye;ae++)if(probe(Z,ae))return logger.log("MPEG Audio sync word found !"),!0;return!1}canParse(Z,ee){return canParse(Z,ee)}appendFrame(Z,ee,ae){if(this.basePTS!==null)return appendFrame$1(Z,ee,ae,this.basePTS,this.frameIndex)}}class AAC{static getSilentFrame(Z,ee){switch(Z){case"mp4a.40.2":if(ee===1)return new Uint8Array([0,200,0,128,35,128]);if(ee===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(ee===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(ee===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(ee===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(ee===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(ee===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(ee===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(ee===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const UINT32_MAX=Math.pow(2,32)-1;class MP4{static init(){MP4.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let Z;for(Z in MP4.types)MP4.types.hasOwnProperty(Z)&&(MP4.types[Z]=[Z.charCodeAt(0),Z.charCodeAt(1),Z.charCodeAt(2),Z.charCodeAt(3)]);const ee=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),ae=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);MP4.HDLR_TYPES={video:ee,audio:ae};const ye=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),ve=new Uint8Array([0,0,0,0,0,0,0,0]);MP4.STTS=MP4.STSC=MP4.STCO=ve,MP4.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),MP4.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),MP4.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),MP4.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const be=new Uint8Array([105,115,111,109]),Ye=new Uint8Array([97,118,99,49]),Ke=new Uint8Array([0,0,0,1]);MP4.FTYP=MP4.box(MP4.types.ftyp,be,Ke,be,Ye),MP4.DINF=MP4.box(MP4.types.dinf,MP4.box(MP4.types.dref,ye))}static box(Z,...ee){let ae=8,ye=ee.length;const ve=ye;for(;ye--;)ae+=ee[ye].byteLength;const be=new Uint8Array(ae);for(be[0]=ae>>24&255,be[1]=ae>>16&255,be[2]=ae>>8&255,be[3]=ae&255,be.set(Z,4),ye=0,ae=8;ye<ve;ye++)be.set(ee[ye],ae),ae+=ee[ye].byteLength;return be}static hdlr(Z){return MP4.box(MP4.types.hdlr,MP4.HDLR_TYPES[Z])}static mdat(Z){return MP4.box(MP4.types.mdat,Z)}static mdhd(Z,ee){ee*=Z;const ae=Math.floor(ee/(UINT32_MAX+1)),ye=Math.floor(ee%(UINT32_MAX+1));return MP4.box(MP4.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,Z>>24&255,Z>>16&255,Z>>8&255,Z&255,ae>>24,ae>>16&255,ae>>8&255,ae&255,ye>>24,ye>>16&255,ye>>8&255,ye&255,85,196,0,0]))}static mdia(Z){return MP4.box(MP4.types.mdia,MP4.mdhd(Z.timescale,Z.duration),MP4.hdlr(Z.type),MP4.minf(Z))}static mfhd(Z){return MP4.box(MP4.types.mfhd,new Uint8Array([0,0,0,0,Z>>24,Z>>16&255,Z>>8&255,Z&255]))}static minf(Z){return Z.type==="audio"?MP4.box(MP4.types.minf,MP4.box(MP4.types.smhd,MP4.SMHD),MP4.DINF,MP4.stbl(Z)):MP4.box(MP4.types.minf,MP4.box(MP4.types.vmhd,MP4.VMHD),MP4.DINF,MP4.stbl(Z))}static moof(Z,ee,ae){return MP4.box(MP4.types.moof,MP4.mfhd(Z),MP4.traf(ae,ee))}static moov(Z){let ee=Z.length;const ae=[];for(;ee--;)ae[ee]=MP4.trak(Z[ee]);return MP4.box.apply(null,[MP4.types.moov,MP4.mvhd(Z[0].timescale,Z[0].duration)].concat(ae).concat(MP4.mvex(Z)))}static mvex(Z){let ee=Z.length;const ae=[];for(;ee--;)ae[ee]=MP4.trex(Z[ee]);return MP4.box.apply(null,[MP4.types.mvex,...ae])}static mvhd(Z,ee){ee*=Z;const ae=Math.floor(ee/(UINT32_MAX+1)),ye=Math.floor(ee%(UINT32_MAX+1)),ve=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,Z>>24&255,Z>>16&255,Z>>8&255,Z&255,ae>>24,ae>>16&255,ae>>8&255,ae&255,ye>>24,ye>>16&255,ye>>8&255,ye&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return MP4.box(MP4.types.mvhd,ve)}static sdtp(Z){const ee=Z.samples||[],ae=new Uint8Array(4+ee.length);let ye,ve;for(ye=0;ye<ee.length;ye++)ve=ee[ye].flags,ae[ye+4]=ve.dependsOn<<4|ve.isDependedOn<<2|ve.hasRedundancy;return MP4.box(MP4.types.sdtp,ae)}static stbl(Z){return MP4.box(MP4.types.stbl,MP4.stsd(Z),MP4.box(MP4.types.stts,MP4.STTS),MP4.box(MP4.types.stsc,MP4.STSC),MP4.box(MP4.types.stsz,MP4.STSZ),MP4.box(MP4.types.stco,MP4.STCO))}static avc1(Z){let ee=[],ae=[],ye,ve,be;for(ye=0;ye<Z.sps.length;ye++)ve=Z.sps[ye],be=ve.byteLength,ee.push(be>>>8&255),ee.push(be&255),ee=ee.concat(Array.prototype.slice.call(ve));for(ye=0;ye<Z.pps.length;ye++)ve=Z.pps[ye],be=ve.byteLength,ae.push(be>>>8&255),ae.push(be&255),ae=ae.concat(Array.prototype.slice.call(ve));const Ye=MP4.box(MP4.types.avcC,new Uint8Array([1,ee[3],ee[4],ee[5],255,224|Z.sps.length].concat(ee).concat([Z.pps.length]).concat(ae))),Ke=Z.width,Xe=Z.height,Je=Z.pixelRatio[0],rt=Z.pixelRatio[1];return MP4.box(MP4.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,Ke>>8&255,Ke&255,Xe>>8&255,Xe&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),Ye,MP4.box(MP4.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),MP4.box(MP4.types.pasp,new Uint8Array([Je>>24,Je>>16&255,Je>>8&255,Je&255,rt>>24,rt>>16&255,rt>>8&255,rt&255])))}static esds(Z){const ee=Z.config.length;return new Uint8Array([0,0,0,0,3,23+ee,0,1,0,4,15+ee,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([ee]).concat(Z.config).concat([6,1,2]))}static audioStsd(Z){const ee=Z.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,Z.channelCount,0,16,0,0,0,0,ee>>8&255,ee&255,0,0])}static mp4a(Z){return MP4.box(MP4.types.mp4a,MP4.audioStsd(Z),MP4.box(MP4.types.esds,MP4.esds(Z)))}static mp3(Z){return MP4.box(MP4.types[".mp3"],MP4.audioStsd(Z))}static ac3(Z){return MP4.box(MP4.types["ac-3"],MP4.audioStsd(Z),MP4.box(MP4.types.dac3,Z.config))}static stsd(Z){return Z.type==="audio"?Z.segmentCodec==="mp3"&&Z.codec==="mp3"?MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp3(Z)):Z.segmentCodec==="ac3"?MP4.box(MP4.types.stsd,MP4.STSD,MP4.ac3(Z)):MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp4a(Z)):MP4.box(MP4.types.stsd,MP4.STSD,MP4.avc1(Z))}static tkhd(Z){const ee=Z.id,ae=Z.duration*Z.timescale,ye=Z.width,ve=Z.height,be=Math.floor(ae/(UINT32_MAX+1)),Ye=Math.floor(ae%(UINT32_MAX+1));return MP4.box(MP4.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,ee>>24&255,ee>>16&255,ee>>8&255,ee&255,0,0,0,0,be>>24,be>>16&255,be>>8&255,be&255,Ye>>24,Ye>>16&255,Ye>>8&255,Ye&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,ye>>8&255,ye&255,0,0,ve>>8&255,ve&255,0,0]))}static traf(Z,ee){const ae=MP4.sdtp(Z),ye=Z.id,ve=Math.floor(ee/(UINT32_MAX+1)),be=Math.floor(ee%(UINT32_MAX+1));return MP4.box(MP4.types.traf,MP4.box(MP4.types.tfhd,new Uint8Array([0,0,0,0,ye>>24,ye>>16&255,ye>>8&255,ye&255])),MP4.box(MP4.types.tfdt,new Uint8Array([1,0,0,0,ve>>24,ve>>16&255,ve>>8&255,ve&255,be>>24,be>>16&255,be>>8&255,be&255])),MP4.trun(Z,ae.length+16+20+8+16+8+8),ae)}static trak(Z){return Z.duration=Z.duration||4294967295,MP4.box(MP4.types.trak,MP4.tkhd(Z),MP4.mdia(Z))}static trex(Z){const ee=Z.id;return MP4.box(MP4.types.trex,new Uint8Array([0,0,0,0,ee>>24,ee>>16&255,ee>>8&255,ee&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(Z,ee){const ae=Z.samples||[],ye=ae.length,ve=12+16*ye,be=new Uint8Array(ve);let Ye,Ke,Xe,Je,rt,nt;for(ee+=8+ve,be.set([Z.type==="video"?1:0,0,15,1,ye>>>24&255,ye>>>16&255,ye>>>8&255,ye&255,ee>>>24&255,ee>>>16&255,ee>>>8&255,ee&255],0),Ye=0;Ye<ye;Ye++)Ke=ae[Ye],Xe=Ke.duration,Je=Ke.size,rt=Ke.flags,nt=Ke.cts,be.set([Xe>>>24&255,Xe>>>16&255,Xe>>>8&255,Xe&255,Je>>>24&255,Je>>>16&255,Je>>>8&255,Je&255,rt.isLeading<<2|rt.dependsOn,rt.isDependedOn<<6|rt.hasRedundancy<<4|rt.paddingValue<<1|rt.isNonSync,rt.degradPrio&61440,rt.degradPrio&15,nt>>>24&255,nt>>>16&255,nt>>>8&255,nt&255],12+16*Ye);return MP4.box(MP4.types.trun,be)}static initSegment(Z){MP4.types||MP4.init();const ee=MP4.moov(Z);return appendUint8Array(MP4.FTYP,ee)}}MP4.types=void 0;MP4.HDLR_TYPES=void 0;MP4.STTS=void 0;MP4.STSC=void 0;MP4.STCO=void 0;MP4.STSZ=void 0;MP4.VMHD=void 0;MP4.SMHD=void 0;MP4.STSD=void 0;MP4.FTYP=void 0;MP4.DINF=void 0;const MPEG_TS_CLOCK_FREQ_HZ=9e4;function toTimescaleFromBase(ie,Z,ee=1,ae=!1){const ye=ie*Z*ee;return ae?Math.round(ye):ye}function toTimescaleFromScale(ie,Z,ee=1,ae=!1){return toTimescaleFromBase(ie,Z,1/ee,ae)}function toMsFromMpegTsClock(ie,Z=!1){return toTimescaleFromBase(ie,1e3,1/MPEG_TS_CLOCK_FREQ_HZ,Z)}function toMpegTsClockFromTimescale(ie,Z=1){return toTimescaleFromBase(ie,MPEG_TS_CLOCK_FREQ_HZ,1/Z)}const MAX_SILENT_FRAME_DURATION=10*1e3,AAC_SAMPLES_PER_FRAME=1024,MPEG_AUDIO_SAMPLE_PER_FRAME=1152,AC3_SAMPLES_PER_FRAME=1536;let chromeVersion=null,safariWebkitVersion=null;class MP4Remuxer{constructor(Z,ee,ae,ye=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=Z,this.config=ee,this.typeSupported=ae,this.ISGenerated=!1,chromeVersion===null){const ve=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);chromeVersion=ve?parseInt(ve[1]):0}if(safariWebkitVersion===null){const ve=navigator.userAgent.match(/Safari\/(\d+)/i);safariWebkitVersion=ve?parseInt(ve[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(Z){logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=Z}resetNextTimestamp(){logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(Z){let ee=!1;const ae=Z.reduce((ye,ve)=>{const be=ve.pts-ye;return be<-4294967296?(ee=!0,normalizePts(ye,ve.pts)):be>0?ye:ve.pts},Z[0].pts);return ee&&logger.debug("PTS rollover detected"),ae}remux(Z,ee,ae,ye,ve,be,Ye,Ke){let Xe,Je,rt,nt,it,lt,ct=ve,ot=ve;const dt=Z.pid>-1,ft=ee.pid>-1,gt=ee.samples.length,mt=Z.samples.length>0,Yr=Ye&&gt>0||gt>1;if((!dt||mt)&&(!ft||Yr)||this.ISGenerated||Ye){if(this.ISGenerated){var Qr,Xr,Jr,ai;const ui=this.videoTrackConfig;ui&&(ee.width!==ui.width||ee.height!==ui.height||((Qr=ee.pixelRatio)==null?void 0:Qr[0])!==((Xr=ui.pixelRatio)==null?void 0:Xr[0])||((Jr=ee.pixelRatio)==null?void 0:Jr[1])!==((ai=ui.pixelRatio)==null?void 0:ai[1]))&&this.resetInitSegment()}else rt=this.generateIS(Z,ee,ve,be);const oi=this.isVideoContiguous;let ni=-1,li;if(Yr&&(ni=findKeyframeIndex(ee.samples),!oi&&this.config.forceKeyFrameOnDiscontinuity))if(lt=!0,ni>0){logger.warn(`[mp4-remuxer]: Dropped ${ni} out of ${gt} video samples due to a missing keyframe`);const ui=this.getVideoStartPts(ee.samples);ee.samples=ee.samples.slice(ni),ee.dropped+=ni,ot+=(ee.samples[0].pts-ui)/ee.inputTimeScale,li=ot}else ni===-1&&(logger.warn(`[mp4-remuxer]: No keyframe found out of ${gt} video samples`),lt=!1);if(this.ISGenerated){if(mt&&Yr){const ui=this.getVideoStartPts(ee.samples),mi=(normalizePts(Z.samples[0].pts,ui)-ui)/ee.inputTimeScale;ct+=Math.max(0,mi),ot+=Math.max(0,-mi)}if(mt){if(Z.samplerate||(logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),rt=this.generateIS(Z,ee,ve,be)),Je=this.remuxAudio(Z,ct,this.isAudioContiguous,be,ft||Yr||Ke===PlaylistLevelType.AUDIO?ot:void 0),Yr){const ui=Je?Je.endPTS-Je.startPTS:0;ee.inputTimeScale||(logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),rt=this.generateIS(Z,ee,ve,be)),Xe=this.remuxVideo(ee,ot,oi,ui)}}else Yr&&(Xe=this.remuxVideo(ee,ot,oi,0));Xe&&(Xe.firstKeyFrame=ni,Xe.independent=ni!==-1,Xe.firstKeyFramePTS=li)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(ae.samples.length&&(it=flushTextTrackMetadataCueSamples(ae,ve,this._initPTS,this._initDTS)),ye.samples.length&&(nt=flushTextTrackUserdataCueSamples(ye,ve,this._initPTS))),{audio:Je,video:Xe,initSegment:rt,independent:lt,text:nt,id3:it}}generateIS(Z,ee,ae,ye){const ve=Z.samples,be=ee.samples,Ye=this.typeSupported,Ke={},Xe=this._initPTS;let Je=!Xe||ye,rt="audio/mp4",nt,it,lt;if(Je&&(nt=it=1/0),Z.config&&ve.length){switch(Z.timescale=Z.samplerate,Z.segmentCodec){case"mp3":Ye.mpeg?(rt="audio/mpeg",Z.codec=""):Ye.mp3&&(Z.codec="mp3");break;case"ac3":Z.codec="ac-3";break}Ke.audio={id:"audio",container:rt,codec:Z.codec,initSegment:Z.segmentCodec==="mp3"&&Ye.mpeg?new Uint8Array(0):MP4.initSegment([Z]),metadata:{channelCount:Z.channelCount}},Je&&(lt=Z.inputTimeScale,!Xe||lt!==Xe.timescale?nt=it=ve[0].pts-Math.round(lt*ae):Je=!1)}if(ee.sps&&ee.pps&&be.length){if(ee.timescale=ee.inputTimeScale,Ke.video={id:"main",container:"video/mp4",codec:ee.codec,initSegment:MP4.initSegment([ee]),metadata:{width:ee.width,height:ee.height}},Je)if(lt=ee.inputTimeScale,!Xe||lt!==Xe.timescale){const ct=this.getVideoStartPts(be),ot=Math.round(lt*ae);it=Math.min(it,normalizePts(be[0].dts,ct)-ot),nt=Math.min(nt,ct-ot)}else Je=!1;this.videoTrackConfig={width:ee.width,height:ee.height,pixelRatio:ee.pixelRatio}}if(Object.keys(Ke).length)return this.ISGenerated=!0,Je?(this._initPTS={baseTime:nt,timescale:lt},this._initDTS={baseTime:it,timescale:lt}):nt=lt=void 0,{tracks:Ke,initPTS:nt,timescale:lt}}remuxVideo(Z,ee,ae,ye){const ve=Z.inputTimeScale,be=Z.samples,Ye=[],Ke=be.length,Xe=this._initPTS;let Je=this.nextAvcDts,rt=8,nt=this.videoSampleDuration,it,lt,ct=Number.POSITIVE_INFINITY,ot=Number.NEGATIVE_INFINITY,dt=!1;if(!ae||Je===null){const ri=ee*ve,ci=be[0].pts-normalizePts(be[0].dts,be[0].pts);chromeVersion&&Je!==null&&Math.abs(ri-ci-Je)<15e3?ae=!0:Je=ri-ci}const ft=Xe.baseTime*ve/Xe.timescale;for(let ri=0;ri<Ke;ri++){const ci=be[ri];ci.pts=normalizePts(ci.pts-ft,Je),ci.dts=normalizePts(ci.dts-ft,Je),ci.dts<be[ri>0?ri-1:ri].dts&&(dt=!0)}dt&&be.sort(function(ri,ci){const Si=ri.dts-ci.dts,si=ri.pts-ci.pts;return Si||si}),it=be[0].dts,lt=be[be.length-1].dts;const gt=lt-it,mt=gt?Math.round(gt/(Ke-1)):nt||Z.inputTimeScale/30;if(ae){const ri=it-Je,ci=ri>mt,Si=ri<-1;if((ci||Si)&&(ci?logger.warn(`AVC: ${toMsFromMpegTsClock(ri,!0)} ms (${ri}dts) hole between fragments detected at ${ee.toFixed(3)}`):logger.warn(`AVC: ${toMsFromMpegTsClock(-ri,!0)} ms (${ri}dts) overlapping between fragments detected at ${ee.toFixed(3)}`),!Si||Je>=be[0].pts||chromeVersion)){it=Je;const si=be[0].pts-ri;if(ci)be[0].dts=it,be[0].pts=si;else for(let Ei=0;Ei<be.length&&!(be[Ei].dts>si);Ei++)be[Ei].dts-=ri,be[Ei].pts-=ri;logger.log(`Video: Initial PTS/DTS adjusted: ${toMsFromMpegTsClock(si,!0)}/${toMsFromMpegTsClock(it,!0)}, delta: ${toMsFromMpegTsClock(ri,!0)} ms`)}}it=Math.max(0,it);let Yr=0,Qr=0,Xr=it;for(let ri=0;ri<Ke;ri++){const ci=be[ri],Si=ci.units,si=Si.length;let Ei=0;for(let yi=0;yi<si;yi++)Ei+=Si[yi].data.length;Qr+=Ei,Yr+=si,ci.length=Ei,ci.dts<Xr?(ci.dts=Xr,Xr+=mt/4|0||1):Xr=ci.dts,ct=Math.min(ci.pts,ct),ot=Math.max(ci.pts,ot)}lt=be[Ke-1].dts;const Jr=Qr+4*Yr+8;let ai;try{ai=new Uint8Array(Jr)}catch(ri){this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MUX_ERROR,details:ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,error:ri,bytes:Jr,reason:`fail allocating video mdat ${Jr}`});return}const oi=new DataView(ai.buffer);oi.setUint32(0,Jr),ai.set(MP4.types.mdat,4);let ni=!1,li=Number.POSITIVE_INFINITY,ui=Number.POSITIVE_INFINITY,mi=Number.NEGATIVE_INFINITY,ii=Number.NEGATIVE_INFINITY;for(let ri=0;ri<Ke;ri++){const ci=be[ri],Si=ci.units;let si=0;for(let Mi=0,Ci=Si.length;Mi<Ci;Mi++){const Ri=Si[Mi],Ni=Ri.data,Ai=Ri.data.byteLength;oi.setUint32(rt,Ai),rt+=4,ai.set(Ni,rt),rt+=Ai,si+=4+Ai}let Ei;if(ri<Ke-1)nt=be[ri+1].dts-ci.dts,Ei=be[ri+1].pts-ci.pts;else{const Mi=this.config,Ci=ri>0?ci.dts-be[ri-1].dts:mt;if(Ei=ri>0?ci.pts-be[ri-1].pts:mt,Mi.stretchShortVideoTrack&&this.nextAudioPts!==null){const Ri=Math.floor(Mi.maxBufferHole*ve),Ni=(ye?ct+ye*ve:this.nextAudioPts)-ci.pts;Ni>Ri?(nt=Ni-Ci,nt<0?nt=Ci:ni=!0,logger.log(`[mp4-remuxer]: It is approximately ${Ni/90} ms to the next segment; using duration ${nt/90} ms for the last video frame.`)):nt=Ci}else nt=Ci}const yi=Math.round(ci.pts-ci.dts);li=Math.min(li,nt),mi=Math.max(mi,nt),ui=Math.min(ui,Ei),ii=Math.max(ii,Ei),Ye.push(new Mp4Sample(ci.key,nt,si,yi))}if(Ye.length){if(chromeVersion){if(chromeVersion<70){const ri=Ye[0].flags;ri.dependsOn=2,ri.isNonSync=0}}else if(safariWebkitVersion&&ii-ui<mi-li&&mt/mi<.025&&Ye[0].cts===0){logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let ri=it;for(let ci=0,Si=Ye.length;ci<Si;ci++){const si=ri+Ye[ci].duration,Ei=ri+Ye[ci].cts;if(ci<Si-1){const yi=si+Ye[ci+1].cts;Ye[ci].duration=yi-Ei}else Ye[ci].duration=ci?Ye[ci-1].duration:mt;Ye[ci].cts=0,ri=si}}}nt=ni||!nt?mt:nt,this.nextAvcDts=Je=lt+nt,this.videoSampleDuration=nt,this.isVideoContiguous=!0;const hi={data1:MP4.moof(Z.sequenceNumber++,it,_extends({},Z,{samples:Ye})),data2:ai,startPTS:ct/ve,endPTS:(ot+nt)/ve,startDTS:it/ve,endDTS:Je/ve,type:"video",hasAudio:!1,hasVideo:!0,nb:Ye.length,dropped:Z.dropped};return Z.samples=[],Z.dropped=0,hi}getSamplesPerFrame(Z){switch(Z.segmentCodec){case"mp3":return MPEG_AUDIO_SAMPLE_PER_FRAME;case"ac3":return AC3_SAMPLES_PER_FRAME;default:return AAC_SAMPLES_PER_FRAME}}remuxAudio(Z,ee,ae,ye,ve){const be=Z.inputTimeScale,Ye=Z.samplerate?Z.samplerate:be,Ke=be/Ye,Xe=this.getSamplesPerFrame(Z),Je=Xe*Ke,rt=this._initPTS,nt=Z.segmentCodec==="mp3"&&this.typeSupported.mpeg,it=[],lt=ve!==void 0;let ct=Z.samples,ot=nt?0:8,dt=this.nextAudioPts||-1;const ft=ee*be,gt=rt.baseTime*be/rt.timescale;if(this.isAudioContiguous=ae=ae||ct.length&&dt>0&&(ye&&Math.abs(ft-dt)<9e3||Math.abs(normalizePts(ct[0].pts-gt,ft)-dt)<20*Je),ct.forEach(function(ii){ii.pts=normalizePts(ii.pts-gt,ft)}),!ae||dt<0){if(ct=ct.filter(ii=>ii.pts>=0),!ct.length)return;ve===0?dt=0:ye&&!lt?dt=Math.max(0,ft):dt=ct[0].pts}if(Z.segmentCodec==="aac"){const ii=this.config.maxAudioFramesDrift;for(let hi=0,ri=dt;hi<ct.length;hi++){const ci=ct[hi],Si=ci.pts,si=Si-ri,Ei=Math.abs(1e3*si/be);if(si<=-ii*Je&&lt)hi===0&&(logger.warn(`Audio frame @ ${(Si/be).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*si/be)} ms.`),this.nextAudioPts=dt=ri=Si);else if(si>=ii*Je&&Ei<MAX_SILENT_FRAME_DURATION&&lt){let yi=Math.round(si/Je);ri=Si-yi*Je,ri<0&&(yi--,ri+=Je),hi===0&&(this.nextAudioPts=dt=ri),logger.warn(`[mp4-remuxer]: Injecting ${yi} audio frame @ ${(ri/be).toFixed(3)}s due to ${Math.round(1e3*si/be)} ms gap.`);for(let Mi=0;Mi<yi;Mi++){const Ci=Math.max(ri,0);let Ri=AAC.getSilentFrame(Z.manifestCodec||Z.codec,Z.channelCount);Ri||(logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),Ri=ci.unit.subarray()),ct.splice(hi,0,{unit:Ri,pts:Ci}),ri+=Je,hi++}}ci.pts=ri,ri+=Je}}let mt=null,Yr=null,Qr,Xr=0,Jr=ct.length;for(;Jr--;)Xr+=ct[Jr].unit.byteLength;for(let ii=0,hi=ct.length;ii<hi;ii++){const ri=ct[ii],ci=ri.unit;let Si=ri.pts;if(Yr!==null){const Ei=it[ii-1];Ei.duration=Math.round((Si-Yr)/Ke)}else if(ae&&Z.segmentCodec==="aac"&&(Si=dt),mt=Si,Xr>0){Xr+=ot;try{Qr=new Uint8Array(Xr)}catch(Ei){this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MUX_ERROR,details:ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,error:Ei,bytes:Xr,reason:`fail allocating audio mdat ${Xr}`});return}nt||(new DataView(Qr.buffer).setUint32(0,Xr),Qr.set(MP4.types.mdat,4))}else return;Qr.set(ci,ot);const si=ci.byteLength;ot+=si,it.push(new Mp4Sample(!0,Xe,si,0)),Yr=Si}const ai=it.length;if(!ai)return;const oi=it[it.length-1];this.nextAudioPts=dt=Yr+Ke*oi.duration;const ni=nt?new Uint8Array(0):MP4.moof(Z.sequenceNumber++,mt/Ke,_extends({},Z,{samples:it}));Z.samples=[];const li=mt/be,ui=dt/be,mi={data1:ni,data2:Qr,startPTS:li,endPTS:ui,startDTS:li,endDTS:ui,type:"audio",hasAudio:!0,hasVideo:!1,nb:ai};return this.isAudioContiguous=!0,mi}remuxEmptyAudio(Z,ee,ae,ye){const ve=Z.inputTimeScale,be=Z.samplerate?Z.samplerate:ve,Ye=ve/be,Ke=this.nextAudioPts,Xe=this._initDTS,Je=Xe.baseTime*9e4/Xe.timescale,rt=(Ke!==null?Ke:ye.startDTS*ve)+Je,nt=ye.endDTS*ve+Je,it=Ye*AAC_SAMPLES_PER_FRAME,lt=Math.ceil((nt-rt)/it),ct=AAC.getSilentFrame(Z.manifestCodec||Z.codec,Z.channelCount);if(logger.warn("[mp4-remuxer]: remux empty Audio"),!ct){logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}const ot=[];for(let dt=0;dt<lt;dt++){const ft=rt+dt*it;ot.push({unit:ct,pts:ft,dts:ft})}return Z.samples=ot,this.remuxAudio(Z,ee,ae,!1)}}function normalizePts(ie,Z){let ee;if(Z===null)return ie;for(Z<ie?ee=-8589934592:ee=8589934592;Math.abs(ie-Z)>4294967296;)ie+=ee;return ie}function findKeyframeIndex(ie){for(let Z=0;Z<ie.length;Z++)if(ie[Z].key)return Z;return-1}function flushTextTrackMetadataCueSamples(ie,Z,ee,ae){const ye=ie.samples.length;if(!ye)return;const ve=ie.inputTimeScale;for(let Ye=0;Ye<ye;Ye++){const Ke=ie.samples[Ye];Ke.pts=normalizePts(Ke.pts-ee.baseTime*ve/ee.timescale,Z*ve)/ve,Ke.dts=normalizePts(Ke.dts-ae.baseTime*ve/ae.timescale,Z*ve)/ve}const be=ie.samples;return ie.samples=[],{samples:be}}function flushTextTrackUserdataCueSamples(ie,Z,ee){const ae=ie.samples.length;if(!ae)return;const ye=ie.inputTimeScale;for(let be=0;be<ae;be++){const Ye=ie.samples[be];Ye.pts=normalizePts(Ye.pts-ee.baseTime*ye/ee.timescale,Z*ye)/ye}ie.samples.sort((be,Ye)=>be.pts-Ye.pts);const ve=ie.samples;return ie.samples=[],{samples:ve}}class Mp4Sample{constructor(Z,ee,ae,ye){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=ee,this.size=ae,this.cts=ye,this.flags={isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:Z?2:1,isNonSync:Z?0:1}}}class PassThroughRemuxer{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(Z){this.initPTS=Z,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(Z,ee,ae,ye){this.audioCodec=ee,this.videoCodec=ae,this.generateInitSegment(patchEncyptionData(Z,ye)),this.emitInitSegment=!0}generateInitSegment(Z){let{audioCodec:ee,videoCodec:ae}=this;if(!(Z!=null&&Z.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const ye=this.initData=parseInitSegment(Z);ye.audio&&(ee=getParsedTrackCodec(ye.audio,ElementaryStreamTypes.AUDIO)),ye.video&&(ae=getParsedTrackCodec(ye.video,ElementaryStreamTypes.VIDEO));const ve={};ye.audio&&ye.video?ve.audiovideo={container:"video/mp4",codec:ee+","+ae,initSegment:Z,id:"main"}:ye.audio?ve.audio={container:"audio/mp4",codec:ee,initSegment:Z,id:"audio"}:ye.video?ve.video={container:"video/mp4",codec:ae,initSegment:Z,id:"main"}:logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=ve}remux(Z,ee,ae,ye,ve,be){var Ye,Ke;let{initPTS:Xe,lastEndTime:Je}=this;const rt={audio:void 0,video:void 0,text:ye,id3:ae,initSegment:void 0};isFiniteNumber(Je)||(Je=this.lastEndTime=ve||0);const nt=ee.samples;if(!(nt!=null&&nt.length))return rt;const it={initPTS:void 0,timescale:1};let lt=this.initData;if((Ye=lt)!=null&&Ye.length||(this.generateInitSegment(nt),lt=this.initData),!((Ke=lt)!=null&&Ke.length))return logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),rt;this.emitInitSegment&&(it.tracks=this.initTracks,this.emitInitSegment=!1);const ct=getDuration(nt,lt),ot=getStartDTS(lt,nt),dt=ot===null?ve:ot;(isInvalidInitPts(Xe,dt,ve,ct)||it.timescale!==Xe.timescale&&be)&&(it.initPTS=dt-ve,Xe&&Xe.timescale===1&&logger.warn(`Adjusting initPTS by ${it.initPTS-Xe.baseTime}`),this.initPTS=Xe={baseTime:it.initPTS,timescale:1});const ft=Z?dt-Xe.baseTime/Xe.timescale:Je,gt=ft+ct;offsetStartDTS(lt,nt,Xe.baseTime/Xe.timescale),ct>0?this.lastEndTime=gt:(logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const mt=!!lt.audio,Yr=!!lt.video;let Qr="";mt&&(Qr+="audio"),Yr&&(Qr+="video");const Xr={data1:nt,startPTS:ft,startDTS:ft,endPTS:gt,endDTS:gt,type:Qr,hasAudio:mt,hasVideo:Yr,nb:1,dropped:0};return rt.audio=Xr.type==="audio"?Xr:void 0,rt.video=Xr.type!=="audio"?Xr:void 0,rt.initSegment=it,rt.id3=flushTextTrackMetadataCueSamples(ae,ve,Xe,Xe),ye.samples.length&&(rt.text=flushTextTrackUserdataCueSamples(ye,ve,Xe)),rt}}function isInvalidInitPts(ie,Z,ee,ae){if(ie===null)return!0;const ye=Math.max(ae,1),ve=Z-ie.baseTime/ie.timescale;return Math.abs(ve-ee)>ye}function getParsedTrackCodec(ie,Z){const ee=ie==null?void 0:ie.codec;if(ee&&ee.length>4)return ee;if(Z===ElementaryStreamTypes.AUDIO){if(ee==="ec-3"||ee==="ac-3"||ee==="alac")return ee;if(ee==="fLaC"||ee==="Opus")return getCodecCompatibleName(ee,!1);const ae="mp4a.40.5";return logger.info(`Parsed audio codec "${ee}" or audio object type not handled. Using "${ae}"`),ae}return logger.warn(`Unhandled video codec "${ee}"`),ee==="hvc1"||ee==="hev1"?"hvc1.1.6.L120.90":ee==="av01"?"av01.0.04M.08":"avc1.42e01e"}let now;try{now=self.performance.now.bind(self.performance)}catch{logger.debug("Unable to use Performance API on this environment"),now=optionalSelf==null?void 0:optionalSelf.Date.now}const muxConfig=[{demux:MP4Demuxer,remux:PassThroughRemuxer},{demux:TSDemuxer,remux:MP4Remuxer},{demux:AACDemuxer,remux:MP4Remuxer},{demux:MP3Demuxer,remux:MP4Remuxer}];muxConfig.splice(2,0,{demux:AC3Demuxer,remux:MP4Remuxer});class Transmuxer{constructor(Z,ee,ae,ye,ve){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=Z,this.typeSupported=ee,this.config=ae,this.vendor=ye,this.id=ve}configure(Z){this.transmuxConfig=Z,this.decrypter&&this.decrypter.reset()}push(Z,ee,ae,ye){const ve=ae.transmuxing;ve.executeStart=now();let be=new Uint8Array(Z);const{currentTransmuxState:Ye,transmuxConfig:Ke}=this;ye&&(this.currentTransmuxState=ye);const{contiguous:Xe,discontinuity:Je,trackSwitch:rt,accurateTimeOffset:nt,timeOffset:it,initSegmentChange:lt}=ye||Ye,{audioCodec:ct,videoCodec:ot,defaultInitPts:dt,duration:ft,initSegmentData:gt}=Ke,mt=getEncryptionType(be,ee);if(mt&&mt.method==="AES-128"){const Jr=this.getDecrypter();if(Jr.isSync()){let ai=Jr.softwareDecrypt(be,mt.key.buffer,mt.iv.buffer);if(ae.part>-1&&(ai=Jr.flush()),!ai)return ve.executeEnd=now(),emptyResult(ae);be=new Uint8Array(ai)}else return this.decryptionPromise=Jr.webCryptoDecrypt(be,mt.key.buffer,mt.iv.buffer).then(ai=>{const oi=this.push(ai,null,ae);return this.decryptionPromise=null,oi}),this.decryptionPromise}const Yr=this.needsProbing(Je,rt);if(Yr){const Jr=this.configureTransmuxer(be);if(Jr)return logger.warn(`[transmuxer] ${Jr.message}`),this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:Jr,reason:Jr.message}),ve.executeEnd=now(),emptyResult(ae)}(Je||rt||lt||Yr)&&this.resetInitSegment(gt,ct,ot,ft,ee),(Je||lt||Yr)&&this.resetInitialTimestamp(dt),Xe||this.resetContiguity();const Qr=this.transmux(be,mt,it,nt,ae),Xr=this.currentTransmuxState;return Xr.contiguous=!0,Xr.discontinuity=!1,Xr.trackSwitch=!1,ve.executeEnd=now(),Qr}flush(Z){const ee=Z.transmuxing;ee.executeStart=now();const{decrypter:ae,currentTransmuxState:ye,decryptionPromise:ve}=this;if(ve)return ve.then(()=>this.flush(Z));const be=[],{timeOffset:Ye}=ye;if(ae){const rt=ae.flush();rt&&be.push(this.push(rt,null,Z))}const{demuxer:Ke,remuxer:Xe}=this;if(!Ke||!Xe)return ee.executeEnd=now(),[emptyResult(Z)];const Je=Ke.flush(Ye);return isPromise(Je)?Je.then(rt=>(this.flushRemux(be,rt,Z),be)):(this.flushRemux(be,Je,Z),be)}flushRemux(Z,ee,ae){const{audioTrack:ye,videoTrack:ve,id3Track:be,textTrack:Ye}=ee,{accurateTimeOffset:Ke,timeOffset:Xe}=this.currentTransmuxState;logger.log(`[transmuxer.ts]: Flushed fragment ${ae.sn}${ae.part>-1?" p: "+ae.part:""} of level ${ae.level}`);const Je=this.remuxer.remux(ye,ve,be,Ye,Xe,Ke,!0,this.id);Z.push({remuxResult:Je,chunkMeta:ae}),ae.transmuxing.executeEnd=now()}resetInitialTimestamp(Z){const{demuxer:ee,remuxer:ae}=this;!ee||!ae||(ee.resetTimeStamp(Z),ae.resetTimeStamp(Z))}resetContiguity(){const{demuxer:Z,remuxer:ee}=this;!Z||!ee||(Z.resetContiguity(),ee.resetNextTimestamp())}resetInitSegment(Z,ee,ae,ye,ve){const{demuxer:be,remuxer:Ye}=this;!be||!Ye||(be.resetInitSegment(Z,ee,ae,ye),Ye.resetInitSegment(Z,ee,ae,ve))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(Z,ee,ae,ye,ve){let be;return ee&&ee.method==="SAMPLE-AES"?be=this.transmuxSampleAes(Z,ee,ae,ye,ve):be=this.transmuxUnencrypted(Z,ae,ye,ve),be}transmuxUnencrypted(Z,ee,ae,ye){const{audioTrack:ve,videoTrack:be,id3Track:Ye,textTrack:Ke}=this.demuxer.demux(Z,ee,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(ve,be,Ye,Ke,ee,ae,!1,this.id),chunkMeta:ye}}transmuxSampleAes(Z,ee,ae,ye,ve){return this.demuxer.demuxSampleAes(Z,ee,ae).then(be=>({remuxResult:this.remuxer.remux(be.audioTrack,be.videoTrack,be.id3Track,be.textTrack,ae,ye,!1,this.id),chunkMeta:ve}))}configureTransmuxer(Z){const{config:ee,observer:ae,typeSupported:ye,vendor:ve}=this;let be;for(let nt=0,it=muxConfig.length;nt<it;nt++){var Ye;if((Ye=muxConfig[nt].demux)!=null&&Ye.probe(Z)){be=muxConfig[nt];break}}if(!be)return new Error("Failed to find demuxer by probing fragment data");const Ke=this.demuxer,Xe=this.remuxer,Je=be.remux,rt=be.demux;(!Xe||!(Xe instanceof Je))&&(this.remuxer=new Je(ae,ee,ye,ve)),(!Ke||!(Ke instanceof rt))&&(this.demuxer=new rt(ae,ee,ye),this.probe=rt.probe)}needsProbing(Z,ee){return!this.demuxer||!this.remuxer||Z||ee}getDecrypter(){let Z=this.decrypter;return Z||(Z=this.decrypter=new Decrypter(this.config)),Z}}function getEncryptionType(ie,Z){let ee=null;return ie.byteLength>0&&(Z==null?void 0:Z.key)!=null&&Z.iv!==null&&Z.method!=null&&(ee=Z),ee}const emptyResult=ie=>({remuxResult:{},chunkMeta:ie});function isPromise(ie){return"then"in ie&&ie.then instanceof Function}class TransmuxConfig{constructor(Z,ee,ae,ye,ve){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=Z,this.videoCodec=ee,this.initSegmentData=ae,this.duration=ye,this.defaultInitPts=ve||null}}class TransmuxState{constructor(Z,ee,ae,ye,ve,be){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=Z,this.contiguous=ee,this.accurateTimeOffset=ae,this.trackSwitch=ye,this.timeOffset=ve,this.initSegmentChange=be}}var eventemitter3={exports:{}};(function(ie){var Z=Object.prototype.hasOwnProperty,ee="~";function ae(){}Object.create&&(ae.prototype=Object.create(null),new ae().__proto__||(ee=!1));function ye(Ke,Xe,Je){this.fn=Ke,this.context=Xe,this.once=Je||!1}function ve(Ke,Xe,Je,rt,nt){if(typeof Je!="function")throw new TypeError("The listener must be a function");var it=new ye(Je,rt||Ke,nt),lt=ee?ee+Xe:Xe;return Ke._events[lt]?Ke._events[lt].fn?Ke._events[lt]=[Ke._events[lt],it]:Ke._events[lt].push(it):(Ke._events[lt]=it,Ke._eventsCount++),Ke}function be(Ke,Xe){--Ke._eventsCount===0?Ke._events=new ae:delete Ke._events[Xe]}function Ye(){this._events=new ae,this._eventsCount=0}Ye.prototype.eventNames=function(){var Ke=[],Xe,Je;if(this._eventsCount===0)return Ke;for(Je in Xe=this._events)Z.call(Xe,Je)&&Ke.push(ee?Je.slice(1):Je);return Object.getOwnPropertySymbols?Ke.concat(Object.getOwnPropertySymbols(Xe)):Ke},Ye.prototype.listeners=function(Ke){var Xe=ee?ee+Ke:Ke,Je=this._events[Xe];if(!Je)return[];if(Je.fn)return[Je.fn];for(var rt=0,nt=Je.length,it=new Array(nt);rt<nt;rt++)it[rt]=Je[rt].fn;return it},Ye.prototype.listenerCount=function(Ke){var Xe=ee?ee+Ke:Ke,Je=this._events[Xe];return Je?Je.fn?1:Je.length:0},Ye.prototype.emit=function(Ke,Xe,Je,rt,nt,it){var lt=ee?ee+Ke:Ke;if(!this._events[lt])return!1;var ct=this._events[lt],ot=arguments.length,dt,ft;if(ct.fn){switch(ct.once&&this.removeListener(Ke,ct.fn,void 0,!0),ot){case 1:return ct.fn.call(ct.context),!0;case 2:return ct.fn.call(ct.context,Xe),!0;case 3:return ct.fn.call(ct.context,Xe,Je),!0;case 4:return ct.fn.call(ct.context,Xe,Je,rt),!0;case 5:return ct.fn.call(ct.context,Xe,Je,rt,nt),!0;case 6:return ct.fn.call(ct.context,Xe,Je,rt,nt,it),!0}for(ft=1,dt=new Array(ot-1);ft<ot;ft++)dt[ft-1]=arguments[ft];ct.fn.apply(ct.context,dt)}else{var gt=ct.length,mt;for(ft=0;ft<gt;ft++)switch(ct[ft].once&&this.removeListener(Ke,ct[ft].fn,void 0,!0),ot){case 1:ct[ft].fn.call(ct[ft].context);break;case 2:ct[ft].fn.call(ct[ft].context,Xe);break;case 3:ct[ft].fn.call(ct[ft].context,Xe,Je);break;case 4:ct[ft].fn.call(ct[ft].context,Xe,Je,rt);break;default:if(!dt)for(mt=1,dt=new Array(ot-1);mt<ot;mt++)dt[mt-1]=arguments[mt];ct[ft].fn.apply(ct[ft].context,dt)}}return!0},Ye.prototype.on=function(Ke,Xe,Je){return ve(this,Ke,Xe,Je,!1)},Ye.prototype.once=function(Ke,Xe,Je){return ve(this,Ke,Xe,Je,!0)},Ye.prototype.removeListener=function(Ke,Xe,Je,rt){var nt=ee?ee+Ke:Ke;if(!this._events[nt])return this;if(!Xe)return be(this,nt),this;var it=this._events[nt];if(it.fn)it.fn===Xe&&(!rt||it.once)&&(!Je||it.context===Je)&&be(this,nt);else{for(var lt=0,ct=[],ot=it.length;lt<ot;lt++)(it[lt].fn!==Xe||rt&&!it[lt].once||Je&&it[lt].context!==Je)&&ct.push(it[lt]);ct.length?this._events[nt]=ct.length===1?ct[0]:ct:be(this,nt)}return this},Ye.prototype.removeAllListeners=function(Ke){var Xe;return Ke?(Xe=ee?ee+Ke:Ke,this._events[Xe]&&be(this,Xe)):(this._events=new ae,this._eventsCount=0),this},Ye.prototype.off=Ye.prototype.removeListener,Ye.prototype.addListener=Ye.prototype.on,Ye.prefixed=ee,Ye.EventEmitter=Ye,ie.exports=Ye})(eventemitter3);var eventemitter3Exports=eventemitter3.exports,EventEmitter=getDefaultExportFromCjs(eventemitter3Exports);class TransmuxerInterface{constructor(Z,ee,ae,ye){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const ve=Z.config;this.hls=Z,this.id=ee,this.useWorker=!!ve.enableWorker,this.onTransmuxComplete=ae,this.onFlush=ye;const be=(Je,rt)=>{rt=rt||{},rt.frag=this.frag,rt.id=this.id,Je===Events.ERROR&&(this.error=rt.error),this.hls.trigger(Je,rt)};this.observer=new EventEmitter,this.observer.on(Events.FRAG_DECRYPTED,be),this.observer.on(Events.ERROR,be);const Ye=getMediaSource(ve.preferManagedMediaSource)||{isTypeSupported:()=>!1},Ke={mpeg:Ye.isTypeSupported("audio/mpeg"),mp3:Ye.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:Ye.isTypeSupported('audio/mp4; codecs="ac-3"')},Xe=navigator.vendor;if(this.useWorker&&typeof Worker<"u"&&(ve.workerPath||hasUMDWorker())){try{ve.workerPath?(logger.log(`loading Web Worker ${ve.workerPath} for "${ee}"`),this.workerContext=loadWorker(ve.workerPath)):(logger.log(`injecting Web Worker for "${ee}"`),this.workerContext=injectWorker()),this.onwmsg=rt=>this.onWorkerMessage(rt);const{worker:Je}=this.workerContext;Je.addEventListener("message",this.onwmsg),Je.onerror=rt=>{const nt=new Error(`${rt.message}  (${rt.filename}:${rt.lineno})`);ve.enableWorker=!1,logger.warn(`Error in "${ee}" Web Worker, fallback to inline`),this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:nt})},Je.postMessage({cmd:"init",typeSupported:Ke,vendor:Xe,id:ee,config:JSON.stringify(ve)})}catch(Je){logger.warn(`Error setting up "${ee}" Web Worker, fallback to inline`,Je),this.resetWorker(),this.error=null,this.transmuxer=new Transmuxer(this.observer,Ke,ve,Xe,ee)}return}this.transmuxer=new Transmuxer(this.observer,Ke,ve,Xe,ee)}resetWorker(){if(this.workerContext){const{worker:Z,objectURL:ee}=this.workerContext;ee&&self.URL.revokeObjectURL(ee),Z.removeEventListener("message",this.onwmsg),Z.onerror=null,Z.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const ee=this.transmuxer;ee&&(ee.destroy(),this.transmuxer=null)}const Z=this.observer;Z&&Z.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(Z,ee,ae,ye,ve,be,Ye,Ke,Xe,Je){var rt,nt;Xe.transmuxing.start=self.performance.now();const{transmuxer:it}=this,lt=be?be.start:ve.start,ct=ve.decryptdata,ot=this.frag,dt=!(ot&&ve.cc===ot.cc),ft=!(ot&&Xe.level===ot.level),gt=ot?Xe.sn-ot.sn:-1,mt=this.part?Xe.part-this.part.index:-1,Yr=gt===0&&Xe.id>1&&Xe.id===(ot==null?void 0:ot.stats.chunkCount),Qr=!ft&&(gt===1||gt===0&&(mt===1||Yr&&mt<=0)),Xr=self.performance.now();(ft||gt||ve.stats.parsing.start===0)&&(ve.stats.parsing.start=Xr),be&&(mt||!Qr)&&(be.stats.parsing.start=Xr);const Jr=!(ot&&((rt=ve.initSegment)==null?void 0:rt.url)===((nt=ot.initSegment)==null?void 0:nt.url)),ai=new TransmuxState(dt,Qr,Ke,ft,lt,Jr);if(!Qr||dt||Jr){logger.log(`[transmuxer-interface, ${ve.type}]: Starting new transmux session for sn: ${Xe.sn} p: ${Xe.part} level: ${Xe.level} id: ${Xe.id}
        discontinuity: ${dt}
        trackSwitch: ${ft}
        contiguous: ${Qr}
        accurateTimeOffset: ${Ke}
        timeOffset: ${lt}
        initSegmentChange: ${Jr}`);const oi=new TransmuxConfig(ae,ye,ee,Ye,Je);this.configureTransmuxer(oi)}if(this.frag=ve,this.part=be,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:Z,decryptdata:ct,chunkMeta:Xe,state:ai},Z instanceof ArrayBuffer?[Z]:[]);else if(it){const oi=it.push(Z,ct,Xe,ai);isPromise(oi)?(it.async=!0,oi.then(ni=>{this.handleTransmuxComplete(ni)}).catch(ni=>{this.transmuxerError(ni,Xe,"transmuxer-interface push error")})):(it.async=!1,this.handleTransmuxComplete(oi))}}flush(Z){Z.transmuxing.start=self.performance.now();const{transmuxer:ee}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:Z});else if(ee){let ae=ee.flush(Z);isPromise(ae)||ee.async?(isPromise(ae)||(ae=Promise.resolve(ae)),ae.then(ye=>{this.handleFlushResult(ye,Z)}).catch(ye=>{this.transmuxerError(ye,Z,"transmuxer-interface flush error")})):this.handleFlushResult(ae,Z)}}transmuxerError(Z,ee,ae){this.hls&&(this.error=Z,this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:ee,fatal:!1,error:Z,err:Z,reason:ae}))}handleFlushResult(Z,ee){Z.forEach(ae=>{this.handleTransmuxComplete(ae)}),this.onFlush(ee)}onWorkerMessage(Z){const ee=Z.data,ae=this.hls;switch(ee.event){case"init":{var ye;const ve=(ye=this.workerContext)==null?void 0:ye.objectURL;ve&&self.URL.revokeObjectURL(ve);break}case"transmuxComplete":{this.handleTransmuxComplete(ee.data);break}case"flush":{this.onFlush(ee.data);break}case"workerLog":logger[ee.data.logType]&&logger[ee.data.logType](ee.data.message);break;default:{ee.data=ee.data||{},ee.data.frag=this.frag,ee.data.id=this.id,ae.trigger(ee.event,ee.data);break}}}configureTransmuxer(Z){const{transmuxer:ee}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:Z}):ee&&ee.configure(Z)}handleTransmuxComplete(Z){Z.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(Z)}}function subtitleOptionsIdentical(ie,Z){if(ie.length!==Z.length)return!1;for(let ee=0;ee<ie.length;ee++)if(!mediaAttributesIdentical(ie[ee].attrs,Z[ee].attrs))return!1;return!0}function mediaAttributesIdentical(ie,Z,ee){const ae=ie["STABLE-RENDITION-ID"];return ae&&!ee?ae===Z["STABLE-RENDITION-ID"]:!(ee||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(ye=>ie[ye]!==Z[ye])}function subtitleTrackMatchesTextTrack(ie,Z){return Z.label.toLowerCase()===ie.name.toLowerCase()&&(!Z.language||Z.language.toLowerCase()===(ie.lang||"").toLowerCase())}const TICK_INTERVAL$2=100;class AudioStreamController extends BaseStreamController{constructor(Z,ee,ae){super(Z,ee,ae,"[audio-stream-controller]",PlaylistLevelType.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:Z}=this;Z.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),Z.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),Z.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),Z.on(Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),Z.on(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),Z.on(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),Z.on(Events.ERROR,this.onError,this),Z.on(Events.BUFFER_RESET,this.onBufferReset,this),Z.on(Events.BUFFER_CREATED,this.onBufferCreated,this),Z.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),Z.on(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),Z.on(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),Z.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:Z}=this;Z.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),Z.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),Z.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),Z.off(Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),Z.off(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),Z.off(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),Z.off(Events.ERROR,this.onError,this),Z.off(Events.BUFFER_RESET,this.onBufferReset,this),Z.off(Events.BUFFER_CREATED,this.onBufferCreated,this),Z.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),Z.off(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),Z.off(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),Z.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(Z,{frag:ee,id:ae,initPTS:ye,timescale:ve}){if(ae==="main"){const be=ee.cc;this.initPTS[ee.cc]={baseTime:ye,timescale:ve},this.log(`InitPTS for cc: ${be} found from main: ${ye}`),this.videoTrackCC=be,this.state===State.WAITING_INIT_PTS&&this.tick()}}startLoad(Z){if(!this.levels){this.startPosition=Z,this.state=State.STOPPED;return}const ee=this.lastCurrentTime;this.stopLoad(),this.setInterval(TICK_INTERVAL$2),ee>0&&Z===-1?(this.log(`Override startPosition with lastCurrentTime @${ee.toFixed(3)}`),Z=ee,this.state=State.IDLE):(this.loadedmetadata=!1,this.state=State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=Z,this.tick()}doTick(){switch(this.state){case State.IDLE:this.doTickIdle();break;case State.WAITING_TRACK:{var Z;const{levels:ae,trackId:ye}=this,ve=ae==null||(Z=ae[ye])==null?void 0:Z.details;if(ve){if(this.waitForCdnTuneIn(ve))break;this.state=State.WAITING_INIT_PTS}break}case State.FRAG_LOADING_WAITING_RETRY:{var ee;const ae=performance.now(),ye=this.retryDate;if(!ye||ae>=ye||(ee=this.media)!=null&&ee.seeking){const{levels:ve,trackId:be}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((ve==null?void 0:ve[be])||null),this.state=State.IDLE}break}case State.WAITING_INIT_PTS:{const ae=this.waitingData;if(ae){const{frag:ye,part:ve,cache:be,complete:Ye}=ae;if(this.initPTS[ye.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=State.FRAG_LOADING;const Ke=be.flush(),Xe={frag:ye,part:ve,payload:Ke,networkDetails:null};this._handleFragmentLoadProgress(Xe),Ye&&super._handleFragmentLoadComplete(Xe)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${ye.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const Ke=this.getLoadPosition(),Xe=BufferHelper.bufferInfo(this.mediaBuffer,Ke,this.config.maxBufferHole);fragmentWithinToleranceTest(Xe.end,this.config.maxFragLookUpTolerance,ye)<0&&(this.log(`Waiting fragment cc (${ye.cc}) @ ${ye.start} cancelled because another fragment at ${Xe.end} is needed`),this.clearWaitingFragment())}}else this.state=State.IDLE}}this.onTickEnd()}clearWaitingFragment(){const Z=this.waitingData;Z&&(this.fragmentTracker.removeFragment(Z.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=State.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:Z}=this;Z!=null&&Z.readyState&&(this.lastCurrentTime=Z.currentTime)}doTickIdle(){const{hls:Z,levels:ee,media:ae,trackId:ye}=this,ve=Z.config;if(!ae&&(this.startFragRequested||!ve.startFragPrefetch)||!(ee!=null&&ee[ye]))return;const be=ee[ye],Ye=be.details;if(!Ye||Ye.live&&this.levelLastLoaded!==be||this.waitForCdnTuneIn(Ye)){this.state=State.WAITING_TRACK;return}const Ke=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&Ke&&(this.bufferFlushed=!1,this.afterBufferFlushed(Ke,ElementaryStreamTypes.AUDIO,PlaylistLevelType.AUDIO));const Xe=this.getFwdBufferInfo(Ke,PlaylistLevelType.AUDIO);if(Xe===null)return;const{bufferedTrack:Je,switchingTrack:rt}=this;if(!rt&&this._streamEnded(Xe,Ye)){Z.trigger(Events.BUFFER_EOS,{type:"audio"}),this.state=State.ENDED;return}const nt=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,PlaylistLevelType.MAIN),it=Xe.len,lt=this.getMaxBufferLength(nt==null?void 0:nt.len),ct=Ye.fragments,ot=ct[0].start;let dt=this.flushing?this.getLoadPosition():Xe.end;if(rt&&ae){const Yr=this.getLoadPosition();Je&&!mediaAttributesIdentical(rt.attrs,Je.attrs)&&(dt=Yr),Ye.PTSKnown&&Yr<ot&&(Xe.end>ot||Xe.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),ae.currentTime=ot+.05)}if(it>=lt&&!rt&&dt<ct[ct.length-1].start)return;let ft=this.getNextFragment(dt,Ye),gt=!1;if(ft&&this.isLoopLoading(ft,dt)&&(gt=!!ft.gap,ft=this.getNextFragmentLoopLoading(ft,Ye,Xe,PlaylistLevelType.MAIN,lt)),!ft){this.bufferFlushed=!0;return}const mt=nt&&ft.start>nt.end+Ye.targetduration;if(mt||!(nt!=null&&nt.len)&&Xe.len){const Yr=this.getAppendedFrag(ft.start,PlaylistLevelType.MAIN);if(Yr===null||(gt||(gt=!!Yr.gap||!!mt&&nt.len===0),mt&&!gt||gt&&Xe.nextStart&&Xe.nextStart<Yr.end))return}this.loadFragment(ft,be,dt)}getMaxBufferLength(Z){const ee=super.getMaxBufferLength();return Z?Math.min(Math.max(ee,Z),this.config.maxMaxBufferLength):ee}onMediaDetaching(){this.videoBuffer=null,this.bufferFlushed=this.flushing=!1,super.onMediaDetaching()}onAudioTracksUpdated(Z,{audioTracks:ee}){this.resetTransmuxer(),this.levels=ee.map(ae=>new Level(ae))}onAudioTrackSwitching(Z,ee){const ae=!!ee.url;this.trackId=ee.id;const{fragCurrent:ye}=this;ye&&(ye.abortRequests(),this.removeUnbufferedFrags(ye.start)),this.resetLoadingState(),ae?this.setInterval(TICK_INTERVAL$2):this.resetTransmuxer(),ae?(this.switchingTrack=ee,this.state=State.IDLE,this.flushAudioIfNeeded(ee)):(this.switchingTrack=null,this.bufferedTrack=ee,this.state=State.STOPPED),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=this.flushing=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(Z,ee){this.mainDetails=ee.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(Z,ee){var ae;if(this.mainDetails==null){this.cachedTrackLoadedData=ee;return}const{levels:ye}=this,{details:ve,id:be}=ee;if(!ye){this.warn(`Audio tracks were reset while loading level ${be}`);return}this.log(`Audio track ${be} loaded [${ve.startSN},${ve.endSN}]${ve.lastPartSn?`[part-${ve.lastPartSn}-${ve.lastPartIndex}]`:""},duration:${ve.totalduration}`);const Ye=ye[be];let Ke=0;if(ve.live||(ae=Ye.details)!=null&&ae.live){this.checkLiveUpdate(ve);const Je=this.mainDetails;if(ve.deltaUpdateFailed||!Je)return;if(!Ye.details&&ve.hasProgramDateTime&&Je.hasProgramDateTime)alignMediaPlaylistByPDT(ve,Je),Ke=ve.fragments[0].start;else{var Xe;Ke=this.alignPlaylists(ve,Ye.details,(Xe=this.levelLastLoaded)==null?void 0:Xe.details)}}Ye.details=ve,this.levelLastLoaded=Ye,!this.startFragRequested&&(this.mainDetails||!ve.live)&&this.setStartPosition(Ye.details,Ke),this.state===State.WAITING_TRACK&&!this.waitForCdnTuneIn(ve)&&(this.state=State.IDLE),this.tick()}_handleFragmentLoadProgress(Z){var ee;const{frag:ae,part:ye,payload:ve}=Z,{config:be,trackId:Ye,levels:Ke}=this;if(!Ke){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${ae.sn} of level ${ae.level} will not be buffered`);return}const Xe=Ke[Ye];if(!Xe){this.warn("Audio track is undefined on fragment load progress");return}const Je=Xe.details;if(!Je){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(ae.start);return}const rt=be.defaultAudioCodec||Xe.audioCodec||"mp4a.40.2";let nt=this.transmuxer;nt||(nt=this.transmuxer=new TransmuxerInterface(this.hls,PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const it=this.initPTS[ae.cc],lt=(ee=ae.initSegment)==null?void 0:ee.data;if(it!==void 0){const ct=ye?ye.index:-1,ot=ct!==-1,dt=new ChunkMetadata(ae.level,ae.sn,ae.stats.chunkCount,ve.byteLength,ct,ot);nt.push(ve,lt,rt,"",ae,ye,Je.totalduration,!1,dt,it)}else{this.log(`Unknown video PTS for cc ${ae.cc}, waiting for video PTS before demuxing audio frag ${ae.sn} of [${Je.startSN} ,${Je.endSN}],track ${Ye}`);const{cache:ct}=this.waitingData=this.waitingData||{frag:ae,part:ye,cache:new ChunkCache,complete:!1};ct.push(new Uint8Array(ve)),this.waitingVideoCC=this.videoTrackCC,this.state=State.WAITING_INIT_PTS}}_handleFragmentLoadComplete(Z){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(Z)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(Z,ee){const ae=ee.tracks.audio;ae&&(this.mediaBuffer=ae.buffer||null),ee.tracks.video&&(this.videoBuffer=ee.tracks.video.buffer||null)}onFragBuffered(Z,ee){const{frag:ae,part:ye}=ee;if(ae.type!==PlaylistLevelType.AUDIO){if(!this.loadedmetadata&&ae.type===PlaylistLevelType.MAIN){const ve=this.videoBuffer||this.media;ve&&BufferHelper.getBuffered(ve).length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(ae)){this.warn(`Fragment ${ae.sn}${ye?" p: "+ye.index:""} of level ${ae.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(ae.sn!=="initSegment"){this.fragPrevious=ae;const ve=this.switchingTrack;ve&&(this.bufferedTrack=ve,this.switchingTrack=null,this.hls.trigger(Events.AUDIO_TRACK_SWITCHED,_objectSpread2({},ve)))}this.fragBufferedComplete(ae,ye)}onError(Z,ee){var ae;if(ee.fatal){this.state=State.ERROR;return}switch(ee.details){case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_PARSING_ERROR:case ErrorDetails.FRAG_DECRYPT_ERROR:case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(PlaylistLevelType.AUDIO,ee);break;case ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case ErrorDetails.LEVEL_PARSING_ERROR:!ee.levelRetry&&this.state===State.WAITING_TRACK&&((ae=ee.context)==null?void 0:ae.type)===PlaylistContextType.AUDIO_TRACK&&(this.state=State.IDLE);break;case ErrorDetails.BUFFER_APPEND_ERROR:case ErrorDetails.BUFFER_FULL_ERROR:if(!ee.parent||ee.parent!=="audio")return;if(ee.details===ErrorDetails.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(ee)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case ErrorDetails.INTERNAL_EXCEPTION:this.recoverWorkerError(ee);break}}onBufferFlushing(Z,{type:ee}){ee!==ElementaryStreamTypes.VIDEO&&(this.flushing=!0)}onBufferFlushed(Z,{type:ee}){if(ee!==ElementaryStreamTypes.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===State.ENDED&&(this.state=State.IDLE);const ae=this.mediaBuffer||this.media;ae&&(this.afterBufferFlushed(ae,ee,PlaylistLevelType.AUDIO),this.tick())}}_handleTransmuxComplete(Z){var ee;const ae="audio",{hls:ye}=this,{remuxResult:ve,chunkMeta:be}=Z,Ye=this.getCurrentContext(be);if(!Ye){this.resetWhenMissingContext(be);return}const{frag:Ke,part:Xe,level:Je}=Ye,{details:rt}=Je,{audio:nt,text:it,id3:lt,initSegment:ct}=ve;if(this.fragContextChanged(Ke)||!rt){this.fragmentTracker.removeFragment(Ke);return}if(this.state=State.PARSING,this.switchingTrack&&nt&&this.completeAudioSwitch(this.switchingTrack),ct!=null&&ct.tracks){const ot=Ke.initSegment||Ke;this._bufferInitSegment(Je,ct.tracks,ot,be),ye.trigger(Events.FRAG_PARSING_INIT_SEGMENT,{frag:ot,id:ae,tracks:ct.tracks})}if(nt){const{startPTS:ot,endPTS:dt,startDTS:ft,endDTS:gt}=nt;Xe&&(Xe.elementaryStreams[ElementaryStreamTypes.AUDIO]={startPTS:ot,endPTS:dt,startDTS:ft,endDTS:gt}),Ke.setElementaryStreamInfo(ElementaryStreamTypes.AUDIO,ot,dt,ft,gt),this.bufferFragmentData(nt,Ke,Xe,be)}if(lt!=null&&(ee=lt.samples)!=null&&ee.length){const ot=_extends({id:ae,frag:Ke,details:rt},lt);ye.trigger(Events.FRAG_PARSING_METADATA,ot)}if(it){const ot=_extends({id:ae,frag:Ke,details:rt},it);ye.trigger(Events.FRAG_PARSING_USERDATA,ot)}}_bufferInitSegment(Z,ee,ae,ye){if(this.state!==State.PARSING)return;ee.video&&delete ee.video;const ve=ee.audio;if(!ve)return;ve.id="audio";const be=Z.audioCodec;this.log(`Init audio buffer, container:${ve.container}, codecs[level/parsed]=[${be}/${ve.codec}]`),be&&be.split(",").length===1&&(ve.levelCodec=be),this.hls.trigger(Events.BUFFER_CODECS,ee);const Ye=ve.initSegment;if(Ye!=null&&Ye.byteLength){const Ke={type:"audio",frag:ae,part:null,chunkMeta:ye,parent:ae.type,data:Ye};this.hls.trigger(Events.BUFFER_APPENDING,Ke)}this.tickImmediate()}loadFragment(Z,ee,ae){const ye=this.fragmentTracker.getState(Z);if(this.fragCurrent=Z,this.switchingTrack||ye===FragmentState.NOT_LOADED||ye===FragmentState.PARTIAL){var ve;if(Z.sn==="initSegment")this._loadInitSegment(Z,ee);else if((ve=ee.details)!=null&&ve.live&&!this.initPTS[Z.cc]){this.log(`Waiting for video PTS in continuity counter ${Z.cc} of live stream before loading audio fragment ${Z.sn} of level ${this.trackId}`),this.state=State.WAITING_INIT_PTS;const be=this.mainDetails;be&&be.fragments[0].start!==ee.details.fragments[0].start&&alignMediaPlaylistByPDT(ee.details,be)}else this.startFragRequested=!0,super.loadFragment(Z,ee,ae)}else this.clearTrackerIfNeeded(Z)}flushAudioIfNeeded(Z){const{media:ee,bufferedTrack:ae}=this,ye=ae==null?void 0:ae.attrs,ve=Z.attrs;ee&&ye&&(ye.CHANNELS!==ve.CHANNELS||ae.name!==Z.name||ae.lang!==Z.lang)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null)}completeAudioSwitch(Z){const{hls:ee}=this;this.flushAudioIfNeeded(Z),this.bufferedTrack=Z,this.switchingTrack=null,ee.trigger(Events.AUDIO_TRACK_SWITCHED,_objectSpread2({},Z))}}class AudioTrackController extends BasePlaylistController{constructor(Z){super(Z,"[audio-track-controller]"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:Z}=this;Z.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),Z.on(Events.LEVEL_LOADING,this.onLevelLoading,this),Z.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),Z.on(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),Z.on(Events.ERROR,this.onError,this)}unregisterListeners(){const{hls:Z}=this;Z.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),Z.off(Events.LEVEL_LOADING,this.onLevelLoading,this),Z.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),Z.off(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),Z.off(Events.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(Z,ee){this.tracks=ee.audioTracks||[]}onAudioTrackLoaded(Z,ee){const{id:ae,groupId:ye,details:ve}=ee,be=this.tracksInGroup[ae];if(!be||be.groupId!==ye){this.warn(`Audio track with id:${ae} and group:${ye} not found in active group ${be==null?void 0:be.groupId}`);return}const Ye=be.details;be.details=ee.details,this.log(`Audio track ${ae} "${be.name}" lang:${be.lang} group:${ye} loaded [${ve.startSN}-${ve.endSN}]`),ae===this.trackId&&this.playlistLoaded(ae,ee,Ye)}onLevelLoading(Z,ee){this.switchLevel(ee.level)}onLevelSwitching(Z,ee){this.switchLevel(ee.level)}switchLevel(Z){const ee=this.hls.levels[Z];if(!ee)return;const ae=ee.audioGroups||null,ye=this.groupIds;let ve=this.currentTrack;if(!ae||(ye==null?void 0:ye.length)!==(ae==null?void 0:ae.length)||ae!=null&&ae.some(Ye=>(ye==null?void 0:ye.indexOf(Ye))===-1)){this.groupIds=ae,this.trackId=-1,this.currentTrack=null;const Ye=this.tracks.filter(nt=>!ae||ae.indexOf(nt.groupId)!==-1);if(Ye.length)this.selectDefaultTrack&&!Ye.some(nt=>nt.default)&&(this.selectDefaultTrack=!1),Ye.forEach((nt,it)=>{nt.id=it});else if(!ve&&!this.tracksInGroup.length)return;this.tracksInGroup=Ye;const Ke=this.hls.config.audioPreference;if(!ve&&Ke){const nt=findMatchingOption(Ke,Ye,audioMatchPredicate);if(nt>-1)ve=Ye[nt];else{const it=findMatchingOption(Ke,this.tracks);ve=this.tracks[it]}}let Xe=this.findTrackId(ve);Xe===-1&&ve&&(Xe=this.findTrackId(null));const Je={audioTracks:Ye};this.log(`Updating audio tracks, ${Ye.length} track(s) found in group(s): ${ae==null?void 0:ae.join(",")}`),this.hls.trigger(Events.AUDIO_TRACKS_UPDATED,Je);const rt=this.trackId;if(Xe!==-1&&rt===-1)this.setAudioTrack(Xe);else if(Ye.length&&rt===-1){var be;const nt=new Error(`No audio track selected for current audio group-ID(s): ${(be=this.groupIds)==null?void 0:be.join(",")} track count: ${Ye.length}`);this.warn(nt.message),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:nt})}}else this.shouldReloadPlaylist(ve)&&this.setAudioTrack(this.trackId)}onError(Z,ee){ee.fatal||!ee.context||ee.context.type===PlaylistContextType.AUDIO_TRACK&&ee.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(ee.context.groupId)!==-1)&&(this.requestScheduled=-1,this.checkRetry(ee))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(Z){this.selectDefaultTrack=!1,this.setAudioTrack(Z)}setAudioOption(Z){const ee=this.hls;if(ee.config.audioPreference=Z,Z){const ae=this.allAudioTracks;if(this.selectDefaultTrack=!1,ae.length){const ye=this.currentTrack;if(ye&&matchesOption(Z,ye,audioMatchPredicate))return ye;const ve=findMatchingOption(Z,this.tracksInGroup,audioMatchPredicate);if(ve>-1){const be=this.tracksInGroup[ve];return this.setAudioTrack(ve),be}else if(ye){let be=ee.loadLevel;be===-1&&(be=ee.firstAutoLevel);const Ye=findClosestLevelWithAudioGroup(Z,ee.levels,ae,be,audioMatchPredicate);if(Ye===-1)return null;ee.nextLoadLevel=Ye}if(Z.channels||Z.audioCodec){const be=findMatchingOption(Z,ae);if(be>-1)return ae[be]}}}return null}setAudioTrack(Z){const ee=this.tracksInGroup;if(Z<0||Z>=ee.length){this.warn(`Invalid audio track id: ${Z}`);return}this.clearTimer(),this.selectDefaultTrack=!1;const ae=this.currentTrack,ye=ee[Z],ve=ye.details&&!ye.details.live;if(Z===this.trackId&&ye===ae&&ve||(this.log(`Switching to audio-track ${Z} "${ye.name}" lang:${ye.lang} group:${ye.groupId} channels:${ye.channels}`),this.trackId=Z,this.currentTrack=ye,this.hls.trigger(Events.AUDIO_TRACK_SWITCHING,_objectSpread2({},ye)),ve))return;const be=this.switchParams(ye.url,ae==null?void 0:ae.details);this.loadPlaylist(be)}findTrackId(Z){const ee=this.tracksInGroup;for(let ae=0;ae<ee.length;ae++){const ye=ee[ae];if(!(this.selectDefaultTrack&&!ye.default)&&(!Z||matchesOption(Z,ye,audioMatchPredicate)))return ae}if(Z){const{name:ae,lang:ye,assocLang:ve,characteristics:be,audioCodec:Ye,channels:Ke}=Z;for(let Xe=0;Xe<ee.length;Xe++){const Je=ee[Xe];if(matchesOption({name:ae,lang:ye,assocLang:ve,characteristics:be,audioCodec:Ye,channels:Ke},Je,audioMatchPredicate))return Xe}for(let Xe=0;Xe<ee.length;Xe++){const Je=ee[Xe];if(mediaAttributesIdentical(Z.attrs,Je.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return Xe}for(let Xe=0;Xe<ee.length;Xe++){const Je=ee[Xe];if(mediaAttributesIdentical(Z.attrs,Je.attrs,["LANGUAGE"]))return Xe}}return-1}loadPlaylist(Z){const ee=this.currentTrack;if(this.shouldLoadPlaylist(ee)&&ee){super.loadPlaylist();const ae=ee.id,ye=ee.groupId;let ve=ee.url;if(Z)try{ve=Z.addDirectives(ve)}catch(be){this.warn(`Could not construct new URL with HLS Delivery Directives: ${be}`)}this.log(`loading audio-track playlist ${ae} "${ee.name}" lang:${ee.lang} group:${ye}`),this.clearTimer(),this.hls.trigger(Events.AUDIO_TRACK_LOADING,{url:ve,id:ae,groupId:ye,deliveryDirectives:Z||null})}}}const TICK_INTERVAL$1=500;class SubtitleStreamController extends BaseStreamController{constructor(Z,ee,ae){super(Z,ee,ae,"[subtitle-stream-controller]",PlaylistLevelType.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}_registerListeners(){const{hls:Z}=this;Z.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),Z.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),Z.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),Z.on(Events.ERROR,this.onError,this),Z.on(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),Z.on(Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),Z.on(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),Z.on(Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),Z.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),Z.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:Z}=this;Z.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),Z.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),Z.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),Z.off(Events.ERROR,this.onError,this),Z.off(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),Z.off(Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),Z.off(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),Z.off(Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),Z.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),Z.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(Z){this.stopLoad(),this.state=State.IDLE,this.setInterval(TICK_INTERVAL$1),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=Z,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(Z,ee){this.mainDetails=ee.details}onSubtitleFragProcessed(Z,ee){const{frag:ae,success:ye}=ee;if(this.fragPrevious=ae,this.state=State.IDLE,!ye)return;const ve=this.tracksBuffered[this.currentTrackId];if(!ve)return;let be;const Ye=ae.start;for(let Xe=0;Xe<ve.length;Xe++)if(Ye>=ve[Xe].start&&Ye<=ve[Xe].end){be=ve[Xe];break}const Ke=ae.start+ae.duration;be?be.end=Ke:(be={start:Ye,end:Ke},ve.push(be)),this.fragmentTracker.fragBuffered(ae),this.fragBufferedComplete(ae,null)}onBufferFlushing(Z,ee){const{startOffset:ae,endOffset:ye}=ee;if(ae===0&&ye!==Number.POSITIVE_INFINITY){const ve=ye-1;if(ve<=0)return;ee.endOffsetSubtitles=Math.max(0,ve),this.tracksBuffered.forEach(be=>{for(let Ye=0;Ye<be.length;){if(be[Ye].end<=ve){be.shift();continue}else if(be[Ye].start<ve)be[Ye].start=ve;else break;Ye++}}),this.fragmentTracker.removeFragmentsInRange(ae,ve,PlaylistLevelType.SUBTITLE)}}onFragBuffered(Z,ee){if(!this.loadedmetadata&&ee.frag.type===PlaylistLevelType.MAIN){var ae;(ae=this.media)!=null&&ae.buffered.length&&(this.loadedmetadata=!0)}}onError(Z,ee){const ae=ee.frag;(ae==null?void 0:ae.type)===PlaylistLevelType.SUBTITLE&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==State.STOPPED&&(this.state=State.IDLE))}onSubtitleTracksUpdated(Z,{subtitleTracks:ee}){if(!this.levels||subtitleOptionsIdentical(this.levels,ee)){this.levels=ee.map(ae=>new Level(ae));return}this.tracksBuffered=[],this.levels=ee.map(ae=>{const ye=new Level(ae);return this.tracksBuffered[ye.id]=[],ye}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,PlaylistLevelType.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(Z,ee){var ae;if(this.currentTrackId=ee.id,!((ae=this.levels)!=null&&ae.length)||this.currentTrackId===-1){this.clearInterval();return}const ye=this.levels[this.currentTrackId];ye!=null&&ye.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,ye&&this.setInterval(TICK_INTERVAL$1)}onSubtitleTrackLoaded(Z,ee){var ae;const{currentTrackId:ye,levels:ve}=this,{details:be,id:Ye}=ee;if(!ve){this.warn(`Subtitle tracks were reset while loading level ${Ye}`);return}const Ke=ve[ye];if(Ye>=ve.length||Ye!==ye||!Ke)return;this.log(`Subtitle track ${Ye} loaded [${be.startSN},${be.endSN}]${be.lastPartSn?`[part-${be.lastPartSn}-${be.lastPartIndex}]`:""},duration:${be.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let Xe=0;if(be.live||(ae=Ke.details)!=null&&ae.live){const rt=this.mainDetails;if(be.deltaUpdateFailed||!rt)return;const nt=rt.fragments[0];if(!Ke.details)be.hasProgramDateTime&&rt.hasProgramDateTime?(alignMediaPlaylistByPDT(be,rt),Xe=be.fragments[0].start):nt&&(Xe=nt.start,addSliding(be,Xe));else{var Je;Xe=this.alignPlaylists(be,Ke.details,(Je=this.levelLastLoaded)==null?void 0:Je.details),Xe===0&&nt&&(Xe=nt.start,addSliding(be,Xe))}}Ke.details=be,this.levelLastLoaded=Ke,!this.startFragRequested&&(this.mainDetails||!be.live)&&this.setStartPosition(Ke.details,Xe),this.tick(),be.live&&!this.fragCurrent&&this.media&&this.state===State.IDLE&&(findFragmentByPTS(null,be.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),Ke.details=void 0))}_handleFragmentLoadComplete(Z){const{frag:ee,payload:ae}=Z,ye=ee.decryptdata,ve=this.hls;if(!this.fragContextChanged(ee)&&ae&&ae.byteLength>0&&ye!=null&&ye.key&&ye.iv&&ye.method==="AES-128"){const be=performance.now();this.decrypter.decrypt(new Uint8Array(ae),ye.key.buffer,ye.iv.buffer).catch(Ye=>{throw ve.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!1,error:Ye,reason:Ye.message,frag:ee}),Ye}).then(Ye=>{const Ke=performance.now();ve.trigger(Events.FRAG_DECRYPTED,{frag:ee,payload:Ye,stats:{tstart:be,tdecrypt:Ke}})}).catch(Ye=>{this.warn(`${Ye.name}: ${Ye.message}`),this.state=State.IDLE})}}doTick(){if(!this.media){this.state=State.IDLE;return}if(this.state===State.IDLE){const{currentTrackId:Z,levels:ee}=this,ae=ee==null?void 0:ee[Z];if(!ae||!ee.length||!ae.details)return;const{config:ye}=this,ve=this.getLoadPosition(),be=BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],ve,ye.maxBufferHole),{end:Ye,len:Ke}=be,Xe=this.getFwdBufferInfo(this.media,PlaylistLevelType.MAIN),Je=ae.details,rt=this.getMaxBufferLength(Xe==null?void 0:Xe.len)+Je.levelTargetDuration;if(Ke>rt)return;const nt=Je.fragments,it=nt.length,lt=Je.edge;let ct=null;const ot=this.fragPrevious;if(Ye<lt){const dt=ye.maxFragLookUpTolerance,ft=Ye>lt-dt?0:dt;ct=findFragmentByPTS(ot,nt,Math.max(nt[0].start,Ye),ft),!ct&&ot&&ot.start<nt[0].start&&(ct=nt[0])}else ct=nt[it-1];if(!ct)return;if(ct=this.mapToInitFragWhenRequired(ct),ct.sn!=="initSegment"){const dt=ct.sn-Je.startSN,ft=nt[dt-1];ft&&ft.cc===ct.cc&&this.fragmentTracker.getState(ft)===FragmentState.NOT_LOADED&&(ct=ft)}this.fragmentTracker.getState(ct)===FragmentState.NOT_LOADED&&this.loadFragment(ct,ae,Ye)}}getMaxBufferLength(Z){const ee=super.getMaxBufferLength();return Z?Math.max(ee,Z):ee}loadFragment(Z,ee,ae){this.fragCurrent=Z,Z.sn==="initSegment"?this._loadInitSegment(Z,ee):(this.startFragRequested=!0,super.loadFragment(Z,ee,ae))}get mediaBufferTimeRanges(){return new BufferableInstance(this.tracksBuffered[this.currentTrackId]||[])}}class BufferableInstance{constructor(Z){this.buffered=void 0;const ee=(ae,ye,ve)=>{if(ye=ye>>>0,ye>ve-1)throw new DOMException(`Failed to execute '${ae}' on 'TimeRanges': The index provided (${ye}) is greater than the maximum bound (${ve})`);return Z[ye][ae]};this.buffered={get length(){return Z.length},end(ae){return ee("end",ae,Z.length)},start(ae){return ee("start",ae,Z.length)}}}}class SubtitleTrackController extends BasePlaylistController{constructor(Z){super(Z,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let ee=null;const ae=filterSubtitleTracks(this.media.textTracks);for(let ve=0;ve<ae.length;ve++)if(ae[ve].mode==="hidden")ee=ae[ve];else if(ae[ve].mode==="showing"){ee=ae[ve];break}const ye=this.findTrackForTextTrack(ee);this.subtitleTrack!==ye&&this.setSubtitleTrack(ye)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(Z){this._subtitleDisplay=Z,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:Z}=this;Z.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),Z.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),Z.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),Z.on(Events.LEVEL_LOADING,this.onLevelLoading,this),Z.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),Z.on(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),Z.on(Events.ERROR,this.onError,this)}unregisterListeners(){const{hls:Z}=this;Z.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),Z.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),Z.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),Z.off(Events.LEVEL_LOADING,this.onLevelLoading,this),Z.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),Z.off(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),Z.off(Events.ERROR,this.onError,this)}onMediaAttached(Z,ee){this.media=ee.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(Z){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,Z)}onMediaDetaching(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),filterSubtitleTracks(this.media.textTracks).forEach(Z=>{clearCurrentCues(Z)}),this.subtitleTrack=-1,this.media=null)}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(Z,ee){this.tracks=ee.subtitleTracks}onSubtitleTrackLoaded(Z,ee){const{id:ae,groupId:ye,details:ve}=ee,be=this.tracksInGroup[ae];if(!be||be.groupId!==ye){this.warn(`Subtitle track with id:${ae} and group:${ye} not found in active group ${be==null?void 0:be.groupId}`);return}const Ye=be.details;be.details=ee.details,this.log(`Subtitle track ${ae} "${be.name}" lang:${be.lang} group:${ye} loaded [${ve.startSN}-${ve.endSN}]`),ae===this.trackId&&this.playlistLoaded(ae,ee,Ye)}onLevelLoading(Z,ee){this.switchLevel(ee.level)}onLevelSwitching(Z,ee){this.switchLevel(ee.level)}switchLevel(Z){const ee=this.hls.levels[Z];if(!ee)return;const ae=ee.subtitleGroups||null,ye=this.groupIds;let ve=this.currentTrack;if(!ae||(ye==null?void 0:ye.length)!==(ae==null?void 0:ae.length)||ae!=null&&ae.some(be=>(ye==null?void 0:ye.indexOf(be))===-1)){this.groupIds=ae,this.trackId=-1,this.currentTrack=null;const be=this.tracks.filter(Je=>!ae||ae.indexOf(Je.groupId)!==-1);if(be.length)this.selectDefaultTrack&&!be.some(Je=>Je.default)&&(this.selectDefaultTrack=!1),be.forEach((Je,rt)=>{Je.id=rt});else if(!ve&&!this.tracksInGroup.length)return;this.tracksInGroup=be;const Ye=this.hls.config.subtitlePreference;if(!ve&&Ye){this.selectDefaultTrack=!1;const Je=findMatchingOption(Ye,be);if(Je>-1)ve=be[Je];else{const rt=findMatchingOption(Ye,this.tracks);ve=this.tracks[rt]}}let Ke=this.findTrackId(ve);Ke===-1&&ve&&(Ke=this.findTrackId(null));const Xe={subtitleTracks:be};this.log(`Updating subtitle tracks, ${be.length} track(s) found in "${ae==null?void 0:ae.join(",")}" group-id`),this.hls.trigger(Events.SUBTITLE_TRACKS_UPDATED,Xe),Ke!==-1&&this.trackId===-1&&this.setSubtitleTrack(Ke)}else this.shouldReloadPlaylist(ve)&&this.setSubtitleTrack(this.trackId)}findTrackId(Z){const ee=this.tracksInGroup,ae=this.selectDefaultTrack;for(let ye=0;ye<ee.length;ye++){const ve=ee[ye];if(!(ae&&!ve.default||!ae&&!Z)&&(!Z||matchesOption(ve,Z)))return ye}if(Z){for(let ye=0;ye<ee.length;ye++){const ve=ee[ye];if(mediaAttributesIdentical(Z.attrs,ve.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return ye}for(let ye=0;ye<ee.length;ye++){const ve=ee[ye];if(mediaAttributesIdentical(Z.attrs,ve.attrs,["LANGUAGE"]))return ye}}return-1}findTrackForTextTrack(Z){if(Z){const ee=this.tracksInGroup;for(let ae=0;ae<ee.length;ae++){const ye=ee[ae];if(subtitleTrackMatchesTextTrack(ye,Z))return ae}}return-1}onError(Z,ee){ee.fatal||!ee.context||ee.context.type===PlaylistContextType.SUBTITLE_TRACK&&ee.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(ee.context.groupId)!==-1)&&this.checkRetry(ee)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(Z){this.selectDefaultTrack=!1,this.setSubtitleTrack(Z)}setSubtitleOption(Z){if(this.hls.config.subtitlePreference=Z,Z){const ee=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,ee.length){const ae=this.currentTrack;if(ae&&matchesOption(Z,ae))return ae;const ye=findMatchingOption(Z,this.tracksInGroup);if(ye>-1){const ve=this.tracksInGroup[ye];return this.setSubtitleTrack(ye),ve}else{if(ae)return null;{const ve=findMatchingOption(Z,ee);if(ve>-1)return ee[ve]}}}}return null}loadPlaylist(Z){super.loadPlaylist();const ee=this.currentTrack;if(this.shouldLoadPlaylist(ee)&&ee){const ae=ee.id,ye=ee.groupId;let ve=ee.url;if(Z)try{ve=Z.addDirectives(ve)}catch(be){this.warn(`Could not construct new URL with HLS Delivery Directives: ${be}`)}this.log(`Loading subtitle playlist for id ${ae}`),this.hls.trigger(Events.SUBTITLE_TRACK_LOADING,{url:ve,id:ae,groupId:ye,deliveryDirectives:Z||null})}}toggleTrackModes(){const{media:Z}=this;if(!Z)return;const ee=filterSubtitleTracks(Z.textTracks),ae=this.currentTrack;let ye;if(ae&&(ye=ee.filter(ve=>subtitleTrackMatchesTextTrack(ae,ve))[0],ye||this.warn(`Unable to find subtitle TextTrack with name "${ae.name}" and language "${ae.lang}"`)),[].slice.call(ee).forEach(ve=>{ve.mode!=="disabled"&&ve!==ye&&(ve.mode="disabled")}),ye){const ve=this.subtitleDisplay?"showing":"hidden";ye.mode!==ve&&(ye.mode=ve)}}setSubtitleTrack(Z){const ee=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=Z;return}if(Z<-1||Z>=ee.length||!isFiniteNumber(Z)){this.warn(`Invalid subtitle track id: ${Z}`);return}this.clearTimer(),this.selectDefaultTrack=!1;const ae=this.currentTrack,ye=ee[Z]||null;if(this.trackId=Z,this.currentTrack=ye,this.toggleTrackModes(),!ye){this.hls.trigger(Events.SUBTITLE_TRACK_SWITCH,{id:Z});return}const ve=!!ye.details&&!ye.details.live;if(Z===this.trackId&&ye===ae&&ve)return;this.log(`Switching to subtitle-track ${Z}`+(ye?` "${ye.name}" lang:${ye.lang} group:${ye.groupId}`:""));const{id:be,groupId:Ye="",name:Ke,type:Xe,url:Je}=ye;this.hls.trigger(Events.SUBTITLE_TRACK_SWITCH,{id:be,groupId:Ye,name:Ke,type:Xe,url:Je});const rt=this.switchParams(ye.url,ae==null?void 0:ae.details);this.loadPlaylist(rt)}}class BufferOperationQueue{constructor(Z){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=Z}append(Z,ee,ae){const ye=this.queues[ee];ye.push(Z),ye.length===1&&!ae&&this.executeNext(ee)}insertAbort(Z,ee){this.queues[ee].unshift(Z),this.executeNext(ee)}appendBlocker(Z){let ee;const ae=new Promise(ve=>{ee=ve}),ye={execute:ee,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(ye,Z),ae}executeNext(Z){const ee=this.queues[Z];if(ee.length){const ae=ee[0];try{ae.execute()}catch(ye){logger.warn(`[buffer-operation-queue]: Exception executing "${Z}" SourceBuffer operation: ${ye}`),ae.onError(ye);const ve=this.buffers[Z];ve!=null&&ve.updating||this.shiftAndExecuteNext(Z)}}}shiftAndExecuteNext(Z){this.queues[Z].shift(),this.executeNext(Z)}current(Z){return this.queues[Z][0]}}const VIDEO_CODEC_PROFILE_REPLACE=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/;class BufferController{constructor(Z){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendSource=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this.log=void 0,this.warn=void 0,this.error=void 0,this._onEndStreaming=ae=>{this.hls&&this.hls.pauseBuffering()},this._onStartStreaming=ae=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=()=>{const{media:ae,mediaSource:ye}=this;this.log("Media source opened"),ae&&(ae.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(Events.MEDIA_ATTACHED,{media:ae,mediaSource:ye})),ye&&ye.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:ae,_objectUrl:ye}=this;ae!==ye&&logger.error(`Media element src was set while attaching MediaSource (${ye} > ${ae})`)},this.hls=Z;const ee="[buffer-controller]";this.appendSource=Z.config.preferManagedMediaSource,this.log=logger.log.bind(logger,ee),this.warn=logger.warn.bind(logger,ee),this.error=logger.error.bind(logger,ee),this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null,this.hls=null}registerListeners(){const{hls:Z}=this;Z.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),Z.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),Z.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),Z.on(Events.BUFFER_RESET,this.onBufferReset,this),Z.on(Events.BUFFER_APPENDING,this.onBufferAppending,this),Z.on(Events.BUFFER_CODECS,this.onBufferCodecs,this),Z.on(Events.BUFFER_EOS,this.onBufferEos,this),Z.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),Z.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this),Z.on(Events.FRAG_PARSED,this.onFragParsed,this),Z.on(Events.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:Z}=this;Z.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),Z.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),Z.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),Z.off(Events.BUFFER_RESET,this.onBufferReset,this),Z.off(Events.BUFFER_APPENDING,this.onBufferAppending,this),Z.off(Events.BUFFER_CODECS,this.onBufferCodecs,this),Z.off(Events.BUFFER_EOS,this.onBufferEos,this),Z.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),Z.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this),Z.off(Events.FRAG_PARSED,this.onFragParsed,this),Z.off(Events.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new BufferOperationQueue(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.appendErrors={audio:0,video:0,audiovideo:0},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(Z,ee){let ae=2;(ee.audio&&!ee.video||!ee.altAudio)&&(ae=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=ae,this.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(Z,ee){const ae=this.media=ee.media,ye=getMediaSource(this.appendSource);if(ae&&ye){var ve;const be=this.mediaSource=new ye;this.log(`created media source: ${(ve=be.constructor)==null?void 0:ve.name}`),be.addEventListener("sourceopen",this._onMediaSourceOpen),be.addEventListener("sourceended",this._onMediaSourceEnded),be.addEventListener("sourceclose",this._onMediaSourceClose),be.addEventListener("startstreaming",this._onStartStreaming),be.addEventListener("endstreaming",this._onEndStreaming);const Ye=this._objectUrl=self.URL.createObjectURL(be);if(this.appendSource)try{ae.removeAttribute("src");const Ke=self.ManagedMediaSource;ae.disableRemotePlayback=ae.disableRemotePlayback||Ke&&be instanceof Ke,removeSourceChildren(ae),addSource(ae,Ye),ae.load()}catch{ae.src=Ye}else ae.src=Ye;ae.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:Z,mediaSource:ee,_objectUrl:ae}=this;if(ee){if(this.log("media source detaching"),ee.readyState==="open")try{ee.endOfStream()}catch(ye){this.warn(`onMediaDetaching: ${ye.message} while calling endOfStream`)}this.onBufferReset(),ee.removeEventListener("sourceopen",this._onMediaSourceOpen),ee.removeEventListener("sourceended",this._onMediaSourceEnded),ee.removeEventListener("sourceclose",this._onMediaSourceClose),ee.removeEventListener("startstreaming",this._onStartStreaming),ee.removeEventListener("endstreaming",this._onEndStreaming),Z&&(Z.removeEventListener("emptied",this._onMediaEmptied),ae&&self.URL.revokeObjectURL(ae),this.mediaSrc===ae?(Z.removeAttribute("src"),this.appendSource&&removeSourceChildren(Z),Z.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(Events.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(Z=>{this.resetBuffer(Z)}),this._initSourceBuffer()}resetBuffer(Z){const ee=this.sourceBuffer[Z];try{if(ee){var ae;this.removeBufferListeners(Z),this.sourceBuffer[Z]=void 0,(ae=this.mediaSource)!=null&&ae.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(ee)}}catch(ye){this.warn(`onBufferReset ${Z}`,ye)}}onBufferCodecs(Z,ee){const ae=this.getSourceBufferTypes().length,ye=Object.keys(ee);if(ye.forEach(be=>{if(ae){const Ke=this.tracks[be];if(Ke&&typeof Ke.buffer.changeType=="function"){var Ye;const{id:Xe,codec:Je,levelCodec:rt,container:nt,metadata:it}=ee[be],lt=pickMostCompleteCodecName(Ke.codec,Ke.levelCodec),ct=lt==null?void 0:lt.replace(VIDEO_CODEC_PROFILE_REPLACE,"$1");let ot=pickMostCompleteCodecName(Je,rt);const dt=(Ye=ot)==null?void 0:Ye.replace(VIDEO_CODEC_PROFILE_REPLACE,"$1");if(ot&&ct!==dt){be.slice(0,5)==="audio"&&(ot=getCodecCompatibleName(ot,this.hls.config.preferManagedMediaSource));const ft=`${nt};codecs=${ot}`;this.appendChangeType(be,ft),this.log(`switching codec ${lt} to ${ot}`),this.tracks[be]={buffer:Ke.buffer,codec:Je,container:nt,levelCodec:rt,metadata:it,id:Xe}}}}else this.pendingTracks[be]=ee[be]}),ae)return;const ve=Math.max(this.bufferCodecEventsExpected-1,0);this.bufferCodecEventsExpected!==ve&&(this.log(`${ve} bufferCodec event(s) expected ${ye.join(",")}`),this.bufferCodecEventsExpected=ve),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks()}appendChangeType(Z,ee){const{operationQueue:ae}=this,ye={execute:()=>{const ve=this.sourceBuffer[Z];ve&&(this.log(`changing ${Z} sourceBuffer type to ${ee}`),ve.changeType(ee)),ae.shiftAndExecuteNext(Z)},onStart:()=>{},onComplete:()=>{},onError:ve=>{this.warn(`Failed to change ${Z} SourceBuffer type`,ve)}};ae.append(ye,Z,!!this.pendingTracks[Z])}onBufferAppending(Z,ee){const{hls:ae,operationQueue:ye,tracks:ve}=this,{data:be,type:Ye,frag:Ke,part:Xe,chunkMeta:Je}=ee,rt=Je.buffering[Ye],nt=self.performance.now();rt.start=nt;const it=Ke.stats.buffering,lt=Xe?Xe.stats.buffering:null;it.start===0&&(it.start=nt),lt&&lt.start===0&&(lt.start=nt);const ct=ve.audio;let ot=!1;Ye==="audio"&&(ct==null?void 0:ct.container)==="audio/mpeg"&&(ot=!this.lastMpegAudioChunk||Je.id===1||this.lastMpegAudioChunk.sn!==Je.sn,this.lastMpegAudioChunk=Je);const dt=Ke.start,ft={execute:()=>{if(rt.executeStart=self.performance.now(),ot){const gt=this.sourceBuffer[Ye];if(gt){const mt=dt-gt.timestampOffset;Math.abs(mt)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${dt} (delta: ${mt}) sn: ${Ke.sn})`),gt.timestampOffset=dt)}}this.appendExecutor(be,Ye)},onStart:()=>{},onComplete:()=>{const gt=self.performance.now();rt.executeEnd=rt.end=gt,it.first===0&&(it.first=gt),lt&&lt.first===0&&(lt.first=gt);const{sourceBuffer:mt}=this,Yr={};for(const Qr in mt)Yr[Qr]=BufferHelper.getBuffered(mt[Qr]);this.appendErrors[Ye]=0,Ye==="audio"||Ye==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(Events.BUFFER_APPENDED,{type:Ye,frag:Ke,part:Xe,chunkMeta:Je,parent:Ke.type,timeRanges:Yr})},onError:gt=>{const mt={type:ErrorTypes.MEDIA_ERROR,parent:Ke.type,details:ErrorDetails.BUFFER_APPEND_ERROR,sourceBufferName:Ye,frag:Ke,part:Xe,chunkMeta:Je,error:gt,err:gt,fatal:!1};if(gt.code===DOMException.QUOTA_EXCEEDED_ERR)mt.details=ErrorDetails.BUFFER_FULL_ERROR;else{const Yr=++this.appendErrors[Ye];mt.details=ErrorDetails.BUFFER_APPEND_ERROR,this.warn(`Failed ${Yr}/${ae.config.appendErrorMaxRetry} times to append segment in "${Ye}" sourceBuffer`),Yr>=ae.config.appendErrorMaxRetry&&(mt.fatal=!0)}ae.trigger(Events.ERROR,mt)}};ye.append(ft,Ye,!!this.pendingTracks[Ye])}onBufferFlushing(Z,ee){const{operationQueue:ae}=this,ye=ve=>({execute:this.removeExecutor.bind(this,ve,ee.startOffset,ee.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(Events.BUFFER_FLUSHED,{type:ve})},onError:be=>{this.warn(`Failed to remove from ${ve} SourceBuffer`,be)}});ee.type?ae.append(ye(ee.type),ee.type):this.getSourceBufferTypes().forEach(ve=>{ae.append(ye(ve),ve)})}onFragParsed(Z,ee){const{frag:ae,part:ye}=ee,ve=[],be=ye?ye.elementaryStreams:ae.elementaryStreams;be[ElementaryStreamTypes.AUDIOVIDEO]?ve.push("audiovideo"):(be[ElementaryStreamTypes.AUDIO]&&ve.push("audio"),be[ElementaryStreamTypes.VIDEO]&&ve.push("video"));const Ye=()=>{const Ke=self.performance.now();ae.stats.buffering.end=Ke,ye&&(ye.stats.buffering.end=Ke);const Xe=ye?ye.stats:ae.stats;this.hls.trigger(Events.FRAG_BUFFERED,{frag:ae,part:ye,stats:Xe,id:ae.type})};ve.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${ae.type} level: ${ae.level} sn: ${ae.sn}`),this.blockBuffers(Ye,ve)}onFragChanged(Z,ee){this.trimBuffers()}onBufferEos(Z,ee){this.getSourceBufferTypes().reduce((ae,ye)=>{const ve=this.sourceBuffer[ye];return ve&&(!ee.type||ee.type===ye)&&(ve.ending=!0,ve.ended||(ve.ended=!0,this.log(`${ye} sourceBuffer now EOS`))),ae&&!!(!ve||ve.ended)},!0)&&(this.log("Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(ye=>{const ve=this.sourceBuffer[ye];ve&&(ve.ending=!1)});const{mediaSource:ae}=this;if(!ae||ae.readyState!=="open"){ae&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${ae.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),ae.endOfStream()}))}onLevelUpdated(Z,{details:ee}){ee.fragments.length&&(this.details=ee,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}trimBuffers(){const{hls:Z,details:ee,media:ae}=this;if(!ae||ee===null||!this.getSourceBufferTypes().length)return;const ye=Z.config,ve=ae.currentTime,be=ee.levelTargetDuration,Ye=ee.live&&ye.liveBackBufferLength!==null?ye.liveBackBufferLength:ye.backBufferLength;if(isFiniteNumber(Ye)&&Ye>0){const Ke=Math.max(Ye,be),Xe=Math.floor(ve/be)*be-Ke;this.flushBackBuffer(ve,be,Xe)}if(isFiniteNumber(ye.frontBufferFlushThreshold)&&ye.frontBufferFlushThreshold>0){const Ke=Math.max(ye.maxBufferLength,ye.frontBufferFlushThreshold),Xe=Math.max(Ke,be),Je=Math.floor(ve/be)*be+Xe;this.flushFrontBuffer(ve,be,Je)}}flushBackBuffer(Z,ee,ae){const{details:ye,sourceBuffer:ve}=this;this.getSourceBufferTypes().forEach(be=>{const Ye=ve[be];if(Ye){const Ke=BufferHelper.getBuffered(Ye);if(Ke.length>0&&ae>Ke.start(0)){if(this.hls.trigger(Events.BACK_BUFFER_REACHED,{bufferEnd:ae}),ye!=null&&ye.live)this.hls.trigger(Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:ae});else if(Ye.ended&&Ke.end(Ke.length-1)-Z<ee*2){this.log(`Cannot flush ${be} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(Events.BUFFER_FLUSHING,{startOffset:0,endOffset:ae,type:be})}}})}flushFrontBuffer(Z,ee,ae){const{sourceBuffer:ye}=this;this.getSourceBufferTypes().forEach(ve=>{const be=ye[ve];if(be){const Ye=BufferHelper.getBuffered(be),Ke=Ye.length;if(Ke<2)return;const Xe=Ye.start(Ke-1),Je=Ye.end(Ke-1);if(ae>Xe||Z>=Xe&&Z<=Je)return;if(be.ended&&Z-Je<2*ee){this.log(`Cannot flush ${ve} front buffer while SourceBuffer is in ended state`);return}this.hls.trigger(Events.BUFFER_FLUSHING,{startOffset:Xe,endOffset:1/0,type:ve})}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")return;const{details:Z,hls:ee,media:ae,mediaSource:ye}=this,ve=Z.fragments[0].start+Z.totalduration,be=ae.duration,Ye=isFiniteNumber(ye.duration)?ye.duration:0;Z.live&&ee.config.liveDurationInfinity?(ye.duration=1/0,this.updateSeekableRange(Z)):(ve>Ye&&ve>be||!isFiniteNumber(be))&&(this.log(`Updating Media Source duration to ${ve.toFixed(3)}`),ye.duration=ve)}updateSeekableRange(Z){const ee=this.mediaSource,ae=Z.fragments;if(ae.length&&Z.live&&ee!=null&&ee.setLiveSeekableRange){const ye=Math.max(0,ae[0].start),ve=Math.max(ye,ye+Z.totalduration);this.log(`Media Source duration is set to ${ee.duration}. Setting seekable range to ${ye}-${ve}.`),ee.setLiveSeekableRange(ye,ve)}}checkPendingTracks(){const{bufferCodecEventsExpected:Z,operationQueue:ee,pendingTracks:ae}=this,ye=Object.keys(ae).length;if(ye&&(!Z||ye===2||"audiovideo"in ae)){this.createSourceBuffers(ae),this.pendingTracks={};const ve=this.getSourceBufferTypes();if(ve.length)this.hls.trigger(Events.BUFFER_CREATED,{tracks:this.tracks}),ve.forEach(be=>{ee.executeNext(be)});else{const be=new Error("could not create source buffer for media codec(s)");this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:be,reason:be.message})}}}createSourceBuffers(Z){const{sourceBuffer:ee,mediaSource:ae}=this;if(!ae)throw Error("createSourceBuffers called when mediaSource was null");for(const ye in Z)if(!ee[ye]){const ve=Z[ye];if(!ve)throw Error(`source buffer exists for track ${ye}, however track does not`);let be=ve.levelCodec||ve.codec;be&&ye.slice(0,5)==="audio"&&(be=getCodecCompatibleName(be,this.hls.config.preferManagedMediaSource));const Ye=`${ve.container};codecs=${be}`;this.log(`creating sourceBuffer(${Ye})`);try{const Ke=ee[ye]=ae.addSourceBuffer(Ye),Xe=ye;this.addBufferListener(Xe,"updatestart",this._onSBUpdateStart),this.addBufferListener(Xe,"updateend",this._onSBUpdateEnd),this.addBufferListener(Xe,"error",this._onSBUpdateError),this.addBufferListener(Xe,"bufferedchange",(Je,rt)=>{const nt=rt.removedRanges;nt!=null&&nt.length&&this.hls.trigger(Events.BUFFER_FLUSHED,{type:ye})}),this.tracks[ye]={buffer:Ke,codec:be,container:ve.container,levelCodec:ve.levelCodec,metadata:ve.metadata,id:ve.id}}catch(Ke){this.error(`error while trying to add sourceBuffer: ${Ke.message}`),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:Ke,sourceBufferName:ye,mimeType:Ye})}}}get mediaSrc(){var Z;const ee=((Z=this.media)==null?void 0:Z.firstChild)||this.media;return ee==null?void 0:ee.src}_onSBUpdateStart(Z){const{operationQueue:ee}=this;ee.current(Z).onStart()}_onSBUpdateEnd(Z){var ee;if(((ee=this.mediaSource)==null?void 0:ee.readyState)==="closed"){this.resetBuffer(Z);return}const{operationQueue:ae}=this;ae.current(Z).onComplete(),ae.shiftAndExecuteNext(Z)}_onSBUpdateError(Z,ee){var ae;const ye=new Error(`${Z} SourceBuffer error. MediaSource readyState: ${(ae=this.mediaSource)==null?void 0:ae.readyState}`);this.error(`${ye}`,ee),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_APPENDING_ERROR,sourceBufferName:Z,error:ye,fatal:!1});const ve=this.operationQueue.current(Z);ve&&ve.onError(ye)}removeExecutor(Z,ee,ae){const{media:ye,mediaSource:ve,operationQueue:be,sourceBuffer:Ye}=this,Ke=Ye[Z];if(!ye||!ve||!Ke){this.warn(`Attempting to remove from the ${Z} SourceBuffer, but it does not exist`),be.shiftAndExecuteNext(Z);return}const Xe=isFiniteNumber(ye.duration)?ye.duration:1/0,Je=isFiniteNumber(ve.duration)?ve.duration:1/0,rt=Math.max(0,ee),nt=Math.min(ae,Xe,Je);nt>rt&&(!Ke.ending||Ke.ended)?(Ke.ended=!1,this.log(`Removing [${rt},${nt}] from the ${Z} SourceBuffer`),Ke.remove(rt,nt)):be.shiftAndExecuteNext(Z)}appendExecutor(Z,ee){const ae=this.sourceBuffer[ee];if(!ae){if(!this.pendingTracks[ee])throw new Error(`Attempting to append to the ${ee} SourceBuffer, but it does not exist`);return}ae.ended=!1,ae.appendBuffer(Z)}blockBuffers(Z,ee=this.getSourceBufferTypes()){if(!ee.length){this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(Z);return}const{operationQueue:ae}=this,ye=ee.map(ve=>ae.appendBlocker(ve));Promise.all(ye).then(()=>{Z(),ee.forEach(ve=>{const be=this.sourceBuffer[ve];be!=null&&be.updating||ae.shiftAndExecuteNext(ve)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(Z,ee,ae){const ye=this.sourceBuffer[Z];if(!ye)return;const ve=ae.bind(this,Z);this.listeners[Z].push({event:ee,listener:ve}),ye.addEventListener(ee,ve)}removeBufferListeners(Z){const ee=this.sourceBuffer[Z];ee&&this.listeners[Z].forEach(ae=>{ee.removeEventListener(ae.event,ae.listener)})}}function removeSourceChildren(ie){const Z=ie.querySelectorAll("source");[].slice.call(Z).forEach(ee=>{ie.removeChild(ee)})}function addSource(ie,Z){const ee=self.document.createElement("source");ee.type="video/mp4",ee.src=Z,ie.appendChild(ee)}const specialCea608CharsCodes={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},getCharForByte=function(ie){let Z=ie;return specialCea608CharsCodes.hasOwnProperty(ie)&&(Z=specialCea608CharsCodes[ie]),String.fromCharCode(Z)},NR_ROWS=15,NR_COLS=100,rowsLowCh1={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},rowsHighCh1={17:2,18:4,21:6,22:8,23:10,19:13,20:15},rowsLowCh2={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},rowsHighCh2={25:2,26:4,29:6,30:8,31:10,27:13,28:15},backgroundColors=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class CaptionsLogger{constructor(){this.time=null,this.verboseLevel=0}log(Z,ee){if(this.verboseLevel>=Z){const ae=typeof ee=="function"?ee():ee;logger.log(`${this.time} [${Z}] ${ae}`)}}}const numArrayToHexArray=function(ie){const Z=[];for(let ee=0;ee<ie.length;ee++)Z.push(ie[ee].toString(16));return Z};class PenState{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(Z){const ee=["foreground","underline","italics","background","flash"];for(let ae=0;ae<ee.length;ae++){const ye=ee[ae];Z.hasOwnProperty(ye)&&(this[ye]=Z[ye])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(Z){return this.foreground===Z.foreground&&this.underline===Z.underline&&this.italics===Z.italics&&this.background===Z.background&&this.flash===Z.flash}copy(Z){this.foreground=Z.foreground,this.underline=Z.underline,this.italics=Z.italics,this.background=Z.background,this.flash=Z.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class StyledUnicodeChar{constructor(){this.uchar=" ",this.penState=new PenState}reset(){this.uchar=" ",this.penState.reset()}setChar(Z,ee){this.uchar=Z,this.penState.copy(ee)}setPenState(Z){this.penState.copy(Z)}equals(Z){return this.uchar===Z.uchar&&this.penState.equals(Z.penState)}copy(Z){this.uchar=Z.uchar,this.penState.copy(Z.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class Row{constructor(Z){this.chars=[],this.pos=0,this.currPenState=new PenState,this.cueStartTime=null,this.logger=void 0;for(let ee=0;ee<NR_COLS;ee++)this.chars.push(new StyledUnicodeChar);this.logger=Z}equals(Z){for(let ee=0;ee<NR_COLS;ee++)if(!this.chars[ee].equals(Z.chars[ee]))return!1;return!0}copy(Z){for(let ee=0;ee<NR_COLS;ee++)this.chars[ee].copy(Z.chars[ee])}isEmpty(){let Z=!0;for(let ee=0;ee<NR_COLS;ee++)if(!this.chars[ee].isEmpty()){Z=!1;break}return Z}setCursor(Z){this.pos!==Z&&(this.pos=Z),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>NR_COLS&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=NR_COLS)}moveCursor(Z){const ee=this.pos+Z;if(Z>1)for(let ae=this.pos+1;ae<ee+1;ae++)this.chars[ae].setPenState(this.currPenState);this.setCursor(ee)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(Z){Z>=144&&this.backSpace();const ee=getCharForByte(Z);if(this.pos>=NR_COLS){this.logger.log(0,()=>"Cannot insert "+Z.toString(16)+" ("+ee+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(ee,this.currPenState),this.moveCursor(1)}clearFromPos(Z){let ee;for(ee=Z;ee<NR_COLS;ee++)this.chars[ee].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const Z=[];let ee=!0;for(let ae=0;ae<NR_COLS;ae++){const ye=this.chars[ae].uchar;ye!==" "&&(ee=!1),Z.push(ye)}return ee?"":Z.join("")}setPenStyles(Z){this.currPenState.setStyles(Z),this.chars[this.pos].setPenState(this.currPenState)}}class CaptionScreen{constructor(Z){this.rows=[],this.currRow=NR_ROWS-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let ee=0;ee<NR_ROWS;ee++)this.rows.push(new Row(Z));this.logger=Z}reset(){for(let Z=0;Z<NR_ROWS;Z++)this.rows[Z].clear();this.currRow=NR_ROWS-1}equals(Z){let ee=!0;for(let ae=0;ae<NR_ROWS;ae++)if(!this.rows[ae].equals(Z.rows[ae])){ee=!1;break}return ee}copy(Z){for(let ee=0;ee<NR_ROWS;ee++)this.rows[ee].copy(Z.rows[ee])}isEmpty(){let Z=!0;for(let ee=0;ee<NR_ROWS;ee++)if(!this.rows[ee].isEmpty()){Z=!1;break}return Z}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(Z){this.rows[this.currRow].insertChar(Z)}setPen(Z){this.rows[this.currRow].setPenStyles(Z)}moveCursor(Z){this.rows[this.currRow].moveCursor(Z)}setCursor(Z){this.logger.log(2,"setCursor: "+Z),this.rows[this.currRow].setCursor(Z)}setPAC(Z){this.logger.log(2,()=>"pacData = "+JSON.stringify(Z));let ee=Z.row-1;if(this.nrRollUpRows&&ee<this.nrRollUpRows-1&&(ee=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==ee){for(let Ye=0;Ye<NR_ROWS;Ye++)this.rows[Ye].clear();const ve=this.currRow+1-this.nrRollUpRows,be=this.lastOutputScreen;if(be){const Ye=be.rows[ve].cueStartTime,Ke=this.logger.time;if(Ye!==null&&Ke!==null&&Ye<Ke)for(let Xe=0;Xe<this.nrRollUpRows;Xe++)this.rows[ee-this.nrRollUpRows+Xe+1].copy(be.rows[ve+Xe])}}this.currRow=ee;const ae=this.rows[this.currRow];if(Z.indent!==null){const ve=Z.indent,be=Math.max(ve-1,0);ae.setCursor(Z.indent),Z.color=ae.chars[be].penState.foreground}const ye={foreground:Z.color,underline:Z.underline,italics:Z.italics,background:"black",flash:!1};this.setPen(ye)}setBkgData(Z){this.logger.log(2,()=>"bkgData = "+JSON.stringify(Z)),this.backSpace(),this.setPen(Z),this.insertChar(32)}setRollUpRows(Z){this.nrRollUpRows=Z}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const Z=this.currRow+1-this.nrRollUpRows,ee=this.rows.splice(Z,1)[0];ee.clear(),this.rows.splice(this.currRow,0,ee),this.logger.log(2,"Rolling up")}getDisplayText(Z){Z=Z||!1;const ee=[];let ae="",ye=-1;for(let ve=0;ve<NR_ROWS;ve++){const be=this.rows[ve].getTextString();be&&(ye=ve+1,Z?ee.push("Row "+ye+": '"+be+"'"):ee.push(be.trim()))}return ee.length>0&&(Z?ae="["+ee.join(" | ")+"]":ae=ee.join(`
`)),ae}getTextAndFormat(){return this.rows}}class Cea608Channel{constructor(Z,ee,ae){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=Z,this.outputFilter=ee,this.mode=null,this.verbose=0,this.displayedMemory=new CaptionScreen(ae),this.nonDisplayedMemory=new CaptionScreen(ae),this.lastOutputScreen=new CaptionScreen(ae),this.currRollUpRow=this.displayedMemory.rows[NR_ROWS-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=ae}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[NR_ROWS-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(Z){this.outputFilter=Z}setPAC(Z){this.writeScreen.setPAC(Z)}setBkgData(Z){this.writeScreen.setBkgData(Z)}setMode(Z){Z!==this.mode&&(this.mode=Z,this.logger.log(2,()=>"MODE="+Z),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=Z)}insertChars(Z){for(let ae=0;ae<Z.length;ae++)this.writeScreen.insertChar(Z[ae]);const ee=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>ee+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(Z){this.logger.log(2,"RU("+Z+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(Z)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const Z=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=Z,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(Z){this.logger.log(2,"TO("+Z+") - Tab Offset"),this.writeScreen.moveCursor(Z)}ccMIDROW(Z){const ee={flash:!1};if(ee.underline=Z%2===1,ee.italics=Z>=46,ee.italics)ee.foreground="white";else{const ae=Math.floor(Z/2)-16,ye=["white","green","blue","cyan","red","yellow","magenta"];ee.foreground=ye[ae]}this.logger.log(2,"MIDROW: "+JSON.stringify(ee)),this.writeScreen.setPen(ee)}outputDataUpdate(Z=!1){const ee=this.logger.time;ee!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=ee:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,ee,this.lastOutputScreen),Z&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:ee),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(Z){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,Z,this.displayedMemory),this.cueStartTime=Z))}}class Cea608Parser{constructor(Z,ee,ae){this.channels=void 0,this.currentChannel=0,this.cmdHistory=createCmdHistory(),this.logger=void 0;const ye=this.logger=new CaptionsLogger;this.channels=[null,new Cea608Channel(Z,ee,ye),new Cea608Channel(Z+1,ae,ye)]}getHandler(Z){return this.channels[Z].getHandler()}setHandler(Z,ee){this.channels[Z].setHandler(ee)}addData(Z,ee){let ae,ye,ve,be=!1;this.logger.time=Z;for(let Ye=0;Ye<ee.length;Ye+=2)if(ye=ee[Ye]&127,ve=ee[Ye+1]&127,!(ye===0&&ve===0)){if(this.logger.log(3,"["+numArrayToHexArray([ee[Ye],ee[Ye+1]])+"] -> ("+numArrayToHexArray([ye,ve])+")"),ae=this.parseCmd(ye,ve),ae||(ae=this.parseMidrow(ye,ve)),ae||(ae=this.parsePAC(ye,ve)),ae||(ae=this.parseBackgroundAttributes(ye,ve)),!ae&&(be=this.parseChars(ye,ve),be)){const Ke=this.currentChannel;Ke&&Ke>0?this.channels[Ke].insertChars(be):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!ae&&!be&&this.logger.log(2,"Couldn't parse cleaned data "+numArrayToHexArray([ye,ve])+" orig: "+numArrayToHexArray([ee[Ye],ee[Ye+1]]))}}parseCmd(Z,ee){const{cmdHistory:ae}=this,ye=(Z===20||Z===28||Z===21||Z===29)&&ee>=32&&ee<=47,ve=(Z===23||Z===31)&&ee>=33&&ee<=35;if(!(ye||ve))return!1;if(hasCmdRepeated(Z,ee,ae))return setLastCmd(null,null,ae),this.logger.log(3,"Repeated command ("+numArrayToHexArray([Z,ee])+") is dropped"),!0;const be=Z===20||Z===21||Z===23?1:2,Ye=this.channels[be];return Z===20||Z===21||Z===28||Z===29?ee===32?Ye.ccRCL():ee===33?Ye.ccBS():ee===34?Ye.ccAOF():ee===35?Ye.ccAON():ee===36?Ye.ccDER():ee===37?Ye.ccRU(2):ee===38?Ye.ccRU(3):ee===39?Ye.ccRU(4):ee===40?Ye.ccFON():ee===41?Ye.ccRDC():ee===42?Ye.ccTR():ee===43?Ye.ccRTD():ee===44?Ye.ccEDM():ee===45?Ye.ccCR():ee===46?Ye.ccENM():ee===47&&Ye.ccEOC():Ye.ccTO(ee-32),setLastCmd(Z,ee,ae),this.currentChannel=be,!0}parseMidrow(Z,ee){let ae=0;if((Z===17||Z===25)&&ee>=32&&ee<=47){if(Z===17?ae=1:ae=2,ae!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const ye=this.channels[ae];return ye?(ye.ccMIDROW(ee),this.logger.log(3,"MIDROW ("+numArrayToHexArray([Z,ee])+")"),!0):!1}return!1}parsePAC(Z,ee){let ae;const ye=this.cmdHistory,ve=(Z>=17&&Z<=23||Z>=25&&Z<=31)&&ee>=64&&ee<=127,be=(Z===16||Z===24)&&ee>=64&&ee<=95;if(!(ve||be))return!1;if(hasCmdRepeated(Z,ee,ye))return setLastCmd(null,null,ye),!0;const Ye=Z<=23?1:2;ee>=64&&ee<=95?ae=Ye===1?rowsLowCh1[Z]:rowsLowCh2[Z]:ae=Ye===1?rowsHighCh1[Z]:rowsHighCh2[Z];const Ke=this.channels[Ye];return Ke?(Ke.setPAC(this.interpretPAC(ae,ee)),setLastCmd(Z,ee,ye),this.currentChannel=Ye,!0):!1}interpretPAC(Z,ee){let ae;const ye={color:null,italics:!1,indent:null,underline:!1,row:Z};return ee>95?ae=ee-96:ae=ee-64,ye.underline=(ae&1)===1,ae<=13?ye.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(ae/2)]:ae<=15?(ye.italics=!0,ye.color="white"):ye.indent=Math.floor((ae-16)/2)*4,ye}parseChars(Z,ee){let ae,ye=null,ve=null;if(Z>=25?(ae=2,ve=Z-8):(ae=1,ve=Z),ve>=17&&ve<=19){let be;ve===17?be=ee+80:ve===18?be=ee+112:be=ee+144,this.logger.log(2,"Special char '"+getCharForByte(be)+"' in channel "+ae),ye=[be]}else Z>=32&&Z<=127&&(ye=ee===0?[Z]:[Z,ee]);if(ye){const be=numArrayToHexArray(ye);this.logger.log(3,"Char codes =  "+be.join(",")),setLastCmd(Z,ee,this.cmdHistory)}return ye}parseBackgroundAttributes(Z,ee){const ae=(Z===16||Z===24)&&ee>=32&&ee<=47,ye=(Z===23||Z===31)&&ee>=45&&ee<=47;if(!(ae||ye))return!1;let ve;const be={};Z===16||Z===24?(ve=Math.floor((ee-32)/2),be.background=backgroundColors[ve],ee%2===1&&(be.background=be.background+"_semi")):ee===45?be.background="transparent":(be.foreground="black",ee===47&&(be.underline=!0));const Ye=Z<=23?1:2;return this.channels[Ye].setBkgData(be),setLastCmd(Z,ee,this.cmdHistory),!0}reset(){for(let Z=0;Z<Object.keys(this.channels).length;Z++){const ee=this.channels[Z];ee&&ee.reset()}this.cmdHistory=createCmdHistory()}cueSplitAtTime(Z){for(let ee=0;ee<this.channels.length;ee++){const ae=this.channels[ee];ae&&ae.cueSplitAtTime(Z)}}}function setLastCmd(ie,Z,ee){ee.a=ie,ee.b=Z}function hasCmdRepeated(ie,Z,ee){return ee.a===ie&&ee.b===Z}function createCmdHistory(){return{a:null,b:null}}class OutputFilter{constructor(Z,ee){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=Z,this.trackName=ee}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(Z,ee,ae){(this.startTime===null||this.startTime>Z)&&(this.startTime=Z),this.endTime=ee,this.screen=ae,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var VTTCue=function(){if(optionalSelf!=null&&optionalSelf.VTTCue)return self.VTTCue;const ie=["","lr","rl"],Z=["start","middle","end","left","right"];function ee(Ye,Ke){if(typeof Ke!="string"||!Array.isArray(Ye))return!1;const Xe=Ke.toLowerCase();return~Ye.indexOf(Xe)?Xe:!1}function ae(Ye){return ee(ie,Ye)}function ye(Ye){return ee(Z,Ye)}function ve(Ye,...Ke){let Xe=1;for(;Xe<arguments.length;Xe++){const Je=arguments[Xe];for(const rt in Je)Ye[rt]=Je[rt]}return Ye}function be(Ye,Ke,Xe){const Je=this,rt={enumerable:!0};Je.hasBeenReset=!1;let nt="",it=!1,lt=Ye,ct=Ke,ot=Xe,dt=null,ft="",gt=!0,mt="auto",Yr="start",Qr=50,Xr="middle",Jr=50,ai="middle";Object.defineProperty(Je,"id",ve({},rt,{get:function(){return nt},set:function(oi){nt=""+oi}})),Object.defineProperty(Je,"pauseOnExit",ve({},rt,{get:function(){return it},set:function(oi){it=!!oi}})),Object.defineProperty(Je,"startTime",ve({},rt,{get:function(){return lt},set:function(oi){if(typeof oi!="number")throw new TypeError("Start time must be set to a number.");lt=oi,this.hasBeenReset=!0}})),Object.defineProperty(Je,"endTime",ve({},rt,{get:function(){return ct},set:function(oi){if(typeof oi!="number")throw new TypeError("End time must be set to a number.");ct=oi,this.hasBeenReset=!0}})),Object.defineProperty(Je,"text",ve({},rt,{get:function(){return ot},set:function(oi){ot=""+oi,this.hasBeenReset=!0}})),Object.defineProperty(Je,"region",ve({},rt,{get:function(){return dt},set:function(oi){dt=oi,this.hasBeenReset=!0}})),Object.defineProperty(Je,"vertical",ve({},rt,{get:function(){return ft},set:function(oi){const ni=ae(oi);if(ni===!1)throw new SyntaxError("An invalid or illegal string was specified.");ft=ni,this.hasBeenReset=!0}})),Object.defineProperty(Je,"snapToLines",ve({},rt,{get:function(){return gt},set:function(oi){gt=!!oi,this.hasBeenReset=!0}})),Object.defineProperty(Je,"line",ve({},rt,{get:function(){return mt},set:function(oi){if(typeof oi!="number"&&oi!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");mt=oi,this.hasBeenReset=!0}})),Object.defineProperty(Je,"lineAlign",ve({},rt,{get:function(){return Yr},set:function(oi){const ni=ye(oi);if(!ni)throw new SyntaxError("An invalid or illegal string was specified.");Yr=ni,this.hasBeenReset=!0}})),Object.defineProperty(Je,"position",ve({},rt,{get:function(){return Qr},set:function(oi){if(oi<0||oi>100)throw new Error("Position must be between 0 and 100.");Qr=oi,this.hasBeenReset=!0}})),Object.defineProperty(Je,"positionAlign",ve({},rt,{get:function(){return Xr},set:function(oi){const ni=ye(oi);if(!ni)throw new SyntaxError("An invalid or illegal string was specified.");Xr=ni,this.hasBeenReset=!0}})),Object.defineProperty(Je,"size",ve({},rt,{get:function(){return Jr},set:function(oi){if(oi<0||oi>100)throw new Error("Size must be between 0 and 100.");Jr=oi,this.hasBeenReset=!0}})),Object.defineProperty(Je,"align",ve({},rt,{get:function(){return ai},set:function(oi){const ni=ye(oi);if(!ni)throw new SyntaxError("An invalid or illegal string was specified.");ai=ni,this.hasBeenReset=!0}})),Je.displayState=void 0}return be.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},be}();class StringDecoder{decode(Z,ee){if(!Z)return"";if(typeof Z!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(Z))}}function parseTimeStamp(ie){function Z(ae,ye,ve,be){return(ae|0)*3600+(ye|0)*60+(ve|0)+parseFloat(be||0)}const ee=ie.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return ee?parseFloat(ee[2])>59?Z(ee[2],ee[3],0,ee[4]):Z(ee[1],ee[2],ee[3],ee[4]):null}class Settings{constructor(){this.values=Object.create(null)}set(Z,ee){!this.get(Z)&&ee!==""&&(this.values[Z]=ee)}get(Z,ee,ae){return ae?this.has(Z)?this.values[Z]:ee[ae]:this.has(Z)?this.values[Z]:ee}has(Z){return Z in this.values}alt(Z,ee,ae){for(let ye=0;ye<ae.length;++ye)if(ee===ae[ye]){this.set(Z,ee);break}}integer(Z,ee){/^-?\d+$/.test(ee)&&this.set(Z,parseInt(ee,10))}percent(Z,ee){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(ee)){const ae=parseFloat(ee);if(ae>=0&&ae<=100)return this.set(Z,ae),!0}return!1}}function parseOptions(ie,Z,ee,ae){const ye=ae?ie.split(ae):[ie];for(const ve in ye){if(typeof ye[ve]!="string")continue;const be=ye[ve].split(ee);if(be.length!==2)continue;const Ye=be[0],Ke=be[1];Z(Ye,Ke)}}const defaults=new VTTCue(0,0,""),center=defaults.align==="middle"?"middle":"center";function parseCue$1(ie,Z,ee){const ae=ie;function ye(){const Ye=parseTimeStamp(ie);if(Ye===null)throw new Error("Malformed timestamp: "+ae);return ie=ie.replace(/^[^\sa-zA-Z-]+/,""),Ye}function ve(Ye,Ke){const Xe=new Settings;parseOptions(Ye,function(nt,it){let lt;switch(nt){case"region":for(let ct=ee.length-1;ct>=0;ct--)if(ee[ct].id===it){Xe.set(nt,ee[ct].region);break}break;case"vertical":Xe.alt(nt,it,["rl","lr"]);break;case"line":lt=it.split(","),Xe.integer(nt,lt[0]),Xe.percent(nt,lt[0])&&Xe.set("snapToLines",!1),Xe.alt(nt,lt[0],["auto"]),lt.length===2&&Xe.alt("lineAlign",lt[1],["start",center,"end"]);break;case"position":lt=it.split(","),Xe.percent(nt,lt[0]),lt.length===2&&Xe.alt("positionAlign",lt[1],["start",center,"end","line-left","line-right","auto"]);break;case"size":Xe.percent(nt,it);break;case"align":Xe.alt(nt,it,["start",center,"end","left","right"]);break}},/:/,/\s/),Ke.region=Xe.get("region",null),Ke.vertical=Xe.get("vertical","");let Je=Xe.get("line","auto");Je==="auto"&&defaults.line===-1&&(Je=-1),Ke.line=Je,Ke.lineAlign=Xe.get("lineAlign","start"),Ke.snapToLines=Xe.get("snapToLines",!0),Ke.size=Xe.get("size",100),Ke.align=Xe.get("align",center);let rt=Xe.get("position","auto");rt==="auto"&&defaults.position===50&&(rt=Ke.align==="start"||Ke.align==="left"?0:Ke.align==="end"||Ke.align==="right"?100:50),Ke.position=rt}function be(){ie=ie.replace(/^\s+/,"")}if(be(),Z.startTime=ye(),be(),ie.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+ae);ie=ie.slice(3),be(),Z.endTime=ye(),be(),ve(ie,Z)}function fixLineBreaks(ie){return ie.replace(/<br(?: \/)?>/gi,`
`)}class VTTParser{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new StringDecoder,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(Z){const ee=this;Z&&(ee.buffer+=ee.decoder.decode(Z,{stream:!0}));function ae(){let ve=ee.buffer,be=0;for(ve=fixLineBreaks(ve);be<ve.length&&ve[be]!=="\r"&&ve[be]!==`
`;)++be;const Ye=ve.slice(0,be);return ve[be]==="\r"&&++be,ve[be]===`
`&&++be,ee.buffer=ve.slice(be),Ye}function ye(ve){parseOptions(ve,function(be,Ye){},/:/)}try{let ve="";if(ee.state==="INITIAL"){if(!/\r\n|\n/.test(ee.buffer))return this;ve=ae();const Ye=ve.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(Ye!=null&&Ye[0]))throw new Error("Malformed WebVTT signature.");ee.state="HEADER"}let be=!1;for(;ee.buffer;){if(!/\r\n|\n/.test(ee.buffer))return this;switch(be?be=!1:ve=ae(),ee.state){case"HEADER":/:/.test(ve)?ye(ve):ve||(ee.state="ID");continue;case"NOTE":ve||(ee.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(ve)){ee.state="NOTE";break}if(!ve)continue;if(ee.cue=new VTTCue(0,0,""),ee.state="CUE",ve.indexOf("-->")===-1){ee.cue.id=ve;continue}case"CUE":if(!ee.cue){ee.state="BADCUE";continue}try{parseCue$1(ve,ee.cue,ee.regionList)}catch{ee.cue=null,ee.state="BADCUE";continue}ee.state="CUETEXT";continue;case"CUETEXT":{const Ye=ve.indexOf("-->")!==-1;if(!ve||Ye&&(be=!0)){ee.oncue&&ee.cue&&ee.oncue(ee.cue),ee.cue=null,ee.state="ID";continue}if(ee.cue===null)continue;ee.cue.text&&(ee.cue.text+=`
`),ee.cue.text+=ve}continue;case"BADCUE":ve||(ee.state="ID")}}}catch{ee.state==="CUETEXT"&&ee.cue&&ee.oncue&&ee.oncue(ee.cue),ee.cue=null,ee.state=ee.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const Z=this;try{if((Z.cue||Z.state==="HEADER")&&(Z.buffer+=`

`,Z.parse()),Z.state==="INITIAL"||Z.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(ee){Z.onparsingerror&&Z.onparsingerror(ee)}return Z.onflush&&Z.onflush(),this}}const LINEBREAKS=/\r\n|\n\r|\n|\r/g,startsWith=function(ie,Z,ee=0){return ie.slice(ee,ee+Z.length)===Z},cueString2millis=function(ie){let Z=parseInt(ie.slice(-3));const ee=parseInt(ie.slice(-6,-4)),ae=parseInt(ie.slice(-9,-7)),ye=ie.length>9?parseInt(ie.substring(0,ie.indexOf(":"))):0;if(!isFiniteNumber(Z)||!isFiniteNumber(ee)||!isFiniteNumber(ae)||!isFiniteNumber(ye))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${ie}`);return Z+=1e3*ee,Z+=60*1e3*ae,Z+=60*60*1e3*ye,Z},hash=function(ie){let Z=5381,ee=ie.length;for(;ee;)Z=Z*33^ie.charCodeAt(--ee);return(Z>>>0).toString()};function generateCueId(ie,Z,ee){return hash(ie.toString())+hash(Z.toString())+hash(ee)}const calculateOffset=function(ie,Z,ee){let ae=ie[Z],ye=ie[ae.prevCC];if(!ye||!ye.new&&ae.new){ie.ccOffset=ie.presentationOffset=ae.start,ae.new=!1;return}for(;(ve=ye)!=null&&ve.new;){var ve;ie.ccOffset+=ae.start-ye.start,ae.new=!1,ae=ye,ye=ie[ae.prevCC]}ie.presentationOffset=ee};function parseWebVTT(ie,Z,ee,ae,ye,ve,be){const Ye=new VTTParser,Ke=utf8ArrayToStr(new Uint8Array(ie)).trim().replace(LINEBREAKS,`
`).split(`
`),Xe=[],Je=Z?toMpegTsClockFromTimescale(Z.baseTime,Z.timescale):0;let rt="00:00.000",nt=0,it=0,lt,ct=!0;Ye.oncue=function(ot){const dt=ee[ae];let ft=ee.ccOffset;const gt=(nt-Je)/9e4;if(dt!=null&&dt.new&&(it!==void 0?ft=ee.ccOffset=dt.start:calculateOffset(ee,ae,gt)),gt){if(!Z){lt=new Error("Missing initPTS for VTT MPEGTS");return}ft=gt-ee.presentationOffset}const mt=ot.endTime-ot.startTime,Yr=normalizePts((ot.startTime+ft-it)*9e4,ye*9e4)/9e4;ot.startTime=Math.max(Yr,0),ot.endTime=Math.max(Yr+mt,0);const Qr=ot.text.trim();ot.text=decodeURIComponent(encodeURIComponent(Qr)),ot.id||(ot.id=generateCueId(ot.startTime,ot.endTime,Qr)),ot.endTime>0&&Xe.push(ot)},Ye.onparsingerror=function(ot){lt=ot},Ye.onflush=function(){if(lt){be(lt);return}ve(Xe)},Ke.forEach(ot=>{if(ct)if(startsWith(ot,"X-TIMESTAMP-MAP=")){ct=!1,ot.slice(16).split(",").forEach(dt=>{startsWith(dt,"LOCAL:")?rt=dt.slice(6):startsWith(dt,"MPEGTS:")&&(nt=parseInt(dt.slice(7)))});try{it=cueString2millis(rt)/1e3}catch(dt){lt=dt}return}else ot===""&&(ct=!1);Ye.parse(ot+`
`)}),Ye.flush()}const IMSC1_CODEC="stpp.ttml.im1t",HMSF_REGEX=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,TIME_UNIT_REGEX=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,textAlignToLineAlign={left:"start",center:"center",right:"end",start:"start",end:"end"};function parseIMSC1(ie,Z,ee,ae){const ye=findBox(new Uint8Array(ie),["mdat"]);if(ye.length===0){ae(new Error("Could not parse IMSC1 mdat"));return}const ve=ye.map(Ye=>utf8ArrayToStr(Ye)),be=toTimescaleFromScale(Z.baseTime,1,Z.timescale);try{ve.forEach(Ye=>ee(parseTTML(Ye,be)))}catch(Ye){ae(Ye)}}function parseTTML(ie,Z){const ee=new DOMParser().parseFromString(ie,"text/xml").getElementsByTagName("tt")[0];if(!ee)throw new Error("Invalid ttml");const ae={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},ye=Object.keys(ae).reduce((Xe,Je)=>(Xe[Je]=ee.getAttribute(`ttp:${Je}`)||ae[Je],Xe),{}),ve=ee.getAttribute("xml:space")!=="preserve",be=collectionToDictionary(getElementCollection(ee,"styling","style")),Ye=collectionToDictionary(getElementCollection(ee,"layout","region")),Ke=getElementCollection(ee,"body","[begin]");return[].map.call(Ke,Xe=>{const Je=getTextContent(Xe,ve);if(!Je||!Xe.hasAttribute("begin"))return null;const rt=parseTtmlTime(Xe.getAttribute("begin"),ye),nt=parseTtmlTime(Xe.getAttribute("dur"),ye);let it=parseTtmlTime(Xe.getAttribute("end"),ye);if(rt===null)throw timestampParsingError(Xe);if(it===null){if(nt===null)throw timestampParsingError(Xe);it=rt+nt}const lt=new VTTCue(rt-Z,it-Z,Je);lt.id=generateCueId(lt.startTime,lt.endTime,lt.text);const ct=Ye[Xe.getAttribute("region")],ot=be[Xe.getAttribute("style")],dt=getTtmlStyles(ct,ot,be),{textAlign:ft}=dt;if(ft){const gt=textAlignToLineAlign[ft];gt&&(lt.lineAlign=gt),lt.align=ft}return _extends(lt,dt),lt}).filter(Xe=>Xe!==null)}function getElementCollection(ie,Z,ee){const ae=ie.getElementsByTagName(Z)[0];return ae?[].slice.call(ae.querySelectorAll(ee)):[]}function collectionToDictionary(ie){return ie.reduce((Z,ee)=>{const ae=ee.getAttribute("xml:id");return ae&&(Z[ae]=ee),Z},{})}function getTextContent(ie,Z){return[].slice.call(ie.childNodes).reduce((ee,ae,ye)=>{var ve;return ae.nodeName==="br"&&ye?ee+`
`:(ve=ae.childNodes)!=null&&ve.length?getTextContent(ae,Z):Z?ee+ae.textContent.trim().replace(/\s+/g," "):ee+ae.textContent},"")}function getTtmlStyles(ie,Z,ee){const ae="http://www.w3.org/ns/ttml#styling";let ye=null;const ve=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],be=ie!=null&&ie.hasAttribute("style")?ie.getAttribute("style"):null;return be&&ee.hasOwnProperty(be)&&(ye=ee[be]),ve.reduce((Ye,Ke)=>{const Xe=getAttributeNS(Z,ae,Ke)||getAttributeNS(ie,ae,Ke)||getAttributeNS(ye,ae,Ke);return Xe&&(Ye[Ke]=Xe),Ye},{})}function getAttributeNS(ie,Z,ee){return ie&&ie.hasAttributeNS(Z,ee)?ie.getAttributeNS(Z,ee):null}function timestampParsingError(ie){return new Error(`Could not parse ttml timestamp ${ie}`)}function parseTtmlTime(ie,Z){if(!ie)return null;let ee=parseTimeStamp(ie);return ee===null&&(HMSF_REGEX.test(ie)?ee=parseHoursMinutesSecondsFrames(ie,Z):TIME_UNIT_REGEX.test(ie)&&(ee=parseTimeUnits(ie,Z))),ee}function parseHoursMinutesSecondsFrames(ie,Z){const ee=HMSF_REGEX.exec(ie),ae=(ee[4]|0)+(ee[5]|0)/Z.subFrameRate;return(ee[1]|0)*3600+(ee[2]|0)*60+(ee[3]|0)+ae/Z.frameRate}function parseTimeUnits(ie,Z){const ee=TIME_UNIT_REGEX.exec(ie),ae=Number(ee[1]);switch(ee[2]){case"h":return ae*3600;case"m":return ae*60;case"ms":return ae*1e3;case"f":return ae/Z.frameRate;case"t":return ae/Z.tickRate}return ae}class TimelineController{constructor(Z){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=newVTTCCs(),this.captionsProperties=void 0,this.hls=Z,this.config=Z.config,this.Cues=Z.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},Z.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),Z.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),Z.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),Z.on(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),Z.on(Events.FRAG_LOADING,this.onFragLoading,this),Z.on(Events.FRAG_LOADED,this.onFragLoaded,this),Z.on(Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),Z.on(Events.FRAG_DECRYPTED,this.onFragDecrypted,this),Z.on(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),Z.on(Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),Z.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:Z}=this;Z.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),Z.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),Z.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),Z.off(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),Z.off(Events.FRAG_LOADING,this.onFragLoading,this),Z.off(Events.FRAG_LOADED,this.onFragLoaded,this),Z.off(Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),Z.off(Events.FRAG_DECRYPTED,this.onFragDecrypted,this),Z.off(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),Z.off(Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),Z.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){if(this.config.enableCEA708Captions&&(!this.cea608Parser1||!this.cea608Parser2)){const Z=new OutputFilter(this,"textTrack1"),ee=new OutputFilter(this,"textTrack2"),ae=new OutputFilter(this,"textTrack3"),ye=new OutputFilter(this,"textTrack4");this.cea608Parser1=new Cea608Parser(1,Z,ee),this.cea608Parser2=new Cea608Parser(3,ae,ye)}}addCues(Z,ee,ae,ye,ve){let be=!1;for(let Ye=ve.length;Ye--;){const Ke=ve[Ye],Xe=intersection(Ke[0],Ke[1],ee,ae);if(Xe>=0&&(Ke[0]=Math.min(Ke[0],ee),Ke[1]=Math.max(Ke[1],ae),be=!0,Xe/(ae-ee)>.5))return}if(be||ve.push([ee,ae]),this.config.renderTextTracksNatively){const Ye=this.captionsTracks[Z];this.Cues.newCue(Ye,ee,ae,ye)}else{const Ye=this.Cues.newCue(null,ee,ae,ye);this.hls.trigger(Events.CUES_PARSED,{type:"captions",cues:Ye,track:Z})}}onInitPtsFound(Z,{frag:ee,id:ae,initPTS:ye,timescale:ve}){const{unparsedVttFrags:be}=this;ae==="main"&&(this.initPTS[ee.cc]={baseTime:ye,timescale:ve}),be.length&&(this.unparsedVttFrags=[],be.forEach(Ye=>{this.onFragLoaded(Events.FRAG_LOADED,Ye)}))}getExistingTrack(Z,ee){const{media:ae}=this;if(ae)for(let ye=0;ye<ae.textTracks.length;ye++){const ve=ae.textTracks[ye];if(canReuseVttTextTrack(ve,{name:Z,lang:ee,attrs:{}}))return ve}return null}createCaptionsTrack(Z){this.config.renderTextTracksNatively?this.createNativeTrack(Z):this.createNonNativeTrack(Z)}createNativeTrack(Z){if(this.captionsTracks[Z])return;const{captionsProperties:ee,captionsTracks:ae,media:ye}=this,{label:ve,languageCode:be}=ee[Z],Ye=this.getExistingTrack(ve,be);if(Ye)ae[Z]=Ye,clearCurrentCues(ae[Z]),sendAddTrackEvent(ae[Z],ye);else{const Ke=this.createTextTrack("captions",ve,be);Ke&&(Ke[Z]=!0,ae[Z]=Ke)}}createNonNativeTrack(Z){if(this.nonNativeCaptionsTracks[Z])return;const ee=this.captionsProperties[Z];if(!ee)return;const ae=ee.label,ye={_id:Z,label:ae,kind:"captions",default:ee.media?!!ee.media.default:!1,closedCaptions:ee.media};this.nonNativeCaptionsTracks[Z]=ye,this.hls.trigger(Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[ye]})}createTextTrack(Z,ee,ae){const ye=this.media;if(ye)return ye.addTextTrack(Z,ee,ae)}onMediaAttaching(Z,ee){this.media=ee.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:Z}=this;Object.keys(Z).forEach(ee=>{clearCurrentCues(Z[ee]),delete Z[ee]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=newVTTCCs(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:Z}=this;if(!Z)return;const ee=Z.textTracks;if(ee)for(let ae=0;ae<ee.length;ae++)clearCurrentCues(ee[ae])}onSubtitleTracksUpdated(Z,ee){const ae=ee.subtitleTracks||[],ye=ae.some(ve=>ve.textCodec===IMSC1_CODEC);if(this.config.enableWebVTT||ye&&this.config.enableIMSC1){if(subtitleOptionsIdentical(this.tracks,ae)){this.tracks=ae;return}if(this.textTracks=[],this.tracks=ae,this.config.renderTextTracksNatively){const ve=this.media,be=ve?filterSubtitleTracks(ve.textTracks):null;if(this.tracks.forEach((Ye,Ke)=>{let Xe;if(be){let Je=null;for(let rt=0;rt<be.length;rt++)if(be[rt]&&canReuseVttTextTrack(be[rt],Ye)){Je=be[rt],be[rt]=null;break}Je&&(Xe=Je)}if(Xe)clearCurrentCues(Xe);else{const Je=captionsOrSubtitlesFromCharacteristics(Ye);Xe=this.createTextTrack(Je,Ye.name,Ye.lang),Xe&&(Xe.mode="disabled")}Xe&&this.textTracks.push(Xe)}),be!=null&&be.length){const Ye=be.filter(Ke=>Ke!==null).map(Ke=>Ke.label);Ye.length&&logger.warn(`Media element contains unused subtitle tracks: ${Ye.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const ve=this.tracks.map(be=>({label:be.name,kind:be.type.toLowerCase(),default:be.default,subtitleTrack:be}));this.hls.trigger(Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:ve})}}}onManifestLoaded(Z,ee){this.config.enableCEA708Captions&&ee.captions&&ee.captions.forEach(ae=>{const ye=/(?:CC|SERVICE)([1-4])/.exec(ae.instreamId);if(!ye)return;const ve=`textTrack${ye[1]}`,be=this.captionsProperties[ve];be&&(be.label=ae.name,ae.lang&&(be.languageCode=ae.lang),be.media=ae)})}closedCaptionsForLevel(Z){const ee=this.hls.levels[Z.level];return ee==null?void 0:ee.attrs["CLOSED-CAPTIONS"]}onFragLoading(Z,ee){this.initCea608Parsers();const{cea608Parser1:ae,cea608Parser2:ye,lastCc:ve,lastSn:be,lastPartIndex:Ye}=this;if(!(!this.enabled||!ae||!ye)&&ee.frag.type===PlaylistLevelType.MAIN){var Ke,Xe;const{cc:Je,sn:rt}=ee.frag,nt=(Ke=ee==null||(Xe=ee.part)==null?void 0:Xe.index)!=null?Ke:-1;rt===be+1||rt===be&&nt===Ye+1||Je===ve||(ae.reset(),ye.reset()),this.lastCc=Je,this.lastSn=rt,this.lastPartIndex=nt}}onFragLoaded(Z,ee){const{frag:ae,payload:ye}=ee;if(ae.type===PlaylistLevelType.SUBTITLE)if(ye.byteLength){const ve=ae.decryptdata,be="stats"in ee;if(ve==null||!ve.encrypted||be){const Ye=this.tracks[ae.level],Ke=this.vttCCs;Ke[ae.cc]||(Ke[ae.cc]={start:ae.start,prevCC:this.prevCC,new:!0},this.prevCC=ae.cc),Ye&&Ye.textCodec===IMSC1_CODEC?this._parseIMSC1(ae,ye):this._parseVTTs(ee)}}else this.hls.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:ae,error:new Error("Empty subtitle payload")})}_parseIMSC1(Z,ee){const ae=this.hls;parseIMSC1(ee,this.initPTS[Z.cc],ye=>{this._appendCues(ye,Z.level),ae.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:Z})},ye=>{logger.log(`Failed to parse IMSC1: ${ye}`),ae.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:Z,error:ye})})}_parseVTTs(Z){var ee;const{frag:ae,payload:ye}=Z,{initPTS:ve,unparsedVttFrags:be}=this,Ye=ve.length-1;if(!ve[ae.cc]&&Ye===-1){be.push(Z);return}const Ke=this.hls,Xe=(ee=ae.initSegment)!=null&&ee.data?appendUint8Array(ae.initSegment.data,new Uint8Array(ye)):ye;parseWebVTT(Xe,this.initPTS[ae.cc],this.vttCCs,ae.cc,ae.start,Je=>{this._appendCues(Je,ae.level),Ke.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:ae})},Je=>{const rt=Je.message==="Missing initPTS for VTT MPEGTS";rt?be.push(Z):this._fallbackToIMSC1(ae,ye),logger.log(`Failed to parse VTT cue: ${Je}`),!(rt&&Ye>ae.cc)&&Ke.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:ae,error:Je})})}_fallbackToIMSC1(Z,ee){const ae=this.tracks[Z.level];ae.textCodec||parseIMSC1(ee,this.initPTS[Z.cc],()=>{ae.textCodec=IMSC1_CODEC,this._parseIMSC1(Z,ee)},()=>{ae.textCodec="wvtt"})}_appendCues(Z,ee){const ae=this.hls;if(this.config.renderTextTracksNatively){const ye=this.textTracks[ee];if(!ye||ye.mode==="disabled")return;Z.forEach(ve=>addCueToTrack(ye,ve))}else{const ye=this.tracks[ee];if(!ye)return;const ve=ye.default?"default":"subtitles"+ee;ae.trigger(Events.CUES_PARSED,{type:"subtitles",cues:Z,track:ve})}}onFragDecrypted(Z,ee){const{frag:ae}=ee;ae.type===PlaylistLevelType.SUBTITLE&&this.onFragLoaded(Events.FRAG_LOADED,ee)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(Z,ee){this.initCea608Parsers();const{cea608Parser1:ae,cea608Parser2:ye}=this;if(!this.enabled||!ae||!ye)return;const{frag:ve,samples:be}=ee;if(!(ve.type===PlaylistLevelType.MAIN&&this.closedCaptionsForLevel(ve)==="NONE"))for(let Ye=0;Ye<be.length;Ye++){const Ke=be[Ye].bytes;if(Ke){const Xe=this.extractCea608Data(Ke);ae.addData(be[Ye].pts,Xe[0]),ye.addData(be[Ye].pts,Xe[1])}}}onBufferFlushing(Z,{startOffset:ee,endOffset:ae,endOffsetSubtitles:ye,type:ve}){const{media:be}=this;if(!(!be||be.currentTime<ae)){if(!ve||ve==="video"){const{captionsTracks:Ye}=this;Object.keys(Ye).forEach(Ke=>removeCuesInRange(Ye[Ke],ee,ae))}if(this.config.renderTextTracksNatively&&ee===0&&ye!==void 0){const{textTracks:Ye}=this;Object.keys(Ye).forEach(Ke=>removeCuesInRange(Ye[Ke],ee,ye))}}}extractCea608Data(Z){const ee=[[],[]],ae=Z[0]&31;let ye=2;for(let ve=0;ve<ae;ve++){const be=Z[ye++],Ye=127&Z[ye++],Ke=127&Z[ye++];if(!(Ye===0&&Ke===0)&&4&be){const Xe=3&be;(Xe===0||Xe===1)&&(ee[Xe].push(Ye),ee[Xe].push(Ke))}}return ee}}function captionsOrSubtitlesFromCharacteristics(ie){return ie.characteristics&&/transcribes-spoken-dialog/gi.test(ie.characteristics)&&/describes-music-and-sound/gi.test(ie.characteristics)?"captions":"subtitles"}function canReuseVttTextTrack(ie,Z){return!!ie&&ie.kind===captionsOrSubtitlesFromCharacteristics(Z)&&subtitleTrackMatchesTextTrack(Z,ie)}function intersection(ie,Z,ee,ae){return Math.min(Z,ae)-Math.max(ie,ee)}function newVTTCCs(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}class CapLevelController{constructor(Z){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=Z,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(Z){this.streamController=Z}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:Z}=this;Z.on(Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),Z.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),Z.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),Z.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),Z.on(Events.BUFFER_CODECS,this.onBufferCodecs,this),Z.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:Z}=this;Z.off(Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),Z.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),Z.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),Z.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),Z.off(Events.BUFFER_CODECS,this.onBufferCodecs,this),Z.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(Z,ee){const ae=this.hls.levels[ee.droppedLevel];this.isLevelAllowed(ae)&&this.restrictedLevels.push({bitrate:ae.bitrate,height:ae.height,width:ae.width})}onMediaAttaching(Z,ee){this.media=ee.media instanceof HTMLVideoElement?ee.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(Z,ee){const ae=this.hls;this.restrictedLevels=[],this.firstLevel=ee.firstLevel,ae.config.capLevelToPlayerSize&&ee.video&&this.startCapping()}onLevelsUpdated(Z,ee){this.timer&&isFiniteNumber(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(Z,ee){this.hls.config.capLevelToPlayerSize&&ee.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const Z=this.hls.levels;if(Z.length){const ee=this.hls,ae=this.getMaxLevel(Z.length-1);ae!==this.autoLevelCapping&&logger.log(`Setting autoLevelCapping to ${ae}: ${Z[ae].height}p@${Z[ae].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),ee.autoLevelCapping=ae,ee.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=ee.autoLevelCapping}}}getMaxLevel(Z){const ee=this.hls.levels;if(!ee.length)return-1;const ae=ee.filter((ye,ve)=>this.isLevelAllowed(ye)&&ve<=Z);return this.clientRect=null,CapLevelController.getMaxLevelByMediaSize(ae,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const Z=this.media,ee={width:0,height:0};if(Z){const ae=Z.getBoundingClientRect();ee.width=ae.width,ee.height=ae.height,!ee.width&&!ee.height&&(ee.width=ae.right-ae.left||Z.width||0,ee.height=ae.bottom-ae.top||Z.height||0)}return this.clientRect=ee,ee}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let Z=1;if(!this.hls.config.ignoreDevicePixelRatio)try{Z=self.devicePixelRatio}catch{}return Z}isLevelAllowed(Z){return!this.restrictedLevels.some(ee=>Z.bitrate===ee.bitrate&&Z.width===ee.width&&Z.height===ee.height)}static getMaxLevelByMediaSize(Z,ee,ae){if(!(Z!=null&&Z.length))return-1;const ye=(Ye,Ke)=>Ke?Ye.width!==Ke.width||Ye.height!==Ke.height:!0;let ve=Z.length-1;const be=Math.max(ee,ae);for(let Ye=0;Ye<Z.length;Ye+=1){const Ke=Z[Ye];if((Ke.width>=be||Ke.height>=be)&&ye(Ke,Z[Ye+1])){ve=Ye;break}}return ve}}class FPSController{constructor(Z){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=Z,this.registerListeners()}setStreamController(Z){this.streamController=Z}registerListeners(){this.hls.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(Z,ee){const ae=this.hls.config;if(ae.capLevelOnFPSDrop){const ye=ee.media instanceof self.HTMLVideoElement?ee.media:null;this.media=ye,ye&&typeof ye.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),ae.fpsDroppedMonitoringPeriod)}}checkFPS(Z,ee,ae){const ye=performance.now();if(ee){if(this.lastTime){const ve=ye-this.lastTime,be=ae-this.lastDroppedFrames,Ye=ee-this.lastDecodedFrames,Ke=1e3*be/ve,Xe=this.hls;if(Xe.trigger(Events.FPS_DROP,{currentDropped:be,currentDecoded:Ye,totalDroppedFrames:ae}),Ke>0&&be>Xe.config.fpsDroppedMonitoringThreshold*Ye){let Je=Xe.currentLevel;logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+Je),Je>0&&(Xe.autoLevelCapping===-1||Xe.autoLevelCapping>=Je)&&(Je=Je-1,Xe.trigger(Events.FPS_DROP_LEVEL_CAPPING,{level:Je,droppedLevel:Xe.currentLevel}),Xe.autoLevelCapping=Je,this.streamController.nextLevelSwitch())}}this.lastTime=ye,this.lastDroppedFrames=ae,this.lastDecodedFrames=ee}}checkFPSInterval(){const Z=this.media;if(Z)if(this.isVideoPlaybackQualityAvailable){const ee=Z.getVideoPlaybackQuality();this.checkFPS(Z,ee.totalVideoFrames,ee.droppedVideoFrames)}else this.checkFPS(Z,Z.webkitDecodedFrameCount,Z.webkitDroppedFrameCount)}}const LOGGER_PREFIX="[eme]";class EMEController{constructor(Z){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=EMEController.CDMCleanupPromise?[EMEController.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=logger.debug.bind(logger,LOGGER_PREFIX),this.log=logger.log.bind(logger,LOGGER_PREFIX),this.warn=logger.warn.bind(logger,LOGGER_PREFIX),this.error=logger.error.bind(logger,LOGGER_PREFIX),this.hls=Z,this.config=Z.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const Z=this.config;Z.requestMediaKeySystemAccessFunc=null,Z.licenseXhrSetup=Z.licenseResponseCallback=void 0,Z.drmSystems=Z.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(Z){const{drmSystems:ee,widevineLicenseUrl:ae}=this.config,ye=ee[Z];if(ye)return ye.licenseUrl;if(Z===KeySystems.WIDEVINE&&ae)return ae;throw new Error(`no license server URL configured for key-system "${Z}"`)}getServerCertificateUrl(Z){const{drmSystems:ee}=this.config,ae=ee[Z];if(ae)return ae.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${Z}"]`)}attemptKeySystemAccess(Z){const ee=this.hls.levels,ae=(be,Ye,Ke)=>!!be&&Ke.indexOf(be)===Ye,ye=ee.map(be=>be.audioCodec).filter(ae),ve=ee.map(be=>be.videoCodec).filter(ae);return ye.length+ve.length===0&&ve.push("avc1.42e01e"),new Promise((be,Ye)=>{const Ke=Xe=>{const Je=Xe.shift();this.getMediaKeysPromise(Je,ye,ve).then(rt=>be({keySystem:Je,mediaKeys:rt})).catch(rt=>{Xe.length?Ke(Xe):rt instanceof EMEKeyError?Ye(rt):Ye(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_ACCESS,error:rt,fatal:!0},rt.message))})};Ke(Z)})}requestMediaKeySystemAccess(Z,ee){const{requestMediaKeySystemAccessFunc:ae}=this.config;if(typeof ae!="function"){let ye=`Configured requestMediaKeySystemAccess is not a function ${ae}`;return requestMediaKeySystemAccess===null&&self.location.protocol==="http:"&&(ye=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(ye))}return ae(Z,ee)}getMediaKeysPromise(Z,ee,ae){const ye=getSupportedMediaKeySystemConfigurations(Z,ee,ae,this.config.drmSystemOptions),ve=this.keySystemAccessPromises[Z];let be=ve==null?void 0:ve.keySystemAccess;if(!be){this.log(`Requesting encrypted media "${Z}" key-system access with config: ${JSON.stringify(ye)}`),be=this.requestMediaKeySystemAccess(Z,ye);const Ye=this.keySystemAccessPromises[Z]={keySystemAccess:be};return be.catch(Ke=>{this.log(`Failed to obtain access to key-system "${Z}": ${Ke}`)}),be.then(Ke=>{this.log(`Access for key-system "${Ke.keySystem}" obtained`);const Xe=this.fetchServerCertificate(Z);return this.log(`Create media-keys for "${Z}"`),Ye.mediaKeys=Ke.createMediaKeys().then(Je=>(this.log(`Media-keys created for "${Z}"`),Xe.then(rt=>rt?this.setMediaKeysServerCertificate(Je,Z,rt):Je))),Ye.mediaKeys.catch(Je=>{this.error(`Failed to create media-keys for "${Z}"}: ${Je}`)}),Ye.mediaKeys})}return be.then(()=>ve.mediaKeys)}createMediaKeySessionContext({decryptdata:Z,keySystem:ee,mediaKeys:ae}){this.log(`Creating key-system session "${ee}" keyId: ${Hex.hexDump(Z.keyId||[])}`);const ye=ae.createSession(),ve={decryptdata:Z,keySystem:ee,mediaKeys:ae,mediaKeysSession:ye,keyStatus:"status-pending"};return this.mediaKeySessions.push(ve),ve}renewKeySession(Z){const ee=Z.decryptdata;if(ee.pssh){const ae=this.createMediaKeySessionContext(Z),ye=this.getKeyIdString(ee),ve="cenc";this.keyIdToKeySessionPromise[ye]=this.generateRequestWithPreferredKeySession(ae,ve,ee.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(Z)}getKeyIdString(Z){if(!Z)throw new Error("Could not read keyId of undefined decryptdata");if(Z.keyId===null)throw new Error("keyId is null");return Hex.hexDump(Z.keyId)}updateKeySession(Z,ee){var ae;const ye=Z.mediaKeysSession;return this.log(`Updating key-session "${ye.sessionId}" for keyID ${Hex.hexDump(((ae=Z.decryptdata)==null?void 0:ae.keyId)||[])}
      } (data length: ${ee&&ee.byteLength})`),ye.update(ee)}selectKeySystemFormat(Z){const ee=Object.keys(Z.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${Z.sn} ${Z.type}: ${Z.level}) key formats ${ee.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(ee)),this.keyFormatPromise}getKeyFormatPromise(Z){return new Promise((ee,ae)=>{const ye=getKeySystemsForConfig(this.config),ve=Z.map(keySystemFormatToKeySystemDomain).filter(be=>!!be&&ye.indexOf(be)!==-1);return this.getKeySystemSelectionPromise(ve).then(({keySystem:be})=>{const Ye=keySystemDomainToKeySystemFormat(be);Ye?ee(Ye):ae(new Error(`Unable to find format for key-system "${be}"`))}).catch(ae)})}loadKey(Z){const ee=Z.keyInfo.decryptdata,ae=this.getKeyIdString(ee),ye=`(keyId: ${ae} format: "${ee.keyFormat}" method: ${ee.method} uri: ${ee.uri})`;this.log(`Starting session for key ${ye}`);let ve=this.keyIdToKeySessionPromise[ae];return ve||(ve=this.keyIdToKeySessionPromise[ae]=this.getKeySystemForKeyPromise(ee).then(({keySystem:be,mediaKeys:Ye})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${Z.frag.sn} ${Z.frag.type}: ${Z.frag.level} using key ${ye}`),this.attemptSetMediaKeys(be,Ye).then(()=>{this.throwIfDestroyed();const Ke=this.createMediaKeySessionContext({keySystem:be,mediaKeys:Ye,decryptdata:ee});return this.generateRequestWithPreferredKeySession(Ke,"cenc",ee.pssh,"playlist-key")}))),ve.catch(be=>this.handleError(be))),ve}throwIfDestroyed(Z="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(Z){this.hls&&(this.error(Z.message),Z instanceof EMEKeyError?this.hls.trigger(Events.ERROR,Z.data):this.hls.trigger(Events.ERROR,{type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_KEYS,error:Z,fatal:!0}))}getKeySystemForKeyPromise(Z){const ee=this.getKeyIdString(Z),ae=this.keyIdToKeySessionPromise[ee];if(!ae){const ye=keySystemFormatToKeySystemDomain(Z.keyFormat),ve=ye?[ye]:getKeySystemsForConfig(this.config);return this.attemptKeySystemAccess(ve)}return ae}getKeySystemSelectionPromise(Z){if(Z.length||(Z=getKeySystemsForConfig(this.config)),Z.length===0)throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(Z)}_onMediaEncrypted(Z){const{initDataType:ee,initData:ae}=Z;if(this.debug(`"${Z.type}" event: init data type: "${ee}"`),ae===null)return;let ye,ve;if(ee==="sinf"&&this.config.drmSystems[KeySystems.FAIRPLAY]){const Je=bin2str(new Uint8Array(ae));try{const rt=base64Decode(JSON.parse(Je).sinf),nt=parseSinf(new Uint8Array(rt));if(!nt)return;ye=nt.subarray(8,24),ve=KeySystems.FAIRPLAY}catch{this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{const Je=parsePssh(ae);if(Je===null)return;Je.version===0&&Je.systemId===KeySystemIds.WIDEVINE&&Je.data&&(ye=Je.data.subarray(8,24)),ve=keySystemIdToKeySystemDomain(Je.systemId)}if(!ve||!ye)return;const be=Hex.hexDump(ye),{keyIdToKeySessionPromise:Ye,mediaKeySessions:Ke}=this;let Xe=Ye[be];for(let Je=0;Je<Ke.length;Je++){const rt=Ke[Je],nt=rt.decryptdata;if(nt.pssh||!nt.keyId)continue;const it=Hex.hexDump(nt.keyId);if(be===it||nt.uri.replace(/-/g,"").indexOf(be)!==-1){Xe=Ye[it],delete Ye[it],nt.pssh=new Uint8Array(ae),nt.keyId=ye,Xe=Ye[be]=Xe.then(()=>this.generateRequestWithPreferredKeySession(rt,ee,ae,"encrypted-event-key-match"));break}}Xe||(Xe=Ye[be]=this.getKeySystemSelectionPromise([ve]).then(({keySystem:Je,mediaKeys:rt})=>{var nt;this.throwIfDestroyed();const it=new LevelKey("ISO-23001-7",be,(nt=keySystemDomainToKeySystemFormat(Je))!=null?nt:"");return it.pssh=new Uint8Array(ae),it.keyId=ye,this.attemptSetMediaKeys(Je,rt).then(()=>{this.throwIfDestroyed();const lt=this.createMediaKeySessionContext({decryptdata:it,keySystem:Je,mediaKeys:rt});return this.generateRequestWithPreferredKeySession(lt,ee,ae,"encrypted-event-no-match")})})),Xe.catch(Je=>this.handleError(Je))}_onWaitingForKey(Z){this.log(`"${Z.type}" event`)}attemptSetMediaKeys(Z,ee){const ae=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${Z}"`);const ye=Promise.all(ae).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(ee)});return this.setMediaKeysQueue.push(ye),ye.then(()=>{this.log(`Media-keys set for "${Z}"`),ae.push(ye),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(ve=>ae.indexOf(ve)===-1)})}generateRequestWithPreferredKeySession(Z,ee,ae,ye){var ve,be;const Ye=(ve=this.config.drmSystems)==null||(be=ve[Z.keySystem])==null?void 0:be.generateRequest;if(Ye)try{const lt=Ye.call(this.hls,ee,ae,Z);if(!lt)throw new Error("Invalid response from configured generateRequest filter");ee=lt.initDataType,ae=Z.decryptdata.pssh=lt.initData?new Uint8Array(lt.initData):null}catch(lt){var Ke;if(this.warn(lt.message),(Ke=this.hls)!=null&&Ke.config.debug)throw lt}if(ae===null)return this.log(`Skipping key-session request for "${ye}" (no initData)`),Promise.resolve(Z);const Xe=this.getKeyIdString(Z.decryptdata);this.log(`Generating key-session request for "${ye}": ${Xe} (init data type: ${ee} length: ${ae?ae.byteLength:null})`);const Je=new EventEmitter,rt=Z._onmessage=lt=>{const ct=Z.mediaKeysSession;if(!ct){Je.emit("error",new Error("invalid state"));return}const{messageType:ot,message:dt}=lt;this.log(`"${ot}" message event for session "${ct.sessionId}" message size: ${dt.byteLength}`),ot==="license-request"||ot==="license-renewal"?this.renewLicense(Z,dt).catch(ft=>{this.handleError(ft),Je.emit("error",ft)}):ot==="license-release"?Z.keySystem===KeySystems.FAIRPLAY&&(this.updateKeySession(Z,strToUtf8array("acknowledged")),this.removeSession(Z)):this.warn(`unhandled media key message type "${ot}"`)},nt=Z._onkeystatuseschange=lt=>{if(!Z.mediaKeysSession){Je.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(Z);const ct=Z.keyStatus;Je.emit("keyStatus",ct),ct==="expired"&&(this.warn(`${Z.keySystem} expired for key ${Xe}`),this.renewKeySession(Z))};Z.mediaKeysSession.addEventListener("message",rt),Z.mediaKeysSession.addEventListener("keystatuseschange",nt);const it=new Promise((lt,ct)=>{Je.on("error",ct),Je.on("keyStatus",ot=>{ot.startsWith("usable")?lt():ot==="output-restricted"?ct(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):ot==="internal-error"?ct(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${ot}"`)):ot==="expired"?ct(new Error("key expired while generating request")):this.warn(`unhandled key status change "${ot}"`)})});return Z.mediaKeysSession.generateRequest(ee,ae).then(()=>{var lt;this.log(`Request generated for key-session "${(lt=Z.mediaKeysSession)==null?void 0:lt.sessionId}" keyId: ${Xe}`)}).catch(lt=>{throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_SESSION,error:lt,fatal:!1},`Error generating key-session request: ${lt}`)}).then(()=>it).catch(lt=>{throw Je.removeAllListeners(),this.removeSession(Z),lt}).then(()=>(Je.removeAllListeners(),Z))}onKeyStatusChange(Z){Z.mediaKeysSession.keyStatuses.forEach((ee,ae)=>{this.log(`key status change "${ee}" for keyStatuses keyId: ${Hex.hexDump("buffer"in ae?new Uint8Array(ae.buffer,ae.byteOffset,ae.byteLength):new Uint8Array(ae))} session keyId: ${Hex.hexDump(new Uint8Array(Z.decryptdata.keyId||[]))} uri: ${Z.decryptdata.uri}`),Z.keyStatus=ee})}fetchServerCertificate(Z){const ee=this.config,ae=ee.loader,ye=new ae(ee),ve=this.getServerCertificateUrl(Z);return ve?(this.log(`Fetching server certificate for "${Z}"`),new Promise((be,Ye)=>{const Ke={responseType:"arraybuffer",url:ve},Xe=ee.certLoadPolicy.default,Je={loadPolicy:Xe,timeout:Xe.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},rt={onSuccess:(nt,it,lt,ct)=>{be(nt.data)},onError:(nt,it,lt,ct)=>{Ye(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:lt,response:_objectSpread2({url:Ke.url,data:void 0},nt)},`"${Z}" certificate request failed (${ve}). Status: ${nt.code} (${nt.text})`))},onTimeout:(nt,it,lt)=>{Ye(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:lt,response:{url:Ke.url,data:void 0}},`"${Z}" certificate request timed out (${ve})`))},onAbort:(nt,it,lt)=>{Ye(new Error("aborted"))}};ye.load(Ke,Je,rt)})):Promise.resolve()}setMediaKeysServerCertificate(Z,ee,ae){return new Promise((ye,ve)=>{Z.setServerCertificate(ae).then(be=>{this.log(`setServerCertificate ${be?"success":"not supported by CDM"} (${ae==null?void 0:ae.byteLength}) on "${ee}"`),ye(Z)}).catch(be=>{ve(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:be,fatal:!0},be.message))})})}renewLicense(Z,ee){return this.requestLicense(Z,new Uint8Array(ee)).then(ae=>this.updateKeySession(Z,new Uint8Array(ae)).catch(ye=>{throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:ye,fatal:!0},ye.message)}))}unpackPlayReadyKeyMessage(Z,ee){const ae=String.fromCharCode.apply(null,new Uint16Array(ee.buffer));if(!ae.includes("PlayReadyKeyMessage"))return Z.setRequestHeader("Content-Type","text/xml; charset=utf-8"),ee;const ye=new DOMParser().parseFromString(ae,"application/xml"),ve=ye.querySelectorAll("HttpHeader");if(ve.length>0){let Je;for(let rt=0,nt=ve.length;rt<nt;rt++){var be,Ye;Je=ve[rt];const it=(be=Je.querySelector("name"))==null?void 0:be.textContent,lt=(Ye=Je.querySelector("value"))==null?void 0:Ye.textContent;it&&lt&&Z.setRequestHeader(it,lt)}}const Ke=ye.querySelector("Challenge"),Xe=Ke==null?void 0:Ke.textContent;if(!Xe)throw new Error("Cannot find <Challenge> in key message");return strToUtf8array(atob(Xe))}setupLicenseXHR(Z,ee,ae,ye){const ve=this.config.licenseXhrSetup;return ve?Promise.resolve().then(()=>{if(!ae.decryptdata)throw new Error("Key removed");return ve.call(this.hls,Z,ee,ae,ye)}).catch(be=>{if(!ae.decryptdata)throw be;return Z.open("POST",ee,!0),ve.call(this.hls,Z,ee,ae,ye)}).then(be=>(Z.readyState||Z.open("POST",ee,!0),{xhr:Z,licenseChallenge:be||ye})):(Z.open("POST",ee,!0),Promise.resolve({xhr:Z,licenseChallenge:ye}))}requestLicense(Z,ee){const ae=this.config.keyLoadPolicy.default;return new Promise((ye,ve)=>{const be=this.getLicenseServerUrl(Z.keySystem);this.log(`Sending license request to URL: ${be}`);const Ye=new XMLHttpRequest;Ye.responseType="arraybuffer",Ye.onreadystatechange=()=>{if(!this.hls||!Z.mediaKeysSession)return ve(new Error("invalid state"));if(Ye.readyState===4)if(Ye.status===200){this._requestLicenseFailureCount=0;let Ke=Ye.response;this.log(`License received ${Ke instanceof ArrayBuffer?Ke.byteLength:Ke}`);const Xe=this.config.licenseResponseCallback;if(Xe)try{Ke=Xe.call(this.hls,Ye,be,Z)}catch(Je){this.error(Je)}ye(Ke)}else{const Ke=ae.errorRetry,Xe=Ke?Ke.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>Xe||Ye.status>=400&&Ye.status<500)ve(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:Ye,response:{url:be,data:void 0,code:Ye.status,text:Ye.statusText}},`License Request XHR failed (${be}). Status: ${Ye.status} (${Ye.statusText})`));else{const Je=Xe-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${Je} attempts left`),this.requestLicense(Z,ee).then(ye,ve)}}},Z.licenseXhr&&Z.licenseXhr.readyState!==XMLHttpRequest.DONE&&Z.licenseXhr.abort(),Z.licenseXhr=Ye,this.setupLicenseXHR(Ye,be,Z,ee).then(({xhr:Ke,licenseChallenge:Xe})=>{Z.keySystem==KeySystems.PLAYREADY&&(Xe=this.unpackPlayReadyKeyMessage(Ke,Xe)),Ke.send(Xe)})})}onMediaAttached(Z,ee){if(!this.config.emeEnabled)return;const ae=ee.media;this.media=ae,ae.addEventListener("encrypted",this.onMediaEncrypted),ae.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const Z=this.media,ee=this.mediaKeySessions;Z&&(Z.removeEventListener("encrypted",this.onMediaEncrypted),Z.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},LevelKey.clearKeyUriToKeyIdMap();const ae=ee.length;EMEController.CDMCleanupPromise=Promise.all(ee.map(ye=>this.removeSession(ye)).concat(Z==null?void 0:Z.setMediaKeys(null).catch(ye=>{this.log(`Could not clear media keys: ${ye}`)}))).then(()=>{ae&&(this.log("finished closing key sessions and clearing media keys"),ee.length=0)}).catch(ye=>{this.log(`Could not close sessions and clear media keys: ${ye}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(Z,{sessionKeys:ee}){if(!(!ee||!this.config.emeEnabled)&&!this.keyFormatPromise){const ae=ee.reduce((ye,ve)=>(ye.indexOf(ve.keyFormat)===-1&&ye.push(ve.keyFormat),ye),[]);this.log(`Selecting key-system from session-keys ${ae.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(ae)}}removeSession(Z){const{mediaKeysSession:ee,licenseXhr:ae}=Z;if(ee){this.log(`Remove licenses and keys and close session ${ee.sessionId}`),Z._onmessage&&(ee.removeEventListener("message",Z._onmessage),Z._onmessage=void 0),Z._onkeystatuseschange&&(ee.removeEventListener("keystatuseschange",Z._onkeystatuseschange),Z._onkeystatuseschange=void 0),ae&&ae.readyState!==XMLHttpRequest.DONE&&ae.abort(),Z.mediaKeysSession=Z.decryptdata=Z.licenseXhr=void 0;const ye=this.mediaKeySessions.indexOf(Z);return ye>-1&&this.mediaKeySessions.splice(ye,1),ee.remove().catch(ve=>{this.log(`Could not remove session: ${ve}`)}).then(()=>ee.close()).catch(ve=>{this.log(`Could not close session: ${ve}`)})}}}EMEController.CDMCleanupPromise=void 0;class EMEKeyError extends Error{constructor(Z,ee){super(ee),this.data=void 0,Z.error||(Z.error=new Error(ee)),this.data=Z,Z.err=Z.error}}var CmObjectType;(function(ie){ie.MANIFEST="m",ie.AUDIO="a",ie.VIDEO="v",ie.MUXED="av",ie.INIT="i",ie.CAPTION="c",ie.TIMED_TEXT="tt",ie.KEY="k",ie.OTHER="o"})(CmObjectType||(CmObjectType={}));var CmStreamingFormat;(function(ie){ie.DASH="d",ie.HLS="h",ie.SMOOTH="s",ie.OTHER="o"})(CmStreamingFormat||(CmStreamingFormat={}));var CmcdHeaderField;(function(ie){ie.OBJECT="CMCD-Object",ie.REQUEST="CMCD-Request",ie.SESSION="CMCD-Session",ie.STATUS="CMCD-Status"})(CmcdHeaderField||(CmcdHeaderField={}));const CmcdHeaderMap={[CmcdHeaderField.OBJECT]:["br","d","ot","tb"],[CmcdHeaderField.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[CmcdHeaderField.SESSION]:["cid","pr","sf","sid","st","v"],[CmcdHeaderField.STATUS]:["bs","rtp"]};class SfItem{constructor(Z,ee){this.value=void 0,this.params=void 0,Array.isArray(Z)&&(Z=Z.map(ae=>ae instanceof SfItem?ae:new SfItem(ae))),this.value=Z,this.params=ee}}class SfToken{constructor(Z){this.description=void 0,this.description=Z}}const DICT="Dict";function format(ie){return Array.isArray(ie)?JSON.stringify(ie):ie instanceof Map?"Map{}":ie instanceof Set?"Set{}":typeof ie=="object"?JSON.stringify(ie):String(ie)}function throwError(ie,Z,ee,ae){return new Error(`failed to ${ie} "${format(Z)}" as ${ee}`,{cause:ae})}const BARE_ITEM="Bare Item",BOOLEAN="Boolean",BYTES="Byte Sequence",DECIMAL="Decimal",INTEGER="Integer";function isInvalidInt(ie){return ie<-999999999999999||999999999999999<ie}const STRING_REGEX=/[\x00-\x1f\x7f]+/,TOKEN="Token",KEY="Key";function serializeError(ie,Z,ee){return throwError("serialize",ie,Z,ee)}function serializeBoolean(ie){if(typeof ie!="boolean")throw serializeError(ie,BOOLEAN);return ie?"?1":"?0"}function base64encode(ie){return btoa(String.fromCharCode(...ie))}function serializeByteSequence(ie){if(ArrayBuffer.isView(ie)===!1)throw serializeError(ie,BYTES);return`:${base64encode(ie)}:`}function serializeInteger(ie){if(isInvalidInt(ie))throw serializeError(ie,INTEGER);return ie.toString()}function serializeDate(ie){return`@${serializeInteger(ie.getTime()/1e3)}`}function roundToEven(ie,Z){if(ie<0)return-roundToEven(-ie,Z);const ee=Math.pow(10,Z);if(Math.abs(ie*ee%1-.5)<Number.EPSILON){const ae=Math.floor(ie*ee);return(ae%2===0?ae:ae+1)/ee}else return Math.round(ie*ee)/ee}function serializeDecimal(ie){const Z=roundToEven(ie,3);if(Math.floor(Math.abs(Z)).toString().length>12)throw serializeError(ie,DECIMAL);const ee=Z.toString();return ee.includes(".")?ee:`${ee}.0`}const STRING="String";function serializeString(ie){if(STRING_REGEX.test(ie))throw serializeError(ie,STRING);return`"${ie.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function symbolToStr(ie){return ie.description||ie.toString().slice(7,-1)}function serializeToken(ie){const Z=symbolToStr(ie);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(Z)===!1)throw serializeError(Z,TOKEN);return Z}function serializeBareItem(ie){switch(typeof ie){case"number":if(!isFiniteNumber(ie))throw serializeError(ie,BARE_ITEM);return Number.isInteger(ie)?serializeInteger(ie):serializeDecimal(ie);case"string":return serializeString(ie);case"symbol":return serializeToken(ie);case"boolean":return serializeBoolean(ie);case"object":if(ie instanceof Date)return serializeDate(ie);if(ie instanceof Uint8Array)return serializeByteSequence(ie);if(ie instanceof SfToken)return serializeToken(ie);default:throw serializeError(ie,BARE_ITEM)}}function serializeKey(ie){if(/^[a-z*][a-z0-9\-_.*]*$/.test(ie)===!1)throw serializeError(ie,KEY);return ie}function serializeParams(ie){return ie==null?"":Object.entries(ie).map(([Z,ee])=>ee===!0?`;${serializeKey(Z)}`:`;${serializeKey(Z)}=${serializeBareItem(ee)}`).join("")}function serializeItem(ie){return ie instanceof SfItem?`${serializeBareItem(ie.value)}${serializeParams(ie.params)}`:serializeBareItem(ie)}function serializeInnerList(ie){return`(${ie.value.map(serializeItem).join(" ")})${serializeParams(ie.params)}`}function serializeDict(ie,Z={whitespace:!0}){if(typeof ie!="object")throw serializeError(ie,DICT);const ee=ie instanceof Map?ie.entries():Object.entries(ie),ae=Z!=null&&Z.whitespace?" ":"";return Array.from(ee).map(([ye,ve])=>{ve instanceof SfItem||(ve=new SfItem(ve));let be=serializeKey(ye);return ve.value===!0?be+=serializeParams(ve.params):(be+="=",Array.isArray(ve.value)?be+=serializeInnerList(ve):be+=serializeItem(ve)),be}).join(`,${ae}`)}function encodeSfDict(ie,Z){return serializeDict(ie,Z)}const isTokenField=ie=>ie==="ot"||ie==="sf"||ie==="st",isValid=ie=>typeof ie=="number"?isFiniteNumber(ie):ie!=null&&ie!==""&&ie!==!1;function urlToRelativePath(ie,Z){const ee=new URL(ie),ae=new URL(Z);if(ee.origin!==ae.origin)return ie;const ye=ee.pathname.split("/").slice(1),ve=ae.pathname.split("/").slice(1,-1);for(;ye[0]===ve[0];)ye.shift(),ve.shift();for(;ve.length;)ve.shift(),ye.unshift("..");return ye.join("/")}function uuid(){try{return crypto.randomUUID()}catch{try{const ie=URL.createObjectURL(new Blob),Z=ie.toString();return URL.revokeObjectURL(ie),Z.slice(Z.lastIndexOf("/")+1)}catch{let ie=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,Z=>{const ee=(ie+Math.random()*16)%16|0;return ie=Math.floor(ie/16),(Z=="x"?ee:ee&3|8).toString(16)})}}}const toRounded=ie=>Math.round(ie),toUrlSafe=(ie,Z)=>(Z!=null&&Z.baseUrl&&(ie=urlToRelativePath(ie,Z.baseUrl)),encodeURIComponent(ie)),toHundred=ie=>toRounded(ie/100)*100,CmcdFormatters={br:toRounded,d:toRounded,bl:toHundred,dl:toHundred,mtp:toHundred,nor:toUrlSafe,rtp:toHundred,tb:toRounded};function processCmcd(ie,Z){const ee={};if(ie==null||typeof ie!="object")return ee;const ae=Object.keys(ie).sort(),ye=_extends({},CmcdFormatters,Z==null?void 0:Z.formatters),ve=Z==null?void 0:Z.filter;return ae.forEach(be=>{if(ve!=null&&ve(be))return;let Ye=ie[be];const Ke=ye[be];Ke&&(Ye=Ke(Ye,Z)),!(be==="v"&&Ye===1)&&(be=="pr"&&Ye===1||isValid(Ye)&&(isTokenField(be)&&typeof Ye=="string"&&(Ye=new SfToken(Ye)),ee[be]=Ye))}),ee}function encodeCmcd(ie,Z={}){return ie?encodeSfDict(processCmcd(ie,Z),_extends({whitespace:!1},Z)):""}function toCmcdHeaders(ie,Z={}){if(!ie)return{};const ee=Object.entries(ie),ae=Object.entries(CmcdHeaderMap).concat(Object.entries((Z==null?void 0:Z.customHeaderMap)||{})),ye=ee.reduce((ve,be)=>{var Ye;const[Ke,Xe]=be,Je=((Ye=ae.find(rt=>rt[1].includes(Ke)))==null?void 0:Ye[0])||CmcdHeaderField.REQUEST;return ve[Je]!=null||(ve[Je]={}),ve[Je][Ke]=Xe,ve},{});return Object.entries(ye).reduce((ve,[be,Ye])=>(ve[be]=encodeCmcd(Ye,Z),ve),{})}function appendCmcdHeaders(ie,Z,ee){return _extends(ie,toCmcdHeaders(Z,ee))}const CMCD_PARAM="CMCD";function toCmcdQuery(ie,Z={}){if(!ie)return"";const ee=encodeCmcd(ie,Z);return`${CMCD_PARAM}=${encodeURIComponent(ee)}`}const REGEX=/CMCD=[^&#]+/;function appendCmcdQuery(ie,Z,ee){const ae=toCmcdQuery(Z,ee);if(!ae)return ie;if(REGEX.test(ie))return ie.replace(REGEX,ae);const ye=ie.includes("?")?"&":"?";return`${ie}${ye}${ae}`}class CMCDController{constructor(Z){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=ye=>{try{this.apply(ye,{ot:CmObjectType.MANIFEST,su:!this.initialized})}catch(ve){logger.warn("Could not generate manifest CMCD data.",ve)}},this.applyFragmentData=ye=>{try{const ve=ye.frag,be=this.hls.levels[ve.level],Ye=this.getObjectType(ve),Ke={d:ve.duration*1e3,ot:Ye};(Ye===CmObjectType.VIDEO||Ye===CmObjectType.AUDIO||Ye==CmObjectType.MUXED)&&(Ke.br=be.bitrate/1e3,Ke.tb=this.getTopBandwidth(Ye)/1e3,Ke.bl=this.getBufferLength(Ye)),this.apply(ye,Ke)}catch(ve){logger.warn("Could not generate segment CMCD data.",ve)}},this.hls=Z;const ee=this.config=Z.config,{cmcd:ae}=ee;ae!=null&&(ee.pLoader=this.createPlaylistLoader(),ee.fLoader=this.createFragmentLoader(),this.sid=ae.sessionId||uuid(),this.cid=ae.contentId,this.useHeaders=ae.useHeaders===!0,this.includeKeys=ae.includeKeys,this.registerListeners())}registerListeners(){const Z=this.hls;Z.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),Z.on(Events.MEDIA_DETACHED,this.onMediaDetached,this),Z.on(Events.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const Z=this.hls;Z.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),Z.off(Events.MEDIA_DETACHED,this.onMediaDetached,this),Z.off(Events.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=null}onMediaAttached(Z,ee){this.media=ee.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(Z,ee){var ae,ye;this.audioBuffer=(ae=ee.tracks.audio)==null?void 0:ae.buffer,this.videoBuffer=(ye=ee.tracks.video)==null?void 0:ye.buffer}createData(){var Z;return{v:1,sf:CmStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(Z=this.media)==null?void 0:Z.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(Z,ee={}){_extends(ee,this.createData());const ae=ee.ot===CmObjectType.INIT||ee.ot===CmObjectType.VIDEO||ee.ot===CmObjectType.MUXED;this.starved&&ae&&(ee.bs=!0,ee.su=!0,this.starved=!1),ee.su==null&&(ee.su=this.buffering);const{includeKeys:ye}=this;ye&&(ee=Object.keys(ee).reduce((ve,be)=>(ye.includes(be)&&(ve[be]=ee[be]),ve),{})),this.useHeaders?(Z.headers||(Z.headers={}),appendCmcdHeaders(Z.headers,ee)):Z.url=appendCmcdQuery(Z.url,ee)}getObjectType(Z){const{type:ee}=Z;if(ee==="subtitle")return CmObjectType.TIMED_TEXT;if(Z.sn==="initSegment")return CmObjectType.INIT;if(ee==="audio")return CmObjectType.AUDIO;if(ee==="main")return this.hls.audioTracks.length?CmObjectType.VIDEO:CmObjectType.MUXED}getTopBandwidth(Z){let ee=0,ae;const ye=this.hls;if(Z===CmObjectType.AUDIO)ae=ye.audioTracks;else{const ve=ye.maxAutoLevel,be=ve>-1?ve+1:ye.levels.length;ae=ye.levels.slice(0,be)}for(const ve of ae)ve.bitrate>ee&&(ee=ve.bitrate);return ee>0?ee:NaN}getBufferLength(Z){const ee=this.hls.media,ae=Z===CmObjectType.AUDIO?this.audioBuffer:this.videoBuffer;return!ae||!ee?NaN:BufferHelper.bufferInfo(ae,ee.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:Z}=this.config,ee=this.applyPlaylistData,ae=Z||this.config.loader;return class{constructor(ye){this.loader=void 0,this.loader=new ae(ye)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(ye,ve,be){ee(ye),this.loader.load(ye,ve,be)}}}createFragmentLoader(){const{fLoader:Z}=this.config,ee=this.applyFragmentData,ae=Z||this.config.loader;return class{constructor(ye){this.loader=void 0,this.loader=new ae(ye)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(ye,ve,be){ee(ye),this.loader.load(ye,ve,be)}}}}const PATHWAY_PENALTY_DURATION_MS=3e5;class ContentSteeringController{constructor(Z){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=Z,this.log=logger.log.bind(logger,"[content-steering]:"),this.registerListeners()}registerListeners(){const Z=this.hls;Z.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),Z.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),Z.on(Events.ERROR,this.onError,this)}unregisterListeners(){const Z=this.hls;Z&&(Z.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),Z.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),Z.off(Events.ERROR,this.onError,this))}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const Z=this.timeToLoad*1e3-(performance.now()-this.updated);if(Z>0){this.scheduleRefresh(this.uri,Z);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(Z){const ee=this.levels;ee&&(this.levels=ee.filter(ae=>ae!==Z))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(Z,ee){const{contentSteering:ae}=ee;ae!==null&&(this.pathwayId=ae.pathwayId,this.uri=ae.uri,this.started&&this.startLoad())}onManifestParsed(Z,ee){this.audioTracks=ee.audioTracks,this.subtitleTracks=ee.subtitleTracks}onError(Z,ee){const{errorAction:ae}=ee;if((ae==null?void 0:ae.action)===NetworkErrorAction.SendAlternateToPenaltyBox&&ae.flags===ErrorActionFlags.MoveAllAlternatesMatchingHost){const ye=this.levels;let ve=this.pathwayPriority,be=this.pathwayId;if(ee.context){const{groupId:Ye,pathwayId:Ke,type:Xe}=ee.context;Ye&&ye?be=this.getPathwayForGroupId(Ye,Xe,be):Ke&&(be=Ke)}be in this.penalizedPathways||(this.penalizedPathways[be]=performance.now()),!ve&&ye&&(ve=ye.reduce((Ye,Ke)=>(Ye.indexOf(Ke.pathwayId)===-1&&Ye.push(Ke.pathwayId),Ye),[])),ve&&ve.length>1&&(this.updatePathwayPriority(ve),ae.resolved=this.pathwayId!==be),ae.resolved||logger.warn(`Could not resolve ${ee.details} ("${ee.error.message}") with content-steering for Pathway: ${be} levels: ${ye&&ye.length} priorities: ${JSON.stringify(ve)} penalized: ${JSON.stringify(this.penalizedPathways)}`)}}filterParsedLevels(Z){this.levels=Z;let ee=this.getLevelsForPathway(this.pathwayId);if(ee.length===0){const ae=Z[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${ae}"`),ee=this.getLevelsForPathway(ae),this.pathwayId=ae}return ee.length!==Z.length?(this.log(`Found ${ee.length}/${Z.length} levels in Pathway "${this.pathwayId}"`),ee):Z}getLevelsForPathway(Z){return this.levels===null?[]:this.levels.filter(ee=>Z===ee.pathwayId)}updatePathwayPriority(Z){this.pathwayPriority=Z;let ee;const ae=this.penalizedPathways,ye=performance.now();Object.keys(ae).forEach(ve=>{ye-ae[ve]>PATHWAY_PENALTY_DURATION_MS&&delete ae[ve]});for(let ve=0;ve<Z.length;ve++){const be=Z[ve];if(be in ae)continue;if(be===this.pathwayId)return;const Ye=this.hls.nextLoadLevel,Ke=this.hls.levels[Ye];if(ee=this.getLevelsForPathway(be),ee.length>0){this.log(`Setting Pathway to "${be}"`),this.pathwayId=be,reassignFragmentLevelIndexes(ee),this.hls.trigger(Events.LEVELS_UPDATED,{levels:ee});const Xe=this.hls.levels[Ye];Ke&&Xe&&this.levels&&(Xe.attrs["STABLE-VARIANT-ID"]!==Ke.attrs["STABLE-VARIANT-ID"]&&Xe.bitrate!==Ke.bitrate&&this.log(`Unstable Pathways change from bitrate ${Ke.bitrate} to ${Xe.bitrate}`),this.hls.nextLoadLevel=Ye);break}}}getPathwayForGroupId(Z,ee,ae){const ye=this.getLevelsForPathway(ae).concat(this.levels||[]);for(let ve=0;ve<ye.length;ve++)if(ee===PlaylistContextType.AUDIO_TRACK&&ye[ve].hasAudioGroup(Z)||ee===PlaylistContextType.SUBTITLE_TRACK&&ye[ve].hasSubtitleGroup(Z))return ye[ve].pathwayId;return ae}clonePathways(Z){const ee=this.levels;if(!ee)return;const ae={},ye={};Z.forEach(ve=>{const{ID:be,"BASE-ID":Ye,"URI-REPLACEMENT":Ke}=ve;if(ee.some(Je=>Je.pathwayId===be))return;const Xe=this.getLevelsForPathway(Ye).map(Je=>{const rt=new AttrList(Je.attrs);rt["PATHWAY-ID"]=be;const nt=rt.AUDIO&&`${rt.AUDIO}_clone_${be}`,it=rt.SUBTITLES&&`${rt.SUBTITLES}_clone_${be}`;nt&&(ae[rt.AUDIO]=nt,rt.AUDIO=nt),it&&(ye[rt.SUBTITLES]=it,rt.SUBTITLES=it);const lt=performUriReplacement(Je.uri,rt["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",Ke),ct=new Level({attrs:rt,audioCodec:Je.audioCodec,bitrate:Je.bitrate,height:Je.height,name:Je.name,url:lt,videoCodec:Je.videoCodec,width:Je.width});if(Je.audioGroups)for(let ot=1;ot<Je.audioGroups.length;ot++)ct.addGroupId("audio",`${Je.audioGroups[ot]}_clone_${be}`);if(Je.subtitleGroups)for(let ot=1;ot<Je.subtitleGroups.length;ot++)ct.addGroupId("text",`${Je.subtitleGroups[ot]}_clone_${be}`);return ct});ee.push(...Xe),cloneRenditionGroups(this.audioTracks,ae,Ke,be),cloneRenditionGroups(this.subtitleTracks,ye,Ke,be)})}loadSteeringManifest(Z){const ee=this.hls.config,ae=ee.loader;this.loader&&this.loader.destroy(),this.loader=new ae(ee);let ye;try{ye=new self.URL(Z)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${Z}`);return}if(ye.protocol!=="data:"){const Je=(this.hls.bandwidthEstimate||ee.abrEwmaDefaultEstimate)|0;ye.searchParams.set("_HLS_pathway",this.pathwayId),ye.searchParams.set("_HLS_throughput",""+Je)}const ve={responseType:"json",url:ye.href},be=ee.steeringManifestLoadPolicy.default,Ye=be.errorRetry||be.timeoutRetry||{},Ke={loadPolicy:be,timeout:be.maxLoadTimeMs,maxRetry:Ye.maxNumRetry||0,retryDelay:Ye.retryDelayMs||0,maxRetryDelay:Ye.maxRetryDelayMs||0},Xe={onSuccess:(Je,rt,nt,it)=>{this.log(`Loaded steering manifest: "${ye}"`);const lt=Je.data;if(lt.VERSION!==1){this.log(`Steering VERSION ${lt.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=lt.TTL;const{"RELOAD-URI":ct,"PATHWAY-CLONES":ot,"PATHWAY-PRIORITY":dt}=lt;if(ct)try{this.uri=new self.URL(ct,ye).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${ct}`);return}this.scheduleRefresh(this.uri||nt.url),ot&&this.clonePathways(ot);const ft={steeringManifest:lt,url:ye.toString()};this.hls.trigger(Events.STEERING_MANIFEST_LOADED,ft),dt&&this.updatePathwayPriority(dt)},onError:(Je,rt,nt,it)=>{if(this.log(`Error loading steering manifest: ${Je.code} ${Je.text} (${rt.url})`),this.stopLoad(),Je.code===410){this.enabled=!1,this.log(`Steering manifest ${rt.url} no longer available`);return}let lt=this.timeToLoad*1e3;if(Je.code===429){const ct=this.loader;if(typeof(ct==null?void 0:ct.getResponseHeader)=="function"){const ot=ct.getResponseHeader("Retry-After");ot&&(lt=parseFloat(ot)*1e3)}this.log(`Steering manifest ${rt.url} rate limited`);return}this.scheduleRefresh(this.uri||rt.url,lt)},onTimeout:(Je,rt,nt)=>{this.log(`Timeout loading steering manifest (${rt.url})`),this.scheduleRefresh(this.uri||rt.url)}};this.log(`Requesting steering manifest: ${ye}`),this.loader.load(ve,Ke,Xe)}scheduleRefresh(Z,ee=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var ae;const ye=(ae=this.hls)==null?void 0:ae.media;if(ye&&!ye.ended){this.loadSteeringManifest(Z);return}this.scheduleRefresh(Z,this.timeToLoad*1e3)},ee)}}function cloneRenditionGroups(ie,Z,ee,ae){ie&&Object.keys(Z).forEach(ye=>{const ve=ie.filter(be=>be.groupId===ye).map(be=>{const Ye=_extends({},be);return Ye.details=void 0,Ye.attrs=new AttrList(Ye.attrs),Ye.url=Ye.attrs.URI=performUriReplacement(be.url,be.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",ee),Ye.groupId=Ye.attrs["GROUP-ID"]=Z[ye],Ye.attrs["PATHWAY-ID"]=ae,Ye});ie.push(...ve)})}function performUriReplacement(ie,Z,ee,ae){const{HOST:ye,PARAMS:ve,[ee]:be}=ae;let Ye;Z&&(Ye=be==null?void 0:be[Z],Ye&&(ie=Ye));const Ke=new self.URL(ie);return ye&&!Ye&&(Ke.host=ye),ve&&Object.keys(ve).sort().forEach(Xe=>{Xe&&Ke.searchParams.set(Xe,ve[Xe])}),Ke.href}const AGE_HEADER_LINE_REGEX=/^age:\s*[\d.]+\s*$/im;class XhrLoader{constructor(Z){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=Z&&Z.xhrSetup||null,this.stats=new LoadStats,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null,this.stats=null}abortInternal(){const Z=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),Z&&(Z.onreadystatechange=null,Z.onprogress=null,Z.readyState!==4&&(this.stats.aborted=!0,Z.abort()))}abort(){var Z;this.abortInternal(),(Z=this.callbacks)!=null&&Z.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(Z,ee,ae){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=Z,this.config=ee,this.callbacks=ae,this.loadInternal()}loadInternal(){const{config:Z,context:ee}=this;if(!Z||!ee)return;const ae=this.loader=new self.XMLHttpRequest,ye=this.stats;ye.loading.first=0,ye.loaded=0,ye.aborted=!1;const ve=this.xhrSetup;ve?Promise.resolve().then(()=>{if(!this.stats.aborted)return ve(ae,ee.url)}).catch(be=>(ae.open("GET",ee.url,!0),ve(ae,ee.url))).then(()=>{this.stats.aborted||this.openAndSendXhr(ae,ee,Z)}).catch(be=>{this.callbacks.onError({code:ae.status,text:be.message},ee,ae,ye)}):this.openAndSendXhr(ae,ee,Z)}openAndSendXhr(Z,ee,ae){Z.readyState||Z.open("GET",ee.url,!0);const ye=ee.headers,{maxTimeToFirstByteMs:ve,maxLoadTimeMs:be}=ae.loadPolicy;if(ye)for(const Ye in ye)Z.setRequestHeader(Ye,ye[Ye]);ee.rangeEnd&&Z.setRequestHeader("Range","bytes="+ee.rangeStart+"-"+(ee.rangeEnd-1)),Z.onreadystatechange=this.readystatechange.bind(this),Z.onprogress=this.loadprogress.bind(this),Z.responseType=ee.responseType,self.clearTimeout(this.requestTimeout),ae.timeout=ve&&isFiniteNumber(ve)?ve:be,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),ae.timeout),Z.send()}readystatechange(){const{context:Z,loader:ee,stats:ae}=this;if(!Z||!ee)return;const ye=ee.readyState,ve=this.config;if(!ae.aborted&&ye>=2&&(ae.loading.first===0&&(ae.loading.first=Math.max(self.performance.now(),ae.loading.start),ve.timeout!==ve.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),ve.timeout=ve.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),ve.loadPolicy.maxLoadTimeMs-(ae.loading.first-ae.loading.start)))),ye===4)){self.clearTimeout(this.requestTimeout),ee.onreadystatechange=null,ee.onprogress=null;const be=ee.status,Ye=ee.responseType!=="text";if(be>=200&&be<300&&(Ye&&ee.response||ee.responseText!==null)){ae.loading.end=Math.max(self.performance.now(),ae.loading.first);const Ke=Ye?ee.response:ee.responseText,Xe=ee.responseType==="arraybuffer"?Ke.byteLength:Ke.length;if(ae.loaded=ae.total=Xe,ae.bwEstimate=ae.total*8e3/(ae.loading.end-ae.loading.first),!this.callbacks)return;const Je=this.callbacks.onProgress;if(Je&&Je(ae,Z,Ke,ee),!this.callbacks)return;const rt={url:ee.responseURL,data:Ke,code:be};this.callbacks.onSuccess(rt,ae,Z,ee)}else{const Ke=ve.loadPolicy.errorRetry,Xe=ae.retry,Je={url:Z.url,data:void 0,code:be};shouldRetry(Ke,Xe,!1,Je)?this.retry(Ke):(logger.error(`${be} while loading ${Z.url}`),this.callbacks.onError({code:be,text:ee.statusText},Z,ee,ae))}}}loadtimeout(){var Z;const ee=(Z=this.config)==null?void 0:Z.loadPolicy.timeoutRetry,ae=this.stats.retry;if(shouldRetry(ee,ae,!0))this.retry(ee);else{var ye;logger.warn(`timeout while loading ${(ye=this.context)==null?void 0:ye.url}`);const ve=this.callbacks;ve&&(this.abortInternal(),ve.onTimeout(this.stats,this.context,this.loader))}}retry(Z){const{context:ee,stats:ae}=this;this.retryDelay=getRetryDelay(Z,ae.retry),ae.retry++,logger.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${ee==null?void 0:ee.url}, retrying ${ae.retry}/${Z.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(Z){const ee=this.stats;ee.loaded=Z.loaded,Z.lengthComputable&&(ee.total=Z.total)}getCacheAge(){let Z=null;if(this.loader&&AGE_HEADER_LINE_REGEX.test(this.loader.getAllResponseHeaders())){const ee=this.loader.getResponseHeader("age");Z=ee?parseFloat(ee):null}return Z}getResponseHeader(Z){return this.loader&&new RegExp(`^${Z}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(Z):null}}function fetchSupported(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const BYTERANGE=/(\d+)-(\d+)\/(\d+)/;class FetchLoader{constructor(Z){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=Z.fetchSetup||getRequest,this.controller=new self.AbortController,this.stats=new LoadStats}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var Z;this.abortInternal(),(Z=this.callbacks)!=null&&Z.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(Z,ee,ae){const ye=this.stats;if(ye.loading.start)throw new Error("Loader can only be used once.");ye.loading.start=self.performance.now();const ve=getRequestParameters(Z,this.controller.signal),be=ae.onProgress,Ye=Z.responseType==="arraybuffer",Ke=Ye?"byteLength":"length",{maxTimeToFirstByteMs:Xe,maxLoadTimeMs:Je}=ee.loadPolicy;this.context=Z,this.config=ee,this.callbacks=ae,this.request=this.fetchSetup(Z,ve),self.clearTimeout(this.requestTimeout),ee.timeout=Xe&&isFiniteNumber(Xe)?Xe:Je,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),ae.onTimeout(ye,Z,this.response)},ee.timeout),self.fetch(this.request).then(rt=>{this.response=this.loader=rt;const nt=Math.max(self.performance.now(),ye.loading.start);if(self.clearTimeout(this.requestTimeout),ee.timeout=Je,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),ae.onTimeout(ye,Z,this.response)},Je-(nt-ye.loading.start)),!rt.ok){const{status:it,statusText:lt}=rt;throw new FetchError(lt||"fetch, bad network response",it,rt)}return ye.loading.first=nt,ye.total=getContentLength(rt.headers)||ye.total,be&&isFiniteNumber(ee.highWaterMark)?this.loadProgressively(rt,ye,Z,ee.highWaterMark,be):Ye?rt.arrayBuffer():Z.responseType==="json"?rt.json():rt.text()}).then(rt=>{const nt=this.response;if(!nt)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),ye.loading.end=Math.max(self.performance.now(),ye.loading.first);const it=rt[Ke];it&&(ye.loaded=ye.total=it);const lt={url:nt.url,data:rt,code:nt.status};be&&!isFiniteNumber(ee.highWaterMark)&&be(ye,Z,rt,nt),ae.onSuccess(lt,ye,Z,nt)}).catch(rt=>{if(self.clearTimeout(this.requestTimeout),ye.aborted)return;const nt=rt&&rt.code||0,it=rt?rt.message:null;ae.onError({code:nt,text:it},Z,rt?rt.details:null,ye)})}getCacheAge(){let Z=null;if(this.response){const ee=this.response.headers.get("age");Z=ee?parseFloat(ee):null}return Z}getResponseHeader(Z){return this.response?this.response.headers.get(Z):null}loadProgressively(Z,ee,ae,ye=0,ve){const be=new ChunkCache,Ye=Z.body.getReader(),Ke=()=>Ye.read().then(Xe=>{if(Xe.done)return be.dataLength&&ve(ee,ae,be.flush(),Z),Promise.resolve(new ArrayBuffer(0));const Je=Xe.value,rt=Je.length;return ee.loaded+=rt,rt<ye||be.dataLength?(be.push(Je),be.dataLength>=ye&&ve(ee,ae,be.flush(),Z)):ve(ee,ae,Je,Z),Ke()}).catch(()=>Promise.reject());return Ke()}}function getRequestParameters(ie,Z){const ee={method:"GET",mode:"cors",credentials:"same-origin",signal:Z,headers:new self.Headers(_extends({},ie.headers))};return ie.rangeEnd&&ee.headers.set("Range","bytes="+ie.rangeStart+"-"+String(ie.rangeEnd-1)),ee}function getByteRangeLength(ie){const Z=BYTERANGE.exec(ie);if(Z)return parseInt(Z[2])-parseInt(Z[1])+1}function getContentLength(ie){const Z=ie.get("Content-Range");if(Z){const ae=getByteRangeLength(Z);if(isFiniteNumber(ae))return ae}const ee=ie.get("Content-Length");if(ee)return parseInt(ee)}function getRequest(ie,Z){return new self.Request(ie.url,Z)}class FetchError extends Error{constructor(Z,ee,ae){super(Z),this.code=void 0,this.details=void 0,this.code=ee,this.details=ae}}const WHITESPACE_CHAR=/\s/,Cues={newCue(ie,Z,ee,ae){const ye=[];let ve,be,Ye,Ke,Xe;const Je=self.VTTCue||self.TextTrackCue;for(let nt=0;nt<ae.rows.length;nt++)if(ve=ae.rows[nt],Ye=!0,Ke=0,Xe="",!ve.isEmpty()){var rt;for(let ct=0;ct<ve.chars.length;ct++)WHITESPACE_CHAR.test(ve.chars[ct].uchar)&&Ye?Ke++:(Xe+=ve.chars[ct].uchar,Ye=!1);ve.cueStartTime=Z,Z===ee&&(ee+=1e-4),Ke>=16?Ke--:Ke++;const it=fixLineBreaks(Xe.trim()),lt=generateCueId(Z,ee,it);ie!=null&&(rt=ie.cues)!=null&&rt.getCueById(lt)||(be=new Je(Z,ee,it),be.id=lt,be.line=nt+1,be.align="left",be.position=10+Math.min(80,Math.floor(Ke*8/32)*10),ye.push(be))}return ie&&ye.length&&(ye.sort((nt,it)=>nt.line==="auto"||it.line==="auto"?0:nt.line>8&&it.line>8?it.line-nt.line:nt.line-it.line),ye.forEach(nt=>addCueToTrack(ie,nt))),ye}},defaultLoadPolicy={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},hlsDefaultConfig=_objectSpread2(_objectSpread2({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:XhrLoader,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:AbrController,bufferController:BufferController,capLevelController:CapLevelController,errorController:ErrorController,fpsController:FPSController,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,useMediaCapabilities:!0,certLoadPolicy:{default:defaultLoadPolicy},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},timelineConfig()),{},{subtitleStreamController:SubtitleStreamController,subtitleTrackController:SubtitleTrackController,timelineController:TimelineController,audioStreamController:AudioStreamController,audioTrackController:AudioTrackController,emeController:EMEController,cmcdController:CMCDController,contentSteeringController:ContentSteeringController});function timelineConfig(){return{cueHandler:Cues,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function mergeConfig(ie,Z){if((Z.liveSyncDurationCount||Z.liveMaxLatencyDurationCount)&&(Z.liveSyncDuration||Z.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(Z.liveMaxLatencyDurationCount!==void 0&&(Z.liveSyncDurationCount===void 0||Z.liveMaxLatencyDurationCount<=Z.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(Z.liveMaxLatencyDuration!==void 0&&(Z.liveSyncDuration===void 0||Z.liveMaxLatencyDuration<=Z.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const ee=deepCpy(ie),ae=["manifest","level","frag"],ye=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return ae.forEach(ve=>{const be=`${ve==="level"?"playlist":ve}LoadPolicy`,Ye=Z[be]===void 0,Ke=[];ye.forEach(Xe=>{const Je=`${ve}Loading${Xe}`,rt=Z[Je];if(rt!==void 0&&Ye){Ke.push(Je);const nt=ee[be].default;switch(Z[be]={default:nt},Xe){case"TimeOut":nt.maxLoadTimeMs=rt,nt.maxTimeToFirstByteMs=rt;break;case"MaxRetry":nt.errorRetry.maxNumRetry=rt,nt.timeoutRetry.maxNumRetry=rt;break;case"RetryDelay":nt.errorRetry.retryDelayMs=rt,nt.timeoutRetry.retryDelayMs=rt;break;case"MaxRetryTimeout":nt.errorRetry.maxRetryDelayMs=rt,nt.timeoutRetry.maxRetryDelayMs=rt;break}}}),Ke.length&&logger.warn(`hls.js config: "${Ke.join('", "')}" setting(s) are deprecated, use "${be}": ${JSON.stringify(Z[be])}`)}),_objectSpread2(_objectSpread2({},ee),Z)}function deepCpy(ie){return ie&&typeof ie=="object"?Array.isArray(ie)?ie.map(deepCpy):Object.keys(ie).reduce((Z,ee)=>(Z[ee]=deepCpy(ie[ee]),Z),{}):ie}function enableStreamingMode(ie){const Z=ie.loader;Z!==FetchLoader&&Z!==XhrLoader?(logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),ie.progressive=!1):fetchSupported()&&(ie.loader=FetchLoader,ie.progressive=!0,ie.enableSoftwareAES=!0,logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}let chromeOrFirefox;class LevelController extends BasePlaylistController{constructor(Z,ee){super(Z,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=ee,this._registerListeners()}_registerListeners(){const{hls:Z}=this;Z.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),Z.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),Z.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),Z.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),Z.on(Events.ERROR,this.onError,this)}_unregisterListeners(){const{hls:Z}=this;Z.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),Z.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),Z.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),Z.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),Z.off(Events.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(Z=>{Z.loadError=0,Z.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(Z,ee){this.resetLevels()}onManifestLoaded(Z,ee){const ae=this.hls.config.preferManagedMediaSource,ye=[],ve={},be={};let Ye=!1,Ke=!1,Xe=!1;ee.levels.forEach(Je=>{var rt,nt;const it=Je.attrs;let{audioCodec:lt,videoCodec:ct}=Je;((rt=lt)==null?void 0:rt.indexOf("mp4a.40.34"))!==-1&&(chromeOrFirefox||(chromeOrFirefox=/chrome|firefox/i.test(navigator.userAgent)),chromeOrFirefox&&(Je.audioCodec=lt=void 0)),lt&&(Je.audioCodec=lt=getCodecCompatibleName(lt,ae)),((nt=ct)==null?void 0:nt.indexOf("avc1"))===0&&(ct=Je.videoCodec=convertAVC1ToAVCOTI(ct));const{width:ot,height:dt,unknownCodecs:ft}=Je;if(Ye||(Ye=!!(ot&&dt)),Ke||(Ke=!!ct),Xe||(Xe=!!lt),ft!=null&&ft.length||lt&&!areCodecsMediaSourceSupported(lt,"audio",ae)||ct&&!areCodecsMediaSourceSupported(ct,"video",ae))return;const{CODECS:gt,"FRAME-RATE":mt,"HDCP-LEVEL":Yr,"PATHWAY-ID":Qr,RESOLUTION:Xr,"VIDEO-RANGE":Jr}=it,ai=`${`${Qr||"."}-`}${Je.bitrate}-${Xr}-${mt}-${gt}-${Jr}-${Yr}`;if(ve[ai])if(ve[ai].uri!==Je.url&&!Je.attrs["PATHWAY-ID"]){const oi=be[ai]+=1;Je.attrs["PATHWAY-ID"]=new Array(oi+1).join(".");const ni=new Level(Je);ve[ai]=ni,ye.push(ni)}else ve[ai].addGroupId("audio",it.AUDIO),ve[ai].addGroupId("text",it.SUBTITLES);else{const oi=new Level(Je);ve[ai]=oi,be[ai]=1,ye.push(oi)}}),this.filterAndSortMediaOptions(ye,ee,Ye,Ke,Xe)}filterAndSortMediaOptions(Z,ee,ae,ye,ve){let be=[],Ye=[],Ke=Z;if((ae||ye)&&ve&&(Ke=Ke.filter(({videoCodec:lt,videoRange:ct,width:ot,height:dt})=>(!!lt||!!(ot&&dt))&&isVideoRange(ct))),Ke.length===0){Promise.resolve().then(()=>{if(this.hls){ee.levels.length&&this.warn(`One or more CODECS in variant not supported: ${JSON.stringify(ee.levels[0].attrs)}`);const lt=new Error("no level with compatible codecs found in manifest");this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:ee.url,error:lt,reason:lt.message})}});return}if(ee.audioTracks){const{preferManagedMediaSource:lt}=this.hls.config;be=ee.audioTracks.filter(ct=>!ct.audioCodec||areCodecsMediaSourceSupported(ct.audioCodec,"audio",lt)),assignTrackIdsByGroup(be)}ee.subtitles&&(Ye=ee.subtitles,assignTrackIdsByGroup(Ye));const Xe=Ke.slice(0);Ke.sort((lt,ct)=>{if(lt.attrs["HDCP-LEVEL"]!==ct.attrs["HDCP-LEVEL"])return(lt.attrs["HDCP-LEVEL"]||"")>(ct.attrs["HDCP-LEVEL"]||"")?1:-1;if(ae&&lt.height!==ct.height)return lt.height-ct.height;if(lt.frameRate!==ct.frameRate)return lt.frameRate-ct.frameRate;if(lt.videoRange!==ct.videoRange)return VideoRangeValues.indexOf(lt.videoRange)-VideoRangeValues.indexOf(ct.videoRange);if(lt.videoCodec!==ct.videoCodec){const ot=videoCodecPreferenceValue(lt.videoCodec),dt=videoCodecPreferenceValue(ct.videoCodec);if(ot!==dt)return dt-ot}if(lt.uri===ct.uri&&lt.codecSet!==ct.codecSet){const ot=codecsSetSelectionPreferenceValue(lt.codecSet),dt=codecsSetSelectionPreferenceValue(ct.codecSet);if(ot!==dt)return dt-ot}return lt.averageBitrate!==ct.averageBitrate?lt.averageBitrate-ct.averageBitrate:0});let Je=Xe[0];if(this.steering&&(Ke=this.steering.filterParsedLevels(Ke),Ke.length!==Xe.length)){for(let lt=0;lt<Xe.length;lt++)if(Xe[lt].pathwayId===Ke[0].pathwayId){Je=Xe[lt];break}}this._levels=Ke;for(let lt=0;lt<Ke.length;lt++)if(Ke[lt]===Je){var rt;this._firstLevel=lt;const ct=Je.bitrate,ot=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${Ke.length} level(s) found, first bitrate: ${ct}`),((rt=this.hls.userConfig)==null?void 0:rt.abrEwmaDefaultEstimate)===void 0){const dt=Math.min(ct,this.hls.config.abrEwmaDefaultEstimateMax);dt>ot&&ot===hlsDefaultConfig.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=dt)}break}const nt=ve&&!ye,it={levels:Ke,audioTracks:be,subtitleTracks:Ye,sessionData:ee.sessionData,sessionKeys:ee.sessionKeys,firstLevel:this._firstLevel,stats:ee.stats,audio:ve,video:ye,altAudio:!nt&&be.some(lt=>!!lt.url)};this.hls.trigger(Events.MANIFEST_PARSED,it),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return this._levels.length===0?null:this._levels}get level(){return this.currentLevelIndex}set level(Z){const ee=this._levels;if(ee.length===0)return;if(Z<0||Z>=ee.length){const Je=new Error("invalid level idx"),rt=Z<0;if(this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.LEVEL_SWITCH_ERROR,level:Z,fatal:rt,error:Je,reason:Je.message}),rt)return;Z=Math.min(Z,ee.length-1)}const ae=this.currentLevelIndex,ye=this.currentLevel,ve=ye?ye.attrs["PATHWAY-ID"]:void 0,be=ee[Z],Ye=be.attrs["PATHWAY-ID"];if(this.currentLevelIndex=Z,this.currentLevel=be,ae===Z&&be.details&&ye&&ve===Ye)return;this.log(`Switching to level ${Z} (${be.height?be.height+"p ":""}${be.videoRange?be.videoRange+" ":""}${be.codecSet?be.codecSet+" ":""}@${be.bitrate})${Ye?" with Pathway "+Ye:""} from level ${ae}${ve?" with Pathway "+ve:""}`);const Ke={level:Z,attrs:be.attrs,details:be.details,bitrate:be.bitrate,averageBitrate:be.averageBitrate,maxBitrate:be.maxBitrate,realBitrate:be.realBitrate,width:be.width,height:be.height,codecSet:be.codecSet,audioCodec:be.audioCodec,videoCodec:be.videoCodec,audioGroups:be.audioGroups,subtitleGroups:be.subtitleGroups,loaded:be.loaded,loadError:be.loadError,fragmentError:be.fragmentError,name:be.name,id:be.id,uri:be.uri,url:be.url,urlId:0,audioGroupIds:be.audioGroupIds,textGroupIds:be.textGroupIds};this.hls.trigger(Events.LEVEL_SWITCHING,Ke);const Xe=be.details;if(!Xe||Xe.live){const Je=this.switchParams(be.uri,ye==null?void 0:ye.details);this.loadPlaylist(Je)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(Z){this.manualLevelIndex=Z,this._startLevel===void 0&&(this._startLevel=Z),Z!==-1&&(this.level=Z)}get firstLevel(){return this._firstLevel}set firstLevel(Z){this._firstLevel=Z}get startLevel(){if(this._startLevel===void 0){const Z=this.hls.config.startLevel;return Z!==void 0?Z:this.hls.firstAutoLevel}return this._startLevel}set startLevel(Z){this._startLevel=Z}onError(Z,ee){ee.fatal||!ee.context||ee.context.type===PlaylistContextType.LEVEL&&ee.context.level===this.level&&this.checkRetry(ee)}onFragBuffered(Z,{frag:ee}){if(ee!==void 0&&ee.type===PlaylistLevelType.MAIN){const ae=ee.elementaryStreams;if(!Object.keys(ae).some(ve=>!!ae[ve]))return;const ye=this._levels[ee.level];ye!=null&&ye.loadError&&(this.log(`Resetting level error count of ${ye.loadError} on frag buffered`),ye.loadError=0)}}onLevelLoaded(Z,ee){var ae;const{level:ye,details:ve}=ee,be=this._levels[ye];if(!be){var Ye;this.warn(`Invalid level index ${ye}`),(Ye=ee.deliveryDirectives)!=null&&Ye.skip&&(ve.deltaUpdateFailed=!0);return}ye===this.currentLevelIndex?(be.fragmentError===0&&(be.loadError=0),this.playlistLoaded(ye,ee,be.details)):(ae=ee.deliveryDirectives)!=null&&ae.skip&&(ve.deltaUpdateFailed=!0)}loadPlaylist(Z){super.loadPlaylist();const ee=this.currentLevelIndex,ae=this.currentLevel;if(ae&&this.shouldLoadPlaylist(ae)){let ye=ae.uri;if(Z)try{ye=Z.addDirectives(ye)}catch(be){this.warn(`Could not construct new URL with HLS Delivery Directives: ${be}`)}const ve=ae.attrs["PATHWAY-ID"];this.log(`Loading level index ${ee}${(Z==null?void 0:Z.msn)!==void 0?" at sn "+Z.msn+" part "+Z.part:""} with${ve?" Pathway "+ve:""} ${ye}`),this.clearTimer(),this.hls.trigger(Events.LEVEL_LOADING,{url:ye,level:ee,pathwayId:ae.attrs["PATHWAY-ID"],id:0,deliveryDirectives:Z||null})}}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(Z){this.level=Z,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=Z)}removeLevel(Z){var ee;const ae=this._levels.filter((ye,ve)=>ve!==Z?!0:(this.steering&&this.steering.removeLevel(ye),ye===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,ye.details&&ye.details.fragments.forEach(be=>be.level=-1)),!1));reassignFragmentLevelIndexes(ae),this._levels=ae,this.currentLevelIndex>-1&&(ee=this.currentLevel)!=null&&ee.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.hls.trigger(Events.LEVELS_UPDATED,{levels:ae})}onLevelsUpdated(Z,{levels:ee}){this._levels=ee}checkMaxAutoUpdated(){const{autoLevelCapping:Z,maxAutoLevel:ee,maxHdcpLevel:ae}=this.hls;this._maxAutoLevel!==ee&&(this._maxAutoLevel=ee,this.hls.trigger(Events.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:Z,levels:this.levels,maxAutoLevel:ee,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:ae}))}}function assignTrackIdsByGroup(ie){const Z={};ie.forEach(ee=>{const ae=ee.groupId||"";ee.id=Z[ae]=Z[ae]||0,Z[ae]++})}class KeyLoader{constructor(Z){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=Z}abort(Z){for(const ae in this.keyUriToKeyInfo){const ye=this.keyUriToKeyInfo[ae].loader;if(ye){var ee;if(Z&&Z!==((ee=ye.context)==null?void 0:ee.frag.type))return;ye.abort()}}}detach(){for(const Z in this.keyUriToKeyInfo){const ee=this.keyUriToKeyInfo[Z];(ee.mediaKeySessionContext||ee.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[Z]}}destroy(){this.detach();for(const Z in this.keyUriToKeyInfo){const ee=this.keyUriToKeyInfo[Z].loader;ee&&ee.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(Z,ee=ErrorDetails.KEY_LOAD_ERROR,ae,ye,ve){return new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ee,fatal:!1,frag:Z,response:ve,error:ae,networkDetails:ye})}loadClear(Z,ee){if(this.emeController&&this.config.emeEnabled){const{sn:ae,cc:ye}=Z;for(let ve=0;ve<ee.length;ve++){const be=ee[ve];if(ye<=be.cc&&(ae==="initSegment"||be.sn==="initSegment"||ae<be.sn)){this.emeController.selectKeySystemFormat(be).then(Ye=>{be.setKeyFormat(Ye)});break}}}}load(Z){return!Z.decryptdata&&Z.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(Z).then(ee=>this.loadInternal(Z,ee)):this.loadInternal(Z)}loadInternal(Z,ee){var ae,ye;ee&&Z.setKeyFormat(ee);const ve=Z.decryptdata;if(!ve){const Xe=new Error(ee?`Expected frag.decryptdata to be defined after setting format ${ee}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(Z,ErrorDetails.KEY_LOAD_ERROR,Xe))}const be=ve.uri;if(!be)return Promise.reject(this.createKeyLoadError(Z,ErrorDetails.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${be}"`)));let Ye=this.keyUriToKeyInfo[be];if((ae=Ye)!=null&&ae.decryptdata.key)return ve.key=Ye.decryptdata.key,Promise.resolve({frag:Z,keyInfo:Ye});if((ye=Ye)!=null&&ye.keyLoadPromise){var Ke;switch((Ke=Ye.mediaKeySessionContext)==null?void 0:Ke.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return Ye.keyLoadPromise.then(Xe=>(ve.key=Xe.keyInfo.decryptdata.key,{frag:Z,keyInfo:Ye}))}}switch(Ye=this.keyUriToKeyInfo[be]={decryptdata:ve,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},ve.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return ve.keyFormat==="identity"?this.loadKeyHTTP(Ye,Z):this.loadKeyEME(Ye,Z);case"AES-128":return this.loadKeyHTTP(Ye,Z);default:return Promise.reject(this.createKeyLoadError(Z,ErrorDetails.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${ve.method}"`)))}}loadKeyEME(Z,ee){const ae={frag:ee,keyInfo:Z};if(this.emeController&&this.config.emeEnabled){const ye=this.emeController.loadKey(ae);if(ye)return(Z.keyLoadPromise=ye.then(ve=>(Z.mediaKeySessionContext=ve,ae))).catch(ve=>{throw Z.keyLoadPromise=null,ve})}return Promise.resolve(ae)}loadKeyHTTP(Z,ee){const ae=this.config,ye=ae.loader,ve=new ye(ae);return ee.keyLoader=Z.loader=ve,Z.keyLoadPromise=new Promise((be,Ye)=>{const Ke={keyInfo:Z,frag:ee,responseType:"arraybuffer",url:Z.decryptdata.uri},Xe=ae.keyLoadPolicy.default,Je={loadPolicy:Xe,timeout:Xe.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},rt={onSuccess:(nt,it,lt,ct)=>{const{frag:ot,keyInfo:dt,url:ft}=lt;if(!ot.decryptdata||dt!==this.keyUriToKeyInfo[ft])return Ye(this.createKeyLoadError(ot,ErrorDetails.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),ct));dt.decryptdata.key=ot.decryptdata.key=new Uint8Array(nt.data),ot.keyLoader=null,dt.loader=null,be({frag:ot,keyInfo:dt})},onError:(nt,it,lt,ct)=>{this.resetLoader(it),Ye(this.createKeyLoadError(ee,ErrorDetails.KEY_LOAD_ERROR,new Error(`HTTP Error ${nt.code} loading key ${nt.text}`),lt,_objectSpread2({url:Ke.url,data:void 0},nt)))},onTimeout:(nt,it,lt)=>{this.resetLoader(it),Ye(this.createKeyLoadError(ee,ErrorDetails.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),lt))},onAbort:(nt,it,lt)=>{this.resetLoader(it),Ye(this.createKeyLoadError(ee,ErrorDetails.INTERNAL_ABORTED,new Error("key loading aborted"),lt))}};ve.load(Ke,Je,rt)})}resetLoader(Z){const{frag:ee,keyInfo:ae,url:ye}=Z,ve=ae.loader;ee.keyLoader===ve&&(ee.keyLoader=null,ae.loader=null),delete this.keyUriToKeyInfo[ye],ve&&ve.destroy()}}function getSourceBuffer(){return self.SourceBuffer||self.WebKitSourceBuffer}function isMSESupported(){if(!getMediaSource())return!1;const ie=getSourceBuffer();return!ie||ie.prototype&&typeof ie.prototype.appendBuffer=="function"&&typeof ie.prototype.remove=="function"}function isSupported(){if(!isMSESupported())return!1;const ie=getMediaSource();return typeof(ie==null?void 0:ie.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(Z=>ie.isTypeSupported(mimeTypeForCodec(Z,"video")))||["mp4a.40.2","fLaC"].some(Z=>ie.isTypeSupported(mimeTypeForCodec(Z,"audio"))))}function changeTypeSupported(){var ie;const Z=getSourceBuffer();return typeof(Z==null||(ie=Z.prototype)==null?void 0:ie.changeType)=="function"}const STALL_MINIMUM_DURATION_MS=250,MAX_START_GAP_JUMP=2,SKIP_BUFFER_HOLE_STEP_SECONDS=.1,SKIP_BUFFER_RANGE_START=.05;class GapController{constructor(Z,ee,ae,ye){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=Z,this.media=ee,this.fragmentTracker=ae,this.hls=ye}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(Z,ee){const{config:ae,media:ye,stalled:ve}=this;if(ye===null)return;const{currentTime:be,seeking:Ye}=ye,Ke=this.seeking&&!Ye,Xe=!this.seeking&&Ye;if(this.seeking=Ye,be!==Z){if(this.moved=!0,Ye||(this.nudgeRetry=0),ve!==null){if(this.stallReported){const ot=self.performance.now()-ve;logger.warn(`playback not stuck anymore @${be}, after ${Math.round(ot)}ms`),this.stallReported=!1}this.stalled=null}return}if(Xe||Ke){this.stalled=null;return}if(ye.paused&&!Ye||ye.ended||ye.playbackRate===0||!BufferHelper.getBuffered(ye).length){this.nudgeRetry=0;return}const Je=BufferHelper.bufferInfo(ye,be,0),rt=Je.nextStart||0;if(Ye){const ot=Je.len>MAX_START_GAP_JUMP,dt=!rt||ee&&ee.start<=be||rt-be>MAX_START_GAP_JUMP&&!this.fragmentTracker.getPartialFragment(be);if(ot||dt)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var nt;if(!(Je.len>0)&&!rt)return;const ot=Math.max(rt,Je.start||0)-be,dt=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,ft=!(dt==null||(nt=dt.details)==null)&&nt.live?dt.details.targetduration*2:MAX_START_GAP_JUMP,gt=this.fragmentTracker.getPartialFragment(be);if(ot>0&&(ot<=ft||gt)){ye.paused||this._trySkipBufferHole(gt);return}}const it=self.performance.now();if(ve===null){this.stalled=it;return}const lt=it-ve;if(!Ye&&lt>=STALL_MINIMUM_DURATION_MS&&(this._reportStall(Je),!this.media))return;const ct=BufferHelper.bufferInfo(ye,be,ae.maxBufferHole);this._tryFixBufferStall(ct,lt)}_tryFixBufferStall(Z,ee){const{config:ae,fragmentTracker:ye,media:ve}=this;if(ve===null)return;const be=ve.currentTime,Ye=ye.getPartialFragment(be);Ye&&(this._trySkipBufferHole(Ye)||!this.media)||(Z.len>ae.maxBufferHole||Z.nextStart&&Z.nextStart-be<ae.maxBufferHole)&&ee>ae.highBufferWatchdogPeriod*1e3&&(logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(Z){const{hls:ee,media:ae,stallReported:ye}=this;if(!ye&&ae){this.stallReported=!0;const ve=new Error(`Playback stalling at @${ae.currentTime} due to low buffer (${JSON.stringify(Z)})`);logger.warn(ve.message),ee.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,error:ve,buffer:Z.len})}}_trySkipBufferHole(Z){const{config:ee,hls:ae,media:ye}=this;if(ye===null)return 0;const ve=ye.currentTime,be=BufferHelper.bufferInfo(ye,ve,0),Ye=ve<be.start?be.start:be.nextStart;if(Ye){const Ke=be.len<=ee.maxBufferHole,Xe=be.len>0&&be.len<1&&ye.readyState<3,Je=Ye-ve;if(Je>0&&(Ke||Xe)){if(Je>ee.maxBufferHole){const{fragmentTracker:nt}=this;let it=!1;if(ve===0){const lt=nt.getAppendedFrag(0,PlaylistLevelType.MAIN);lt&&Ye<lt.end&&(it=!0)}if(!it){const lt=Z||nt.getAppendedFrag(ve,PlaylistLevelType.MAIN);if(lt){let ct=!1,ot=lt.end;for(;ot<Ye;){const dt=nt.getPartialFragment(ot);if(dt)ot+=dt.duration;else{ct=!0;break}}if(ct)return 0}}}const rt=Math.max(Ye+SKIP_BUFFER_RANGE_START,ve+SKIP_BUFFER_HOLE_STEP_SECONDS);if(logger.warn(`skipping hole, adjusting currentTime from ${ve} to ${rt}`),this.moved=!0,this.stalled=null,ye.currentTime=rt,Z&&!Z.gap){const nt=new Error(`fragment loaded with buffer holes, seeking from ${ve} to ${rt}`);ae.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:nt,reason:nt.message,frag:Z})}return rt}}return 0}_tryNudgeBuffer(){const{config:Z,hls:ee,media:ae,nudgeRetry:ye}=this;if(ae===null)return;const ve=ae.currentTime;if(this.nudgeRetry++,ye<Z.nudgeMaxRetry){const be=ve+(ye+1)*Z.nudgeOffset,Ye=new Error(`Nudging 'currentTime' from ${ve} to ${be}`);logger.warn(Ye.message),ae.currentTime=be,ee.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_NUDGE_ON_STALL,error:Ye,fatal:!1})}else{const be=new Error(`Playhead still not moving while enough data buffered @${ve} after ${Z.nudgeMaxRetry} nudges`);logger.error(be.message),ee.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_STALLED_ERROR,error:be,fatal:!0})}}}const TICK_INTERVAL=100;class StreamController extends BaseStreamController{constructor(Z,ee,ae){super(Z,ee,ae,"[stream-controller]",PlaylistLevelType.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:Z}=this;Z.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),Z.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),Z.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),Z.on(Events.LEVEL_LOADING,this.onLevelLoading,this),Z.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),Z.on(Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),Z.on(Events.ERROR,this.onError,this),Z.on(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),Z.on(Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),Z.on(Events.BUFFER_CREATED,this.onBufferCreated,this),Z.on(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),Z.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),Z.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:Z}=this;Z.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),Z.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),Z.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),Z.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),Z.off(Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),Z.off(Events.ERROR,this.onError,this),Z.off(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),Z.off(Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),Z.off(Events.BUFFER_CREATED,this.onBufferCreated,this),Z.off(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),Z.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),Z.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying()}startLoad(Z){if(this.levels){const{lastCurrentTime:ee,hls:ae}=this;if(this.stopLoad(),this.setInterval(TICK_INTERVAL),this.level=-1,!this.startFragRequested){let ye=ae.startLevel;ye===-1&&(ae.config.testBandwidth&&this.levels.length>1?(ye=0,this.bitrateTest=!0):ye=ae.firstAutoLevel),this.level=ae.nextLoadLevel=ye,this.loadedmetadata=!1}ee>0&&Z===-1&&(this.log(`Override startPosition with lastCurrentTime @${ee.toFixed(3)}`),Z=ee),this.state=State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=Z,this.tick()}else this._forceStartLoad=!0,this.state=State.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case State.WAITING_LEVEL:{const{levels:ee,level:ae}=this,ye=ee==null?void 0:ee[ae],ve=ye==null?void 0:ye.details;if(ve&&(!ve.live||this.levelLastLoaded===ye)){if(this.waitForCdnTuneIn(ve))break;this.state=State.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=State.IDLE;break}break}case State.FRAG_LOADING_WAITING_RETRY:{var Z;const ee=self.performance.now(),ae=this.retryDate;if(!ae||ee>=ae||(Z=this.media)!=null&&Z.seeking){const{levels:ye,level:ve}=this,be=ye==null?void 0:ye[ve];this.resetStartWhenNotLoaded(be||null),this.state=State.IDLE}}break}this.state===State.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:Z,levelLastLoaded:ee,levels:ae,media:ye}=this,{config:ve,nextLoadLevel:be}=Z;if(ee===null||!ye&&(this.startFragRequested||!ve.startFragPrefetch)||this.altAudio&&this.audioOnly||!(ae!=null&&ae[be]))return;const Ye=ae[be],Ke=this.getMainFwdBufferInfo();if(Ke===null)return;const Xe=this.getLevelDetails();if(Xe&&this._streamEnded(Ke,Xe)){const ot={};this.altAudio&&(ot.type="video"),this.hls.trigger(Events.BUFFER_EOS,ot),this.state=State.ENDED;return}Z.loadLevel!==be&&Z.manualLevel===-1&&this.log(`Adapting to level ${be} from level ${this.level}`),this.level=Z.nextLoadLevel=be;const Je=Ye.details;if(!Je||this.state===State.WAITING_LEVEL||Je.live&&this.levelLastLoaded!==Ye){this.level=be,this.state=State.WAITING_LEVEL;return}const rt=Ke.len,nt=this.getMaxBufferLength(Ye.maxBitrate);if(rt>=nt)return;this.backtrackFragment&&this.backtrackFragment.start>Ke.end&&(this.backtrackFragment=null);const it=this.backtrackFragment?this.backtrackFragment.start:Ke.end;let lt=this.getNextFragment(it,Je);if(this.couldBacktrack&&!this.fragPrevious&&lt&&lt.sn!=="initSegment"&&this.fragmentTracker.getState(lt)!==FragmentState.OK){var ct;const ot=((ct=this.backtrackFragment)!=null?ct:lt).sn-Je.startSN,dt=Je.fragments[ot-1];dt&&lt.cc===dt.cc&&(lt=dt,this.fragmentTracker.removeFragment(dt))}else this.backtrackFragment&&Ke.len&&(this.backtrackFragment=null);if(lt&&this.isLoopLoading(lt,it)){if(!lt.gap){const ot=this.audioOnly&&!this.altAudio?ElementaryStreamTypes.AUDIO:ElementaryStreamTypes.VIDEO,dt=(ot===ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;dt&&this.afterBufferFlushed(dt,ot,PlaylistLevelType.MAIN)}lt=this.getNextFragmentLoopLoading(lt,Je,Ke,PlaylistLevelType.MAIN,nt)}lt&&(lt.initSegment&&!lt.initSegment.data&&!this.bitrateTest&&(lt=lt.initSegment),this.loadFragment(lt,Ye,it))}loadFragment(Z,ee,ae){const ye=this.fragmentTracker.getState(Z);this.fragCurrent=Z,ye===FragmentState.NOT_LOADED||ye===FragmentState.PARTIAL?Z.sn==="initSegment"?this._loadInitSegment(Z,ee):this.bitrateTest?(this.log(`Fragment ${Z.sn} of level ${Z.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(Z,ee)):(this.startFragRequested=!0,super.loadFragment(Z,ee,ae)):this.clearTrackerIfNeeded(Z)}getBufferedFrag(Z){return this.fragmentTracker.getBufferedFrag(Z,PlaylistLevelType.MAIN)}followingBufferedFrag(Z){return Z?this.getBufferedFrag(Z.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:Z,media:ee}=this;if(ee!=null&&ee.readyState){let ae;const ye=this.getAppendedFrag(ee.currentTime);ye&&ye.start>1&&this.flushMainBuffer(0,ye.start-1);const ve=this.getLevelDetails();if(ve!=null&&ve.live){const Ye=this.getMainFwdBufferInfo();if(!Ye||Ye.len<ve.targetduration*2)return}if(!ee.paused&&Z){const Ye=this.hls.nextLoadLevel,Ke=Z[Ye],Xe=this.fragLastKbps;Xe&&this.fragCurrent?ae=this.fragCurrent.duration*Ke.maxBitrate/(1e3*Xe)+1:ae=0}else ae=0;const be=this.getBufferedFrag(ee.currentTime+ae);if(be){const Ye=this.followingBufferedFrag(be);if(Ye){this.abortCurrentFrag();const Ke=Ye.maxStartPTS?Ye.maxStartPTS:Ye.start,Xe=Ye.duration,Je=Math.max(be.end,Ke+Math.min(Math.max(Xe-this.config.maxFragLookUpTolerance,Xe*(this.couldBacktrack?.5:.125)),Xe*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(Je,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const Z=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,Z&&(Z.abortRequests(),this.fragmentTracker.removeFragment(Z)),this.state){case State.KEY_LOADING:case State.FRAG_LOADING:case State.FRAG_LOADING_WAITING_RETRY:case State.PARSING:case State.PARSED:this.state=State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(Z,ee){super.flushMainBuffer(Z,ee,this.altAudio?"video":null)}onMediaAttached(Z,ee){super.onMediaAttached(Z,ee);const ae=ee.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),ae.addEventListener("playing",this.onvplaying),ae.addEventListener("seeked",this.onvseeked),this.gapController=new GapController(this.config,ae,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:Z}=this;Z&&this.onvplaying&&this.onvseeked&&(Z.removeEventListener("playing",this.onvplaying),Z.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const Z=this.media,ee=Z?Z.currentTime:null;isFiniteNumber(ee)&&this.log(`Media seeked to ${ee.toFixed(3)}`);const ae=this.getMainFwdBufferInfo();if(ae===null||ae.len===0){this.warn(`Main forward buffer length on "seeked" event ${ae?ae.len:"empty"})`);return}this.tick()}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=this.fragLastKbps=0,this.levels=this.fragPlaying=this.backtrackFragment=this.levelLastLoaded=null,this.altAudio=this.audioOnly=this.startFragRequested=!1}onManifestParsed(Z,ee){let ae=!1,ye=!1;ee.levels.forEach(ve=>{const be=ve.audioCodec;be&&(ae=ae||be.indexOf("mp4a.40.2")!==-1,ye=ye||be.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=ae&&ye&&!changeTypeSupported(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=ee.levels,this.startFragRequested=!1}onLevelLoading(Z,ee){const{levels:ae}=this;if(!ae||this.state!==State.IDLE)return;const ye=ae[ee.level];(!ye.details||ye.details.live&&this.levelLastLoaded!==ye||this.waitForCdnTuneIn(ye.details))&&(this.state=State.WAITING_LEVEL)}onLevelLoaded(Z,ee){var ae;const{levels:ye}=this,ve=ee.level,be=ee.details,Ye=be.totalduration;if(!ye){this.warn(`Levels were reset while loading level ${ve}`);return}this.log(`Level ${ve} loaded [${be.startSN},${be.endSN}]${be.lastPartSn?`[part-${be.lastPartSn}-${be.lastPartIndex}]`:""}, cc [${be.startCC}, ${be.endCC}] duration:${Ye}`);const Ke=ye[ve],Xe=this.fragCurrent;Xe&&(this.state===State.FRAG_LOADING||this.state===State.FRAG_LOADING_WAITING_RETRY)&&Xe.level!==ee.level&&Xe.loader&&this.abortCurrentFrag();let Je=0;if(be.live||(ae=Ke.details)!=null&&ae.live){var rt;if(this.checkLiveUpdate(be),be.deltaUpdateFailed)return;Je=this.alignPlaylists(be,Ke.details,(rt=this.levelLastLoaded)==null?void 0:rt.details)}if(Ke.details=be,this.levelLastLoaded=Ke,this.hls.trigger(Events.LEVEL_UPDATED,{details:be,level:ve}),this.state===State.WAITING_LEVEL){if(this.waitForCdnTuneIn(be))return;this.state=State.IDLE}this.startFragRequested?be.live&&this.synchronizeToLiveEdge(be):this.setStartPosition(be,Je),this.tick()}_handleFragmentLoadProgress(Z){var ee;const{frag:ae,part:ye,payload:ve}=Z,{levels:be}=this;if(!be){this.warn(`Levels were reset while fragment load was in progress. Fragment ${ae.sn} of level ${ae.level} will not be buffered`);return}const Ye=be[ae.level],Ke=Ye.details;if(!Ke){this.warn(`Dropping fragment ${ae.sn} of level ${ae.level} after level details were reset`),this.fragmentTracker.removeFragment(ae);return}const Xe=Ye.videoCodec,Je=Ke.PTSKnown||!Ke.live,rt=(ee=ae.initSegment)==null?void 0:ee.data,nt=this._getAudioCodec(Ye),it=this.transmuxer=this.transmuxer||new TransmuxerInterface(this.hls,PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),lt=ye?ye.index:-1,ct=lt!==-1,ot=new ChunkMetadata(ae.level,ae.sn,ae.stats.chunkCount,ve.byteLength,lt,ct),dt=this.initPTS[ae.cc];it.push(ve,rt,nt,Xe,ae,ye,Ke.totalduration,Je,ot,dt)}onAudioTrackSwitching(Z,ee){const ae=this.altAudio;if(!ee.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const ve=this.fragCurrent;ve&&(this.log("Switching to main audio track, cancel main fragment load"),ve.abortRequests(),this.fragmentTracker.removeFragment(ve)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const ye=this.hls;ae&&(ye.trigger(Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),ye.trigger(Events.AUDIO_TRACK_SWITCHED,ee)}}onAudioTrackSwitched(Z,ee){const ae=ee.id,ye=!!this.hls.audioTracks[ae].url;if(ye){const ve=this.videoBuffer;ve&&this.mediaBuffer!==ve&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=ve)}this.altAudio=ye,this.tick()}onBufferCreated(Z,ee){const ae=ee.tracks;let ye,ve,be=!1;for(const Ye in ae){const Ke=ae[Ye];if(Ke.id==="main"){if(ve=Ye,ye=Ke,Ye==="video"){const Xe=ae[Ye];Xe&&(this.videoBuffer=Xe.buffer)}}else be=!0}be&&ye?(this.log(`Alternate track found, use ${ve}.buffered to schedule main fragment loading`),this.mediaBuffer=ye.buffer):this.mediaBuffer=this.media}onFragBuffered(Z,ee){const{frag:ae,part:ye}=ee;if(ae&&ae.type!==PlaylistLevelType.MAIN)return;if(this.fragContextChanged(ae)){this.warn(`Fragment ${ae.sn}${ye?" p: "+ye.index:""} of level ${ae.level} finished buffering, but was aborted. state: ${this.state}`),this.state===State.PARSED&&(this.state=State.IDLE);return}const ve=ye?ye.stats:ae.stats;this.fragLastKbps=Math.round(8*ve.total/(ve.buffering.end-ve.loading.first)),ae.sn!=="initSegment"&&(this.fragPrevious=ae),this.fragBufferedComplete(ae,ye)}onError(Z,ee){var ae;if(ee.fatal){this.state=State.ERROR;return}switch(ee.details){case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_PARSING_ERROR:case ErrorDetails.FRAG_DECRYPT_ERROR:case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(PlaylistLevelType.MAIN,ee);break;case ErrorDetails.LEVEL_LOAD_ERROR:case ErrorDetails.LEVEL_LOAD_TIMEOUT:case ErrorDetails.LEVEL_PARSING_ERROR:!ee.levelRetry&&this.state===State.WAITING_LEVEL&&((ae=ee.context)==null?void 0:ae.type)===PlaylistContextType.LEVEL&&(this.state=State.IDLE);break;case ErrorDetails.BUFFER_APPEND_ERROR:case ErrorDetails.BUFFER_FULL_ERROR:if(!ee.parent||ee.parent!=="main")return;if(ee.details===ErrorDetails.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(ee)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case ErrorDetails.INTERNAL_EXCEPTION:this.recoverWorkerError(ee);break}}checkBuffer(){const{media:Z,gapController:ee}=this;if(!(!Z||!ee||!Z.readyState)){if(this.loadedmetadata||!BufferHelper.getBuffered(Z).length){const ae=this.state!==State.IDLE?this.fragCurrent:null;ee.poll(this.lastCurrentTime,ae)}this.lastCurrentTime=Z.currentTime}}onFragLoadEmergencyAborted(){this.state=State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(Z,{type:ee}){if(ee!==ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){const ae=(ee===ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(ae,ee,PlaylistLevelType.MAIN),this.tick()}}onLevelsUpdated(Z,ee){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level),this.levels=ee.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:Z}=this;if(!Z)return;const ee=Z.currentTime;let ae=this.startPosition;if(ae>=0&&ee<ae){if(Z.seeking){this.log(`could not seek to ${ae}, already seeking at ${ee}`);return}const ye=BufferHelper.getBuffered(Z),ve=(ye.length?ye.start(0):0)-ae;ve>0&&(ve<this.config.maxBufferHole||ve<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${ve} to match buffer start`),ae+=ve,this.startPosition=ae),this.log(`seek to target start position ${ae} from current time ${ee}`),Z.currentTime=ae}}_getAudioCodec(Z){let ee=this.config.defaultAudioCodec||Z.audioCodec;return this.audioCodecSwap&&ee&&(this.log("Swapping audio codec"),ee.indexOf("mp4a.40.5")!==-1?ee="mp4a.40.2":ee="mp4a.40.5"),ee}_loadBitrateTestFrag(Z,ee){Z.bitrateTest=!0,this._doFragLoad(Z,ee).then(ae=>{const{hls:ye}=this;if(!ae||this.fragContextChanged(Z))return;ee.fragmentError=0,this.state=State.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const ve=Z.stats;ve.parsing.start=ve.parsing.end=ve.buffering.start=ve.buffering.end=self.performance.now(),ye.trigger(Events.FRAG_LOADED,ae),Z.bitrateTest=!1})}_handleTransmuxComplete(Z){var ee;const ae="main",{hls:ye}=this,{remuxResult:ve,chunkMeta:be}=Z,Ye=this.getCurrentContext(be);if(!Ye){this.resetWhenMissingContext(be);return}const{frag:Ke,part:Xe,level:Je}=Ye,{video:rt,text:nt,id3:it,initSegment:lt}=ve,{details:ct}=Je,ot=this.altAudio?void 0:ve.audio;if(this.fragContextChanged(Ke)){this.fragmentTracker.removeFragment(Ke);return}if(this.state=State.PARSING,lt){if(lt!=null&&lt.tracks){const gt=Ke.initSegment||Ke;this._bufferInitSegment(Je,lt.tracks,gt,be),ye.trigger(Events.FRAG_PARSING_INIT_SEGMENT,{frag:gt,id:ae,tracks:lt.tracks})}const dt=lt.initPTS,ft=lt.timescale;isFiniteNumber(dt)&&(this.initPTS[Ke.cc]={baseTime:dt,timescale:ft},ye.trigger(Events.INIT_PTS_FOUND,{frag:Ke,id:ae,initPTS:dt,timescale:ft}))}if(rt&&ct&&Ke.sn!=="initSegment"){const dt=ct.fragments[Ke.sn-1-ct.startSN],ft=Ke.sn===ct.startSN,gt=!dt||Ke.cc>dt.cc;if(ve.independent!==!1){const{startPTS:mt,endPTS:Yr,startDTS:Qr,endDTS:Xr}=rt;if(Xe)Xe.elementaryStreams[rt.type]={startPTS:mt,endPTS:Yr,startDTS:Qr,endDTS:Xr};else if(rt.firstKeyFrame&&rt.independent&&be.id===1&&!gt&&(this.couldBacktrack=!0),rt.dropped&&rt.independent){const Jr=this.getMainFwdBufferInfo(),ai=(Jr?Jr.end:this.getLoadPosition())+this.config.maxBufferHole,oi=rt.firstKeyFramePTS?rt.firstKeyFramePTS:mt;if(!ft&&ai<oi-this.config.maxBufferHole&&!gt){this.backtrack(Ke);return}else gt&&(Ke.gap=!0);Ke.setElementaryStreamInfo(rt.type,Ke.start,Yr,Ke.start,Xr,!0)}else ft&&mt>MAX_START_GAP_JUMP&&(Ke.gap=!0);Ke.setElementaryStreamInfo(rt.type,mt,Yr,Qr,Xr),this.backtrackFragment&&(this.backtrackFragment=Ke),this.bufferFragmentData(rt,Ke,Xe,be,ft||gt)}else if(ft||gt)Ke.gap=!0;else{this.backtrack(Ke);return}}if(ot){const{startPTS:dt,endPTS:ft,startDTS:gt,endDTS:mt}=ot;Xe&&(Xe.elementaryStreams[ElementaryStreamTypes.AUDIO]={startPTS:dt,endPTS:ft,startDTS:gt,endDTS:mt}),Ke.setElementaryStreamInfo(ElementaryStreamTypes.AUDIO,dt,ft,gt,mt),this.bufferFragmentData(ot,Ke,Xe,be)}if(ct&&it!=null&&(ee=it.samples)!=null&&ee.length){const dt={id:ae,frag:Ke,details:ct,samples:it.samples};ye.trigger(Events.FRAG_PARSING_METADATA,dt)}if(ct&&nt){const dt={id:ae,frag:Ke,details:ct,samples:nt.samples};ye.trigger(Events.FRAG_PARSING_USERDATA,dt)}}_bufferInitSegment(Z,ee,ae,ye){if(this.state!==State.PARSING)return;this.audioOnly=!!ee.audio&&!ee.video,this.altAudio&&!this.audioOnly&&delete ee.audio;const{audio:ve,video:be,audiovideo:Ye}=ee;if(ve){let Ke=Z.audioCodec;const Xe=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(Ke&&(Ke.indexOf("mp4a.40.5")!==-1?Ke="mp4a.40.2":Ke="mp4a.40.5"),ve.metadata.channelCount!==1&&Xe.indexOf("firefox")===-1&&(Ke="mp4a.40.5")),Ke&&Ke.indexOf("mp4a.40.5")!==-1&&Xe.indexOf("android")!==-1&&ve.container!=="audio/mpeg"&&(Ke="mp4a.40.2",this.log(`Android: force audio codec to ${Ke}`)),Z.audioCodec&&Z.audioCodec!==Ke&&this.log(`Swapping manifest audio codec "${Z.audioCodec}" for "${Ke}"`),ve.levelCodec=Ke,ve.id="main",this.log(`Init audio buffer, container:${ve.container}, codecs[selected/level/parsed]=[${Ke||""}/${Z.audioCodec||""}/${ve.codec}]`)}be&&(be.levelCodec=Z.videoCodec,be.id="main",this.log(`Init video buffer, container:${be.container}, codecs[level/parsed]=[${Z.videoCodec||""}/${be.codec}]`)),Ye&&this.log(`Init audiovideo buffer, container:${Ye.container}, codecs[level/parsed]=[${Z.codecs}/${Ye.codec}]`),this.hls.trigger(Events.BUFFER_CODECS,ee),Object.keys(ee).forEach(Ke=>{const Xe=ee[Ke].initSegment;Xe!=null&&Xe.byteLength&&this.hls.trigger(Events.BUFFER_APPENDING,{type:Ke,data:Xe,frag:ae,part:null,chunkMeta:ye,parent:ae.type})}),this.tickImmediate()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,PlaylistLevelType.MAIN)}backtrack(Z){this.couldBacktrack=!0,this.backtrackFragment=Z,this.resetTransmuxer(),this.flushBufferGap(Z),this.fragmentTracker.removeFragment(Z),this.fragPrevious=null,this.nextLoadPosition=Z.start,this.state=State.IDLE}checkFragmentChanged(){const Z=this.media;let ee=null;if(Z&&Z.readyState>1&&Z.seeking===!1){const ae=Z.currentTime;if(BufferHelper.isBuffered(Z,ae)?ee=this.getAppendedFrag(ae):BufferHelper.isBuffered(Z,ae+.1)&&(ee=this.getAppendedFrag(ae+.1)),ee){this.backtrackFragment=null;const ye=this.fragPlaying,ve=ee.level;(!ye||ee.sn!==ye.sn||ye.level!==ve)&&(this.fragPlaying=ee,this.hls.trigger(Events.FRAG_CHANGED,{frag:ee}),(!ye||ye.level!==ve)&&this.hls.trigger(Events.LEVEL_SWITCHED,{level:ve}))}}}get nextLevel(){const Z=this.nextBufferedFrag;return Z?Z.level:-1}get currentFrag(){const Z=this.media;return Z?this.fragPlaying||this.getAppendedFrag(Z.currentTime):null}get currentProgramDateTime(){const Z=this.media;if(Z){const ee=Z.currentTime,ae=this.currentFrag;if(ae&&isFiniteNumber(ee)&&isFiniteNumber(ae.programDateTime)){const ye=ae.programDateTime+(ee-ae.start)*1e3;return new Date(ye)}}return null}get currentLevel(){const Z=this.currentFrag;return Z?Z.level:-1}get nextBufferedFrag(){const Z=this.currentFrag;return Z?this.followingBufferedFrag(Z):null}get forceStartLoad(){return this._forceStartLoad}}class Hls{static get version(){return"1.5.3"}static isMSESupported(){return isMSESupported()}static isSupported(){return isSupported()}static getMediaSource(){return getMediaSource()}static get Events(){return Events}static get ErrorTypes(){return ErrorTypes}static get ErrorDetails(){return ErrorDetails}static get DefaultConfig(){return Hls.defaultConfig?Hls.defaultConfig:hlsDefaultConfig}static set DefaultConfig(Z){Hls.defaultConfig=Z}constructor(Z={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this.started=!1,this._emitter=new EventEmitter,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,this.triggeringException=void 0,enableLogs(Z.debug||!1,"Hls instance");const ee=this.config=mergeConfig(Hls.DefaultConfig,Z);this.userConfig=Z,ee.progressive&&enableStreamingMode(ee);const{abrController:ae,bufferController:ye,capLevelController:ve,errorController:be,fpsController:Ye}=ee,Ke=new be(this),Xe=this.abrController=new ae(this),Je=this.bufferController=new ye(this),rt=this.capLevelController=new ve(this),nt=new Ye(this),it=new PlaylistLoader(this),lt=new ID3TrackController(this),ct=ee.contentSteeringController,ot=ct?new ct(this):null,dt=this.levelController=new LevelController(this,ot),ft=new FragmentTracker(this),gt=new KeyLoader(this.config),mt=this.streamController=new StreamController(this,ft,gt);rt.setStreamController(mt),nt.setStreamController(mt);const Yr=[it,dt,mt];ot&&Yr.splice(1,0,ot),this.networkControllers=Yr;const Qr=[Xe,Je,rt,nt,lt,ft];this.audioTrackController=this.createController(ee.audioTrackController,Yr);const Xr=ee.audioStreamController;Xr&&Yr.push(new Xr(this,ft,gt)),this.subtitleTrackController=this.createController(ee.subtitleTrackController,Yr);const Jr=ee.subtitleStreamController;Jr&&Yr.push(new Jr(this,ft,gt)),this.createController(ee.timelineController,Qr),gt.emeController=this.emeController=this.createController(ee.emeController,Qr),this.cmcdController=this.createController(ee.cmcdController,Qr),this.latencyController=this.createController(LatencyController,Qr),this.coreComponents=Qr,Yr.push(Ke);const ai=Ke.onErrorOut;typeof ai=="function"&&this.on(Events.ERROR,ai,Ke)}createController(Z,ee){if(Z){const ae=new Z(this);return ee&&ee.push(ae),ae}return null}on(Z,ee,ae=this){this._emitter.on(Z,ee,ae)}once(Z,ee,ae=this){this._emitter.once(Z,ee,ae)}removeAllListeners(Z){this._emitter.removeAllListeners(Z)}off(Z,ee,ae=this,ye){this._emitter.off(Z,ee,ae,ye)}listeners(Z){return this._emitter.listeners(Z)}emit(Z,ee,ae){return this._emitter.emit(Z,ee,ae)}trigger(Z,ee){if(this.config.debug)return this.emit(Z,Z,ee);try{return this.emit(Z,Z,ee)}catch(ae){if(logger.error("An internal error happened while handling event "+Z+'. Error message: "'+ae.message+'". Here is a stacktrace:',ae),!this.triggeringException){this.triggeringException=!0;const ye=Z===Events.ERROR;this.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,fatal:ye,event:Z,error:ae}),this.triggeringException=!1}}return!1}listenerCount(Z){return this._emitter.listenerCount(Z)}destroy(){logger.log("destroy"),this.trigger(Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(ee=>ee.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(ee=>ee.destroy()),this.coreComponents.length=0;const Z=this.config;Z.xhrSetup=Z.fetchSetup=void 0,this.userConfig=null}attachMedia(Z){logger.log("attachMedia"),this._media=Z,this.trigger(Events.MEDIA_ATTACHING,{media:Z})}detachMedia(){logger.log("detachMedia"),this.trigger(Events.MEDIA_DETACHING,void 0),this._media=null}loadSource(Z){this.stopLoad();const ee=this.media,ae=this.url,ye=this.url=urlToolkitExports.buildAbsoluteURL(self.location.href,Z,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,logger.log(`loadSource:${ye}`),ee&&ae&&(ae!==ye||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(ee)),this.trigger(Events.MANIFEST_LOADING,{url:Z})}startLoad(Z=-1){logger.log(`startLoad(${Z})`),this.started=!0,this.networkControllers.forEach(ee=>{ee.startLoad(Z)})}stopLoad(){logger.log("stopLoad"),this.started=!1,this.networkControllers.forEach(Z=>{Z.stopLoad()})}resumeBuffering(){this.started&&this.networkControllers.forEach(Z=>{"fragmentLoader"in Z&&Z.startLoad(-1)})}pauseBuffering(){this.networkControllers.forEach(Z=>{"fragmentLoader"in Z&&Z.stopLoad()})}swapAudioCodec(){logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){logger.log("recoverMediaError");const Z=this._media;this.detachMedia(),Z&&this.attachMedia(Z)}removeLevel(Z){this.levelController.removeLevel(Z)}get levels(){return this.levelController.levels||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(Z){logger.log(`set currentLevel:${Z}`),this.levelController.manualLevel=Z,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(Z){logger.log(`set nextLevel:${Z}`),this.levelController.manualLevel=Z,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(Z){logger.log(`set loadLevel:${Z}`),this.levelController.manualLevel=Z}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(Z){this.levelController.nextLoadLevel=Z}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(Z){logger.log(`set firstLevel:${Z}`),this.levelController.firstLevel=Z}get startLevel(){const Z=this.levelController.startLevel;return Z===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:Z}set startLevel(Z){logger.log(`set startLevel:${Z}`),Z!==-1&&(Z=Math.max(Z,this.minAutoLevel)),this.levelController.startLevel=Z}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(Z){const ee=!!Z;ee!==this.config.capLevelToPlayerSize&&(ee?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=ee)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:Z}=this.abrController;return Z?Z.getEstimate():NaN}set bandwidthEstimate(Z){this.abrController.resetEstimator(Z)}get ttfbEstimate(){const{bwEstimator:Z}=this.abrController;return Z?Z.getEstimateTTFB():NaN}set autoLevelCapping(Z){this._autoLevelCapping!==Z&&(logger.log(`set autoLevelCapping:${Z}`),this._autoLevelCapping=Z,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(Z){isHdcpLevel(Z)&&this._maxHdcpLevel!==Z&&(this._maxHdcpLevel=Z,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:Z,config:{minAutoBitrate:ee}}=this;if(!Z)return 0;const ae=Z.length;for(let ye=0;ye<ae;ye++)if(Z[ye].maxBitrate>=ee)return ye;return 0}get maxAutoLevel(){const{levels:Z,autoLevelCapping:ee,maxHdcpLevel:ae}=this;let ye;if(ee===-1&&Z!=null&&Z.length?ye=Z.length-1:ye=ee,ae)for(let ve=ye;ve--;){const be=Z[ve].attrs["HDCP-LEVEL"];if(be&&be<=ae)return ve}return ye}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(Z){this.abrController.nextAutoLevel=Z}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}setAudioOption(Z){var ee;return(ee=this.audioTrackController)==null?void 0:ee.setAudioOption(Z)}setSubtitleOption(Z){var ee;return(ee=this.subtitleTrackController)==null||ee.setSubtitleOption(Z),null}get allAudioTracks(){const Z=this.audioTrackController;return Z?Z.allAudioTracks:[]}get audioTracks(){const Z=this.audioTrackController;return Z?Z.audioTracks:[]}get audioTrack(){const Z=this.audioTrackController;return Z?Z.audioTrack:-1}set audioTrack(Z){const ee=this.audioTrackController;ee&&(ee.audioTrack=Z)}get allSubtitleTracks(){const Z=this.subtitleTrackController;return Z?Z.allSubtitleTracks:[]}get subtitleTracks(){const Z=this.subtitleTrackController;return Z?Z.subtitleTracks:[]}get subtitleTrack(){const Z=this.subtitleTrackController;return Z?Z.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(Z){const ee=this.subtitleTrackController;ee&&(ee.subtitleTrack=Z)}get subtitleDisplay(){const Z=this.subtitleTrackController;return Z?Z.subtitleDisplay:!1}set subtitleDisplay(Z){const ee=this.subtitleTrackController;ee&&(ee.subtitleDisplay=Z)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(Z){this.config.lowLatencyMode=Z}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}Hls.defaultConfig=void 0;let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}const byteToHex=[];for(let ie=0;ie<256;++ie)byteToHex.push((ie+256).toString(16).slice(1));function unsafeStringify(ie,Z=0){return byteToHex[ie[Z+0]]+byteToHex[ie[Z+1]]+byteToHex[ie[Z+2]]+byteToHex[ie[Z+3]]+"-"+byteToHex[ie[Z+4]]+byteToHex[ie[Z+5]]+"-"+byteToHex[ie[Z+6]]+byteToHex[ie[Z+7]]+"-"+byteToHex[ie[Z+8]]+byteToHex[ie[Z+9]]+"-"+byteToHex[ie[Z+10]]+byteToHex[ie[Z+11]]+byteToHex[ie[Z+12]]+byteToHex[ie[Z+13]]+byteToHex[ie[Z+14]]+byteToHex[ie[Z+15]]}const randomUUID=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),native={randomUUID};function v4(ie,Z,ee){if(native.randomUUID&&!Z&&!ie)return native.randomUUID();ie=ie||{};const ae=ie.random||(ie.rng||rng)();return ae[6]=ae[6]&15|64,ae[8]=ae[8]&63|128,unsafeStringify(ae)}function $db6c3485150b8e66$export$1ab7ae714698c4b8(ie){const[Z,ee]=reactExports.useState(void 0);return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{if(ie){ee({width:ie.offsetWidth,height:ie.offsetHeight});const ae=new ResizeObserver(ye=>{if(!Array.isArray(ye)||!ye.length)return;const ve=ye[0];let be,Ye;if("borderBoxSize"in ve){const Ke=ve.borderBoxSize,Xe=Array.isArray(Ke)?Ke[0]:Ke;be=Xe.inlineSize,Ye=Xe.blockSize}else be=ie.offsetWidth,Ye=ie.offsetHeight;ee({width:be,height:Ye})});return ae.observe(ie,{box:"border-box"}),()=>ae.unobserve(ie)}else ee(void 0)},[ie]),Z}function $010c2913dbd2fe3d$export$5cae361ad82dce8b(ie){const Z=reactExports.useRef({value:ie,previous:ie});return reactExports.useMemo(()=>(Z.current.value!==ie&&(Z.current.previous=Z.current.value,Z.current.value=ie),Z.current.previous),[ie])}const $ce77a8961b41be9e$var$RADIO_NAME="Radio",[$ce77a8961b41be9e$var$createRadioContext,$ce77a8961b41be9e$export$67d2296460f1b002]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($ce77a8961b41be9e$var$RADIO_NAME),[$ce77a8961b41be9e$var$RadioProvider,$ce77a8961b41be9e$var$useRadioContext]=$ce77a8961b41be9e$var$createRadioContext($ce77a8961b41be9e$var$RADIO_NAME),$ce77a8961b41be9e$export$d7b12c4107be0d61=reactExports.forwardRef((ie,Z)=>{const{__scopeRadio:ee,name:ae,checked:ye=!1,required:ve,disabled:be,value:Ye="on",onCheck:Ke,...Xe}=ie,[Je,rt]=reactExports.useState(null),nt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,ct=>rt(ct)),it=reactExports.useRef(!1),lt=Je?!!Je.closest("form"):!0;return reactExports.createElement($ce77a8961b41be9e$var$RadioProvider,{scope:ee,checked:ye,disabled:be},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button",role:"radio","aria-checked":ye,"data-state":$ce77a8961b41be9e$var$getState(ye),"data-disabled":be?"":void 0,disabled:be,value:Ye},Xe,{ref:nt,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onClick,ct=>{ye||Ke==null||Ke(),lt&&(it.current=ct.isPropagationStopped(),it.current||ct.stopPropagation())})})),lt&&reactExports.createElement($ce77a8961b41be9e$var$BubbleInput,{control:Je,bubbles:!it.current,name:ae,value:Ye,checked:ye,required:ve,disabled:be,style:{transform:"translateX(-100%)"}}))}),$ce77a8961b41be9e$var$BubbleInput=ie=>{const{control:Z,checked:ee,bubbles:ae=!0,...ye}=ie,ve=reactExports.useRef(null),be=$010c2913dbd2fe3d$export$5cae361ad82dce8b(ee),Ye=$db6c3485150b8e66$export$1ab7ae714698c4b8(Z);return reactExports.useEffect(()=>{const Ke=ve.current,Xe=window.HTMLInputElement.prototype,Je=Object.getOwnPropertyDescriptor(Xe,"checked").set;if(be!==ee&&Je){const rt=new Event("click",{bubbles:ae});Je.call(Ke,ee),Ke.dispatchEvent(rt)}},[be,ee,ae]),reactExports.createElement("input",_extends$1({type:"radio","aria-hidden":!0,defaultChecked:ee},ye,{tabIndex:-1,ref:ve,style:{...ie.style,...Ye,position:"absolute",pointerEvents:"none",opacity:0,margin:0}}))};function $ce77a8961b41be9e$var$getState(ie){return ie?"checked":"unchecked"}const $f99a8c78507165f7$var$ARROW_KEYS=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],$f99a8c78507165f7$var$RADIO_GROUP_NAME="RadioGroup",[$f99a8c78507165f7$var$createRadioGroupContext,$f99a8c78507165f7$export$c547093f11b76da2]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($f99a8c78507165f7$var$RADIO_GROUP_NAME,[$d7bdfb9eb0fdf311$export$c7109489551a4f4,$ce77a8961b41be9e$export$67d2296460f1b002]),$f99a8c78507165f7$var$useRovingFocusGroupScope=$d7bdfb9eb0fdf311$export$c7109489551a4f4(),$f99a8c78507165f7$var$useRadioScope=$ce77a8961b41be9e$export$67d2296460f1b002(),[$f99a8c78507165f7$var$RadioGroupProvider,$f99a8c78507165f7$var$useRadioGroupContext]=$f99a8c78507165f7$var$createRadioGroupContext($f99a8c78507165f7$var$RADIO_GROUP_NAME),$f99a8c78507165f7$export$a98f0dcb43a68a25=reactExports.forwardRef((ie,Z)=>{const{__scopeRadioGroup:ee,name:ae,defaultValue:ye,value:ve,required:be=!1,disabled:Ye=!1,orientation:Ke,dir:Xe,loop:Je=!0,onValueChange:rt,...nt}=ie,it=$f99a8c78507165f7$var$useRovingFocusGroupScope(ee),lt=$f631663db3294ace$export$b39126d51d94e6f3(Xe),[ct,ot]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:ve,defaultProp:ye,onChange:rt});return reactExports.createElement($f99a8c78507165f7$var$RadioGroupProvider,{scope:ee,name:ae,required:be,disabled:Ye,value:ct,onValueChange:ot},reactExports.createElement($d7bdfb9eb0fdf311$export$be92b6f5f03c0fe9,_extends$1({asChild:!0},it,{orientation:Ke,dir:lt,loop:Je}),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({role:"radiogroup","aria-required":be,"aria-orientation":Ke,"data-disabled":Ye?"":void 0,dir:lt},nt,{ref:Z}))))}),$f99a8c78507165f7$var$ITEM_NAME="RadioGroupItem",$f99a8c78507165f7$export$9f866c100ef519e4=reactExports.forwardRef((ie,Z)=>{const{__scopeRadioGroup:ee,disabled:ae,...ye}=ie,ve=$f99a8c78507165f7$var$useRadioGroupContext($f99a8c78507165f7$var$ITEM_NAME,ee),be=ve.disabled||ae,Ye=$f99a8c78507165f7$var$useRovingFocusGroupScope(ee),Ke=$f99a8c78507165f7$var$useRadioScope(ee),Xe=reactExports.useRef(null),Je=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,Xe),rt=ve.value===ye.value,nt=reactExports.useRef(!1);return reactExports.useEffect(()=>{const it=ct=>{$f99a8c78507165f7$var$ARROW_KEYS.includes(ct.key)&&(nt.current=!0)},lt=()=>nt.current=!1;return document.addEventListener("keydown",it),document.addEventListener("keyup",lt),()=>{document.removeEventListener("keydown",it),document.removeEventListener("keyup",lt)}},[]),reactExports.createElement($d7bdfb9eb0fdf311$export$6d08773d2e66f8f2,_extends$1({asChild:!0},Ye,{focusable:!be,active:rt}),reactExports.createElement($ce77a8961b41be9e$export$d7b12c4107be0d61,_extends$1({disabled:be,required:ve.required,checked:rt},Ke,ye,{name:ve.name,ref:Je,onCheck:()=>ve.onValueChange(ye.value),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(it=>{it.key==="Enter"&&it.preventDefault()}),onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ye.onFocus,()=>{var it;nt.current&&((it=Xe.current)===null||it===void 0||it.click())})})))}),$f99a8c78507165f7$export$be92b6f5f03c0fe9=$f99a8c78507165f7$export$a98f0dcb43a68a25,$f99a8c78507165f7$export$6d08773d2e66f8f2=$f99a8c78507165f7$export$9f866c100ef519e4;function ParserError(ie,Z){this.message=ie,this.error=Z}ParserError.prototype=Object.create(Error.prototype);const TIMESTAMP_REGEXP=/([0-9]+)?:?([0-9]{2}):([0-9]{2}\.[0-9]{2,3})/;function parse$3(ie,Z){Z||(Z={});const{meta:ee=!1,strict:ae=!0}=Z;if(typeof ie!="string")throw new ParserError("Input must be a string");ie=ie.trim(),ie=ie.replace(/\r\n/g,`
`),ie=ie.replace(/\r/g,`
`);const ye=ie.split(`

`),ve=ye.shift();if(!ve.startsWith("WEBVTT"))throw new ParserError('Must start with "WEBVTT"');const be=ve.split(`
`),Ye=be[0].replace("WEBVTT","");if(Ye.length>0&&Ye[0]!==" "&&Ye[0]!=="	")throw new ParserError("Header comment must start with space or tab");if(ye.length===0&&be.length===1)return{valid:!0,strict:ae,cues:[],errors:[]};if(!ee&&be.length>1&&be[1]!=="")throw new ParserError("Missing blank line after signature");const{cues:Ke,errors:Xe}=parseCues(ye,ae);if(ae&&Xe.length>0)throw Xe[0];const Je=ee?parseMeta(be):null,rt={valid:Xe.length===0,strict:ae,cues:Ke,errors:Xe};return ee&&(rt.meta=Je),rt}function parseMeta(ie){const Z={};return ie.slice(1).forEach(ee=>{const ae=ee.indexOf(":"),ye=ee.slice(0,ae).trim(),ve=ee.slice(ae+1).trim();Z[ye]=ve}),Object.keys(Z).length>0?Z:null}function parseCues(ie,Z){const ee=[];return{cues:ie.map((ae,ye)=>{try{return parseCue(ae,ye,Z)}catch(ve){return ee.push(ve),null}}).filter(Boolean),errors:ee}}function parseCue(ie,Z,ee){let ae="",ye=0,ve=.01,be="",Ye="";const Ke=ie.split(`
`).filter(Boolean);if(Ke.length>0&&Ke[0].trim().startsWith("NOTE"))return null;if(Ke.length===1&&!Ke[0].includes("-->"))throw new ParserError(`Cue identifier cannot be standalone (cue #${Z})`);if(Ke.length>1&&!(Ke[0].includes("-->")||Ke[1].includes("-->"))){const Je=`Cue identifier needs to be followed by timestamp (cue #${Z})`;throw new ParserError(Je)}Ke.length>1&&Ke[1].includes("-->")&&(ae=Ke.shift());const Xe=typeof Ke[0]=="string"&&Ke[0].split(" --> ");if(Xe.length!==2||!validTimestamp(Xe[0])||!validTimestamp(Xe[1]))throw new ParserError(`Invalid cue timestamp (cue #${Z})`);if(ye=parseTimestamp(Xe[0]),ve=parseTimestamp(Xe[1]),ee){if(ye>ve)throw new ParserError(`Start timestamp greater than end (cue #${Z})`);if(ve<=ye)throw new ParserError(`End must be greater than start (cue #${Z})`)}if(!ee&&ve<ye)throw new ParserError(`End must be greater or equal to start when not strict (cue #${Z})`);return Ye=Xe[1].replace(TIMESTAMP_REGEXP,"").trim(),Ke.shift(),be=Ke.join(`
`),be?{identifier:ae,start:ye,end:ve,text:be,styles:Ye}:!1}function validTimestamp(ie){return TIMESTAMP_REGEXP.test(ie)}function parseTimestamp(ie){const Z=ie.match(TIMESTAMP_REGEXP);let ee=parseFloat(Z[1]||0)*60*60;return ee+=parseFloat(Z[2])*60,ee+=parseFloat(Z[3]),ee}var parser={ParserError,parse:parse$3};function CompilerError(ie,Z){this.message=ie,this.error=Z}CompilerError.prototype=Object.create(Error.prototype);function compile$1(ie){if(!ie)throw new CompilerError("Input must be non-null");if(typeof ie!="object")throw new CompilerError("Input must be an object");if(Array.isArray(ie))throw new CompilerError("Input cannot be array");if(!ie.valid)throw new CompilerError("Input must be valid");let Z=`WEBVTT
`;if(ie.meta){if(typeof ie.meta!="object"||Array.isArray(ie.meta))throw new CompilerError("Metadata must be an object");Object.entries(ie.meta).forEach(ae=>{if(typeof ae[1]!="string")throw new CompilerError(`Metadata value for "${ae[0]}" must be string`);Z+=`${ae[0]}: ${ae[1]}
`})}let ee=null;return ie.cues.forEach((ae,ye)=>{if(ee&&ee>ae.start)throw new CompilerError(`Cue number ${ye} is not in chronological order`);ee=ae.start,Z+=`
`,Z+=compileCue(ae),Z+=`
`}),Z}function compileCue(ie){if(typeof ie!="object")throw new CompilerError("Cue malformed: not of type object");if(typeof ie.identifier!="string"&&typeof ie.identifier!="number"&&ie.identifier!==null)throw new CompilerError(`Cue malformed: identifier value is not a string.
    ${JSON.stringify(ie)}`);if(isNaN(ie.start))throw new CompilerError(`Cue malformed: null start value.
    ${JSON.stringify(ie)}`);if(isNaN(ie.end))throw new CompilerError(`Cue malformed: null end value.
    ${JSON.stringify(ie)}`);if(ie.start>=ie.end)throw new CompilerError(`Cue malformed: start timestamp greater than end
    ${JSON.stringify(ie)}`);if(typeof ie.text!="string")throw new CompilerError(`Cue malformed: null text value.
    ${JSON.stringify(ie)}`);if(typeof ie.styles!="string")throw new CompilerError(`Cue malformed: null styles value.
    ${JSON.stringify(ie)}`);let Z="";ie.identifier.length>0&&(Z+=`${ie.identifier}
`);const ee=convertTimestamp(ie.start),ae=convertTimestamp(ie.end);return Z+=`${ee} --> ${ae}`,Z+=ie.styles?` ${ie.styles}`:"",Z+=`
${ie.text}`,Z}function convertTimestamp(ie){const Z=pad$1(calculateHours(ie),2),ee=pad$1(calculateMinutes(ie),2),ae=pad$1(calculateSeconds(ie),2),ye=pad$1(calculateMs(ie),3);return`${Z}:${ee}:${ae}.${ye}`}function pad$1(ie,Z){let ee=`${ie}`;for(;ee.length<Z;)ee=`0${ee}`;return ee}function calculateHours(ie){return Math.floor(ie/60/60)}function calculateMinutes(ie){return Math.floor(ie/60)%60}function calculateSeconds(ie){return Math.floor(ie%60)}function calculateMs(ie){return Math.floor((ie%1).toFixed(4)*1e3)}var compiler={CompilerError,compile:compile$1};const parse$2=parser.parse;function segment$2(ie,Z){Z=Z||10;const ee=parse$2(ie),ae=[];let ye=[],ve=null,be=0,Ye=0;return ee.cues.forEach((Ke,Xe)=>{const Je=Xe===0,rt=Xe===ee.cues.length-1,nt=Ke.start,it=Ke.end,lt=rt?1/0:ee.cues[Xe+1].start,ct=Je?it:it-nt,ot=Je?0:nt-ee.cues[Xe-1].end;be=be+ct+ot,ve&&(ye.push(ve),be+=ve.end-Ye,ve=null),ye.push(Ke);let dt=lt-it<Z&&ot<Z&&be>Z;if(shouldSegment(Ye,Z,lt,ot)){const ft=segmentDuration(rt,it,Z,be,Ye);ae.push({duration:ft,cues:ye}),Ye+=ft,be=0,ye=[]}else dt=!1;dt&&(ve=Ke)}),ae}function shouldSegment(ie,Z,ee,ae){const ye=alignToSegmentLength(ae,Z);return(ae<=Z||ye+ie<ee)&&ee-ie>=Z}function segmentDuration(ie,Z,ee,ae,ye){let ve=ee;return ae>ee&&(ve=alignToSegmentLength(ae-ee,ee)),ie?ve=parseFloat((Z-ye).toFixed(2)):ve=Math.round(ve),ve}function alignToSegmentLength(ie,Z){return ie+=Z-ie%Z,ie}var segmenter={segment:segment$2};const segment$1=segmenter.segment;function hlsSegment(ie,Z,ee){typeof ee>"u"&&(ee="900000");const ae=segment$1(ie,Z),ye=[];return ae.forEach((ve,be)=>{const Ye=`WEBVTT
X-TIMESTAMP-MAP=MPEGTS:${ee},LOCAL:00:00:00.000

${printableCues(ve.cues)}
`,Ke=generateSegmentFilename(be);ye.push({filename:Ke,content:Ye})}),ye}function hlsSegmentPlaylist(ie,Z){const ee=segment$1(ie,Z),ae=printableSegments(ee);return`#EXTM3U
#EXT-X-TARGETDURATION:${Math.round(findLongestSegment(ee))}
#EXT-X-VERSION:3
#EXT-X-MEDIA-SEQUENCE:0
#EXT-X-PLAYLIST-TYPE:VOD
${ae}
#EXT-X-ENDLIST
`}function pad(ie,Z){return`${"0".repeat(Math.max(0,Z-ie.toString().length))}${ie}`}function generateSegmentFilename(ie){return`${ie}.vtt`}function printableSegments(ie){const Z=[];return ie.forEach((ee,ae)=>{Z.push(`#EXTINF:${ee.duration.toFixed(5)},
${generateSegmentFilename(ae)}`)}),Z.join(`
`)}function findLongestSegment(ie){let Z=0;return ie.forEach(ee=>{ee.duration>Z&&(Z=ee.duration)}),Z}function printableCues(ie){const Z=[];return ie.forEach(ee=>{Z.push(printableCue(ee))}),Z.join(`

`)}function printableCue(ie){const Z=[];ie.identifier&&Z.push(ie.identifier);const ee=printableTimestamp(ie.start),ae=printableTimestamp(ie.end),ye=ie.styles?`${ie.styles}`:"";return Z.push(`${ee} --> ${ae} ${ye}`),Z.push(ie.text),Z.join(`
`)}function printableTimestamp(ie){const Z=(ie%1).toFixed(3);ie=Math.round(ie-Z);const ee=Math.floor(ie/3600),ae=Math.floor((ie-ee*3600)/60),ye=ie-ee*3600-ae*60;return`${`${pad(ee,2)}:`}${pad(ae,2)}:${pad(ye,2)}.${pad(Z*1e3,3)}`}var hls$1={hlsSegment,hlsSegmentPlaylist};const parse$1=parser.parse,compile=compiler.compile,segment=segmenter.segment,hls=hls$1;var nodeWebvtt={parse:parse$1,compile,segment,hls};function $addc16e1bbe58fd0$export$3a72a57244d6e765(ie,Z=globalThis==null?void 0:globalThis.document){const ee=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(ie);reactExports.useEffect(()=>{const ae=ye=>{ye.key==="Escape"&&ee(ye)};return Z.addEventListener("keydown",ae),()=>Z.removeEventListener("keydown",ae)},[ee,Z])}const $5cb92bef7577960e$var$CONTEXT_UPDATE="dismissableLayer.update",$5cb92bef7577960e$var$POINTER_DOWN_OUTSIDE="dismissableLayer.pointerDownOutside",$5cb92bef7577960e$var$FOCUS_OUTSIDE="dismissableLayer.focusOutside";let $5cb92bef7577960e$var$originalBodyPointerEvents;const $5cb92bef7577960e$var$DismissableLayerContext=reactExports.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),$5cb92bef7577960e$export$177fb62ff3ec1f22=reactExports.forwardRef((ie,Z)=>{var ee;const{disableOutsidePointerEvents:ae=!1,onEscapeKeyDown:ye,onPointerDownOutside:ve,onFocusOutside:be,onInteractOutside:Ye,onDismiss:Ke,...Xe}=ie,Je=reactExports.useContext($5cb92bef7577960e$var$DismissableLayerContext),[rt,nt]=reactExports.useState(null),it=(ee=rt==null?void 0:rt.ownerDocument)!==null&&ee!==void 0?ee:globalThis==null?void 0:globalThis.document,[,lt]=reactExports.useState({}),ct=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,Jr=>nt(Jr)),ot=Array.from(Je.layers),[dt]=[...Je.layersWithOutsidePointerEventsDisabled].slice(-1),ft=ot.indexOf(dt),gt=rt?ot.indexOf(rt):-1,mt=Je.layersWithOutsidePointerEventsDisabled.size>0,Yr=gt>=ft,Qr=$5cb92bef7577960e$var$usePointerDownOutside(Jr=>{const ai=Jr.target,oi=[...Je.branches].some(ni=>ni.contains(ai));!Yr||oi||(ve==null||ve(Jr),Ye==null||Ye(Jr),Jr.defaultPrevented||Ke==null||Ke())},it),Xr=$5cb92bef7577960e$var$useFocusOutside(Jr=>{const ai=Jr.target;[...Je.branches].some(oi=>oi.contains(ai))||(be==null||be(Jr),Ye==null||Ye(Jr),Jr.defaultPrevented||Ke==null||Ke())},it);return $addc16e1bbe58fd0$export$3a72a57244d6e765(Jr=>{gt===Je.layers.size-1&&(ye==null||ye(Jr),!Jr.defaultPrevented&&Ke&&(Jr.preventDefault(),Ke()))},it),reactExports.useEffect(()=>{if(rt)return ae&&(Je.layersWithOutsidePointerEventsDisabled.size===0&&($5cb92bef7577960e$var$originalBodyPointerEvents=it.body.style.pointerEvents,it.body.style.pointerEvents="none"),Je.layersWithOutsidePointerEventsDisabled.add(rt)),Je.layers.add(rt),$5cb92bef7577960e$var$dispatchUpdate(),()=>{ae&&Je.layersWithOutsidePointerEventsDisabled.size===1&&(it.body.style.pointerEvents=$5cb92bef7577960e$var$originalBodyPointerEvents)}},[rt,it,ae,Je]),reactExports.useEffect(()=>()=>{rt&&(Je.layers.delete(rt),Je.layersWithOutsidePointerEventsDisabled.delete(rt),$5cb92bef7577960e$var$dispatchUpdate())},[rt,Je]),reactExports.useEffect(()=>{const Jr=()=>lt({});return document.addEventListener($5cb92bef7577960e$var$CONTEXT_UPDATE,Jr),()=>document.removeEventListener($5cb92bef7577960e$var$CONTEXT_UPDATE,Jr)},[]),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({},Xe,{ref:ct,style:{pointerEvents:mt?Yr?"auto":"none":void 0,...ie.style},onFocusCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onFocusCapture,Xr.onFocusCapture),onBlurCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onBlurCapture,Xr.onBlurCapture),onPointerDownCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onPointerDownCapture,Qr.onPointerDownCapture)}))});function $5cb92bef7577960e$var$usePointerDownOutside(ie,Z=globalThis==null?void 0:globalThis.document){const ee=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(ie),ae=reactExports.useRef(!1),ye=reactExports.useRef(()=>{});return reactExports.useEffect(()=>{const ve=Ye=>{if(Ye.target&&!ae.current){let Ke=function(){$5cb92bef7577960e$var$handleAndDispatchCustomEvent($5cb92bef7577960e$var$POINTER_DOWN_OUTSIDE,ee,Xe,{discrete:!0})};const Xe={originalEvent:Ye};Ye.pointerType==="touch"?(Z.removeEventListener("click",ye.current),ye.current=Ke,Z.addEventListener("click",ye.current,{once:!0})):Ke()}else Z.removeEventListener("click",ye.current);ae.current=!1},be=window.setTimeout(()=>{Z.addEventListener("pointerdown",ve)},0);return()=>{window.clearTimeout(be),Z.removeEventListener("pointerdown",ve),Z.removeEventListener("click",ye.current)}},[Z,ee]),{onPointerDownCapture:()=>ae.current=!0}}function $5cb92bef7577960e$var$useFocusOutside(ie,Z=globalThis==null?void 0:globalThis.document){const ee=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(ie),ae=reactExports.useRef(!1);return reactExports.useEffect(()=>{const ye=ve=>{ve.target&&!ae.current&&$5cb92bef7577960e$var$handleAndDispatchCustomEvent($5cb92bef7577960e$var$FOCUS_OUTSIDE,ee,{originalEvent:ve},{discrete:!1})};return Z.addEventListener("focusin",ye),()=>Z.removeEventListener("focusin",ye)},[Z,ee]),{onFocusCapture:()=>ae.current=!0,onBlurCapture:()=>ae.current=!1}}function $5cb92bef7577960e$var$dispatchUpdate(){const ie=new CustomEvent($5cb92bef7577960e$var$CONTEXT_UPDATE);document.dispatchEvent(ie)}function $5cb92bef7577960e$var$handleAndDispatchCustomEvent(ie,Z,ee,{discrete:ae}){const ye=ee.originalEvent.target,ve=new CustomEvent(ie,{bubbles:!1,cancelable:!0,detail:ee});Z&&ye.addEventListener(ie,Z,{once:!0}),ae?$8927f6f2acc4f386$export$6d1a0317bde7de7f(ye,ve):ye.dispatchEvent(ve)}let $3db38b7d1fb3fe6a$var$count=0;function $3db38b7d1fb3fe6a$export$b7ece24a22aeda8c(){reactExports.useEffect(()=>{var ie,Z;const ee=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",(ie=ee[0])!==null&&ie!==void 0?ie:$3db38b7d1fb3fe6a$var$createFocusGuard()),document.body.insertAdjacentElement("beforeend",(Z=ee[1])!==null&&Z!==void 0?Z:$3db38b7d1fb3fe6a$var$createFocusGuard()),$3db38b7d1fb3fe6a$var$count++,()=>{$3db38b7d1fb3fe6a$var$count===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(ae=>ae.remove()),$3db38b7d1fb3fe6a$var$count--}},[])}function $3db38b7d1fb3fe6a$var$createFocusGuard(){const ie=document.createElement("span");return ie.setAttribute("data-radix-focus-guard",""),ie.tabIndex=0,ie.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",ie}const $d3863c46a17e8a28$var$AUTOFOCUS_ON_MOUNT="focusScope.autoFocusOnMount",$d3863c46a17e8a28$var$AUTOFOCUS_ON_UNMOUNT="focusScope.autoFocusOnUnmount",$d3863c46a17e8a28$var$EVENT_OPTIONS={bubbles:!1,cancelable:!0},$d3863c46a17e8a28$export$20e40289641fbbb6=reactExports.forwardRef((ie,Z)=>{const{loop:ee=!1,trapped:ae=!1,onMountAutoFocus:ye,onUnmountAutoFocus:ve,...be}=ie,[Ye,Ke]=reactExports.useState(null),Xe=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(ye),Je=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(ve),rt=reactExports.useRef(null),nt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,ct=>Ke(ct)),it=reactExports.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;reactExports.useEffect(()=>{if(ae){let ct=function(gt){if(it.paused||!Ye)return;const mt=gt.target;Ye.contains(mt)?rt.current=mt:$d3863c46a17e8a28$var$focus(rt.current,{select:!0})},ot=function(gt){if(it.paused||!Ye)return;const mt=gt.relatedTarget;mt!==null&&(Ye.contains(mt)||$d3863c46a17e8a28$var$focus(rt.current,{select:!0}))},dt=function(gt){if(document.activeElement===document.body)for(const mt of gt)mt.removedNodes.length>0&&$d3863c46a17e8a28$var$focus(Ye)};document.addEventListener("focusin",ct),document.addEventListener("focusout",ot);const ft=new MutationObserver(dt);return Ye&&ft.observe(Ye,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",ct),document.removeEventListener("focusout",ot),ft.disconnect()}}},[ae,Ye,it.paused]),reactExports.useEffect(()=>{if(Ye){$d3863c46a17e8a28$var$focusScopesStack.add(it);const ct=document.activeElement;if(!Ye.contains(ct)){const ot=new CustomEvent($d3863c46a17e8a28$var$AUTOFOCUS_ON_MOUNT,$d3863c46a17e8a28$var$EVENT_OPTIONS);Ye.addEventListener($d3863c46a17e8a28$var$AUTOFOCUS_ON_MOUNT,Xe),Ye.dispatchEvent(ot),ot.defaultPrevented||($d3863c46a17e8a28$var$focusFirst($d3863c46a17e8a28$var$removeLinks($d3863c46a17e8a28$var$getTabbableCandidates(Ye)),{select:!0}),document.activeElement===ct&&$d3863c46a17e8a28$var$focus(Ye))}return()=>{Ye.removeEventListener($d3863c46a17e8a28$var$AUTOFOCUS_ON_MOUNT,Xe),setTimeout(()=>{const ot=new CustomEvent($d3863c46a17e8a28$var$AUTOFOCUS_ON_UNMOUNT,$d3863c46a17e8a28$var$EVENT_OPTIONS);Ye.addEventListener($d3863c46a17e8a28$var$AUTOFOCUS_ON_UNMOUNT,Je),Ye.dispatchEvent(ot),ot.defaultPrevented||$d3863c46a17e8a28$var$focus(ct??document.body,{select:!0}),Ye.removeEventListener($d3863c46a17e8a28$var$AUTOFOCUS_ON_UNMOUNT,Je),$d3863c46a17e8a28$var$focusScopesStack.remove(it)},0)}}},[Ye,Xe,Je,it]);const lt=reactExports.useCallback(ct=>{if(!ee&&!ae||it.paused)return;const ot=ct.key==="Tab"&&!ct.altKey&&!ct.ctrlKey&&!ct.metaKey,dt=document.activeElement;if(ot&&dt){const ft=ct.currentTarget,[gt,mt]=$d3863c46a17e8a28$var$getTabbableEdges(ft);gt&&mt?!ct.shiftKey&&dt===mt?(ct.preventDefault(),ee&&$d3863c46a17e8a28$var$focus(gt,{select:!0})):ct.shiftKey&&dt===gt&&(ct.preventDefault(),ee&&$d3863c46a17e8a28$var$focus(mt,{select:!0})):dt===ft&&ct.preventDefault()}},[ee,ae,it.paused]);return reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({tabIndex:-1},be,{ref:nt,onKeyDown:lt}))});function $d3863c46a17e8a28$var$focusFirst(ie,{select:Z=!1}={}){const ee=document.activeElement;for(const ae of ie)if($d3863c46a17e8a28$var$focus(ae,{select:Z}),document.activeElement!==ee)return}function $d3863c46a17e8a28$var$getTabbableEdges(ie){const Z=$d3863c46a17e8a28$var$getTabbableCandidates(ie),ee=$d3863c46a17e8a28$var$findVisible(Z,ie),ae=$d3863c46a17e8a28$var$findVisible(Z.reverse(),ie);return[ee,ae]}function $d3863c46a17e8a28$var$getTabbableCandidates(ie){const Z=[],ee=document.createTreeWalker(ie,NodeFilter.SHOW_ELEMENT,{acceptNode:ae=>{const ye=ae.tagName==="INPUT"&&ae.type==="hidden";return ae.disabled||ae.hidden||ye?NodeFilter.FILTER_SKIP:ae.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;ee.nextNode();)Z.push(ee.currentNode);return Z}function $d3863c46a17e8a28$var$findVisible(ie,Z){for(const ee of ie)if(!$d3863c46a17e8a28$var$isHidden(ee,{upTo:Z}))return ee}function $d3863c46a17e8a28$var$isHidden(ie,{upTo:Z}){if(getComputedStyle(ie).visibility==="hidden")return!0;for(;ie;){if(Z!==void 0&&ie===Z)return!1;if(getComputedStyle(ie).display==="none")return!0;ie=ie.parentElement}return!1}function $d3863c46a17e8a28$var$isSelectableInput(ie){return ie instanceof HTMLInputElement&&"select"in ie}function $d3863c46a17e8a28$var$focus(ie,{select:Z=!1}={}){if(ie&&ie.focus){const ee=document.activeElement;ie.focus({preventScroll:!0}),ie!==ee&&$d3863c46a17e8a28$var$isSelectableInput(ie)&&Z&&ie.select()}}const $d3863c46a17e8a28$var$focusScopesStack=$d3863c46a17e8a28$var$createFocusScopesStack();function $d3863c46a17e8a28$var$createFocusScopesStack(){let ie=[];return{add(Z){const ee=ie[0];Z!==ee&&(ee==null||ee.pause()),ie=$d3863c46a17e8a28$var$arrayRemove(ie,Z),ie.unshift(Z)},remove(Z){var ee;ie=$d3863c46a17e8a28$var$arrayRemove(ie,Z),(ee=ie[0])===null||ee===void 0||ee.resume()}}}function $d3863c46a17e8a28$var$arrayRemove(ie,Z){const ee=[...ie],ae=ee.indexOf(Z);return ae!==-1&&ee.splice(ae,1),ee}function $d3863c46a17e8a28$var$removeLinks(ie){return ie.filter(Z=>Z.tagName!=="A")}const sides=["top","right","bottom","left"],min=Math.min,max=Math.max,round=Math.round,floor=Math.floor,createCoords=ie=>({x:ie,y:ie}),oppositeSideMap={left:"right",right:"left",bottom:"top",top:"bottom"},oppositeAlignmentMap={start:"end",end:"start"};function clamp(ie,Z,ee){return max(ie,min(Z,ee))}function evaluate(ie,Z){return typeof ie=="function"?ie(Z):ie}function getSide(ie){return ie.split("-")[0]}function getAlignment(ie){return ie.split("-")[1]}function getOppositeAxis(ie){return ie==="x"?"y":"x"}function getAxisLength(ie){return ie==="y"?"height":"width"}function getSideAxis(ie){return["top","bottom"].includes(getSide(ie))?"y":"x"}function getAlignmentAxis(ie){return getOppositeAxis(getSideAxis(ie))}function getAlignmentSides(ie,Z,ee){ee===void 0&&(ee=!1);const ae=getAlignment(ie),ye=getAlignmentAxis(ie),ve=getAxisLength(ye);let be=ye==="x"?ae===(ee?"end":"start")?"right":"left":ae==="start"?"bottom":"top";return Z.reference[ve]>Z.floating[ve]&&(be=getOppositePlacement(be)),[be,getOppositePlacement(be)]}function getExpandedPlacements(ie){const Z=getOppositePlacement(ie);return[getOppositeAlignmentPlacement(ie),Z,getOppositeAlignmentPlacement(Z)]}function getOppositeAlignmentPlacement(ie){return ie.replace(/start|end/g,Z=>oppositeAlignmentMap[Z])}function getSideList(ie,Z,ee){const ae=["left","right"],ye=["right","left"],ve=["top","bottom"],be=["bottom","top"];switch(ie){case"top":case"bottom":return ee?Z?ye:ae:Z?ae:ye;case"left":case"right":return Z?ve:be;default:return[]}}function getOppositeAxisPlacements(ie,Z,ee,ae){const ye=getAlignment(ie);let ve=getSideList(getSide(ie),ee==="start",ae);return ye&&(ve=ve.map(be=>be+"-"+ye),Z&&(ve=ve.concat(ve.map(getOppositeAlignmentPlacement)))),ve}function getOppositePlacement(ie){return ie.replace(/left|right|bottom|top/g,Z=>oppositeSideMap[Z])}function expandPaddingObject(ie){return{top:0,right:0,bottom:0,left:0,...ie}}function getPaddingObject(ie){return typeof ie!="number"?expandPaddingObject(ie):{top:ie,right:ie,bottom:ie,left:ie}}function rectToClientRect(ie){return{...ie,top:ie.y,left:ie.x,right:ie.x+ie.width,bottom:ie.y+ie.height}}function computeCoordsFromPlacement(ie,Z,ee){let{reference:ae,floating:ye}=ie;const ve=getSideAxis(Z),be=getAlignmentAxis(Z),Ye=getAxisLength(be),Ke=getSide(Z),Xe=ve==="y",Je=ae.x+ae.width/2-ye.width/2,rt=ae.y+ae.height/2-ye.height/2,nt=ae[Ye]/2-ye[Ye]/2;let it;switch(Ke){case"top":it={x:Je,y:ae.y-ye.height};break;case"bottom":it={x:Je,y:ae.y+ae.height};break;case"right":it={x:ae.x+ae.width,y:rt};break;case"left":it={x:ae.x-ye.width,y:rt};break;default:it={x:ae.x,y:ae.y}}switch(getAlignment(Z)){case"start":it[be]-=nt*(ee&&Xe?-1:1);break;case"end":it[be]+=nt*(ee&&Xe?-1:1);break}return it}const computePosition$1=async(ie,Z,ee)=>{const{placement:ae="bottom",strategy:ye="absolute",middleware:ve=[],platform:be}=ee,Ye=ve.filter(Boolean),Ke=await(be.isRTL==null?void 0:be.isRTL(Z));let Xe=await be.getElementRects({reference:ie,floating:Z,strategy:ye}),{x:Je,y:rt}=computeCoordsFromPlacement(Xe,ae,Ke),nt=ae,it={},lt=0;for(let ct=0;ct<Ye.length;ct++){const{name:ot,fn:dt}=Ye[ct],{x:ft,y:gt,data:mt,reset:Yr}=await dt({x:Je,y:rt,initialPlacement:ae,placement:nt,strategy:ye,middlewareData:it,rects:Xe,platform:be,elements:{reference:ie,floating:Z}});Je=ft??Je,rt=gt??rt,it={...it,[ot]:{...it[ot],...mt}},Yr&&lt<=50&&(lt++,typeof Yr=="object"&&(Yr.placement&&(nt=Yr.placement),Yr.rects&&(Xe=Yr.rects===!0?await be.getElementRects({reference:ie,floating:Z,strategy:ye}):Yr.rects),{x:Je,y:rt}=computeCoordsFromPlacement(Xe,nt,Ke)),ct=-1)}return{x:Je,y:rt,placement:nt,strategy:ye,middlewareData:it}};async function detectOverflow(ie,Z){var ee;Z===void 0&&(Z={});const{x:ae,y:ye,platform:ve,rects:be,elements:Ye,strategy:Ke}=ie,{boundary:Xe="clippingAncestors",rootBoundary:Je="viewport",elementContext:rt="floating",altBoundary:nt=!1,padding:it=0}=evaluate(Z,ie),lt=getPaddingObject(it),ct=Ye[nt?rt==="floating"?"reference":"floating":rt],ot=rectToClientRect(await ve.getClippingRect({element:(ee=await(ve.isElement==null?void 0:ve.isElement(ct)))==null||ee?ct:ct.contextElement||await(ve.getDocumentElement==null?void 0:ve.getDocumentElement(Ye.floating)),boundary:Xe,rootBoundary:Je,strategy:Ke})),dt=rt==="floating"?{...be.floating,x:ae,y:ye}:be.reference,ft=await(ve.getOffsetParent==null?void 0:ve.getOffsetParent(Ye.floating)),gt=await(ve.isElement==null?void 0:ve.isElement(ft))?await(ve.getScale==null?void 0:ve.getScale(ft))||{x:1,y:1}:{x:1,y:1},mt=rectToClientRect(ve.convertOffsetParentRelativeRectToViewportRelativeRect?await ve.convertOffsetParentRelativeRectToViewportRelativeRect({elements:Ye,rect:dt,offsetParent:ft,strategy:Ke}):dt);return{top:(ot.top-mt.top+lt.top)/gt.y,bottom:(mt.bottom-ot.bottom+lt.bottom)/gt.y,left:(ot.left-mt.left+lt.left)/gt.x,right:(mt.right-ot.right+lt.right)/gt.x}}const arrow$2=ie=>({name:"arrow",options:ie,async fn(Z){const{x:ee,y:ae,placement:ye,rects:ve,platform:be,elements:Ye,middlewareData:Ke}=Z,{element:Xe,padding:Je=0}=evaluate(ie,Z)||{};if(Xe==null)return{};const rt=getPaddingObject(Je),nt={x:ee,y:ae},it=getAlignmentAxis(ye),lt=getAxisLength(it),ct=await be.getDimensions(Xe),ot=it==="y",dt=ot?"top":"left",ft=ot?"bottom":"right",gt=ot?"clientHeight":"clientWidth",mt=ve.reference[lt]+ve.reference[it]-nt[it]-ve.floating[lt],Yr=nt[it]-ve.reference[it],Qr=await(be.getOffsetParent==null?void 0:be.getOffsetParent(Xe));let Xr=Qr?Qr[gt]:0;(!Xr||!await(be.isElement==null?void 0:be.isElement(Qr)))&&(Xr=Ye.floating[gt]||ve.floating[lt]);const Jr=mt/2-Yr/2,ai=Xr/2-ct[lt]/2-1,oi=min(rt[dt],ai),ni=min(rt[ft],ai),li=oi,ui=Xr-ct[lt]-ni,mi=Xr/2-ct[lt]/2+Jr,ii=clamp(li,mi,ui),hi=!Ke.arrow&&getAlignment(ye)!=null&&mi!==ii&&ve.reference[lt]/2-(mi<li?oi:ni)-ct[lt]/2<0,ri=hi?mi<li?mi-li:mi-ui:0;return{[it]:nt[it]+ri,data:{[it]:ii,centerOffset:mi-ii-ri,...hi&&{alignmentOffset:ri}},reset:hi}}}),flip$1=function(ie){return ie===void 0&&(ie={}),{name:"flip",options:ie,async fn(Z){var ee,ae;const{placement:ye,middlewareData:ve,rects:be,initialPlacement:Ye,platform:Ke,elements:Xe}=Z,{mainAxis:Je=!0,crossAxis:rt=!0,fallbackPlacements:nt,fallbackStrategy:it="bestFit",fallbackAxisSideDirection:lt="none",flipAlignment:ct=!0,...ot}=evaluate(ie,Z);if((ee=ve.arrow)!=null&&ee.alignmentOffset)return{};const dt=getSide(ye),ft=getSide(Ye)===Ye,gt=await(Ke.isRTL==null?void 0:Ke.isRTL(Xe.floating)),mt=nt||(ft||!ct?[getOppositePlacement(Ye)]:getExpandedPlacements(Ye));!nt&&lt!=="none"&&mt.push(...getOppositeAxisPlacements(Ye,ct,lt,gt));const Yr=[Ye,...mt],Qr=await detectOverflow(Z,ot),Xr=[];let Jr=((ae=ve.flip)==null?void 0:ae.overflows)||[];if(Je&&Xr.push(Qr[dt]),rt){const li=getAlignmentSides(ye,be,gt);Xr.push(Qr[li[0]],Qr[li[1]])}if(Jr=[...Jr,{placement:ye,overflows:Xr}],!Xr.every(li=>li<=0)){var ai,oi;const li=(((ai=ve.flip)==null?void 0:ai.index)||0)+1,ui=Yr[li];if(ui)return{data:{index:li,overflows:Jr},reset:{placement:ui}};let mi=(oi=Jr.filter(ii=>ii.overflows[0]<=0).sort((ii,hi)=>ii.overflows[1]-hi.overflows[1])[0])==null?void 0:oi.placement;if(!mi)switch(it){case"bestFit":{var ni;const ii=(ni=Jr.map(hi=>[hi.placement,hi.overflows.filter(ri=>ri>0).reduce((ri,ci)=>ri+ci,0)]).sort((hi,ri)=>hi[1]-ri[1])[0])==null?void 0:ni[0];ii&&(mi=ii);break}case"initialPlacement":mi=Ye;break}if(ye!==mi)return{reset:{placement:mi}}}return{}}}};function getSideOffsets(ie,Z){return{top:ie.top-Z.height,right:ie.right-Z.width,bottom:ie.bottom-Z.height,left:ie.left-Z.width}}function isAnySideFullyClipped(ie){return sides.some(Z=>ie[Z]>=0)}const hide$1=function(ie){return ie===void 0&&(ie={}),{name:"hide",options:ie,async fn(Z){const{rects:ee}=Z,{strategy:ae="referenceHidden",...ye}=evaluate(ie,Z);switch(ae){case"referenceHidden":{const ve=await detectOverflow(Z,{...ye,elementContext:"reference"}),be=getSideOffsets(ve,ee.reference);return{data:{referenceHiddenOffsets:be,referenceHidden:isAnySideFullyClipped(be)}}}case"escaped":{const ve=await detectOverflow(Z,{...ye,altBoundary:!0}),be=getSideOffsets(ve,ee.floating);return{data:{escapedOffsets:be,escaped:isAnySideFullyClipped(be)}}}default:return{}}}}};async function convertValueToCoords(ie,Z){const{placement:ee,platform:ae,elements:ye}=ie,ve=await(ae.isRTL==null?void 0:ae.isRTL(ye.floating)),be=getSide(ee),Ye=getAlignment(ee),Ke=getSideAxis(ee)==="y",Xe=["left","top"].includes(be)?-1:1,Je=ve&&Ke?-1:1,rt=evaluate(Z,ie);let{mainAxis:nt,crossAxis:it,alignmentAxis:lt}=typeof rt=="number"?{mainAxis:rt,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...rt};return Ye&&typeof lt=="number"&&(it=Ye==="end"?lt*-1:lt),Ke?{x:it*Je,y:nt*Xe}:{x:nt*Xe,y:it*Je}}const offset=function(ie){return ie===void 0&&(ie=0),{name:"offset",options:ie,async fn(Z){var ee,ae;const{x:ye,y:ve,placement:be,middlewareData:Ye}=Z,Ke=await convertValueToCoords(Z,ie);return be===((ee=Ye.offset)==null?void 0:ee.placement)&&(ae=Ye.arrow)!=null&&ae.alignmentOffset?{}:{x:ye+Ke.x,y:ve+Ke.y,data:{...Ke,placement:be}}}}},shift$1=function(ie){return ie===void 0&&(ie={}),{name:"shift",options:ie,async fn(Z){const{x:ee,y:ae,placement:ye}=Z,{mainAxis:ve=!0,crossAxis:be=!1,limiter:Ye={fn:ot=>{let{x:dt,y:ft}=ot;return{x:dt,y:ft}}},...Ke}=evaluate(ie,Z),Xe={x:ee,y:ae},Je=await detectOverflow(Z,Ke),rt=getSideAxis(getSide(ye)),nt=getOppositeAxis(rt);let it=Xe[nt],lt=Xe[rt];if(ve){const ot=nt==="y"?"top":"left",dt=nt==="y"?"bottom":"right",ft=it+Je[ot],gt=it-Je[dt];it=clamp(ft,it,gt)}if(be){const ot=rt==="y"?"top":"left",dt=rt==="y"?"bottom":"right",ft=lt+Je[ot],gt=lt-Je[dt];lt=clamp(ft,lt,gt)}const ct=Ye.fn({...Z,[nt]:it,[rt]:lt});return{...ct,data:{x:ct.x-ee,y:ct.y-ae}}}}},limitShift$1=function(ie){return ie===void 0&&(ie={}),{options:ie,fn(Z){const{x:ee,y:ae,placement:ye,rects:ve,middlewareData:be}=Z,{offset:Ye=0,mainAxis:Ke=!0,crossAxis:Xe=!0}=evaluate(ie,Z),Je={x:ee,y:ae},rt=getSideAxis(ye),nt=getOppositeAxis(rt);let it=Je[nt],lt=Je[rt];const ct=evaluate(Ye,Z),ot=typeof ct=="number"?{mainAxis:ct,crossAxis:0}:{mainAxis:0,crossAxis:0,...ct};if(Ke){const gt=nt==="y"?"height":"width",mt=ve.reference[nt]-ve.floating[gt]+ot.mainAxis,Yr=ve.reference[nt]+ve.reference[gt]-ot.mainAxis;it<mt?it=mt:it>Yr&&(it=Yr)}if(Xe){var dt,ft;const gt=nt==="y"?"width":"height",mt=["top","left"].includes(getSide(ye)),Yr=ve.reference[rt]-ve.floating[gt]+(mt&&((dt=be.offset)==null?void 0:dt[rt])||0)+(mt?0:ot.crossAxis),Qr=ve.reference[rt]+ve.reference[gt]+(mt?0:((ft=be.offset)==null?void 0:ft[rt])||0)-(mt?ot.crossAxis:0);lt<Yr?lt=Yr:lt>Qr&&(lt=Qr)}return{[nt]:it,[rt]:lt}}}},size$1=function(ie){return ie===void 0&&(ie={}),{name:"size",options:ie,async fn(Z){const{placement:ee,rects:ae,platform:ye,elements:ve}=Z,{apply:be=()=>{},...Ye}=evaluate(ie,Z),Ke=await detectOverflow(Z,Ye),Xe=getSide(ee),Je=getAlignment(ee),rt=getSideAxis(ee)==="y",{width:nt,height:it}=ae.floating;let lt,ct;Xe==="top"||Xe==="bottom"?(lt=Xe,ct=Je===(await(ye.isRTL==null?void 0:ye.isRTL(ve.floating))?"start":"end")?"left":"right"):(ct=Xe,lt=Je==="end"?"top":"bottom");const ot=it-Ke[lt],dt=nt-Ke[ct],ft=!Z.middlewareData.shift;let gt=ot,mt=dt;if(rt){const Qr=nt-Ke.left-Ke.right;mt=Je||ft?min(dt,Qr):Qr}else{const Qr=it-Ke.top-Ke.bottom;gt=Je||ft?min(ot,Qr):Qr}if(ft&&!Je){const Qr=max(Ke.left,0),Xr=max(Ke.right,0),Jr=max(Ke.top,0),ai=max(Ke.bottom,0);rt?mt=nt-2*(Qr!==0||Xr!==0?Qr+Xr:max(Ke.left,Ke.right)):gt=it-2*(Jr!==0||ai!==0?Jr+ai:max(Ke.top,Ke.bottom))}await be({...Z,availableWidth:mt,availableHeight:gt});const Yr=await ye.getDimensions(ve.floating);return nt!==Yr.width||it!==Yr.height?{reset:{rects:!0}}:{}}}};function getNodeName(ie){return isNode(ie)?(ie.nodeName||"").toLowerCase():"#document"}function getWindow(ie){var Z;return(ie==null||(Z=ie.ownerDocument)==null?void 0:Z.defaultView)||window}function getDocumentElement(ie){var Z;return(Z=(isNode(ie)?ie.ownerDocument:ie.document)||window.document)==null?void 0:Z.documentElement}function isNode(ie){return ie instanceof Node||ie instanceof getWindow(ie).Node}function isElement(ie){return ie instanceof Element||ie instanceof getWindow(ie).Element}function isHTMLElement(ie){return ie instanceof HTMLElement||ie instanceof getWindow(ie).HTMLElement}function isShadowRoot(ie){return typeof ShadowRoot>"u"?!1:ie instanceof ShadowRoot||ie instanceof getWindow(ie).ShadowRoot}function isOverflowElement(ie){const{overflow:Z,overflowX:ee,overflowY:ae,display:ye}=getComputedStyle$1(ie);return/auto|scroll|overlay|hidden|clip/.test(Z+ae+ee)&&!["inline","contents"].includes(ye)}function isTableElement(ie){return["table","td","th"].includes(getNodeName(ie))}function isContainingBlock(ie){const Z=isWebKit(),ee=getComputedStyle$1(ie);return ee.transform!=="none"||ee.perspective!=="none"||(ee.containerType?ee.containerType!=="normal":!1)||!Z&&(ee.backdropFilter?ee.backdropFilter!=="none":!1)||!Z&&(ee.filter?ee.filter!=="none":!1)||["transform","perspective","filter"].some(ae=>(ee.willChange||"").includes(ae))||["paint","layout","strict","content"].some(ae=>(ee.contain||"").includes(ae))}function getContainingBlock(ie){let Z=getParentNode(ie);for(;isHTMLElement(Z)&&!isLastTraversableNode(Z);){if(isContainingBlock(Z))return Z;Z=getParentNode(Z)}return null}function isWebKit(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function isLastTraversableNode(ie){return["html","body","#document"].includes(getNodeName(ie))}function getComputedStyle$1(ie){return getWindow(ie).getComputedStyle(ie)}function getNodeScroll(ie){return isElement(ie)?{scrollLeft:ie.scrollLeft,scrollTop:ie.scrollTop}:{scrollLeft:ie.pageXOffset,scrollTop:ie.pageYOffset}}function getParentNode(ie){if(getNodeName(ie)==="html")return ie;const Z=ie.assignedSlot||ie.parentNode||isShadowRoot(ie)&&ie.host||getDocumentElement(ie);return isShadowRoot(Z)?Z.host:Z}function getNearestOverflowAncestor(ie){const Z=getParentNode(ie);return isLastTraversableNode(Z)?ie.ownerDocument?ie.ownerDocument.body:ie.body:isHTMLElement(Z)&&isOverflowElement(Z)?Z:getNearestOverflowAncestor(Z)}function getOverflowAncestors(ie,Z,ee){var ae;Z===void 0&&(Z=[]),ee===void 0&&(ee=!0);const ye=getNearestOverflowAncestor(ie),ve=ye===((ae=ie.ownerDocument)==null?void 0:ae.body),be=getWindow(ye);return ve?Z.concat(be,be.visualViewport||[],isOverflowElement(ye)?ye:[],be.frameElement&&ee?getOverflowAncestors(be.frameElement):[]):Z.concat(ye,getOverflowAncestors(ye,[],ee))}function getCssDimensions(ie){const Z=getComputedStyle$1(ie);let ee=parseFloat(Z.width)||0,ae=parseFloat(Z.height)||0;const ye=isHTMLElement(ie),ve=ye?ie.offsetWidth:ee,be=ye?ie.offsetHeight:ae,Ye=round(ee)!==ve||round(ae)!==be;return Ye&&(ee=ve,ae=be),{width:ee,height:ae,$:Ye}}function unwrapElement(ie){return isElement(ie)?ie:ie.contextElement}function getScale(ie){const Z=unwrapElement(ie);if(!isHTMLElement(Z))return createCoords(1);const ee=Z.getBoundingClientRect(),{width:ae,height:ye,$:ve}=getCssDimensions(Z);let be=(ve?round(ee.width):ee.width)/ae,Ye=(ve?round(ee.height):ee.height)/ye;return(!be||!Number.isFinite(be))&&(be=1),(!Ye||!Number.isFinite(Ye))&&(Ye=1),{x:be,y:Ye}}const noOffsets=createCoords(0);function getVisualOffsets(ie){const Z=getWindow(ie);return!isWebKit()||!Z.visualViewport?noOffsets:{x:Z.visualViewport.offsetLeft,y:Z.visualViewport.offsetTop}}function shouldAddVisualOffsets(ie,Z,ee){return Z===void 0&&(Z=!1),!ee||Z&&ee!==getWindow(ie)?!1:Z}function getBoundingClientRect(ie,Z,ee,ae){Z===void 0&&(Z=!1),ee===void 0&&(ee=!1);const ye=ie.getBoundingClientRect(),ve=unwrapElement(ie);let be=createCoords(1);Z&&(ae?isElement(ae)&&(be=getScale(ae)):be=getScale(ie));const Ye=shouldAddVisualOffsets(ve,ee,ae)?getVisualOffsets(ve):createCoords(0);let Ke=(ye.left+Ye.x)/be.x,Xe=(ye.top+Ye.y)/be.y,Je=ye.width/be.x,rt=ye.height/be.y;if(ve){const nt=getWindow(ve),it=ae&&isElement(ae)?getWindow(ae):ae;let lt=nt.frameElement;for(;lt&&ae&&it!==nt;){const ct=getScale(lt),ot=lt.getBoundingClientRect(),dt=getComputedStyle$1(lt),ft=ot.left+(lt.clientLeft+parseFloat(dt.paddingLeft))*ct.x,gt=ot.top+(lt.clientTop+parseFloat(dt.paddingTop))*ct.y;Ke*=ct.x,Xe*=ct.y,Je*=ct.x,rt*=ct.y,Ke+=ft,Xe+=gt,lt=getWindow(lt).frameElement}}return rectToClientRect({width:Je,height:rt,x:Ke,y:Xe})}const topLayerSelectors=[":popover-open",":modal"];function topLayer(ie){let Z=!1,ee=0,ae=0;function ye(ve){try{Z=Z||ie.matches(ve)}catch{}}if(topLayerSelectors.forEach(ve=>{ye(ve)}),Z){const ve=getContainingBlock(ie);if(ve){const be=ve.getBoundingClientRect();ee=be.x,ae=be.y}}return[Z,ee,ae]}function convertOffsetParentRelativeRectToViewportRelativeRect(ie){let{elements:Z,rect:ee,offsetParent:ae,strategy:ye}=ie;const ve=getDocumentElement(ae),[be]=Z?topLayer(Z.floating):[!1];if(ae===ve||be)return ee;let Ye={scrollLeft:0,scrollTop:0},Ke=createCoords(1);const Xe=createCoords(0),Je=isHTMLElement(ae);if((Je||!Je&&ye!=="fixed")&&((getNodeName(ae)!=="body"||isOverflowElement(ve))&&(Ye=getNodeScroll(ae)),isHTMLElement(ae))){const rt=getBoundingClientRect(ae);Ke=getScale(ae),Xe.x=rt.x+ae.clientLeft,Xe.y=rt.y+ae.clientTop}return{width:ee.width*Ke.x,height:ee.height*Ke.y,x:ee.x*Ke.x-Ye.scrollLeft*Ke.x+Xe.x,y:ee.y*Ke.y-Ye.scrollTop*Ke.y+Xe.y}}function getClientRects(ie){return Array.from(ie.getClientRects())}function getWindowScrollBarX(ie){return getBoundingClientRect(getDocumentElement(ie)).left+getNodeScroll(ie).scrollLeft}function getDocumentRect(ie){const Z=getDocumentElement(ie),ee=getNodeScroll(ie),ae=ie.ownerDocument.body,ye=max(Z.scrollWidth,Z.clientWidth,ae.scrollWidth,ae.clientWidth),ve=max(Z.scrollHeight,Z.clientHeight,ae.scrollHeight,ae.clientHeight);let be=-ee.scrollLeft+getWindowScrollBarX(ie);const Ye=-ee.scrollTop;return getComputedStyle$1(ae).direction==="rtl"&&(be+=max(Z.clientWidth,ae.clientWidth)-ye),{width:ye,height:ve,x:be,y:Ye}}function getViewportRect(ie,Z){const ee=getWindow(ie),ae=getDocumentElement(ie),ye=ee.visualViewport;let ve=ae.clientWidth,be=ae.clientHeight,Ye=0,Ke=0;if(ye){ve=ye.width,be=ye.height;const Xe=isWebKit();(!Xe||Xe&&Z==="fixed")&&(Ye=ye.offsetLeft,Ke=ye.offsetTop)}return{width:ve,height:be,x:Ye,y:Ke}}function getInnerBoundingClientRect(ie,Z){const ee=getBoundingClientRect(ie,!0,Z==="fixed"),ae=ee.top+ie.clientTop,ye=ee.left+ie.clientLeft,ve=isHTMLElement(ie)?getScale(ie):createCoords(1),be=ie.clientWidth*ve.x,Ye=ie.clientHeight*ve.y,Ke=ye*ve.x,Xe=ae*ve.y;return{width:be,height:Ye,x:Ke,y:Xe}}function getClientRectFromClippingAncestor(ie,Z,ee){let ae;if(Z==="viewport")ae=getViewportRect(ie,ee);else if(Z==="document")ae=getDocumentRect(getDocumentElement(ie));else if(isElement(Z))ae=getInnerBoundingClientRect(Z,ee);else{const ye=getVisualOffsets(ie);ae={...Z,x:Z.x-ye.x,y:Z.y-ye.y}}return rectToClientRect(ae)}function hasFixedPositionAncestor(ie,Z){const ee=getParentNode(ie);return ee===Z||!isElement(ee)||isLastTraversableNode(ee)?!1:getComputedStyle$1(ee).position==="fixed"||hasFixedPositionAncestor(ee,Z)}function getClippingElementAncestors(ie,Z){const ee=Z.get(ie);if(ee)return ee;let ae=getOverflowAncestors(ie,[],!1).filter(Ye=>isElement(Ye)&&getNodeName(Ye)!=="body"),ye=null;const ve=getComputedStyle$1(ie).position==="fixed";let be=ve?getParentNode(ie):ie;for(;isElement(be)&&!isLastTraversableNode(be);){const Ye=getComputedStyle$1(be),Ke=isContainingBlock(be);!Ke&&Ye.position==="fixed"&&(ye=null),(ve?!Ke&&!ye:!Ke&&Ye.position==="static"&&ye&&["absolute","fixed"].includes(ye.position)||isOverflowElement(be)&&!Ke&&hasFixedPositionAncestor(ie,be))?ae=ae.filter(Xe=>Xe!==be):ye=Ye,be=getParentNode(be)}return Z.set(ie,ae),ae}function getClippingRect(ie){let{element:Z,boundary:ee,rootBoundary:ae,strategy:ye}=ie;const ve=[...ee==="clippingAncestors"?getClippingElementAncestors(Z,this._c):[].concat(ee),ae],be=ve[0],Ye=ve.reduce((Ke,Xe)=>{const Je=getClientRectFromClippingAncestor(Z,Xe,ye);return Ke.top=max(Je.top,Ke.top),Ke.right=min(Je.right,Ke.right),Ke.bottom=min(Je.bottom,Ke.bottom),Ke.left=max(Je.left,Ke.left),Ke},getClientRectFromClippingAncestor(Z,be,ye));return{width:Ye.right-Ye.left,height:Ye.bottom-Ye.top,x:Ye.left,y:Ye.top}}function getDimensions(ie){const{width:Z,height:ee}=getCssDimensions(ie);return{width:Z,height:ee}}function getRectRelativeToOffsetParent(ie,Z,ee,ae){const ye=isHTMLElement(Z),ve=getDocumentElement(Z),be=ee==="fixed",Ye=getBoundingClientRect(ie,!0,be,Z);let Ke={scrollLeft:0,scrollTop:0};const Xe=createCoords(0);if(ye||!ye&&!be)if((getNodeName(Z)!=="body"||isOverflowElement(ve))&&(Ke=getNodeScroll(Z)),ye){const ct=getBoundingClientRect(Z,!0,be,Z);Xe.x=ct.x+Z.clientLeft,Xe.y=ct.y+Z.clientTop}else ve&&(Xe.x=getWindowScrollBarX(ve));let Je=Ye.left+Ke.scrollLeft-Xe.x,rt=Ye.top+Ke.scrollTop-Xe.y;const[nt,it,lt]=topLayer(ae);return nt&&(Je+=it,rt+=lt,ye&&(Je+=Z.clientLeft,rt+=Z.clientTop)),{x:Je,y:rt,width:Ye.width,height:Ye.height}}function getTrueOffsetParent(ie,Z){return!isHTMLElement(ie)||getComputedStyle$1(ie).position==="fixed"?null:Z?Z(ie):ie.offsetParent}function getOffsetParent(ie,Z){const ee=getWindow(ie);if(!isHTMLElement(ie))return ee;let ae=getTrueOffsetParent(ie,Z);for(;ae&&isTableElement(ae)&&getComputedStyle$1(ae).position==="static";)ae=getTrueOffsetParent(ae,Z);return ae&&(getNodeName(ae)==="html"||getNodeName(ae)==="body"&&getComputedStyle$1(ae).position==="static"&&!isContainingBlock(ae))?ee:ae||getContainingBlock(ie)||ee}const getElementRects=async function(ie){const Z=this.getOffsetParent||getOffsetParent,ee=this.getDimensions;return{reference:getRectRelativeToOffsetParent(ie.reference,await Z(ie.floating),ie.strategy,ie.floating),floating:{x:0,y:0,...await ee(ie.floating)}}};function isRTL(ie){return getComputedStyle$1(ie).direction==="rtl"}const platform={convertOffsetParentRelativeRectToViewportRelativeRect,getDocumentElement,getClippingRect,getOffsetParent,getElementRects,getClientRects,getDimensions,getScale,isElement,isRTL};function observeMove(ie,Z){let ee=null,ae;const ye=getDocumentElement(ie);function ve(){var Ye;clearTimeout(ae),(Ye=ee)==null||Ye.disconnect(),ee=null}function be(Ye,Ke){Ye===void 0&&(Ye=!1),Ke===void 0&&(Ke=1),ve();const{left:Xe,top:Je,width:rt,height:nt}=ie.getBoundingClientRect();if(Ye||Z(),!rt||!nt)return;const it=floor(Je),lt=floor(ye.clientWidth-(Xe+rt)),ct=floor(ye.clientHeight-(Je+nt)),ot=floor(Xe),dt={rootMargin:-it+"px "+-lt+"px "+-ct+"px "+-ot+"px",threshold:max(0,min(1,Ke))||1};let ft=!0;function gt(mt){const Yr=mt[0].intersectionRatio;if(Yr!==Ke){if(!ft)return be();Yr?be(!1,Yr):ae=setTimeout(()=>{be(!1,1e-7)},100)}ft=!1}try{ee=new IntersectionObserver(gt,{...dt,root:ye.ownerDocument})}catch{ee=new IntersectionObserver(gt,dt)}ee.observe(ie)}return be(!0),ve}function autoUpdate(ie,Z,ee,ae){ae===void 0&&(ae={});const{ancestorScroll:ye=!0,ancestorResize:ve=!0,elementResize:be=typeof ResizeObserver=="function",layoutShift:Ye=typeof IntersectionObserver=="function",animationFrame:Ke=!1}=ae,Xe=unwrapElement(ie),Je=ye||ve?[...Xe?getOverflowAncestors(Xe):[],...getOverflowAncestors(Z)]:[];Je.forEach(dt=>{ye&&dt.addEventListener("scroll",ee,{passive:!0}),ve&&dt.addEventListener("resize",ee)});const rt=Xe&&Ye?observeMove(Xe,ee):null;let nt=-1,it=null;be&&(it=new ResizeObserver(dt=>{let[ft]=dt;ft&&ft.target===Xe&&it&&(it.unobserve(Z),cancelAnimationFrame(nt),nt=requestAnimationFrame(()=>{var gt;(gt=it)==null||gt.observe(Z)})),ee()}),Xe&&!Ke&&it.observe(Xe),it.observe(Z));let lt,ct=Ke?getBoundingClientRect(ie):null;Ke&&ot();function ot(){const dt=getBoundingClientRect(ie);ct&&(dt.x!==ct.x||dt.y!==ct.y||dt.width!==ct.width||dt.height!==ct.height)&&ee(),ct=dt,lt=requestAnimationFrame(ot)}return ee(),()=>{var dt;Je.forEach(ft=>{ye&&ft.removeEventListener("scroll",ee),ve&&ft.removeEventListener("resize",ee)}),rt==null||rt(),(dt=it)==null||dt.disconnect(),it=null,Ke&&cancelAnimationFrame(lt)}}const shift=shift$1,flip=flip$1,size=size$1,hide=hide$1,arrow$1=arrow$2,limitShift=limitShift$1,computePosition=(ie,Z,ee)=>{const ae=new Map,ye={platform,...ee},ve={...ye.platform,_c:ae};return computePosition$1(ie,Z,{...ye,platform:ve})},arrow=ie=>{function Z(ee){return{}.hasOwnProperty.call(ee,"current")}return{name:"arrow",options:ie,fn(ee){const{element:ae,padding:ye}=typeof ie=="function"?ie(ee):ie;return ae&&Z(ae)?ae.current!=null?arrow$1({element:ae.current,padding:ye}).fn(ee):{}:ae?arrow$1({element:ae,padding:ye}).fn(ee):{}}}};var index=typeof document<"u"?reactExports.useLayoutEffect:reactExports.useEffect;function deepEqual(ie,Z){if(ie===Z)return!0;if(typeof ie!=typeof Z)return!1;if(typeof ie=="function"&&ie.toString()===Z.toString())return!0;let ee,ae,ye;if(ie&&Z&&typeof ie=="object"){if(Array.isArray(ie)){if(ee=ie.length,ee!==Z.length)return!1;for(ae=ee;ae--!==0;)if(!deepEqual(ie[ae],Z[ae]))return!1;return!0}if(ye=Object.keys(ie),ee=ye.length,ee!==Object.keys(Z).length)return!1;for(ae=ee;ae--!==0;)if(!{}.hasOwnProperty.call(Z,ye[ae]))return!1;for(ae=ee;ae--!==0;){const ve=ye[ae];if(!(ve==="_owner"&&ie.$$typeof)&&!deepEqual(ie[ve],Z[ve]))return!1}return!0}return ie!==ie&&Z!==Z}function getDPR(ie){return typeof window>"u"?1:(ie.ownerDocument.defaultView||window).devicePixelRatio||1}function roundByDPR(ie,Z){const ee=getDPR(ie);return Math.round(Z*ee)/ee}function useLatestRef(ie){const Z=reactExports.useRef(ie);return index(()=>{Z.current=ie}),Z}function useFloating(ie){ie===void 0&&(ie={});const{placement:Z="bottom",strategy:ee="absolute",middleware:ae=[],platform:ye,elements:{reference:ve,floating:be}={},transform:Ye=!0,whileElementsMounted:Ke,open:Xe}=ie,[Je,rt]=reactExports.useState({x:0,y:0,strategy:ee,placement:Z,middlewareData:{},isPositioned:!1}),[nt,it]=reactExports.useState(ae);deepEqual(nt,ae)||it(ae);const[lt,ct]=reactExports.useState(null),[ot,dt]=reactExports.useState(null),ft=reactExports.useCallback(ri=>{ri!==Qr.current&&(Qr.current=ri,ct(ri))},[]),gt=reactExports.useCallback(ri=>{ri!==Xr.current&&(Xr.current=ri,dt(ri))},[]),mt=ve||lt,Yr=be||ot,Qr=reactExports.useRef(null),Xr=reactExports.useRef(null),Jr=reactExports.useRef(Je),ai=Ke!=null,oi=useLatestRef(Ke),ni=useLatestRef(ye),li=reactExports.useCallback(()=>{if(!Qr.current||!Xr.current)return;const ri={placement:Z,strategy:ee,middleware:nt};ni.current&&(ri.platform=ni.current),computePosition(Qr.current,Xr.current,ri).then(ci=>{const Si={...ci,isPositioned:!0};ui.current&&!deepEqual(Jr.current,Si)&&(Jr.current=Si,reactDomExports.flushSync(()=>{rt(Si)}))})},[nt,Z,ee,ni]);index(()=>{Xe===!1&&Jr.current.isPositioned&&(Jr.current.isPositioned=!1,rt(ri=>({...ri,isPositioned:!1})))},[Xe]);const ui=reactExports.useRef(!1);index(()=>(ui.current=!0,()=>{ui.current=!1}),[]),index(()=>{if(mt&&(Qr.current=mt),Yr&&(Xr.current=Yr),mt&&Yr){if(oi.current)return oi.current(mt,Yr,li);li()}},[mt,Yr,li,oi,ai]);const mi=reactExports.useMemo(()=>({reference:Qr,floating:Xr,setReference:ft,setFloating:gt}),[ft,gt]),ii=reactExports.useMemo(()=>({reference:mt,floating:Yr}),[mt,Yr]),hi=reactExports.useMemo(()=>{const ri={position:ee,left:0,top:0};if(!ii.floating)return ri;const ci=roundByDPR(ii.floating,Je.x),Si=roundByDPR(ii.floating,Je.y);return Ye?{...ri,transform:"translate("+ci+"px, "+Si+"px)",...getDPR(ii.floating)>=1.5&&{willChange:"transform"}}:{position:ee,left:ci,top:Si}},[ee,Ye,ii.floating,Je.x,Je.y]);return reactExports.useMemo(()=>({...Je,update:li,refs:mi,elements:ii,floatingStyles:hi}),[Je,li,mi,ii,hi])}const $7e8f5cd07187803e$export$21b07c8f274aebd5=reactExports.forwardRef((ie,Z)=>{const{children:ee,width:ae=10,height:ye=5,...ve}=ie;return reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.svg,_extends$1({},ve,{ref:Z,width:ae,height:ye,viewBox:"0 0 30 10",preserveAspectRatio:"none"}),ie.asChild?ee:reactExports.createElement("polygon",{points:"0,0 30,0 15,10"}))}),$7e8f5cd07187803e$export$be92b6f5f03c0fe9=$7e8f5cd07187803e$export$21b07c8f274aebd5,$cf1ac5d9fe0e8206$var$POPPER_NAME="Popper",[$cf1ac5d9fe0e8206$var$createPopperContext,$cf1ac5d9fe0e8206$export$722aac194ae923]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($cf1ac5d9fe0e8206$var$POPPER_NAME),[$cf1ac5d9fe0e8206$var$PopperProvider,$cf1ac5d9fe0e8206$var$usePopperContext]=$cf1ac5d9fe0e8206$var$createPopperContext($cf1ac5d9fe0e8206$var$POPPER_NAME),$cf1ac5d9fe0e8206$export$badac9ada3a0bdf9=ie=>{const{__scopePopper:Z,children:ee}=ie,[ae,ye]=reactExports.useState(null);return reactExports.createElement($cf1ac5d9fe0e8206$var$PopperProvider,{scope:Z,anchor:ae,onAnchorChange:ye},ee)},$cf1ac5d9fe0e8206$var$ANCHOR_NAME="PopperAnchor",$cf1ac5d9fe0e8206$export$ecd4e1ccab6ed6d=reactExports.forwardRef((ie,Z)=>{const{__scopePopper:ee,virtualRef:ae,...ye}=ie,ve=$cf1ac5d9fe0e8206$var$usePopperContext($cf1ac5d9fe0e8206$var$ANCHOR_NAME,ee),be=reactExports.useRef(null),Ye=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,be);return reactExports.useEffect(()=>{ve.onAnchorChange((ae==null?void 0:ae.current)||be.current)}),ae?null:reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({},ye,{ref:Ye}))}),$cf1ac5d9fe0e8206$var$CONTENT_NAME="PopperContent",[$cf1ac5d9fe0e8206$var$PopperContentProvider,$cf1ac5d9fe0e8206$var$useContentContext]=$cf1ac5d9fe0e8206$var$createPopperContext($cf1ac5d9fe0e8206$var$CONTENT_NAME),$cf1ac5d9fe0e8206$export$bc4ae5855d3c4fc=reactExports.forwardRef((ie,Z)=>{var ee,ae,ye,ve,be,Ye,Ke,Xe;const{__scopePopper:Je,side:rt="bottom",sideOffset:nt=0,align:it="center",alignOffset:lt=0,arrowPadding:ct=0,avoidCollisions:ot=!0,collisionBoundary:dt=[],collisionPadding:ft=0,sticky:gt="partial",hideWhenDetached:mt=!1,updatePositionStrategy:Yr="optimized",onPlaced:Qr,...Xr}=ie,Jr=$cf1ac5d9fe0e8206$var$usePopperContext($cf1ac5d9fe0e8206$var$CONTENT_NAME,Je),[ai,oi]=reactExports.useState(null),ni=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,wi=>oi(wi)),[li,ui]=reactExports.useState(null),mi=$db6c3485150b8e66$export$1ab7ae714698c4b8(li),ii=(ee=mi==null?void 0:mi.width)!==null&&ee!==void 0?ee:0,hi=(ae=mi==null?void 0:mi.height)!==null&&ae!==void 0?ae:0,ri=rt+(it!=="center"?"-"+it:""),ci=typeof ft=="number"?ft:{top:0,right:0,bottom:0,left:0,...ft},Si=Array.isArray(dt)?dt:[dt],si=Si.length>0,Ei={padding:ci,boundary:Si.filter($cf1ac5d9fe0e8206$var$isNotNull),altBoundary:si},{refs:yi,floatingStyles:Mi,placement:Ci,isPositioned:Ri,middlewareData:Ni}=useFloating({strategy:"fixed",placement:ri,whileElementsMounted:(...wi)=>autoUpdate(...wi,{animationFrame:Yr==="always"}),elements:{reference:Jr.anchor},middleware:[offset({mainAxis:nt+hi,alignmentAxis:lt}),ot&&shift({mainAxis:!0,crossAxis:!1,limiter:gt==="partial"?limitShift():void 0,...Ei}),ot&&flip({...Ei}),size({...Ei,apply:({elements:wi,rects:Ii,availableWidth:Di,availableHeight:is})=>{const{width:Gi,height:us}=Ii.reference,Zi=wi.floating.style;Zi.setProperty("--radix-popper-available-width",`${Di}px`),Zi.setProperty("--radix-popper-available-height",`${is}px`),Zi.setProperty("--radix-popper-anchor-width",`${Gi}px`),Zi.setProperty("--radix-popper-anchor-height",`${us}px`)}}),li&&arrow({element:li,padding:ct}),$cf1ac5d9fe0e8206$var$transformOrigin({arrowWidth:ii,arrowHeight:hi}),mt&&hide({strategy:"referenceHidden",...Ei})]}),[Ai,ki]=$cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(Ci),Yi=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(Qr);$9f79659886946c16$export$e5c5a5f917a5871c(()=>{Ri&&(Yi==null||Yi())},[Ri,Yi]);const Ji=(ye=Ni.arrow)===null||ye===void 0?void 0:ye.x,ls=(ve=Ni.arrow)===null||ve===void 0?void 0:ve.y,hs=((be=Ni.arrow)===null||be===void 0?void 0:be.centerOffset)!==0,[Kr,di]=reactExports.useState();return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{ai&&di(window.getComputedStyle(ai).zIndex)},[ai]),reactExports.createElement("div",{ref:yi.setFloating,"data-radix-popper-content-wrapper":"",style:{...Mi,transform:Ri?Mi.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Kr,"--radix-popper-transform-origin":[(Ye=Ni.transformOrigin)===null||Ye===void 0?void 0:Ye.x,(Ke=Ni.transformOrigin)===null||Ke===void 0?void 0:Ke.y].join(" ")},dir:ie.dir},reactExports.createElement($cf1ac5d9fe0e8206$var$PopperContentProvider,{scope:Je,placedSide:Ai,onArrowChange:ui,arrowX:Ji,arrowY:ls,shouldHideArrow:hs},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"data-side":Ai,"data-align":ki},Xr,{ref:ni,style:{...Xr.style,animation:Ri?void 0:"none",opacity:(Xe=Ni.hide)!==null&&Xe!==void 0&&Xe.referenceHidden?0:void 0}}))))}),$cf1ac5d9fe0e8206$var$ARROW_NAME="PopperArrow",$cf1ac5d9fe0e8206$var$OPPOSITE_SIDE={top:"bottom",right:"left",bottom:"top",left:"right"},$cf1ac5d9fe0e8206$export$79d62cd4e10a3fd0=reactExports.forwardRef(function(ie,Z){const{__scopePopper:ee,...ae}=ie,ye=$cf1ac5d9fe0e8206$var$useContentContext($cf1ac5d9fe0e8206$var$ARROW_NAME,ee),ve=$cf1ac5d9fe0e8206$var$OPPOSITE_SIDE[ye.placedSide];return reactExports.createElement("span",{ref:ye.onArrowChange,style:{position:"absolute",left:ye.arrowX,top:ye.arrowY,[ve]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[ye.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[ye.placedSide],visibility:ye.shouldHideArrow?"hidden":void 0}},reactExports.createElement($7e8f5cd07187803e$export$be92b6f5f03c0fe9,_extends$1({},ae,{ref:Z,style:{...ae.style,display:"block"}})))});function $cf1ac5d9fe0e8206$var$isNotNull(ie){return ie!==null}const $cf1ac5d9fe0e8206$var$transformOrigin=ie=>({name:"transformOrigin",options:ie,fn(Z){var ee,ae,ye,ve,be;const{placement:Ye,rects:Ke,middlewareData:Xe}=Z,Je=((ee=Xe.arrow)===null||ee===void 0?void 0:ee.centerOffset)!==0,rt=Je?0:ie.arrowWidth,nt=Je?0:ie.arrowHeight,[it,lt]=$cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(Ye),ct={start:"0%",center:"50%",end:"100%"}[lt],ot=((ae=(ye=Xe.arrow)===null||ye===void 0?void 0:ye.x)!==null&&ae!==void 0?ae:0)+rt/2,dt=((ve=(be=Xe.arrow)===null||be===void 0?void 0:be.y)!==null&&ve!==void 0?ve:0)+nt/2;let ft="",gt="";return it==="bottom"?(ft=Je?ct:`${ot}px`,gt=`${-nt}px`):it==="top"?(ft=Je?ct:`${ot}px`,gt=`${Ke.floating.height+nt}px`):it==="right"?(ft=`${-nt}px`,gt=Je?ct:`${dt}px`):it==="left"&&(ft=`${Ke.floating.width+nt}px`,gt=Je?ct:`${dt}px`),{data:{x:ft,y:gt}}}});function $cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(ie){const[Z,ee="center"]=ie.split("-");return[Z,ee]}const $cf1ac5d9fe0e8206$export$be92b6f5f03c0fe9=$cf1ac5d9fe0e8206$export$badac9ada3a0bdf9,$cf1ac5d9fe0e8206$export$b688253958b8dfe7=$cf1ac5d9fe0e8206$export$ecd4e1ccab6ed6d,$cf1ac5d9fe0e8206$export$7c6e2c02157bb7d2=$cf1ac5d9fe0e8206$export$bc4ae5855d3c4fc,$cf1ac5d9fe0e8206$export$21b07c8f274aebd5=$cf1ac5d9fe0e8206$export$79d62cd4e10a3fd0,$f1701beae083dbae$export$602eac185826482c=reactExports.forwardRef((ie,Z)=>{var ee;const{container:ae=globalThis==null||(ee=globalThis.document)===null||ee===void 0?void 0:ee.body,...ye}=ie;return ae?$7SXl2$reactdom.createPortal(reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({},ye,{ref:Z})),ae):null});var getDefaultParent=function(ie){if(typeof document>"u")return null;var Z=Array.isArray(ie)?ie[0]:ie;return Z.ownerDocument.body},counterMap=new WeakMap,uncontrolledNodes=new WeakMap,markerMap={},lockCount=0,unwrapHost=function(ie){return ie&&(ie.host||unwrapHost(ie.parentNode))},correctTargets=function(ie,Z){return Z.map(function(ee){if(ie.contains(ee))return ee;var ae=unwrapHost(ee);return ae&&ie.contains(ae)?ae:(console.error("aria-hidden",ee,"in not contained inside",ie,". Doing nothing"),null)}).filter(function(ee){return!!ee})},applyAttributeToOthers=function(ie,Z,ee,ae){var ye=correctTargets(Z,Array.isArray(ie)?ie:[ie]);markerMap[ee]||(markerMap[ee]=new WeakMap);var ve=markerMap[ee],be=[],Ye=new Set,Ke=new Set(ye),Xe=function(rt){!rt||Ye.has(rt)||(Ye.add(rt),Xe(rt.parentNode))};ye.forEach(Xe);var Je=function(rt){!rt||Ke.has(rt)||Array.prototype.forEach.call(rt.children,function(nt){if(Ye.has(nt))Je(nt);else{var it=nt.getAttribute(ae),lt=it!==null&&it!=="false",ct=(counterMap.get(nt)||0)+1,ot=(ve.get(nt)||0)+1;counterMap.set(nt,ct),ve.set(nt,ot),be.push(nt),ct===1&&lt&&uncontrolledNodes.set(nt,!0),ot===1&&nt.setAttribute(ee,"true"),lt||nt.setAttribute(ae,"true")}})};return Je(Z),Ye.clear(),lockCount++,function(){be.forEach(function(rt){var nt=counterMap.get(rt)-1,it=ve.get(rt)-1;counterMap.set(rt,nt),ve.set(rt,it),nt||(uncontrolledNodes.has(rt)||rt.removeAttribute(ae),uncontrolledNodes.delete(rt)),it||rt.removeAttribute(ee)}),lockCount--,lockCount||(counterMap=new WeakMap,counterMap=new WeakMap,uncontrolledNodes=new WeakMap,markerMap={})}},hideOthers=function(ie,Z,ee){ee===void 0&&(ee="data-aria-hidden");var ae=Array.from(Array.isArray(ie)?ie:[ie]),ye=getDefaultParent(ie);return ye?(ae.push.apply(ae,Array.from(ye.querySelectorAll("[aria-live]"))),applyAttributeToOthers(ae,ye,ee,"aria-hidden")):function(){return null}},__assign=function(){return __assign=Object.assign||function(ie){for(var Z,ee=1,ae=arguments.length;ee<ae;ee++){Z=arguments[ee];for(var ye in Z)Object.prototype.hasOwnProperty.call(Z,ye)&&(ie[ye]=Z[ye])}return ie},__assign.apply(this,arguments)};function __rest(ie,Z){var ee={};for(var ae in ie)Object.prototype.hasOwnProperty.call(ie,ae)&&Z.indexOf(ae)<0&&(ee[ae]=ie[ae]);if(ie!=null&&typeof Object.getOwnPropertySymbols=="function")for(var ye=0,ae=Object.getOwnPropertySymbols(ie);ye<ae.length;ye++)Z.indexOf(ae[ye])<0&&Object.prototype.propertyIsEnumerable.call(ie,ae[ye])&&(ee[ae[ye]]=ie[ae[ye]]);return ee}function __spreadArray(ie,Z,ee){for(var ae=0,ye=Z.length,ve;ae<ye;ae++)(ve||!(ae in Z))&&(ve||(ve=Array.prototype.slice.call(Z,0,ae)),ve[ae]=Z[ae]);return ie.concat(ve||Array.prototype.slice.call(Z))}var zeroRightClassName="right-scroll-bar-position",fullWidthClassName="width-before-scroll-bar",noScrollbarsClassName="with-scroll-bars-hidden",removedBarSizeVariable="--removed-body-scroll-bar-size";function assignRef(ie,Z){return typeof ie=="function"?ie(Z):ie&&(ie.current=Z),ie}function useCallbackRef(ie,Z){var ee=reactExports.useState(function(){return{value:ie,callback:Z,facade:{get current(){return ee.value},set current(ae){var ye=ee.value;ye!==ae&&(ee.value=ae,ee.callback(ae,ye))}}}})[0];return ee.callback=Z,ee.facade}var currentValues=new WeakMap;function useMergeRefs(ie,Z){var ee=useCallbackRef(null,function(ae){return ie.forEach(function(ye){return assignRef(ye,ae)})});return reactExports.useLayoutEffect(function(){var ae=currentValues.get(ee);if(ae){var ye=new Set(ae),ve=new Set(ie),be=ee.current;ye.forEach(function(Ye){ve.has(Ye)||assignRef(Ye,null)}),ve.forEach(function(Ye){ye.has(Ye)||assignRef(Ye,be)})}currentValues.set(ee,ie)},[ie]),ee}function ItoI(ie){return ie}function innerCreateMedium(ie,Z){Z===void 0&&(Z=ItoI);var ee=[],ae=!1,ye={read:function(){if(ae)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return ee.length?ee[ee.length-1]:ie},useMedium:function(ve){var be=Z(ve,ae);return ee.push(be),function(){ee=ee.filter(function(Ye){return Ye!==be})}},assignSyncMedium:function(ve){for(ae=!0;ee.length;){var be=ee;ee=[],be.forEach(ve)}ee={push:function(Ye){return ve(Ye)},filter:function(){return ee}}},assignMedium:function(ve){ae=!0;var be=[];if(ee.length){var Ye=ee;ee=[],Ye.forEach(ve),be=ee}var Ke=function(){var Je=be;be=[],Je.forEach(ve)},Xe=function(){return Promise.resolve().then(Ke)};Xe(),ee={push:function(Je){be.push(Je),Xe()},filter:function(Je){return be=be.filter(Je),ee}}}};return ye}function createSidecarMedium(ie){ie===void 0&&(ie={});var Z=innerCreateMedium(null);return Z.options=__assign({async:!0,ssr:!1},ie),Z}var SideCar$1=function(ie){var Z=ie.sideCar,ee=__rest(ie,["sideCar"]);if(!Z)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var ae=Z.read();if(!ae)throw new Error("Sidecar medium not found");return reactExports.createElement(ae,__assign({},ee))};SideCar$1.isSideCarExport=!0;function exportSidecar(ie,Z){return ie.useMedium(Z),SideCar$1}var effectCar=createSidecarMedium(),nothing=function(){},RemoveScroll=reactExports.forwardRef(function(ie,Z){var ee=reactExports.useRef(null),ae=reactExports.useState({onScrollCapture:nothing,onWheelCapture:nothing,onTouchMoveCapture:nothing}),ye=ae[0],ve=ae[1],be=ie.forwardProps,Ye=ie.children,Ke=ie.className,Xe=ie.removeScrollBar,Je=ie.enabled,rt=ie.shards,nt=ie.sideCar,it=ie.noIsolation,lt=ie.inert,ct=ie.allowPinchZoom,ot=ie.as,dt=ot===void 0?"div":ot,ft=__rest(ie,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as"]),gt=nt,mt=useMergeRefs([ee,Z]),Yr=__assign(__assign({},ft),ye);return reactExports.createElement(reactExports.Fragment,null,Je&&reactExports.createElement(gt,{sideCar:effectCar,removeScrollBar:Xe,shards:rt,noIsolation:it,inert:lt,setCallbacks:ve,allowPinchZoom:!!ct,lockRef:ee}),be?reactExports.cloneElement(reactExports.Children.only(Ye),__assign(__assign({},Yr),{ref:mt})):reactExports.createElement(dt,__assign({},Yr,{className:Ke,ref:mt}),Ye))});RemoveScroll.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};RemoveScroll.classNames={fullWidth:fullWidthClassName,zeroRight:zeroRightClassName};var getNonce=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function makeStyleTag(){if(!document)return null;var ie=document.createElement("style");ie.type="text/css";var Z=getNonce();return Z&&ie.setAttribute("nonce",Z),ie}function injectStyles(ie,Z){ie.styleSheet?ie.styleSheet.cssText=Z:ie.appendChild(document.createTextNode(Z))}function insertStyleTag(ie){var Z=document.head||document.getElementsByTagName("head")[0];Z.appendChild(ie)}var stylesheetSingleton=function(){var ie=0,Z=null;return{add:function(ee){ie==0&&(Z=makeStyleTag())&&(injectStyles(Z,ee),insertStyleTag(Z)),ie++},remove:function(){ie--,!ie&&Z&&(Z.parentNode&&Z.parentNode.removeChild(Z),Z=null)}}},styleHookSingleton=function(){var ie=stylesheetSingleton();return function(Z,ee){reactExports.useEffect(function(){return ie.add(Z),function(){ie.remove()}},[Z&&ee])}},styleSingleton=function(){var ie=styleHookSingleton(),Z=function(ee){var ae=ee.styles,ye=ee.dynamic;return ie(ae,ye),null};return Z},zeroGap={left:0,top:0,right:0,gap:0},parse=function(ie){return parseInt(ie||"",10)||0},getOffset=function(ie){var Z=window.getComputedStyle(document.body),ee=Z[ie==="padding"?"paddingLeft":"marginLeft"],ae=Z[ie==="padding"?"paddingTop":"marginTop"],ye=Z[ie==="padding"?"paddingRight":"marginRight"];return[parse(ee),parse(ae),parse(ye)]},getGapWidth=function(ie){if(ie===void 0&&(ie="margin"),typeof window>"u")return zeroGap;var Z=getOffset(ie),ee=document.documentElement.clientWidth,ae=window.innerWidth;return{left:Z[0],top:Z[1],right:Z[2],gap:Math.max(0,ae-ee+Z[2]-Z[0])}},Style=styleSingleton(),getStyles=function(ie,Z,ee,ae){var ye=ie.left,ve=ie.top,be=ie.right,Ye=ie.gap;return ee===void 0&&(ee="margin"),`
  .`.concat(noScrollbarsClassName,` {
   overflow: hidden `).concat(ae,`;
   padding-right: `).concat(Ye,"px ").concat(ae,`;
  }
  body {
    overflow: hidden `).concat(ae,`;
    overscroll-behavior: contain;
    `).concat([Z&&"position: relative ".concat(ae,";"),ee==="margin"&&`
    padding-left: `.concat(ye,`px;
    padding-top: `).concat(ve,`px;
    padding-right: `).concat(be,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(Ye,"px ").concat(ae,`;
    `),ee==="padding"&&"padding-right: ".concat(Ye,"px ").concat(ae,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(zeroRightClassName,` {
    right: `).concat(Ye,"px ").concat(ae,`;
  }
  
  .`).concat(fullWidthClassName,` {
    margin-right: `).concat(Ye,"px ").concat(ae,`;
  }
  
  .`).concat(zeroRightClassName," .").concat(zeroRightClassName,` {
    right: 0 `).concat(ae,`;
  }
  
  .`).concat(fullWidthClassName," .").concat(fullWidthClassName,` {
    margin-right: 0 `).concat(ae,`;
  }
  
  body {
    `).concat(removedBarSizeVariable,": ").concat(Ye,`px;
  }
`)},RemoveScrollBar=function(ie){var Z=ie.noRelative,ee=ie.noImportant,ae=ie.gapMode,ye=ae===void 0?"margin":ae,ve=reactExports.useMemo(function(){return getGapWidth(ye)},[ye]);return reactExports.createElement(Style,{styles:getStyles(ve,!Z,ye,ee?"":"!important")})},passiveSupported=!1;if(typeof window<"u")try{var options=Object.defineProperty({},"passive",{get:function(){return passiveSupported=!0,!0}});window.addEventListener("test",options,options),window.removeEventListener("test",options,options)}catch{passiveSupported=!1}var nonPassive=passiveSupported?{passive:!1}:!1,alwaysContainsScroll=function(ie){return ie.tagName==="TEXTAREA"},elementCanBeScrolled=function(ie,Z){var ee=window.getComputedStyle(ie);return ee[Z]!=="hidden"&&!(ee.overflowY===ee.overflowX&&!alwaysContainsScroll(ie)&&ee[Z]==="visible")},elementCouldBeVScrolled=function(ie){return elementCanBeScrolled(ie,"overflowY")},elementCouldBeHScrolled=function(ie){return elementCanBeScrolled(ie,"overflowX")},locationCouldBeScrolled=function(ie,Z){var ee=Z;do{typeof ShadowRoot<"u"&&ee instanceof ShadowRoot&&(ee=ee.host);var ae=elementCouldBeScrolled(ie,ee);if(ae){var ye=getScrollVariables(ie,ee),ve=ye[1],be=ye[2];if(ve>be)return!0}ee=ee.parentNode}while(ee&&ee!==document.body);return!1},getVScrollVariables=function(ie){var Z=ie.scrollTop,ee=ie.scrollHeight,ae=ie.clientHeight;return[Z,ee,ae]},getHScrollVariables=function(ie){var Z=ie.scrollLeft,ee=ie.scrollWidth,ae=ie.clientWidth;return[Z,ee,ae]},elementCouldBeScrolled=function(ie,Z){return ie==="v"?elementCouldBeVScrolled(Z):elementCouldBeHScrolled(Z)},getScrollVariables=function(ie,Z){return ie==="v"?getVScrollVariables(Z):getHScrollVariables(Z)},getDirectionFactor=function(ie,Z){return ie==="h"&&Z==="rtl"?-1:1},handleScroll=function(ie,Z,ee,ae,ye){var ve=getDirectionFactor(ie,window.getComputedStyle(Z).direction),be=ve*ae,Ye=ee.target,Ke=Z.contains(Ye),Xe=!1,Je=be>0,rt=0,nt=0;do{var it=getScrollVariables(ie,Ye),lt=it[0],ct=it[1],ot=it[2],dt=ct-ot-ve*lt;(lt||dt)&&elementCouldBeScrolled(ie,Ye)&&(rt+=dt,nt+=lt),Ye=Ye.parentNode}while(!Ke&&Ye!==document.body||Ke&&(Z.contains(Ye)||Z===Ye));return(Je&&(rt===0||!ye)||!Je&&(nt===0||!ye))&&(Xe=!0),Xe},getTouchXY=function(ie){return"changedTouches"in ie?[ie.changedTouches[0].clientX,ie.changedTouches[0].clientY]:[0,0]},getDeltaXY=function(ie){return[ie.deltaX,ie.deltaY]},extractRef=function(ie){return ie&&"current"in ie?ie.current:ie},deltaCompare=function(ie,Z){return ie[0]===Z[0]&&ie[1]===Z[1]},generateStyle=function(ie){return`
  .block-interactivity-`.concat(ie,` {pointer-events: none;}
  .allow-interactivity-`).concat(ie,` {pointer-events: all;}
`)},idCounter=0,lockStack=[];function RemoveScrollSideCar(ie){var Z=reactExports.useRef([]),ee=reactExports.useRef([0,0]),ae=reactExports.useRef(),ye=reactExports.useState(idCounter++)[0],ve=reactExports.useState(function(){return styleSingleton()})[0],be=reactExports.useRef(ie);reactExports.useEffect(function(){be.current=ie},[ie]),reactExports.useEffect(function(){if(ie.inert){document.body.classList.add("block-interactivity-".concat(ye));var ct=__spreadArray([ie.lockRef.current],(ie.shards||[]).map(extractRef)).filter(Boolean);return ct.forEach(function(ot){return ot.classList.add("allow-interactivity-".concat(ye))}),function(){document.body.classList.remove("block-interactivity-".concat(ye)),ct.forEach(function(ot){return ot.classList.remove("allow-interactivity-".concat(ye))})}}},[ie.inert,ie.lockRef.current,ie.shards]);var Ye=reactExports.useCallback(function(ct,ot){if("touches"in ct&&ct.touches.length===2)return!be.current.allowPinchZoom;var dt=getTouchXY(ct),ft=ee.current,gt="deltaX"in ct?ct.deltaX:ft[0]-dt[0],mt="deltaY"in ct?ct.deltaY:ft[1]-dt[1],Yr,Qr=ct.target,Xr=Math.abs(gt)>Math.abs(mt)?"h":"v";if("touches"in ct&&Xr==="h"&&Qr.type==="range")return!1;var Jr=locationCouldBeScrolled(Xr,Qr);if(!Jr)return!0;if(Jr?Yr=Xr:(Yr=Xr==="v"?"h":"v",Jr=locationCouldBeScrolled(Xr,Qr)),!Jr)return!1;if(!ae.current&&"changedTouches"in ct&&(gt||mt)&&(ae.current=Yr),!Yr)return!0;var ai=ae.current||Yr;return handleScroll(ai,ot,ct,ai==="h"?gt:mt,!0)},[]),Ke=reactExports.useCallback(function(ct){var ot=ct;if(!(!lockStack.length||lockStack[lockStack.length-1]!==ve)){var dt="deltaY"in ot?getDeltaXY(ot):getTouchXY(ot),ft=Z.current.filter(function(Yr){return Yr.name===ot.type&&Yr.target===ot.target&&deltaCompare(Yr.delta,dt)})[0];if(ft&&ft.should){ot.cancelable&&ot.preventDefault();return}if(!ft){var gt=(be.current.shards||[]).map(extractRef).filter(Boolean).filter(function(Yr){return Yr.contains(ot.target)}),mt=gt.length>0?Ye(ot,gt[0]):!be.current.noIsolation;mt&&ot.cancelable&&ot.preventDefault()}}},[]),Xe=reactExports.useCallback(function(ct,ot,dt,ft){var gt={name:ct,delta:ot,target:dt,should:ft};Z.current.push(gt),setTimeout(function(){Z.current=Z.current.filter(function(mt){return mt!==gt})},1)},[]),Je=reactExports.useCallback(function(ct){ee.current=getTouchXY(ct),ae.current=void 0},[]),rt=reactExports.useCallback(function(ct){Xe(ct.type,getDeltaXY(ct),ct.target,Ye(ct,ie.lockRef.current))},[]),nt=reactExports.useCallback(function(ct){Xe(ct.type,getTouchXY(ct),ct.target,Ye(ct,ie.lockRef.current))},[]);reactExports.useEffect(function(){return lockStack.push(ve),ie.setCallbacks({onScrollCapture:rt,onWheelCapture:rt,onTouchMoveCapture:nt}),document.addEventListener("wheel",Ke,nonPassive),document.addEventListener("touchmove",Ke,nonPassive),document.addEventListener("touchstart",Je,nonPassive),function(){lockStack=lockStack.filter(function(ct){return ct!==ve}),document.removeEventListener("wheel",Ke,nonPassive),document.removeEventListener("touchmove",Ke,nonPassive),document.removeEventListener("touchstart",Je,nonPassive)}},[]);var it=ie.removeScrollBar,lt=ie.inert;return reactExports.createElement(reactExports.Fragment,null,lt?reactExports.createElement(ve,{styles:generateStyle(ye)}):null,it?reactExports.createElement(RemoveScrollBar,{gapMode:"margin"}):null)}const SideCar=exportSidecar(effectCar,RemoveScrollSideCar);var ReactRemoveScroll=reactExports.forwardRef(function(ie,Z){return reactExports.createElement(RemoveScroll,__assign({},ie,{ref:Z,sideCar:SideCar}))});ReactRemoveScroll.classNames=RemoveScroll.classNames;const $01b9c$RemoveScroll=ReactRemoveScroll,$cb5cc270b50c6fcd$var$POPOVER_NAME="Popover",[$cb5cc270b50c6fcd$var$createPopoverContext,$cb5cc270b50c6fcd$export$c8393c9e73286932]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($cb5cc270b50c6fcd$var$POPOVER_NAME,[$cf1ac5d9fe0e8206$export$722aac194ae923]),$cb5cc270b50c6fcd$var$usePopperScope=$cf1ac5d9fe0e8206$export$722aac194ae923(),[$cb5cc270b50c6fcd$var$PopoverProvider,$cb5cc270b50c6fcd$var$usePopoverContext]=$cb5cc270b50c6fcd$var$createPopoverContext($cb5cc270b50c6fcd$var$POPOVER_NAME),$cb5cc270b50c6fcd$export$5b6b19405a83ff9d=ie=>{const{__scopePopover:Z,children:ee,open:ae,defaultOpen:ye,onOpenChange:ve,modal:be=!1}=ie,Ye=$cb5cc270b50c6fcd$var$usePopperScope(Z),Ke=reactExports.useRef(null),[Xe,Je]=reactExports.useState(!1),[rt=!1,nt]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:ae,defaultProp:ye,onChange:ve});return reactExports.createElement($cf1ac5d9fe0e8206$export$be92b6f5f03c0fe9,Ye,reactExports.createElement($cb5cc270b50c6fcd$var$PopoverProvider,{scope:Z,contentId:$1746a345f3d73bb7$export$f680877a34711e37(),triggerRef:Ke,open:rt,onOpenChange:nt,onOpenToggle:reactExports.useCallback(()=>nt(it=>!it),[nt]),hasCustomAnchor:Xe,onCustomAnchorAdd:reactExports.useCallback(()=>Je(!0),[]),onCustomAnchorRemove:reactExports.useCallback(()=>Je(!1),[]),modal:be},ee))},$cb5cc270b50c6fcd$var$TRIGGER_NAME="PopoverTrigger",$cb5cc270b50c6fcd$export$7dacb05d26466c3=reactExports.forwardRef((ie,Z)=>{const{__scopePopover:ee,...ae}=ie,ye=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$TRIGGER_NAME,ee),ve=$cb5cc270b50c6fcd$var$usePopperScope(ee),be=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,ye.triggerRef),Ye=reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button","aria-haspopup":"dialog","aria-expanded":ye.open,"aria-controls":ye.contentId,"data-state":$cb5cc270b50c6fcd$var$getState(ye.open)},ae,{ref:be,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onClick,ye.onOpenToggle)}));return ye.hasCustomAnchor?Ye:reactExports.createElement($cf1ac5d9fe0e8206$export$b688253958b8dfe7,_extends$1({asChild:!0},ve),Ye)}),$cb5cc270b50c6fcd$var$PORTAL_NAME="PopoverPortal",[$cb5cc270b50c6fcd$var$PortalProvider,$cb5cc270b50c6fcd$var$usePortalContext]=$cb5cc270b50c6fcd$var$createPopoverContext($cb5cc270b50c6fcd$var$PORTAL_NAME,{forceMount:void 0}),$cb5cc270b50c6fcd$var$CONTENT_NAME="PopoverContent",$cb5cc270b50c6fcd$export$d7e1f420b25549ff=reactExports.forwardRef((ie,Z)=>{const ee=$cb5cc270b50c6fcd$var$usePortalContext($cb5cc270b50c6fcd$var$CONTENT_NAME,ie.__scopePopover),{forceMount:ae=ee.forceMount,...ye}=ie,ve=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$CONTENT_NAME,ie.__scopePopover);return reactExports.createElement($921a889cee6df7e8$export$99c2b779aa4e8b8b,{present:ae||ve.open},ve.modal?reactExports.createElement($cb5cc270b50c6fcd$var$PopoverContentModal,_extends$1({},ye,{ref:Z})):reactExports.createElement($cb5cc270b50c6fcd$var$PopoverContentNonModal,_extends$1({},ye,{ref:Z})))}),$cb5cc270b50c6fcd$var$PopoverContentModal=reactExports.forwardRef((ie,Z)=>{const ee=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$CONTENT_NAME,ie.__scopePopover),ae=reactExports.useRef(null),ye=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,ae),ve=reactExports.useRef(!1);return reactExports.useEffect(()=>{const be=ae.current;if(be)return hideOthers(be)},[]),reactExports.createElement($01b9c$RemoveScroll,{as:$5e63c961fc1ce211$export$8c6ed5c666ac1360,allowPinchZoom:!0},reactExports.createElement($cb5cc270b50c6fcd$var$PopoverContentImpl,_extends$1({},ie,{ref:ye,trapFocus:ee.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onCloseAutoFocus,be=>{var Ye;be.preventDefault(),ve.current||(Ye=ee.triggerRef.current)===null||Ye===void 0||Ye.focus()}),onPointerDownOutside:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onPointerDownOutside,be=>{const Ye=be.detail.originalEvent,Ke=Ye.button===0&&Ye.ctrlKey===!0,Xe=Ye.button===2||Ke;ve.current=Xe},{checkForDefaultPrevented:!1}),onFocusOutside:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onFocusOutside,be=>be.preventDefault(),{checkForDefaultPrevented:!1})})))}),$cb5cc270b50c6fcd$var$PopoverContentNonModal=reactExports.forwardRef((ie,Z)=>{const ee=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$CONTENT_NAME,ie.__scopePopover),ae=reactExports.useRef(!1),ye=reactExports.useRef(!1);return reactExports.createElement($cb5cc270b50c6fcd$var$PopoverContentImpl,_extends$1({},ie,{ref:Z,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:ve=>{var be;if((be=ie.onCloseAutoFocus)===null||be===void 0||be.call(ie,ve),!ve.defaultPrevented){var Ye;ae.current||(Ye=ee.triggerRef.current)===null||Ye===void 0||Ye.focus(),ve.preventDefault()}ae.current=!1,ye.current=!1},onInteractOutside:ve=>{var be,Ye;(be=ie.onInteractOutside)===null||be===void 0||be.call(ie,ve),ve.defaultPrevented||(ae.current=!0,ve.detail.originalEvent.type==="pointerdown"&&(ye.current=!0));const Ke=ve.target;!((Ye=ee.triggerRef.current)===null||Ye===void 0)&&Ye.contains(Ke)&&ve.preventDefault(),ve.detail.originalEvent.type==="focusin"&&ye.current&&ve.preventDefault()}}))}),$cb5cc270b50c6fcd$var$PopoverContentImpl=reactExports.forwardRef((ie,Z)=>{const{__scopePopover:ee,trapFocus:ae,onOpenAutoFocus:ye,onCloseAutoFocus:ve,disableOutsidePointerEvents:be,onEscapeKeyDown:Ye,onPointerDownOutside:Ke,onFocusOutside:Xe,onInteractOutside:Je,...rt}=ie,nt=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$CONTENT_NAME,ee),it=$cb5cc270b50c6fcd$var$usePopperScope(ee);return $3db38b7d1fb3fe6a$export$b7ece24a22aeda8c(),reactExports.createElement($d3863c46a17e8a28$export$20e40289641fbbb6,{asChild:!0,loop:!0,trapped:ae,onMountAutoFocus:ye,onUnmountAutoFocus:ve},reactExports.createElement($5cb92bef7577960e$export$177fb62ff3ec1f22,{asChild:!0,disableOutsidePointerEvents:be,onInteractOutside:Je,onEscapeKeyDown:Ye,onPointerDownOutside:Ke,onFocusOutside:Xe,onDismiss:()=>nt.onOpenChange(!1)},reactExports.createElement($cf1ac5d9fe0e8206$export$7c6e2c02157bb7d2,_extends$1({"data-state":$cb5cc270b50c6fcd$var$getState(nt.open),role:"dialog",id:nt.contentId},it,rt,{ref:Z,style:{...rt.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}}))))}),$cb5cc270b50c6fcd$var$CLOSE_NAME="PopoverClose",$cb5cc270b50c6fcd$export$d6ac43ebaa40d53e=reactExports.forwardRef((ie,Z)=>{const{__scopePopover:ee,...ae}=ie,ye=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$CLOSE_NAME,ee);return reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button"},ae,{ref:Z,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onClick,()=>ye.onOpenChange(!1))}))}),$cb5cc270b50c6fcd$export$3152841115e061b2=reactExports.forwardRef((ie,Z)=>{const{__scopePopover:ee,...ae}=ie,ye=$cb5cc270b50c6fcd$var$usePopperScope(ee);return reactExports.createElement($cf1ac5d9fe0e8206$export$21b07c8f274aebd5,_extends$1({},ye,ae,{ref:Z}))});function $cb5cc270b50c6fcd$var$getState(ie){return ie?"open":"closed"}const $cb5cc270b50c6fcd$export$be92b6f5f03c0fe9=$cb5cc270b50c6fcd$export$5b6b19405a83ff9d,$cb5cc270b50c6fcd$export$41fb9f06171c75f4=$cb5cc270b50c6fcd$export$7dacb05d26466c3,$cb5cc270b50c6fcd$export$7c6e2c02157bb7d2=$cb5cc270b50c6fcd$export$d7e1f420b25549ff,$cb5cc270b50c6fcd$export$f39c2d165cd861fe=$cb5cc270b50c6fcd$export$d6ac43ebaa40d53e,$cb5cc270b50c6fcd$export$21b07c8f274aebd5=$cb5cc270b50c6fcd$export$3152841115e061b2;function $ae6933e535247d3d$export$7d15b64cf5a3a4c4(ie,[Z,ee]){return Math.min(ee,Math.max(Z,ie))}const $ea1ef594cf570d83$export$439d29a4e110a164=reactExports.forwardRef((ie,Z)=>reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({},ie,{ref:Z,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...ie.style}}))),$cc7e05a45900e73f$var$OPEN_KEYS=[" ","Enter","ArrowUp","ArrowDown"],$cc7e05a45900e73f$var$SELECTION_KEYS=[" ","Enter"],$cc7e05a45900e73f$var$SELECT_NAME="Select",[$cc7e05a45900e73f$var$Collection,$cc7e05a45900e73f$var$useCollection,$cc7e05a45900e73f$var$createCollectionScope]=$e02a7d9cb1dc128c$export$c74125a8e3af6bb2($cc7e05a45900e73f$var$SELECT_NAME),[$cc7e05a45900e73f$var$createSelectContext,$cc7e05a45900e73f$export$286727a75dc039bd]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($cc7e05a45900e73f$var$SELECT_NAME,[$cc7e05a45900e73f$var$createCollectionScope,$cf1ac5d9fe0e8206$export$722aac194ae923]),$cc7e05a45900e73f$var$usePopperScope=$cf1ac5d9fe0e8206$export$722aac194ae923(),[$cc7e05a45900e73f$var$SelectProvider,$cc7e05a45900e73f$var$useSelectContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$SELECT_NAME),[$cc7e05a45900e73f$var$SelectNativeOptionsProvider,$cc7e05a45900e73f$var$useSelectNativeOptionsContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$SELECT_NAME),$cc7e05a45900e73f$export$ef9b1a59e592288f=ie=>{const{__scopeSelect:Z,children:ee,open:ae,defaultOpen:ye,onOpenChange:ve,value:be,defaultValue:Ye,onValueChange:Ke,dir:Xe,name:Je,autoComplete:rt,disabled:nt,required:it}=ie,lt=$cc7e05a45900e73f$var$usePopperScope(Z),[ct,ot]=reactExports.useState(null),[dt,ft]=reactExports.useState(null),[gt,mt]=reactExports.useState(!1),Yr=$f631663db3294ace$export$b39126d51d94e6f3(Xe),[Qr=!1,Xr]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:ae,defaultProp:ye,onChange:ve}),[Jr,ai]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:be,defaultProp:Ye,onChange:Ke}),oi=reactExports.useRef(null),ni=ct?!!ct.closest("form"):!0,[li,ui]=reactExports.useState(new Set),mi=Array.from(li).map(ii=>ii.props.value).join(";");return reactExports.createElement($cf1ac5d9fe0e8206$export$be92b6f5f03c0fe9,lt,reactExports.createElement($cc7e05a45900e73f$var$SelectProvider,{required:it,scope:Z,trigger:ct,onTriggerChange:ot,valueNode:dt,onValueNodeChange:ft,valueNodeHasChildren:gt,onValueNodeHasChildrenChange:mt,contentId:$1746a345f3d73bb7$export$f680877a34711e37(),value:Jr,onValueChange:ai,open:Qr,onOpenChange:Xr,dir:Yr,triggerPointerDownPosRef:oi,disabled:nt},reactExports.createElement($cc7e05a45900e73f$var$Collection.Provider,{scope:Z},reactExports.createElement($cc7e05a45900e73f$var$SelectNativeOptionsProvider,{scope:ie.__scopeSelect,onNativeOptionAdd:reactExports.useCallback(ii=>{ui(hi=>new Set(hi).add(ii))},[]),onNativeOptionRemove:reactExports.useCallback(ii=>{ui(hi=>{const ri=new Set(hi);return ri.delete(ii),ri})},[])},ee)),ni?reactExports.createElement($cc7e05a45900e73f$var$BubbleSelect,{key:mi,"aria-hidden":!0,required:it,tabIndex:-1,name:Je,autoComplete:rt,value:Jr,onChange:ii=>ai(ii.target.value),disabled:nt},Jr===void 0?reactExports.createElement("option",{value:""}):null,Array.from(li)):null))},$cc7e05a45900e73f$var$TRIGGER_NAME="SelectTrigger",$cc7e05a45900e73f$export$3ac1e88a1c0b9f1=reactExports.forwardRef((ie,Z)=>{const{__scopeSelect:ee,disabled:ae=!1,...ye}=ie,ve=$cc7e05a45900e73f$var$usePopperScope(ee),be=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$TRIGGER_NAME,ee),Ye=be.disabled||ae,Ke=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,be.onTriggerChange),Xe=$cc7e05a45900e73f$var$useCollection(ee),[Je,rt,nt]=$cc7e05a45900e73f$var$useTypeaheadSearch(lt=>{const ct=Xe().filter(ft=>!ft.disabled),ot=ct.find(ft=>ft.value===be.value),dt=$cc7e05a45900e73f$var$findNextItem(ct,lt,ot);dt!==void 0&&be.onValueChange(dt.value)}),it=()=>{Ye||(be.onOpenChange(!0),nt())};return reactExports.createElement($cf1ac5d9fe0e8206$export$b688253958b8dfe7,_extends$1({asChild:!0},ve),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button",role:"combobox","aria-controls":be.contentId,"aria-expanded":be.open,"aria-required":be.required,"aria-autocomplete":"none",dir:be.dir,"data-state":be.open?"open":"closed",disabled:Ye,"data-disabled":Ye?"":void 0,"data-placeholder":$cc7e05a45900e73f$var$shouldShowPlaceholder(be.value)?"":void 0},ye,{ref:Ke,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ye.onClick,lt=>{lt.currentTarget.focus()}),onPointerDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ye.onPointerDown,lt=>{const ct=lt.target;ct.hasPointerCapture(lt.pointerId)&&ct.releasePointerCapture(lt.pointerId),lt.button===0&&lt.ctrlKey===!1&&(it(),be.triggerPointerDownPosRef.current={x:Math.round(lt.pageX),y:Math.round(lt.pageY)},lt.preventDefault())}),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ye.onKeyDown,lt=>{const ct=Je.current!=="";!(lt.ctrlKey||lt.altKey||lt.metaKey)&&lt.key.length===1&&rt(lt.key),!(ct&&lt.key===" ")&&$cc7e05a45900e73f$var$OPEN_KEYS.includes(lt.key)&&(it(),lt.preventDefault())})})))}),$cc7e05a45900e73f$var$VALUE_NAME="SelectValue",$cc7e05a45900e73f$export$e288731fd71264f0=reactExports.forwardRef((ie,Z)=>{const{__scopeSelect:ee,className:ae,style:ye,children:ve,placeholder:be="",...Ye}=ie,Ke=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$VALUE_NAME,ee),{onValueNodeHasChildrenChange:Xe}=Ke,Je=ve!==void 0,rt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,Ke.onValueNodeChange);return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{Xe(Je)},[Xe,Je]),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({},Ye,{ref:rt,style:{pointerEvents:"none"}}),$cc7e05a45900e73f$var$shouldShowPlaceholder(Ke.value)?reactExports.createElement(reactExports.Fragment,null,be):ve)}),$cc7e05a45900e73f$export$99b400cabb58c515=reactExports.forwardRef((ie,Z)=>{const{__scopeSelect:ee,children:ae,...ye}=ie;return reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({"aria-hidden":!0},ye,{ref:Z}),ae||"▼")}),$cc7e05a45900e73f$export$b2af6c9944296213=ie=>reactExports.createElement($f1701beae083dbae$export$602eac185826482c,_extends$1({asChild:!0},ie)),$cc7e05a45900e73f$var$CONTENT_NAME="SelectContent",$cc7e05a45900e73f$export$c973a4b3cb86a03d=reactExports.forwardRef((ie,Z)=>{const ee=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$CONTENT_NAME,ie.__scopeSelect),[ae,ye]=reactExports.useState();if($9f79659886946c16$export$e5c5a5f917a5871c(()=>{ye(new DocumentFragment)},[]),!ee.open){const ve=ae;return ve?reactDomExports.createPortal(reactExports.createElement($cc7e05a45900e73f$var$SelectContentProvider,{scope:ie.__scopeSelect},reactExports.createElement($cc7e05a45900e73f$var$Collection.Slot,{scope:ie.__scopeSelect},reactExports.createElement("div",null,ie.children))),ve):null}return reactExports.createElement($cc7e05a45900e73f$var$SelectContentImpl,_extends$1({},ie,{ref:Z}))}),$cc7e05a45900e73f$var$CONTENT_MARGIN=10,[$cc7e05a45900e73f$var$SelectContentProvider,$cc7e05a45900e73f$var$useSelectContentContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$CONTENT_NAME),$cc7e05a45900e73f$var$SelectContentImpl=reactExports.forwardRef((ie,Z)=>{const{__scopeSelect:ee,position:ae="item-aligned",onCloseAutoFocus:ye,onEscapeKeyDown:ve,onPointerDownOutside:be,side:Ye,sideOffset:Ke,align:Xe,alignOffset:Je,arrowPadding:rt,collisionBoundary:nt,collisionPadding:it,sticky:lt,hideWhenDetached:ct,avoidCollisions:ot,...dt}=ie,ft=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$CONTENT_NAME,ee),[gt,mt]=reactExports.useState(null),[Yr,Qr]=reactExports.useState(null),Xr=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,Ai=>mt(Ai)),[Jr,ai]=reactExports.useState(null),[oi,ni]=reactExports.useState(null),li=$cc7e05a45900e73f$var$useCollection(ee),[ui,mi]=reactExports.useState(!1),ii=reactExports.useRef(!1);reactExports.useEffect(()=>{if(gt)return hideOthers(gt)},[gt]),$3db38b7d1fb3fe6a$export$b7ece24a22aeda8c();const hi=reactExports.useCallback(Ai=>{const[ki,...Yi]=li().map(hs=>hs.ref.current),[Ji]=Yi.slice(-1),ls=document.activeElement;for(const hs of Ai)if(hs===ls||(hs==null||hs.scrollIntoView({block:"nearest"}),hs===ki&&Yr&&(Yr.scrollTop=0),hs===Ji&&Yr&&(Yr.scrollTop=Yr.scrollHeight),hs==null||hs.focus(),document.activeElement!==ls))return},[li,Yr]),ri=reactExports.useCallback(()=>hi([Jr,gt]),[hi,Jr,gt]);reactExports.useEffect(()=>{ui&&ri()},[ui,ri]);const{onOpenChange:ci,triggerPointerDownPosRef:Si}=ft;reactExports.useEffect(()=>{if(gt){let Ai={x:0,y:0};const ki=Ji=>{var ls,hs,Kr,di;Ai={x:Math.abs(Math.round(Ji.pageX)-((ls=(hs=Si.current)===null||hs===void 0?void 0:hs.x)!==null&&ls!==void 0?ls:0)),y:Math.abs(Math.round(Ji.pageY)-((Kr=(di=Si.current)===null||di===void 0?void 0:di.y)!==null&&Kr!==void 0?Kr:0))}},Yi=Ji=>{Ai.x<=10&&Ai.y<=10?Ji.preventDefault():gt.contains(Ji.target)||ci(!1),document.removeEventListener("pointermove",ki),Si.current=null};return Si.current!==null&&(document.addEventListener("pointermove",ki),document.addEventListener("pointerup",Yi,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",ki),document.removeEventListener("pointerup",Yi,{capture:!0})}}},[gt,ci,Si]),reactExports.useEffect(()=>{const Ai=()=>ci(!1);return window.addEventListener("blur",Ai),window.addEventListener("resize",Ai),()=>{window.removeEventListener("blur",Ai),window.removeEventListener("resize",Ai)}},[ci]);const[si,Ei]=$cc7e05a45900e73f$var$useTypeaheadSearch(Ai=>{const ki=li().filter(ls=>!ls.disabled),Yi=ki.find(ls=>ls.ref.current===document.activeElement),Ji=$cc7e05a45900e73f$var$findNextItem(ki,Ai,Yi);Ji&&setTimeout(()=>Ji.ref.current.focus())}),yi=reactExports.useCallback((Ai,ki,Yi)=>{const Ji=!ii.current&&!Yi;(ft.value!==void 0&&ft.value===ki||Ji)&&(ai(Ai),Ji&&(ii.current=!0))},[ft.value]),Mi=reactExports.useCallback(()=>gt==null?void 0:gt.focus(),[gt]),Ci=reactExports.useCallback((Ai,ki,Yi)=>{const Ji=!ii.current&&!Yi;(ft.value!==void 0&&ft.value===ki||Ji)&&ni(Ai)},[ft.value]),Ri=ae==="popper"?$cc7e05a45900e73f$var$SelectPopperPosition:$cc7e05a45900e73f$var$SelectItemAlignedPosition,Ni=Ri===$cc7e05a45900e73f$var$SelectPopperPosition?{side:Ye,sideOffset:Ke,align:Xe,alignOffset:Je,arrowPadding:rt,collisionBoundary:nt,collisionPadding:it,sticky:lt,hideWhenDetached:ct,avoidCollisions:ot}:{};return reactExports.createElement($cc7e05a45900e73f$var$SelectContentProvider,{scope:ee,content:gt,viewport:Yr,onViewportChange:Qr,itemRefCallback:yi,selectedItem:Jr,onItemLeave:Mi,itemTextRefCallback:Ci,focusSelectedItem:ri,selectedItemText:oi,position:ae,isPositioned:ui,searchRef:si},reactExports.createElement($01b9c$RemoveScroll,{as:$5e63c961fc1ce211$export$8c6ed5c666ac1360,allowPinchZoom:!0},reactExports.createElement($d3863c46a17e8a28$export$20e40289641fbbb6,{asChild:!0,trapped:ft.open,onMountAutoFocus:Ai=>{Ai.preventDefault()},onUnmountAutoFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ye,Ai=>{var ki;(ki=ft.trigger)===null||ki===void 0||ki.focus({preventScroll:!0}),Ai.preventDefault()})},reactExports.createElement($5cb92bef7577960e$export$177fb62ff3ec1f22,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:ve,onPointerDownOutside:be,onFocusOutside:Ai=>Ai.preventDefault(),onDismiss:()=>ft.onOpenChange(!1)},reactExports.createElement(Ri,_extends$1({role:"listbox",id:ft.contentId,"data-state":ft.open?"open":"closed",dir:ft.dir,onContextMenu:Ai=>Ai.preventDefault()},dt,Ni,{onPlaced:()=>mi(!0),ref:Xr,style:{display:"flex",flexDirection:"column",outline:"none",...dt.style},onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(dt.onKeyDown,Ai=>{const ki=Ai.ctrlKey||Ai.altKey||Ai.metaKey;if(Ai.key==="Tab"&&Ai.preventDefault(),!ki&&Ai.key.length===1&&Ei(Ai.key),["ArrowUp","ArrowDown","Home","End"].includes(Ai.key)){let Yi=li().filter(Ji=>!Ji.disabled).map(Ji=>Ji.ref.current);if(["ArrowUp","End"].includes(Ai.key)&&(Yi=Yi.slice().reverse()),["ArrowUp","ArrowDown"].includes(Ai.key)){const Ji=Ai.target,ls=Yi.indexOf(Ji);Yi=Yi.slice(ls+1)}setTimeout(()=>hi(Yi)),Ai.preventDefault()}})}))))))}),$cc7e05a45900e73f$var$SelectItemAlignedPosition=reactExports.forwardRef((ie,Z)=>{const{__scopeSelect:ee,onPlaced:ae,...ye}=ie,ve=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$CONTENT_NAME,ee),be=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$CONTENT_NAME,ee),[Ye,Ke]=reactExports.useState(null),[Xe,Je]=reactExports.useState(null),rt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,Xr=>Je(Xr)),nt=$cc7e05a45900e73f$var$useCollection(ee),it=reactExports.useRef(!1),lt=reactExports.useRef(!0),{viewport:ct,selectedItem:ot,selectedItemText:dt,focusSelectedItem:ft}=be,gt=reactExports.useCallback(()=>{if(ve.trigger&&ve.valueNode&&Ye&&Xe&&ct&&ot&&dt){const Xr=ve.trigger.getBoundingClientRect(),Jr=Xe.getBoundingClientRect(),ai=ve.valueNode.getBoundingClientRect(),oi=dt.getBoundingClientRect();if(ve.dir!=="rtl"){const Ji=oi.left-Jr.left,ls=ai.left-Ji,hs=Xr.left-ls,Kr=Xr.width+hs,di=Math.max(Kr,Jr.width),wi=window.innerWidth-$cc7e05a45900e73f$var$CONTENT_MARGIN,Ii=$ae6933e535247d3d$export$7d15b64cf5a3a4c4(ls,[$cc7e05a45900e73f$var$CONTENT_MARGIN,wi-di]);Ye.style.minWidth=Kr+"px",Ye.style.left=Ii+"px"}else{const Ji=Jr.right-oi.right,ls=window.innerWidth-ai.right-Ji,hs=window.innerWidth-Xr.right-ls,Kr=Xr.width+hs,di=Math.max(Kr,Jr.width),wi=window.innerWidth-$cc7e05a45900e73f$var$CONTENT_MARGIN,Ii=$ae6933e535247d3d$export$7d15b64cf5a3a4c4(ls,[$cc7e05a45900e73f$var$CONTENT_MARGIN,wi-di]);Ye.style.minWidth=Kr+"px",Ye.style.right=Ii+"px"}const ni=nt(),li=window.innerHeight-$cc7e05a45900e73f$var$CONTENT_MARGIN*2,ui=ct.scrollHeight,mi=window.getComputedStyle(Xe),ii=parseInt(mi.borderTopWidth,10),hi=parseInt(mi.paddingTop,10),ri=parseInt(mi.borderBottomWidth,10),ci=parseInt(mi.paddingBottom,10),Si=ii+hi+ui+ci+ri,si=Math.min(ot.offsetHeight*5,Si),Ei=window.getComputedStyle(ct),yi=parseInt(Ei.paddingTop,10),Mi=parseInt(Ei.paddingBottom,10),Ci=Xr.top+Xr.height/2-$cc7e05a45900e73f$var$CONTENT_MARGIN,Ri=li-Ci,Ni=ot.offsetHeight/2,Ai=ot.offsetTop+Ni,ki=ii+hi+Ai,Yi=Si-ki;if(ki<=Ci){const Ji=ot===ni[ni.length-1].ref.current;Ye.style.bottom="0px";const ls=Xe.clientHeight-ct.offsetTop-ct.offsetHeight,hs=Math.max(Ri,Ni+(Ji?Mi:0)+ls+ri),Kr=ki+hs;Ye.style.height=Kr+"px"}else{const Ji=ot===ni[0].ref.current;Ye.style.top="0px";const ls=Math.max(Ci,ii+ct.offsetTop+(Ji?yi:0)+Ni)+Yi;Ye.style.height=ls+"px",ct.scrollTop=ki-Ci+ct.offsetTop}Ye.style.margin=`${$cc7e05a45900e73f$var$CONTENT_MARGIN}px 0`,Ye.style.minHeight=si+"px",Ye.style.maxHeight=li+"px",ae==null||ae(),requestAnimationFrame(()=>it.current=!0)}},[nt,ve.trigger,ve.valueNode,Ye,Xe,ct,ot,dt,ve.dir,ae]);$9f79659886946c16$export$e5c5a5f917a5871c(()=>gt(),[gt]);const[mt,Yr]=reactExports.useState();$9f79659886946c16$export$e5c5a5f917a5871c(()=>{Xe&&Yr(window.getComputedStyle(Xe).zIndex)},[Xe]);const Qr=reactExports.useCallback(Xr=>{Xr&&lt.current===!0&&(gt(),ft==null||ft(),lt.current=!1)},[gt,ft]);return reactExports.createElement($cc7e05a45900e73f$var$SelectViewportProvider,{scope:ee,contentWrapper:Ye,shouldExpandOnScrollRef:it,onScrollButtonChange:Qr},reactExports.createElement("div",{ref:Ke,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:mt}},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({},ye,{ref:rt,style:{boxSizing:"border-box",maxHeight:"100%",...ye.style}}))))}),$cc7e05a45900e73f$var$SelectPopperPosition=reactExports.forwardRef((ie,Z)=>{const{__scopeSelect:ee,align:ae="start",collisionPadding:ye=$cc7e05a45900e73f$var$CONTENT_MARGIN,...ve}=ie,be=$cc7e05a45900e73f$var$usePopperScope(ee);return reactExports.createElement($cf1ac5d9fe0e8206$export$7c6e2c02157bb7d2,_extends$1({},be,ve,{ref:Z,align:ae,collisionPadding:ye,style:{boxSizing:"border-box",...ve.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}}))}),[$cc7e05a45900e73f$var$SelectViewportProvider,$cc7e05a45900e73f$var$useSelectViewportContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$CONTENT_NAME,{}),$cc7e05a45900e73f$var$VIEWPORT_NAME="SelectViewport",$cc7e05a45900e73f$export$9ed6e7b40248d36d=reactExports.forwardRef((ie,Z)=>{const{__scopeSelect:ee,...ae}=ie,ye=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$VIEWPORT_NAME,ee),ve=$cc7e05a45900e73f$var$useSelectViewportContext($cc7e05a45900e73f$var$VIEWPORT_NAME,ee),be=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,ye.onViewportChange),Ye=reactExports.useRef(0);return reactExports.createElement(reactExports.Fragment,null,reactExports.createElement("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"}}),reactExports.createElement($cc7e05a45900e73f$var$Collection.Slot,{scope:ee},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"data-radix-select-viewport":"",role:"presentation"},ae,{ref:be,style:{position:"relative",flex:1,overflow:"auto",...ae.style},onScroll:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ae.onScroll,Ke=>{const Xe=Ke.currentTarget,{contentWrapper:Je,shouldExpandOnScrollRef:rt}=ve;if(rt!=null&&rt.current&&Je){const nt=Math.abs(Ye.current-Xe.scrollTop);if(nt>0){const it=window.innerHeight-$cc7e05a45900e73f$var$CONTENT_MARGIN*2,lt=parseFloat(Je.style.minHeight),ct=parseFloat(Je.style.height),ot=Math.max(lt,ct);if(ot<it){const dt=ot+nt,ft=Math.min(it,dt),gt=dt-ft;Je.style.height=ft+"px",Je.style.bottom==="0px"&&(Xe.scrollTop=gt>0?gt:0,Je.style.justifyContent="flex-end")}}}Ye.current=Xe.scrollTop})}))))}),$cc7e05a45900e73f$var$GROUP_NAME="SelectGroup",[$cc7e05a45900e73f$var$SelectGroupContextProvider,$cc7e05a45900e73f$var$useSelectGroupContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$GROUP_NAME),$cc7e05a45900e73f$export$ee25a334c55de1f4=reactExports.forwardRef((ie,Z)=>{const{__scopeSelect:ee,...ae}=ie,ye=$1746a345f3d73bb7$export$f680877a34711e37();return reactExports.createElement($cc7e05a45900e73f$var$SelectGroupContextProvider,{scope:ee,id:ye},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({role:"group","aria-labelledby":ye},ae,{ref:Z})))}),$cc7e05a45900e73f$var$LABEL_NAME="SelectLabel",$cc7e05a45900e73f$export$f67338d29bd972f8=reactExports.forwardRef((ie,Z)=>{const{__scopeSelect:ee,...ae}=ie,ye=$cc7e05a45900e73f$var$useSelectGroupContext($cc7e05a45900e73f$var$LABEL_NAME,ee);return reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({id:ye.id},ae,{ref:Z}))}),$cc7e05a45900e73f$var$ITEM_NAME="SelectItem",[$cc7e05a45900e73f$var$SelectItemContextProvider,$cc7e05a45900e73f$var$useSelectItemContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$ITEM_NAME),$cc7e05a45900e73f$export$13ef48a934230896=reactExports.forwardRef((ie,Z)=>{const{__scopeSelect:ee,value:ae,disabled:ye=!1,textValue:ve,...be}=ie,Ye=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$ITEM_NAME,ee),Ke=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$ITEM_NAME,ee),Xe=Ye.value===ae,[Je,rt]=reactExports.useState(ve??""),[nt,it]=reactExports.useState(!1),lt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,dt=>{var ft;return(ft=Ke.itemRefCallback)===null||ft===void 0?void 0:ft.call(Ke,dt,ae,ye)}),ct=$1746a345f3d73bb7$export$f680877a34711e37(),ot=()=>{ye||(Ye.onValueChange(ae),Ye.onOpenChange(!1))};if(ae==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return reactExports.createElement($cc7e05a45900e73f$var$SelectItemContextProvider,{scope:ee,value:ae,disabled:ye,textId:ct,isSelected:Xe,onItemTextChange:reactExports.useCallback(dt=>{rt(ft=>{var gt;return ft||((gt=dt==null?void 0:dt.textContent)!==null&&gt!==void 0?gt:"").trim()})},[])},reactExports.createElement($cc7e05a45900e73f$var$Collection.ItemSlot,{scope:ee,value:ae,disabled:ye,textValue:Je},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({role:"option","aria-labelledby":ct,"data-highlighted":nt?"":void 0,"aria-selected":Xe&&nt,"data-state":Xe?"checked":"unchecked","aria-disabled":ye||void 0,"data-disabled":ye?"":void 0,tabIndex:ye?void 0:-1},be,{ref:lt,onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(be.onFocus,()=>it(!0)),onBlur:$e42e1063c40fb3ef$export$b9ecd428b558ff10(be.onBlur,()=>it(!1)),onPointerUp:$e42e1063c40fb3ef$export$b9ecd428b558ff10(be.onPointerUp,ot),onPointerMove:$e42e1063c40fb3ef$export$b9ecd428b558ff10(be.onPointerMove,dt=>{if(ye){var ft;(ft=Ke.onItemLeave)===null||ft===void 0||ft.call(Ke)}else dt.currentTarget.focus({preventScroll:!0})}),onPointerLeave:$e42e1063c40fb3ef$export$b9ecd428b558ff10(be.onPointerLeave,dt=>{if(dt.currentTarget===document.activeElement){var ft;(ft=Ke.onItemLeave)===null||ft===void 0||ft.call(Ke)}}),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(be.onKeyDown,dt=>{var ft;((ft=Ke.searchRef)===null||ft===void 0?void 0:ft.current)!==""&&dt.key===" "||($cc7e05a45900e73f$var$SELECTION_KEYS.includes(dt.key)&&ot(),dt.key===" "&&dt.preventDefault())})}))))}),$cc7e05a45900e73f$var$ITEM_TEXT_NAME="SelectItemText",$cc7e05a45900e73f$export$3572fb0fb821ff49=reactExports.forwardRef((ie,Z)=>{const{__scopeSelect:ee,className:ae,style:ye,...ve}=ie,be=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$ITEM_TEXT_NAME,ee),Ye=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$ITEM_TEXT_NAME,ee),Ke=$cc7e05a45900e73f$var$useSelectItemContext($cc7e05a45900e73f$var$ITEM_TEXT_NAME,ee),Xe=$cc7e05a45900e73f$var$useSelectNativeOptionsContext($cc7e05a45900e73f$var$ITEM_TEXT_NAME,ee),[Je,rt]=reactExports.useState(null),nt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,dt=>rt(dt),Ke.onItemTextChange,dt=>{var ft;return(ft=Ye.itemTextRefCallback)===null||ft===void 0?void 0:ft.call(Ye,dt,Ke.value,Ke.disabled)}),it=Je==null?void 0:Je.textContent,lt=reactExports.useMemo(()=>reactExports.createElement("option",{key:Ke.value,value:Ke.value,disabled:Ke.disabled},it),[Ke.disabled,Ke.value,it]),{onNativeOptionAdd:ct,onNativeOptionRemove:ot}=Xe;return $9f79659886946c16$export$e5c5a5f917a5871c(()=>(ct(lt),()=>ot(lt)),[ct,ot,lt]),reactExports.createElement(reactExports.Fragment,null,reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({id:Ke.textId},ve,{ref:nt})),Ke.isSelected&&be.valueNode&&!be.valueNodeHasChildren?reactDomExports.createPortal(ve.children,be.valueNode):null)}),$cc7e05a45900e73f$var$ITEM_INDICATOR_NAME="SelectItemIndicator",$cc7e05a45900e73f$export$6b9198de19accfe6=reactExports.forwardRef((ie,Z)=>{const{__scopeSelect:ee,...ae}=ie;return $cc7e05a45900e73f$var$useSelectItemContext($cc7e05a45900e73f$var$ITEM_INDICATOR_NAME,ee).isSelected?reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({"aria-hidden":!0},ae,{ref:Z})):null}),$cc7e05a45900e73f$var$SCROLL_UP_BUTTON_NAME="SelectScrollUpButton",$cc7e05a45900e73f$export$d8117927658af6d7=reactExports.forwardRef((ie,Z)=>{const ee=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$SCROLL_UP_BUTTON_NAME,ie.__scopeSelect),ae=$cc7e05a45900e73f$var$useSelectViewportContext($cc7e05a45900e73f$var$SCROLL_UP_BUTTON_NAME,ie.__scopeSelect),[ye,ve]=reactExports.useState(!1),be=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,ae.onScrollButtonChange);return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{if(ee.viewport&&ee.isPositioned){let Ye=function(){const Xe=Ke.scrollTop>0;ve(Xe)};const Ke=ee.viewport;return Ye(),Ke.addEventListener("scroll",Ye),()=>Ke.removeEventListener("scroll",Ye)}},[ee.viewport,ee.isPositioned]),ye?reactExports.createElement($cc7e05a45900e73f$var$SelectScrollButtonImpl,_extends$1({},ie,{ref:be,onAutoScroll:()=>{const{viewport:Ye,selectedItem:Ke}=ee;Ye&&Ke&&(Ye.scrollTop=Ye.scrollTop-Ke.offsetHeight)}})):null}),$cc7e05a45900e73f$var$SCROLL_DOWN_BUTTON_NAME="SelectScrollDownButton",$cc7e05a45900e73f$export$ff951e476c12189=reactExports.forwardRef((ie,Z)=>{const ee=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$SCROLL_DOWN_BUTTON_NAME,ie.__scopeSelect),ae=$cc7e05a45900e73f$var$useSelectViewportContext($cc7e05a45900e73f$var$SCROLL_DOWN_BUTTON_NAME,ie.__scopeSelect),[ye,ve]=reactExports.useState(!1),be=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,ae.onScrollButtonChange);return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{if(ee.viewport&&ee.isPositioned){let Ye=function(){const Xe=Ke.scrollHeight-Ke.clientHeight,Je=Math.ceil(Ke.scrollTop)<Xe;ve(Je)};const Ke=ee.viewport;return Ye(),Ke.addEventListener("scroll",Ye),()=>Ke.removeEventListener("scroll",Ye)}},[ee.viewport,ee.isPositioned]),ye?reactExports.createElement($cc7e05a45900e73f$var$SelectScrollButtonImpl,_extends$1({},ie,{ref:be,onAutoScroll:()=>{const{viewport:Ye,selectedItem:Ke}=ee;Ye&&Ke&&(Ye.scrollTop=Ye.scrollTop+Ke.offsetHeight)}})):null}),$cc7e05a45900e73f$var$SelectScrollButtonImpl=reactExports.forwardRef((ie,Z)=>{const{__scopeSelect:ee,onAutoScroll:ae,...ye}=ie,ve=$cc7e05a45900e73f$var$useSelectContentContext("SelectScrollButton",ee),be=reactExports.useRef(null),Ye=$cc7e05a45900e73f$var$useCollection(ee),Ke=reactExports.useCallback(()=>{be.current!==null&&(window.clearInterval(be.current),be.current=null)},[]);return reactExports.useEffect(()=>()=>Ke(),[Ke]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{var Xe;const Je=Ye().find(rt=>rt.ref.current===document.activeElement);Je==null||(Xe=Je.ref.current)===null||Xe===void 0||Xe.scrollIntoView({block:"nearest"})},[Ye]),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"aria-hidden":!0},ye,{ref:Z,style:{flexShrink:0,...ye.style},onPointerDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ye.onPointerDown,()=>{be.current===null&&(be.current=window.setInterval(ae,50))}),onPointerMove:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ye.onPointerMove,()=>{var Xe;(Xe=ve.onItemLeave)===null||Xe===void 0||Xe.call(ve),be.current===null&&(be.current=window.setInterval(ae,50))}),onPointerLeave:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ye.onPointerLeave,()=>{Ke()})}))});function $cc7e05a45900e73f$var$shouldShowPlaceholder(ie){return ie===""||ie===void 0}const $cc7e05a45900e73f$var$BubbleSelect=reactExports.forwardRef((ie,Z)=>{const{value:ee,...ae}=ie,ye=reactExports.useRef(null),ve=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,ye),be=$010c2913dbd2fe3d$export$5cae361ad82dce8b(ee);return reactExports.useEffect(()=>{const Ye=ye.current,Ke=window.HTMLSelectElement.prototype,Xe=Object.getOwnPropertyDescriptor(Ke,"value").set;if(be!==ee&&Xe){const Je=new Event("change",{bubbles:!0});Xe.call(Ye,ee),Ye.dispatchEvent(Je)}},[be,ee]),reactExports.createElement($ea1ef594cf570d83$export$439d29a4e110a164,{asChild:!0},reactExports.createElement("select",_extends$1({},ae,{ref:ve,defaultValue:ee})))});$cc7e05a45900e73f$var$BubbleSelect.displayName="BubbleSelect";function $cc7e05a45900e73f$var$useTypeaheadSearch(ie){const Z=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(ie),ee=reactExports.useRef(""),ae=reactExports.useRef(0),ye=reactExports.useCallback(be=>{const Ye=ee.current+be;Z(Ye),function Ke(Xe){ee.current=Xe,window.clearTimeout(ae.current),Xe!==""&&(ae.current=window.setTimeout(()=>Ke(""),1e3))}(Ye)},[Z]),ve=reactExports.useCallback(()=>{ee.current="",window.clearTimeout(ae.current)},[]);return reactExports.useEffect(()=>()=>window.clearTimeout(ae.current),[]),[ee,ye,ve]}function $cc7e05a45900e73f$var$findNextItem(ie,Z,ee){const ae=Z.length>1&&Array.from(Z).every(Ye=>Ye===Z[0])?Z[0]:Z,ye=ee?ie.indexOf(ee):-1;let ve=$cc7e05a45900e73f$var$wrapArray(ie,Math.max(ye,0));ae.length===1&&(ve=ve.filter(Ye=>Ye!==ee));const be=ve.find(Ye=>Ye.textValue.toLowerCase().startsWith(ae.toLowerCase()));return be!==ee?be:void 0}function $cc7e05a45900e73f$var$wrapArray(ie,Z){return ie.map((ee,ae)=>ie[(Z+ae)%ie.length])}const $cc7e05a45900e73f$export$be92b6f5f03c0fe9=$cc7e05a45900e73f$export$ef9b1a59e592288f,$cc7e05a45900e73f$export$41fb9f06171c75f4=$cc7e05a45900e73f$export$3ac1e88a1c0b9f1,$cc7e05a45900e73f$export$7c6e2c02157bb7d2=$cc7e05a45900e73f$export$c973a4b3cb86a03d,$cc7e05a45900e73f$export$b04be29aa201d4f5=$cc7e05a45900e73f$export$f67338d29bd972f8,$cc7e05a45900e73f$export$6d08773d2e66f8f2=$cc7e05a45900e73f$export$13ef48a934230896;var openseadragon={exports:{}};(function(module){//! openseadragon 2.4.2
//! Built on 2020-03-05
//! Git commit: v2.4.2-0-c450749
//! http://openseadragon.github.io
//! License: http://openseadragon.github.io/license/
function OpenSeadragon(ie){return new OpenSeadragon.Viewer(ie)}(function(ie){ie.version={versionStr:"2.4.2",major:parseInt("2",10),minor:parseInt("4",10),revision:parseInt("2",10)};var Z={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},ee=Object.prototype.toString,ae=Object.prototype.hasOwnProperty;ie.isFunction=function(ye){return ie.type(ye)==="function"},ie.isArray=Array.isArray||function(ye){return ie.type(ye)==="array"},ie.isWindow=function(ye){return ye&&typeof ye=="object"&&"setInterval"in ye},ie.type=function(ye){return ye==null?String(ye):Z[ee.call(ye)]||"object"},ie.isPlainObject=function(ye){if(!ye||OpenSeadragon.type(ye)!=="object"||ye.nodeType||ie.isWindow(ye)||ye.constructor&&!ae.call(ye,"constructor")&&!ae.call(ye.constructor.prototype,"isPrototypeOf"))return!1;var ve;for(var be in ye)ve=be;return ve===void 0||ae.call(ye,ve)},ie.isEmptyObject=function(ye){for(var ve in ye)return!1;return!0},ie.freezeObject=function(ye){return Object.freeze?ie.freezeObject=Object.freeze:ie.freezeObject=function(ve){return ve},ie.freezeObject(ye)},ie.supportsCanvas=function(){var ye=document.createElement("canvas");return!!(ie.isFunction(ye.getContext)&&ye.getContext("2d"))}(),ie.isCanvasTainted=function(ye){var ve=!1;try{ye.getContext("2d").getImageData(0,0,1,1)}catch{ve=!0}return ve},ie.pixelDensityRatio=function(){if(ie.supportsCanvas){var ye=document.createElement("canvas").getContext("2d"),ve=window.devicePixelRatio||1,be=ye.webkitBackingStorePixelRatio||ye.mozBackingStorePixelRatio||ye.msBackingStorePixelRatio||ye.oBackingStorePixelRatio||ye.backingStorePixelRatio||1;return Math.max(ve,1)/be}else return 1}()})(OpenSeadragon),function($){$.extend=function(){var ie,Z,ee,ae,ye,ve,be=arguments[0]||{},Ye=arguments.length,Ke=!1,Xe=1;for(typeof be=="boolean"&&(Ke=be,be=arguments[1]||{},Xe=2),typeof be!="object"&&!OpenSeadragon.isFunction(be)&&(be={}),Ye===Xe&&(be=this,--Xe);Xe<Ye;Xe++)if(ie=arguments[Xe],ie!==null||ie!==void 0)for(Z in ie)ee=be[Z],ae=ie[Z],be!==ae&&(Ke&&ae&&(OpenSeadragon.isPlainObject(ae)||(ye=OpenSeadragon.isArray(ae)))?(ye?(ye=!1,ve=ee&&OpenSeadragon.isArray(ee)?ee:[]):ve=ee&&OpenSeadragon.isPlainObject(ee)?ee:{},be[Z]=OpenSeadragon.extend(Ke,ve,ae)):ae!==void 0&&(be[Z]=ae));return be};var isIOSDevice=function(){if(typeof navigator!="object")return!1;var ie=navigator.userAgent;return typeof ie!="string"?!1:ie.indexOf("iPhone")!==-1||ie.indexOf("iPad")!==-1||ie.indexOf("iPod")!==-1};$.extend($,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:isIOSDevice(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"]},SIGNAL:"----seadragon----",delegate:function(ie,Z){return function(){var ee=arguments;return ee===void 0&&(ee=[]),Z.apply(ie,ee)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(ie){return typeof ie=="string"&&(ie=document.getElementById(ie)),ie},getElementPosition:function(ie){var Z=new $.Point,ee,ae;for(ie=$.getElement(ie),ee=$.getElementStyle(ie).position=="fixed",ae=getOffsetParent(ie,ee);ae;)Z.x+=ie.offsetLeft,Z.y+=ie.offsetTop,ee&&(Z=Z.plus($.getPageScroll())),ie=ae,ee=$.getElementStyle(ie).position=="fixed",ae=getOffsetParent(ie,ee);return Z},getElementOffset:function(ie){ie=$.getElement(ie);var Z=ie&&ie.ownerDocument,ee,ae,ye={top:0,left:0};return Z?(ee=Z.documentElement,typeof ie.getBoundingClientRect<"u"&&(ye=ie.getBoundingClientRect()),ae=Z==Z.window?Z:Z.nodeType===9?Z.defaultView||Z.parentWindow:!1,new $.Point(ye.left+(ae.pageXOffset||ee.scrollLeft)-(ee.clientLeft||0),ye.top+(ae.pageYOffset||ee.scrollTop)-(ee.clientTop||0))):new $.Point},getElementSize:function(ie){return ie=$.getElement(ie),new $.Point(ie.clientWidth,ie.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(ie){return ie=$.getElement(ie),ie.currentStyle}:function(ie){return ie=$.getElement(ie),window.getComputedStyle(ie,"")},getCssPropertyWithVendorPrefix:function(ie){var Z={};return $.getCssPropertyWithVendorPrefix=function(ee){if(Z[ee]!==void 0)return Z[ee];var ae=document.createElement("div").style,ye=null;if(ae[ee]!==void 0)ye=ee;else for(var ve=["Webkit","Moz","MS","O","webkit","moz","ms","o"],be=$.capitalizeFirstLetter(ee),Ye=0;Ye<ve.length;Ye++){var Ke=ve[Ye]+be;if(ae[Ke]!==void 0){ye=Ke;break}}return Z[ee]=ye,ye},$.getCssPropertyWithVendorPrefix(ie)},capitalizeFirstLetter:function(ie){return ie.charAt(0).toUpperCase()+ie.slice(1)},positiveModulo:function(ie,Z){var ee=ie%Z;return ee<0&&(ee+=Z),ee},pointInElement:function(ie,Z){ie=$.getElement(ie);var ee=$.getElementOffset(ie),ae=$.getElementSize(ie);return Z.x>=ee.x&&Z.x<ee.x+ae.x&&Z.y<ee.y+ae.y&&Z.y>=ee.y},getEvent:function(ie){return ie?$.getEvent=function(Z){return Z}:$.getEvent=function(){return window.event},$.getEvent(ie)},getMousePosition:function(ie){if(typeof ie.pageX=="number")$.getMousePosition=function(Z){var ee=new $.Point;return Z=$.getEvent(Z),ee.x=Z.pageX,ee.y=Z.pageY,ee};else if(typeof ie.clientX=="number")$.getMousePosition=function(Z){var ee=new $.Point;return Z=$.getEvent(Z),ee.x=Z.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,ee.y=Z.clientY+document.body.scrollTop+document.documentElement.scrollTop,ee};else throw new Error("Unknown event mouse position, no known technique.");return $.getMousePosition(ie)},getPageScroll:function(){var ie=document.documentElement||{},Z=document.body||{};if(typeof window.pageXOffset=="number")$.getPageScroll=function(){return new $.Point(window.pageXOffset,window.pageYOffset)};else if(Z.scrollLeft||Z.scrollTop)$.getPageScroll=function(){return new $.Point(document.body.scrollLeft,document.body.scrollTop)};else if(ie.scrollLeft||ie.scrollTop)$.getPageScroll=function(){return new $.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)};else return new $.Point(0,0);return $.getPageScroll()},setPageScroll:function(ie){if(typeof window.scrollTo<"u")$.setPageScroll=function(ae){window.scrollTo(ae.x,ae.y)};else{var Z=$.getPageScroll();if(Z.x===ie.x&&Z.y===ie.y)return;document.body.scrollLeft=ie.x,document.body.scrollTop=ie.y;var ee=$.getPageScroll();if(ee.x!==Z.x&&ee.y!==Z.y){$.setPageScroll=function(ae){document.body.scrollLeft=ae.x,document.body.scrollTop=ae.y};return}if(document.documentElement.scrollLeft=ie.x,document.documentElement.scrollTop=ie.y,ee=$.getPageScroll(),ee.x!==Z.x&&ee.y!==Z.y){$.setPageScroll=function(ae){document.documentElement.scrollLeft=ae.x,document.documentElement.scrollTop=ae.y};return}$.setPageScroll=function(ae){}}return $.setPageScroll(ie)},getWindowSize:function(){var ie=document.documentElement||{},Z=document.body||{};if(typeof window.innerWidth=="number")$.getWindowSize=function(){return new $.Point(window.innerWidth,window.innerHeight)};else if(ie.clientWidth||ie.clientHeight)$.getWindowSize=function(){return new $.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else if(Z.clientWidth||Z.clientHeight)$.getWindowSize=function(){return new $.Point(document.body.clientWidth,document.body.clientHeight)};else throw new Error("Unknown window size, no known technique.");return $.getWindowSize()},makeCenteredNode:function(ie){ie=$.getElement(ie);var Z=[$.makeNeutralElement("div"),$.makeNeutralElement("div"),$.makeNeutralElement("div")];return $.extend(Z[0].style,{display:"table",height:"100%",width:"100%"}),$.extend(Z[1].style,{display:"table-row"}),$.extend(Z[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),Z[0].appendChild(Z[1]),Z[1].appendChild(Z[2]),Z[2].appendChild(ie),Z[0]},makeNeutralElement:function(ie){var Z=document.createElement(ie),ee=Z.style;return ee.background="transparent none",ee.border="none",ee.margin="0px",ee.padding="0px",ee.position="static",Z},now:function(){return Date.now?$.now=Date.now:$.now=function(){return new Date().getTime()},$.now()},makeTransparentImage:function(ie){return $.makeTransparentImage=function(Z){var ee=$.makeNeutralElement("img");return ee.src=Z,ee},$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<7&&($.makeTransparentImage=function(Z){var ee=$.makeNeutralElement("img"),ae=null;return ae=$.makeNeutralElement("span"),ae.style.display="inline-block",ee.onload=function(){ae.style.width=ae.style.width||ee.width+"px",ae.style.height=ae.style.height||ee.height+"px",ee.onload=null,ee=null},ee.src=Z,ae.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+Z+"', sizingMethod='scale')",ae}),$.makeTransparentImage(ie)},setElementOpacity:function(ie,Z,ee){var ae,ye;ie=$.getElement(ie),ee&&!$.Browser.alpha&&(Z=Math.round(Z)),$.Browser.opacity?ie.style.opacity=Z<1?Z:"":Z<1?(ae=Math.round(100*Z),ye="alpha(opacity="+ae+")",ie.style.filter=ye):ie.style.filter=""},setElementTouchActionNone:function(ie){ie=$.getElement(ie),typeof ie.style.touchAction<"u"?ie.style.touchAction="none":typeof ie.style.msTouchAction<"u"&&(ie.style.msTouchAction="none")},addClass:function(ie,Z){ie=$.getElement(ie),ie.className?(" "+ie.className+" ").indexOf(" "+Z+" ")===-1&&(ie.className+=" "+Z):ie.className=Z},indexOf:function(ie,Z,ee){return Array.prototype.indexOf?this.indexOf=function(ae,ye,ve){return ae.indexOf(ye,ve)}:this.indexOf=function(ae,ye,ve){var be,Ye=ve||0,Ke;if(!ae)throw new TypeError;if(Ke=ae.length,Ke===0||Ye>=Ke)return-1;for(Ye<0&&(Ye=Ke-Math.abs(Ye)),be=Ye;be<Ke;be++)if(ae[be]===ye)return be;return-1},this.indexOf(ie,Z,ee)},removeClass:function(ie,Z){var ee,ae=[],ye;for(ie=$.getElement(ie),ee=ie.className.split(/\s+/),ye=0;ye<ee.length;ye++)ee[ye]&&ee[ye]!==Z&&ae.push(ee[ye]);ie.className=ae.join(" ")},addEvent:function(){if(window.addEventListener)return function(ie,Z,ee,ae){ie=$.getElement(ie),ie.addEventListener(Z,ee,ae)};if(window.attachEvent)return function(ie,Z,ee,ae){ie=$.getElement(ie),ie.attachEvent("on"+Z,ee)};throw new Error("No known event model.")}(),removeEvent:function(){if(window.removeEventListener)return function(ie,Z,ee,ae){ie=$.getElement(ie),ie.removeEventListener(Z,ee,ae)};if(window.detachEvent)return function(ie,Z,ee,ae){ie=$.getElement(ie),ie.detachEvent("on"+Z,ee)};throw new Error("No known event model.")}(),cancelEvent:function(ie){ie=$.getEvent(ie),ie.preventDefault?$.cancelEvent=function(Z){Z.preventDefault()}:$.cancelEvent=function(Z){Z=$.getEvent(Z),Z.cancel=!0,Z.returnValue=!1},$.cancelEvent(ie)},stopEvent:function(ie){ie=$.getEvent(ie),ie.stopPropagation?$.stopEvent=function(Z){Z.stopPropagation()}:$.stopEvent=function(Z){Z=$.getEvent(Z),Z.cancelBubble=!0},$.stopEvent(ie)},createCallback:function(ie,Z){var ee=[],ae;for(ae=2;ae<arguments.length;ae++)ee.push(arguments[ae]);return function(){var ye=ee.concat([]),ve;for(ve=0;ve<arguments.length;ve++)ye.push(arguments[ve]);return Z.apply(ie,ye)}},getUrlParameter:function(ie){var Z=URLPARAMS[ie];return Z||null},getUrlProtocol:function(ie){var Z=ie.match(/^([a-z]+:)\/\//i);return Z===null?window.location.protocol:Z[1].toLowerCase()},createAjaxRequest:function(ie){var Z;try{Z=!!new ActiveXObject("Microsoft.XMLHTTP")}catch{Z=!1}if(Z)window.XMLHttpRequest?$.createAjaxRequest=function(ee){return ee?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:$.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else if(window.XMLHttpRequest)$.createAjaxRequest=function(){return new XMLHttpRequest};else throw new Error("Browser doesn't support XMLHttpRequest.");return $.createAjaxRequest(ie)},makeAjaxRequest:function(ie,Z,ee){var ae,ye,ve;$.isPlainObject(ie)&&(Z=ie.success,ee=ie.error,ae=ie.withCredentials,ye=ie.headers,ve=ie.responseType||null,ie=ie.url);var be=$.getUrlProtocol(ie),Ye=$.createAjaxRequest(be==="file:");if(!$.isFunction(Z))throw new Error("makeAjaxRequest requires a success callback");Ye.onreadystatechange=function(){Ye.readyState==4&&(Ye.onreadystatechange=function(){},Ye.status>=200&&Ye.status<300||Ye.status===0&&be!=="http:"&&be!=="https:"?Z(Ye):($.console.log("AJAX request returned %d: %s",Ye.status,ie),$.isFunction(ee)&&ee(Ye)))};try{if(Ye.open("GET",ie,!0),ve&&(Ye.responseType=ve),ye)for(var Ke in ye)Object.prototype.hasOwnProperty.call(ye,Ke)&&ye[Ke]&&Ye.setRequestHeader(Ke,ye[Ke]);ae&&(Ye.withCredentials=!0),Ye.send(null)}catch(nt){var Xe=nt.message,Je=$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<10;if(Je&&typeof nt.number<"u"&&nt.number==-2147024891&&(Xe+=`
See http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain`),$.console.log("%s while making AJAX request: %s",nt.name,Xe),Ye.onreadystatechange=function(){},window.XDomainRequest){var rt=new window.XDomainRequest;if(rt){rt.onload=function(it){$.isFunction(Z)&&Z({responseText:rt.responseText,status:200,statusText:"OK"})},rt.onerror=function(it){$.isFunction(ee)&&ee({responseText:rt.responseText,status:444,statusText:"An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."})};try{rt.open("GET",ie),rt.send()}catch{$.isFunction(ee)&&ee(Ye,nt)}}}else $.isFunction(ee)&&ee(Ye,nt)}return Ye},jsonp:function(ie){var Z,ee=ie.url,ae=document.head||document.getElementsByTagName("head")[0]||document.documentElement,ye=ie.callbackName||"openseadragon"+$.now(),ve=window[ye],be="$1"+ye+"$2",Ye=ie.param||"callback",Ke=ie.callback;ee=ee.replace(/(\=)\?(&|$)|\?\?/i,be),ee+=(/\?/.test(ee)?"&":"?")+Ye+"="+ye,window[ye]=function(Xe){if(ve)window[ye]=ve;else try{delete window[ye]}catch{}Ke&&$.isFunction(Ke)&&Ke(Xe)},Z=document.createElement("script"),(ie.async!==void 0||ie.async!==!1)&&(Z.async="async"),ie.scriptCharset&&(Z.charset=ie.scriptCharset),Z.src=ee,Z.onload=Z.onreadystatechange=function(Xe,Je){(Je||!Z.readyState||/loaded|complete/.test(Z.readyState))&&(Z.onload=Z.onreadystatechange=null,ae&&Z.parentNode&&ae.removeChild(Z),Z=void 0)},ae.insertBefore(Z,ae.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(ie){if(window.DOMParser)$.parseXml=function(Z){var ee=null,ae;return ae=new DOMParser,ee=ae.parseFromString(Z,"text/xml"),ee};else if(window.ActiveXObject)$.parseXml=function(Z){var ee=null;return ee=new ActiveXObject("Microsoft.XMLDOM"),ee.async=!1,ee.loadXML(Z),ee};else throw new Error("Browser doesn't support XML DOM.");return $.parseXml(ie)},parseJSON:function(string){return window.JSON&&window.JSON.parse?$.parseJSON=window.JSON.parse:$.parseJSON=function(string){return eval("("+string+")")},$.parseJSON(string)},imageFormatSupported:function(ie){return ie=ie||"",!!FILEFORMATS[ie.toLowerCase()]}});var nullfunction=function(ie){};$.console=window.console||{log:nullfunction,debug:nullfunction,info:nullfunction,warn:nullfunction,error:nullfunction,assert:nullfunction},$.Browser={vendor:$.BROWSERS.UNKNOWN,version:0,alpha:!0};var FILEFORMATS={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},URLPARAMS={};(function(){var ie=navigator.appVersion,Z=navigator.userAgent,ee;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(Z.substring(Z.indexOf("MSIE")+5,Z.indexOf(";",Z.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(Z.indexOf("Firefox")>=0?($.Browser.vendor=$.BROWSERS.FIREFOX,$.Browser.version=parseFloat(Z.substring(Z.indexOf("Firefox")+8))):Z.indexOf("Safari")>=0?($.Browser.vendor=Z.indexOf("Chrome")>=0?$.BROWSERS.CHROME:$.BROWSERS.SAFARI,$.Browser.version=parseFloat(Z.substring(Z.substring(0,Z.indexOf("Safari")).lastIndexOf("/")+1,Z.indexOf("Safari")))):(ee=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),ee.exec(Z)!==null&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(RegExp.$1))));break;case"Opera":$.Browser.vendor=$.BROWSERS.OPERA,$.Browser.version=parseFloat(ie);break}var ae=window.location.search.substring(1),ye=ae.split("&"),ve,be,Ye;for(Ye=0;Ye<ye.length;Ye++)if(ve=ye[Ye],be=ve.indexOf("="),be>0){var Ke=ve.substring(0,be),Xe=ve.substring(be+1);try{URLPARAMS[Ke]=decodeURIComponent(Xe)}catch{$.console.error("Ignoring malformed URL parameter: %s=%s",Ke,Xe)}}$.Browser.alpha=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9||$.Browser.vendor==$.BROWSERS.CHROME&&$.Browser.version<2),$.Browser.opacity=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9)})(),function(ie){var Z=ie.requestAnimationFrame||ie.mozRequestAnimationFrame||ie.webkitRequestAnimationFrame||ie.msRequestAnimationFrame,ee=ie.cancelAnimationFrame||ie.mozCancelAnimationFrame||ie.webkitCancelAnimationFrame||ie.msCancelAnimationFrame;if(Z&&ee)$.requestAnimationFrame=function(){return Z.apply(ie,arguments)},$.cancelAnimationFrame=function(){return ee.apply(ie,arguments)};else{var ae=[],ye=[],ve=0,be;$.requestAnimationFrame=function(Ye){return ae.push([++ve,Ye]),be||(be=setInterval(function(){if(ae.length){var Ke=$.now(),Xe=ye;for(ye=ae,ae=Xe;ye.length;)ye.shift()[1](Ke)}else clearInterval(be),be=void 0},1e3/50)),ve},$.cancelAnimationFrame=function(Ye){var Ke,Xe;for(Ke=0,Xe=ae.length;Ke<Xe;Ke+=1)if(ae[Ke][0]===Ye){ae.splice(Ke,1);return}for(Ke=0,Xe=ye.length;Ke<Xe;Ke+=1)if(ye[Ke][0]===Ye){ye.splice(Ke,1);return}}}}(window);function getOffsetParent(ie,Z){return Z&&ie!=document.body?document.body:ie.offsetParent}}(OpenSeadragon),function(ie,Z){module.exports?module.exports=Z():ie.OpenSeadragon=Z()}(commonjsGlobal,function(){return OpenSeadragon}),function(ie){var Z={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(Z.supportsFullScreen=!0,Z.getFullScreenElement=function(){return document.fullscreenElement},Z.requestFullScreen=function(ee){return ee.requestFullscreen()},Z.exitFullScreen=function(){document.exitFullscreen()},Z.fullScreenEventName="fullscreenchange",Z.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(Z.supportsFullScreen=!0,Z.getFullScreenElement=function(){return document.msFullscreenElement},Z.requestFullScreen=function(ee){return ee.msRequestFullscreen()},Z.exitFullScreen=function(){document.msExitFullscreen()},Z.fullScreenEventName="MSFullscreenChange",Z.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(Z.supportsFullScreen=!0,Z.getFullScreenElement=function(){return document.webkitFullscreenElement},Z.requestFullScreen=function(ee){return ee.webkitRequestFullscreen()},Z.exitFullScreen=function(){document.webkitExitFullscreen()},Z.fullScreenEventName="webkitfullscreenchange",Z.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(Z.supportsFullScreen=!0,Z.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},Z.requestFullScreen=function(ee){return ee.webkitRequestFullScreen()},Z.exitFullScreen=function(){document.webkitCancelFullScreen()},Z.fullScreenEventName="webkitfullscreenchange",Z.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(Z.supportsFullScreen=!0,Z.getFullScreenElement=function(){return document.mozFullScreenElement},Z.requestFullScreen=function(ee){return ee.mozRequestFullScreen()},Z.exitFullScreen=function(){document.mozCancelFullScreen()},Z.fullScreenEventName="mozfullscreenchange",Z.fullScreenErrorEventName="mozfullscreenerror"),Z.isFullScreen=function(){return Z.getFullScreenElement()!==null},Z.cancelFullScreen=function(){ie.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),Z.exitFullScreen()},ie.extend(ie,Z)}(OpenSeadragon),function(ie){ie.EventSource=function(){this.events={}},ie.EventSource.prototype={addOnceHandler:function(Z,ee,ae,ye){var ve=this;ye=ye||1;var be=0,Ye=function(Ke){be++,be===ye&&ve.removeHandler(Z,Ye),ee(Ke)};this.addHandler(Z,Ye,ae)},addHandler:function(Z,ee,ae){var ye=this.events[Z];ye||(this.events[Z]=ye=[]),ee&&ie.isFunction(ee)&&(ye[ye.length]={handler:ee,userData:ae||null})},removeHandler:function(Z,ee){var ae=this.events[Z],ye=[],ve;if(ae&&ie.isArray(ae)){for(ve=0;ve<ae.length;ve++)ae[ve].handler!==ee&&ye.push(ae[ve]);this.events[Z]=ye}},removeAllHandlers:function(Z){if(Z)this.events[Z]=[];else for(var ee in this.events)this.events[ee]=[]},getHandler:function(Z){var ee=this.events[Z];return!ee||!ee.length?null:(ee=ee.length===1?[ee[0]]:Array.apply(null,ee),function(ae,ye){var ve,be=ee.length;for(ve=0;ve<be;ve++)ee[ve]&&(ye.eventSource=ae,ye.userData=ee[ve].userData,ee[ve].handler(ye))})},raiseEvent:function(Z,ee){var ae=this.getHandler(Z);ae&&(ee||(ee={}),ae(this,ee))}}}(OpenSeadragon),function(ie){var Z=[],ee={};ie.MouseTracker=function(ei){Z.push(this);var Zr=arguments;ie.isPlainObject(ei)||(ei={element:Zr[0],clickTimeThreshold:Zr[1],clickDistThreshold:Zr[2]}),this.hash=Math.random(),this.element=ie.getElement(ei.element),this.clickTimeThreshold=ei.clickTimeThreshold||ie.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=ei.clickDistThreshold||ie.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=ei.dblClickTimeThreshold||ie.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=ei.dblClickDistThreshold||ie.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=ei.userData||null,this.stopDelay=ei.stopDelay||50,this.enterHandler=ei.enterHandler||null,this.exitHandler=ei.exitHandler||null,this.pressHandler=ei.pressHandler||null,this.nonPrimaryPressHandler=ei.nonPrimaryPressHandler||null,this.releaseHandler=ei.releaseHandler||null,this.nonPrimaryReleaseHandler=ei.nonPrimaryReleaseHandler||null,this.moveHandler=ei.moveHandler||null,this.scrollHandler=ei.scrollHandler||null,this.clickHandler=ei.clickHandler||null,this.dblClickHandler=ei.dblClickHandler||null,this.dragHandler=ei.dragHandler||null,this.dragEndHandler=ei.dragEndHandler||null,this.pinchHandler=ei.pinchHandler||null,this.stopHandler=ei.stopHandler||null,this.keyDownHandler=ei.keyDownHandler||null,this.keyUpHandler=ei.keyUpHandler||null,this.keyHandler=ei.keyHandler||null,this.focusHandler=ei.focusHandler||null,this.blurHandler=ei.blurHandler||null;var pi=this;ee[this.hash]={click:function(gi){lt(pi,gi)},dblclick:function(gi){ct(pi,gi)},keydown:function(gi){ot(pi,gi)},keyup:function(gi){dt(pi,gi)},keypress:function(gi){ft(pi,gi)},focus:function(gi){gt(pi,gi)},blur:function(gi){mt(pi,gi)},wheel:function(gi){Yr(pi,gi)},mousewheel:function(gi){Qr(pi,gi)},DOMMouseScroll:function(gi){Qr(pi,gi)},MozMousePixelScroll:function(gi){Qr(pi,gi)},mouseenter:function(gi){ai(pi,gi)},mouseleave:function(gi){li(pi,gi)},mouseover:function(gi){oi(pi,gi)},mouseout:function(gi){ui(pi,gi)},mousedown:function(gi){hi(pi,gi)},mouseup:function(gi){ri(pi,gi)},mouseupcaptured:function(gi){ci(pi,gi)},mousemove:function(gi){si(pi,gi)},mousemovecaptured:function(gi){Ei(pi,gi)},touchstart:function(gi){Ci(pi,gi)},touchend:function(gi){Ri(pi,gi)},touchendcaptured:function(gi){Ni(pi,gi)},touchmove:function(gi){ki(pi,gi)},touchmovecaptured:function(gi){Yi(pi,gi)},touchcancel:function(gi){ls(pi,gi)},gesturestart:function(gi){hs(pi,gi)},gesturechange:function(gi){Kr(pi,gi)},pointerover:function(gi){di(pi,gi)},MSPointerOver:function(gi){di(pi,gi)},pointerout:function(gi){wi(pi,gi)},MSPointerOut:function(gi){wi(pi,gi)},pointerdown:function(gi){Ii(pi,gi)},MSPointerDown:function(gi){Ii(pi,gi)},pointerup:function(gi){Di(pi,gi)},MSPointerUp:function(gi){Di(pi,gi)},pointermove:function(gi){us(pi,gi)},MSPointerMove:function(gi){us(pi,gi)},pointercancel:function(gi){Ki(pi,gi)},MSPointerCancel:function(gi){Ki(pi,gi)},pointerupcaptured:function(gi){is(pi,gi)},pointermovecaptured:function(gi){Zi(pi,gi)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null},ei.startDisabled||this.setTracking(!0)},ie.MouseTracker.prototype={destroy:function(){var ei;for(ve(this),this.element=null,ei=0;ei<Z.length;ei++)if(Z[ei]===this){Z.splice(ei,1);break}ee[this.hash]=null,delete ee[this.hash]},isTracking:function(){return ee[this.hash].tracking},setTracking:function(ei){return ei?ye(this):ve(this),this},getActivePointersListsExceptType:function(ei){for(var Zr=ee[this.hash],pi=[],gi=0;gi<Zr.activePointersLists.length;++gi)Zr.activePointersLists[gi].type!==ei&&pi.push(Zr.activePointersLists[gi]);return pi},getActivePointersListByType:function(ei){var Zr=ee[this.hash],pi,gi=Zr.activePointersLists.length,$i;for(pi=0;pi<gi;pi++)if(Zr.activePointersLists[pi].type===ei)return Zr.activePointersLists[pi];return $i=new ie.MouseTracker.GesturePointList(ei),Zr.activePointersLists.push($i),$i},getActivePointerCount:function(){var ei=ee[this.hash],Zr,pi=ei.activePointersLists.length,gi=0;for(Zr=0;Zr<pi;Zr++)gi+=ei.activePointersLists[Zr].getLength();return gi},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},ie.MouseTracker.resetAllMouseTrackers=function(){for(var ei=0;ei<Z.length;ei++)Z[ei].isTracking()&&(Z[ei].setTracking(!1),Z[ei].setTracking(!0))},ie.MouseTracker.gesturePointVelocityTracker=function(){var ei=[],Zr=0,pi=0,gi=function(Ui,es){return Ui.hash.toString()+es.type+es.id.toString()},$i=function(){var Ui,es=ei.length,Qi,ss,cs=ie.now(),Xi,_s,eo;for(Xi=cs-pi,pi=cs,Ui=0;Ui<es;Ui++)Qi=ei[Ui],ss=Qi.gPoint,ss.direction=Math.atan2(ss.currentPos.y-Qi.lastPos.y,ss.currentPos.x-Qi.lastPos.x),_s=Qi.lastPos.distanceTo(ss.currentPos),Qi.lastPos=ss.currentPos,eo=1e3*_s/(Xi+1),ss.speed=.75*eo+.25*ss.speed},Vi=function(Ui,es){var Qi=gi(Ui,es);ei.push({guid:Qi,gPoint:es,lastPos:es.currentPos}),ei.length===1&&(pi=ie.now(),Zr=window.setInterval($i,50))},Bi=function(Ui,es){var Qi=gi(Ui,es),ss,cs=ei.length;for(ss=0;ss<cs;ss++)if(ei[ss].guid===Qi){ei.splice(ss,1),cs--,cs===0&&window.clearInterval(Zr);break}};return{addPoint:Vi,removePoint:Bi}}(),ie.MouseTracker.captureElement=document,ie.MouseTracker.wheelEventName=ie.Browser.vendor==ie.BROWSERS.IE&&ie.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll",ie.MouseTracker.supportsMouseCapture=function(){var ei=document.createElement("div");return ie.isFunction(ei.setCapture)&&ie.isFunction(ei.releaseCapture)}(),ie.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",ie.MouseTracker.wheelEventName],ie.MouseTracker.wheelEventName=="DOMMouseScroll"&&ie.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent&&(window.navigator.pointerEnabled||ie.Browser.vendor!==ie.BROWSERS.IE)?(ie.MouseTracker.havePointerEvents=!0,ie.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),ie.MouseTracker.unprefixedPointerEvents=!0,navigator.maxTouchPoints?ie.MouseTracker.maxTouchPoints=navigator.maxTouchPoints:ie.MouseTracker.maxTouchPoints=0,ie.MouseTracker.haveMouseEnter=!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?(ie.MouseTracker.havePointerEvents=!0,ie.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"),ie.MouseTracker.unprefixedPointerEvents=!1,navigator.msMaxTouchPoints?ie.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints:ie.MouseTracker.maxTouchPoints=0,ie.MouseTracker.haveMouseEnter=!1):(ie.MouseTracker.havePointerEvents=!1,ie.Browser.vendor===ie.BROWSERS.IE&&ie.Browser.version<9?(ie.MouseTracker.subscribeEvents.push("mouseenter","mouseleave"),ie.MouseTracker.haveMouseEnter=!0):(ie.MouseTracker.subscribeEvents.push("mouseover","mouseout"),ie.MouseTracker.haveMouseEnter=!1),ie.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove"),"ontouchstart"in window&&ie.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&ie.MouseTracker.subscribeEvents.push("gesturestart","gesturechange"),ie.MouseTracker.mousePointerId="legacy-mouse",ie.MouseTracker.maxTouchPoints=10),ie.MouseTracker.GesturePointList=function(ei){this._gPoints=[],this.type=ei,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},ie.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(ei){return this._gPoints.push(ei)},removeById:function(ei){var Zr,pi=this._gPoints.length;for(Zr=0;Zr<pi;Zr++)if(this._gPoints[Zr].id===ei){this._gPoints.splice(Zr,1);break}return this._gPoints.length},getByIndex:function(ei){return ei<this._gPoints.length?this._gPoints[ei]:null},getById:function(ei){var Zr,pi=this._gPoints.length;for(Zr=0;Zr<pi;Zr++)if(this._gPoints[Zr].id===ei)return this._gPoints[Zr];return null},getPrimary:function(ei){var Zr,pi=this._gPoints.length;for(Zr=0;Zr<pi;Zr++)if(this._gPoints[Zr].isPrimary)return this._gPoints[Zr];return null},addContact:function(){++this.contacts,this.contacts>1&&(this.type==="mouse"||this.type==="pen")&&(this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};function ae(ei){var Zr=ee[ei.hash],pi,gi=Zr.activePointersLists.length;for(pi=0;pi<gi;pi++)Zr.activePointersLists[pi].captureCount>0&&(ie.removeEvent(ie.MouseTracker.captureElement,"mousemove",Zr.mousemovecaptured,!0),ie.removeEvent(ie.MouseTracker.captureElement,"mouseup",Zr.mouseupcaptured,!0),ie.removeEvent(ie.MouseTracker.captureElement,ie.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",Zr.pointermovecaptured,!0),ie.removeEvent(ie.MouseTracker.captureElement,ie.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",Zr.pointerupcaptured,!0),ie.removeEvent(ie.MouseTracker.captureElement,"touchmove",Zr.touchmovecaptured,!0),ie.removeEvent(ie.MouseTracker.captureElement,"touchend",Zr.touchendcaptured,!0),Zr.activePointersLists[pi].captureCount=0);for(pi=0;pi<gi;pi++)Zr.activePointersLists.pop()}function ye(ei){var Zr=ee[ei.hash],pi,gi;if(!Zr.tracking){for(gi=0;gi<ie.MouseTracker.subscribeEvents.length;gi++)pi=ie.MouseTracker.subscribeEvents[gi],ie.addEvent(ei.element,pi,Zr[pi],!1);ae(ei),Zr.tracking=!0}}function ve(ei){var Zr=ee[ei.hash],pi,gi;if(Zr.tracking){for(gi=0;gi<ie.MouseTracker.subscribeEvents.length;gi++)pi=ie.MouseTracker.subscribeEvents[gi],ie.removeEvent(ei.element,pi,Zr[pi],!1);ae(ei),Zr.tracking=!1}}function be(ei,Zr){var pi=ee[ei.hash];if(Zr==="pointerevent")return{upName:ie.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:pi.pointerupcaptured,moveName:ie.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:pi.pointermovecaptured};if(Zr==="mouse")return{upName:"mouseup",upHandler:pi.mouseupcaptured,moveName:"mousemove",moveHandler:pi.mousemovecaptured};if(Zr==="touch")return{upName:"touchend",upHandler:pi.touchendcaptured,moveName:"touchmove",moveHandler:pi.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function Ye(ei,Zr,pi){var gi=ei.getActivePointersListByType(Zr),$i;gi.captureCount+=pi||1,gi.captureCount===1&&(ie.Browser.vendor===ie.BROWSERS.IE&&ie.Browser.version<9?ei.element.setCapture(!0):($i=be(ei,ie.MouseTracker.havePointerEvents?"pointerevent":Zr),na&&No(window.top)&&ie.addEvent(window.top,$i.upName,$i.upHandler,!0),ie.addEvent(ie.MouseTracker.captureElement,$i.upName,$i.upHandler,!0),ie.addEvent(ie.MouseTracker.captureElement,$i.moveName,$i.moveHandler,!0)))}function Ke(ei,Zr,pi){var gi=ei.getActivePointersListByType(Zr),$i;gi.captureCount-=pi||1,gi.captureCount===0&&(ie.Browser.vendor===ie.BROWSERS.IE&&ie.Browser.version<9?ei.element.releaseCapture():($i=be(ei,ie.MouseTracker.havePointerEvents?"pointerevent":Zr),na&&No(window.top)&&ie.removeEvent(window.top,$i.upName,$i.upHandler,!0),ie.removeEvent(ie.MouseTracker.captureElement,$i.moveName,$i.moveHandler,!0),ie.removeEvent(ie.MouseTracker.captureElement,$i.upName,$i.upHandler,!0)))}function Xe(ei){var Zr;if(ie.MouseTracker.unprefixedPointerEvents)Zr=ei.pointerType;else switch(ei.pointerType){case 2:Zr="touch";break;case 3:Zr="pen";break;case 4:Zr="mouse";break;default:Zr=""}return Zr}function Je(ei){return ie.getMousePosition(ei)}function rt(ei,Zr){return nt(Je(ei),Zr)}function nt(ei,Zr){var pi=ie.getElementOffset(Zr);return ei.minus(pi)}function it(ei,Zr){return new ie.Point((ei.x+Zr.x)/2,(ei.y+Zr.y)/2)}function lt(ei,Zr){ei.clickHandler&&ie.cancelEvent(Zr)}function ct(ei,Zr){ei.dblClickHandler&&ie.cancelEvent(Zr)}function ot(ei,Zr){var pi;ei.keyDownHandler&&(Zr=ie.getEvent(Zr),pi=ei.keyDownHandler({eventSource:ei,keyCode:Zr.keyCode?Zr.keyCode:Zr.charCode,ctrl:Zr.ctrlKey,shift:Zr.shiftKey,alt:Zr.altKey,meta:Zr.metaKey,originalEvent:Zr,preventDefaultAction:!1,userData:ei.userData}),pi||ie.cancelEvent(Zr))}function dt(ei,Zr){var pi;ei.keyUpHandler&&(Zr=ie.getEvent(Zr),pi=ei.keyUpHandler({eventSource:ei,keyCode:Zr.keyCode?Zr.keyCode:Zr.charCode,ctrl:Zr.ctrlKey,shift:Zr.shiftKey,alt:Zr.altKey,meta:Zr.metaKey,originalEvent:Zr,preventDefaultAction:!1,userData:ei.userData}),pi||ie.cancelEvent(Zr))}function ft(ei,Zr){var pi;ei.keyHandler&&(Zr=ie.getEvent(Zr),pi=ei.keyHandler({eventSource:ei,keyCode:Zr.keyCode?Zr.keyCode:Zr.charCode,ctrl:Zr.ctrlKey,shift:Zr.shiftKey,alt:Zr.altKey,meta:Zr.metaKey,originalEvent:Zr,preventDefaultAction:!1,userData:ei.userData}),pi||ie.cancelEvent(Zr))}function gt(ei,Zr){var pi;ei.focusHandler&&(Zr=ie.getEvent(Zr),pi=ei.focusHandler({eventSource:ei,originalEvent:Zr,preventDefaultAction:!1,userData:ei.userData}),pi===!1&&ie.cancelEvent(Zr))}function mt(ei,Zr){var pi;ei.blurHandler&&(Zr=ie.getEvent(Zr),pi=ei.blurHandler({eventSource:ei,originalEvent:Zr,preventDefaultAction:!1,userData:ei.userData}),pi===!1&&ie.cancelEvent(Zr))}function Yr(ei,Zr){Xr(ei,Zr,Zr)}function Qr(ei,Zr){Zr=ie.getEvent(Zr);var pi={target:Zr.target||Zr.srcElement,type:"wheel",shiftKey:Zr.shiftKey||!1,clientX:Zr.clientX,clientY:Zr.clientY,pageX:Zr.pageX?Zr.pageX:Zr.clientX,pageY:Zr.pageY?Zr.pageY:Zr.clientY,deltaMode:Zr.type=="MozMousePixelScroll"?0:1,deltaX:0,deltaZ:0};ie.MouseTracker.wheelEventName=="mousewheel"?pi.deltaY=-Zr.wheelDelta/ie.DEFAULT_SETTINGS.pixelsPerWheelLine:pi.deltaY=Zr.detail,Xr(ei,pi,Zr)}function Xr(ei,Zr,pi){var gi=0,$i;gi=Zr.deltaY<0?1:-1,ei.scrollHandler&&($i=ei.scrollHandler({eventSource:ei,pointerType:"mouse",position:rt(Zr,ei.element),scroll:gi,shift:Zr.shiftKey,isTouchEvent:!1,originalEvent:pi,preventDefaultAction:!1,userData:ei.userData}),$i===!1&&ie.cancelEvent(pi))}function Jr(ei,Zr){if(ei===Zr)return!1;for(;Zr&&Zr!==ei;)Zr=Zr.parentNode;return Zr===ei}function ai(ei,Zr){Zr=ie.getEvent(Zr),ni(ei,Zr)}function oi(ei,Zr){Zr=ie.getEvent(Zr),!(Zr.currentTarget===Zr.relatedTarget||Jr(Zr.currentTarget,Zr.relatedTarget))&&ni(ei,Zr)}function ni(ei,Zr){var pi={id:ie.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:Je(Zr),currentTime:ie.now()};ms(ei,Zr,[pi])}function li(ei,Zr){Zr=ie.getEvent(Zr),mi(ei,Zr)}function ui(ei,Zr){Zr=ie.getEvent(Zr),!(Zr.currentTarget===Zr.relatedTarget||Jr(Zr.currentTarget,Zr.relatedTarget))&&mi(ei,Zr)}function mi(ei,Zr){var pi={id:ie.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:Je(Zr),currentTime:ie.now()};vs(ei,Zr,[pi])}function ii(ei){return ie.Browser.vendor===ie.BROWSERS.IE&&ie.Browser.version<9?ei===1?0:ei===2?2:ei===4?1:-1:ei}function hi(ei,Zr){var pi;Zr=ie.getEvent(Zr),pi={id:ie.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:Je(Zr),currentTime:ie.now()},zs(ei,Zr,[pi],ii(Zr.button))&&(ie.stopEvent(Zr),Ye(ei,"mouse")),(ei.clickHandler||ei.dblClickHandler||ei.pressHandler||ei.dragHandler||ei.dragEndHandler)&&ie.cancelEvent(Zr)}function ri(ei,Zr){Si(ei,Zr)}function ci(ei,Zr){Si(ei,Zr),ie.stopEvent(Zr)}function Si(ei,Zr){var pi;Zr=ie.getEvent(Zr),pi={id:ie.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:Je(Zr),currentTime:ie.now()},Zs(ei,Zr,[pi],ii(Zr.button))&&Ke(ei,"mouse")}function si(ei,Zr){yi(ei,Zr)}function Ei(ei,Zr){yi(ei,Zr),ie.stopEvent(Zr)}function yi(ei,Zr){var pi;Zr=ie.getEvent(Zr),pi={id:ie.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:Je(Zr),currentTime:ie.now()},Ts(ei,Zr,[pi])}function Mi(ei,Zr,pi){var gi,$i=pi.getLength(),Vi=[];if(pi.type==="touch"||pi.contacts>0){for(gi=0;gi<$i;gi++)Vi.push(pi.getByIndex(gi));Vi.length>0&&(Zs(ei,Zr,Vi,0),pi.captureCount=1,Ke(ei,pi.type),vs(ei,Zr,Vi))}}function Ci(ei,Zr){var pi,gi,$i,Vi=Zr.changedTouches.length,Bi=[],Ui,es=ei.getActivePointersListByType("touch");for(pi=ie.now(),es.getLength()>Zr.touches.length-Vi&&(ie.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers."),Mi(ei,Zr,es)),gi=0;gi<Vi;gi++)Bi.push({id:Zr.changedTouches[gi].identifier,type:"touch",currentPos:Je(Zr.changedTouches[gi]),currentTime:pi});for(ms(ei,Zr,Bi),gi=0;gi<Z.length;gi++)if(Z[gi]!==ei&&Z[gi].isTracking()&&Jr(Z[gi].element,ei.element)){for(Ui=[],$i=0;$i<Vi;$i++)Ui.push({id:Zr.changedTouches[$i].identifier,type:"touch",currentPos:Je(Zr.changedTouches[$i]),currentTime:pi});ms(Z[gi],Zr,Ui)}zs(ei,Zr,Bi,0)&&(ie.stopEvent(Zr),Ye(ei,"touch",Vi)),ie.cancelEvent(Zr)}function Ri(ei,Zr){Ai(ei,Zr)}function Ni(ei,Zr){Ai(ei,Zr),ie.stopEvent(Zr)}function Ai(ei,Zr){var pi,gi,$i,Vi=Zr.changedTouches.length,Bi=[],Ui;for(pi=ie.now(),gi=0;gi<Vi;gi++)Bi.push({id:Zr.changedTouches[gi].identifier,type:"touch",currentPos:Je(Zr.changedTouches[gi]),currentTime:pi});for(Zs(ei,Zr,Bi,0)&&Ke(ei,"touch",Vi),vs(ei,Zr,Bi),gi=0;gi<Z.length;gi++)if(Z[gi]!==ei&&Z[gi].isTracking()&&Jr(Z[gi].element,ei.element)){for(Ui=[],$i=0;$i<Vi;$i++)Ui.push({id:Zr.changedTouches[$i].identifier,type:"touch",currentPos:Je(Zr.changedTouches[$i]),currentTime:pi});vs(Z[gi],Zr,Ui)}ie.cancelEvent(Zr)}function ki(ei,Zr){Ji(ei,Zr)}function Yi(ei,Zr){Ji(ei,Zr),ie.stopEvent(Zr)}function Ji(ei,Zr){var pi,gi=Zr.changedTouches.length,$i=[];for(pi=0;pi<gi;pi++)$i.push({id:Zr.changedTouches[pi].identifier,type:"touch",currentPos:Je(Zr.changedTouches[pi]),currentTime:ie.now()});Ts(ei,Zr,$i),ie.cancelEvent(Zr)}function ls(ei,Zr){var pi=ei.getActivePointersListByType("touch");Mi(ei,Zr,pi)}function hs(ei,Zr){return Zr.stopPropagation(),Zr.preventDefault(),!1}function Kr(ei,Zr){return Zr.stopPropagation(),Zr.preventDefault(),!1}function di(ei,Zr){var pi;Zr.currentTarget===Zr.relatedTarget||Jr(Zr.currentTarget,Zr.relatedTarget)||(pi={id:Zr.pointerId,type:Xe(Zr),isPrimary:Zr.isPrimary,currentPos:Je(Zr),currentTime:ie.now()},ms(ei,Zr,[pi]))}function wi(ei,Zr){var pi;Zr.currentTarget===Zr.relatedTarget||Jr(Zr.currentTarget,Zr.relatedTarget)||(pi={id:Zr.pointerId,type:Xe(Zr),isPrimary:Zr.isPrimary,currentPos:Je(Zr),currentTime:ie.now()},vs(ei,Zr,[pi]))}function Ii(ei,Zr){var pi;pi={id:Zr.pointerId,type:Xe(Zr),isPrimary:Zr.isPrimary,currentPos:Je(Zr),currentTime:ie.now()},zs(ei,Zr,[pi],Zr.button)&&(ie.stopEvent(Zr),Ye(ei,pi.type)),(ei.clickHandler||ei.dblClickHandler||ei.pressHandler||ei.dragHandler||ei.dragEndHandler||ei.pinchHandler)&&ie.cancelEvent(Zr)}function Di(ei,Zr){Gi(ei,Zr)}function is(ei,Zr){var pi=ei.getActivePointersListByType(Xe(Zr));pi.getById(Zr.pointerId)&&Gi(ei,Zr),ie.stopEvent(Zr)}function Gi(ei,Zr){var pi;pi={id:Zr.pointerId,type:Xe(Zr),isPrimary:Zr.isPrimary,currentPos:Je(Zr),currentTime:ie.now()},Zs(ei,Zr,[pi],Zr.button)&&Ke(ei,pi.type)}function us(ei,Zr){ns(ei,Zr)}function Zi(ei,Zr){var pi=ei.getActivePointersListByType(Xe(Zr));pi.getById(Zr.pointerId)&&ns(ei,Zr),ie.stopEvent(Zr)}function ns(ei,Zr){var pi;pi={id:Zr.pointerId,type:Xe(Zr),isPrimary:Zr.isPrimary,currentPos:Je(Zr),currentTime:ie.now()},Ts(ei,Zr,[pi])}function Ki(ei,Zr){var pi;pi={id:Zr.pointerId,type:Xe(Zr)},go(ei,Zr,[pi])}function ds(ei,Zr){return Object.prototype.hasOwnProperty.call(Zr,"isPrimary")||(ei.getLength()===0?Zr.isPrimary=!0:Zr.isPrimary=!1),Zr.speed=0,Zr.direction=0,Zr.contactPos=Zr.currentPos,Zr.contactTime=Zr.currentTime,Zr.lastPos=Zr.currentPos,Zr.lastTime=Zr.currentTime,ei.add(Zr)}function as(ei,Zr){var pi,gi;return ei.getById(Zr.id)?(pi=ei.removeById(Zr.id),Object.prototype.hasOwnProperty.call(Zr,"isPrimary")||(gi=ei.getPrimary(),gi||(gi=ei.getByIndex(0),gi&&(gi.isPrimary=!0)))):pi=ei.getLength(),pi}function ms(ei,Zr,pi){var gi=ei.getActivePointersListByType(pi[0].type),$i,Vi=pi.length,Bi,Ui,es;for($i=0;$i<Vi;$i++)Bi=pi[$i],Ui=gi.getById(Bi.id),Ui?(Ui.insideElement=!0,Ui.lastPos=Ui.currentPos,Ui.lastTime=Ui.currentTime,Ui.currentPos=Bi.currentPos,Ui.currentTime=Bi.currentTime,Bi=Ui):(Bi.captured=!1,Bi.insideElementPressed=!1,Bi.insideElement=!0,ds(gi,Bi)),ei.enterHandler&&(es=ei.enterHandler({eventSource:ei,pointerType:Bi.type,position:nt(Bi.currentPos,ei.element),buttons:gi.buttons,pointers:ei.getActivePointerCount(),insideElementPressed:Bi.insideElementPressed,buttonDownAny:gi.buttons!==0,isTouchEvent:Bi.type==="touch",originalEvent:Zr,preventDefaultAction:!1,userData:ei.userData}),es===!1&&ie.cancelEvent(Zr))}function vs(ei,Zr,pi){var gi=ei.getActivePointersListByType(pi[0].type),$i,Vi=pi.length,Bi,Ui,es;for($i=0;$i<Vi;$i++)Bi=pi[$i],Ui=gi.getById(Bi.id),Ui&&(Ui.captured?(Ui.insideElement=!1,Ui.lastPos=Ui.currentPos,Ui.lastTime=Ui.currentTime,Ui.currentPos=Bi.currentPos,Ui.currentTime=Bi.currentTime):as(gi,Ui),Bi=Ui),ei.exitHandler&&(es=ei.exitHandler({eventSource:ei,pointerType:Bi.type,position:Bi.currentPos&&nt(Bi.currentPos,ei.element),buttons:gi.buttons,pointers:ei.getActivePointerCount(),insideElementPressed:Ui?Ui.insideElementPressed:!1,buttonDownAny:gi.buttons!==0,isTouchEvent:Bi.type==="touch",originalEvent:Zr,preventDefaultAction:!1,userData:ei.userData}),es===!1&&ie.cancelEvent(Zr))}function zs(ei,Zr,pi,gi){var $i=ee[ei.hash],Vi,Bi=ei.getActivePointersListByType(pi[0].type),Ui,es=pi.length,Qi,ss;typeof Zr.buttons<"u"?Bi.buttons=Zr.buttons:ie.Browser.vendor===ie.BROWSERS.IE&&ie.Browser.version<9?gi===0?Bi.buttons+=1:gi===1?Bi.buttons+=4:gi===2?Bi.buttons+=2:gi===3?Bi.buttons+=8:gi===4?Bi.buttons+=16:gi===5&&(Bi.buttons+=32):gi===0?Bi.buttons|=1:gi===1?Bi.buttons|=4:gi===2?Bi.buttons|=2:gi===3?Bi.buttons|=8:gi===4?Bi.buttons|=16:gi===5&&(Bi.buttons|=32);var cs=ei.getActivePointersListsExceptType(pi[0].type);for(Ui=0;Ui<cs.length;Ui++)Mi(ei,Zr,cs[Ui]);if(gi!==0)return ei.nonPrimaryPressHandler&&(Vi=ei.nonPrimaryPressHandler({eventSource:ei,pointerType:pi[0].type,position:nt(pi[0].currentPos,ei.element),button:gi,buttons:Bi.buttons,isTouchEvent:pi[0].type==="touch",originalEvent:Zr,preventDefaultAction:!1,userData:ei.userData}),Vi===!1&&ie.cancelEvent(Zr)),!1;for(Ui=0;Ui<es;Ui++)Qi=pi[Ui],ss=Bi.getById(Qi.id),ss?(ss.captured=!0,ss.insideElementPressed=!0,ss.insideElement=!0,ss.contactPos=Qi.currentPos,ss.contactTime=Qi.currentTime,ss.lastPos=ss.currentPos,ss.lastTime=ss.currentTime,ss.currentPos=Qi.currentPos,ss.currentTime=Qi.currentTime,Qi=ss):(Qi.captured=!0,Qi.insideElementPressed=!0,Qi.insideElement=!0,ds(Bi,Qi)),Bi.addContact(),(ei.dragHandler||ei.dragEndHandler||ei.pinchHandler)&&ie.MouseTracker.gesturePointVelocityTracker.addPoint(ei,Qi),Bi.contacts===1?ei.pressHandler&&(Vi=ei.pressHandler({eventSource:ei,pointerType:Qi.type,position:nt(Qi.contactPos,ei.element),buttons:Bi.buttons,isTouchEvent:Qi.type==="touch",originalEvent:Zr,preventDefaultAction:!1,userData:ei.userData}),Vi===!1&&ie.cancelEvent(Zr)):Bi.contacts===2&&ei.pinchHandler&&Qi.type==="touch"&&($i.pinchGPoints=Bi.asArray(),$i.lastPinchDist=$i.currentPinchDist=$i.pinchGPoints[0].currentPos.distanceTo($i.pinchGPoints[1].currentPos),$i.lastPinchCenter=$i.currentPinchCenter=it($i.pinchGPoints[0].currentPos,$i.pinchGPoints[1].currentPos));return!0}function Zs(ei,Zr,pi,gi){var $i=ee[ei.hash],Vi=ei.getActivePointersListByType(pi[0].type),Bi,Ui,es,Qi,ss=pi.length,cs,Xi,_s=!1,eo=!1,Ys;if(typeof Zr.buttons<"u"?Vi.buttons=Zr.buttons:ie.Browser.vendor===ie.BROWSERS.IE&&ie.Browser.version<9?gi===0?Vi.buttons-=1:gi===1?Vi.buttons-=4:gi===2?Vi.buttons-=2:gi===3?Vi.buttons-=8:gi===4?Vi.buttons-=16:gi===5&&(Vi.buttons-=32):gi===0?Vi.buttons^=-2:gi===1?Vi.buttons^=-5:gi===2?Vi.buttons^=-3:gi===3?Vi.buttons^=-9:gi===4?Vi.buttons^=-17:gi===5&&(Vi.buttons^=-33),gi!==0){ei.nonPrimaryReleaseHandler&&(Bi=ei.nonPrimaryReleaseHandler({eventSource:ei,pointerType:pi[0].type,position:nt(pi[0].currentPos,ei.element),button:gi,buttons:Vi.buttons,isTouchEvent:pi[0].type==="touch",originalEvent:Zr,preventDefaultAction:!1,userData:ei.userData}),Bi===!1&&ie.cancelEvent(Zr));var Ps=ei.getActivePointersListByType("mouse");return Mi(ei,Zr,Ps),!1}if(typeof pi[0].currentPos>"u")return Mi(ei,Zr,Vi),!1;for(Qi=0;Qi<ss;Qi++)cs=pi[Qi],Xi=Vi.getById(cs.id),Xi&&(Xi.captured&&(Xi.captured=!1,_s=!0,eo=!0),Xi.lastPos=Xi.currentPos,Xi.lastTime=Xi.currentTime,Xi.currentPos=cs.currentPos,Xi.currentTime=cs.currentTime,Xi.insideElement||as(Vi,Xi),Ui=Xi.currentPos,es=Xi.currentTime,eo?(Vi.removeContact(),(ei.dragHandler||ei.dragEndHandler||ei.pinchHandler)&&ie.MouseTracker.gesturePointVelocityTracker.removePoint(ei,Xi),Vi.contacts===0?(ei.releaseHandler&&(Bi=ei.releaseHandler({eventSource:ei,pointerType:Xi.type,position:nt(Ui,ei.element),buttons:Vi.buttons,insideElementPressed:Xi.insideElementPressed,insideElementReleased:Xi.insideElement,isTouchEvent:Xi.type==="touch",originalEvent:Zr,preventDefaultAction:!1,userData:ei.userData}),Bi===!1&&ie.cancelEvent(Zr)),ei.dragEndHandler&&!Xi.currentPos.equals(Xi.contactPos)&&(Bi=ei.dragEndHandler({eventSource:ei,pointerType:Xi.type,position:nt(Xi.currentPos,ei.element),speed:Xi.speed,direction:Xi.direction,shift:Zr.shiftKey,isTouchEvent:Xi.type==="touch",originalEvent:Zr,preventDefaultAction:!1,userData:ei.userData}),Bi===!1&&ie.cancelEvent(Zr)),(ei.clickHandler||ei.dblClickHandler)&&Xi.insideElement&&(Ys=es-Xi.contactTime<=ei.clickTimeThreshold&&Xi.contactPos.distanceTo(Ui)<=ei.clickDistThreshold,ei.clickHandler&&(Bi=ei.clickHandler({eventSource:ei,pointerType:Xi.type,position:nt(Xi.currentPos,ei.element),quick:Ys,shift:Zr.shiftKey,isTouchEvent:Xi.type==="touch",originalEvent:Zr,preventDefaultAction:!1,userData:ei.userData}),Bi===!1&&ie.cancelEvent(Zr)),ei.dblClickHandler&&Ys&&(Vi.clicks++,Vi.clicks===1?($i.lastClickPos=Ui,$i.dblClickTimeOut=setTimeout(function(){Vi.clicks=0},ei.dblClickTimeThreshold)):Vi.clicks===2&&(clearTimeout($i.dblClickTimeOut),Vi.clicks=0,$i.lastClickPos.distanceTo(Ui)<=ei.dblClickDistThreshold&&(Bi=ei.dblClickHandler({eventSource:ei,pointerType:Xi.type,position:nt(Xi.currentPos,ei.element),shift:Zr.shiftKey,isTouchEvent:Xi.type==="touch",originalEvent:Zr,preventDefaultAction:!1,userData:ei.userData}),Bi===!1&&ie.cancelEvent(Zr)),$i.lastClickPos=null)))):Vi.contacts===2&&ei.pinchHandler&&Xi.type==="touch"&&($i.pinchGPoints=Vi.asArray(),$i.lastPinchDist=$i.currentPinchDist=$i.pinchGPoints[0].currentPos.distanceTo($i.pinchGPoints[1].currentPos),$i.lastPinchCenter=$i.currentPinchCenter=it($i.pinchGPoints[0].currentPos,$i.pinchGPoints[1].currentPos))):ei.releaseHandler&&(Bi=ei.releaseHandler({eventSource:ei,pointerType:Xi.type,position:nt(Ui,ei.element),buttons:Vi.buttons,insideElementPressed:Xi.insideElementPressed,insideElementReleased:Xi.insideElement,isTouchEvent:Xi.type==="touch",originalEvent:Zr,preventDefaultAction:!1,userData:ei.userData}),Bi===!1&&ie.cancelEvent(Zr)));return _s}function Ts(ei,Zr,pi){var gi=ee[ei.hash],$i=ei.getActivePointersListByType(pi[0].type),Vi,Bi=pi.length,Ui,es,Qi,ss,cs;for(typeof Zr.buttons<"u"&&($i.buttons=Zr.buttons),Vi=0;Vi<Bi;Vi++)Ui=pi[Vi],es=$i.getById(Ui.id),es?(Object.prototype.hasOwnProperty.call(Ui,"isPrimary")&&(es.isPrimary=Ui.isPrimary),es.lastPos=es.currentPos,es.lastTime=es.currentTime,es.currentPos=Ui.currentPos,es.currentTime=Ui.currentTime):(Ui.captured=!1,Ui.insideElementPressed=!1,Ui.insideElement=!0,ds($i,Ui));ei.stopHandler&&pi[0].type==="mouse"&&(clearTimeout(ei.stopTimeOut),ei.stopTimeOut=setTimeout(function(){Ha(ei,Zr,pi[0].type)},ei.stopDelay)),$i.contacts===0?ei.moveHandler&&(cs=ei.moveHandler({eventSource:ei,pointerType:pi[0].type,position:nt(pi[0].currentPos,ei.element),buttons:$i.buttons,isTouchEvent:pi[0].type==="touch",originalEvent:Zr,preventDefaultAction:!1,userData:ei.userData}),cs===!1&&ie.cancelEvent(Zr)):$i.contacts===1?(ei.moveHandler&&(es=$i.asArray()[0],cs=ei.moveHandler({eventSource:ei,pointerType:es.type,position:nt(es.currentPos,ei.element),buttons:$i.buttons,isTouchEvent:es.type==="touch",originalEvent:Zr,preventDefaultAction:!1,userData:ei.userData}),cs===!1&&ie.cancelEvent(Zr)),ei.dragHandler&&(es=$i.asArray()[0],ss=es.currentPos.minus(es.lastPos),cs=ei.dragHandler({eventSource:ei,pointerType:es.type,position:nt(es.currentPos,ei.element),buttons:$i.buttons,delta:ss,speed:es.speed,direction:es.direction,shift:Zr.shiftKey,isTouchEvent:es.type==="touch",originalEvent:Zr,preventDefaultAction:!1,userData:ei.userData}),cs===!1&&ie.cancelEvent(Zr))):$i.contacts===2&&(ei.moveHandler&&(Qi=$i.asArray(),cs=ei.moveHandler({eventSource:ei,pointerType:Qi[0].type,position:nt(it(Qi[0].currentPos,Qi[1].currentPos),ei.element),buttons:$i.buttons,isTouchEvent:Qi[0].type==="touch",originalEvent:Zr,preventDefaultAction:!1,userData:ei.userData}),cs===!1&&ie.cancelEvent(Zr)),ei.pinchHandler&&pi[0].type==="touch"&&(ss=gi.pinchGPoints[0].currentPos.distanceTo(gi.pinchGPoints[1].currentPos),ss!=gi.currentPinchDist&&(gi.lastPinchDist=gi.currentPinchDist,gi.currentPinchDist=ss,gi.lastPinchCenter=gi.currentPinchCenter,gi.currentPinchCenter=it(gi.pinchGPoints[0].currentPos,gi.pinchGPoints[1].currentPos),cs=ei.pinchHandler({eventSource:ei,pointerType:"touch",gesturePoints:gi.pinchGPoints,lastCenter:nt(gi.lastPinchCenter,ei.element),center:nt(gi.currentPinchCenter,ei.element),lastDistance:gi.lastPinchDist,distance:gi.currentPinchDist,shift:Zr.shiftKey,originalEvent:Zr,preventDefaultAction:!1,userData:ei.userData}),cs===!1&&ie.cancelEvent(Zr))))}function go(ei,Zr,pi){Zs(ei,Zr,pi,0),vs(ei,Zr,pi)}function Ha(ei,Zr,pi){ei.stopHandler&&ei.stopHandler({eventSource:ei,pointerType:pi,position:rt(Zr,ei.element),buttons:ei.getActivePointersListByType(pi).buttons,isTouchEvent:pi==="touch",originalEvent:Zr,preventDefaultAction:!1,userData:ei.userData})}var na=function(){try{return window.self!==window.top}catch{return!0}}();function No(ei){try{return ei.addEventListener&&ei.removeEventListener}catch{return!1}}}(OpenSeadragon),function(ie){ie.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},ie.Control=function(Z,ee,ae){var ye=Z.parentNode;typeof ee=="number"&&(ie.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),ee={anchor:ee}),ee.attachToViewer=typeof ee.attachToViewer>"u"?!0:ee.attachToViewer,this.autoFade=typeof ee.autoFade>"u"?!0:ee.autoFade,this.element=Z,this.anchor=ee.anchor,this.container=ae,this.anchor==ie.ControlAnchor.ABSOLUTE?(this.wrapper=ie.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top=typeof ee.top=="number"?ee.top+"px":ee.top,this.wrapper.style.left=typeof ee.left=="number"?ee.left+"px":ee.left,this.wrapper.style.height=typeof ee.height=="number"?ee.height+"px":ee.height,this.wrapper.style.width=typeof ee.width=="number"?ee.width+"px":ee.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=ie.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor==ie.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),ee.attachToViewer?this.anchor==ie.ControlAnchor.TOP_RIGHT||this.anchor==ie.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):ye.appendChild(this.wrapper)},ie.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return this.wrapper.style.display!="none"},setVisible:function(Z){this.wrapper.style.display=Z?this.anchor==ie.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(Z){this.element[ie.SIGNAL]&&ie.Browser.vendor==ie.BROWSERS.IE?ie.setElementOpacity(this.element,Z,!0):ie.setElementOpacity(this.wrapper,Z,!0)}}}(OpenSeadragon),function(ie){ie.ControlDock=function(ee){var ae=["topleft","topright","bottomright","bottomleft"],ye,ve;for(ie.extend(!0,this,{id:"controldock-"+ie.now()+"-"+Math.floor(Math.random()*1e6),container:ie.makeNeutralElement("div"),controls:[]},ee),this.container.onsubmit=function(){return!1},this.element&&(this.element=ie.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),ve=0;ve<ae.length;ve++)ye=ae[ve],this.controls[ye]=ie.makeNeutralElement("div"),this.controls[ye].style.position="absolute",ye.match("left")&&(this.controls[ye].style.left="0px"),ye.match("right")&&(this.controls[ye].style.right="0px"),ye.match("top")&&(this.controls[ye].style.top="0px"),ye.match("bottom")&&(this.controls[ye].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},ie.ControlDock.prototype={addControl:function(ee,ae){ee=ie.getElement(ee);var ye=null;if(!(Z(this,ee)>=0)){switch(ae.anchor){case ie.ControlAnchor.TOP_RIGHT:ye=this.controls.topright,ee.style.position="relative",ee.style.paddingRight="0px",ee.style.paddingTop="0px";break;case ie.ControlAnchor.BOTTOM_RIGHT:ye=this.controls.bottomright,ee.style.position="relative",ee.style.paddingRight="0px",ee.style.paddingBottom="0px";break;case ie.ControlAnchor.BOTTOM_LEFT:ye=this.controls.bottomleft,ee.style.position="relative",ee.style.paddingLeft="0px",ee.style.paddingBottom="0px";break;case ie.ControlAnchor.TOP_LEFT:ye=this.controls.topleft,ee.style.position="relative",ee.style.paddingLeft="0px",ee.style.paddingTop="0px";break;case ie.ControlAnchor.ABSOLUTE:ye=this.container,ee.style.margin="0px",ee.style.padding="0px";break;default:case ie.ControlAnchor.NONE:ye=this.container,ee.style.margin="0px",ee.style.padding="0px";break}this.controls.push(new ie.Control(ee,ae,ye)),ee.style.display="inline-block"}},removeControl:function(ee){ee=ie.getElement(ee);var ae=Z(this,ee);return ae>=0&&(this.controls[ae].destroy(),this.controls.splice(ae,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var ee;for(ee=this.controls.length-1;ee>=0;ee--)if(this.controls[ee].isVisible())return!0;return!1},setControlsEnabled:function(ee){var ae;for(ae=this.controls.length-1;ae>=0;ae--)this.controls[ae].setVisible(ee);return this}};function Z(ee,ae){var ye=ee.controls,ve;for(ve=ye.length-1;ve>=0;ve--)if(ye[ve].element==ae)return ve;return-1}}(OpenSeadragon),function(ie){ie.Placement=ie.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(OpenSeadragon),function(ie){var Z={},ee=1;ie.Viewer=function(Kr){var di=arguments,wi=this,Ii;if(ie.isPlainObject(Kr)||(Kr={id:di[0],xmlPath:di.length>1?di[1]:void 0,prefixUrl:di.length>2?di[2]:void 0,controls:di.length>3?di[3]:void 0,overlays:di.length>4?di[4]:void 0}),Kr.config&&(ie.extend(!0,Kr,Kr.config),delete Kr.config),ie.extend(!0,this,{id:Kr.id,hash:Kr.hash||ee++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},ie.DEFAULT_SETTINGS,Kr),typeof this.hash>"u")throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(typeof Z[this.hash]<"u"&&ie.console.warn("Hash "+this.hash+" has already been used."),Z[this.hash]={fsBoundsDelta:new ie.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._lastScrollTime=ie.now(),ie.EventSource.call(this),this.addHandler("open-failed",function(Di){var is=ie.getString("Errors.OpenFailed",Di.eventSource,Di.message);wi._showMessage(is)}),ie.ControlDock.call(this,Kr),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=ie.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",function(Di){Di.width="100%",Di.height="100%",Di.overflow="hidden",Di.position="absolute",Di.top="0px",Di.left="0px"}(this.canvas.style),ie.setElementTouchActionNone(this.canvas),Kr.tabIndex!==""&&(this.canvas.tabIndex=Kr.tabIndex===void 0?0:Kr.tabIndex),this.container.className="openseadragon-container",function(Di){Di.width="100%",Di.height="100%",Di.position="relative",Di.overflow="hidden",Di.left="0px",Di.top="0px",Di.textAlign="left"}(this.container.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new ie.MouseTracker({element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:ie.delegate(this,lt),keyHandler:ie.delegate(this,ct),clickHandler:ie.delegate(this,ot),dblClickHandler:ie.delegate(this,dt),dragHandler:ie.delegate(this,ft),dragEndHandler:ie.delegate(this,gt),enterHandler:ie.delegate(this,mt),exitHandler:ie.delegate(this,Yr),pressHandler:ie.delegate(this,Qr),releaseHandler:ie.delegate(this,Xr),nonPrimaryPressHandler:ie.delegate(this,Jr),nonPrimaryReleaseHandler:ie.delegate(this,ai),scrollHandler:ie.delegate(this,ni),pinchHandler:ie.delegate(this,oi)}),this.outerTracker=new ie.MouseTracker({element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:ie.delegate(this,li),exitHandler:ie.delegate(this,ui)}),this.toolbar&&(this.toolbar=new ie.ControlDock({element:this.toolbar})),this.bindStandardControls(),Z[this.hash].prevContainerSize=ae(this.container),this.world=new ie.World({viewer:this}),this.world.addHandler("add-item",function(Di){wi.source=wi.world.getItemAt(0).source,Z[wi.hash].forceRedraw=!0,wi._updateRequestId||(wi._updateRequestId=Ye(wi,mi))}),this.world.addHandler("remove-item",function(Di){wi.world.getItemCount()?wi.source=wi.world.getItemAt(0).source:wi.source=null,Z[wi.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(Di){wi.viewport&&wi.viewport._setContentBounds(wi.world.getHomeBounds(),wi.world.getContentFactor())}),this.world.addHandler("item-index-change",function(Di){wi.source=wi.world.getItemAt(0).source}),this.viewport=new ie.Viewport({containerSize:Z[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new ie.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:Kr.timeout}),this.tileCache=new ie.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new ie.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=ie.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(Ii=this.buttons.buttons.indexOf(this.rotateLeft),this.buttons.buttons.splice(Ii,1),this.buttons.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(Ii=this.buttons.buttons.indexOf(this.rotateRight),this.buttons.buttons.splice(Ii,1),this.buttons.element.removeChild(this.rotateRight.element))),this.showNavigator&&(this.navigator=new ie.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),Ii=0;Ii<this.customControls.length;Ii++)this.addControl(this.customControls[Ii].id,{anchor:this.customControls[Ii].anchor});ie.requestAnimationFrame(function(){Xe(wi)}),this.imageSmoothingEnabled!==void 0&&!this.imageSmoothingEnabled&&this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled)},ie.extend(ie.Viewer.prototype,ie.EventSource.prototype,ie.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(Kr){return ie.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(Kr)},openTileSource:function(Kr){return ie.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(Kr)},open:function(Kr,di){var wi=this;if(this.close(),!!Kr){if(this.sequenceMode&&ie.isArray(Kr)){this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),typeof di<"u"&&!isNaN(di)&&(this.initialPage=di),this.tileSources=Kr,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex);return}if(ie.isArray(Kr)||(Kr=[Kr]),!!Kr.length){this._opening=!0;for(var Ii=Kr.length,Di=0,is=0,Gi,us=function(){if(Di+is===Ii)if(Di){(wi._firstOpen||!wi.preserveViewport)&&(wi.viewport.goHome(!0),wi.viewport.update()),wi._firstOpen=!1;var Ki=Kr[0];if(Ki.tileSource&&(Ki=Ki.tileSource),wi.overlays&&!wi.preserveOverlays)for(var ds=0;ds<wi.overlays.length;ds++)wi.currentOverlays[ds]=ve(wi,wi.overlays[ds]);wi._drawOverlays(),wi._opening=!1,wi.raiseEvent("open",{source:Ki})}else wi._opening=!1,wi.raiseEvent("open-failed",Gi)},Zi=function(Ki){(!ie.isPlainObject(Ki)||!Ki.tileSource)&&(Ki={tileSource:Ki}),Ki.index!==void 0&&(ie.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete Ki.index),Ki.collectionImmediately===void 0&&(Ki.collectionImmediately=!0);var ds=Ki.success;Ki.success=function(ms){if(Di++,Ki.tileSource.overlays)for(var vs=0;vs<Ki.tileSource.overlays.length;vs++)wi.addOverlay(Ki.tileSource.overlays[vs]);ds&&ds(ms),us()};var as=Ki.error;Ki.error=function(ms){is++,Gi||(Gi=ms),as&&as(ms),us()},wi.addTiledImage(Ki)},ns=0;ns<Kr.length;ns++)Zi(Kr[ns]);return this}}},close:function(){return Z[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),Z[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(Z[this.hash]){if(this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),this._updateRequestId!==null&&(ie.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.removeAllHandlers(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),Z[this.hash]=null,delete Z[this.hash],this.canvas=null,this.container=null,this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(Kr){return this.innerTracker.setTracking(Kr),this.outerTracker.setTracking(Kr),this.raiseEvent("mouse-enabled",{enabled:Kr}),this},areControlsEnabled:function(){var Kr=this.controls.length,di;for(di=0;di<this.controls.length;di++)Kr=Kr&&this.controls[di].isVisible();return Kr},setControlsEnabled:function(Kr){return Kr?rt(this):Xe(this),this.raiseEvent("controls-enabled",{enabled:Kr}),this},setDebugMode:function(Kr){for(var di=0;di<this.world.getItemCount();di++)this.world.getItemAt(di).debugMode=Kr;this.debugMode=Kr,this.forceRedraw()},isFullPage:function(){return Z[this.hash].fullPage},setFullPage:function(Kr){var di=document.body,wi=di.style,Ii=document.documentElement.style,Di=this,is,Gi;if(Kr==this.isFullPage())return this;var us={fullPage:Kr,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",us),us.preventDefaultAction)return this;if(Kr){for(this.elementSize=ie.getElementSize(this.element),this.pageScroll=ie.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=wi.margin,this.docMargin=Ii.margin,wi.margin="0",Ii.margin="0",this.bodyPadding=wi.padding,this.docPadding=Ii.padding,wi.padding="0",Ii.padding="0",this.bodyWidth=wi.width,this.docWidth=Ii.width,wi.width="100%",Ii.width="100%",this.bodyHeight=wi.height,this.docHeight=Ii.height,wi.height="100%",Ii.height="100%",this.previousBody=[],Z[this.hash].prevElementParent=this.element.parentNode,Z[this.hash].prevNextSibling=this.element.nextSibling,Z[this.hash].prevElementWidth=this.element.style.width,Z[this.hash].prevElementHeight=this.element.style.height,is=di.childNodes.length,Gi=0;Gi<is;Gi++)this.previousBody.push(di.childNodes[0]),di.removeChild(di.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,di.appendChild(this.toolbar.element),ie.addClass(this.toolbar.element,"fullpage")),ie.addClass(this.element,"fullpage"),di.appendChild(this.element),this.element.style.height=ie.getWindowSize().y+"px",this.element.style.width=ie.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=ie.getElementSize(this.element).y-ie.getElementSize(this.toolbar.element).y+"px"),Z[this.hash].fullPage=!0,ie.delegate(this,li)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,wi.margin=this.bodyMargin,Ii.margin=this.docMargin,wi.padding=this.bodyPadding,Ii.padding=this.docPadding,wi.width=this.bodyWidth,Ii.width=this.docWidth,wi.height=this.bodyHeight,Ii.height=this.docHeight,di.removeChild(this.element),is=this.previousBody.length,Gi=0;Gi<is;Gi++)di.appendChild(this.previousBody.shift());ie.removeClass(this.element,"fullpage"),Z[this.hash].prevElementParent.insertBefore(this.element,Z[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(di.removeChild(this.toolbar.element),ie.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=Z[this.hash].prevElementWidth,this.element.style.height=Z[this.hash].prevElementHeight;var Zi=0,ns=function(){ie.setPageScroll(Di.pageScroll);var Ki=ie.getPageScroll();Zi++,Zi<10&&(Ki.x!==Di.pageScroll.x||Ki.y!==Di.pageScroll.y)&&ie.requestAnimationFrame(ns)};ie.requestAnimationFrame(ns),Z[this.hash].fullPage=!1,ie.delegate(this,ui)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:Kr}),this},setFullScreen:function(Kr){var di=this;if(!ie.supportsFullScreen)return this.setFullPage(Kr);if(ie.isFullScreen()===Kr)return this;var wi={fullScreen:Kr,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",wi),wi.preventDefaultAction)return this;if(Kr){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var Ii=function(){var Di=ie.isFullScreen();Di||(ie.removeEvent(document,ie.fullScreenEventName,Ii),ie.removeEvent(document,ie.fullScreenErrorEventName,Ii),di.setFullPage(!1),di.isFullPage()&&(di.element.style.width=di.fullPageStyleWidth,di.element.style.height=di.fullPageStyleHeight)),di.navigator&&di.viewport&&setTimeout(function(){di.navigator.update(di.viewport)}),di.raiseEvent("full-screen",{fullScreen:Di})};ie.addEvent(document,ie.fullScreenEventName,Ii),ie.addEvent(document,ie.fullScreenErrorEventName,Ii),ie.requestFullScreen(document.body)}else ie.exitFullScreen();return this},isVisible:function(){return this.container.style.visibility!="hidden"},setVisible:function(Kr){return this.container.style.visibility=Kr?"":"hidden",this.raiseEvent("visible",{visible:Kr}),this},addTiledImage:function(Kr){ie.console.assert(Kr,"[Viewer.addTiledImage] options is required"),ie.console.assert(Kr.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),ie.console.assert(!Kr.replace||Kr.index>-1&&Kr.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var di=this;Kr.replace&&(Kr.replaceItem=di.world.getItemAt(Kr.index)),this._hideMessage(),Kr.placeholderFillStyle===void 0&&(Kr.placeholderFillStyle=this.placeholderFillStyle),Kr.opacity===void 0&&(Kr.opacity=this.opacity),Kr.preload===void 0&&(Kr.preload=this.preload),Kr.compositeOperation===void 0&&(Kr.compositeOperation=this.compositeOperation),Kr.crossOriginPolicy===void 0&&(Kr.crossOriginPolicy=Kr.tileSource.crossOriginPolicy!==void 0?Kr.tileSource.crossOriginPolicy:this.crossOriginPolicy),Kr.ajaxWithCredentials===void 0&&(Kr.ajaxWithCredentials=this.ajaxWithCredentials),Kr.loadTilesWithAjax===void 0&&(Kr.loadTilesWithAjax=this.loadTilesWithAjax),Kr.ajaxHeaders===void 0||Kr.ajaxHeaders===null?Kr.ajaxHeaders=this.ajaxHeaders:ie.isPlainObject(Kr.ajaxHeaders)&&ie.isPlainObject(this.ajaxHeaders)&&(Kr.ajaxHeaders=ie.extend({},this.ajaxHeaders,Kr.ajaxHeaders));var wi={options:Kr};function Ii(Gi){for(var us=0;us<di._loadQueue.length;us++)if(di._loadQueue[us]===wi){di._loadQueue.splice(us,1);break}di._loadQueue.length===0&&Di(wi),di.raiseEvent("add-item-failed",Gi),Kr.error&&Kr.error(Gi)}function Di(Gi){di.collectionMode&&(di.world.arrange({immediately:Gi.options.collectionImmediately,rows:di.collectionRows,columns:di.collectionColumns,layout:di.collectionLayout,tileSize:di.collectionTileSize,tileMargin:di.collectionTileMargin}),di.world.setAutoRefigureSizes(!0))}if(ie.isArray(Kr.tileSource)){setTimeout(function(){Ii({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:Kr.tileSource,options:Kr})});return}this._loadQueue.push(wi);function is(){for(var Gi,us,Zi;di._loadQueue.length&&(Gi=di._loadQueue[0],!!Gi.tileSource);){if(di._loadQueue.splice(0,1),Gi.options.replace){var ns=di.world.getIndexOfItem(Gi.options.replaceItem);ns!=-1&&(Gi.options.index=ns),di.world.removeItem(Gi.options.replaceItem)}us=new ie.TiledImage({viewer:di,source:Gi.tileSource,viewport:di.viewport,drawer:di.drawer,tileCache:di.tileCache,imageLoader:di.imageLoader,x:Gi.options.x,y:Gi.options.y,width:Gi.options.width,height:Gi.options.height,fitBounds:Gi.options.fitBounds,fitBoundsPlacement:Gi.options.fitBoundsPlacement,clip:Gi.options.clip,placeholderFillStyle:Gi.options.placeholderFillStyle,opacity:Gi.options.opacity,preload:Gi.options.preload,degrees:Gi.options.degrees,compositeOperation:Gi.options.compositeOperation,springStiffness:di.springStiffness,animationTime:di.animationTime,minZoomImageRatio:di.minZoomImageRatio,wrapHorizontal:di.wrapHorizontal,wrapVertical:di.wrapVertical,immediateRender:di.immediateRender,blendTime:di.blendTime,alwaysBlend:di.alwaysBlend,minPixelRatio:di.minPixelRatio,smoothTileEdgesMinZoom:di.smoothTileEdgesMinZoom,iOSDevice:di.iOSDevice,crossOriginPolicy:Gi.options.crossOriginPolicy,ajaxWithCredentials:Gi.options.ajaxWithCredentials,loadTilesWithAjax:Gi.options.loadTilesWithAjax,ajaxHeaders:Gi.options.ajaxHeaders,debugMode:di.debugMode}),di.collectionMode&&di.world.setAutoRefigureSizes(!1),di.world.addItem(us,{index:Gi.options.index}),di._loadQueue.length===0&&Di(Gi),di.world.getItemCount()===1&&!di.preserveViewport&&di.viewport.goHome(!0),di.navigator&&(Zi=ie.extend({},Gi.options,{replace:!1,originalTiledImage:us,tileSource:Gi.tileSource}),di.navigator.addTiledImage(Zi)),Gi.options.success&&Gi.options.success({item:us})}}ye(this,Kr.tileSource,Kr,function(Gi){wi.tileSource=Gi,is()},function(Gi){Gi.options=Kr,Ii(Gi),is()})},addSimpleImage:function(Kr){ie.console.assert(Kr,"[Viewer.addSimpleImage] options is required"),ie.console.assert(Kr.url,"[Viewer.addSimpleImage] options.url is required");var di=ie.extend({},Kr,{tileSource:{type:"image",url:Kr.url}});delete di.url,this.addTiledImage(di)},addLayer:function(Kr){var di=this;ie.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var wi=ie.extend({},Kr,{success:function(Ii){di.raiseEvent("add-layer",{options:Kr,drawer:Ii.item})},error:function(Ii){di.raiseEvent("add-layer-failed",Ii)}});return this.addTiledImage(wi),this},getLayerAtLevel:function(Kr){return ie.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(Kr)},getLevelOfLayer:function(Kr){return ie.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(Kr)},getLayersCount:function(){return ie.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(Kr,di){return ie.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(Kr,di)},removeLayer:function(Kr){return ie.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(Kr)},forceRedraw:function(){return Z[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var Kr=ie.delegate(this,nt),di=ie.delegate(this,it),wi=ie.delegate(this,hs),Ii=ie.delegate(this,ls),Di=this.navImages,is=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(is=!1),this.previousButton=new ie.Button({element:this.previousButton?ie.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:ie.getString("Tooltips.PreviousPage"),srcRest:ri(this.prefixUrl,Di.previous.REST),srcGroup:ri(this.prefixUrl,Di.previous.GROUP),srcHover:ri(this.prefixUrl,Di.previous.HOVER),srcDown:ri(this.prefixUrl,Di.previous.DOWN),onRelease:Ii,onFocus:Kr,onBlur:di}),this.nextButton=new ie.Button({element:this.nextButton?ie.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:ie.getString("Tooltips.NextPage"),srcRest:ri(this.prefixUrl,Di.next.REST),srcGroup:ri(this.prefixUrl,Di.next.GROUP),srcHover:ri(this.prefixUrl,Di.next.HOVER),srcDown:ri(this.prefixUrl,Di.next.DOWN),onRelease:wi,onFocus:Kr,onBlur:di}),this.navPrevNextWrap||this.previousButton.disable(),(!this.tileSources||!this.tileSources.length)&&this.nextButton.disable(),is&&(this.paging=new ie.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:ie.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||ie.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var Kr=ie.delegate(this,ci),di=ie.delegate(this,si),wi=ie.delegate(this,Mi),Ii=ie.delegate(this,Si),Di=ie.delegate(this,Ci),is=ie.delegate(this,Ni),Gi=ie.delegate(this,Ai),us=ie.delegate(this,ki),Zi=ie.delegate(this,Yi),ns=ie.delegate(this,Ji),Ki=ie.delegate(this,nt),ds=ie.delegate(this,it),as=this.navImages,ms=[],vs=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(vs=!1),this.showZoomControl&&(ms.push(this.zoomInButton=new ie.Button({element:this.zoomInButton?ie.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:ie.getString("Tooltips.ZoomIn"),srcRest:ri(this.prefixUrl,as.zoomIn.REST),srcGroup:ri(this.prefixUrl,as.zoomIn.GROUP),srcHover:ri(this.prefixUrl,as.zoomIn.HOVER),srcDown:ri(this.prefixUrl,as.zoomIn.DOWN),onPress:Kr,onRelease:di,onClick:wi,onEnter:Kr,onExit:di,onFocus:Ki,onBlur:ds})),ms.push(this.zoomOutButton=new ie.Button({element:this.zoomOutButton?ie.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:ie.getString("Tooltips.ZoomOut"),srcRest:ri(this.prefixUrl,as.zoomOut.REST),srcGroup:ri(this.prefixUrl,as.zoomOut.GROUP),srcHover:ri(this.prefixUrl,as.zoomOut.HOVER),srcDown:ri(this.prefixUrl,as.zoomOut.DOWN),onPress:Ii,onRelease:di,onClick:Di,onEnter:Ii,onExit:di,onFocus:Ki,onBlur:ds}))),this.showHomeControl&&ms.push(this.homeButton=new ie.Button({element:this.homeButton?ie.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:ie.getString("Tooltips.Home"),srcRest:ri(this.prefixUrl,as.home.REST),srcGroup:ri(this.prefixUrl,as.home.GROUP),srcHover:ri(this.prefixUrl,as.home.HOVER),srcDown:ri(this.prefixUrl,as.home.DOWN),onRelease:is,onFocus:Ki,onBlur:ds})),this.showFullPageControl&&ms.push(this.fullPageButton=new ie.Button({element:this.fullPageButton?ie.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:ie.getString("Tooltips.FullPage"),srcRest:ri(this.prefixUrl,as.fullpage.REST),srcGroup:ri(this.prefixUrl,as.fullpage.GROUP),srcHover:ri(this.prefixUrl,as.fullpage.HOVER),srcDown:ri(this.prefixUrl,as.fullpage.DOWN),onRelease:Gi,onFocus:Ki,onBlur:ds})),this.showRotationControl&&(ms.push(this.rotateLeftButton=new ie.Button({element:this.rotateLeftButton?ie.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:ie.getString("Tooltips.RotateLeft"),srcRest:ri(this.prefixUrl,as.rotateleft.REST),srcGroup:ri(this.prefixUrl,as.rotateleft.GROUP),srcHover:ri(this.prefixUrl,as.rotateleft.HOVER),srcDown:ri(this.prefixUrl,as.rotateleft.DOWN),onRelease:us,onFocus:Ki,onBlur:ds})),ms.push(this.rotateRightButton=new ie.Button({element:this.rotateRightButton?ie.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:ie.getString("Tooltips.RotateRight"),srcRest:ri(this.prefixUrl,as.rotateright.REST),srcGroup:ri(this.prefixUrl,as.rotateright.GROUP),srcHover:ri(this.prefixUrl,as.rotateright.HOVER),srcDown:ri(this.prefixUrl,as.rotateright.DOWN),onRelease:Zi,onFocus:Ki,onBlur:ds}))),this.showFlipControl&&ms.push(this.flipButton=new ie.Button({element:this.flipButton?ie.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:ie.getString("Tooltips.Flip"),srcRest:ri(this.prefixUrl,as.flip.REST),srcGroup:ri(this.prefixUrl,as.flip.GROUP),srcHover:ri(this.prefixUrl,as.flip.HOVER),srcDown:ri(this.prefixUrl,as.flip.DOWN),onRelease:ns,onFocus:Ki,onBlur:ds})),vs&&(this.buttons=new ie.ButtonGroup({buttons:ms,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",ie.delegate(this,Ri)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||ie.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||ie.ControlAnchor.TOP_LEFT}))),this},currentPage:function(){return this._sequenceIndex},goToPage:function(Kr){return this.tileSources&&Kr>=0&&Kr<this.tileSources.length&&(this._sequenceIndex=Kr,this._updateSequenceButtons(Kr),this.open(this.tileSources[Kr]),this.referenceStrip&&this.referenceStrip.setFocus(Kr),this.raiseEvent("page",{page:Kr})),this},addOverlay:function(Kr,di,wi,Ii){var Di;if(ie.isPlainObject(Kr)?Di=Kr:Di={element:Kr,location:di,placement:wi,onDraw:Ii},Kr=ie.getElement(Di.element),be(this.currentOverlays,Kr)>=0)return this;var is=ve(this,Di);return this.currentOverlays.push(is),is.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:Kr,location:Di.location,placement:Di.placement}),this},updateOverlay:function(Kr,di,wi){var Ii;return Kr=ie.getElement(Kr),Ii=be(this.currentOverlays,Kr),Ii>=0&&(this.currentOverlays[Ii].update(di,wi),Z[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:Kr,location:di,placement:wi})),this},removeOverlay:function(Kr){var di;return Kr=ie.getElement(Kr),di=be(this.currentOverlays,Kr),di>=0&&(this.currentOverlays[di].destroy(),this.currentOverlays.splice(di,1),Z[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:Kr})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return Z[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(Kr){var di;return Kr=ie.getElement(Kr),di=be(this.currentOverlays,Kr),di>=0?this.currentOverlays[di]:null},_updateSequenceButtons:function(Kr){this.nextButton&&(!this.tileSources||this.tileSources.length-1===Kr?this.navPrevNextWrap||this.nextButton.disable():this.nextButton.enable()),this.previousButton&&(Kr>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(Kr){this._hideMessage();var di=ie.makeNeutralElement("div");di.appendChild(document.createTextNode(Kr)),this.messageDiv=ie.makeCenteredNode(di),ie.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var Kr=this.messageDiv;Kr&&(Kr.parentNode.removeChild(Kr),delete this.messageDiv)},gestureSettingsByDeviceType:function(Kr){switch(Kr){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var Kr,di=this.currentOverlays.length;for(Kr=0;Kr<di;Kr++)this.currentOverlays[Kr].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new ie.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else ie.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')}});function ae(Kr){return Kr=ie.getElement(Kr),new ie.Point(Kr.clientWidth===0?1:Kr.clientWidth,Kr.clientHeight===0?1:Kr.clientHeight)}function ye(Kr,di,wi,Ii,Di){var is=Kr;if(ie.type(di)=="string"){if(di.match(/^\s*<.*>\s*$/))di=ie.parseXml(di);else if(di.match(/^\s*[\{\[].*[\}\]]\s*$/))try{var Gi=ie.parseJSON(di);di=Gi}catch{}}function us(Zi,ns){Zi.ready?Ii(Zi):(Zi.addHandler("ready",function(){Ii(Zi)}),Zi.addHandler("open-failed",function(Ki){Di({message:Ki.message,source:ns})}))}setTimeout(function(){if(ie.type(di)=="string")di=new ie.TileSource({url:di,crossOriginPolicy:wi.crossOriginPolicy!==void 0?wi.crossOriginPolicy:Kr.crossOriginPolicy,ajaxWithCredentials:Kr.ajaxWithCredentials,ajaxHeaders:Kr.ajaxHeaders,useCanvas:Kr.useCanvas,success:function(ds){Ii(ds.tileSource)}}),di.addHandler("open-failed",function(ds){Di(ds)});else if(ie.isPlainObject(di)||di.nodeType)if(di.crossOriginPolicy===void 0&&(wi.crossOriginPolicy!==void 0||Kr.crossOriginPolicy!==void 0)&&(di.crossOriginPolicy=wi.crossOriginPolicy!==void 0?wi.crossOriginPolicy:Kr.crossOriginPolicy),di.ajaxWithCredentials===void 0&&(di.ajaxWithCredentials=Kr.ajaxWithCredentials),di.useCanvas===void 0&&(di.useCanvas=Kr.useCanvas),ie.isFunction(di.getTileUrl)){var Zi=new ie.TileSource(di);Zi.getTileUrl=di.getTileUrl,Ii(Zi)}else{var ns=ie.TileSource.determineType(is,di);if(!ns){Di({message:"Unable to load TileSource",source:di});return}var Ki=ns.prototype.configure.apply(is,[di]);us(new ns(Ki),di)}else us(di,di)})}function ve(Kr,di){if(di instanceof ie.Overlay)return di;var wi=null;if(di.element)wi=ie.getElement(di.element);else{var Ii=di.id?di.id:"openseadragon-overlay-"+Math.floor(Math.random()*1e7);wi=ie.getElement(di.id),wi||(wi=document.createElement("a"),wi.href="#/overlay/"+Ii),wi.id=Ii,ie.addClass(wi,di.className?di.className:"openseadragon-overlay")}var Di=di.location,is=di.width,Gi=di.height;if(!Di){var us=di.x,Zi=di.y;if(di.px!==void 0){var ns=Kr.viewport.imageToViewportRectangle(new ie.Rect(di.px,di.py,is||0,Gi||0));us=ns.x,Zi=ns.y,is=is!==void 0?ns.width:void 0,Gi=Gi!==void 0?ns.height:void 0}Di=new ie.Point(us,Zi)}var Ki=di.placement;return Ki&&ie.type(Ki)==="string"&&(Ki=ie.Placement[di.placement.toUpperCase()]),new ie.Overlay({element:wi,location:Di,placement:Ki,onDraw:di.onDraw,checkResize:di.checkResize,width:is,height:Gi,rotationMode:di.rotationMode})}function be(Kr,di){var wi;for(wi=Kr.length-1;wi>=0;wi--)if(Kr[wi].element===di)return wi;return-1}function Ye(Kr,di){return ie.requestAnimationFrame(function(){di(Kr)})}function Ke(Kr){ie.requestAnimationFrame(function(){Je(Kr)})}function Xe(Kr){Kr.autoHideControls&&(Kr.controlsShouldFade=!0,Kr.controlsFadeBeginTime=ie.now()+Kr.controlsFadeDelay,window.setTimeout(function(){Ke(Kr)},Kr.controlsFadeDelay))}function Je(Kr){var di,wi,Ii,Di;if(Kr.controlsShouldFade){for(di=ie.now(),wi=di-Kr.controlsFadeBeginTime,Ii=1-wi/Kr.controlsFadeLength,Ii=Math.min(1,Ii),Ii=Math.max(0,Ii),Di=Kr.controls.length-1;Di>=0;Di--)Kr.controls[Di].autoFade&&Kr.controls[Di].setOpacity(Ii);Ii>0&&Ke(Kr)}}function rt(Kr){var di;for(Kr.controlsShouldFade=!1,di=Kr.controls.length-1;di>=0;di--)Kr.controls[di].setOpacity(1)}function nt(){rt(this)}function it(){Xe(this)}function lt(Kr){var di={originalEvent:Kr.originalEvent,preventDefaultAction:Kr.preventDefaultAction,preventVerticalPan:Kr.preventVerticalPan,preventHorizontalPan:Kr.preventHorizontalPan};if(this.raiseEvent("canvas-key",di),!di.preventDefaultAction&&!Kr.ctrl&&!Kr.alt&&!Kr.meta)switch(Kr.keyCode){case 38:return di.preventVerticalPan||(Kr.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new ie.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 40:return di.preventVerticalPan||(Kr.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new ie.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 37:return di.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new ie.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;case 39:return di.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new ie.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;default:return!0}else return!0}function ct(Kr){var di={originalEvent:Kr.originalEvent,preventDefaultAction:Kr.preventDefaultAction,preventVerticalPan:Kr.preventVerticalPan,preventHorizontalPan:Kr.preventHorizontalPan};if(this.raiseEvent("canvas-key",di),!di.preventDefaultAction&&!Kr.ctrl&&!Kr.alt&&!Kr.meta)switch(Kr.keyCode){case 43:case 61:return this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),!1;case 45:return this.viewport.zoomBy(.9),this.viewport.applyConstraints(),!1;case 48:return this.viewport.goHome(),this.viewport.applyConstraints(),!1;case 119:case 87:return di.preventVerticalPan||(Kr.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new ie.Point(0,-40))),this.viewport.applyConstraints()),!1;case 115:case 83:return di.preventVerticalPan||(Kr.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new ie.Point(0,40))),this.viewport.applyConstraints()),!1;case 97:return di.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new ie.Point(-40,0))),this.viewport.applyConstraints()),!1;case 100:return di.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new ie.Point(40,0))),this.viewport.applyConstraints()),!1;case 114:return this.viewport.flipped?this.viewport.setRotation(ie.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)):this.viewport.setRotation(ie.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 82:return this.viewport.flipped?this.viewport.setRotation(ie.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)):this.viewport.setRotation(ie.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 102:return this.viewport.toggleFlip(),!1;default:return!0}else return!0}function ot(Kr){var di,wi=document.activeElement==this.canvas;wi||this.canvas.focus(),this.viewport.flipped&&(Kr.position.x=this.viewport.getContainerSize().x-Kr.position.x);var Ii={tracker:Kr.eventSource,position:Kr.position,quick:Kr.quick,shift:Kr.shift,originalEvent:Kr.originalEvent,preventDefaultAction:Kr.preventDefaultAction};this.raiseEvent("canvas-click",Ii),!Ii.preventDefaultAction&&this.viewport&&Kr.quick&&(di=this.gestureSettingsByDeviceType(Kr.pointerType),di.clickToZoom&&(this.viewport.zoomBy(Kr.shift?1/this.zoomPerClick:this.zoomPerClick,di.zoomToRefPoint?this.viewport.pointFromPixel(Kr.position,!0):null),this.viewport.applyConstraints()))}function dt(Kr){var di,wi={tracker:Kr.eventSource,position:Kr.position,shift:Kr.shift,originalEvent:Kr.originalEvent,preventDefaultAction:Kr.preventDefaultAction};this.raiseEvent("canvas-double-click",wi),!wi.preventDefaultAction&&this.viewport&&(di=this.gestureSettingsByDeviceType(Kr.pointerType),di.dblClickToZoom&&(this.viewport.zoomBy(Kr.shift?1/this.zoomPerClick:this.zoomPerClick,di.zoomToRefPoint?this.viewport.pointFromPixel(Kr.position,!0):null),this.viewport.applyConstraints()))}function ft(Kr){var di,wi={tracker:Kr.eventSource,position:Kr.position,delta:Kr.delta,speed:Kr.speed,direction:Kr.direction,shift:Kr.shift,originalEvent:Kr.originalEvent,preventDefaultAction:Kr.preventDefaultAction};if(this.raiseEvent("canvas-drag",wi),!wi.preventDefaultAction&&this.viewport){if(di=this.gestureSettingsByDeviceType(Kr.pointerType),this.panHorizontal||(Kr.delta.x=0),this.panVertical||(Kr.delta.y=0),this.viewport.flipped&&(Kr.delta.x=-Kr.delta.x),this.constrainDuringPan){var Ii=this.viewport.deltaPointsFromPixels(Kr.delta.negate());this.viewport.centerSpringX.target.value+=Ii.x,this.viewport.centerSpringY.target.value+=Ii.y;var Di=this.viewport.getBounds(),is=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=Ii.x,this.viewport.centerSpringY.target.value-=Ii.y,Di.x!=is.x&&(Kr.delta.x=0),Di.y!=is.y&&(Kr.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(Kr.delta.negate()),di.flickEnabled&&!this.constrainDuringPan)}}function gt(Kr){if(!Kr.preventDefaultAction&&this.viewport){var di=this.gestureSettingsByDeviceType(Kr.pointerType);if(di.flickEnabled&&Kr.speed>=di.flickMinSpeed){var wi=0;this.panHorizontal&&(wi=di.flickMomentum*Kr.speed*Math.cos(Kr.direction));var Ii=0;this.panVertical&&(Ii=di.flickMomentum*Kr.speed*Math.sin(Kr.direction));var Di=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),is=this.viewport.pointFromPixel(new ie.Point(Di.x-wi,Di.y-Ii));this.viewport.panTo(is,!1)}this.viewport.applyConstraints()}this.raiseEvent("canvas-drag-end",{tracker:Kr.eventSource,position:Kr.position,speed:Kr.speed,direction:Kr.direction,shift:Kr.shift,originalEvent:Kr.originalEvent})}function mt(Kr){this.raiseEvent("canvas-enter",{tracker:Kr.eventSource,pointerType:Kr.pointerType,position:Kr.position,buttons:Kr.buttons,pointers:Kr.pointers,insideElementPressed:Kr.insideElementPressed,buttonDownAny:Kr.buttonDownAny,originalEvent:Kr.originalEvent})}function Yr(Kr){window.location!=window.parent.location&&ie.MouseTracker.resetAllMouseTrackers(),this.raiseEvent("canvas-exit",{tracker:Kr.eventSource,pointerType:Kr.pointerType,position:Kr.position,buttons:Kr.buttons,pointers:Kr.pointers,insideElementPressed:Kr.insideElementPressed,buttonDownAny:Kr.buttonDownAny,originalEvent:Kr.originalEvent})}function Qr(Kr){this.raiseEvent("canvas-press",{tracker:Kr.eventSource,pointerType:Kr.pointerType,position:Kr.position,insideElementPressed:Kr.insideElementPressed,insideElementReleased:Kr.insideElementReleased,originalEvent:Kr.originalEvent})}function Xr(Kr){this.raiseEvent("canvas-release",{tracker:Kr.eventSource,pointerType:Kr.pointerType,position:Kr.position,insideElementPressed:Kr.insideElementPressed,insideElementReleased:Kr.insideElementReleased,originalEvent:Kr.originalEvent})}function Jr(Kr){this.raiseEvent("canvas-nonprimary-press",{tracker:Kr.eventSource,position:Kr.position,pointerType:Kr.pointerType,button:Kr.button,buttons:Kr.buttons,originalEvent:Kr.originalEvent})}function ai(Kr){this.raiseEvent("canvas-nonprimary-release",{tracker:Kr.eventSource,position:Kr.position,pointerType:Kr.pointerType,button:Kr.button,buttons:Kr.buttons,originalEvent:Kr.originalEvent})}function oi(Kr){var di,wi,Ii,Di;if(!Kr.preventDefaultAction&&this.viewport&&(di=this.gestureSettingsByDeviceType(Kr.pointerType),di.pinchToZoom&&(wi=this.viewport.pointFromPixel(Kr.center,!0),Ii=this.viewport.pointFromPixel(Kr.lastCenter,!0),Di=Ii.minus(wi),this.panHorizontal||(Di.x=0),this.panVertical||(Di.y=0),this.viewport.zoomBy(Kr.distance/Kr.lastDistance,wi,!0),di.zoomToRefPoint&&this.viewport.panBy(Di,!0),this.viewport.applyConstraints()),di.pinchRotate)){var is=Math.atan2(Kr.gesturePoints[0].currentPos.y-Kr.gesturePoints[1].currentPos.y,Kr.gesturePoints[0].currentPos.x-Kr.gesturePoints[1].currentPos.x),Gi=Math.atan2(Kr.gesturePoints[0].lastPos.y-Kr.gesturePoints[1].lastPos.y,Kr.gesturePoints[0].lastPos.x-Kr.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(is-Gi)*(180/Math.PI))}return this.raiseEvent("canvas-pinch",{tracker:Kr.eventSource,gesturePoints:Kr.gesturePoints,lastCenter:Kr.lastCenter,center:Kr.center,lastDistance:Kr.lastDistance,distance:Kr.distance,shift:Kr.shift,originalEvent:Kr.originalEvent}),!1}function ni(Kr){var di,wi,Ii,Di;if(Ii=ie.now(),Di=Ii-this._lastScrollTime,Di>this.minScrollDeltaTime){if(this._lastScrollTime=Ii,this.viewport.flipped&&(Kr.position.x=this.viewport.getContainerSize().x-Kr.position.x),!Kr.preventDefaultAction&&this.viewport&&(di=this.gestureSettingsByDeviceType(Kr.pointerType),di.scrollToZoom&&(wi=Math.pow(this.zoomPerScroll,Kr.scroll),this.viewport.zoomBy(wi,di.zoomToRefPoint?this.viewport.pointFromPixel(Kr.position,!0):null),this.viewport.applyConstraints())),this.raiseEvent("canvas-scroll",{tracker:Kr.eventSource,position:Kr.position,scroll:Kr.scroll,shift:Kr.shift,originalEvent:Kr.originalEvent}),di&&di.scrollToZoom)return!1}else if(di=this.gestureSettingsByDeviceType(Kr.pointerType),di&&di.scrollToZoom)return!1}function li(Kr){Z[this.hash].mouseInside=!0,rt(this),this.raiseEvent("container-enter",{tracker:Kr.eventSource,position:Kr.position,buttons:Kr.buttons,pointers:Kr.pointers,insideElementPressed:Kr.insideElementPressed,buttonDownAny:Kr.buttonDownAny,originalEvent:Kr.originalEvent})}function ui(Kr){Kr.pointers<1&&(Z[this.hash].mouseInside=!1,Z[this.hash].animating||Xe(this)),this.raiseEvent("container-exit",{tracker:Kr.eventSource,position:Kr.position,buttons:Kr.buttons,pointers:Kr.pointers,insideElementPressed:Kr.insideElementPressed,buttonDownAny:Kr.buttonDownAny,originalEvent:Kr.originalEvent})}function mi(Kr){ii(Kr),Kr.isOpen()?Kr._updateRequestId=Ye(Kr,mi):Kr._updateRequestId=!1}function ii(Kr){if(!Kr._opening){if(Kr.autoResize){var di=ae(Kr.container),wi=Z[Kr.hash].prevContainerSize;if(!di.equals(wi)){var Ii=Kr.viewport;if(Kr.preserveImageSizeOnResize){var Di=wi.x/di.x,is=Ii.getZoom()*Di,Gi=Ii.getCenter();Ii.resize(di,!1),Ii.zoomTo(is,null,!0),Ii.panTo(Gi,!0)}else{var us=Ii.getBounds();Ii.resize(di,!0),Ii.fitBoundsWithConstraints(us,!0)}Z[Kr.hash].prevContainerSize=di,Z[Kr.hash].forceRedraw=!0}}var Zi=Kr.viewport.update(),ns=Kr.world.update()||Zi;Zi&&Kr.raiseEvent("viewport-change"),Kr.referenceStrip&&(ns=Kr.referenceStrip.update(Kr.viewport)||ns),!Z[Kr.hash].animating&&ns&&(Kr.raiseEvent("animation-start"),rt(Kr)),(ns||Z[Kr.hash].forceRedraw||Kr.world.needsDraw())&&(hi(Kr),Kr._drawOverlays(),Kr.navigator&&Kr.navigator.update(Kr.viewport),Z[Kr.hash].forceRedraw=!1,ns&&Kr.raiseEvent("animation")),Z[Kr.hash].animating&&!ns&&(Kr.raiseEvent("animation-finish"),Z[Kr.hash].mouseInside||Xe(Kr)),Z[Kr.hash].animating=ns}}function hi(Kr){Kr.imageLoader.clear(),Kr.drawer.clear(),Kr.world.draw(),Kr.raiseEvent("update-viewport",{})}function ri(Kr,di){return Kr?Kr+di:di}function ci(){Z[this.hash].lastZoomTime=ie.now(),Z[this.hash].zoomFactor=this.zoomPerSecond,Z[this.hash].zooming=!0,Ei(this)}function Si(){Z[this.hash].lastZoomTime=ie.now(),Z[this.hash].zoomFactor=1/this.zoomPerSecond,Z[this.hash].zooming=!0,Ei(this)}function si(){Z[this.hash].zooming=!1}function Ei(Kr){ie.requestAnimationFrame(ie.delegate(Kr,yi))}function yi(){var Kr,di,wi;Z[this.hash].zooming&&this.viewport&&(Kr=ie.now(),di=Kr-Z[this.hash].lastZoomTime,wi=Math.pow(Z[this.hash].zoomFactor,di/1e3),this.viewport.zoomBy(wi),this.viewport.applyConstraints(),Z[this.hash].lastZoomTime=Kr,Ei(this))}function Mi(){this.viewport&&(Z[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function Ci(){this.viewport&&(Z[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function Ri(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function Ni(){this.viewport&&this.viewport.goHome()}function Ai(){this.isFullPage()&&!ie.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function ki(){if(this.viewport){var Kr=this.viewport.getRotation();this.viewport.flipped?Kr=ie.positiveModulo(Kr+this.rotationIncrement,360):Kr=ie.positiveModulo(Kr-this.rotationIncrement,360),this.viewport.setRotation(Kr)}}function Yi(){if(this.viewport){var Kr=this.viewport.getRotation();this.viewport.flipped?Kr=ie.positiveModulo(Kr-this.rotationIncrement,360):Kr=ie.positiveModulo(Kr+this.rotationIncrement,360),this.viewport.setRotation(Kr)}}function Ji(){this.viewport.toggleFlip()}function ls(){var Kr=this._sequenceIndex-1;this.navPrevNextWrap&&Kr<0&&(Kr+=this.tileSources.length),this.goToPage(Kr)}function hs(){var Kr=this._sequenceIndex+1;this.navPrevNextWrap&&Kr>=this.tileSources.length&&(Kr=0),this.goToPage(Kr)}}(OpenSeadragon),function(ie){ie.Navigator=function(Ye){var Ke=Ye.viewer,Xe=this,Je,rt;Ye.id?(this.element=document.getElementById(Ye.id),Ye.controlOptions={anchor:ie.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(Ye.id="navigator-"+ie.now(),this.element=ie.makeNeutralElement("div"),Ye.controlOptions={anchor:ie.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:Ye.autoFade},Ye.position&&(Ye.position=="BOTTOM_RIGHT"?Ye.controlOptions.anchor=ie.ControlAnchor.BOTTOM_RIGHT:Ye.position=="BOTTOM_LEFT"?Ye.controlOptions.anchor=ie.ControlAnchor.BOTTOM_LEFT:Ye.position=="TOP_RIGHT"?Ye.controlOptions.anchor=ie.ControlAnchor.TOP_RIGHT:Ye.position=="TOP_LEFT"?Ye.controlOptions.anchor=ie.ControlAnchor.TOP_LEFT:Ye.position=="ABSOLUTE"&&(Ye.controlOptions.anchor=ie.ControlAnchor.ABSOLUTE,Ye.controlOptions.top=Ye.top,Ye.controlOptions.left=Ye.left,Ye.controlOptions.height=Ye.height,Ye.controlOptions.width=Ye.width))),this.element.id=Ye.id,this.element.className+=" navigator",Ye=ie.extend(!0,{sizeRatio:ie.DEFAULT_SETTINGS.navigatorSizeRatio},Ye,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:Ye.autoResize,minZoomImageRatio:1,background:Ye.background,opacity:Ye.opacity,borderColor:Ye.borderColor,displayRegionColor:Ye.displayRegionColor}),Ye.minPixelRatio=this.minPixelRatio=Ke.minPixelRatio,ie.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new ie.Point(1,1),this.totalBorderWidths=new ie.Point(this.borderWidth*2,this.borderWidth*2).minus(this.fudge),Ye.controlOptions.anchor!=ie.ControlAnchor.NONE&&function(lt,ct){lt.margin="0px",lt.border=ct+"px solid "+Ye.borderColor,lt.padding="0px",lt.background=Ye.background,lt.opacity=Ye.opacity,lt.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=ie.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(lt,ct){lt.position="relative",lt.top="0px",lt.left="0px",lt.fontSize="0px",lt.overflow="hidden",lt.border=ct+"px solid "+Ye.displayRegionColor,lt.margin="0px",lt.padding="0px",lt.background="transparent",lt.float="left",lt.cssFloat="left",lt.styleFloat="left",lt.zIndex=999999999,lt.cursor="default"}(this.displayRegion.style,this.borderWidth),this.displayRegionContainer=ie.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",Ke.addControl(this.element,Ye.controlOptions),this._resizeWithViewer=Ye.controlOptions.anchor!=ie.ControlAnchor.ABSOLUTE&&Ye.controlOptions.anchor!=ie.ControlAnchor.NONE,Ye.width&&Ye.height?(this.setWidth(Ye.width),this.setHeight(Ye.height)):this._resizeWithViewer&&(Je=ie.getElementSize(Ke.element),this.element.style.height=Math.round(Je.y*Ye.sizeRatio)+"px",this.element.style.width=Math.round(Je.x*Ye.sizeRatio)+"px",this.oldViewerSize=Je,rt=ie.getElementSize(this.element),this.elementArea=rt.x*rt.y),this.oldContainerSize=new ie.Point(0,0),ie.Viewer.apply(this,[Ye]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer);function nt(lt){ve(Xe.displayRegionContainer,lt),ve(Xe.displayRegion,-lt),Xe.viewport.setRotation(lt)}if(Ye.navigatorRotate){var it=Ye.viewer.viewport?Ye.viewer.viewport.getRotation():Ye.viewer.degrees||0;nt(it),Ye.viewer.addHandler("rotate",function(lt){nt(lt.degrees)})}this.innerTracker.destroy(),this.innerTracker=new ie.MouseTracker({element:this.element,dragHandler:ie.delegate(this,ee),clickHandler:ie.delegate(this,Z),releaseHandler:ie.delegate(this,ae),scrollHandler:ie.delegate(this,ye)}),this.addHandler("reset-size",function(){Xe.viewport&&Xe.viewport.goHome(!0)}),Ke.world.addHandler("item-index-change",function(lt){window.setTimeout(function(){var ct=Xe.world.getItemAt(lt.previousIndex);Xe.world.setItemIndex(ct,lt.newIndex)},1)}),Ke.world.addHandler("remove-item",function(lt){var ct=lt.item,ot=Xe._getMatchingItem(ct);ot&&Xe.world.removeItem(ot)}),this.update(Ke.viewport)},ie.extend(ie.Navigator.prototype,ie.EventSource.prototype,ie.Viewer.prototype,{updateSize:function(){if(this.viewport){var Ye=new ie.Point(this.container.clientWidth===0?1:this.container.clientWidth,this.container.clientHeight===0?1:this.container.clientHeight);Ye.equals(this.oldContainerSize)||(this.viewport.resize(Ye,!0),this.viewport.goHome(!0),this.oldContainerSize=Ye,this.drawer.clear(),this.world.draw())}},setWidth:function(Ye){this.width=Ye,this.element.style.width=typeof Ye=="number"?Ye+"px":Ye,this._resizeWithViewer=!1},setHeight:function(Ye){this.height=Ye,this.element.style.height=typeof Ye=="number"?Ye+"px":Ye,this._resizeWithViewer=!1},setFlip:function(Ye){return this.viewport.setFlip(Ye),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(Ye){be(this.displayRegion,Ye),be(this.canvas,Ye),be(this.element,Ye)},update:function(Ye){var Ke,Xe,Je,rt,nt,it;if(Ke=ie.getElementSize(this.viewer.element),this._resizeWithViewer&&Ke.x&&Ke.y&&!Ke.equals(this.oldViewerSize)&&(this.oldViewerSize=Ke,this.maintainSizeRatio||!this.elementArea?(Xe=Ke.x*this.sizeRatio,Je=Ke.y*this.sizeRatio):(Xe=Math.sqrt(this.elementArea*(Ke.x/Ke.y)),Je=this.elementArea/Xe),this.element.style.width=Math.round(Xe)+"px",this.element.style.height=Math.round(Je)+"px",this.elementArea||(this.elementArea=Xe*Je),this.updateSize()),Ye&&this.viewport){rt=Ye.getBoundsNoRotate(!0),nt=this.viewport.pixelFromPointNoRotate(rt.getTopLeft(),!1),it=this.viewport.pixelFromPointNoRotate(rt.getBottomRight(),!1).minus(this.totalBorderWidths);var lt=this.displayRegion.style;lt.display=this.world.getItemCount()?"block":"none",lt.top=Math.round(nt.y)+"px",lt.left=Math.round(nt.x)+"px";var ct=Math.abs(nt.x-it.x),ot=Math.abs(nt.y-it.y);lt.width=Math.round(Math.max(ct,0))+"px",lt.height=Math.round(Math.max(ot,0))+"px"}},addTiledImage:function(Ye){var Ke=this,Xe=Ye.originalTiledImage;delete Ye.original;var Je=ie.extend({},Ye,{success:function(rt){var nt=rt.item;nt._originalForNavigator=Xe,Ke._matchBounds(nt,Xe,!0);function it(){Ke._matchBounds(nt,Xe)}function lt(){Ke._matchOpacity(nt,Xe)}function ct(){Ke._matchCompositeOperation(nt,Xe)}Xe.addHandler("bounds-change",it),Xe.addHandler("clip-change",it),Xe.addHandler("opacity-change",lt),Xe.addHandler("composite-operation-change",ct)}});return ie.Viewer.prototype.addTiledImage.apply(this,[Je])},_getMatchingItem:function(Ye){for(var Ke=this.world.getItemCount(),Xe,Je=0;Je<Ke;Je++)if(Xe=this.world.getItemAt(Je),Xe._originalForNavigator===Ye)return Xe;return null},_matchBounds:function(Ye,Ke,Xe){var Je=Ke.getBoundsNoRotate();Ye.setPosition(Je.getTopLeft(),Xe),Ye.setWidth(Je.width,Xe),Ye.setRotation(Ke.getRotation(),Xe),Ye.setClip(Ke.getClip())},_matchOpacity:function(Ye,Ke){Ye.setOpacity(Ke.opacity)},_matchCompositeOperation:function(Ye,Ke){Ye.setCompositeOperation(Ke.compositeOperation)}});function Z(Ye){var Ke={tracker:Ye.eventSource,position:Ye.position,quick:Ye.quick,shift:Ye.shift,originalEvent:Ye.originalEvent,preventDefaultAction:Ye.preventDefaultAction};if(this.viewer.raiseEvent("navigator-click",Ke),!Ke.preventDefaultAction&&Ye.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(Ye.position.x=this.viewport.getContainerSize().x-Ye.position.x);var Xe=this.viewport.pointFromPixel(Ye.position);this.panVertical?this.panHorizontal||(Xe.x=this.viewer.viewport.getCenter(!0).x):Xe.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(Xe),this.viewer.viewport.applyConstraints()}}function ee(Ye){var Ke={tracker:Ye.eventSource,position:Ye.position,delta:Ye.delta,speed:Ye.speed,direction:Ye.direction,shift:Ye.shift,originalEvent:Ye.originalEvent,preventDefaultAction:Ye.preventDefaultAction};this.viewer.raiseEvent("navigator-drag",Ke),!Ke.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(Ye.delta.x=0),this.panVertical||(Ye.delta.y=0),this.viewer.viewport.flipped&&(Ye.delta.x=-Ye.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(Ye.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function ae(Ye){Ye.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function ye(Ye){return this.viewer.raiseEvent("navigator-scroll",{tracker:Ye.eventSource,position:Ye.position,scroll:Ye.scroll,shift:Ye.shift,originalEvent:Ye.originalEvent}),!1}function ve(Ye,Ke){be(Ye,"rotate("+Ke+"deg)")}function be(Ye,Ke){Ye.style.webkitTransform=Ke,Ye.style.mozTransform=Ke,Ye.style.msTransform=Ke,Ye.style.oTransform=Ke,Ye.style.transform=Ke}}(OpenSeadragon),function(ie){var Z={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};ie.extend(ie,{getString:function(ee){var ae=ee.split("."),ye=null,ve=arguments,be=Z,Ye;for(Ye=0;Ye<ae.length-1;Ye++)be=be[ae[Ye]]||{};return ye=be[ae[Ye]],typeof ye!="string"&&(ie.console.log("Untranslated source string:",ee),ye=""),ye.replace(/\{\d+\}/g,function(Ke){var Xe=parseInt(Ke.match(/\d+/),10)+1;return Xe<ve.length?ve[Xe]:""})},setString:function(ee,ae){var ye=ee.split("."),ve=Z,be;for(be=0;be<ye.length-1;be++)ve[ye[be]]||(ve[ye[be]]={}),ve=ve[ye[be]];ve[ye[be]]=ae}})}(OpenSeadragon),function(ie){ie.Point=function(Z,ee){this.x=typeof Z=="number"?Z:0,this.y=typeof ee=="number"?ee:0},ie.Point.prototype={clone:function(){return new ie.Point(this.x,this.y)},plus:function(Z){return new ie.Point(this.x+Z.x,this.y+Z.y)},minus:function(Z){return new ie.Point(this.x-Z.x,this.y-Z.y)},times:function(Z){return new ie.Point(this.x*Z,this.y*Z)},divide:function(Z){return new ie.Point(this.x/Z,this.y/Z)},negate:function(){return new ie.Point(-this.x,-this.y)},distanceTo:function(Z){return Math.sqrt(Math.pow(this.x-Z.x,2)+Math.pow(this.y-Z.y,2))},squaredDistanceTo:function(Z){return Math.pow(this.x-Z.x,2)+Math.pow(this.y-Z.y,2)},apply:function(Z){return new ie.Point(Z(this.x),Z(this.y))},equals:function(Z){return Z instanceof ie.Point&&this.x===Z.x&&this.y===Z.y},rotate:function(Z,ee){ee=ee||new ie.Point(0,0);var ae,ye;if(Z%90===0){var ve=ie.positiveModulo(Z,360);switch(ve){case 0:ae=1,ye=0;break;case 90:ae=0,ye=1;break;case 180:ae=-1,ye=0;break;case 270:ae=0,ye=-1;break}}else{var be=Z*Math.PI/180;ae=Math.cos(be),ye=Math.sin(be)}var Ye=ae*(this.x-ee.x)-ye*(this.y-ee.y)+ee.x,Ke=ye*(this.x-ee.x)+ae*(this.y-ee.y)+ee.y;return new ie.Point(Ye,Ke)},toString:function(){return"("+Math.round(this.x*100)/100+","+Math.round(this.y*100)/100+")"}}}(OpenSeadragon),function(ie){ie.TileSource=function(ee,ae,ye,ve,be,Ye){var Ke=this,Xe=arguments,Je,rt;if(ie.isPlainObject(ee)?Je=ee:Je={width:Xe[0],height:Xe[1],tileSize:Xe[2],tileOverlap:Xe[3],minLevel:Xe[4],maxLevel:Xe[5]},ie.EventSource.call(this),ie.extend(!0,this,Je),!this.success){for(rt=0;rt<arguments.length;rt++)if(ie.isFunction(arguments[rt])){this.success=arguments[rt];break}}this.success&&this.addHandler("ready",function(nt){Ke.success(nt)}),ie.type(arguments[0])=="string"&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new ie.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=Je.width&&Je.height?Je.width/Je.height:1,this.dimensions=new ie.Point(Je.width,Je.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=Je.tileOverlap?Je.tileOverlap:0,this.minLevel=Je.minLevel?Je.minLevel:0,this.maxLevel=Je.maxLevel!==void 0&&Je.maxLevel!==null?Je.maxLevel:Je.width&&Je.height?Math.ceil(Math.log(Math.max(Je.width,Je.height))/Math.log(2)):0,this.success&&ie.isFunction(this.success)&&this.success(this))},ie.TileSource.prototype={getTileSize:function(ee){return ie.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(ee){return this._tileWidth?this._tileWidth:this.getTileSize(ee)},getTileHeight:function(ee){return this._tileHeight?this._tileHeight:this.getTileSize(ee)},getLevelScale:function(ee){var ae={},ye;for(ye=0;ye<=this.maxLevel;ye++)ae[ye]=1/Math.pow(2,this.maxLevel-ye);return this.getLevelScale=function(ve){return ae[ve]},this.getLevelScale(ee)},getNumTiles:function(ee){var ae=this.getLevelScale(ee),ye=Math.ceil(ae*this.dimensions.x/this.getTileWidth(ee)),ve=Math.ceil(ae*this.dimensions.y/this.getTileHeight(ee));return new ie.Point(ye,ve)},getPixelRatio:function(ee){var ae=this.dimensions.times(this.getLevelScale(ee)),ye=1/ae.x,ve=1/ae.y;return new ie.Point(ye,ve)},getClosestLevel:function(){var ee,ae;for(ee=this.minLevel+1;ee<=this.maxLevel&&(ae=this.getNumTiles(ee),!(ae.x>1||ae.y>1));ee++);return ee-1},getTileAtPoint:function(ee,ae){var ye=ae.x>=0&&ae.x<=1&&ae.y>=0&&ae.y<=1/this.aspectRatio;ie.console.assert(ye,"[TileSource.getTileAtPoint] must be called with a valid point.");var ve=this.dimensions.x*this.getLevelScale(ee),be=ae.x*ve,Ye=ae.y*ve,Ke=Math.floor(be/this.getTileWidth(ee)),Xe=Math.floor(Ye/this.getTileHeight(ee));ae.x>=1&&(Ke=this.getNumTiles(ee).x-1);var Je=1e-15;return ae.y>=1/this.aspectRatio-Je&&(Xe=this.getNumTiles(ee).y-1),new ie.Point(Ke,Xe)},getTileBounds:function(ee,ae,ye,ve){var be=this.dimensions.times(this.getLevelScale(ee)),Ye=this.getTileWidth(ee),Ke=this.getTileHeight(ee),Xe=ae===0?0:Ye*ae-this.tileOverlap,Je=ye===0?0:Ke*ye-this.tileOverlap,rt=Ye+(ae===0?1:2)*this.tileOverlap,nt=Ke+(ye===0?1:2)*this.tileOverlap,it=1/be.x;return rt=Math.min(rt,be.x-Xe),nt=Math.min(nt,be.y-Je),ve?new ie.Rect(0,0,rt,nt):new ie.Rect(Xe*it,Je*it,rt*it,nt*it)},getImageInfo:function(ee){var ae=this,ye,ve,be,Ye,Ke,Xe,Je;ee&&(Ke=ee.split("/"),Xe=Ke[Ke.length-1],Je=Xe.lastIndexOf("."),Je>-1&&(Ke[Ke.length-1]=Xe.slice(0,Je))),ve=function(rt){typeof rt=="string"&&(rt=ie.parseXml(rt));var nt=ie.TileSource.determineType(ae,rt,ee);if(!nt){ae.raiseEvent("open-failed",{message:"Unable to load TileSource",source:ee});return}Ye=nt.prototype.configure.apply(ae,[rt,ee]),Ye.ajaxWithCredentials===void 0&&(Ye.ajaxWithCredentials=ae.ajaxWithCredentials),be=new nt(Ye),ae.ready=!0,ae.raiseEvent("ready",{tileSource:be})},ee.match(/\.js$/)?(ye=ee.split("/").pop().replace(".js",""),ie.jsonp({url:ee,async:!1,callbackName:ye,callback:ve})):ie.makeAjaxRequest({url:ee,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(rt){var nt=Z(rt);ve(nt)},error:function(rt,nt){var it;try{it="HTTP "+rt.status+" attempting to load TileSource"}catch{var lt;typeof nt>"u"||!nt.toString?lt="Unknown error":lt=nt.toString(),it=lt+" attempting to load TileSource"}ae.raiseEvent("open-failed",{message:it,source:ee})}})},supports:function(ee,ae){return!1},configure:function(ee,ae){throw new Error("Method not implemented.")},getTileUrl:function(ee,ae,ye){throw new Error("Method not implemented.")},getTileAjaxHeaders:function(ee,ae,ye){return{}},tileExists:function(ee,ae,ye){var ve=this.getNumTiles(ee);return ee>=this.minLevel&&ee<=this.maxLevel&&ae>=0&&ye>=0&&ae<ve.x&&ye<ve.y}},ie.extend(!0,ie.TileSource.prototype,ie.EventSource.prototype);function Z(ee){var ae=ee.responseText,ye=ee.status,ve,be;if(ee){if(ee.status!==200&&ee.status!==0)throw ye=ee.status,ve=ye==404?"Not Found":ee.statusText,new Error(ie.getString("Errors.Status",ye,ve))}else throw new Error(ie.getString("Errors.Security"));if(ae.match(/\s*<.*/))try{be=ee.responseXML&&ee.responseXML.documentElement?ee.responseXML:ie.parseXml(ae)}catch{be=ee.responseText}else if(ae.match(/\s*[\{\[].*/))try{be=ie.parseJSON(ae)}catch{be=ae}else be=ae;return be}ie.TileSource.determineType=function(ee,ae,ye){var ve;for(ve in OpenSeadragon)if(ve.match(/.+TileSource$/)&&ie.isFunction(OpenSeadragon[ve])&&ie.isFunction(OpenSeadragon[ve].prototype.supports)&&OpenSeadragon[ve].prototype.supports.call(ee,ae,ye))return OpenSeadragon[ve];ie.console.error("No TileSource was able to open %s %s",ye,ae)}}(OpenSeadragon),function(ie){ie.DziTileSource=function(ae,ye,ve,be,Ye,Ke,Xe,Je,rt){var nt,it,lt,ct;if(ie.isPlainObject(ae)?ct=ae:ct={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=ct.tilesUrl,this.fileFormat=ct.fileFormat,this.displayRects=ct.displayRects,this.displayRects)for(nt=this.displayRects.length-1;nt>=0;nt--)for(it=this.displayRects[nt],lt=it.minLevel;lt<=it.maxLevel;lt++)this._levelRects[lt]||(this._levelRects[lt]=[]),this._levelRects[lt].push(it);ie.TileSource.apply(this,[ct])},ie.extend(ie.DziTileSource.prototype,ie.TileSource.prototype,{supports:function(ae,ye){var ve;return ae.Image?ve=ae.Image.xmlns:ae.documentElement&&(ae.documentElement.localName=="Image"||ae.documentElement.tagName=="Image")&&(ve=ae.documentElement.namespaceURI),ve=(ve||"").toLowerCase(),ve.indexOf("schemas.microsoft.com/deepzoom/2008")!==-1||ve.indexOf("schemas.microsoft.com/deepzoom/2009")!==-1},configure:function(ae,ye){var ve;return ie.isPlainObject(ae)?ve=ee(this,ae):ve=Z(this,ae),ye&&!ve.tilesUrl&&(ve.tilesUrl=ye.replace(/([^\/]+?)(\.(dzi|xml|js)?(\?[^\/]*)?)?\/?$/,"$1_files/"),ye.search(/\.(dzi|xml|js)\?/)!=-1?ve.queryParams=ye.match(/\?.*/):ve.queryParams=""),ve},getTileUrl:function(ae,ye,ve){return[this.tilesUrl,ae,"/",ye,"_",ve,".",this.fileFormat,this.queryParams].join("")},tileExists:function(ae,ye,ve){var be=this._levelRects[ae],Ye,Ke,Xe,Je,rt,nt,it;if(this.minLevel&&ae<this.minLevel||this.maxLevel&&ae>this.maxLevel)return!1;if(!be||!be.length)return!0;for(it=be.length-1;it>=0;it--)if(Ye=be[it],!(ae<Ye.minLevel||ae>Ye.maxLevel)&&(Ke=this.getLevelScale(ae),Xe=Ye.x*Ke,Je=Ye.y*Ke,rt=Xe+Ye.width*Ke,nt=Je+Ye.height*Ke,Xe=Math.floor(Xe/this._tileWidth),Je=Math.floor(Je/this._tileWidth),rt=Math.ceil(rt/this._tileWidth),nt=Math.ceil(nt/this._tileWidth),Xe<=ye&&ye<rt&&Je<=ve&&ve<nt))return!0;return!1}});function Z(ae,ye){if(!ye||!ye.documentElement)throw new Error(ie.getString("Errors.Xml"));var ve=ye.documentElement,be=ve.localName||ve.tagName,Ye=ye.documentElement.namespaceURI,Ke=null,Xe=[],Je,rt,nt,it,lt;if(be=="Image")try{if(it=ve.getElementsByTagName("Size")[0],it===void 0&&(it=ve.getElementsByTagNameNS(Ye,"Size")[0]),Ke={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:ve.getAttribute("Url"),Format:ve.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(ve.getAttribute("Overlap"),10),TileSize:parseInt(ve.getAttribute("TileSize"),10),Size:{Height:parseInt(it.getAttribute("Height"),10),Width:parseInt(it.getAttribute("Width"),10)}}},!ie.imageFormatSupported(Ke.Image.Format))throw new Error(ie.getString("Errors.ImageFormat",Ke.Image.Format.toUpperCase()));for(Je=ve.getElementsByTagName("DisplayRect"),Je===void 0&&(Je=ve.getElementsByTagNameNS(Ye,"DisplayRect")[0]),lt=0;lt<Je.length;lt++)rt=Je[lt],nt=rt.getElementsByTagName("Rect")[0],nt===void 0&&(nt=rt.getElementsByTagNameNS(Ye,"Rect")[0]),Xe.push({Rect:{X:parseInt(nt.getAttribute("X"),10),Y:parseInt(nt.getAttribute("Y"),10),Width:parseInt(nt.getAttribute("Width"),10),Height:parseInt(nt.getAttribute("Height"),10),MinLevel:parseInt(rt.getAttribute("MinLevel"),10),MaxLevel:parseInt(rt.getAttribute("MaxLevel"),10)}});return Xe.length&&(Ke.Image.DisplayRect=Xe),ee(ae,Ke)}catch(dt){throw dt instanceof Error?dt:new Error(ie.getString("Errors.Dzi"))}else{if(be=="Collection")throw new Error(ie.getString("Errors.Dzc"));if(be=="Error"){var ct=ve.getElementsByTagName("Message")[0],ot=ct.firstChild.nodeValue;throw new Error(ot)}}throw new Error(ie.getString("Errors.Dzi"))}function ee(ae,ye){var ve=ye.Image,be=ve.Url,Ye=ve.Format,Ke=ve.Size,Xe=ve.DisplayRect||[],Je=parseInt(Ke.Width,10),rt=parseInt(Ke.Height,10),nt=parseInt(ve.TileSize,10),it=parseInt(ve.Overlap,10),lt=[],ct,ot;for(ot=0;ot<Xe.length;ot++)ct=Xe[ot].Rect,lt.push(new ie.DisplayRect(parseInt(ct.X,10),parseInt(ct.Y,10),parseInt(ct.Width,10),parseInt(ct.Height,10),parseInt(ct.MinLevel,10),parseInt(ct.MaxLevel,10)));return ie.extend(!0,{width:Je,height:rt,tileSize:nt,tileOverlap:it,minLevel:null,maxLevel:null,tilesUrl:be,fileFormat:Ye,displayRects:lt},ye)}}(OpenSeadragon),function(ie){ie.IIIFTileSource=function(ve){if(ie.extend(!0,this,ve),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(ve.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=ve.version,this.tile_width&&this.tile_height)ve.tileWidth=this.tile_width,ve.tileHeight=this.tile_height;else if(this.tile_width)ve.tileSize=this.tile_width;else if(this.tile_height)ve.tileSize=this.tile_height;else if(this.tiles)if(this.tiles.length==1)ve.tileWidth=this.tiles[0].width,ve.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var be=0;be<this.tiles.length;be++)for(var Ye=0;Ye<this.tiles[be].scaleFactors.length;Ye++){var Ke=this.tiles[be].scaleFactors[Ye];this.scale_factors.push(Ke),ve.tileSizePerScaleFactor[Ke]={width:this.tiles[be].width,height:this.tiles[be].height||this.tiles[be].width}}}else if(Z(ve)){for(var Xe=Math.min(this.height,this.width),Je=[256,512,1024],rt=[],nt=0;nt<Je.length;nt++)Je[nt]<=Xe&&rt.push(Je[nt]);rt.length>0?ve.tileSize=Math.max.apply(null,rt):ve.tileSize=Xe}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,ve.levels=ee(this),ie.extend(!0,ve,{width:ve.levels[ve.levels.length-1].width,height:ve.levels[ve.levels.length-1].height,tileSize:Math.max(ve.height,ve.width),tileOverlap:0,minLevel:0,maxLevel:ve.levels.length-1}),this.levels=ve.levels):ie.console.error("Nothing in the info.json to construct image pyramids from");if(!ve.maxLevel&&!this.emulateLegacyImagePyramid)if(!this.scale_factors)ve.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)));else{var it=Math.max.apply(null,this.scale_factors);ve.maxLevel=Math.round(Math.log(it)*Math.LOG2E)}ie.TileSource.apply(this,[ve])},ie.extend(ie.IIIFTileSource.prototype,ie.TileSource.prototype,{supports:function(ve,be){return ve.protocol&&ve.protocol=="http://iiif.io/api/image"||ve["@context"]&&(ve["@context"]=="http://library.stanford.edu/iiif/image-api/1.1/context.json"||ve["@context"]=="http://iiif.io/api/image/1/context.json")||ve.profile&&ve.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")===0||ve.identifier&&ve.width&&ve.height?!0:!!(ve.documentElement&&ve.documentElement.tagName=="info"&&ve.documentElement.namespaceURI=="http://library.stanford.edu/iiif/image-api/ns/")},configure:function(ve,be){if(ie.isPlainObject(ve)){if(!ve["@context"])ve["@context"]="http://iiif.io/api/image/1.0/context.json",ve["@id"]=be.replace("/info.json",""),ve.version=1;else{var Ye=ve["@context"];if(Array.isArray(Ye)){for(var Ke=0;Ke<Ye.length;Ke++)if(typeof Ye[Ke]=="string"&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(Ye[Ke])||Ye[Ke]==="http://library.stanford.edu/iiif/image-api/1.1/context.json")){Ye=Ye[Ke];break}}switch(Ye){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":ve.version=1;break;case"http://iiif.io/api/image/2/context.json":ve.version=2;break;case"http://iiif.io/api/image/3/context.json":ve.version=3;break;default:ie.console.error("Data has a @context property which contains no known IIIF context URI.")}}if(!ve["@id"]&&ve.id&&(ve["@id"]=ve.id),ve.preferredFormats){for(var Xe=0;Xe<ve.preferredFormats.length;Xe++)if(OpenSeadragon.imageFormatSupported(ve.preferredFormats[Xe])){ve.tileFormat=ve.preferredFormats[Xe];break}}return ve}else{var Je=ae(ve);return Je["@context"]="http://iiif.io/api/image/1.0/context.json",Je["@id"]=be.replace("/info.xml",""),Je.version=1,Je}},getTileWidth:function(ve){if(this.emulateLegacyImagePyramid)return ie.TileSource.prototype.getTileWidth.call(this,ve);var be=Math.pow(2,this.maxLevel-ve);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[be]?this.tileSizePerScaleFactor[be].width:this._tileWidth},getTileHeight:function(ve){if(this.emulateLegacyImagePyramid)return ie.TileSource.prototype.getTileHeight.call(this,ve);var be=Math.pow(2,this.maxLevel-ve);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[be]?this.tileSizePerScaleFactor[be].height:this._tileHeight},getLevelScale:function(ve){if(this.emulateLegacyImagePyramid){var be=NaN;return this.levels.length>0&&ve>=this.minLevel&&ve<=this.maxLevel&&(be=this.levels[ve].width/this.levels[this.maxLevel].width),be}return ie.TileSource.prototype.getLevelScale.call(this,ve)},getNumTiles:function(ve){if(this.emulateLegacyImagePyramid){var be=this.getLevelScale(ve);return be?new ie.Point(1,1):new ie.Point(0,0)}return ie.TileSource.prototype.getNumTiles.call(this,ve)},getTileAtPoint:function(ve,be){return this.emulateLegacyImagePyramid?new ie.Point(0,0):ie.TileSource.prototype.getTileAtPoint.call(this,ve,be)},getTileUrl:function(ve,be,Ye){if(this.emulateLegacyImagePyramid){var Ke=null;return this.levels.length>0&&ve>=this.minLevel&&ve<=this.maxLevel&&(Ke=this.levels[ve].url),Ke}var Xe="0",Je=Math.pow(.5,this.maxLevel-ve),rt=Math.ceil(this.width*Je),nt=Math.ceil(this.height*Je),it,lt,ct,ot,dt,ft,gt,mt,Yr,Qr,Xr,Jr,ai,oi;return it=this.getTileWidth(ve),lt=this.getTileHeight(ve),ct=Math.ceil(it/Je),ot=Math.ceil(lt/Je),this.version===1?ai="native."+this.tileFormat:ai="default."+this.tileFormat,rt<it&&nt<lt?(this.version===2&&rt===this.width||this.version===3&&rt===this.width&&nt===this.height?Qr="max":this.version===3?Qr=rt+","+nt:Qr=rt+",",dt="full"):(ft=be*ct,gt=Ye*ot,mt=Math.min(ct,this.width-ft),Yr=Math.min(ot,this.height-gt),be===0&&Ye===0&&mt===this.width&&Yr===this.height?dt="full":dt=[ft,gt,mt,Yr].join(","),Xr=Math.ceil(mt*Je),Jr=Math.ceil(Yr*Je),this.version===2&&Xr===this.width||this.version===3&&Xr===this.width&&Jr===this.height?Qr="max":this.version===3?Qr=Xr+","+Jr:Qr=Xr+","),oi=[this["@id"],dt,Qr,Xe,ai].join("/"),oi},__testonly__:{canBeTiled:Z,constructLevels:ee}});function Z(ve){var be=["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"],Ye=Array.isArray(ve.profile)?ve.profile[0]:ve.profile,Ke=be.indexOf(Ye)!==-1,Xe=!1;return ve.version===2&&ve.profile.length>1&&ve.profile[1].supports&&(Xe=ve.profile[1].supports.indexOf("sizeByW")!==-1),ve.version===3&&ve.extraFeatures&&(Xe=ve.extraFeatures.indexOf("sizeByWh")!==-1),!Ke||Xe}function ee(ve){for(var be=[],Ye=0;Ye<ve.sizes.length;Ye++)be.push({url:ve["@id"]+"/full/"+ve.sizes[Ye].width+","+(ve.version===3?ve.sizes[Ye].height:"")+"/0/default."+ve.tileFormat,width:ve.sizes[Ye].width,height:ve.sizes[Ye].height});return be.sort(function(Ke,Xe){return Ke.width-Xe.width})}function ae(ve){if(!ve||!ve.documentElement)throw new Error(ie.getString("Errors.Xml"));var be=ve.documentElement,Ye=be.tagName,Ke=null;if(Ye=="info")try{return Ke={},ye(be,Ke),Ke}catch(Xe){throw Xe instanceof Error?Xe:new Error(ie.getString("Errors.IIIF"))}throw new Error(ie.getString("Errors.IIIF"))}function ye(ve,be,Ye){var Ke,Xe;if(ve.nodeType==3&&Ye)Xe=ve.nodeValue.trim(),Xe.match(/^\d*$/)&&(Xe=Number(Xe)),be[Ye]?(ie.isArray(be[Ye])||(be[Ye]=[be[Ye]]),be[Ye].push(Xe)):be[Ye]=Xe;else if(ve.nodeType==1)for(Ke=0;Ke<ve.childNodes.length;Ke++)ye(ve.childNodes[Ke],be,ve.nodeName)}}(OpenSeadragon),function(ie){ie.OsmTileSource=function(Z,ee,ae,ye,ve){var be;ie.isPlainObject(Z)?be=Z:be={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},(!be.width||!be.height)&&(be.width=65572864,be.height=65572864),be.tileSize||(be.tileSize=256,be.tileOverlap=0),be.tilesUrl||(be.tilesUrl="http://tile.openstreetmap.org/"),be.minLevel=8,ie.TileSource.apply(this,[be])},ie.extend(ie.OsmTileSource.prototype,ie.TileSource.prototype,{supports:function(Z,ee){return Z.type&&Z.type=="openstreetmaps"},configure:function(Z,ee){return Z},getTileUrl:function(Z,ee,ae){return this.tilesUrl+(Z-8)+"/"+ee+"/"+ae+".png"}})}(OpenSeadragon),function(ie){ie.TmsTileSource=function(Z,ee,ae,ye,ve){var be;ie.isPlainObject(Z)?be=Z:be={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var Ye=Math.ceil(be.width/256)*256,Ke=Math.ceil(be.height/256)*256,Xe;Ye>Ke?Xe=Ye/256:Xe=Ke/256,be.maxLevel=Math.ceil(Math.log(Xe)/Math.log(2))-1,be.tileSize=256,be.width=Ye,be.height=Ke,ie.TileSource.apply(this,[be])},ie.extend(ie.TmsTileSource.prototype,ie.TileSource.prototype,{supports:function(Z,ee){return Z.type&&Z.type=="tiledmapservice"},configure:function(Z,ee){return Z},getTileUrl:function(Z,ee,ae){var ye=this.getNumTiles(Z).y-1;return this.tilesUrl+Z+"/"+ee+"/"+(ye-ae)+".png"}})}(OpenSeadragon),function(ie){ie.ZoomifyTileSource=function(Z){Z.tileSize=256;var ee={x:Z.width,y:Z.height};for(Z.imageSizes=[{x:Z.width,y:Z.height}],Z.gridSize=[this._getGridSize(Z.width,Z.height,Z.tileSize)];parseInt(ee.x,10)>Z.tileSize||parseInt(ee.y,10)>Z.tileSize;)ee.x=Math.floor(ee.x/2),ee.y=Math.floor(ee.y/2),Z.imageSizes.push({x:ee.x,y:ee.y}),Z.gridSize.push(this._getGridSize(ee.x,ee.y,Z.tileSize));Z.imageSizes.reverse(),Z.gridSize.reverse(),Z.minLevel=0,Z.maxLevel=Z.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[Z])},ie.extend(ie.ZoomifyTileSource.prototype,ie.TileSource.prototype,{_getGridSize:function(Z,ee,ae){return{x:Math.ceil(Z/ae),y:Math.ceil(ee/ae)}},_calculateAbsoluteTileNumber:function(Z,ee,ae){for(var ye=0,ve={},be=0;be<Z;be++)ve=this.gridSize[be],ye+=ve.x*ve.y;return ve=this.gridSize[Z],ye+=ve.x*ae+ee,ye},supports:function(Z,ee){return Z.type&&Z.type=="zoomifytileservice"},configure:function(Z,ee){return Z},getTileUrl:function(Z,ee,ae){var ye=0,ve=this._calculateAbsoluteTileNumber(Z,ee,ae);return ye=Math.floor(ve/256),this.tilesUrl+"TileGroup"+ye+"/"+Z+"-"+ee+"-"+ae+".jpg"}})}(OpenSeadragon),function(ie){ie.LegacyTileSource=function(ye){var ve,be,Ye;ie.isArray(ye)&&(ve={type:"legacy-image-pyramid",levels:ye}),ve.levels=Z(ve.levels),ve.levels.length>0?(be=ve.levels[ve.levels.length-1].width,Ye=ve.levels[ve.levels.length-1].height):(be=0,Ye=0,ie.console.error("No supported image formats found")),ie.extend(!0,ve,{width:be,height:Ye,tileSize:Math.max(Ye,be),tileOverlap:0,minLevel:0,maxLevel:ve.levels.length>0?ve.levels.length-1:0}),ie.TileSource.apply(this,[ve]),this.levels=ve.levels},ie.extend(ie.LegacyTileSource.prototype,ie.TileSource.prototype,{supports:function(ye,ve){return ye.type&&ye.type=="legacy-image-pyramid"||ye.documentElement&&ye.documentElement.getAttribute("type")=="legacy-image-pyramid"},configure:function(ye,ve){var be;return ie.isPlainObject(ye)?be=ae(this,ye):be=ee(this,ye),be},getLevelScale:function(ye){var ve=NaN;return this.levels.length>0&&ye>=this.minLevel&&ye<=this.maxLevel&&(ve=this.levels[ye].width/this.levels[this.maxLevel].width),ve},getNumTiles:function(ye){var ve=this.getLevelScale(ye);return ve?new ie.Point(1,1):new ie.Point(0,0)},getTileUrl:function(ye,ve,be){var Ye=null;return this.levels.length>0&&ye>=this.minLevel&&ye<=this.maxLevel&&(Ye=this.levels[ye].url),Ye}});function Z(ye){var ve=[],be,Ye;for(Ye=0;Ye<ye.length;Ye++)be=ye[Ye],be.height&&be.width&&be.url?ve.push({url:be.url,width:Number(be.width),height:Number(be.height)}):ie.console.error("Unsupported image format: %s",be.url?be.url:"<no URL>");return ve.sort(function(Ke,Xe){return Ke.height-Xe.height})}function ee(ye,ve){if(!ve||!ve.documentElement)throw new Error(ie.getString("Errors.Xml"));var be=ve.documentElement,Ye=be.tagName,Ke=null,Xe=[],Je,rt;if(Ye=="image")try{for(Ke={type:be.getAttribute("type"),levels:[]},Xe=be.getElementsByTagName("level"),rt=0;rt<Xe.length;rt++)Je=Xe[rt],Ke.levels.push({url:Je.getAttribute("url"),width:parseInt(Je.getAttribute("width"),10),height:parseInt(Je.getAttribute("height"),10)});return ae(ye,Ke)}catch(nt){throw nt instanceof Error?nt:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if(Ye=="collection")throw new Error("Legacy Image Pyramid Collections not yet supported.");if(Ye=="error")throw new Error("Error: "+ve)}throw new Error("Unknown element "+Ye)}function ae(ye,ve){return ve.levels}}(OpenSeadragon),function(ie){ie.ImageTileSource=function(Z){Z=ie.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},Z),ie.TileSource.apply(this,[Z])},ie.extend(ie.ImageTileSource.prototype,ie.TileSource.prototype,{supports:function(Z,ee){return Z.type&&Z.type==="image"},configure:function(Z,ee){return Z},getImageInfo:function(Z){var ee=this._image=new Image,ae=this;this.crossOriginPolicy&&(ee.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(ee.useCredentials=this.ajaxWithCredentials),ie.addEvent(ee,"load",function(){ae.width=Object.prototype.hasOwnProperty.call(ee,"naturalWidth")?ee.naturalWidth:ee.width,ae.height=Object.prototype.hasOwnProperty.call(ee,"naturalHeight")?ee.naturalHeight:ee.height,ae.aspectRatio=ae.width/ae.height,ae.dimensions=new ie.Point(ae.width,ae.height),ae._tileWidth=ae.width,ae._tileHeight=ae.height,ae.tileOverlap=0,ae.minLevel=0,ae.levels=ae._buildLevels(),ae.maxLevel=ae.levels.length-1,ae.ready=!0,ae.raiseEvent("ready",{tileSource:ae})}),ie.addEvent(ee,"error",function(){ae.raiseEvent("open-failed",{message:"Error loading image at "+Z,source:Z})}),ee.src=Z},getLevelScale:function(Z){var ee=NaN;return Z>=this.minLevel&&Z<=this.maxLevel&&(ee=this.levels[Z].width/this.levels[this.maxLevel].width),ee},getNumTiles:function(Z){var ee=this.getLevelScale(Z);return ee?new ie.Point(1,1):new ie.Point(0,0)},getTileUrl:function(Z,ee,ae){var ye=null;return Z>=this.minLevel&&Z<=this.maxLevel&&(ye=this.levels[Z].url),ye},getContext2D:function(Z,ee,ae){var ye=null;return Z>=this.minLevel&&Z<=this.maxLevel&&(ye=this.levels[Z].context2D),ye},_buildLevels:function(){var Z=[{url:this._image.src,width:Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,height:Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height}];if(!this.buildPyramid||!ie.supportsCanvas||!this.useCanvas)return delete this._image,Z;var ee=Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,ae=Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height,ye=document.createElement("canvas"),ve=ye.getContext("2d");if(ye.width=ee,ye.height=ae,ve.drawImage(this._image,0,0,ee,ae),Z[0].context2D=ve,delete this._image,ie.isCanvasTainted(ye))return Z;for(;ee>=2&&ae>=2;){ee=Math.floor(ee/2),ae=Math.floor(ae/2);var be=document.createElement("canvas"),Ye=be.getContext("2d");be.width=ee,be.height=ae,Ye.drawImage(ye,0,0,ee,ae),Z.splice(0,0,{context2D:Ye,width:ee,height:ae}),ye=be,ve=Ye}return Z}})}(OpenSeadragon),function(ie){ie.TileSourceCollection=function(Z,ee,ae,ye){ie.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon),function(ie){ie.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},ie.Button=function(Ye){var Ke=this;ie.EventSource.call(this),ie.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:ie.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:ie.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},Ye),this.element=Ye.element||ie.makeNeutralElement("div"),Ye.element||(this.imgRest=ie.makeTransparentImage(this.srcRest),this.imgGroup=ie.makeTransparentImage(this.srcGroup),this.imgHover=ie.makeTransparentImage(this.srcHover),this.imgDown=ie.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,this.element.style.position="relative",ie.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",ie.Browser.vendor==ie.BROWSERS.FIREFOX&&ie.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=ie.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new ie.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(Xe){Xe.insideElementPressed?(ve(Ke,ie.ButtonState.DOWN),Ke.raiseEvent("enter",{originalEvent:Xe.originalEvent})):Xe.buttonDownAny||ve(Ke,ie.ButtonState.HOVER)},focusHandler:function(Xe){this.enterHandler(Xe),Ke.raiseEvent("focus",{originalEvent:Xe.originalEvent})},exitHandler:function(Xe){be(Ke,ie.ButtonState.GROUP),Xe.insideElementPressed&&Ke.raiseEvent("exit",{originalEvent:Xe.originalEvent})},blurHandler:function(Xe){this.exitHandler(Xe),Ke.raiseEvent("blur",{originalEvent:Xe.originalEvent})},pressHandler:function(Xe){ve(Ke,ie.ButtonState.DOWN),Ke.raiseEvent("press",{originalEvent:Xe.originalEvent})},releaseHandler:function(Xe){Xe.insideElementPressed&&Xe.insideElementReleased?(be(Ke,ie.ButtonState.HOVER),Ke.raiseEvent("release",{originalEvent:Xe.originalEvent})):Xe.insideElementPressed?be(Ke,ie.ButtonState.GROUP):ve(Ke,ie.ButtonState.HOVER)},clickHandler:function(Xe){Xe.quick&&Ke.raiseEvent("click",{originalEvent:Xe.originalEvent})},keyHandler:function(Xe){return Xe.keyCode===13?(Ke.raiseEvent("click",{originalEvent:Xe.originalEvent}),Ke.raiseEvent("release",{originalEvent:Xe.originalEvent}),!1):!0}}),be(this,ie.ButtonState.REST)},ie.extend(ie.Button.prototype,ie.EventSource.prototype,{notifyGroupEnter:function(){ve(this,ie.ButtonState.GROUP)},notifyGroupExit:function(){be(this,ie.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,ie.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,ie.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}});function Z(Ye){ie.requestAnimationFrame(function(){ee(Ye)})}function ee(Ye){var Ke,Xe,Je;Ye.shouldFade&&(Ke=ie.now(),Xe=Ke-Ye.fadeBeginTime,Je=1-Xe/Ye.fadeLength,Je=Math.min(1,Je),Je=Math.max(0,Je),Ye.imgGroup&&ie.setElementOpacity(Ye.imgGroup,Je,!0),Je>0&&Z(Ye))}function ae(Ye){Ye.shouldFade=!0,Ye.fadeBeginTime=ie.now()+Ye.fadeDelay,window.setTimeout(function(){Z(Ye)},Ye.fadeDelay)}function ye(Ye){Ye.shouldFade=!1,Ye.imgGroup&&ie.setElementOpacity(Ye.imgGroup,1,!0)}function ve(Ye,Ke){Ye.element.disabled||(Ke>=ie.ButtonState.GROUP&&Ye.currentState==ie.ButtonState.REST&&(ye(Ye),Ye.currentState=ie.ButtonState.GROUP),Ke>=ie.ButtonState.HOVER&&Ye.currentState==ie.ButtonState.GROUP&&(Ye.imgHover&&(Ye.imgHover.style.visibility=""),Ye.currentState=ie.ButtonState.HOVER),Ke>=ie.ButtonState.DOWN&&Ye.currentState==ie.ButtonState.HOVER&&(Ye.imgDown&&(Ye.imgDown.style.visibility=""),Ye.currentState=ie.ButtonState.DOWN))}function be(Ye,Ke){Ye.element.disabled||(Ke<=ie.ButtonState.HOVER&&Ye.currentState==ie.ButtonState.DOWN&&(Ye.imgDown&&(Ye.imgDown.style.visibility="hidden"),Ye.currentState=ie.ButtonState.HOVER),Ke<=ie.ButtonState.GROUP&&Ye.currentState==ie.ButtonState.HOVER&&(Ye.imgHover&&(Ye.imgHover.style.visibility="hidden"),Ye.currentState=ie.ButtonState.GROUP),Ke<=ie.ButtonState.REST&&Ye.currentState==ie.ButtonState.GROUP&&(ae(Ye),Ye.currentState=ie.ButtonState.REST))}}(OpenSeadragon),function(ie){ie.ButtonGroup=function(Z){ie.extend(!0,this,{buttons:[],clickTimeThreshold:ie.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:ie.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},Z);var ee=this.buttons.concat([]),ae=this,ye;if(this.element=Z.element||ie.makeNeutralElement("div"),!Z.group)for(this.element.style.display="inline-block",ye=0;ye<ee.length;ye++)this.element.appendChild(ee[ye].element);ie.setElementTouchActionNone(this.element),this.tracker=new ie.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(ve){var be;for(be=0;be<ae.buttons.length;be++)ae.buttons[be].notifyGroupEnter()},exitHandler:function(ve){var be;if(!ve.insideElementPressed)for(be=0;be<ae.buttons.length;be++)ae.buttons[be].notifyGroupExit()}})},ie.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}}(OpenSeadragon),function(ie){ie.Rect=function(Z,ee,ae,ye,ve){this.x=typeof Z=="number"?Z:0,this.y=typeof ee=="number"?ee:0,this.width=typeof ae=="number"?ae:0,this.height=typeof ye=="number"?ye:0,this.degrees=typeof ve=="number"?ve:0,this.degrees=ie.positiveModulo(this.degrees,360);var be,Ye;this.degrees>=270?(be=this.getTopRight(),this.x=be.x,this.y=be.y,Ye=this.height,this.height=this.width,this.width=Ye,this.degrees-=270):this.degrees>=180?(be=this.getBottomRight(),this.x=be.x,this.y=be.y,this.degrees-=180):this.degrees>=90&&(be=this.getBottomLeft(),this.x=be.x,this.y=be.y,Ye=this.height,this.height=this.width,this.width=Ye,this.degrees-=90)},ie.Rect.fromSummits=function(Z,ee,ae){var ye=Z.distanceTo(ee),ve=Z.distanceTo(ae),be=ee.minus(Z),Ye=Math.atan(be.y/be.x);return be.x<0?Ye+=Math.PI:be.y<0&&(Ye+=2*Math.PI),new ie.Rect(Z.x,Z.y,ye,ve,Ye/Math.PI*180)},ie.Rect.prototype={clone:function(){return new ie.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new ie.Point(this.x,this.y)},getBottomRight:function(){return new ie.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new ie.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new ie.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new ie.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new ie.Point(this.width,this.height)},equals:function(Z){return Z instanceof ie.Rect&&this.x===Z.x&&this.y===Z.y&&this.width===Z.width&&this.height===Z.height&&this.degrees===Z.degrees},times:function(Z){return new ie.Rect(this.x*Z,this.y*Z,this.width*Z,this.height*Z,this.degrees)},translate:function(Z){return new ie.Rect(this.x+Z.x,this.y+Z.y,this.width,this.height,this.degrees)},union:function(Z){var ee=this.getBoundingBox(),ae=Z.getBoundingBox(),ye=Math.min(ee.x,ae.x),ve=Math.min(ee.y,ae.y),be=Math.max(ee.x+ee.width,ae.x+ae.width),Ye=Math.max(ee.y+ee.height,ae.y+ae.height);return new ie.Rect(ye,ve,be-ye,Ye-ve)},intersection:function(Z){var ee=1e-10,ae=[],ye=this.getTopLeft();Z.containsPoint(ye,ee)&&ae.push(ye);var ve=this.getTopRight();Z.containsPoint(ve,ee)&&ae.push(ve);var be=this.getBottomLeft();Z.containsPoint(be,ee)&&ae.push(be);var Ye=this.getBottomRight();Z.containsPoint(Ye,ee)&&ae.push(Ye);var Ke=Z.getTopLeft();this.containsPoint(Ke,ee)&&ae.push(Ke);var Xe=Z.getTopRight();this.containsPoint(Xe,ee)&&ae.push(Xe);var Je=Z.getBottomLeft();this.containsPoint(Je,ee)&&ae.push(Je);var rt=Z.getBottomRight();this.containsPoint(rt,ee)&&ae.push(rt);for(var nt=this._getSegments(),it=Z._getSegments(),lt=0;lt<nt.length;lt++)for(var ct=nt[lt],ot=0;ot<it.length;ot++){var dt=it[ot],ft=gt(ct[0],ct[1],dt[0],dt[1]);ft&&ae.push(ft)}function gt(oi,ni,li,ui){var mi=ni.minus(oi),ii=ui.minus(li),hi=-ii.x*mi.y+mi.x*ii.y;if(hi===0)return null;var ri=(mi.x*(oi.y-li.y)-mi.y*(oi.x-li.x))/hi,ci=(ii.x*(oi.y-li.y)-ii.y*(oi.x-li.x))/hi;return-ee<=ri&&ri<=1-ee&&-ee<=ci&&ci<=1-ee?new ie.Point(oi.x+ci*mi.x,oi.y+ci*mi.y):null}if(ae.length===0)return null;for(var mt=ae[0].x,Yr=ae[0].x,Qr=ae[0].y,Xr=ae[0].y,Jr=1;Jr<ae.length;Jr++){var ai=ae[Jr];ai.x<mt&&(mt=ai.x),ai.x>Yr&&(Yr=ai.x),ai.y<Qr&&(Qr=ai.y),ai.y>Xr&&(Xr=ai.y)}return new ie.Rect(mt,Qr,Yr-mt,Xr-Qr)},_getSegments:function(){var Z=this.getTopLeft(),ee=this.getTopRight(),ae=this.getBottomLeft(),ye=this.getBottomRight();return[[Z,ee],[ee,ye],[ye,ae],[ae,Z]]},rotate:function(Z,ee){if(Z=ie.positiveModulo(Z,360),Z===0)return this.clone();ee=ee||this.getCenter();var ae=this.getTopLeft().rotate(Z,ee),ye=this.getTopRight().rotate(Z,ee),ve=ye.minus(ae);ve=ve.apply(function(Ye){var Ke=1e-15;return Math.abs(Ye)<Ke?0:Ye});var be=Math.atan(ve.y/ve.x);return ve.x<0?be+=Math.PI:ve.y<0&&(be+=2*Math.PI),new ie.Rect(ae.x,ae.y,this.width,this.height,be/Math.PI*180)},getBoundingBox:function(){if(this.degrees===0)return this.clone();var Z=this.getTopLeft(),ee=this.getTopRight(),ae=this.getBottomLeft(),ye=this.getBottomRight(),ve=Math.min(Z.x,ee.x,ae.x,ye.x),be=Math.max(Z.x,ee.x,ae.x,ye.x),Ye=Math.min(Z.y,ee.y,ae.y,ye.y),Ke=Math.max(Z.y,ee.y,ae.y,ye.y);return new ie.Rect(ve,Ye,be-ve,Ke-Ye)},getIntegerBoundingBox:function(){var Z=this.getBoundingBox(),ee=Math.floor(Z.x),ae=Math.floor(Z.y),ye=Math.ceil(Z.width+Z.x-ee),ve=Math.ceil(Z.height+Z.y-ae);return new ie.Rect(ee,ae,ye,ve)},containsPoint:function(Z,ee){ee=ee||0;var ae=this.getTopLeft(),ye=this.getTopRight(),ve=this.getBottomLeft(),be=ye.minus(ae),Ye=ve.minus(ae);return(Z.x-ae.x)*be.x+(Z.y-ae.y)*be.y>=-ee&&(Z.x-ye.x)*be.x+(Z.y-ye.y)*be.y<=ee&&(Z.x-ae.x)*Ye.x+(Z.y-ae.y)*Ye.y>=-ee&&(Z.x-ve.x)*Ye.x+(Z.y-ve.y)*Ye.y<=ee},toString:function(){return"["+Math.round(this.x*100)/100+", "+Math.round(this.y*100)/100+", "+Math.round(this.width*100)/100+"x"+Math.round(this.height*100)/100+", "+Math.round(this.degrees*100)/100+"deg]"}}}(OpenSeadragon),function(ie){var Z={};ie.ReferenceStrip=function(Xe){var Je=this,rt=Xe.viewer,nt=ie.getElementSize(rt.element),it,lt,ct;for(Xe.id||(Xe.id="referencestrip-"+ie.now(),this.element=ie.makeNeutralElement("div"),this.element.id=Xe.id,this.element.className="referencestrip"),Xe=ie.extend(!0,{sizeRatio:ie.DEFAULT_SETTINGS.referenceStripSizeRatio,position:ie.DEFAULT_SETTINGS.referenceStripPosition,scroll:ie.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:ie.DEFAULT_SETTINGS.clickTimeThreshold},Xe,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),ie.extend(this,Xe),Z[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,lt=this.element.style,lt.marginTop="0px",lt.marginRight="0px",lt.marginBottom="0px",lt.marginLeft="0px",lt.left="0px",lt.bottom="0px",lt.border="0px",lt.background="#000",lt.position="relative",ie.setElementTouchActionNone(this.element),ie.setElementOpacity(this.element,.8),this.viewer=rt,this.innerTracker=new ie.MouseTracker({element:this.element,dragHandler:ie.delegate(this,ee),scrollHandler:ie.delegate(this,ae),enterHandler:ie.delegate(this,ve),exitHandler:ie.delegate(this,be),keyDownHandler:ie.delegate(this,Ye),keyHandler:ie.delegate(this,Ke)}),Xe.width&&Xe.height?(this.element.style.width=Xe.width+"px",this.element.style.height=Xe.height+"px",rt.addControl(this.element,{anchor:ie.ControlAnchor.BOTTOM_LEFT})):Xe.scroll=="horizontal"?(this.element.style.width=nt.x*Xe.sizeRatio*rt.tileSources.length+12*rt.tileSources.length+"px",this.element.style.height=nt.y*Xe.sizeRatio+"px",rt.addControl(this.element,{anchor:ie.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=nt.y*Xe.sizeRatio*rt.tileSources.length+12*rt.tileSources.length+"px",this.element.style.width=nt.x*Xe.sizeRatio+"px",rt.addControl(this.element,{anchor:ie.ControlAnchor.TOP_LEFT})),this.panelWidth=nt.x*this.sizeRatio+8,this.panelHeight=nt.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},ct=0;ct<rt.tileSources.length;ct++)it=ie.makeNeutralElement("div"),it.id=this.element.id+"-"+ct,it.style.width=Je.panelWidth+"px",it.style.height=Je.panelHeight+"px",it.style.display="inline",it.style.float="left",it.style.cssFloat="left",it.style.styleFloat="left",it.style.padding="2px",ie.setElementTouchActionNone(it),it.innerTracker=new ie.MouseTracker({element:it,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(ot){ot.eventSource.dragging=ie.now()},releaseHandler:function(ot){var dt=ot.eventSource,ft=dt.element.id,gt=Number(ft.split("-")[2]),mt=ie.now();ot.insideElementPressed&&ot.insideElementReleased&&dt.dragging&&mt-dt.dragging<dt.clickTimeThreshold&&(dt.dragging=null,rt.goToPage(gt))}}),this.element.appendChild(it),it.activePanel=!1,this.panels.push(it);ye(this,this.scroll=="vertical"?nt.y:nt.x,0),this.setFocus(0)},ie.extend(ie.ReferenceStrip.prototype,ie.EventSource.prototype,ie.Viewer.prototype,{setFocus:function(Xe){var Je=this.element.querySelector("#"+this.element.id+"-"+Xe),rt=ie.getElementSize(this.viewer.canvas),nt=Number(this.element.style.width.replace("px","")),it=Number(this.element.style.height.replace("px","")),lt=-Number(this.element.style.marginLeft.replace("px","")),ct=-Number(this.element.style.marginTop.replace("px","")),ot;this.currentSelected!==Je&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=Je,this.currentSelected.style.background="#999",this.scroll=="horizontal"?(ot=Number(Xe)*(this.panelWidth+3),ot>lt+rt.x-this.panelWidth?(ot=Math.min(ot,nt-rt.x),this.element.style.marginLeft=-ot+"px",ye(this,rt.x,-ot)):ot<lt&&(ot=Math.max(0,ot-rt.x/2),this.element.style.marginLeft=-ot+"px",ye(this,rt.x,-ot))):(ot=Number(Xe)*(this.panelHeight+3),ot>ct+rt.y-this.panelHeight?(ot=Math.min(ot,it-rt.y),this.element.style.marginTop=-ot+"px",ye(this,rt.y,-ot)):ot<ct&&(ot=Math.max(0,ot-rt.y/2),this.element.style.marginTop=-ot+"px",ye(this,rt.y,-ot))),this.currentPage=Xe,ve.call(this,{eventSource:this.innerTracker}))},update:function(){return Z[this.id].animating?(ie.console.log("image reference strip update"),!0):!1},destroy:function(){if(this.miniViewers)for(var Xe in this.miniViewers)this.miniViewers[Xe].destroy();this.element&&this.element.parentNode.removeChild(this.element)}});function ee(Xe){var Je=Number(this.element.style.marginLeft.replace("px","")),rt=Number(this.element.style.marginTop.replace("px","")),nt=Number(this.element.style.width.replace("px","")),it=Number(this.element.style.height.replace("px","")),lt=ie.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&(this.scroll=="horizontal"?-Xe.delta.x>0?Je>-(nt-lt.x)&&(this.element.style.marginLeft=Je+Xe.delta.x*2+"px",ye(this,lt.x,Je+Xe.delta.x*2)):-Xe.delta.x<0&&Je<0&&(this.element.style.marginLeft=Je+Xe.delta.x*2+"px",ye(this,lt.x,Je+Xe.delta.x*2)):-Xe.delta.y>0?rt>-(it-lt.y)&&(this.element.style.marginTop=rt+Xe.delta.y*2+"px",ye(this,lt.y,rt+Xe.delta.y*2)):-Xe.delta.y<0&&rt<0&&(this.element.style.marginTop=rt+Xe.delta.y*2+"px",ye(this,lt.y,rt+Xe.delta.y*2))),!1}function ae(Xe){var Je=Number(this.element.style.marginLeft.replace("px","")),rt=Number(this.element.style.marginTop.replace("px","")),nt=Number(this.element.style.width.replace("px","")),it=Number(this.element.style.height.replace("px","")),lt=ie.getElementSize(this.viewer.canvas);return this.element&&(this.scroll=="horizontal"?Xe.scroll>0?Je>-(nt-lt.x)&&(this.element.style.marginLeft=Je-Xe.scroll*60+"px",ye(this,lt.x,Je-Xe.scroll*60)):Xe.scroll<0&&Je<0&&(this.element.style.marginLeft=Je-Xe.scroll*60+"px",ye(this,lt.x,Je-Xe.scroll*60)):Xe.scroll<0?rt>lt.y-it&&(this.element.style.marginTop=rt+Xe.scroll*60+"px",ye(this,lt.y,rt+Xe.scroll*60)):Xe.scroll>0&&rt<0&&(this.element.style.marginTop=rt+Xe.scroll*60+"px",ye(this,lt.y,rt+Xe.scroll*60))),!1}function ye(Xe,Je,rt){var nt,it,lt,ct,ot,dt,ft;for(Xe.scroll=="horizontal"?nt=Xe.panelWidth:nt=Xe.panelHeight,it=Math.ceil(Je/nt)+5,lt=Math.ceil((Math.abs(rt)+Je)/nt)+1,it=lt-it,it=it<0?0:it,dt=it;dt<lt&&dt<Xe.panels.length;dt++)if(ft=Xe.panels[dt],!ft.activePanel){var gt,mt=Xe.viewer.tileSources[dt];mt.referenceStripThumbnailUrl?gt={type:"image",url:mt.referenceStripThumbnailUrl}:gt=mt,ct=new ie.Viewer({id:ft.id,tileSources:[gt],element:ft,navigatorSizeRatio:Xe.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:Xe.viewer.loadTilesWithAjax,ajaxHeaders:Xe.viewer.ajaxHeaders,useCanvas:Xe.useCanvas}),ct.displayRegion=ie.makeNeutralElement("div"),ct.displayRegion.id=ft.id+"-displayregion",ct.displayRegion.className="displayregion",ot=ct.displayRegion.style,ot.position="relative",ot.top="0px",ot.left="0px",ot.fontSize="0px",ot.overflow="hidden",ot.float="left",ot.cssFloat="left",ot.styleFloat="left",ot.zIndex=999999999,ot.cursor="default",ot.width=Xe.panelWidth-4+"px",ot.height=Xe.panelHeight-4+"px",ct.displayRegion.innerTracker=new ie.MouseTracker({element:ct.displayRegion,startDisabled:!0}),ft.getElementsByTagName("div")[0].appendChild(ct.displayRegion),Xe.miniViewers[ft.id]=ct,ft.activePanel=!0}}function ve(Xe){var Je=Xe.eventSource.element;return this.scroll=="horizontal"?Je.style.marginBottom="0px":Je.style.marginLeft="0px",!1}function be(Xe){var Je=Xe.eventSource.element;return this.scroll=="horizontal"?Je.style.marginBottom="-"+ie.getElementSize(Je).y/2+"px":Je.style.marginLeft="-"+ie.getElementSize(Je).x/2+"px",!1}function Ye(Xe){if(!Xe.preventDefaultAction&&!Xe.ctrl&&!Xe.alt&&!Xe.meta)switch(Xe.keyCode){case 38:return ae.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 40:return ae.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 37:return ae.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 39:return ae.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}else return!0}function Ke(Xe){if(!Xe.preventDefaultAction&&!Xe.ctrl&&!Xe.alt&&!Xe.meta)switch(Xe.keyCode){case 61:return ae.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 45:return ae.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 48:case 119:case 87:return ae.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 115:case 83:return ae.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 97:return ae.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 100:return ae.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}else return!0}}(OpenSeadragon),function(ie){ie.DisplayRect=function(Z,ee,ae,ye,ve,be){ie.Rect.apply(this,[Z,ee,ae,ye]),this.minLevel=ve,this.maxLevel=be},ie.extend(ie.DisplayRect.prototype,ie.Rect.prototype)}(OpenSeadragon),function(ie){ie.Spring=function(ee){var ae=arguments;typeof ee!="object"&&(ee={initial:ae.length&&typeof ae[0]=="number"?ae[0]:void 0,springStiffness:ae.length>1?ae[1].springStiffness:5,animationTime:ae.length>1?ae[1].animationTime:1.5}),ie.console.assert(typeof ee.springStiffness=="number"&&ee.springStiffness!==0,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),ie.console.assert(typeof ee.animationTime=="number"&&ee.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),ee.exponential&&(this._exponential=!0,delete ee.exponential),ie.extend(!0,this,ee),this.current={value:typeof this.initial=="number"?this.initial:this._exponential?0:1,time:ie.now()},ie.console.assert(!this._exponential||this.current.value!==0,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},ie.Spring.prototype={resetTo:function(ee){ie.console.assert(!this._exponential||ee!==0,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=ee,this.start.time=this.target.time=this.current.time=ie.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(ee){ie.console.assert(!this._exponential||ee!==0,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=ee,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(ee){this.start.value+=ee,this.target.value+=ee,this._exponential&&(ie.console.assert(this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(ee){this._exponential=ee,this._exponential&&(ie.console.assert(this.current.value!==0&&this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=ie.now();var ee,ae;this._exponential?(ee=this.start._logValue,ae=this.target._logValue):(ee=this.start.value,ae=this.target.value);var ye=this.current.time>=this.target.time?ae:ee+(ae-ee)*Z(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time)),ve=this.current.value;return this._exponential?this.current.value=Math.exp(ye):this.current.value=ye,ve!=this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}};function Z(ee,ae){return(1-Math.exp(ee*-ae))/(1-Math.exp(-ee))}}(OpenSeadragon),function(ie){function Z(ae){ie.extend(!0,this,{timeout:ie.DEFAULT_SETTINGS.timeout,jobId:null},ae),this.image=null}Z.prototype={errorMsg:null,start:function(){var ae=this,ye=this.abort;this.image=new Image,this.image.onload=function(){ae.finish(!0)},this.image.onabort=this.image.onerror=function(){ae.errorMsg="Image load aborted",ae.finish(!1)},this.jobId=window.setTimeout(function(){ae.errorMsg="Image load exceeded timeout ("+ae.timeout+" ms)",ae.finish(!1)},this.timeout),this.loadWithAjax?(this.request=ie.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(ve){var be;try{be=new window.Blob([ve.response])}catch(Je){var Ye=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(Je.name==="TypeError"&&Ye){var Ke=new Ye;Ke.append(ve.response),be=Ke.getBlob()}}be.size===0&&(ae.errorMsg="Empty image response.",ae.finish(!1));var Xe=(window.URL||window.webkitURL).createObjectURL(be);ae.image.src=Xe},error:function(ve){ae.errorMsg="Image load aborted - XHR error",ae.finish(!1)}}),this.abort=function(){ae.request.abort(),typeof ye=="function"&&ye()}):(this.crossOriginPolicy!==!1&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(ae){this.image.onload=this.image.onerror=this.image.onabort=null,ae||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},ie.ImageLoader=function(ae){ie.extend(!0,this,{jobLimit:ie.DEFAULT_SETTINGS.imageLoaderLimit,timeout:ie.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},ae)},ie.ImageLoader.prototype={addJob:function(ae){var ye=this,ve=function(Ke){ee(ye,Ke,ae.callback)},be={src:ae.src,loadWithAjax:ae.loadWithAjax,ajaxHeaders:ae.loadWithAjax?ae.ajaxHeaders:null,crossOriginPolicy:ae.crossOriginPolicy,ajaxWithCredentials:ae.ajaxWithCredentials,callback:ve,abort:ae.abort,timeout:this.timeout},Ye=new Z(be);!this.jobLimit||this.jobsInProgress<this.jobLimit?(Ye.start(),this.jobsInProgress++):this.jobQueue.push(Ye)},clear:function(){for(var ae=0;ae<this.jobQueue.length;ae++){var ye=this.jobQueue[ae];typeof ye.abort=="function"&&ye.abort()}this.jobQueue=[]}};function ee(ae,ye,ve){var be;ae.jobsInProgress--,(!ae.jobLimit||ae.jobsInProgress<ae.jobLimit)&&ae.jobQueue.length>0&&(be=ae.jobQueue.shift(),be.start(),ae.jobsInProgress++),ve(ye.image,ye.errorMsg,ye.request)}}(OpenSeadragon),function(ie){ie.Tile=function(Z,ee,ae,ye,ve,be,Ye,Ke,Xe,Je){this.level=Z,this.x=ee,this.y=ae,this.bounds=ye,this.sourceBounds=Je,this.exists=ve,this.url=be,this.context2D=Ye,this.loadWithAjax=Ke,this.ajaxHeaders=Xe,this.ajaxHeaders?this.cacheKey=this.url+"+"+JSON.stringify(this.ajaxHeaders):this.cacheKey=this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},ie.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(Z){if(!this.cacheImageRecord){ie.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString());return}if(!this.loaded){ie.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}this.element||(this.element=ie.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=Z&&Z.appendChild(this.element),this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",ie.setElementOpacity(this.element,this.opacity)},drawCanvas:function(Z,ee,ae,ye){var ve=this.position.times(ie.pixelDensityRatio),be=this.size.times(ie.pixelDensityRatio),Ye;if(!this.context2D&&!this.cacheImageRecord){ie.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString());return}if(Ye=this.context2D||this.cacheImageRecord.getRenderedContext(),!this.loaded||!Ye){ie.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}Z.save(),Z.globalAlpha=this.opacity,typeof ae=="number"&&ae!==1&&(ve=ve.times(ae),be=be.times(ae)),ye instanceof ie.Point&&(ve=ve.plus(ye)),Z.globalAlpha===1&&this._hasTransparencyChannel()&&Z.clearRect(ve.x,ve.y,be.x,be.y),ee({context:Z,tile:this,rendered:Ye});var Ke,Xe;this.sourceBounds?(Ke=Math.min(this.sourceBounds.width,Ye.canvas.width),Xe=Math.min(this.sourceBounds.height,Ye.canvas.height)):(Ke=Ye.canvas.width,Xe=Ye.canvas.height),Z.drawImage(Ye.canvas,0,0,Ke,Xe,ve.x,ve.y,be.x,be.y),Z.restore()},getScaleForEdgeSmoothing:function(){var Z;if(this.cacheImageRecord)Z=this.cacheImageRecord.getRenderedContext();else if(this.context2D)Z=this.context2D;else return ie.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;return Z.canvas.width/(this.size.x*ie.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(Z,ee,ae){var ye=Math.max(1,Math.ceil((ae.x-ee.x)/2)),ve=Math.max(1,Math.ceil((ae.y-ee.y)/2));return new ie.Point(ye,ve).minus(this.position.times(ie.pixelDensityRatio).times(Z||1).apply(function(be){return be%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function(ie){ie.OverlayPlacement=ie.Placement,ie.OverlayRotationMode=ie.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),ie.Overlay=function(Z,ee,ae){var ye;ie.isPlainObject(Z)?ye=Z:ye={element:Z,location:ee,placement:ae},this.element=ye.element,this.style=ye.element.style,this._init(ye)},ie.Overlay.prototype={_init:function(Z){this.location=Z.location,this.placement=Z.placement===void 0?ie.Placement.TOP_LEFT:Z.placement,this.onDraw=Z.onDraw,this.checkResize=Z.checkResize===void 0?!0:Z.checkResize,this.width=Z.width===void 0?null:Z.width,this.height=Z.height===void 0?null:Z.height,this.rotationMode=Z.rotationMode||ie.OverlayRotationMode.EXACT,this.location instanceof ie.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=ie.Placement.TOP_LEFT),this.scales=this.width!==null&&this.height!==null,this.bounds=new ie.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(Z,ee){var ae=ie.Placement.properties[this.placement];ae&&(ae.isHorizontallyCentered?Z.x-=ee.x/2:ae.isRight&&(Z.x-=ee.x),ae.isVerticallyCentered?Z.y-=ee.y/2:ae.isBottom&&(Z.y-=ee.y))},destroy:function(){var Z=this.element,ee=this.style;Z.parentNode&&(Z.parentNode.removeChild(Z),Z.prevElementParent&&(ee.display="none",document.body.appendChild(Z))),this.onDraw=null,ee.top="",ee.left="",ee.position="",this.width!==null&&(ee.width=""),this.height!==null&&(ee.height="");var ae=ie.getCssPropertyWithVendorPrefix("transformOrigin"),ye=ie.getCssPropertyWithVendorPrefix("transform");ae&&ye&&(ee[ae]="",ee[ye]="")},drawHTML:function(Z,ee){var ae=this.element;ae.parentNode!==Z&&(ae.prevElementParent=ae.parentNode,ae.prevNextSibling=ae.nextSibling,Z.appendChild(ae),this.style.position="absolute",this.size=ie.getElementSize(ae));var ye=this._getOverlayPositionAndSize(ee),ve=ye.position,be=this.size=ye.size,Ye=ye.rotate;if(this.onDraw)this.onDraw(ve,be,this.element);else{var Ke=this.style;Ke.left=ve.x+"px",Ke.top=ve.y+"px",this.width!==null&&(Ke.width=be.x+"px"),this.height!==null&&(Ke.height=be.y+"px");var Xe=ie.getCssPropertyWithVendorPrefix("transformOrigin"),Je=ie.getCssPropertyWithVendorPrefix("transform");Xe&&Je&&(Ye?(Ke[Xe]=this._getTransformOrigin(),Ke[Je]="rotate("+Ye+"deg)"):(Ke[Xe]="",Ke[Je]="")),Ke.display!=="none"&&(Ke.display="block")}},_getOverlayPositionAndSize:function(Z){var ee=Z.pixelFromPoint(this.location,!0),ae=this._getSizeInPixels(Z);this.adjust(ee,ae);var ye=0;if(Z.degrees&&this.rotationMode!==ie.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===ie.OverlayRotationMode.BOUNDING_BOX&&this.width!==null&&this.height!==null){var ve=new ie.Rect(ee.x,ee.y,ae.x,ae.y),be=this._getBoundingBox(ve,Z.degrees);ee=be.getTopLeft(),ae=be.getSize()}else ye=Z.degrees;return{position:ee,size:ae,rotate:ye}},_getSizeInPixels:function(Z){var ee=this.size.x,ae=this.size.y;if(this.width!==null||this.height!==null){var ye=Z.deltaPixelsFromPointsNoRotate(new ie.Point(this.width||0,this.height||0),!0);this.width!==null&&(ee=ye.x),this.height!==null&&(ae=ye.y)}if(this.checkResize&&(this.width===null||this.height===null)){var ve=this.size=ie.getElementSize(this.element);this.width===null&&(ee=ve.x),this.height===null&&(ae=ve.y)}return new ie.Point(ee,ae)},_getBoundingBox:function(Z,ee){var ae=this._getPlacementPoint(Z);return Z.rotate(ee,ae).getBoundingBox()},_getPlacementPoint:function(Z){var ee=new ie.Point(Z.x,Z.y),ae=ie.Placement.properties[this.placement];return ae&&(ae.isHorizontallyCentered?ee.x+=Z.width/2:ae.isRight&&(ee.x+=Z.width),ae.isVerticallyCentered?ee.y+=Z.height/2:ae.isBottom&&(ee.y+=Z.height)),ee},_getTransformOrigin:function(){var Z="",ee=ie.Placement.properties[this.placement];return ee&&(ee.isLeft?Z="left":ee.isRight&&(Z="right"),ee.isTop?Z+=" top":ee.isBottom&&(Z+=" bottom")),Z},update:function(Z,ee){var ae=ie.isPlainObject(Z)?Z:{location:Z,placement:ee};this._init({location:ae.location||this.location,placement:ae.placement!==void 0?ae.placement:this.placement,onDraw:ae.onDraw||this.onDraw,checkResize:ae.checkResize||this.checkResize,width:ae.width!==void 0?ae.width:this.width,height:ae.height!==void 0?ae.height:this.height,rotationMode:ae.rotationMode||this.rotationMode})},getBounds:function(Z){ie.console.assert(Z,"A viewport must now be passed to Overlay.getBounds.");var ee=this.width,ae=this.height;if(ee===null||ae===null){var ye=Z.deltaPointsFromPixelsNoRotate(this.size,!0);ee===null&&(ee=ye.x),ae===null&&(ae=ye.y)}var ve=this.location.clone();return this.adjust(ve,new ie.Point(ee,ae)),this._adjustBoundsForRotation(Z,new ie.Rect(ve.x,ve.y,ee,ae))},_adjustBoundsForRotation:function(Z,ee){if(!Z||Z.degrees===0||this.rotationMode===ie.OverlayRotationMode.EXACT)return ee;if(this.rotationMode===ie.OverlayRotationMode.BOUNDING_BOX){if(this.width===null||this.height===null)return ee;var ae=this._getOverlayPositionAndSize(Z);return Z.viewerElementToViewportRectangle(new ie.Rect(ae.position.x,ae.position.y,ae.size.x,ae.size.y))}return ee.rotate(-Z.degrees,this._getPlacementPoint(ee))}}}(OpenSeadragon),function(ie){ie.Drawer=function(Z){ie.console.assert(Z.viewer,"[Drawer] options.viewer is required");var ee=arguments;if(ie.isPlainObject(Z)||(Z={source:ee[0],viewport:ee[1],element:ee[2]}),ie.console.assert(Z.viewport,"[Drawer] options.viewport is required"),ie.console.assert(Z.element,"[Drawer] options.element is required"),Z.source&&ie.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=Z.viewer,this.viewport=Z.viewport,this.debugGridColor=typeof Z.debugGridColor=="string"?[Z.debugGridColor]:Z.debugGridColor||ie.DEFAULT_SETTINGS.debugGridColor,Z.opacity&&ie.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=ie.supportsCanvas&&(this.viewer?this.viewer.useCanvas:!0),this.container=ie.getElement(Z.element),this.canvas=ie.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var ae=this._calculateCanvasSize();this.canvas.width=ae.x,this.canvas.height=ae.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",ie.setElementOpacity(this.canvas,this.opacity,!0),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},ie.Drawer.prototype={addOverlay:function(Z,ee,ae,ye){return ie.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(Z,ee,ae,ye),this},updateOverlay:function(Z,ee,ae){return ie.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(Z,ee,ae),this},removeOverlay:function(Z){return ie.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(Z),this},clearOverlays:function(){return ie.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(Z){var ee=this.viewport.pixelFromPointNoRotate(Z,!0);return new ie.Point(ee.x*ie.pixelDensityRatio,ee.y*ie.pixelDensityRatio)},clipWithPolygons:function(Z,ee){if(this.useCanvas){var ae=this._getContext(ee);ae.beginPath(),Z.forEach(function(ye){ye.forEach(function(ve,be){ae[be===0?"moveTo":"lineTo"](ve.x,ve.y)})}),ae.clip()}},setOpacity:function(Z){ie.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var ee=this.viewer.world,ae=0;ae<ee.getItemCount();ae++)ee.getItemAt(ae).setOpacity(Z);return this},getOpacity:function(){ie.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var Z=this.viewer.world,ee=0,ae=0;ae<Z.getItemCount();ae++){var ye=Z.getItemAt(ae).getOpacity();ye>ee&&(ee=ye)}return ee},needsUpdate:function(){return ie.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return ie.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return ie.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return ie.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var Z=this._calculateCanvasSize();if((this.canvas.width!=Z.x||this.canvas.height!=Z.y)&&(this.canvas.width=Z.x,this.canvas.height=Z.y,this._updateImageSmoothingEnabled(this.context),this.sketchCanvas!==null)){var ee=this._calculateSketchCanvasSize();this.sketchCanvas.width=ee.x,this.sketchCanvas.height=ee.y,this._updateImageSmoothingEnabled(this.sketchContext)}this._clear()}},_clear:function(Z,ee){if(this.useCanvas){var ae=this._getContext(Z);if(ee)ae.clearRect(ee.x,ee.y,ee.width,ee.height);else{var ye=ae.canvas;ae.clearRect(0,0,ye.width,ye.height)}}},viewportToDrawerRectangle:function(Z){var ee=this.viewport.pixelFromPointNoRotate(Z.getTopLeft(),!0),ae=this.viewport.deltaPixelsFromPointsNoRotate(Z.getSize(),!0);return new ie.Rect(ee.x*ie.pixelDensityRatio,ee.y*ie.pixelDensityRatio,ae.x*ie.pixelDensityRatio,ae.y*ie.pixelDensityRatio)},drawTile:function(Z,ee,ae,ye,ve){if(ie.console.assert(Z,"[Drawer.drawTile] tile is required"),ie.console.assert(ee,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var be=this._getContext(ae);ye=ye||1,Z.drawCanvas(be,ee,ye,ve)}else Z.drawHTML(this.canvas)},_getContext:function(Z){var ee=this.context;if(Z){if(this.sketchCanvas===null){this.sketchCanvas=document.createElement("canvas");var ae=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=ae.x,this.sketchCanvas.height=ae.y,this.sketchContext=this.sketchCanvas.getContext("2d"),this.viewport.getRotation()===0){var ye=this;this.viewer.addHandler("rotate",function ve(){if(ye.viewport.getRotation()!==0){ye.viewer.removeHandler("rotate",ve);var be=ye._calculateSketchCanvasSize();ye.sketchCanvas.width=be.x,ye.sketchCanvas.height=be.y}})}this._updateImageSmoothingEnabled(this.sketchContext)}ee=this.sketchContext}return ee},saveContext:function(Z){this.useCanvas&&this._getContext(Z).save()},restoreContext:function(Z){this.useCanvas&&this._getContext(Z).restore()},setClip:function(Z,ee){if(this.useCanvas){var ae=this._getContext(ee);ae.beginPath(),ae.rect(Z.x,Z.y,Z.width,Z.height),ae.clip()}},drawRectangle:function(Z,ee,ae){if(this.useCanvas){var ye=this._getContext(ae);ye.save(),ye.fillStyle=ee,ye.fillRect(Z.x,Z.y,Z.width,Z.height),ye.restore()}},blendSketch:function(Z,ee,ae,ye){var ve=Z;if(ie.isPlainObject(ve)||(ve={opacity:Z,scale:ee,translate:ae,compositeOperation:ye}),!(!this.useCanvas||!this.sketchCanvas)){Z=ve.opacity,ye=ve.compositeOperation;var be=ve.bounds;if(this.context.save(),this.context.globalAlpha=Z,ye&&(this.context.globalCompositeOperation=ye),be)be.x<0&&(be.width+=be.x,be.x=0),be.x+be.width>this.canvas.width&&(be.width=this.canvas.width-be.x),be.y<0&&(be.height+=be.y,be.y=0),be.y+be.height>this.canvas.height&&(be.height=this.canvas.height-be.y),this.context.drawImage(this.sketchCanvas,be.x,be.y,be.width,be.height,be.x,be.y,be.width,be.height);else{ee=ve.scale||1,ae=ve.translate;var Ye=ae instanceof ie.Point?ae:new ie.Point(0,0),Ke=0,Xe=0;if(ae){var Je=this.sketchCanvas.width-this.canvas.width,rt=this.sketchCanvas.height-this.canvas.height;Ke=Math.round(Je/2),Xe=Math.round(rt/2)}this.context.drawImage(this.sketchCanvas,Ye.x-Ke*ee,Ye.y-Xe*ee,(this.canvas.width+2*Ke)*ee,(this.canvas.height+2*Xe)*ee,-Ke,-Xe,this.canvas.width+2*Ke,this.canvas.height+2*Xe)}this.context.restore()}},drawDebugInfo:function(Z,ee,ae,ye){if(this.useCanvas){var ve=this.viewer.world.getIndexOfItem(ye)%this.debugGridColor.length,be=this.context;be.save(),be.lineWidth=2*ie.pixelDensityRatio,be.font="small-caps bold "+13*ie.pixelDensityRatio+"px arial",be.strokeStyle=this.debugGridColor[ve],be.fillStyle=this.debugGridColor[ve],this.viewport.degrees!==0&&this._offsetForRotation({degrees:this.viewport.degrees}),ye.getRotation(!0)%360!==0&&this._offsetForRotation({degrees:ye.getRotation(!0),point:ye.viewport.pixelFromPointNoRotate(ye._getRotationPoint(!0),!0)}),ye.viewport.degrees===0&&ye.getRotation(!0)%360===0&&ye._drawer.viewer.viewport.getFlip()&&ye._drawer._flip(),be.strokeRect(Z.position.x*ie.pixelDensityRatio,Z.position.y*ie.pixelDensityRatio,Z.size.x*ie.pixelDensityRatio,Z.size.y*ie.pixelDensityRatio);var Ye=(Z.position.x+Z.size.x/2)*ie.pixelDensityRatio,Ke=(Z.position.y+Z.size.y/2)*ie.pixelDensityRatio;be.translate(Ye,Ke),be.rotate(Math.PI/180*-this.viewport.degrees),be.translate(-Ye,-Ke),Z.x===0&&Z.y===0&&(be.fillText("Zoom: "+this.viewport.getZoom(),Z.position.x*ie.pixelDensityRatio,(Z.position.y-30)*ie.pixelDensityRatio),be.fillText("Pan: "+this.viewport.getBounds().toString(),Z.position.x*ie.pixelDensityRatio,(Z.position.y-20)*ie.pixelDensityRatio)),be.fillText("Level: "+Z.level,(Z.position.x+10)*ie.pixelDensityRatio,(Z.position.y+20)*ie.pixelDensityRatio),be.fillText("Column: "+Z.x,(Z.position.x+10)*ie.pixelDensityRatio,(Z.position.y+30)*ie.pixelDensityRatio),be.fillText("Row: "+Z.y,(Z.position.x+10)*ie.pixelDensityRatio,(Z.position.y+40)*ie.pixelDensityRatio),be.fillText("Order: "+ae+" of "+ee,(Z.position.x+10)*ie.pixelDensityRatio,(Z.position.y+50)*ie.pixelDensityRatio),be.fillText("Size: "+Z.size.toString(),(Z.position.x+10)*ie.pixelDensityRatio,(Z.position.y+60)*ie.pixelDensityRatio),be.fillText("Position: "+Z.position.toString(),(Z.position.x+10)*ie.pixelDensityRatio,(Z.position.y+70)*ie.pixelDensityRatio),this.viewport.degrees!==0&&this._restoreRotationChanges(),ye.getRotation(!0)%360!==0&&this._restoreRotationChanges(),ye.viewport.degrees===0&&ye.getRotation(!0)%360===0&&ye._drawer.viewer.viewport.getFlip()&&ye._drawer._flip(),be.restore()}},debugRect:function(Z){if(this.useCanvas){var ee=this.context;ee.save(),ee.lineWidth=2*ie.pixelDensityRatio,ee.strokeStyle=this.debugGridColor[0],ee.fillStyle=this.debugGridColor[0],ee.strokeRect(Z.x*ie.pixelDensityRatio,Z.y*ie.pixelDensityRatio,Z.width*ie.pixelDensityRatio,Z.height*ie.pixelDensityRatio),ee.restore()}},setImageSmoothingEnabled:function(Z){this.useCanvas&&(this._imageSmoothingEnabled=Z,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(Z){Z.msImageSmoothingEnabled=this._imageSmoothingEnabled,Z.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(Z){var ee=this._getContext(Z).canvas;return new ie.Point(ee.width,ee.height)},getCanvasCenter:function(){return new ie.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(Z){var ee=Z.point?Z.point.times(ie.pixelDensityRatio):this.getCanvasCenter(),ae=this._getContext(Z.useSketch);ae.save(),ae.translate(ee.x,ee.y),this.viewer.viewport.flipped?(ae.rotate(Math.PI/180*-Z.degrees),ae.scale(-1,1)):ae.rotate(Math.PI/180*Z.degrees),ae.translate(-ee.x,-ee.y)},_flip:function(Z){Z=Z||{};var ee=Z.point?Z.point.times(ie.pixelDensityRatio):this.getCanvasCenter(),ae=this._getContext(Z.useSketch);ae.translate(ee.x,0),ae.scale(-1,1),ae.translate(-ee.x,0)},_restoreRotationChanges:function(Z){var ee=this._getContext(Z);ee.restore()},_calculateCanvasSize:function(){var Z=ie.pixelDensityRatio,ee=this.viewport.getContainerSize();return{x:Math.round(ee.x*Z),y:Math.round(ee.y*Z)}},_calculateSketchCanvasSize:function(){var Z=this._calculateCanvasSize();if(this.viewport.getRotation()===0)return Z;var ee=Math.ceil(Math.sqrt(Z.x*Z.x+Z.y*Z.y));return{x:ee,y:ee}}}}(OpenSeadragon),function(ie){ie.Viewport=function(Z){var ee=arguments;ee.length&&ee[0]instanceof ie.Point&&(Z={containerSize:ee[0],contentSize:ee[1],config:ee[2]}),Z.config&&(ie.extend(!0,Z,Z.config),delete Z.config),this._margins=ie.extend({left:0,top:0,right:0,bottom:0},Z.margins||{}),delete Z.margins,ie.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:ie.DEFAULT_SETTINGS.springStiffness,animationTime:ie.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:ie.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:ie.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:ie.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:ie.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:ie.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:ie.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:ie.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:ie.DEFAULT_SETTINGS.maxZoomLevel,degrees:ie.DEFAULT_SETTINGS.degrees,flipped:ie.DEFAULT_SETTINGS.flipped,homeFillsViewer:ie.DEFAULT_SETTINGS.homeFillsViewer},Z),this._updateContainerInnerSize(),this.centerSpringX=new ie.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new ie.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new ie.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new ie.Rect(0,0,1,1),1),this.goHome(!0),this.update()},ie.Viewport.prototype={resetContentSize:function(Z){return ie.console.assert(Z,"[Viewport.resetContentSize] contentSize is required"),ie.console.assert(Z instanceof ie.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),ie.console.assert(Z.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),ie.console.assert(Z.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new ie.Rect(0,0,1,Z.y/Z.x),Z.x),this},setHomeBounds:function(Z,ee){ie.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(Z,ee)},_setContentBounds:function(Z,ee){ie.console.assert(Z,"[Viewport._setContentBounds] bounds is required"),ie.console.assert(Z instanceof ie.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),ie.console.assert(Z.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),ie.console.assert(Z.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=Z.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(ee),this._contentBounds=Z.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(ee),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:ee,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var Z=this._contentAspectRatio/this.getAspectRatio(),ee;return this.homeFillsViewer?ee=Z>=1?Z:1:ee=Z>=1?1:Z,ee/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var Z=this._contentBounds.getCenter(),ee=1/this.getHomeZoom(),ae=ee/this.getAspectRatio();return new ie.Rect(Z.x-ee/2,Z.y-ae/2,ee,ae)},goHome:function(Z){return this.viewer&&this.viewer.raiseEvent("home",{immediately:Z}),this.fitBounds(this.getHomeBounds(),Z)},getMinZoom:function(){var Z=this.getHomeZoom(),ee=this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*Z;return ee},getMaxZoom:function(){var Z=this.maxZoomLevel;return Z||(Z=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,Z/=this._contentBounds.width),Math.max(Z,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new ie.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return ie.extend({},this._margins)},setMargins:function(Z){ie.console.assert(ie.type(Z)==="object","[Viewport.setMargins] margins must be an object"),this._margins=ie.extend({left:0,top:0,right:0,bottom:0},Z),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(Z){return this.getBoundsNoRotate(Z).rotate(-this.getRotation())},getBoundsNoRotate:function(Z){var ee=this.getCenter(Z),ae=1/this.getZoom(Z),ye=ae/this.getAspectRatio();return new ie.Rect(ee.x-ae/2,ee.y-ye/2,ae,ye)},getBoundsWithMargins:function(Z){return this.getBoundsNoRotateWithMargins(Z).rotate(-this.getRotation(),this.getCenter(Z))},getBoundsNoRotateWithMargins:function(Z){var ee=this.getBoundsNoRotate(Z),ae=this._containerInnerSize.x*this.getZoom(Z);return ee.x-=this._margins.left/ae,ee.y-=this._margins.top/ae,ee.width+=(this._margins.left+this._margins.right)/ae,ee.height+=(this._margins.top+this._margins.bottom)/ae,ee},getCenter:function(Z){var ee=new ie.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),ae=new ie.Point(this.centerSpringX.target.value,this.centerSpringY.target.value),ye,ve,be,Ye,Ke,Xe,Je,rt;return Z?ee:this.zoomPoint?(ye=this.pixelFromPoint(this.zoomPoint,!0),ve=this.getZoom(),be=1/ve,Ye=be/this.getAspectRatio(),Ke=new ie.Rect(ee.x-be/2,ee.y-Ye/2,be,Ye),Xe=this._pixelFromPoint(this.zoomPoint,Ke),Je=Xe.minus(ye),rt=Je.divide(this._containerInnerSize.x*ve),ae.plus(rt)):ae},getZoom:function(Z){return Z?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(Z){return Math.max(Math.min(Z,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(Z){var ee=new ie.Rect(Z.x,Z.y,Z.width,Z.height);if(!this.wrapHorizontal){var ae=this.visibilityRatio*ee.width,ye=ee.x+ee.width,ve=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,be=this._contentBoundsNoRotate.x-ye+ae,Ye=ve-ee.x-ae;ae>this._contentBoundsNoRotate.width?ee.x+=(be+Ye)/2:Ye<0?ee.x+=Ye:be>0&&(ee.x+=be)}if(!this.wrapVertical){var Ke=this.visibilityRatio*ee.height,Xe=ee.y+ee.height,Je=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,rt=this._contentBoundsNoRotate.y-Xe+Ke,nt=Je-ee.y-Ke;Ke>this._contentBoundsNoRotate.height?ee.y+=(rt+nt)/2:nt<0?ee.y+=nt:rt>0&&(ee.y+=rt)}return ee},_raiseConstraintsEvent:function(Z){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:Z})},applyConstraints:function(Z){var ee=this.getZoom(),ae=this._applyZoomConstraints(ee);ee!==ae&&this.zoomTo(ae,this.zoomPoint,Z);var ye=this.getBoundsNoRotate(),ve=this._applyBoundaryConstraints(ye);return this._raiseConstraintsEvent(Z),(ye.x!==ve.x||ye.y!==ve.y||Z)&&this.fitBounds(ve.rotate(-this.getRotation()),Z),this},ensureVisible:function(Z){return this.applyConstraints(Z)},_fitBounds:function(Z,ee){ee=ee||{};var ae=ee.immediately||!1,ye=ee.constraints||!1,ve=this.getAspectRatio(),be=Z.getCenter(),Ye=new ie.Rect(Z.x,Z.y,Z.width,Z.height,Z.degrees+this.getRotation()).getBoundingBox();Ye.getAspectRatio()>=ve?Ye.height=Ye.width/ve:Ye.width=Ye.height*ve,Ye.x=be.x-Ye.width/2,Ye.y=be.y-Ye.height/2;var Ke=1/Ye.width;if(ye){var Xe=Ye.getAspectRatio(),Je=this._applyZoomConstraints(Ke);Ke!==Je&&(Ke=Je,Ye.width=1/Ke,Ye.x=be.x-Ye.width/2,Ye.height=Ye.width/Xe,Ye.y=be.y-Ye.height/2),Ye=this._applyBoundaryConstraints(Ye),be=Ye.getCenter(),this._raiseConstraintsEvent(ae)}if(ae)return this.panTo(be,!0),this.zoomTo(Ke,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var rt=this.getBounds(),nt=this.getZoom();if(nt===0||Math.abs(Ke/nt-1)<1e-8)return this.zoomTo(Ke,!0),this.panTo(be,ae);Ye=Ye.rotate(-this.getRotation());var it=Ye.getTopLeft().times(Ke).minus(rt.getTopLeft().times(nt)).divide(Ke-nt);return this.zoomTo(Ke,it,ae)},fitBounds:function(Z,ee){return this._fitBounds(Z,{immediately:ee,constraints:!1})},fitBoundsWithConstraints:function(Z,ee){return this._fitBounds(Z,{immediately:ee,constraints:!0})},fitVertically:function(Z){var ee=new ie.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(ee,Z)},fitHorizontally:function(Z){var ee=new ie.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(ee,Z)},getConstrainedBounds:function(Z){var ee,ae;return ee=this.getBounds(Z),ae=this._applyBoundaryConstraints(ee),ae},panBy:function(Z,ee){var ae=new ie.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(ae.plus(Z),ee)},panTo:function(Z,ee){return ee?(this.centerSpringX.resetTo(Z.x),this.centerSpringY.resetTo(Z.y)):(this.centerSpringX.springTo(Z.x),this.centerSpringY.springTo(Z.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:Z,immediately:ee}),this},zoomBy:function(Z,ee,ae){return this.zoomTo(this.zoomSpring.target.value*Z,ee,ae)},zoomTo:function(Z,ee,ae){var ye=this;return this.zoomPoint=ee instanceof ie.Point&&!isNaN(ee.x)&&!isNaN(ee.y)?ee:null,ae?this._adjustCenterSpringsForZoomPoint(function(){ye.zoomSpring.resetTo(Z)}):this.zoomSpring.springTo(Z),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:Z,refPoint:ee,immediately:ae}),this},setRotation:function(Z){return!this.viewer||!this.viewer.drawer.canRotate()?this:(this.degrees=ie.positiveModulo(Z,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:Z}),this)},getRotation:function(){return this.degrees},resize:function(Z,ee){var ae=this.getBoundsNoRotate(),ye=ae,ve;return this.containerSize.x=Z.x,this.containerSize.y=Z.y,this._updateContainerInnerSize(),ee&&(ve=Z.x/this.containerSize.x,ye.width=ae.width*ve,ye.height=ye.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:Z,maintain:ee}),this.fitBounds(ye,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new ie.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var Z=this;this._adjustCenterSpringsForZoomPoint(function(){Z.zoomSpring.update()}),this.centerSpringX.update(),this.centerSpringY.update();var ee=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,ee},_adjustCenterSpringsForZoomPoint:function(Z){if(this.zoomPoint){var ee=this.pixelFromPoint(this.zoomPoint,!0);Z();var ae=this.pixelFromPoint(this.zoomPoint,!0),ye=ae.minus(ee),ve=this.deltaPointsFromPixels(ye,!0);this.centerSpringX.shiftBy(ve.x),this.centerSpringY.shiftBy(ve.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else Z()},deltaPixelsFromPointsNoRotate:function(Z,ee){return Z.times(this._containerInnerSize.x*this.getZoom(ee))},deltaPixelsFromPoints:function(Z,ee){return this.deltaPixelsFromPointsNoRotate(Z.rotate(this.getRotation()),ee)},deltaPointsFromPixelsNoRotate:function(Z,ee){return Z.divide(this._containerInnerSize.x*this.getZoom(ee))},deltaPointsFromPixels:function(Z,ee){return this.deltaPointsFromPixelsNoRotate(Z,ee).rotate(-this.getRotation())},pixelFromPointNoRotate:function(Z,ee){return this._pixelFromPointNoRotate(Z,this.getBoundsNoRotate(ee))},pixelFromPoint:function(Z,ee){return this._pixelFromPoint(Z,this.getBoundsNoRotate(ee))},_pixelFromPointNoRotate:function(Z,ee){return Z.minus(ee.getTopLeft()).times(this._containerInnerSize.x/ee.width).plus(new ie.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(Z,ee){return this._pixelFromPointNoRotate(Z.rotate(this.getRotation(),this.getCenter(!0)),ee)},pointFromPixelNoRotate:function(Z,ee){var ae=this.getBoundsNoRotate(ee);return Z.minus(new ie.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/ae.width).plus(ae.getTopLeft())},pointFromPixel:function(Z,ee){return this.pointFromPixelNoRotate(Z,ee).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(Z,ee){var ae=this._contentBoundsNoRotate.width;return new ie.Point(Z*this._contentSizeNoRotate.x/ae,ee*this._contentSizeNoRotate.x/ae)},viewportToImageCoordinates:function(Z,ee){if(Z instanceof ie.Point)return this.viewportToImageCoordinates(Z.x,Z.y);if(this.viewer){var ae=this.viewer.world.getItemCount();if(ae>1)ie.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(ae===1){var ye=this.viewer.world.getItemAt(0);return ye.viewportToImageCoordinates(Z,ee,!0)}}return this._viewportToImageDelta(Z-this._contentBoundsNoRotate.x,ee-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(Z,ee){var ae=this._contentBoundsNoRotate.width;return new ie.Point(Z/this._contentSizeNoRotate.x*ae,ee/this._contentSizeNoRotate.x*ae)},imageToViewportCoordinates:function(Z,ee){if(Z instanceof ie.Point)return this.imageToViewportCoordinates(Z.x,Z.y);if(this.viewer){var ae=this.viewer.world.getItemCount();if(ae>1)ie.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(ae===1){var ye=this.viewer.world.getItemAt(0);return ye.imageToViewportCoordinates(Z,ee,!0)}}var ve=this._imageToViewportDelta(Z,ee);return ve.x+=this._contentBoundsNoRotate.x,ve.y+=this._contentBoundsNoRotate.y,ve},imageToViewportRectangle:function(Z,ee,ae,ye){var ve=Z;if(ve instanceof ie.Rect||(ve=new ie.Rect(Z,ee,ae,ye)),this.viewer){var be=this.viewer.world.getItemCount();if(be>1)ie.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(be===1){var Ye=this.viewer.world.getItemAt(0);return Ye.imageToViewportRectangle(Z,ee,ae,ye,!0)}}var Ke=this.imageToViewportCoordinates(ve.x,ve.y),Xe=this._imageToViewportDelta(ve.width,ve.height);return new ie.Rect(Ke.x,Ke.y,Xe.x,Xe.y,ve.degrees)},viewportToImageRectangle:function(Z,ee,ae,ye){var ve=Z;if(ve instanceof ie.Rect||(ve=new ie.Rect(Z,ee,ae,ye)),this.viewer){var be=this.viewer.world.getItemCount();if(be>1)ie.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(be===1){var Ye=this.viewer.world.getItemAt(0);return Ye.viewportToImageRectangle(Z,ee,ae,ye,!0)}}var Ke=this.viewportToImageCoordinates(ve.x,ve.y),Xe=this._viewportToImageDelta(ve.width,ve.height);return new ie.Rect(Ke.x,Ke.y,Xe.x,Xe.y,ve.degrees)},viewerElementToImageCoordinates:function(Z){var ee=this.pointFromPixel(Z,!0);return this.viewportToImageCoordinates(ee)},imageToViewerElementCoordinates:function(Z){var ee=this.imageToViewportCoordinates(Z);return this.pixelFromPoint(ee,!0)},windowToImageCoordinates:function(Z){ie.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var ee=Z.minus(ie.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(ee)},imageToWindowCoordinates:function(Z){ie.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer.");var ee=this.imageToViewerElementCoordinates(Z);return ee.plus(ie.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(Z){return this.pointFromPixel(Z,!0)},viewportToViewerElementCoordinates:function(Z){return this.pixelFromPoint(Z,!0)},viewerElementToViewportRectangle:function(Z){return ie.Rect.fromSummits(this.pointFromPixel(Z.getTopLeft(),!0),this.pointFromPixel(Z.getTopRight(),!0),this.pointFromPixel(Z.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(Z){return ie.Rect.fromSummits(this.pixelFromPoint(Z.getTopLeft(),!0),this.pixelFromPoint(Z.getTopRight(),!0),this.pixelFromPoint(Z.getBottomLeft(),!0))},windowToViewportCoordinates:function(Z){ie.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var ee=Z.minus(ie.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(ee)},viewportToWindowCoordinates:function(Z){ie.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer.");var ee=this.viewportToViewerElementCoordinates(Z);return ee.plus(ie.getElementPosition(this.viewer.element))},viewportToImageZoom:function(Z){if(this.viewer){var ee=this.viewer.world.getItemCount();if(ee>1)ie.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(ee===1){var ae=this.viewer.world.getItemAt(0);return ae.viewportToImageZoom(Z)}}var ye=this._contentSizeNoRotate.x,ve=this._containerInnerSize.x,be=this._contentBoundsNoRotate.width,Ye=ve/ye*be;return Z*Ye},imageToViewportZoom:function(Z){if(this.viewer){var ee=this.viewer.world.getItemCount();if(ee>1)ie.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(ee===1){var ae=this.viewer.world.getItemAt(0);return ae.imageToViewportZoom(Z)}}var ye=this._contentSizeNoRotate.x,ve=this._containerInnerSize.x,be=this._contentBoundsNoRotate.width,Ye=ye/ve/be;return Z*Ye},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(Z){return this.flipped===Z?this:(this.flipped=Z,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:Z}),this)}}}(OpenSeadragon),function(ie){ie.TiledImage=function(ot){var dt=this;ie.console.assert(ot.tileCache,"[TiledImage] options.tileCache is required"),ie.console.assert(ot.drawer,"[TiledImage] options.drawer is required"),ie.console.assert(ot.viewer,"[TiledImage] options.viewer is required"),ie.console.assert(ot.imageLoader,"[TiledImage] options.imageLoader is required"),ie.console.assert(ot.source,"[TiledImage] options.source is required"),ie.console.assert(!ot.clip||ot.clip instanceof ie.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),ie.EventSource.call(this),this._tileCache=ot.tileCache,delete ot.tileCache,this._drawer=ot.drawer,delete ot.drawer,this._imageLoader=ot.imageLoader,delete ot.imageLoader,ot.clip instanceof ie.Rect&&(this._clip=ot.clip.clone()),delete ot.clip;var ft=ot.x||0;delete ot.x;var gt=ot.y||0;delete ot.y,this.normHeight=ot.source.dimensions.y/ot.source.dimensions.x,this.contentAspectX=ot.source.dimensions.x/ot.source.dimensions.y;var mt=1;ot.width?(mt=ot.width,delete ot.width,ot.height&&(ie.console.error("specifying both width and height to a tiledImage is not supported"),delete ot.height)):ot.height&&(mt=ot.height/this.normHeight,delete ot.height);var Yr=ot.fitBounds;delete ot.fitBounds;var Qr=ot.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete ot.fitBoundsPlacement;var Xr=ot.degrees||0;delete ot.degrees,ie.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:ie.DEFAULT_SETTINGS.springStiffness,animationTime:ie.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:ie.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:ie.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:ie.DEFAULT_SETTINGS.wrapVertical,immediateRender:ie.DEFAULT_SETTINGS.immediateRender,blendTime:ie.DEFAULT_SETTINGS.blendTime,alwaysBlend:ie.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:ie.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:ie.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:ie.DEFAULT_SETTINGS.iOSDevice,debugMode:ie.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:ie.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:ie.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:ie.DEFAULT_SETTINGS.placeholderFillStyle,opacity:ie.DEFAULT_SETTINGS.opacity,preload:ie.DEFAULT_SETTINGS.preload,compositeOperation:ie.DEFAULT_SETTINGS.compositeOperation},ot),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new ie.Spring({initial:ft,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new ie.Spring({initial:gt,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new ie.Spring({initial:mt,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new ie.Spring({initial:Xr,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),Yr&&this.fitBounds(Yr,Qr,!0),this._drawingHandler=function(Jr){dt.viewer.raiseEvent("tile-drawing",ie.extend({tiledImage:dt},Jr))}},ie.extend(ie.TiledImage.prototype,ie.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(ot){ot!==this._fullyLoaded&&(this._fullyLoaded=ot,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=ie.now(),this._needsDraw=!0},update:function(){var ot=this._xSpring.update(),dt=this._ySpring.update(),ft=this._scaleSpring.update(),gt=this._degreesSpring.update();return ot||dt||ft||gt?(this._updateForScale(),this._needsDraw=!0,!0):!1},draw:function(){this.opacity!==0||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset()},getBounds:function(ot){return this.getBoundsNoRotate(ot).rotate(this.getRotation(ot),this._getRotationPoint(ot))},getBoundsNoRotate:function(ot){return ot?new ie.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new ie.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return ie.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(ot){var dt=this.getBoundsNoRotate(ot);if(this._clip){var ft=ot?this._worldWidthCurrent:this._worldWidthTarget,gt=ft/this.source.dimensions.x,mt=this._clip.times(gt);dt=new ie.Rect(dt.x+mt.x,dt.y+mt.y,mt.width,mt.height)}return dt.rotate(this.getRotation(ot),this._getRotationPoint(ot))},getContentSize:function(){return new ie.Point(this.source.dimensions.x,this.source.dimensions.y)},_viewportToImageDelta:function(ot,dt,ft){var gt=ft?this._scaleSpring.current.value:this._scaleSpring.target.value;return new ie.Point(ot*(this.source.dimensions.x/gt),dt*(this.source.dimensions.y*this.contentAspectX/gt))},viewportToImageCoordinates:function(ot,dt,ft){var gt;return ot instanceof ie.Point?(ft=dt,gt=ot):gt=new ie.Point(ot,dt),gt=gt.rotate(-this.getRotation(ft),this._getRotationPoint(ft)),ft?this._viewportToImageDelta(gt.x-this._xSpring.current.value,gt.y-this._ySpring.current.value):this._viewportToImageDelta(gt.x-this._xSpring.target.value,gt.y-this._ySpring.target.value)},_imageToViewportDelta:function(ot,dt,ft){var gt=ft?this._scaleSpring.current.value:this._scaleSpring.target.value;return new ie.Point(ot/this.source.dimensions.x*gt,dt/this.source.dimensions.y/this.contentAspectX*gt)},imageToViewportCoordinates:function(ot,dt,ft){ot instanceof ie.Point&&(ft=dt,dt=ot.y,ot=ot.x);var gt=this._imageToViewportDelta(ot,dt);return ft?(gt.x+=this._xSpring.current.value,gt.y+=this._ySpring.current.value):(gt.x+=this._xSpring.target.value,gt.y+=this._ySpring.target.value),gt.rotate(this.getRotation(ft),this._getRotationPoint(ft))},imageToViewportRectangle:function(ot,dt,ft,gt,mt){var Yr=ot;Yr instanceof ie.Rect?mt=dt:Yr=new ie.Rect(ot,dt,ft,gt);var Qr=this.imageToViewportCoordinates(Yr.getTopLeft(),mt),Xr=this._imageToViewportDelta(Yr.width,Yr.height,mt);return new ie.Rect(Qr.x,Qr.y,Xr.x,Xr.y,Yr.degrees+this.getRotation(mt))},viewportToImageRectangle:function(ot,dt,ft,gt,mt){var Yr=ot;ot instanceof ie.Rect?mt=dt:Yr=new ie.Rect(ot,dt,ft,gt);var Qr=this.viewportToImageCoordinates(Yr.getTopLeft(),mt),Xr=this._viewportToImageDelta(Yr.width,Yr.height,mt);return new ie.Rect(Qr.x,Qr.y,Xr.x,Xr.y,Yr.degrees-this.getRotation(mt))},viewerElementToImageCoordinates:function(ot){var dt=this.viewport.pointFromPixel(ot,!0);return this.viewportToImageCoordinates(dt)},imageToViewerElementCoordinates:function(ot){var dt=this.imageToViewportCoordinates(ot);return this.viewport.pixelFromPoint(dt,!0)},windowToImageCoordinates:function(ot){var dt=ot.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(dt)},imageToWindowCoordinates:function(ot){var dt=this.imageToViewerElementCoordinates(ot);return dt.plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(ot){var dt=this._scaleSpring.current.value;return ot=ot.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new ie.Rect((ot.x-this._xSpring.current.value)/dt,(ot.y-this._ySpring.current.value)/dt,ot.width/dt,ot.height/dt,ot.degrees)},viewportToImageZoom:function(ot){var dt=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return dt*ot},imageToViewportZoom:function(ot){var dt=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return ot/dt},setPosition:function(ot,dt){var ft=this._xSpring.target.value===ot.x&&this._ySpring.target.value===ot.y;if(dt){if(ft&&this._xSpring.current.value===ot.x&&this._ySpring.current.value===ot.y)return;this._xSpring.resetTo(ot.x),this._ySpring.resetTo(ot.y),this._needsDraw=!0}else{if(ft)return;this._xSpring.springTo(ot.x),this._ySpring.springTo(ot.y),this._needsDraw=!0}ft||this._raiseBoundsChange()},setWidth:function(ot,dt){this._setScale(ot,dt)},setHeight:function(ot,dt){this._setScale(ot/this.normHeight,dt)},setCroppingPolygons:function(ot){var dt=function(gt){return gt instanceof ie.Point||typeof gt.x=="number"&&typeof gt.y=="number"},ft=function(gt){return gt.map(function(mt){try{if(dt(mt))return{x:mt.x,y:mt.y};throw new Error}catch{throw new Error("A Provided cropping polygon point is not supported")}})};try{if(!ie.isArray(ot))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=ot.map(function(gt){return ft(gt)})}catch(gt){ie.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),ie.console.error(gt),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(ot,dt,ft){dt=dt||ie.Placement.CENTER;var gt=ie.Placement.properties[dt],mt=this.contentAspectX,Yr=0,Qr=0,Xr=1,Jr=1;if(this._clip&&(mt=this._clip.getAspectRatio(),Xr=this._clip.width/this.source.dimensions.x,Jr=this._clip.height/this.source.dimensions.y,ot.getAspectRatio()>mt?(Yr=this._clip.x/this._clip.height*ot.height,Qr=this._clip.y/this._clip.height*ot.height):(Yr=this._clip.x/this._clip.width*ot.width,Qr=this._clip.y/this._clip.width*ot.width)),ot.getAspectRatio()>mt){var ai=ot.height/Jr,oi=0;gt.isHorizontallyCentered?oi=(ot.width-ot.height*mt)/2:gt.isRight&&(oi=ot.width-ot.height*mt),this.setPosition(new ie.Point(ot.x-Yr+oi,ot.y-Qr),ft),this.setHeight(ai,ft)}else{var ni=ot.width/Xr,li=0;gt.isVerticallyCentered?li=(ot.height-ot.width/mt)/2:gt.isBottom&&(li=ot.height-ot.width/mt),this.setPosition(new ie.Point(ot.x-Yr,ot.y-Qr+li),ft),this.setWidth(ni,ft)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(ot){ie.console.assert(!ot||ot instanceof ie.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),ot instanceof ie.Rect?this._clip=ot.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getOpacity:function(){return this.opacity},setOpacity:function(ot){ot!==this.opacity&&(this.opacity=ot,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(ot){this._preload=!!ot,this._needsDraw=!0},getRotation:function(ot){return ot?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(ot,dt){this._degreesSpring.target.value===ot&&this._degreesSpring.isAtTargetValue()||(dt?this._degreesSpring.resetTo(ot):this._degreesSpring.springTo(ot),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(ot){return this.getBoundsNoRotate(ot).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(ot){ot!==this.compositeOperation&&(this.compositeOperation=ot,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(ot,dt){var ft=this._scaleSpring.target.value===ot;if(dt){if(ft&&this._scaleSpring.current.value===ot)return;this._scaleSpring.resetTo(ot),this._updateForScale(),this._needsDraw=!0}else{if(ft)return;this._scaleSpring.springTo(ot),this._updateForScale(),this._needsDraw=!0}ft||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var ot=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),dt=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,ft=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(dt/this.minPixelRatio)/Math.log(2))));return ft=Math.max(ft,this.source.minLevel||0),ot=Math.min(ot,ft),{lowestLevel:ot,highestLevel:ft}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;){var ot=this.lastDrawn.pop();ot.beingDrawn=!1}var dt=this.viewport,ft=this._viewportToTiledImageRectangle(dt.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var gt=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(ft=ft.intersection(gt),ft===null)return}for(var mt=this._getLevelsInterval(),Yr=mt.lowestLevel,Qr=mt.highestLevel,Xr=null,Jr=!1,ai=ie.now(),oi=Qr;oi>=Yr;oi--){var ni=!1,li=dt.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(oi),!0).x*this._scaleSpring.current.value;if(oi===Yr||!Jr&&li>=this.minPixelRatio)ni=!0,Jr=!0;else if(!Jr)continue;var ui=dt.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(oi),!1).x*this._scaleSpring.current.value,mi=dt.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,ii=this.immediateRender?1:mi,hi=Math.min(1,(li-.5)/.5),ri=ii/Math.abs(ii-ui);if(Xr=Z(this,Jr,ni,oi,hi,ri,ft,ai,Xr),Xe(this.coverage,oi))break}lt(this,this.lastDrawn),Xr&&!Xr.context2D?(ye(this,Xr,ai),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(this._tilesLoading===0)},_getCornerTiles:function(ot,dt,ft){var gt,mt;this.wrapHorizontal?(gt=ie.positiveModulo(dt.x,1),mt=ie.positiveModulo(ft.x,1)):(gt=Math.max(0,dt.x),mt=Math.min(1,ft.x));var Yr,Qr,Xr=1/this.source.aspectRatio;this.wrapVertical?(Yr=ie.positiveModulo(dt.y,Xr),Qr=ie.positiveModulo(ft.y,Xr)):(Yr=Math.max(0,dt.y),Qr=Math.min(Xr,ft.y));var Jr=this.source.getTileAtPoint(ot,new ie.Point(gt,Yr)),ai=this.source.getTileAtPoint(ot,new ie.Point(mt,Qr)),oi=this.source.getNumTiles(ot);return this.wrapHorizontal&&(Jr.x+=oi.x*Math.floor(dt.x),ai.x+=oi.x*Math.floor(ft.x)),this.wrapVertical&&(Jr.y+=oi.y*Math.floor(dt.y/Xr),ai.y+=oi.y*Math.floor(ft.y/Xr)),{topLeft:Jr,bottomRight:ai}}});function Z(ot,dt,ft,gt,mt,Yr,Qr,Xr,Jr){var ai=Qr.getBoundingBox().getTopLeft(),oi=Qr.getBoundingBox().getBottomRight();ot.viewer&&ot.viewer.raiseEvent("update-level",{tiledImage:ot,havedrawn:dt,level:gt,opacity:mt,visibility:Yr,drawArea:Qr,topleft:ai,bottomright:oi,currenttime:Xr,best:Jr}),nt(ot.coverage,gt),nt(ot.loadingCoverage,gt);for(var ni=ot._getCornerTiles(gt,ai,oi),li=ni.topLeft,ui=ni.bottomRight,mi=ot.source.getNumTiles(gt),ii=ot.viewport.pixelFromPoint(ot.viewport.getCenter()),hi=li.x;hi<=ui.x;hi++)for(var ri=li.y;ri<=ui.y;ri++){if(!ot.wrapHorizontal&&!ot.wrapVertical){var ci=ot.source.getTileBounds(gt,hi,ri);if(Qr.intersection(ci)===null)continue}Jr=ee(ot,ft,dt,hi,ri,gt,mt,Yr,ii,mi,Xr,Jr)}return Jr}function ee(ot,dt,ft,gt,mt,Yr,Qr,Xr,Jr,ai,oi,ni){var li=ae(gt,mt,Yr,ot,ot.source,ot.tilesMatrix,oi,ai,ot._worldWidthCurrent,ot._worldHeightCurrent),ui=ft;ot.viewer&&ot.viewer.raiseEvent("update-tile",{tiledImage:ot,tile:li}),rt(ot.coverage,Yr,gt,mt,!1);var mi=li.loaded||li.loading||Je(ot.loadingCoverage,Yr,gt,mt);if(rt(ot.loadingCoverage,Yr,gt,mt,mi),!li.exists||(dt&&!ui&&(Je(ot.coverage,Yr,gt,mt)?rt(ot.coverage,Yr,gt,mt,!0):ui=!0),!ui))return ni;if(Ye(li,ot.source.tileOverlap,ot.viewport,Jr,Xr,ot),!li.loaded)if(li.context2D)be(ot,li);else{var ii=ot._tileCache.getImageRecord(li.cacheKey);if(ii){var hi=ii.getImage();be(ot,li,hi)}}if(li.loaded){var ri=Ke(ot,li,gt,mt,Yr,Qr,oi);ri&&(ot._needsDraw=!0)}else li.loading?ot._tilesLoading++:mi||(ni=it(ni,li));return ni}function ae(ot,dt,ft,gt,mt,Yr,Qr,Xr,Jr,ai){var oi,ni,li,ui,mi,ii,hi,ri,ci;return Yr[ft]||(Yr[ft]={}),Yr[ft][ot]||(Yr[ft][ot]={}),Yr[ft][ot][dt]||(oi=(Xr.x+ot%Xr.x)%Xr.x,ni=(Xr.y+dt%Xr.y)%Xr.y,li=mt.getTileBounds(ft,oi,ni),ui=mt.getTileBounds(ft,oi,ni,!0),mi=mt.tileExists(ft,oi,ni),ii=mt.getTileUrl(ft,oi,ni),gt.loadTilesWithAjax?(hi=mt.getTileAjaxHeaders(ft,oi,ni),ie.isPlainObject(gt.ajaxHeaders)&&(hi=ie.extend({},gt.ajaxHeaders,hi))):hi=null,ri=mt.getContext2D?mt.getContext2D(ft,oi,ni):void 0,li.x+=(ot-oi)/Xr.x,li.y+=ai/Jr*((dt-ni)/Xr.y),ci=new ie.Tile(ft,ot,dt,li,mi,ii,ri,gt.loadTilesWithAjax,hi,ui),oi===Xr.x-1&&(ci.isRightMost=!0),ni===Xr.y-1&&(ci.isBottomMost=!0),Yr[ft][ot][dt]=ci),ci=Yr[ft][ot][dt],ci.lastTouchTime=Qr,ci}function ye(ot,dt,ft){dt.loading=!0,ot._imageLoader.addJob({src:dt.url,loadWithAjax:dt.loadWithAjax,ajaxHeaders:dt.ajaxHeaders,crossOriginPolicy:ot.crossOriginPolicy,ajaxWithCredentials:ot.ajaxWithCredentials,callback:function(gt,mt,Yr){ve(ot,dt,ft,gt,mt,Yr)},abort:function(){dt.loading=!1}})}function ve(ot,dt,ft,gt,mt,Yr){if(!gt){ie.console.log("Tile %s failed to load: %s - error: %s",dt,dt.url,mt),ot.viewer.raiseEvent("tile-load-failed",{tile:dt,tiledImage:ot,time:ft,message:mt,tileRequest:Yr}),dt.loading=!1,dt.exists=!1;return}if(ft<ot.lastResetTime){ie.console.log("Ignoring tile %s loaded before reset: %s",dt,dt.url),dt.loading=!1;return}var Qr=function(){var Xr=ot.source.getClosestLevel();be(ot,dt,gt,Xr,Yr)};ot._midDraw?window.setTimeout(Qr,1):Qr()}function be(ot,dt,ft,gt,mt){var Yr=0;function Qr(){return Yr++,Xr}function Xr(){Yr--,Yr===0&&(dt.loading=!1,dt.loaded=!0,dt.context2D||ot._tileCache.cacheTile({image:ft,tile:dt,cutoff:gt,tiledImage:ot}),ot._needsDraw=!0)}ot.viewer.raiseEvent("tile-loaded",{tile:dt,tiledImage:ot,tileRequest:mt,image:ft,getCompletionCallback:Qr}),Qr()()}function Ye(ot,dt,ft,gt,mt,Yr){var Qr=ot.bounds.getTopLeft();Qr.x*=Yr._scaleSpring.current.value,Qr.y*=Yr._scaleSpring.current.value,Qr.x+=Yr._xSpring.current.value,Qr.y+=Yr._ySpring.current.value;var Xr=ot.bounds.getSize();Xr.x*=Yr._scaleSpring.current.value,Xr.y*=Yr._scaleSpring.current.value;var Jr=ft.pixelFromPointNoRotate(Qr,!0),ai=ft.pixelFromPointNoRotate(Qr,!1),oi=ft.deltaPixelsFromPointsNoRotate(Xr,!0),ni=ft.deltaPixelsFromPointsNoRotate(Xr,!1),li=ai.plus(ni.divide(2)),ui=gt.squaredDistanceTo(li);dt||(oi=oi.plus(new ie.Point(1,1))),ot.isRightMost&&Yr.wrapHorizontal&&(oi.x+=.75),ot.isBottomMost&&Yr.wrapVertical&&(oi.y+=.75),ot.position=Jr,ot.size=oi,ot.squaredDistance=ui,ot.visibility=mt}function Ke(ot,dt,ft,gt,mt,Yr,Qr){var Xr=1e3*ot.blendTime,Jr,ai;if(dt.blendStart||(dt.blendStart=Qr),Jr=Qr-dt.blendStart,ai=Xr?Math.min(1,Jr/Xr):1,ot.alwaysBlend&&(ai*=Yr),dt.opacity=ai,ot.lastDrawn.push(dt),ai===1)rt(ot.coverage,mt,ft,gt,!0),ot._hasOpaqueTile=!0;else if(Jr<Xr)return!0;return!1}function Xe(ot,dt,ft,gt){var mt,Yr,Qr,Xr;if(!ot[dt])return!1;if(ft===void 0||gt===void 0){mt=ot[dt];for(Qr in mt)if(Object.prototype.hasOwnProperty.call(mt,Qr)){Yr=mt[Qr];for(Xr in Yr)if(Object.prototype.hasOwnProperty.call(Yr,Xr)&&!Yr[Xr])return!1}return!0}return ot[dt][ft]===void 0||ot[dt][ft][gt]===void 0||ot[dt][ft][gt]===!0}function Je(ot,dt,ft,gt){return ft===void 0||gt===void 0?Xe(ot,dt+1):Xe(ot,dt+1,2*ft,2*gt)&&Xe(ot,dt+1,2*ft,2*gt+1)&&Xe(ot,dt+1,2*ft+1,2*gt)&&Xe(ot,dt+1,2*ft+1,2*gt+1)}function rt(ot,dt,ft,gt,mt){if(!ot[dt]){ie.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",dt);return}ot[dt][ft]||(ot[dt][ft]={}),ot[dt][ft][gt]=mt}function nt(ot,dt){ot[dt]={}}function it(ot,dt){return!ot||dt.visibility>ot.visibility||dt.visibility==ot.visibility&&dt.squaredDistance<ot.squaredDistance?dt:ot}function lt(ot,dt){if(!(ot.opacity===0||dt.length===0&&!ot.placeholderFillStyle)){var ft=dt[0],gt;ft&&(gt=ot.opacity<1||ot.compositeOperation&&ot.compositeOperation!=="source-over"||!ot._isBottomItem()&&ft._hasTransparencyChannel());var mt,Yr,Qr=ot.viewport.getZoom(!0),Xr=ot.viewportToImageZoom(Qr);dt.length>1&&Xr>ot.smoothTileEdgesMinZoom&&!ot.iOSDevice&&ot.getRotation(!0)%360===0&&ie.supportsCanvas&&(gt=!0,mt=ft.getScaleForEdgeSmoothing(),Yr=ft.getTranslationForEdgeSmoothing(mt,ot._drawer.getCanvasSize(!1),ot._drawer.getCanvasSize(!0)));var Jr;gt&&(mt||(Jr=ot.viewport.viewportToViewerElementRectangle(ot.getClippedBounds(!0)).getIntegerBoundingBox(),ot._drawer.viewer.viewport.getFlip()&&(ot.viewport.degrees!==0||ot.getRotation(!0)%360!==0)&&(Jr.x=ot._drawer.viewer.container.clientWidth-(Jr.x+Jr.width)),Jr=Jr.times(ie.pixelDensityRatio)),ot._drawer._clear(!0,Jr)),mt||(ot.viewport.degrees!==0&&ot._drawer._offsetForRotation({degrees:ot.viewport.degrees,useSketch:gt}),ot.getRotation(!0)%360!==0&&ot._drawer._offsetForRotation({degrees:ot.getRotation(!0),point:ot.viewport.pixelFromPointNoRotate(ot._getRotationPoint(!0),!0),useSketch:gt}),ot.viewport.degrees===0&&ot.getRotation(!0)%360===0&&ot._drawer.viewer.viewport.getFlip()&&ot._drawer._flip());var ai=!1;if(ot._clip){ot._drawer.saveContext(gt);var oi=ot.imageToViewportRectangle(ot._clip,!0);oi=oi.rotate(-ot.getRotation(!0),ot._getRotationPoint(!0));var ni=ot._drawer.viewportToDrawerRectangle(oi);mt&&(ni=ni.times(mt)),Yr&&(ni=ni.translate(Yr)),ot._drawer.setClip(ni,gt),ai=!0}if(ot._croppingPolygons){ot._drawer.saveContext(gt);try{var li=ot._croppingPolygons.map(function(hi){return hi.map(function(ri){var ci=ot.imageToViewportCoordinates(ri.x,ri.y,!0).rotate(-ot.getRotation(!0),ot._getRotationPoint(!0)),Si=ot._drawer.viewportCoordToDrawerCoord(ci);return mt&&(Si=Si.times(mt)),Si})});ot._drawer.clipWithPolygons(li,gt)}catch(hi){ie.console.error(hi)}ai=!0}if(ot.placeholderFillStyle&&ot._hasOpaqueTile===!1){var ui=ot._drawer.viewportToDrawerRectangle(ot.getBounds(!0));mt&&(ui=ui.times(mt)),Yr&&(ui=ui.translate(Yr));var mi=null;typeof ot.placeholderFillStyle=="function"?mi=ot.placeholderFillStyle(ot,ot._drawer.context):mi=ot.placeholderFillStyle,ot._drawer.drawRectangle(ui,mi,gt)}for(var ii=dt.length-1;ii>=0;ii--)ft=dt[ii],ot._drawer.drawTile(ft,ot._drawingHandler,gt,mt,Yr),ft.beingDrawn=!0,ot.viewer&&ot.viewer.raiseEvent("tile-drawn",{tiledImage:ot,tile:ft});ai&&ot._drawer.restoreContext(gt),mt||(ot.getRotation(!0)%360!==0&&ot._drawer._restoreRotationChanges(gt),ot.viewport.degrees!==0&&ot._drawer._restoreRotationChanges(gt)),gt&&(mt&&(ot.viewport.degrees!==0&&ot._drawer._offsetForRotation({degrees:ot.viewport.degrees,useSketch:!1}),ot.getRotation(!0)%360!==0&&ot._drawer._offsetForRotation({degrees:ot.getRotation(!0),point:ot.viewport.pixelFromPointNoRotate(ot._getRotationPoint(!0),!0),useSketch:!1})),ot._drawer.blendSketch({opacity:ot.opacity,scale:mt,translate:Yr,compositeOperation:ot.compositeOperation,bounds:Jr}),mt&&(ot.getRotation(!0)%360!==0&&ot._drawer._restoreRotationChanges(!1),ot.viewport.degrees!==0&&ot._drawer._restoreRotationChanges(!1))),mt||ot.viewport.degrees===0&&ot.getRotation(!0)%360===0&&ot._drawer.viewer.viewport.getFlip()&&ot._drawer._flip(),ct(ot,dt)}}function ct(ot,dt){if(ot.debugMode)for(var ft=dt.length-1;ft>=0;ft--){var gt=dt[ft];try{ot._drawer.drawDebugInfo(gt,dt.length,ft,ot)}catch(mt){ie.console.error(mt)}}}}(OpenSeadragon),function(ie){var Z=function(ae){ie.console.assert(ae,"[TileCache.cacheTile] options is required"),ie.console.assert(ae.tile,"[TileCache.cacheTile] options.tile is required"),ie.console.assert(ae.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=ae.tile,this.tiledImage=ae.tiledImage},ee=function(ae){ie.console.assert(ae,"[ImageRecord] options is required"),ie.console.assert(ae.image,"[ImageRecord] options.image is required"),this._image=ae.image,this._tiles=[]};ee.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var ae=document.createElement("canvas");ae.width=this._image.width,ae.height=this._image.height,this._renderedContext=ae.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(ae){ie.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=ae},addTile:function(ae){ie.console.assert(ae,"[ImageRecord.addTile] tile is required"),this._tiles.push(ae)},removeTile:function(ae){for(var ye=0;ye<this._tiles.length;ye++)if(this._tiles[ye]===ae){this._tiles.splice(ye,1);return}ie.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",ae)},getTileCount:function(){return this._tiles.length}},ie.TileCache=function(ae){ae=ae||{},this._maxImageCacheCount=ae.maxImageCacheCount||ie.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},ie.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(ae){ie.console.assert(ae,"[TileCache.cacheTile] options is required"),ie.console.assert(ae.tile,"[TileCache.cacheTile] options.tile is required"),ie.console.assert(ae.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),ie.console.assert(ae.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var ye=ae.cutoff||0,ve=this._tilesLoaded.length,be=this._imagesLoaded[ae.tile.cacheKey];if(be||(ie.console.assert(ae.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),be=this._imagesLoaded[ae.tile.cacheKey]=new ee({image:ae.image}),this._imagesLoadedCount++),be.addTile(ae.tile),ae.tile.cacheImageRecord=be,this._imagesLoadedCount>this._maxImageCacheCount){for(var Ye=null,Ke=-1,Xe=null,Je,rt,nt,it,lt,ct,ot=this._tilesLoaded.length-1;ot>=0;ot--)if(ct=this._tilesLoaded[ot],Je=ct.tile,!(Je.level<=ye||Je.beingDrawn)){if(!Ye){Ye=Je,Ke=ot,Xe=ct;continue}it=Je.lastTouchTime,rt=Ye.lastTouchTime,lt=Je.level,nt=Ye.level,(it<rt||it==rt&&lt>nt)&&(Ye=Je,Ke=ot,Xe=ct)}Ye&&Ke>=0&&(this._unloadTile(Xe),ve=Ke)}this._tilesLoaded[ve]=new Z({tile:ae.tile,tiledImage:ae.tiledImage})},clearTilesFor:function(ae){ie.console.assert(ae,"[TileCache.clearTilesFor] tiledImage is required");for(var ye,ve=0;ve<this._tilesLoaded.length;++ve)ye=this._tilesLoaded[ve],ye.tiledImage===ae&&(this._unloadTile(ye),this._tilesLoaded.splice(ve,1),ve--)},getImageRecord:function(ae){return ie.console.assert(ae,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[ae]},_unloadTile:function(ae){ie.console.assert(ae,"[TileCache._unloadTile] tileRecord is required");var ye=ae.tile,ve=ae.tiledImage;ye.unload(),ye.cacheImageRecord=null;var be=this._imagesLoaded[ye.cacheKey];be.removeTile(ye),be.getTileCount()||(be.destroy(),delete this._imagesLoaded[ye.cacheKey],this._imagesLoadedCount--),ve.viewer.raiseEvent("tile-unloaded",{tile:ye,tiledImage:ve})}}}(OpenSeadragon),function(ie){ie.World=function(Z){var ee=this;ie.console.assert(Z.viewer,"[World] options.viewer is required"),ie.EventSource.call(this),this.viewer=Z.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(ae){ee._autoRefigureSizes?ee._figureSizes():ee._needsSizesFigured=!0},this._figureSizes()},ie.extend(ie.World.prototype,ie.EventSource.prototype,{addItem:function(Z,ee){if(ie.console.assert(Z,"[World.addItem] item is required"),ie.console.assert(Z instanceof ie.TiledImage,"[World.addItem] only TiledImages supported at this time"),ee=ee||{},ee.index!==void 0){var ae=Math.max(0,Math.min(this._items.length,ee.index));this._items.splice(ae,0,Z)}else this._items.push(Z);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,Z.addHandler("bounds-change",this._delegatedFigureSizes),Z.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:Z})},getItemAt:function(Z){return ie.console.assert(Z!==void 0,"[World.getItemAt] index is required"),this._items[Z]},getIndexOfItem:function(Z){return ie.console.assert(Z,"[World.getIndexOfItem] item is required"),ie.indexOf(this._items,Z)},getItemCount:function(){return this._items.length},setItemIndex:function(Z,ee){ie.console.assert(Z,"[World.setItemIndex] item is required"),ie.console.assert(ee!==void 0,"[World.setItemIndex] index is required");var ae=this.getIndexOfItem(Z);if(ee>=this._items.length)throw new Error("Index bigger than number of layers.");ee===ae||ae===-1||(this._items.splice(ae,1),this._items.splice(ee,0,Z),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:Z,previousIndex:ae,newIndex:ee}))},removeItem:function(Z){ie.console.assert(Z,"[World.removeItem] item is required");var ee=ie.indexOf(this._items,Z);ee!==-1&&(Z.removeHandler("bounds-change",this._delegatedFigureSizes),Z.removeHandler("clip-change",this._delegatedFigureSizes),Z.destroy(),this._items.splice(ee,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(Z))},removeAll:function(){this.viewer._cancelPendingImages();var Z,ee;for(ee=0;ee<this._items.length;ee++)Z=this._items[ee],Z.removeHandler("bounds-change",this._delegatedFigureSizes),Z.removeHandler("clip-change",this._delegatedFigureSizes),Z.destroy();var ae=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,ee=0;ee<ae.length;ee++)Z=ae[ee],this._raiseRemoveItem(Z)},resetItems:function(){for(var Z=0;Z<this._items.length;Z++)this._items[Z].reset()},update:function(){for(var Z=!1,ee=0;ee<this._items.length;ee++)Z=this._items[ee].update()||Z;return Z},draw:function(){for(var Z=0;Z<this._items.length;Z++)this._items[Z].draw();this._needsDraw=!1},needsDraw:function(){for(var Z=0;Z<this._items.length;Z++)if(this._items[Z].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(Z){this._autoRefigureSizes=Z,Z&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(Z){Z=Z||{};var ee=Z.immediately||!1,ae=Z.layout||ie.DEFAULT_SETTINGS.collectionLayout,ye=Z.rows||ie.DEFAULT_SETTINGS.collectionRows,ve=Z.columns||ie.DEFAULT_SETTINGS.collectionColumns,be=Z.tileSize||ie.DEFAULT_SETTINGS.collectionTileSize,Ye=Z.tileMargin||ie.DEFAULT_SETTINGS.collectionTileMargin,Ke=be+Ye,Xe;!Z.rows&&ve?Xe=ve:Xe=Math.ceil(this._items.length/ye);var Je=0,rt=0,nt,it,lt,ct,ot;this.setAutoRefigureSizes(!1);for(var dt=0;dt<this._items.length;dt++)dt&&dt%Xe===0&&(ae==="horizontal"?(rt+=Ke,Je=0):(Je+=Ke,rt=0)),nt=this._items[dt],it=nt.getBounds(),it.width>it.height?lt=be:lt=be*(it.width/it.height),ct=lt*(it.height/it.width),ot=new ie.Point(Je+(be-lt)/2,rt+(be-ct)/2),nt.setPosition(ot,ee),nt.setWidth(lt,ee),ae==="horizontal"?Je+=Ke:rt+=Ke;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var Z=this._homeBounds?this._homeBounds.clone():null,ee=this._contentSize?this._contentSize.clone():null,ae=this._contentFactor||0;if(!this._items.length)this._homeBounds=new ie.Rect(0,0,1,1),this._contentSize=new ie.Point(1,1),this._contentFactor=1;else{var ye=this._items[0],ve=ye.getBounds();this._contentFactor=ye.getContentSize().x/ve.width;for(var be=ye.getClippedBounds().getBoundingBox(),Ye=be.x,Ke=be.y,Xe=be.x+be.width,Je=be.y+be.height,rt=1;rt<this._items.length;rt++)ye=this._items[rt],ve=ye.getBounds(),this._contentFactor=Math.max(this._contentFactor,ye.getContentSize().x/ve.width),be=ye.getClippedBounds().getBoundingBox(),Ye=Math.min(Ye,be.x),Ke=Math.min(Ke,be.y),Xe=Math.max(Xe,be.x+be.width),Je=Math.max(Je,be.y+be.height);this._homeBounds=new ie.Rect(Ye,Ke,Xe-Ye,Je-Ke),this._contentSize=new ie.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}(this._contentFactor!==ae||!this._homeBounds.equals(Z)||!this._contentSize.equals(ee))&&this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(Z){this.raiseEvent("remove-item",{item:Z})}})}(OpenSeadragon)})(openseadragon);var openseadragonExports=openseadragon.exports;const le=getDefaultExportFromCjs$1(openseadragonExports),$6be4966fd9bbc698$var$SWITCH_NAME="Switch",[$6be4966fd9bbc698$var$createSwitchContext,$6be4966fd9bbc698$export$cf7f5f17f69cbd43]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($6be4966fd9bbc698$var$SWITCH_NAME),[$6be4966fd9bbc698$var$SwitchProvider,$6be4966fd9bbc698$var$useSwitchContext]=$6be4966fd9bbc698$var$createSwitchContext($6be4966fd9bbc698$var$SWITCH_NAME),$6be4966fd9bbc698$export$b5d5cf8927ab7262=reactExports.forwardRef((ie,Z)=>{const{__scopeSwitch:ee,name:ae,checked:ye,defaultChecked:ve,required:be,disabled:Ye,value:Ke="on",onCheckedChange:Xe,...Je}=ie,[rt,nt]=reactExports.useState(null),it=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,ft=>nt(ft)),lt=reactExports.useRef(!1),ct=rt?!!rt.closest("form"):!0,[ot=!1,dt]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:ye,defaultProp:ve,onChange:Xe});return reactExports.createElement($6be4966fd9bbc698$var$SwitchProvider,{scope:ee,checked:ot,disabled:Ye},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button",role:"switch","aria-checked":ot,"aria-required":be,"data-state":$6be4966fd9bbc698$var$getState(ot),"data-disabled":Ye?"":void 0,disabled:Ye,value:Ke},Je,{ref:it,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onClick,ft=>{dt(gt=>!gt),ct&&(lt.current=ft.isPropagationStopped(),lt.current||ft.stopPropagation())})})),ct&&reactExports.createElement($6be4966fd9bbc698$var$BubbleInput,{control:rt,bubbles:!lt.current,name:ae,value:Ke,checked:ot,required:be,disabled:Ye,style:{transform:"translateX(-100%)"}}))}),$6be4966fd9bbc698$var$THUMB_NAME="SwitchThumb",$6be4966fd9bbc698$export$4d07bf653ea69106=reactExports.forwardRef((ie,Z)=>{const{__scopeSwitch:ee,...ae}=ie,ye=$6be4966fd9bbc698$var$useSwitchContext($6be4966fd9bbc698$var$THUMB_NAME,ee);return reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({"data-state":$6be4966fd9bbc698$var$getState(ye.checked),"data-disabled":ye.disabled?"":void 0},ae,{ref:Z}))}),$6be4966fd9bbc698$var$BubbleInput=ie=>{const{control:Z,checked:ee,bubbles:ae=!0,...ye}=ie,ve=reactExports.useRef(null),be=$010c2913dbd2fe3d$export$5cae361ad82dce8b(ee),Ye=$db6c3485150b8e66$export$1ab7ae714698c4b8(Z);return reactExports.useEffect(()=>{const Ke=ve.current,Xe=window.HTMLInputElement.prototype,Je=Object.getOwnPropertyDescriptor(Xe,"checked").set;if(be!==ee&&Je){const rt=new Event("click",{bubbles:ae});Je.call(Ke,ee),Ke.dispatchEvent(rt)}},[be,ee,ae]),reactExports.createElement("input",_extends$1({type:"checkbox","aria-hidden":!0,defaultChecked:ee},ye,{tabIndex:-1,ref:ve,style:{...ie.style,...Ye,position:"absolute",pointerEvents:"none",opacity:0,margin:0}}))};function $6be4966fd9bbc698$var$getState(ie){return ie?"checked":"unchecked"}const $6be4966fd9bbc698$export$be92b6f5f03c0fe9=$6be4966fd9bbc698$export$b5d5cf8927ab7262,$6be4966fd9bbc698$export$6521433ed15a34db=$6be4966fd9bbc698$export$4d07bf653ea69106,ht=ie=>{const Z=ie.toString().split(":"),ee=Math.ceil(parseInt(Z[0])),ae=Math.ceil(parseInt(Z[1])),ye=xt(Math.ceil(parseInt(Z[2])),2);let ve=`${ee!==0&&ae<10?(ae+"").padStart(2,"0"):ae}:${ye}`;return ee!==0&&(ve=`${ee}:${ve}`),ve},Ee=ie=>{const Z=new Date(ie*1e3).toISOString().substr(11,8);return ht(Z)},we=(ie,Z)=>{if(typeof ie!="object"||ie===null)return Z;for(const ee in Z)typeof Z[ee]=="object"&&Z[ee]!==null&&!Array.isArray(Z[ee])?(ie[ee]||(ie[ee]={}),ie[ee]=we(ie[ee],Z[ee])):ie[ee]=Z[ee];return ie},Ce=(ie,Z)=>Object.hasOwn(ie,Z)?ie[Z].toString():void 0,xt=(ie,Z)=>String(ie).padStart(Z,"0"),j={background:"transparent",canvasBackgroundColor:"#6662",canvasHeight:"61.8vh",ignoreCaptionLabels:[],informationPanel:{open:!0,renderAbout:!0,renderSupplementing:!0,renderToggle:!0},openSeadragon:{},requestHeaders:{"Content-Type":"application/json"},showIIIFBadge:!0,showTitle:!0,withCredentials:!1};var xe;const _={activeCanvas:"",activeManifest:"",collection:{},configOptions:j,customDisplays:[],informationOpen:(xe=j==null?void 0:j.informationPanel)==null?void 0:xe.open,isLoaded:!1,vault:new Vault},Se=e$1.createContext(_),ke=e$1.createContext(_);function vt(ie,Z){switch(Z.type){case"updateActiveCanvas":return Z.canvasId||(Z.canvasId=""),{...ie,activeCanvas:Z.canvasId};case"updateActiveManifest":return{...ie,activeManifest:Z.manifestId};case"updateCollection":return{...ie,collection:Z.collection};case"updateConfigOptions":return{...ie,configOptions:we(ie.configOptions,Z.configOptions)};case"updateInformationOpen":return{...ie,informationOpen:Z.informationOpen};case"updateIsLoaded":return{...ie,isLoaded:Z.isLoaded};default:throw new Error(`Unhandled action type: ${Z.type}`)}}const bt=({initialState:ie=_,children:Z})=>{const[ee,ae]=reactExports.useReducer(vt,ie);return e$1.createElement(Se.Provider,{value:ee},e$1.createElement(ke.Provider,{value:ae},Z))};function k(){const ie=e$1.useContext(Se);if(ie===void 0)throw new Error("useViewerState must be used within a ViewerProvider");return ie}function O(){const ie=e$1.useContext(ke);if(ie===void 0)throw new Error("useViewerDispatch must be used within a ViewerProvider");return ie}const Ie=(ie,Z,ee,ae)=>{var ye,ve;const be={canvas:void 0,accompanyingCanvas:void 0,annotationPage:void 0,annotations:[]},Ye=Ke=>{if(Ke){if(!Ke.body||!Ke.motivation){console.error("Invalid annotation after Hyperion parsing: missing either 'body' or 'motivation'",Ke);return}let Xe=Ke.body;Array.isArray(Xe)&&(Xe=Xe[0]);const Je=ie.get(Xe.id);if(!Je)return;switch(ee){case"painting":return Ke.target===Z.id&&Ke.motivation&&Ke.motivation[0]==="painting"&&ae.includes(Je.type)&&(Ke.body=Je),!!Ke;case"supplementing":return;default:throw new Error("Invalid annotation motivation.")}}};if(be.canvas=ie.get(Z),be.canvas&&(be.annotationPage=ie.get(be.canvas.items[0]),be.accompanyingCanvas=(ye=be.canvas)!=null&&ye.accompanyingCanvas?ie.get((ve=be.canvas)==null?void 0:ve.accompanyingCanvas):void 0),be.annotationPage){const Ke=ie.get(be.annotationPage.items).map(Je=>({body:ie.get(Je.body[0].id),motivation:Je.motivation,type:"Annotation"})),Xe=[];Ke.forEach(Je=>{Je.body.type==="Choice"?Je.body.items.forEach(rt=>Xe.push({...Je,id:rt.id,body:ie.get(rt.id)})):Xe.push(Je)}),be.annotations=Xe.filter(Ye)}return be},D=(ie,Z="en")=>{if(!ie)return"";if(!ie[Z]){const ee=Object.getOwnPropertyNames(ie);if(ee.length>0)return ie[ee[0]]}return ie[Z]},N=(ie,Z)=>{const ee=Ie(ie,{id:Z,type:"Canvas"},"painting",["Image","Sound","Video"]);if(ee.annotations.length!==0&&ee.annotations&&ee.annotations)return ee.annotations.map(ae=>ae==null?void 0:ae.body)},yt=(ie,Z,ee)=>{const ae=ie.get({id:Z,type:"Canvas"});if(!(ae!=null&&ae.annotations)||!ae.annotations[0])return[];const ye=ie.get(ae.annotations[0]),ve=ie.get(ye.items);return Array.isArray(ve)?ve.filter(be=>{var Ye;if(be.body&&(Ye=be.motivation)!=null&&Ye.includes("supplementing")){let Ke=be.body;Array.isArray(Ke)&&(Ke=Ke[0]);const Xe=ie.get(Ke.id);if(Xe.format===ee)return be.body=Xe,be}}).map(be=>be.body):[]},Et=(ie,Z,ee,ae)=>{const ye=[];if(Z.canvas&&Z.canvas.thumbnail.length>0){const ve=ie.get(Z.canvas.thumbnail[0]);ye.push(ve)}if(Z.annotations[0]){if(Z.annotations[0].thumbnail&&Z.annotations[0].thumbnail.length>0){const be=ie.get(Z.annotations[0].thumbnail[0]);ye.push(be)}if(!Z.annotations[0].body)return;const ve=Z.annotations[0].body;ve.type==="Image"&&ye.push(ve)}return ye.length===0?void 0:{id:ye[0].id,format:ye[0].format,type:ye[0].type,width:ee,height:ae}},X=209,wt={colors:{primary:"#1a1d1e",primaryMuted:"#26292b",primaryAlt:"#151718",accent:`hsl(${X} 100% 38.2%)`,accentMuted:`hsl(${X} 80% 61.8%)`,accentAlt:`hsl(${X} 80% 30%)`,secondary:"#FFFFFF",secondaryMuted:"#e6e8eb",secondaryAlt:"#c1c8cd"},fontSizes:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},lineHeights:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},sizes:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},space:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},radii:{1:"4px",2:"6px",3:"8px",4:"12px",round:"50%",pill:"9999px"},transitions:{all:"all 300ms cubic-bezier(0.16, 1, 0.3, 1)"},zIndices:{1:"100",2:"200",3:"300",4:"400",max:"999"}},te={xxs:"(max-width: 349px)",xs:"(max-width: 575px)",sm:"(max-width: 767px)",md:"(max-width: 991px)",lg:"(max-width: 90rem)",xl:"(min-width: calc(90rem + 1px))"},{styled:m,css:ro,keyframes:ne,createTheme:oo}=q({theme:wt,media:te}),Ct=m("div",{display:"flex",flexDirection:"column",alignItems:"center"}),St=m("p",{fontWeight:"bold",fontSize:"x-large"}),kt=m("span",{fontSize:"medium"}),It=({error:ie})=>{const{message:Z}=ie;return e$1.createElement(Ct,{role:"alert"},e$1.createElement(St,{"data-testid":"headline"},"Something went wrong"),Z&&e$1.createElement(kt,null,`Error message: ${Z}`," "))},$e=m("div",{position:"relative",zIndex:"0"}),Ae=m("div",{display:"flex",flexDirection:"row",overflow:"hidden","@sm":{flexDirection:"column"}}),Te=m("div",{display:"flex",flexDirection:"column",flexGrow:"1",flexShrink:"1",width:"61.8%","@sm":{width:"100%"}}),Me=m($409067139f391064$export$41fb9f06171c75f4,{display:"none",border:"none",padding:"0",transition:"$all",opacity:"1",background:"#6663",margin:"1rem 0",borderRadius:"6px","&[data-information-panel='false']":{opacity:"0",marginTop:"-59px"},"@sm":{display:"flex","> span":{display:"flex",flexGrow:"1",fontSize:"0.8333em",justifyContent:"center",padding:"0.5rem",fontFamily:"inherit"}}}),Re=m($409067139f391064$export$7c6e2c02157bb7d2,{width:"100%",display:"flex"}),$t=m("aside",{display:"flex",flexGrow:"1",flexShrink:"0",width:"38.2%",maxHeight:"100%","@sm":{width:"100%"}}),At=m("div",{display:"flex",flexDirection:"column",fontSmooth:"auto",webkitFontSmoothing:"antialiased","> div":{display:"flex",flexDirection:"column",flexGrow:"1",justifyContent:"flex-start","@sm":{[`& ${Ae}`]:{flexGrow:"1"},[`& ${Te}`]:{flexGrow:"0"}}},"@sm":{padding:"0"},"&[data-information-panel-open='true']":{"@sm":{position:"fixed",height:"100%",width:"100%",top:"0",left:"0",zIndex:"2500000000",[`& ${$e}`]:{display:"none"},[`& ${Me}`]:{margin:"1rem"},[`& ${Re}`]:{height:"100%"}}}}),Tt=m($69cb30bb0017df05$export$be92b6f5f03c0fe9,{display:"flex",flexDirection:"column",width:"100%",height:"100%",flexGrow:"1",flexShrink:"0",position:"relative",zIndex:"1",maskImage:"linear-gradient(180deg, rgba(0, 0, 0, 1) calc(100% - 2rem), transparent 100%)","@sm":{marginTop:"0.5rem",boxShadow:"none"}}),Mt=m($69cb30bb0017df05$export$54c2e3dc7acea9f5,{display:"flex",flexGrow:"0",margin:"0 1.618rem",borderBottom:"4px solid #6663","@sm":{margin:"0 1rem"}}),se=m($69cb30bb0017df05$export$41fb9f06171c75f4,{display:"flex",position:"relative",padding:"0.5rem 1rem",background:"none",backgroundColor:"transparent",fontFamily:"inherit",border:"none",opacity:"0.7",fontSize:"1rem",marginRight:"1rem",lineHeight:"1rem",whiteSpace:"nowrap",cursor:"pointer",fontWeight:400,transition:"$all","&::after":{width:"0",height:"4px",content:"",position:"absolute",bottom:"-4px",left:"0",transition:"$all"},"&[data-state='active']":{opacity:"1",fontWeight:700,"&::after":{width:"100%",backgroundColor:"$accent"}}}),ce=m($69cb30bb0017df05$export$7c6e2c02157bb7d2,{display:"flex",flexGrow:"1",flexShrink:"0",position:"absolute",top:"0",left:"0","&[data-state='active']":{width:"100%",height:"calc(100% - 2rem)",padding:"1.618rem 0"}}),Rt=m("div",{position:"relative",height:"100%",width:"100%",overflowY:"scroll"}),zt=m("div",{padding:" 0 1.618rem 2rem",display:"flex",flexDirection:"column",overflow:"scroll",position:"absolute",fontWeight:"400",fontSize:"1rem",zIndex:"0",img:{maxWidth:"100px",maxHeight:"100px",objectFit:"contain",color:"transparent",margin:"0 0 1rem",borderRadius:"3px",backgroundColor:"$secondaryMuted"},video:{display:"none"},"a, a:visited":{color:"$accent"},p:{fontSize:"1rem",lineHeight:"1.45em",margin:"0"},dl:{margin:"0",dt:{fontWeight:"700",margin:"1rem 0 0.25rem"},dd:{margin:"0"}},".manifest-property-title":{fontWeight:"700",margin:"1rem 0 0.25rem"},"ul, ol":{padding:"0",margin:"0",li:{fontSize:"1rem",lineHeight:"1.45em",listStyle:"none",margin:"0.25rem 0 0.25rem"}}}),Lt=m("div",{position:"relative",width:"100%",height:"100%",zIndex:"0"}),ze=(ie,Z="none")=>{if(!ie)return null;if(typeof ie=="string")return[ie];if(!ie[Z]){const ee=Object.getOwnPropertyNames(ie);if(ee.length>0)return ie[ee[0]]}return!ie[Z]||!Array.isArray(ie[Z])?null:ie[Z]},R=(ie,Z="none",ee=", ")=>{const ae=ze(ie,Z);return Array.isArray(ae)?ae.join(`${ee}`):ae};function Ft(ie){return{__html:Pt(ie)}}function T(ie,Z){const ee=Object.keys(ie).filter(ye=>Z.includes(ye)?null:ye),ae=new Object;return ee.forEach(ye=>{ae[ye]=ie[ye]}),ae}function Pt(ie){return at(ie,{allowedAttributes:{a:["href"],img:["alt","src","height","width"]},allowedSchemes:["http","https","mailto"],allowedTags:["a","b","br","i","img","p","small","span","sub","sup"]})}const Vt=m("span",{}),L=ie=>{const{as:Z,label:ee}=ie,ae=T(ie,["as","label"]);return e$1.createElement(Vt,{as:Z,...ae},R(ee,ae.lang))},Bt=(ie,Z="200,",ee="full")=>{Array.isArray(ie)&&(ie=ie[0]);const{id:ae,service:ye}=ie;let ve;if(!ye)return ae;if(Array.isArray(ie.service)&&ie.service.length>0&&(ve=ye[0]),ve){if(ve["@id"])return`${ve["@id"]}/${ee}/${Z}/0/default.jpg`;if(ve.id)return`${ve.id}/${ee}/${Z}/0/default.jpg`}},de=m("img",{objectFit:"cover"}),Ht=ie=>{const Z=reactExports.useRef(null),{contentResource:ee,altAsLabel:ae,region:ye="full"}=ie;let ve;ae&&(ve=R(ae));const be=T(ie,["contentResource","altAsLabel"]),{type:Ye,id:Ke,width:Xe=200,height:Je=200,duration:rt}=ee;reactExports.useEffect(()=>{if(!Ke&&!Z.current||["Image"].includes(Ye)||!Ke.includes("m3u8"))return;const lt=new Hls;return Z.current&&(lt.attachMedia(Z.current),lt.on(Hls.Events.MEDIA_ATTACHED,function(){lt.loadSource(Ke)})),lt.on(Hls.Events.ERROR,function(ct,ot){if(ot.fatal)switch(ot.type){case Hls.ErrorTypes.NETWORK_ERROR:console.error(`fatal ${ct} network error encountered, try to recover`),lt.startLoad();break;case Hls.ErrorTypes.MEDIA_ERROR:console.error(`fatal ${ct} media error encountered, try to recover`),lt.recoverMediaError();break;default:lt.destroy();break}}),()=>{lt&&(lt.detachMedia(),lt.destroy())}},[Ke,Ye]);const nt=reactExports.useCallback(()=>{if(!Z.current)return;let lt=0,ct=30;if(rt&&(ct=rt),!Ke.split("#t=")&&rt&&(lt=rt*.1),Ke.split("#t=").pop()){const dt=Ke.split("#t=").pop();dt&&(lt=parseInt(dt.split(",")[0]))}const ot=Z.current;ot.autoplay=!0,ot.currentTime=lt,setTimeout(()=>nt(),ct*1e3)},[rt,Ke]);reactExports.useEffect(()=>nt(),[nt]);const it=Bt(ee,`${Xe},${Je}`,ye);switch(Ye){case"Image":return e$1.createElement(de,{as:"img",alt:ve,css:{width:Xe,height:Je},key:Ke,src:it,...be});case"Video":return e$1.createElement(de,{as:"video",css:{width:Xe,height:Je},disablePictureInPicture:!0,key:Ke,loop:!0,muted:!0,onPause:nt,ref:Z,src:Ke});default:return console.warn(`Resource type: ${Ye} is not valid or not yet supported in Primitives.`),e$1.createElement(e$1.Fragment,null)}},Ot=m("a",{}),Dt=ie=>{const{children:Z,homepage:ee}=ie,ae=T(ie,["children","homepage"]);return e$1.createElement(e$1.Fragment,null,ee&&ee.map(ye=>{const ve=R(ye.label,ae.lang);return e$1.createElement(Ot,{"aria-label":Z?ve:void 0,href:ye.id,key:ye.id,...ae},Z||ve)}))},Wt={delimiter:", "},re=reactExports.createContext(void 0),Le=()=>{const ie=reactExports.useContext(re);if(ie===void 0)throw new Error("usePrimitivesContext must be used with a PrimitivesProvider");return ie},oe=({children:ie,initialState:Z=Wt})=>{const ee=jt(Z,"delimiter");return e$1.createElement(re.Provider,{value:{delimiter:ee}},ie)},jt=(ie,Z)=>Object.hasOwn(ie,Z)?ie[Z].toString():void 0,Nt=m("span",{}),me=ie=>{const{as:Z,markup:ee}=ie,{delimiter:ae}=Le();if(!ee)return e$1.createElement(e$1.Fragment,null);const ye=T(ie,["as","markup"]),ve=Ft(R(ee,ye.lang,ae));return e$1.createElement(Nt,{as:Z,...ye,dangerouslySetInnerHTML:ve})},Fe=ie=>e$1.useContext(re)?e$1.createElement(me,{...ie}):e$1.createElement(oe,null,e$1.createElement(me,{...ie})),Gt=({as:ie="dd",lang:Z,value:ee})=>e$1.createElement(Fe,{markup:ee,as:ie,lang:Z}),qt=m("span",{}),Ut=({as:ie="dd",customValueContent:Z,lang:ee,value:ae})=>{var ye;const{delimiter:ve}=Le(),be=(ye=ze(ae,ee))==null?void 0:ye.map(Ye=>reactExports.cloneElement(Z,{value:Ye}));return e$1.createElement(qt,{as:ie,lang:ee},be==null?void 0:be.map((Ye,Ke)=>[Ke>0&&`${ve}`,e$1.createElement(reactExports.Fragment,{key:Ke},Ye)]))},Pe=ie=>{var Z;const{item:ee,lang:ae,customValueContent:ye}=ie,{label:ve,value:be}=ee,Ye=(Z=R(ve))==null?void 0:Z.replace(" ","-").toLowerCase();return e$1.createElement("div",{role:"group","data-label":Ye},e$1.createElement(L,{as:"dt",label:ve,lang:ae}),ye?e$1.createElement(Ut,{as:"dd",customValueContent:ye,value:be,lang:ae}):e$1.createElement(Gt,{as:"dd",value:be,lang:ae}))};function _t(ie,Z){const ee=Z.filter(ae=>{const{matchingLabel:ye}=ae,ve=Object.keys(ae.matchingLabel)[0],be=R(ye,ve);if(R(ie,ve)===be)return!0}).map(ae=>ae.Content);if(Array.isArray(ee))return ee[0]}const Zt=m("dl",{}),Xt=ie=>{const{as:Z,customValueContent:ee,metadata:ae}=ie;if(!Array.isArray(ae))return e$1.createElement(e$1.Fragment,null);const ye=Ce(ie,"customValueDelimiter"),ve=T(ie,["as","customValueContent","customValueDelimiter","metadata"]);return e$1.createElement(oe,{...typeof ye=="string"?{initialState:{delimiter:ye}}:void 0},ae.length>0&&e$1.createElement(Zt,{as:Z,...ve},ae.map((be,Ye)=>{const Ke=ee?_t(be.label,ee):void 0;return e$1.createElement(Pe,{customValueContent:Ke,item:be,key:Ye,lang:ve==null?void 0:ve.lang})})))};m("li",{});m("ul",{});const Yt=m("dl",{}),Kt=ie=>{const{as:Z,requiredStatement:ee}=ie;if(!ee)return e$1.createElement(e$1.Fragment,null);const ae=Ce(ie,"customValueDelimiter"),ye=T(ie,["as","customValueDelimiter","requiredStatement"]);return e$1.createElement(oe,{...typeof ae=="string"?{initialState:{delimiter:ae}}:void 0},e$1.createElement(Yt,{as:Z,...ye},e$1.createElement(Pe,{item:ee,lang:ye.lang})))},Jt=m("li",{}),Qt=m("ul",{}),en=ie=>{const{as:Z,seeAlso:ee}=ie,ae=T(ie,["as","seeAlso"]);return e$1.createElement(Qt,{as:Z},ee&&ee.map(ye=>{const ve=R(ye.label,ae.lang);return e$1.createElement(Jt,{key:ye.id},e$1.createElement("a",{href:ye.id,...ae},ve||ye.id))}))},tn=ie=>{const{as:Z,summary:ee}=ie,ae=T(ie,["as","customValueDelimiter","summary"]);return e$1.createElement(Fe,{as:Z,markup:ee,...ae})},Ve=ie=>{const{thumbnail:Z,region:ee}=ie,ae=T(ie,["thumbnail"]);return e$1.createElement(e$1.Fragment,null,Z&&Z.map(ye=>e$1.createElement(Ht,{contentResource:ye,key:ye.id,region:ee,...ae})))},nn=({homepage:ie})=>(ie==null?void 0:ie.length)===0?e$1.createElement(e$1.Fragment,null):e$1.createElement(e$1.Fragment,null,e$1.createElement("span",{className:"manifest-property-title"},"Homepage"),e$1.createElement(Dt,{homepage:ie})),rn=({id:ie,htmlLabel:Z,parent:ee="manifest"})=>e$1.createElement(e$1.Fragment,null,e$1.createElement("span",{className:"manifest-property-title"},Z),e$1.createElement("a",{href:ie,target:"_blank",id:`iiif-${ee}-id`},ie)),on=({metadata:ie,parent:Z="manifest"})=>ie?e$1.createElement(e$1.Fragment,null,e$1.createElement(Xt,{metadata:ie,id:`iiif-${Z}-metadata`})):e$1.createElement(e$1.Fragment,null),an=({requiredStatement:ie,parent:Z="manifest"})=>ie?e$1.createElement(e$1.Fragment,null,e$1.createElement(Kt,{requiredStatement:ie,id:`iiif-${Z}-required-statement`})):e$1.createElement(e$1.Fragment,null),ln=({rights:ie})=>ie?e$1.createElement(e$1.Fragment,null,e$1.createElement("span",{className:"manifest-property-title"},"Rights"),e$1.createElement("a",{href:ie,target:"_blank"},ie)):e$1.createElement(e$1.Fragment,null),sn=({seeAlso:ie})=>(ie==null?void 0:ie.length)===0?e$1.createElement(e$1.Fragment,null):e$1.createElement(e$1.Fragment,null,e$1.createElement("span",{className:"manifest-property-title"},"See Also"),e$1.createElement(en,{seeAlso:ie})),cn=({summary:ie,parent:Z="manifest"})=>ie?e$1.createElement(e$1.Fragment,null,e$1.createElement(tn,{summary:ie,as:"p",id:`iiif-${Z}-summary`})):e$1.createElement(e$1.Fragment,null),dn=({label:ie,thumbnail:Z})=>(Z==null?void 0:Z.length)===0?e$1.createElement(e$1.Fragment,null):e$1.createElement(e$1.Fragment,null,e$1.createElement(Ve,{altAsLabel:ie||{none:["resource"]},thumbnail:Z,style:{backgroundColor:"#6663",objectFit:"cover"}})),mn=()=>{const ie=k(),{activeManifest:Z,vault:ee}=ie,[ae,ye]=reactExports.useState(),[ve,be]=reactExports.useState([]),[Ye,Ke]=reactExports.useState([]),[Xe,Je]=reactExports.useState([]);return reactExports.useEffect(()=>{var rt,nt,it;const lt=ee.get(Z);ye(lt),((rt=lt.homepage)==null?void 0:rt.length)>0&&be(ee.get(lt.homepage)),((nt=lt.seeAlso)==null?void 0:nt.length)>0&&Ke(ee.get(lt.seeAlso)),((it=lt.thumbnail)==null?void 0:it.length)>0&&Je(ee.get(lt.thumbnail))},[Z,ee]),ae?e$1.createElement(Lt,null,e$1.createElement(zt,null,e$1.createElement(dn,{thumbnail:Xe,label:ae.label}),e$1.createElement(cn,{summary:ae.summary}),e$1.createElement(on,{metadata:ae.metadata}),e$1.createElement(an,{requiredStatement:ae.requiredStatement}),e$1.createElement(ln,{rights:ae.rights}),e$1.createElement(nn,{homepage:ve}),e$1.createElement(sn,{seeAlso:Ye}),e$1.createElement(rn,{id:ae.id,htmlLabel:"IIIF Manifest"}))):e$1.createElement(e$1.Fragment,null)},un=()=>{function ie(ye){return ye.map(ve=>{const be=ve.identifier||v4();return{...ve,identifier:be}})}function Z(ye){var ve;const be=[],Ye=[],Ke=ie(ye);for(const Xe of Ke){for(;Ye.length>0&&Ye[Ye.length-1].end<=Xe.start;)Ye.pop();Ye.length>0?(Ye[Ye.length-1].children||(Ye[Ye.length-1].children=[]),(ve=Ye[Ye.length-1].children)==null||ve.push(Xe),Ye.push(Xe)):(be.push(Xe),Ye.push(Xe))}return be}function ee(ye,ve=[]){return ve.some(be=>ye.start>=be.start&&ye.end<=be.end)}function ae(ye=[]){return ye.sort((ve,be)=>ve.start-be.start)}return{addIdentifiersToParsedCues:ie,createNestedCues:Z,isChild:ee,orderCuesByTime:ae}},ue=ne({from:{transform:"rotate(360deg)"},to:{transform:"rotate(0deg)"}}),pn=m($f99a8c78507165f7$export$be92b6f5f03c0fe9,{display:"flex",flexDirection:"column",width:"100%"}),Be=m($f99a8c78507165f7$export$6d08773d2e66f8f2,{position:"relative",cursor:"pointer",display:"flex",width:"100%",justifyContent:"space-between",textAlign:"left",margin:"0",padding:"0.5rem 1.618rem",fontFamily:"inherit",lineHeight:"1.25em",fontSize:"1rem",color:"inherit",border:"none",background:"none","@sm":{padding:"0.5rem 1rem",fontSize:"0.8333rem"},"&::before":{content:"",width:"12px",height:"12px",borderRadius:"12px",position:"absolute",backgroundColor:"$primaryMuted",opacity:"0",left:"8px",marginTop:"3px",boxSizing:"content-box","@sm":{content:"unset"}},"&::after":{content:"",width:"4px",height:"6px",position:"absolute",backgroundColor:"$secondary",opacity:"0",clipPath:"polygon(100% 50%, 0 100%, 0 0)",left:"13px",marginTop:"6px",boxSizing:"content-box","@sm":{content:"unset"}},strong:{marginLeft:"1rem"},"&:hover":{color:"$accent","&::before":{backgroundColor:"$accent",opacity:"1"},"&::after":{content:"",width:"4px",height:"6px",position:"absolute",backgroundColor:"$secondary",clipPath:"polygon(100% 50%, 0 100%, 0 0)",opacity:"1"}},"&[aria-checked='true']":{backgroundColor:"#6663","&::before":{content:"",width:"6px",height:"6px",position:"absolute",backgroundColor:"transparent",border:"3px solid $accentMuted",borderRadius:"12px",left:"8px",marginTop:"4px",opacity:"1",animation:"1s linear infinite",animationName:ue,boxSizing:"content-box","@sm":{content:"unset"}},"&::after":{content:"",width:"6px",height:"6px",position:"absolute",backgroundColor:"transparent",border:"3px solid $accent",clipPath:"polygon(100% 0, 100% 100%, 0 0)",borderRadius:"12px",left:"8px",marginTop:"4px",opacity:"1",animation:"1.5s linear infinite",animationName:ue,boxSizing:"content-box","@sm":{content:"unset"}}}}),fn=({label:ie,start:Z,end:ee})=>{const[ae,ye]=reactExports.useState(!1),ve=document.getElementById("clover-iiif-video");reactExports.useEffect(()=>(ve==null||ve.addEventListener("timeupdate",()=>{const{currentTime:Ye}=ve;ye(Z<=Ye&&Ye<ee)}),()=>document.removeEventListener("timeupdate",()=>{})),[ee,Z,ve]);const be=()=>{ve&&(ve.pause(),ve.currentTime=Z,ve.play())};return e$1.createElement(Be,{"aria-checked":ae,"data-testid":"information-panel-cue",onClick:be,value:ie},ie,e$1.createElement("strong",null,Ee(Z)))},gn=m("ul",{listStyle:"none",paddingLeft:"1rem",position:"relative","&&:first-child":{paddingLeft:"0"},"& li ul":{[`& ${Be}`]:{backgroundColor:"unset","&::before":{content:"none"},"&::after":{content:"none"}}},"&:first-child":{margin:"0 0 1.618rem"}}),He=({items:ie})=>e$1.createElement(gn,null,ie.map(Z=>{const{text:ee,start:ae,end:ye,children:ve,identifier:be}=Z;return e$1.createElement("li",{key:be},e$1.createElement(fn,{label:ee,start:ae,end:ye}),ve&&e$1.createElement(He,{items:ve}))})),hn=({resource:ie})=>{const[Z,ee]=e$1.useState([]),{id:ae,label:ye}=ie,{createNestedCues:ve,orderCuesByTime:be}=un();return reactExports.useEffect(()=>{ae&&fetch(ae,{headers:{"Content-Type":"text/plain",Accept:"application/json"}}).then(Ye=>Ye.text()).then(Ye=>{const Ke=nodeWebvtt.parse(Ye).cues,Xe=be(Ke),Je=ve(Xe);ee(Je)}).catch(Ye=>console.error(ae,Ye.toString()))},[ae]),e$1.createElement(pn,{"aria-label":`navigate ${D(ye,"en")}`},e$1.createElement(He,{items:Z}))},xn=({activeCanvas:ie,resources:Z})=>{var ee;const ae=k(),{configOptions:ye}=ae,{informationPanel:ve}=ye,[be,Ye]=reactExports.useState(),Ke=(ve==null?void 0:ve.renderAbout)||((ee=ye==null?void 0:ye.informationPanel)==null?void 0:ee.renderAbout),Xe=ve==null?void 0:ve.renderSupplementing;reactExports.useEffect(()=>{Ke?Ye("manifest-about"):Z&&(Z==null?void 0:Z.length)>0&&!Ke&&Ye(Z[0].id)},[ie,Ke,Z]);const Je=rt=>{Ye(rt)};return Z?e$1.createElement(Tt,{"data-testid":"information-panel",defaultValue:be,onValueChange:Je,orientation:"horizontal",value:be,className:"clover-viewer-information-panel"},e$1.createElement(Mt,{"aria-label":"select chapter","data-testid":"information-panel-list"},Ke&&e$1.createElement(se,{value:"manifest-about"},"About"),Xe&&Z&&Z.map(({id:rt,label:nt})=>e$1.createElement(se,{key:rt,value:rt},e$1.createElement(L,{label:nt})))),e$1.createElement(Rt,null,Ke&&e$1.createElement(ce,{value:"manifest-about"},e$1.createElement(mn,null)),Xe&&Z&&Z.map(rt=>e$1.createElement(ce,{key:rt.id,value:rt.id},e$1.createElement(hn,{resource:rt}))))):e$1.createElement(e$1.Fragment,null)},Oe=m("div",{position:"absolute",right:"1rem",top:"1rem",display:"flex",justifyContent:"flex-end",zIndex:"1"}),vn=m("input",{flexGrow:"1",border:"none",backgroundColor:"$secondaryMuted",color:"$primary",marginRight:"1rem",height:"2rem",padding:"0 1rem",borderRadius:"2rem",fontFamily:"inherit",fontSize:"1rem",lineHeight:"1rem",boxShadow:"inset 1px 1px 2px #0003","&::placeholder":{color:"$primaryMuted"}}),Y=m("button",{display:"flex",background:"none",border:"none",width:"2rem !important",height:"2rem !important",padding:"0",margin:"0",fontWeight:"700",borderRadius:"2rem",backgroundColor:"$accent",color:"$secondary",cursor:"pointer",boxSizing:"content-box !important",transition:"$all",svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",opacity:"1",filter:"drop-shadow(5px 5px 5px #000D)",boxSizing:"inherit",transition:"$all"},"&:disabled":{backgroundColor:"transparent",boxShadow:"none",svg:{opacity:"0.25"}}}),bn=m("div",{display:"flex",marginRight:"0.618rem",backgroundColor:"$accentAlt",borderRadius:"2rem",boxShadow:"5px 5px 5px #0003",color:"$secondary",alignItems:"center","> span":{display:"flex",margin:"0 0.5rem",fontSize:"0.7222rem"}}),yn=m("div",{display:"flex",position:"relative",zIndex:"1",width:"100%",padding:"0",transition:"$all",variants:{isToggle:{true:{paddingTop:"2.618rem",[`& ${Oe}`]:{width:"calc(100% - 2rem)","@sm":{width:"calc(100% - 2rem)"}}}}}}),En=(ie,Z)=>{reactExports.useEffect(()=>{function ee(ae){ae.key===ie&&Z()}return window.addEventListener("keyup",ee),()=>window.removeEventListener("keyup",ee)},[])},wn=()=>e$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},e$1.createElement("title",null,"Arrow Back"),e$1.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M244 400L100 256l144-144M120 256h292"})),Cn=()=>e$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},e$1.createElement("title",null,"Arrow Forward"),e$1.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M268 112l144 144-144 144M392 256H100"})),Sn=()=>e$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},e$1.createElement("title",null,"Close"),e$1.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})),kn=()=>e$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},e$1.createElement("title",null,"Search"),e$1.createElement("path",{d:"M456.69 421.39L362.6 327.3a173.81 173.81 0 0034.84-104.58C397.44 126.38 319.06 48 222.72 48S48 126.38 48 222.72s78.38 174.72 174.72 174.72A173.81 173.81 0 00327.3 362.6l94.09 94.09a25 25 0 0035.3-35.3zM97.92 222.72a124.8 124.8 0 11124.8 124.8 124.95 124.95 0 01-124.8-124.8z"})),In=({handleCanvasToggle:ie,handleFilter:Z,activeIndex:ee,canvasLength:ae})=>{const[ye,ve]=reactExports.useState(!1),[be,Ye]=reactExports.useState(!1),[Ke,Xe]=reactExports.useState(!1);reactExports.useEffect(()=>{Xe(ee===0),ee===ae-1?Ye(!0):Ye(!1)},[ee,ae]),En("Escape",()=>{ve(!1),Z("")});const Je=()=>{ve(nt=>!nt),Z("")},rt=nt=>Z(nt.target.value);return e$1.createElement(yn,{isToggle:ye},e$1.createElement(Oe,null,ye&&e$1.createElement(vn,{autoFocus:!0,onChange:rt,placeholder:"Search"}),!ye&&e$1.createElement(bn,null,e$1.createElement(Y,{onClick:()=>ie(-1),disabled:Ke,type:"button"},e$1.createElement(wn,null)),e$1.createElement("span",null,ee+1," of ",ae),e$1.createElement(Y,{onClick:()=>ie(1),disabled:be,type:"button"},e$1.createElement(Cn,null))),e$1.createElement(Y,{onClick:Je,type:"button"},ye?e$1.createElement(Sn,null):e$1.createElement(kn,null))))},$n=m($f99a8c78507165f7$export$be92b6f5f03c0fe9,{display:"flex",flexDirection:"row",flexGrow:"1",padding:"1.618rem",overflowX:"scroll",position:"relative",zIndex:"0"}),An=()=>e$1.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M256 112v288M400 256H112"}),Tn=()=>e$1.createElement(e$1.Fragment,null,e$1.createElement("path",{d:"M232 416a23.88 23.88 0 01-14.2-4.68 8.27 8.27 0 01-.66-.51L125.76 336H56a24 24 0 01-24-24V200a24 24 0 0124-24h69.75l91.37-74.81a8.27 8.27 0 01.66-.51A24 24 0 01256 120v272a24 24 0 01-24 24zm-106.18-80zm-.27-159.86zM320 336a16 16 0 01-14.29-23.19c9.49-18.87 14.3-38 14.3-56.81 0-19.38-4.66-37.94-14.25-56.73a16 16 0 0128.5-14.54C346.19 208.12 352 231.44 352 256c0 23.86-6 47.81-17.7 71.19A16 16 0 01320 336z"}),e$1.createElement("path",{d:"M368 384a16 16 0 01-13.86-24C373.05 327.09 384 299.51 384 256c0-44.17-10.93-71.56-29.82-103.94a16 16 0 0127.64-16.12C402.92 172.11 416 204.81 416 256c0 50.43-13.06 83.29-34.13 120a16 16 0 01-13.87 8z"}),e$1.createElement("path",{d:"M416 432a16 16 0 01-13.39-24.74C429.85 365.47 448 323.76 448 256c0-66.5-18.18-108.62-45.49-151.39a16 16 0 1127-17.22C459.81 134.89 480 181.74 480 256c0 64.75-14.66 113.63-50.6 168.74A16 16 0 01416 432z"})),Mn=()=>e$1.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"}),Rn=()=>e$1.createElement("path",{d:"M416 64H96a64.07 64.07 0 00-64 64v256a64.07 64.07 0 0064 64h320a64.07 64.07 0 0064-64V128a64.07 64.07 0 00-64-64zm-80 64a48 48 0 11-48 48 48.05 48.05 0 0148-48zM96 416a32 32 0 01-32-32v-67.63l94.84-84.3a48.06 48.06 0 0165.8 1.9l64.95 64.81L172.37 416zm352-32a32 32 0 01-32 32H217.63l121.42-121.42a47.72 47.72 0 0161.64-.16L448 333.84z"}),zn=()=>e$1.createElement("path",{d:"M464 384.39a32 32 0 01-13-2.77 15.77 15.77 0 01-2.71-1.54l-82.71-58.22A32 32 0 01352 295.7v-79.4a32 32 0 0113.58-26.16l82.71-58.22a15.77 15.77 0 012.71-1.54 32 32 0 0145 29.24v192.76a32 32 0 01-32 32zM268 400H84a68.07 68.07 0 01-68-68V180a68.07 68.07 0 0168-68h184.48A67.6 67.6 0 01336 179.52V332a68.07 68.07 0 01-68 68z"}),De=m("svg",{display:"inline-flex",variants:{isLarge:{true:{height:"4rem",width:"4rem"}},isMedium:{true:{height:"2rem",width:"2rem"}},isSmall:{true:{height:"1rem",width:"1rem"}}}}),Ln=({children:ie})=>e$1.createElement("title",null,ie),S=ie=>e$1.createElement(De,{...ie,"data-testid":"icon-svg",role:"img",viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg"},ie.children);S.Title=Ln;S.Add=An;S.Audio=Tn;S.Close=Mn;S.Image=Rn;S.Video=zn;const Fn=ne({"0%":{opacity:0,transform:"translateY(1rem)"},"100%":{opacity:1,transform:"translateY(0)"}}),Pn=ne({"0%":{opacity:0,transform:"translateY(1rem)"},"100%":{opacity:1,transform:"translateY(0)"}}),We=m($cb5cc270b50c6fcd$export$21b07c8f274aebd5,{fill:"$secondaryAlt"}),Vn=m($cb5cc270b50c6fcd$export$f39c2d165cd861fe,{position:"absolute",right:"0",top:"0",padding:"0.5rem",margin:"0",cursor:"pointer",border:"none",background:"none",fill:"inherit","&:hover":{opacity:"0.75"}}),Bn=m($cb5cc270b50c6fcd$export$7c6e2c02157bb7d2,{border:"none",backgroundColor:"white",fill:"inhrerit",padding:"1rem 2rem 1rem 1rem",width:"auto",minWidth:"200px",maxWidth:"350px",borderRadius:"3px",boxShadow:"5px 5px 13px #0002",animationDuration:"0.3s",animationTimingFunction:"cubic-bezier(0.16, 1, 0.3, 1)",'&[data-side="top"]':{animationName:Pn},'&[data-side="bottom"]':{animationName:Fn},'&[data-align="end"]':{[`& ${We}`]:{margin:"0 0.7rem"}}}),Hn=m($cb5cc270b50c6fcd$export$41fb9f06171c75f4,{display:"inline-flex",padding:"0.5rem 0",margin:"0 0.5rem 0 0",cursor:"pointer",border:"none",background:"none","> button, > span":{margin:"0"}}),On=m($cb5cc270b50c6fcd$export$be92b6f5f03c0fe9,{boxSizing:"content-box"}),Dn=ie=>e$1.createElement(Hn,{...ie},ie.children),Wn=ie=>e$1.createElement(Bn,{...ie},e$1.createElement(We,null),e$1.createElement(Vn,null,e$1.createElement(S,{isSmall:!0},e$1.createElement(S.Close,null))),ie.children),W=({children:ie})=>e$1.createElement(On,null,ie);W.Trigger=Dn;W.Content=Wn;const J=m("div",{boxSizing:"border-box",display:"inline-flex",alignItems:"center",borderRadius:"5px",padding:"$1",marginBottom:"$2",marginRight:"$2",backgroundColor:"$lightGrey",color:"$richBlack50",textTransform:"uppercase",fontSize:"$2",objectFit:"contain",lineHeight:"1em !important","&:last-child":{marginRight:"0"},[`${De}`]:{position:"absolute",left:"$1",height:"$3",width:"$3"},variants:{isIcon:{true:{position:"relative",paddingLeft:"$5"}}}}),Q=m("span",{display:"flex"}),jn=m("span",{display:"flex",width:"1.2111rem",height:"0.7222rem"}),Nn=m("span",{display:"inline-flex",marginLeft:"5px",marginBottom:"-1px"}),Gn=m($f99a8c78507165f7$export$6d08773d2e66f8f2,{display:"flex",flexShrink:"0",margin:"0 1.618rem 0 0",padding:"0",cursor:"pointer",background:"none",border:"none",fontFamily:"inherit",lineHeight:"1.25em",fontSize:"1rem",textAlign:"left","&:last-child":{marginRight:"1rem"},figure:{margin:"0",width:"161.8px","> div":{position:"relative",display:"flex",backgroundColor:"$secondaryAlt",width:"inherit",height:"100px",overflow:"hidden",borderRadius:"3px",transition:"$all",img:{width:"100%",height:"100%",objectFit:"cover",filter:"blur(0)",transform:"scale3d(1, 1, 1)",transition:"$all",color:"transparent"},[`& ${Q}`]:{position:"absolute",right:"0",bottom:"0",[`& ${J}`]:{margin:"0",paddingLeft:"0",fontSize:"0.7222rem",backgroundColor:"#000d",color:"$secondary",fill:"$secondary",borderBottomLeftRadius:"0",borderTopRightRadius:"0"}}},figcaption:{marginTop:"0.5rem",fontWeight:"400",fontSize:"0.8333rem",display:"-webkit-box",overflow:"hidden",MozBoxOrient:"vertical",WebkitBoxOrient:"vertical",WebkitLineClamp:"5","@sm":{fontSize:"0.8333rem"}}},"&[aria-checked='true']":{figure:{"> div":{backgroundColor:"$primaryAlt","&::before":{position:"absolute",zIndex:"1",color:"$secondaryMuted",content:"Active Item",textTransform:"uppercase",fontWeight:"700",fontSize:"0.6111rem",letterSpacing:"0.03rem",display:"flex",width:"100%",height:"100%",flexDirection:"column",justifyContent:"center",textAlign:"center",textShadow:"5px 5px 5px #0003"},img:{opacity:"0.3",transform:"scale3d(1.1, 1.1, 1.1)",filter:"blur(2px)"},[`& ${Q}`]:{[`& ${J}`]:{backgroundColor:"$accent"}}}},figcaption:{fontWeight:"700"}}}),qn=({type:ie})=>{switch(ie){case"Sound":return e$1.createElement(S.Audio,null);case"Image":return e$1.createElement(S.Image,null);case"Video":return e$1.createElement(S.Video,null);default:return e$1.createElement(S.Image,null)}},Un=({canvas:ie,canvasIndex:Z,isActive:ee,thumbnail:ae,type:ye,handleChange:ve})=>e$1.createElement(Gn,{"aria-checked":ee,"data-testid":"media-thumbnail","data-canvas":Z,onClick:()=>ve(ie.id),value:ie.id},e$1.createElement("figure",null,e$1.createElement("div",null,(ae==null?void 0:ae.id)&&e$1.createElement("img",{src:ae.id,alt:ie!=null&&ie.label?D(ie.label):""}),e$1.createElement(Q,null,e$1.createElement(J,{isIcon:!0,"data-testid":"thumbnail-tag"},e$1.createElement(jn,null),e$1.createElement(S,{"aria-label":ye},e$1.createElement(qn,{type:ye})),["Video","Sound"].includes(ye)&&e$1.createElement(Nn,null,Ee(ie.duration))))),(ie==null?void 0:ie.label)&&e$1.createElement("figcaption",{"data-testid":"fig-caption"},e$1.createElement(L,{label:ie.label})))),_n=ie=>ie.body?ie.body.type:"Image",Zn=({items:ie})=>{const Z=O(),ee=k(),{activeCanvas:ae,vault:ye}=ee,[ve,be]=reactExports.useState(""),[Ye,Ke]=reactExports.useState([]),[Xe,Je]=reactExports.useState(0),rt=e$1.useRef(null),nt="painting",it=ot=>{ae!==ot&&Z({type:"updateActiveCanvas",canvasId:ot})};reactExports.useEffect(()=>{if(!Ye.length){const ot=["Image","Sound","Video"],dt=ie.map(ft=>Ie(ye,ft,nt,ot)).filter(ft=>ft.annotations.length>0);Ke(dt)}},[ie,Ye.length,ye]),reactExports.useEffect(()=>{Ye.forEach((ot,dt)=>{ot!=null&&ot.canvas&&ot.canvas.id===ae&&Je(dt)})},[ae,Ye]),reactExports.useEffect(()=>{const ot=document.querySelector(`[data-canvas="${Xe}"]`);if(ot instanceof HTMLElement&&rt.current){const dt=ot.offsetLeft-rt.current.offsetWidth/2+ot.offsetWidth/2;rt.current.scrollTo({left:dt,behavior:"smooth"})}},[Xe]);const lt=ot=>be(ot),ct=ot=>{const dt=Ye[Xe+ot];dt!=null&&dt.canvas&&it(dt.canvas.id)};return e$1.createElement(e$1.Fragment,null,e$1.createElement(In,{handleFilter:lt,handleCanvasToggle:ct,activeIndex:Xe,canvasLength:Ye.length}),e$1.createElement($n,{"aria-label":"select item","data-testid":"media",ref:rt},Ye.filter(ot=>{var dt;if((dt=ot.canvas)!=null&&dt.label){const ft=D(ot.canvas.label);if(Array.isArray(ft))return ft[0].toLowerCase().includes(ve.toLowerCase())}}).map((ot,dt)=>{var ft,gt;return e$1.createElement(Un,{canvas:ot.canvas,canvasIndex:dt,handleChange:it,isActive:ae===((ft=ot==null?void 0:ot.canvas)==null?void 0:ft.id),key:(gt=ot==null?void 0:ot.canvas)==null?void 0:gt.id,thumbnail:Et(ye,ot,200,200),type:_n(ot.annotations[0])})})))},je=m("button",{background:"none",border:"none",cursor:"zoom-in",width:"100%",height:"100%",margin:"0",padding:"0",transition:"$all","& img":{width:"100%",height:"100%",objectFit:"contain",color:"transparent",transition:"$all"},variants:{isMedia:{true:{cursor:"pointer"}}}}),Ne=m("button",{display:"flex",height:"2rem",width:"2rem",borderRadius:"2rem",padding:"0",margin:"0",fontFamily:"inherit",background:"none",border:"none",color:"white",cursor:"pointer",marginLeft:"0.618rem",backgroundColor:"$primary",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"content-box !important","&:first-child":{marginLeft:"0"},"@xs":{marginBottom:"0.618rem",marginLeft:"0","&:last-child":{marginBottom:"0"}},svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"inherit"},"&:hover, &:focus":{backgroundColor:"$accent"},"&#rotateRight":{"&:hover, &:focus":{svg:{rotate:"45deg"}}},"&#rotateLeft":{transform:"scaleX(-1)","&:hover, &:focus":{svg:{rotate:"45deg"}}},"&#reset":{"&:hover, &:focus":{svg:{rotate:"-15deg"}}}}),Ge=m(Ne,{position:"absolute",width:"2rem",top:"1rem",right:"1rem",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",transition:"$all",borderRadius:"50%",backgroundColor:"$accent",cursor:"pointer","&:hover, &:focus":{backgroundColor:"$accent !important"},variants:{isInteractive:{true:{"&:hover":{opacity:"1"}},false:{}},isMedia:{true:{cursor:"pointer !important"}}},compoundVariants:[{isInteractive:!1,isMedia:!0,css:{top:"50%",right:"50%",width:"4rem",height:"4rem",transform:"translate(50%,-50%)"}}]}),Xn=m("div",{position:"relative",zIndex:"0",display:"flex",flexDirection:"column",gap:"1rem","&:hover":{[`${Ge}`]:{backgroundColor:"$accent"},[`${je}`]:{backgroundColor:"#6662",img:{filter:"brightness(0.85)"}}}}),Yn=m("div",{}),Kn=m("svg",{height:"19px",color:"$accent",fill:"$accent",stroke:"$accent",display:"flex",margin:"0.25rem 0.85rem"}),Jn=m($cc7e05a45900e73f$export$41fb9f06171c75f4,{fontSize:"1.25rem",fontWeight:"400",fontFamily:"inherit",alignSelf:"flex-start",flexGrow:"1",cursor:"pointer",transition:"$all",border:"1px solid #6663",boxShadow:"2px 2px 5px #0001",borderRadius:"3px",display:"flex",alignItems:"center",paddingLeft:"0.5rem",width:"100%","@sm":{fontSize:"1rem"}}),Qn=m($cc7e05a45900e73f$export$7c6e2c02157bb7d2,{borderRadius:"3px",boxShadow:"3px 3px 8px #0003",backgroundColor:"$secondary",marginTop:"2.25rem",marginLeft:"6px",paddingBottom:"0.25rem",maxHeight:"calc(61.8vh - 2.5rem) !important",borderTopLeftRadius:"0",border:"1px solid $secondaryMuted",maxWidth:"90vw"}),er=m($cc7e05a45900e73f$export$6d08773d2e66f8f2,{display:"flex",alignItems:"center",fontFamily:"inherit",padding:"0.25rem 0.5rem",color:"$primary",fontWeight:"400",fontSize:"0.8333rem",cursor:"pointer",backgroundColor:"$secondary",width:"calc(100% - 1rem)","> span":{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},'&[data-state="checked"]':{fontWeight:"700",color:"$primary !important"},"&:hover":{color:"$accent"},img:{width:"31px",height:"31px",marginRight:"0.5rem",borderRadius:"3px"}}),tr=m($cc7e05a45900e73f$export$b04be29aa201d4f5,{color:"$primaryMuted",fontFamily:"inherit",fontSize:"0.85rem",padding:"0.5rem 1rem 0.5rem 0.5rem",display:"flex",alignItems:"center",marginBottom:"0.25rem",borderRadius:"3px",borderTopLeftRadius:"0",borderBottomLeftRadius:"0",borderBottomRightRadius:"0",backgroundColor:"$secondaryMuted"}),qe=m($cc7e05a45900e73f$export$be92b6f5f03c0fe9,{position:"relative",zIndex:"5",width:"100%"}),K=({direction:ie,title:Z})=>{const ee=()=>e$1.createElement("path",{d:"M414 321.94L274.22 158.82a24 24 0 00-36.44 0L98 321.94c-13.34 15.57-2.28 39.62 18.22 39.62h279.6c20.5 0 31.56-24.05 18.18-39.62z"}),ae=()=>e$1.createElement("path",{d:"M98 190.06l139.78 163.12a24 24 0 0036.44 0L414 190.06c13.34-15.57 2.28-39.62-18.22-39.62h-279.6c-20.5 0-31.56 24.05-18.18 39.62z"});return e$1.createElement(Kn,{xmlns:"http://www.w3.org/2000/svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},e$1.createElement("title",null,Z),ie==="up"&&e$1.createElement(ee,null),ie==="down"&&e$1.createElement(ae,null))},Ue=({children:ie,label:Z,maxHeight:ee,onValueChange:ae,value:ye})=>e$1.createElement(qe,{onValueChange:ae,value:ye},e$1.createElement(Jn,{"data-testid":"select-button"},e$1.createElement($cc7e05a45900e73f$export$e288731fd71264f0,{"data-testid":"select-button-value"}),e$1.createElement($cc7e05a45900e73f$export$99b400cabb58c515,null,e$1.createElement(K,{direction:"down",title:"select"}))),e$1.createElement($cc7e05a45900e73f$export$b2af6c9944296213,null,e$1.createElement(Qn,{css:{maxHeight:`${ee} !important`},"data-testid":"select-content"},e$1.createElement($cc7e05a45900e73f$export$d8117927658af6d7,null,e$1.createElement(K,{direction:"up",title:"scroll up for more"})),e$1.createElement($cc7e05a45900e73f$export$9ed6e7b40248d36d,null,e$1.createElement($cc7e05a45900e73f$export$ee25a334c55de1f4,null,Z&&e$1.createElement(tr,null,e$1.createElement(L,{"data-testid":"select-label",label:Z})),ie)),e$1.createElement($cc7e05a45900e73f$export$ff951e476c12189,null,e$1.createElement(K,{direction:"down",title:"scroll down for more"}))))),_e=ie=>e$1.createElement(er,{...ie},ie.thumbnail&&e$1.createElement(Ve,{thumbnail:ie.thumbnail}),e$1.createElement($cc7e05a45900e73f$export$3572fb0fb821ff49,null,e$1.createElement(L,{label:ie.label})),e$1.createElement($cc7e05a45900e73f$export$6b9198de19accfe6,null)),nr=m("div",{position:"absolute !important",zIndex:"1",top:"1rem",left:"1rem",width:"161.8px",height:"100px",backgroundColor:"#000D",boxShadow:"5px 5px 5px #0002",borderRadius:"3px",".displayregion":{border:" 3px solid $accent !important",boxShadow:"0 0 3px #0006"},"@sm":{width:"123px",height:"76px"},"@xs":{width:"100px",height:"61.8px"}}),rr=m("div",{position:"relative",width:"100%",height:"100%",zIndex:"0"}),or=m("div",{width:"100%",height:"61.8vh",maxHeight:"100vh",background:"black",backgroundSize:"contain",color:"white",position:"relative",zIndex:"1",overflow:"hidden"}),z=({id:ie,label:Z,children:ee})=>e$1.createElement(Ne,{id:ie,"data-testid":"openseadragon-button"},e$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":`${ie}-svg-title`,"data-testid":"openseadragon-button-svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},e$1.createElement("title",{id:`${ie}-svg-title`},Z),ee)),ar=m("div",{position:"absolute",zIndex:"1",top:"1rem",display:"flex","@xs":{flexDirection:"column",zIndex:"2"},variants:{hasPlaceholder:{true:{right:"3.618rem","@xs":{top:"3.618rem",right:"1rem"}},false:{right:"1rem","@xs":{top:"1rem",right:"1rem"}}}}}),ir=()=>e$1.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M256 112v288M400 256H112"}),lr=()=>e$1.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 256H112"}),sr=()=>e$1.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M432 320v112H320M421.8 421.77L304 304M80 192V80h112M90.2 90.23L208 208M320 80h112v112M421.77 90.2L304 208M192 432H80V320M90.23 421.8L208 304"}),cr=()=>e$1.createElement("path",{d:"M448 440a16 16 0 01-12.61-6.15c-22.86-29.27-44.07-51.86-73.32-67C335 352.88 301 345.59 256 344.23V424a16 16 0 01-27 11.57l-176-168a16 16 0 010-23.14l176-168A16 16 0 01256 88v80.36c74.14 3.41 129.38 30.91 164.35 81.87C449.32 292.44 464 350.9 464 424a16 16 0 01-16 16z"}),pe=()=>e$1.createElement(e$1.Fragment,null,e$1.createElement("path",{fill:"none",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 148l-21.12-24.57A191.43 191.43 0 00240 64C134 64 48 150 48 256s86 192 192 192a192.09 192.09 0 00181.07-128"}),e$1.createElement("path",{d:"M464 97.42V208a16 16 0 01-16 16H337.42c-14.26 0-21.4-17.23-11.32-27.31L436.69 86.1C446.77 76 464 83.16 464 97.42z"})),dr=({hasPlaceholder:ie,options:Z})=>e$1.createElement(ar,{"data-testid":"openseadragon-controls",hasPlaceholder:ie,id:"openseadragon-controls"},Z.showZoomControl&&e$1.createElement(e$1.Fragment,null,e$1.createElement(z,{id:"zoomIn",label:"zoom in"},e$1.createElement(ir,null)),e$1.createElement(z,{id:"zoomOut",label:"zoom out"},e$1.createElement(lr,null))),Z.showFullPageControl&&e$1.createElement(z,{id:"fullPage",label:"full page"},e$1.createElement(sr,null)),Z.showRotationControl&&e$1.createElement(e$1.Fragment,null,e$1.createElement(z,{id:"rotateRight",label:"rotate right"},e$1.createElement(pe,null)),e$1.createElement(z,{id:"rotateLeft",label:"rotate left"},e$1.createElement(pe,null))),Z.showHomeControl&&e$1.createElement(z,{id:"reset",label:"reset"},e$1.createElement(cr,null))),mr=ie=>fetch(`${ie.replace(/\/$/,"")}/info.json`).then(Z=>Z.json()).then(Z=>Z).catch(Z=>{console.error(`The IIIF tilesource ${ie.replace(/\/$/,"")}/info.json failed to load: ${Z}`)}),ur=ie=>{let Z,ee;if(Array.isArray(ie)&&(Z=ie[0],Z)){let ae;"@id"in Z?ae=Z["@id"]:ae=Z.id,ee=ae}return ee},pr=({uri:ie,hasPlaceholder:Z,imageType:ee})=>{const[ae,ye]=reactExports.useState(),[ve,be]=reactExports.useState(),Ye=k(),{configOptions:Ke}=Ye,Xe={id:`openseadragon-viewport-${ve}`,loadTilesWithAjax:!0,fullPageButton:"fullPage",homeButton:"reset",rotateLeftButton:"rotateLeft",rotateRightButton:"rotateRight",zoomInButton:"zoomIn",zoomOutButton:"zoomOut",showNavigator:!0,showFullPageControl:!0,showHomeControl:!0,showRotationControl:!0,showZoomControl:!0,navigatorBorderColor:"transparent",navigatorId:`openseadragon-navigator-${ve}`,gestureSettingsMouse:{clickToZoom:!0,dblClickToZoom:!0,pinchToZoom:!0,scrollToZoom:!0},...Ke.openSeadragon,ajaxWithCredentials:Ke.withCredentials};return reactExports.useEffect(()=>{ie!==ae&&(ye(ie),be(v4()))},[ae,ie]),reactExports.useEffect(()=>{if(ae)switch(ee){case"simpleImage":le(Xe).addSimpleImage({url:ae});break;case"tiledImage":mr(ae).then(Je=>le(Xe).addTiledImage({tileSource:Je}));break;default:console.warn(`Unable to render ${ae} in OpenSeadragon as type: "${ee}"`);break}},[ae]),ve?e$1.createElement(or,{css:{backgroundColor:Ke.canvasBackgroundColor,height:Ke.canvasHeight},className:"clover-viewer-osd-wrapper","data-testid":"clover-viewer-osd-wrapper"},e$1.createElement(dr,{hasPlaceholder:Z,options:Xe}),e$1.createElement(nr,{id:`openseadragon-navigator-${ve}`}),e$1.createElement(rr,{id:`openseadragon-viewport-${ve}`})):null},fr=({painting:ie,hasPlaceholder:Z})=>{const[ee,ae]=reactExports.useState(),[ye,ve]=reactExports.useState();return reactExports.useEffect(()=>{Array.isArray(ie==null?void 0:ie.service)&&(ie==null?void 0:ie.service.length)>0?(ae("tiledImage"),ve(ur(ie==null?void 0:ie.service))):(ae("simpleImage"),ve(ie==null?void 0:ie.id))},[ie]),e$1.createElement(pr,{uri:ye,key:ye,hasPlaceholder:Z,imageType:ee})},gr=({isMedia:ie,label:Z,placeholderCanvas:ee,setIsInteractive:ae})=>{const{vault:ye}=k(),ve=N(ye,ee),be=ve?ve[0]:void 0,Ye=Z?D(Z):["placeholder image"];return e$1.createElement(je,{onClick:()=>ae(!0),isMedia:ie,className:"clover-viewer-placeholder"},e$1.createElement("img",{src:(be==null?void 0:be.id)||"",alt:Ye.join(),height:be==null?void 0:be.height,width:be==null?void 0:be.width}))},hr=m("canvas",{position:"absolute",width:"100%",height:"100%",zIndex:"0"}),xr=e$1.forwardRef((ie,Z)=>{const ee=e$1.useRef(null),ae=reactExports.useCallback(()=>{var ve,be;if((ve=Z.current)!=null&&ve.currentTime&&((be=Z.current)==null?void 0:be.currentTime)>0)return;const Ye=Z.current;if(!Ye)return;const Ke=new AudioContext,Xe=Ke.createMediaElementSource(Ye),Je=Ke.createAnalyser(),rt=ee.current;if(!rt)return;rt.width=Ye.offsetWidth,rt.height=Ye.offsetHeight;const nt=rt.getContext("2d");Xe.connect(Je),Je.connect(Ke.destination),Je.fftSize=256;const it=Je.frequencyBinCount,lt=new Uint8Array(it);setInterval(function(){ye(Je,nt,it,lt,rt.width,rt.height)},20)},[Z]);e$1.useEffect(()=>{!Z||!Z.current||(Z.current.onplay=ae)},[ae,Z]);function ye(ve,be,Ye,Ke,Xe,Je){const rt=Xe/Ye*2.6;let nt,it=0;ve.getByteFrequencyData(Ke),be.fillStyle="#000000",be.fillRect(0,0,Xe,Je);for(let lt=0;lt<Ye;lt++)nt=Ke[lt]*2,be.fillStyle="rgba(78, 42, 132, 1)",be.fillRect(it,Je-nt,rt,nt),it+=rt+6}return e$1.createElement(hr,{ref:ee,role:"presentation"})}),vr=m("div",{position:"relative",backgroundColor:"$primaryAlt",display:"flex",flexGrow:"0",flexShrink:"1",maxHeight:"500px",zIndex:"1",video:{backgroundColor:"transparent",objectFit:"contain",width:"100%",height:"100%",position:"relative",zIndex:"1"}}),br=({resource:ie,ignoreCaptionLabels:Z})=>{const ee=D(ie.label,"en");return Array.isArray(ee)&&ee.some(ae=>Z.includes(ae))?null:e$1.createElement("track",{key:ie.id,src:ie.id,label:Array.isArray(ee)?ee[0]:ee,srcLang:"en","data-testid":"player-track"})},yr=({allSources:ie,resources:Z,painting:ee})=>{const[ae,ye]=e$1.useState(0),[ve,be]=e$1.useState(),Ye=e$1.useRef(null),Ke=(ee==null?void 0:ee.type)==="Sound",Xe=k(),{activeCanvas:Je,configOptions:rt,vault:nt}=Xe;return reactExports.useEffect(()=>{if(!ee.id||!Ye.current)return;if(Ye!=null&&Ye.current){const ct=Ye.current;ct.src=ee.id,ct.load()}if(ee.id.split(".").pop()!=="m3u8")return;const it={xhrSetup:function(ct,ot){ct.withCredentials=!!rt.withCredentials}},lt=new Hls(it);return lt.attachMedia(Ye.current),lt.on(Hls.Events.MEDIA_ATTACHED,function(){lt.loadSource(ee.id)}),lt.on(Hls.Events.ERROR,function(ct,ot){if(ot.fatal)switch(ot.type){case Hls.ErrorTypes.NETWORK_ERROR:console.error(`fatal ${ct} network error encountered, try to recover`),lt.startLoad();break;case Hls.ErrorTypes.MEDIA_ERROR:console.error(`fatal ${ct} media error encountered, try to recover`),lt.recoverMediaError();break;default:lt.destroy();break}}),()=>{if(lt&&Ye.current){const ct=Ye.current;lt.detachMedia(),lt.destroy(),ct.currentTime=0}}},[rt.withCredentials,ee.id]),reactExports.useEffect(()=>{var it,lt,ct,ot;const dt=nt.get(Je),ft=(it=dt.accompanyingCanvas)!=null&&it.id?N(nt,(lt=dt.accompanyingCanvas)==null?void 0:lt.id):null,gt=(ct=dt.placeholderCanvas)!=null&&ct.id?N(nt,(ot=dt.placeholderCanvas)==null?void 0:ot.id):null;ft&&gt?be(ae===0?gt[0].id:ft[0].id):(ft&&be(ft[0].id),gt&&be(gt[0].id))},[Je,ae,nt]),reactExports.useEffect(()=>{if(Ye!=null&&Ye.current){const it=Ye.current;return it==null||it.addEventListener("timeupdate",()=>ye(it.currentTime)),()=>document.removeEventListener("timeupdate",()=>{})}},[]),e$1.createElement(vr,{css:{backgroundColor:rt.canvasBackgroundColor,maxHeight:rt.canvasHeight,position:"relative"},"data-testid":"player-wrapper",className:"clover-viewer-player-wrapper"},e$1.createElement("video",{id:"clover-iiif-video",key:ee.id,ref:Ye,controls:!0,height:ee.height,width:ee.width,crossOrigin:"anonymous",poster:ve,style:{maxHeight:rt.canvasHeight,position:"relative",zIndex:"1"}},ie.map(it=>e$1.createElement("source",{src:it.id,type:it.format,key:it.id})),Z.length>0&&Z.map(it=>e$1.createElement(br,{resource:it,ignoreCaptionLabels:rt.ignoreCaptionLabels||[],key:it.id})),"Sorry, your browser doesn't support embedded videos."),Ke&&e$1.createElement(xr,{ref:Ye}))},Er=()=>e$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"close-svg-title",focusable:"false",viewBox:"0 0 512 512",role:"img"},e$1.createElement("title",{id:"close-svg-title"},"close"),e$1.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})),wr=({isMedia:ie})=>e$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"open-svg-title",focusable:"false",viewBox:"0 0 512 512",role:"img"},e$1.createElement("title",{id:"open-svg-title"},"open"),ie?e$1.createElement("path",{d:"M133 440a35.37 35.37 0 01-17.5-4.67c-12-6.8-19.46-20-19.46-34.33V111c0-14.37 7.46-27.53 19.46-34.33a35.13 35.13 0 0135.77.45l247.85 148.36a36 36 0 010 61l-247.89 148.4A35.5 35.5 0 01133 440z"}):e$1.createElement(e$1.Fragment,null,e$1.createElement("path",{d:"m456.69,421.39l-94.09-94.09c22.65-30.16,34.88-66.86,34.84-104.58,0-96.34-78.38-174.72-174.72-174.72S48,126.38,48,222.72s78.38,174.72,174.72,174.72c37.72.04,74.42-12.19,104.58-34.84l94.09,94.09c10.29,9.2,26.1,8.32,35.3-1.98,8.48-9.49,8.48-23.83,0-33.32Zm-233.97-73.87c-68.89-.08-124.72-55.91-124.8-124.8h0c0-68.93,55.87-124.8,124.8-124.8s124.8,55.87,124.8,124.8-55.87,124.8-124.8,124.8Z"}),e$1.createElement("path",{d:"m279.5,197.76h-3.35s-28.47,0-28.47,0v-31.82c-.77-13.79-12.57-24.33-26.36-23.56-12.71.71-22.85,10.86-23.56,23.56v3.35h0v28.47h-31.82c-13.79.77-24.33,12.57-23.56,26.36.71,12.71,10.86,22.85,23.56,23.56h3.35s28.47,0,28.47,0v31.82c.77,13.79,12.57,24.33,26.36,23.56,12.71-.71,22.85-10.86,23.56-23.56v-3.35h0v-28.47h31.82c13.79-.77,24.33-12.57,23.56-26.36-.71-12.71-10.86-22.85-23.56-23.56Z"}))),Cr=({handleToggle:ie,isInteractive:Z,isMedia:ee})=>e$1.createElement(Ge,{onClick:ie,isInteractive:Z,isMedia:ee,"data-testid":"placeholder-toggle"},Z?e$1.createElement(Er,null):e$1.createElement(wr,{isMedia:ee})),Sr=({activeCanvas:ie,isMedia:Z,painting:ee,resources:ae})=>{var ye,ve,be;const[Ye,Ke]=e$1.useState(0),[Xe,Je]=e$1.useState(!1),{configOptions:rt,customDisplays:nt,vault:it}=k(),lt=it.get(ie),ct=(ye=lt==null?void 0:lt.placeholderCanvas)==null?void 0:ye.id,ot=!!ct,dt=(ee==null?void 0:ee.length)>1,ft=ct&&!Xe&&!Z,gt=()=>Je(!Xe),mt=Xr=>{const Jr=ee.findIndex(ai=>ai.id===Xr);Ke(Jr)},Yr=nt.find(Xr=>{var Jr;let ai=!1;const{canvasId:oi,paintingFormat:ni}=Xr.target;if(Array.isArray(oi)&&oi.length>0&&(ai=oi.includes(ie)),Array.isArray(ni)&&ni.length>0){const li=((Jr=ee[Ye])==null?void 0:Jr.format)||"";ai=!!(li&&ni.includes(li))}return ai}),Qr=(ve=Yr==null?void 0:Yr.display)==null?void 0:ve.component;return e$1.createElement(Xn,{className:"clover-viewer-painting"},e$1.createElement(Yn,{style:{backgroundColor:rt.canvasBackgroundColor,maxHeight:rt.canvasHeight}},ct&&!Z&&e$1.createElement(Cr,{handleToggle:gt,isInteractive:Xe,isMedia:Z}),ft&&!Z&&e$1.createElement(gr,{isMedia:Z,label:lt==null?void 0:lt.label,placeholderCanvas:ct,setIsInteractive:Je}),!ft&&!Yr&&(Z?e$1.createElement(yr,{allSources:ee,painting:ee[Ye],resources:ae}):ee&&e$1.createElement(fr,{painting:ee[Ye],hasPlaceholder:ot,key:ie})),!ft&&Qr&&e$1.createElement(Qr,{id:ie,annotationBody:ee[Ye],...Yr==null?void 0:Yr.display.componentProps})),dt&&e$1.createElement(Ue,{value:(be=ee[Ye])==null?void 0:be.id,onValueChange:mt,maxHeight:"200px"},ee==null?void 0:ee.map(Xr=>e$1.createElement(_e,{value:Xr==null?void 0:Xr.id,key:Xr==null?void 0:Xr.id,label:Xr==null?void 0:Xr.label}))))},kr=({activeCanvas:ie,painting:Z,resources:ee,items:ae,isAudioVideo:ye})=>{const{informationOpen:ve,configOptions:be}=k(),{informationPanel:Ye}=be,Ke=(Ye==null?void 0:Ye.renderAbout)||(Ye==null?void 0:Ye.renderSupplementing)&&ee.length>0;return e$1.createElement(Ae,{className:"clover-viewer-content","data-testid":"clover-viewer-content"},e$1.createElement(Te,null,e$1.createElement(Sr,{activeCanvas:ie,isMedia:ye,painting:Z,resources:ee}),Ke&&e$1.createElement(Me,null,e$1.createElement("span",null,ve?"View Items":"More Information")),ae.length>1&&e$1.createElement($e,{className:"clover-viewer-media-wrapper"},e$1.createElement(Zn,{items:ae,activeItem:0}))),ve&&Ke&&e$1.createElement($t,null,e$1.createElement(Re,null,e$1.createElement(xn,{activeCanvas:ie,resources:ee}))))},Ir=m(W.Trigger,{width:"30px",padding:"5px"}),$r=m(W.Content,{display:"flex",flexDirection:"column",fontSize:"0.8333rem",border:"none",boxShadow:"2px 2px 5px #0003",zIndex:"2",button:{display:"flex",textDecoration:"none",marginBottom:"0.5em",color:"$accentAlt",cursor:"pointer",background:"$secondary",border:"none","&:last-child":{marginBottom:"0"}}}),Ar=m("span",{fontSize:"1.33rem",alignSelf:"flex-start",flexGrow:"0",flexShrink:"1",padding:"1rem","@sm":{fontSize:"1rem"},"&.visually-hidden":{position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",border:"0"}}),Tr=m("header",{display:"flex",backgroundColor:"transparent !important",justifyContent:"space-between",alignItems:"flex-start",width:"100%",[`> ${qe}`]:{flexGrow:"1",flexShrink:"0"},form:{flexGrow:"0",flexShrink:"1"}}),Mr=m("div",{display:"flex",alignItems:"flex-end",justifyContent:"flex-end",padding:"1rem",flexShrink:"0",flexGrow:"1"}),Rr=()=>{var ie;const Z=O(),ee=k(),{activeManifest:ae,collection:ye,configOptions:ve,vault:be}=ee,Ye=ve==null?void 0:ve.canvasHeight,Ke=Xe=>{Z({type:"updateActiveManifest",manifestId:Xe})};return e$1.createElement("div",{style:{margin:"0.75rem"}},e$1.createElement(Ue,{label:ye.label,maxHeight:Ye,value:ae,onValueChange:Ke},(ie=ye==null?void 0:ye.items)==null?void 0:ie.map(Xe=>e$1.createElement(_e,{value:Xe.id,key:Xe.id,thumbnail:Xe!=null&&Xe.thumbnail?be.get(Xe==null?void 0:Xe.thumbnail):void 0,label:Xe.label}))))},zr=(ie,Z=2500)=>{const[ee,ae]=reactExports.useState(),ye=reactExports.useCallback(()=>{navigator.clipboard.writeText(ie).then(()=>ae("copied"),()=>ae("failed"))},[ie]);return reactExports.useEffect(()=>{if(!ee)return;const ve=setTimeout(()=>ae(void 0),Z);return()=>clearTimeout(ve)},[ee]),[ee,ye]},Lr=m("span",{display:"flex",alignContent:"center",alignItems:"center",padding:"0.125rem 0.25rem 0",marginTop:"-0.125rem",marginLeft:"0.5rem",backgroundColor:"$accent",color:"$secondary",borderRadius:"3px",fontSize:"0.6111rem",textTransform:"uppercase",lineHeight:"1em"}),Fr=({status:ie})=>ie?e$1.createElement(Lr,{"data-copy-status":ie},ie):null,fe=({textPrompt:ie,textToCopy:Z})=>{const[ee,ae]=zr(Z);return e$1.createElement("button",{onClick:ae},ie," ",e$1.createElement(Fr,{status:ee}))},Pr=()=>{const ie="#ed1d33",Z="#2873ab";return e$1.createElement("svg",{viewBox:"0 0 493.35999 441.33334",id:"iiif-logo",version:"1.1"},e$1.createElement("title",null,"IIIF Manifest Options"),e$1.createElement("g",{transform:"matrix(1.3333333,0,0,-1.3333333,0,441.33333)"},e$1.createElement("g",{transform:"scale(0.1)"},e$1.createElement("path",{style:{fill:Z},d:"M 65.2422,2178.75 775.242,1915 773.992,15 65.2422,276.25 v 1902.5"}),e$1.createElement("path",{style:{fill:Z},d:"m 804.145,2640.09 c 81.441,-240.91 -26.473,-436.2 -241.04,-436.2 -214.558,0 -454.511,195.29 -535.9527,436.2 -81.4335,240.89 26.4805,436.18 241.0387,436.18 214.567,0 454.512,-195.29 535.954,-436.18"}),e$1.createElement("path",{style:{fill:ie},d:"M 1678.58,2178.75 968.578,1915 969.828,15 1678.58,276.25 v 1902.5"}),e$1.createElement("path",{style:{fill:ie},d:"m 935.082,2640.09 c -81.437,-240.91 26.477,-436.2 241.038,-436.2 214.56,0 454.51,195.29 535.96,436.2 81.43,240.89 -26.48,436.18 -241.04,436.18 -214.57,0 -454.52,-195.29 -535.958,-436.18"}),e$1.createElement("path",{style:{fill:Z},d:"m 1860.24,2178.75 710,-263.75 -1.25,-1900 -708.75,261.25 v 1902.5"}),e$1.createElement("path",{style:{fill:Z},d:"m 2603.74,2640.09 c 81.45,-240.91 -26.47,-436.2 -241.03,-436.2 -214.58,0 -454.52,195.29 -535.96,436.2 -81.44,240.89 26.48,436.18 241.03,436.18 214.57,0 454.51,-195.29 535.96,-436.18"}),e$1.createElement("path",{style:{fill:ie},d:"m 3700.24,3310 v -652.5 c 0,0 -230,90 -257.5,-142.5 -2.5,-247.5 0,-336.25 0,-336.25 l 257.5,83.75 V 1690 l -258.61,-92.5 V 262.5 L 2735.24,0 v 2360 c 0,0 -15,850 965,950"}))))},Vr=m($6be4966fd9bbc698$export$be92b6f5f03c0fe9,{all:"unset",height:"2rem",width:"3.236rem",backgroundColor:"#6663",borderRadius:"9999px",position:"relative",WebkitTapHighlightColor:"transparent",cursor:"pointer","&:focus":{boxShadow:"0 0 0 2px $secondaryAlt"},'&[data-state="checked"]':{backgroundColor:"$accent",boxShadow:"inset 2px 2px 5px #0003"}}),Br=m($6be4966fd9bbc698$export$6521433ed15a34db,{display:"block",height:"calc(2rem - 12px)",width:"calc(2rem - 12px)",backgroundColor:"$secondary",borderRadius:"100%",boxShadow:"2px 2px 5px #0001",transition:"$all",transform:"translateX(6px)",willChange:"transform",'&[data-state="checked"]':{transform:"translateX(calc(1.236rem + 6px))"}}),Hr=m("label",{fontSize:"0.8333rem",fontWeight:"400",lineHeight:"1em",userSelect:"none",cursor:"pointer",paddingRight:"0.618rem"}),Or=m("form",{display:"flex",flexShrink:"0",flexGrow:"1",alignItems:"center",marginLeft:"1.618rem"}),Dr=()=>{var ie;const{configOptions:Z}=k(),ee=O(),[ae,ye]=reactExports.useState((ie=Z==null?void 0:Z.informationPanel)==null?void 0:ie.open);return reactExports.useEffect(()=>{ee({type:"updateInformationOpen",informationOpen:ae})},[ae]),e$1.createElement(Or,null,e$1.createElement(Hr,{htmlFor:"information-toggle",css:ae?{opacity:"1"}:{}},"More Information"),e$1.createElement(Vr,{checked:ae,onCheckedChange:()=>ye(!ae),id:"information-toggle","aria-label":"information panel toggle",name:"toggled?"},e$1.createElement(Br,null)))},Ze=ie=>{const Z=()=>window.matchMedia?window.matchMedia(ie).matches:!1,[ee,ae]=reactExports.useState(Z);return reactExports.useEffect(()=>{const ye=()=>ae(Z);return window.addEventListener("resize",ye),()=>window.removeEventListener("resize",ye)}),ee},Wr=({manifestId:ie,manifestLabel:Z})=>{const ee=k(),{collection:ae,configOptions:ye}=ee,{showTitle:ve,showIIIFBadge:be,informationPanel:Ye}=ye,Ke=be||(Ye==null?void 0:Ye.renderToggle),Xe=Ze(te.sm);return e$1.createElement(Tr,{className:"clover-viewer-header"},ae!=null&&ae.items?e$1.createElement(Rr,null):e$1.createElement(Ar,{className:ve?"":"visually-hidden"},ve&&e$1.createElement(L,{label:Z,className:"label"})),Ke&&e$1.createElement(Mr,null,be&&e$1.createElement(W,null,e$1.createElement(Ir,null,e$1.createElement(Pr,null)),e$1.createElement($r,null,(ae==null?void 0:ae.items)&&e$1.createElement("button",{onClick:Je=>{Je.preventDefault(),window.open(ae.id,"_blank")}},"View Collection"),e$1.createElement("button",{onClick:Je=>{Je.preventDefault(),window.open(ie,"_blank")}},"View Manifest")," ",(ae==null?void 0:ae.items)&&e$1.createElement(fe,{textPrompt:"Copy Collection URL",textToCopy:ae.id}),e$1.createElement(fe,{textPrompt:"Copy Manifest URL",textToCopy:ie}))),(Ye==null?void 0:Ye.renderToggle)&&!Xe&&e$1.createElement(Dr,null)))},jr=(ie=!1)=>{const[Z,ee]=reactExports.useState(ie);return reactExports.useLayoutEffect(()=>{if(!Z)return;const ae=document.documentElement.style.overflow;return document.documentElement.style.overflow="hidden",()=>{document.documentElement.style.overflow=ae}},[Z]),reactExports.useEffect(()=>{Z!==ie&&ee(ie)},[ie]),[Z,ee]},Nr=({manifest:ie,theme:Z})=>{var ee;const ae=k(),ye=O(),{activeCanvas:ve,informationOpen:be,vault:Ye,configOptions:Ke}=ae,[Xe,Je]=reactExports.useState(!1),[rt,nt]=reactExports.useState(!1),[it,lt]=reactExports.useState([]),[ct,ot]=reactExports.useState([]),[dt,ft]=jr(!1),gt=Ze(te.sm),mt=reactExports.useCallback(Yr=>{ye({type:"updateInformationOpen",informationOpen:Yr})},[ye]);return reactExports.useEffect(()=>{var Yr;(Yr=Ke==null?void 0:Ke.informationPanel)!=null&&Yr.open&&mt(!gt)},[gt,(ee=Ke==null?void 0:Ke.informationPanel)==null?void 0:ee.open,mt]),reactExports.useEffect(()=>{if(!gt){ft(!1);return}ft(be)},[be,gt,ft]),reactExports.useEffect(()=>{const Yr=N(Ye,ve),Qr=yt(Ye,ve,"text/vtt");Yr&&(nt(["Sound","Video"].indexOf(Yr[0].type)>-1),lt(Yr)),ot(Qr),Je(Qr.length!==0)},[ve,Ye]),e$1.createElement(ErrorBoundary,{FallbackComponent:It},e$1.createElement(At,{className:`${Z} clover-viewer`,css:{background:Ke==null?void 0:Ke.background},"data-body-locked":dt,"data-information-panel":Xe,"data-information-panel-open":be},e$1.createElement($409067139f391064$export$be92b6f5f03c0fe9,{open:be,onOpenChange:mt},e$1.createElement(Wr,{manifestLabel:ie.label,manifestId:ie.id}),e$1.createElement(kr,{activeCanvas:ve,painting:it,resources:ct,items:ie.items,isAudioVideo:rt}))))},ge={ignoreCache:!1,headers:{Accept:"application/json, text/javascript, text/plain"},timeout:5e3,withCredentials:!1};function Gr(ie){return{ok:ie.status>=200&&ie.status<300,status:ie.status,statusText:ie.statusText,headers:ie.getAllResponseHeaders(),data:ie.responseText,json:()=>JSON.parse(ie.responseText)}}function he(ie,Z=null){return{ok:!1,status:ie.status,statusText:ie.statusText,headers:ie.getAllResponseHeaders(),data:Z||ie.statusText,json:()=>JSON.parse(Z||ie.statusText)}}function qr(ie,Z=ge){const ee=Z.headers||ge.headers;return new Promise((ae,ye)=>{const ve=new XMLHttpRequest;ve.open("get",ie),ve.withCredentials=Z.withCredentials,ee&&Object.keys(ee).forEach(be=>ve.setRequestHeader(be,ee[be])),ve.onload=()=>{ae(Gr(ve))},ve.onerror=()=>{ye(he(ve,"Failed to make request."))},ve.ontimeout=()=>{ye(he(ve,"Request took longer than expected."))},ve.send()})}const ao=({canvasIdCallback:ie=()=>{},customDisplays:Z=[],customTheme:ee,iiifContent:ae,id:ye,manifestId:ve,options:be})=>{var Ye;let Ke=ae;return ye&&(Ke=ye),ve&&(Ke=ve),e$1.createElement(bt,{initialState:{..._,customDisplays:Z,informationOpen:!!((Ye=be==null?void 0:be.informationPanel)!=null&&Ye.open),vault:new Vault({customFetcher:Xe=>qr(Xe,{withCredentials:be==null?void 0:be.withCredentials,headers:be==null?void 0:be.requestHeaders}).then(Je=>JSON.parse(Je.data))})}},e$1.createElement(Ur,{iiifContent:Ke,canvasIdCallback:ie,customTheme:ee,options:be}))},Ur=({canvasIdCallback:ie,customTheme:Z,iiifContent:ee,options:ae})=>{const ye=O(),ve=k(),{activeCanvas:be,activeManifest:Ye,isLoaded:Ke,vault:Xe}=ve,[Je,rt]=reactExports.useState(),[nt,it]=reactExports.useState();let lt={};return Z&&(lt=Q$1("custom",Z)),reactExports.useEffect(()=>{ie&&ie(be)},[be,ie]),reactExports.useEffect(()=>{Ye&&Xe.loadManifest(Ye).then(ct=>{it(ct),ye({type:"updateActiveCanvas",canvasId:ct.items[0]&&ct.items[0].id})}).catch(ct=>{console.error(`Manifest failed to load: ${ct}`)}).finally(()=>{ye({type:"updateIsLoaded",isLoaded:!0})})},[Ye,ye,Xe]),reactExports.useEffect(()=>{ye({type:"updateConfigOptions",configOptions:ae}),Xe.load(ee).then(ct=>{rt(ct)}).catch(ct=>{console.error(`The IIIF resource ${ee} failed to load: ${ct}`)})},[ye,ee,ae,Xe]),reactExports.useEffect(()=>{let ct=[];(Je==null?void 0:Je.type)==="Collection"?(ye({type:"updateCollection",collection:Je}),ct=Je.items.filter(ot=>ot.type==="Manifest").map(ot=>ot.id),ct.length>0&&ye({type:"updateActiveManifest",manifestId:ct[0]})):(Je==null?void 0:Je.type)==="Manifest"&&ye({type:"updateActiveManifest",manifestId:Je.id})},[ye,Je]),Ke?!nt||!nt.items?(console.log(`The IIIF manifest ${ee} failed to load.`),e$1.createElement(e$1.Fragment,null)):nt.items.length===0?(console.log(`The IIIF manifest ${ee} does not contain canvases.`),e$1.createElement(e$1.Fragment,null)):e$1.createElement(Nr,{manifest:nt,theme:lt,key:nt.id}):e$1.createElement(e$1.Fragment,null,"Loading")};class CloverInitializer{constructor(){this.element=document.getElementById("clover-viewer"),this.element&&(this.iiif_content=this.element.attributes.iiif_content.value)}run(){if(!this.iiif_content)return!1;createRoot(document.getElementById("clover-viewer")).render(reactExports.createElement(ao,{id:this.iiif_content,options:this.config}))}get config(){return{showTitle:!1,showIIIFBadge:!1,informationPanel:{renderToggle:!1,renderAbout:!1}}}}export{CloverInitializer as C,LercParameters as L,OlInitializer as O,LercAddCompression as a,getDefaultExportFromCjs$1 as g};
