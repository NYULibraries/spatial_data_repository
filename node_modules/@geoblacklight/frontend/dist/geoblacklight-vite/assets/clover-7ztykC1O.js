var Eo=Object.defineProperty;var xo=(tt,et,rt)=>et in tt?Eo(tt,et,{enumerable:!0,configurable:!0,writable:!0,value:rt}):tt[et]=rt;var eo=(tt,et,rt)=>(xo(tt,typeof et!="symbol"?et+"":et,rt),rt);import{g as getDefaultExportFromCjs$1,c as commonjsGlobal,a as getAugmentedNamespace,_ as __viteBrowserExternal}from"./__vite-browser-external-hc8eWzl-.js";function _mergeNamespaces(tt,et){for(var rt=0;rt<et.length;rt++){const nt=et[rt];if(typeof nt!="string"&&!Array.isArray(nt)){for(const it in nt)if(it!=="default"&&!(it in tt)){const st=Object.getOwnPropertyDescriptor(nt,it);st&&Object.defineProperty(tt,it,st.get?st:{enumerable:!0,get:()=>nt[it]})}}}return Object.freeze(Object.defineProperty(tt,Symbol.toStringTag,{value:"Module"}))}var react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$1=Symbol.for("react.element"),n$2=Symbol.for("react.portal"),p$2=Symbol.for("react.fragment"),q$1=Symbol.for("react.strict_mode"),r$1=Symbol.for("react.profiler"),t$2=Symbol.for("react.provider"),u$2=Symbol.for("react.context"),v$2=Symbol.for("react.forward_ref"),w$1=Symbol.for("react.suspense"),x$2=Symbol.for("react.memo"),y$2=Symbol.for("react.lazy"),z$3=Symbol.iterator;function A$2(tt){return tt===null||typeof tt!="object"?null:(tt=z$3&&tt[z$3]||tt["@@iterator"],typeof tt=="function"?tt:null)}var B$2={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$2=Object.assign,D$3={};function E$2(tt,et,rt){this.props=tt,this.context=et,this.refs=D$3,this.updater=rt||B$2}E$2.prototype.isReactComponent={};E$2.prototype.setState=function(tt,et){if(typeof tt!="object"&&typeof tt!="function"&&tt!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,tt,et,"setState")};E$2.prototype.forceUpdate=function(tt){this.updater.enqueueForceUpdate(this,tt,"forceUpdate")};function F$1(){}F$1.prototype=E$2.prototype;function G$2(tt,et,rt){this.props=tt,this.context=et,this.refs=D$3,this.updater=rt||B$2}var H$2=G$2.prototype=new F$1;H$2.constructor=G$2;C$2(H$2,E$2.prototype);H$2.isPureReactComponent=!0;var I$2=Array.isArray,J$2=Object.prototype.hasOwnProperty,K$3={current:null},L$3={key:!0,ref:!0,__self:!0,__source:!0};function M$2(tt,et,rt){var nt,it={},st=null,ot=null;if(et!=null)for(nt in et.ref!==void 0&&(ot=et.ref),et.key!==void 0&&(st=""+et.key),et)J$2.call(et,nt)&&!L$3.hasOwnProperty(nt)&&(it[nt]=et[nt]);var lt=arguments.length-2;if(lt===1)it.children=rt;else if(1<lt){for(var ut=Array(lt),ct=0;ct<lt;ct++)ut[ct]=arguments[ct+2];it.children=ut}if(tt&&tt.defaultProps)for(nt in lt=tt.defaultProps,lt)it[nt]===void 0&&(it[nt]=lt[nt]);return{$$typeof:l$1,type:tt,key:st,ref:ot,props:it,_owner:K$3.current}}function N$3(tt,et){return{$$typeof:l$1,type:tt.type,key:et,ref:tt.ref,props:tt.props,_owner:tt._owner}}function O$3(tt){return typeof tt=="object"&&tt!==null&&tt.$$typeof===l$1}function escape(tt){var et={"=":"=0",":":"=2"};return"$"+tt.replace(/[=:]/g,function(rt){return et[rt]})}var P$2=/\/+/g;function Q$3(tt,et){return typeof tt=="object"&&tt!==null&&tt.key!=null?escape(""+tt.key):et.toString(36)}function R$3(tt,et,rt,nt,it){var st=typeof tt;(st==="undefined"||st==="boolean")&&(tt=null);var ot=!1;if(tt===null)ot=!0;else switch(st){case"string":case"number":ot=!0;break;case"object":switch(tt.$$typeof){case l$1:case n$2:ot=!0}}if(ot)return ot=tt,it=it(ot),tt=nt===""?"."+Q$3(ot,0):nt,I$2(it)?(rt="",tt!=null&&(rt=tt.replace(P$2,"$&/")+"/"),R$3(it,et,rt,"",function(ct){return ct})):it!=null&&(O$3(it)&&(it=N$3(it,rt+(!it.key||ot&&ot.key===it.key?"":(""+it.key).replace(P$2,"$&/")+"/")+tt)),et.push(it)),1;if(ot=0,nt=nt===""?".":nt+":",I$2(tt))for(var lt=0;lt<tt.length;lt++){st=tt[lt];var ut=nt+Q$3(st,lt);ot+=R$3(st,et,rt,ut,it)}else if(ut=A$2(tt),typeof ut=="function")for(tt=ut.call(tt),lt=0;!(st=tt.next()).done;)st=st.value,ut=nt+Q$3(st,lt++),ot+=R$3(st,et,rt,ut,it);else if(st==="object")throw et=String(tt),Error("Objects are not valid as a React child (found: "+(et==="[object Object]"?"object with keys {"+Object.keys(tt).join(", ")+"}":et)+"). If you meant to render a collection of children, use an array instead.");return ot}function S$3(tt,et,rt){if(tt==null)return tt;var nt=[],it=0;return R$3(tt,nt,"","",function(st){return et.call(rt,st,it++)}),nt}function T$3(tt){if(tt._status===-1){var et=tt._result;et=et(),et.then(function(rt){(tt._status===0||tt._status===-1)&&(tt._status=1,tt._result=rt)},function(rt){(tt._status===0||tt._status===-1)&&(tt._status=2,tt._result=rt)}),tt._status===-1&&(tt._status=0,tt._result=et)}if(tt._status===1)return tt._result.default;throw tt._result}var U$2={current:null},V$2={transition:null},W$3={ReactCurrentDispatcher:U$2,ReactCurrentBatchConfig:V$2,ReactCurrentOwner:K$3};react_production_min.Children={map:S$3,forEach:function(tt,et,rt){S$3(tt,function(){et.apply(this,arguments)},rt)},count:function(tt){var et=0;return S$3(tt,function(){et++}),et},toArray:function(tt){return S$3(tt,function(et){return et})||[]},only:function(tt){if(!O$3(tt))throw Error("React.Children.only expected to receive a single React element child.");return tt}};react_production_min.Component=E$2;react_production_min.Fragment=p$2;react_production_min.Profiler=r$1;react_production_min.PureComponent=G$2;react_production_min.StrictMode=q$1;react_production_min.Suspense=w$1;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$3;react_production_min.cloneElement=function(tt,et,rt){if(tt==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+tt+".");var nt=C$2({},tt.props),it=tt.key,st=tt.ref,ot=tt._owner;if(et!=null){if(et.ref!==void 0&&(st=et.ref,ot=K$3.current),et.key!==void 0&&(it=""+et.key),tt.type&&tt.type.defaultProps)var lt=tt.type.defaultProps;for(ut in et)J$2.call(et,ut)&&!L$3.hasOwnProperty(ut)&&(nt[ut]=et[ut]===void 0&&lt!==void 0?lt[ut]:et[ut])}var ut=arguments.length-2;if(ut===1)nt.children=rt;else if(1<ut){lt=Array(ut);for(var ct=0;ct<ut;ct++)lt[ct]=arguments[ct+2];nt.children=lt}return{$$typeof:l$1,type:tt.type,key:it,ref:st,props:nt,_owner:ot}};react_production_min.createContext=function(tt){return tt={$$typeof:u$2,_currentValue:tt,_currentValue2:tt,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},tt.Provider={$$typeof:t$2,_context:tt},tt.Consumer=tt};react_production_min.createElement=M$2;react_production_min.createFactory=function(tt){var et=M$2.bind(null,tt);return et.type=tt,et};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(tt){return{$$typeof:v$2,render:tt}};react_production_min.isValidElement=O$3;react_production_min.lazy=function(tt){return{$$typeof:y$2,_payload:{_status:-1,_result:tt},_init:T$3}};react_production_min.memo=function(tt,et){return{$$typeof:x$2,type:tt,compare:et===void 0?null:et}};react_production_min.startTransition=function(tt){var et=V$2.transition;V$2.transition={};try{tt()}finally{V$2.transition=et}};react_production_min.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};react_production_min.useCallback=function(tt,et){return U$2.current.useCallback(tt,et)};react_production_min.useContext=function(tt){return U$2.current.useContext(tt)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(tt){return U$2.current.useDeferredValue(tt)};react_production_min.useEffect=function(tt,et){return U$2.current.useEffect(tt,et)};react_production_min.useId=function(){return U$2.current.useId()};react_production_min.useImperativeHandle=function(tt,et,rt){return U$2.current.useImperativeHandle(tt,et,rt)};react_production_min.useInsertionEffect=function(tt,et){return U$2.current.useInsertionEffect(tt,et)};react_production_min.useLayoutEffect=function(tt,et){return U$2.current.useLayoutEffect(tt,et)};react_production_min.useMemo=function(tt,et){return U$2.current.useMemo(tt,et)};react_production_min.useReducer=function(tt,et,rt){return U$2.current.useReducer(tt,et,rt)};react_production_min.useRef=function(tt){return U$2.current.useRef(tt)};react_production_min.useState=function(tt){return U$2.current.useState(tt)};react_production_min.useSyncExternalStore=function(tt,et,rt){return U$2.current.useSyncExternalStore(tt,et,rt)};react_production_min.useTransition=function(){return U$2.current.useTransition()};react_production_min.version="18.2.0";react.exports=react_production_min;var reactExports=react.exports;const e$1=getDefaultExportFromCjs$1(reactExports),$2AODx$react=_mergeNamespaces({__proto__:null,default:e$1},[reactExports]);var reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(tt){function et(gs,ys){var Es=gs.length;gs.push(ys);e:for(;0<Es;){var Ss=Es-1>>>1,Ts=gs[Ss];if(0<it(Ts,ys))gs[Ss]=ys,gs[Es]=Ts,Es=Ss;else break e}}function rt(gs){return gs.length===0?null:gs[0]}function nt(gs){if(gs.length===0)return null;var ys=gs[0],Es=gs.pop();if(Es!==ys){gs[0]=Es;e:for(var Ss=0,Ts=gs.length,Ds=Ts>>>1;Ss<Ds;){var Rs=2*(Ss+1)-1,Is=gs[Rs],ks=Rs+1,As=gs[ks];if(0>it(Is,Es))ks<Ts&&0>it(As,Is)?(gs[Ss]=As,gs[ks]=Es,Ss=ks):(gs[Ss]=Is,gs[Rs]=Es,Ss=Rs);else if(ks<Ts&&0>it(As,Es))gs[Ss]=As,gs[ks]=Es,Ss=ks;else break e}}return ys}function it(gs,ys){var Es=gs.sortIndex-ys.sortIndex;return Es!==0?Es:gs.id-ys.id}if(typeof performance=="object"&&typeof performance.now=="function"){var st=performance;tt.unstable_now=function(){return st.now()}}else{var ot=Date,lt=ot.now();tt.unstable_now=function(){return ot.now()-lt}}var ut=[],ct=[],dt=1,pt=null,ft=3,gt=!1,_r=!1,Yr=!1,mt=typeof setTimeout=="function"?setTimeout:null,Kr=typeof clearTimeout=="function"?clearTimeout:null,Xr=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Zr(gs){for(var ys=rt(ct);ys!==null;){if(ys.callback===null)nt(ct);else if(ys.startTime<=gs)nt(ct),ys.sortIndex=ys.expirationTime,et(ut,ys);else break;ys=rt(ct)}}function Qr(gs){if(Yr=!1,Zr(gs),!_r)if(rt(ut)!==null)_r=!0,ms(_i);else{var ys=rt(ct);ys!==null&&us(Qr,ys.startTime-gs)}}function _i(gs,ys){_r=!1,Yr&&(Yr=!1,Kr(ss),ss=-1),gt=!0;var Es=ft;try{for(Zr(ys),pt=rt(ut);pt!==null&&(!(pt.expirationTime>ys)||gs&&!is());){var Ss=pt.callback;if(typeof Ss=="function"){pt.callback=null,ft=pt.priorityLevel;var Ts=Ss(pt.expirationTime<=ys);ys=tt.unstable_now(),typeof Ts=="function"?pt.callback=Ts:pt===rt(ut)&&nt(ut),Zr(ys)}else nt(ut);pt=rt(ut)}if(pt!==null)var Ds=!0;else{var Rs=rt(ct);Rs!==null&&us(Qr,Rs.startTime-ys),Ds=!1}return Ds}finally{pt=null,ft=Es,gt=!1}}var ns=!1,rs=null,ss=-1,hs=5,os=-1;function is(){return!(tt.unstable_now()-os<hs)}function cs(){if(rs!==null){var gs=tt.unstable_now();os=gs;var ys=!0;try{ys=rs(!0,gs)}finally{ys?ps():(ns=!1,rs=null)}}else ns=!1}var ps;if(typeof Xr=="function")ps=function(){Xr(cs)};else if(typeof MessageChannel<"u"){var vs=new MessageChannel,ls=vs.port2;vs.port1.onmessage=cs,ps=function(){ls.postMessage(null)}}else ps=function(){mt(cs,0)};function ms(gs){rs=gs,ns||(ns=!0,ps())}function us(gs,ys){ss=mt(function(){gs(tt.unstable_now())},ys)}tt.unstable_IdlePriority=5,tt.unstable_ImmediatePriority=1,tt.unstable_LowPriority=4,tt.unstable_NormalPriority=3,tt.unstable_Profiling=null,tt.unstable_UserBlockingPriority=2,tt.unstable_cancelCallback=function(gs){gs.callback=null},tt.unstable_continueExecution=function(){_r||gt||(_r=!0,ms(_i))},tt.unstable_forceFrameRate=function(gs){0>gs||125<gs?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):hs=0<gs?Math.floor(1e3/gs):5},tt.unstable_getCurrentPriorityLevel=function(){return ft},tt.unstable_getFirstCallbackNode=function(){return rt(ut)},tt.unstable_next=function(gs){switch(ft){case 1:case 2:case 3:var ys=3;break;default:ys=ft}var Es=ft;ft=ys;try{return gs()}finally{ft=Es}},tt.unstable_pauseExecution=function(){},tt.unstable_requestPaint=function(){},tt.unstable_runWithPriority=function(gs,ys){switch(gs){case 1:case 2:case 3:case 4:case 5:break;default:gs=3}var Es=ft;ft=gs;try{return ys()}finally{ft=Es}},tt.unstable_scheduleCallback=function(gs,ys,Es){var Ss=tt.unstable_now();switch(typeof Es=="object"&&Es!==null?(Es=Es.delay,Es=typeof Es=="number"&&0<Es?Ss+Es:Ss):Es=Ss,gs){case 1:var Ts=-1;break;case 2:Ts=250;break;case 5:Ts=1073741823;break;case 4:Ts=1e4;break;default:Ts=5e3}return Ts=Es+Ts,gs={id:dt++,callback:ys,priorityLevel:gs,startTime:Es,expirationTime:Ts,sortIndex:-1},Es>Ss?(gs.sortIndex=Es,et(ct,gs),rt(ut)===null&&gs===rt(ct)&&(Yr?(Kr(ss),ss=-1):Yr=!0,us(Qr,Es-Ss))):(gs.sortIndex=Ts,et(ut,gs),_r||gt||(_r=!0,ms(_i))),gs},tt.unstable_shouldYield=is,tt.unstable_wrapCallback=function(gs){var ys=ft;return function(){var Es=ft;ft=ys;try{return gs.apply(this,arguments)}finally{ft=Es}}}})(scheduler_production_min);scheduler.exports=scheduler_production_min;var schedulerExports=scheduler.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports;function p$1(tt){for(var et="https://reactjs.org/docs/error-decoder.html?invariant="+tt,rt=1;rt<arguments.length;rt++)et+="&args[]="+encodeURIComponent(arguments[rt]);return"Minified React error #"+tt+"; visit "+et+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(tt,et){ha(tt,et),ha(tt+"Capture",et)}function ha(tt,et){for(ea[tt]=et,tt=0;tt<et.length;tt++)da.add(et[tt])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa(tt){return ja.call(ma,tt)?!0:ja.call(la,tt)?!1:ka.test(tt)?ma[tt]=!0:(la[tt]=!0,!1)}function pa(tt,et,rt,nt){if(rt!==null&&rt.type===0)return!1;switch(typeof et){case"function":case"symbol":return!0;case"boolean":return nt?!1:rt!==null?!rt.acceptsBooleans:(tt=tt.toLowerCase().slice(0,5),tt!=="data-"&&tt!=="aria-");default:return!1}}function qa(tt,et,rt,nt){if(et===null||typeof et>"u"||pa(tt,et,rt,nt))return!0;if(nt)return!1;if(rt!==null)switch(rt.type){case 3:return!et;case 4:return et===!1;case 5:return isNaN(et);case 6:return isNaN(et)||1>et}return!1}function v$1(tt,et,rt,nt,it,st,ot){this.acceptsBooleans=et===2||et===3||et===4,this.attributeName=nt,this.attributeNamespace=it,this.mustUseProperty=rt,this.propertyName=tt,this.type=et,this.sanitizeURL=st,this.removeEmptyString=ot}var z$2={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(tt){z$2[tt]=new v$1(tt,0,!1,tt,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(tt){var et=tt[0];z$2[et]=new v$1(et,1,!1,tt[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(tt){z$2[tt]=new v$1(tt,2,!1,tt.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(tt){z$2[tt]=new v$1(tt,2,!1,tt,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(tt){z$2[tt]=new v$1(tt,3,!1,tt.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(tt){z$2[tt]=new v$1(tt,3,!0,tt,null,!1,!1)});["capture","download"].forEach(function(tt){z$2[tt]=new v$1(tt,4,!1,tt,null,!1,!1)});["cols","rows","size","span"].forEach(function(tt){z$2[tt]=new v$1(tt,6,!1,tt,null,!1,!1)});["rowSpan","start"].forEach(function(tt){z$2[tt]=new v$1(tt,5,!1,tt.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa(tt){return tt[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(tt){var et=tt.replace(ra,sa);z$2[et]=new v$1(et,1,!1,tt,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(tt){var et=tt.replace(ra,sa);z$2[et]=new v$1(et,1,!1,tt,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(tt){var et=tt.replace(ra,sa);z$2[et]=new v$1(et,1,!1,tt,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(tt){z$2[tt]=new v$1(tt,1,!1,tt.toLowerCase(),null,!1,!1)});z$2.xlinkHref=new v$1("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(tt){z$2[tt]=new v$1(tt,1,!1,tt.toLowerCase(),null,!0,!0)});function ta(tt,et,rt,nt){var it=z$2.hasOwnProperty(et)?z$2[et]:null;(it!==null?it.type!==0:nt||!(2<et.length)||et[0]!=="o"&&et[0]!=="O"||et[1]!=="n"&&et[1]!=="N")&&(qa(et,rt,it,nt)&&(rt=null),nt||it===null?oa(et)&&(rt===null?tt.removeAttribute(et):tt.setAttribute(et,""+rt)):it.mustUseProperty?tt[it.propertyName]=rt===null?it.type===3?!1:"":rt:(et=it.attributeName,nt=it.attributeNamespace,rt===null?tt.removeAttribute(et):(it=it.type,rt=it===3||it===4&&rt===!0?"":""+rt,nt?tt.setAttributeNS(nt,et,rt):tt.setAttribute(et,rt))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka(tt){return tt===null||typeof tt!="object"?null:(tt=Ja&&tt[Ja]||tt["@@iterator"],typeof tt=="function"?tt:null)}var A$1=Object.assign,La;function Ma(tt){if(La===void 0)try{throw Error()}catch(rt){var et=rt.stack.trim().match(/\n( *(at )?)/);La=et&&et[1]||""}return`
`+La+tt}var Na=!1;function Oa(tt,et){if(!tt||Na)return"";Na=!0;var rt=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(et)if(et=function(){throw Error()},Object.defineProperty(et.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(et,[])}catch(ct){var nt=ct}Reflect.construct(tt,[],et)}else{try{et.call()}catch(ct){nt=ct}tt.call(et.prototype)}else{try{throw Error()}catch(ct){nt=ct}tt()}}catch(ct){if(ct&&nt&&typeof ct.stack=="string"){for(var it=ct.stack.split(`
`),st=nt.stack.split(`
`),ot=it.length-1,lt=st.length-1;1<=ot&&0<=lt&&it[ot]!==st[lt];)lt--;for(;1<=ot&&0<=lt;ot--,lt--)if(it[ot]!==st[lt]){if(ot!==1||lt!==1)do if(ot--,lt--,0>lt||it[ot]!==st[lt]){var ut=`
`+it[ot].replace(" at new "," at ");return tt.displayName&&ut.includes("<anonymous>")&&(ut=ut.replace("<anonymous>",tt.displayName)),ut}while(1<=ot&&0<=lt);break}}}finally{Na=!1,Error.prepareStackTrace=rt}return(tt=tt?tt.displayName||tt.name:"")?Ma(tt):""}function Pa(tt){switch(tt.tag){case 5:return Ma(tt.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return tt=Oa(tt.type,!1),tt;case 11:return tt=Oa(tt.type.render,!1),tt;case 1:return tt=Oa(tt.type,!0),tt;default:return""}}function Qa(tt){if(tt==null)return null;if(typeof tt=="function")return tt.displayName||tt.name||null;if(typeof tt=="string")return tt;switch(tt){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof tt=="object")switch(tt.$$typeof){case Ca:return(tt.displayName||"Context")+".Consumer";case Ba:return(tt._context.displayName||"Context")+".Provider";case Da:var et=tt.render;return tt=tt.displayName,tt||(tt=et.displayName||et.name||"",tt=tt!==""?"ForwardRef("+tt+")":"ForwardRef"),tt;case Ga:return et=tt.displayName||null,et!==null?et:Qa(tt.type)||"Memo";case Ha:et=tt._payload,tt=tt._init;try{return Qa(tt(et))}catch{}}return null}function Ra(tt){var et=tt.type;switch(tt.tag){case 24:return"Cache";case 9:return(et.displayName||"Context")+".Consumer";case 10:return(et._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return tt=et.render,tt=tt.displayName||tt.name||"",et.displayName||(tt!==""?"ForwardRef("+tt+")":"ForwardRef");case 7:return"Fragment";case 5:return et;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(et);case 8:return et===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof et=="function")return et.displayName||et.name||null;if(typeof et=="string")return et}return null}function Sa(tt){switch(typeof tt){case"boolean":case"number":case"string":case"undefined":return tt;case"object":return tt;default:return""}}function Ta(tt){var et=tt.type;return(tt=tt.nodeName)&&tt.toLowerCase()==="input"&&(et==="checkbox"||et==="radio")}function Ua(tt){var et=Ta(tt)?"checked":"value",rt=Object.getOwnPropertyDescriptor(tt.constructor.prototype,et),nt=""+tt[et];if(!tt.hasOwnProperty(et)&&typeof rt<"u"&&typeof rt.get=="function"&&typeof rt.set=="function"){var it=rt.get,st=rt.set;return Object.defineProperty(tt,et,{configurable:!0,get:function(){return it.call(this)},set:function(ot){nt=""+ot,st.call(this,ot)}}),Object.defineProperty(tt,et,{enumerable:rt.enumerable}),{getValue:function(){return nt},setValue:function(ot){nt=""+ot},stopTracking:function(){tt._valueTracker=null,delete tt[et]}}}}function Va(tt){tt._valueTracker||(tt._valueTracker=Ua(tt))}function Wa(tt){if(!tt)return!1;var et=tt._valueTracker;if(!et)return!0;var rt=et.getValue(),nt="";return tt&&(nt=Ta(tt)?tt.checked?"true":"false":tt.value),tt=nt,tt!==rt?(et.setValue(tt),!0):!1}function Xa(tt){if(tt=tt||(typeof document<"u"?document:void 0),typeof tt>"u")return null;try{return tt.activeElement||tt.body}catch{return tt.body}}function Ya(tt,et){var rt=et.checked;return A$1({},et,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:rt??tt._wrapperState.initialChecked})}function Za(tt,et){var rt=et.defaultValue==null?"":et.defaultValue,nt=et.checked!=null?et.checked:et.defaultChecked;rt=Sa(et.value!=null?et.value:rt),tt._wrapperState={initialChecked:nt,initialValue:rt,controlled:et.type==="checkbox"||et.type==="radio"?et.checked!=null:et.value!=null}}function ab(tt,et){et=et.checked,et!=null&&ta(tt,"checked",et,!1)}function bb(tt,et){ab(tt,et);var rt=Sa(et.value),nt=et.type;if(rt!=null)nt==="number"?(rt===0&&tt.value===""||tt.value!=rt)&&(tt.value=""+rt):tt.value!==""+rt&&(tt.value=""+rt);else if(nt==="submit"||nt==="reset"){tt.removeAttribute("value");return}et.hasOwnProperty("value")?cb(tt,et.type,rt):et.hasOwnProperty("defaultValue")&&cb(tt,et.type,Sa(et.defaultValue)),et.checked==null&&et.defaultChecked!=null&&(tt.defaultChecked=!!et.defaultChecked)}function db(tt,et,rt){if(et.hasOwnProperty("value")||et.hasOwnProperty("defaultValue")){var nt=et.type;if(!(nt!=="submit"&&nt!=="reset"||et.value!==void 0&&et.value!==null))return;et=""+tt._wrapperState.initialValue,rt||et===tt.value||(tt.value=et),tt.defaultValue=et}rt=tt.name,rt!==""&&(tt.name=""),tt.defaultChecked=!!tt._wrapperState.initialChecked,rt!==""&&(tt.name=rt)}function cb(tt,et,rt){(et!=="number"||Xa(tt.ownerDocument)!==tt)&&(rt==null?tt.defaultValue=""+tt._wrapperState.initialValue:tt.defaultValue!==""+rt&&(tt.defaultValue=""+rt))}var eb=Array.isArray;function fb(tt,et,rt,nt){if(tt=tt.options,et){et={};for(var it=0;it<rt.length;it++)et["$"+rt[it]]=!0;for(rt=0;rt<tt.length;rt++)it=et.hasOwnProperty("$"+tt[rt].value),tt[rt].selected!==it&&(tt[rt].selected=it),it&&nt&&(tt[rt].defaultSelected=!0)}else{for(rt=""+Sa(rt),et=null,it=0;it<tt.length;it++){if(tt[it].value===rt){tt[it].selected=!0,nt&&(tt[it].defaultSelected=!0);return}et!==null||tt[it].disabled||(et=tt[it])}et!==null&&(et.selected=!0)}}function gb(tt,et){if(et.dangerouslySetInnerHTML!=null)throw Error(p$1(91));return A$1({},et,{value:void 0,defaultValue:void 0,children:""+tt._wrapperState.initialValue})}function hb(tt,et){var rt=et.value;if(rt==null){if(rt=et.children,et=et.defaultValue,rt!=null){if(et!=null)throw Error(p$1(92));if(eb(rt)){if(1<rt.length)throw Error(p$1(93));rt=rt[0]}et=rt}et==null&&(et=""),rt=et}tt._wrapperState={initialValue:Sa(rt)}}function ib(tt,et){var rt=Sa(et.value),nt=Sa(et.defaultValue);rt!=null&&(rt=""+rt,rt!==tt.value&&(tt.value=rt),et.defaultValue==null&&tt.defaultValue!==rt&&(tt.defaultValue=rt)),nt!=null&&(tt.defaultValue=""+nt)}function jb(tt){var et=tt.textContent;et===tt._wrapperState.initialValue&&et!==""&&et!==null&&(tt.value=et)}function kb(tt){switch(tt){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(tt,et){return tt==null||tt==="http://www.w3.org/1999/xhtml"?kb(et):tt==="http://www.w3.org/2000/svg"&&et==="foreignObject"?"http://www.w3.org/1999/xhtml":tt}var mb,nb=function(tt){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(et,rt,nt,it){MSApp.execUnsafeLocalFunction(function(){return tt(et,rt,nt,it)})}:tt}(function(tt,et){if(tt.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in tt)tt.innerHTML=et;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+et.valueOf().toString()+"</svg>",et=mb.firstChild;tt.firstChild;)tt.removeChild(tt.firstChild);for(;et.firstChild;)tt.appendChild(et.firstChild)}});function ob(tt,et){if(et){var rt=tt.firstChild;if(rt&&rt===tt.lastChild&&rt.nodeType===3){rt.nodeValue=et;return}}tt.textContent=et}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(tt){qb.forEach(function(et){et=et+tt.charAt(0).toUpperCase()+tt.substring(1),pb[et]=pb[tt]})});function rb(tt,et,rt){return et==null||typeof et=="boolean"||et===""?"":rt||typeof et!="number"||et===0||pb.hasOwnProperty(tt)&&pb[tt]?(""+et).trim():et+"px"}function sb(tt,et){tt=tt.style;for(var rt in et)if(et.hasOwnProperty(rt)){var nt=rt.indexOf("--")===0,it=rb(rt,et[rt],nt);rt==="float"&&(rt="cssFloat"),nt?tt.setProperty(rt,it):tt[rt]=it}}var tb=A$1({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(tt,et){if(et){if(tb[tt]&&(et.children!=null||et.dangerouslySetInnerHTML!=null))throw Error(p$1(137,tt));if(et.dangerouslySetInnerHTML!=null){if(et.children!=null)throw Error(p$1(60));if(typeof et.dangerouslySetInnerHTML!="object"||!("__html"in et.dangerouslySetInnerHTML))throw Error(p$1(61))}if(et.style!=null&&typeof et.style!="object")throw Error(p$1(62))}}function vb(tt,et){if(tt.indexOf("-")===-1)return typeof et.is=="string";switch(tt){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(tt){return tt=tt.target||tt.srcElement||window,tt.correspondingUseElement&&(tt=tt.correspondingUseElement),tt.nodeType===3?tt.parentNode:tt}var yb=null,zb=null,Ab=null;function Bb(tt){if(tt=Cb(tt)){if(typeof yb!="function")throw Error(p$1(280));var et=tt.stateNode;et&&(et=Db(et),yb(tt.stateNode,tt.type,et))}}function Eb(tt){zb?Ab?Ab.push(tt):Ab=[tt]:zb=tt}function Fb(){if(zb){var tt=zb,et=Ab;if(Ab=zb=null,Bb(tt),et)for(tt=0;tt<et.length;tt++)Bb(et[tt])}}function Gb(tt,et){return tt(et)}function Hb(){}var Ib=!1;function Jb(tt,et,rt){if(Ib)return tt(et,rt);Ib=!0;try{return Gb(tt,et,rt)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb(tt,et){var rt=tt.stateNode;if(rt===null)return null;var nt=Db(rt);if(nt===null)return null;rt=nt[et];e:switch(et){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(nt=!nt.disabled)||(tt=tt.type,nt=!(tt==="button"||tt==="input"||tt==="select"||tt==="textarea")),tt=!nt;break e;default:tt=!1}if(tt)return null;if(rt&&typeof rt!="function")throw Error(p$1(231,et,typeof rt));return rt}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch{Lb=!1}function Nb(tt,et,rt,nt,it,st,ot,lt,ut){var ct=Array.prototype.slice.call(arguments,3);try{et.apply(rt,ct)}catch(dt){this.onError(dt)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function(tt){Ob=!0,Pb=tt}};function Tb(tt,et,rt,nt,it,st,ot,lt,ut){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub(tt,et,rt,nt,it,st,ot,lt,ut){if(Tb.apply(this,arguments),Ob){if(Ob){var ct=Pb;Ob=!1,Pb=null}else throw Error(p$1(198));Qb||(Qb=!0,Rb=ct)}}function Vb(tt){var et=tt,rt=tt;if(tt.alternate)for(;et.return;)et=et.return;else{tt=et;do et=tt,et.flags&4098&&(rt=et.return),tt=et.return;while(tt)}return et.tag===3?rt:null}function Wb(tt){if(tt.tag===13){var et=tt.memoizedState;if(et===null&&(tt=tt.alternate,tt!==null&&(et=tt.memoizedState)),et!==null)return et.dehydrated}return null}function Xb(tt){if(Vb(tt)!==tt)throw Error(p$1(188))}function Yb(tt){var et=tt.alternate;if(!et){if(et=Vb(tt),et===null)throw Error(p$1(188));return et!==tt?null:tt}for(var rt=tt,nt=et;;){var it=rt.return;if(it===null)break;var st=it.alternate;if(st===null){if(nt=it.return,nt!==null){rt=nt;continue}break}if(it.child===st.child){for(st=it.child;st;){if(st===rt)return Xb(it),tt;if(st===nt)return Xb(it),et;st=st.sibling}throw Error(p$1(188))}if(rt.return!==nt.return)rt=it,nt=st;else{for(var ot=!1,lt=it.child;lt;){if(lt===rt){ot=!0,rt=it,nt=st;break}if(lt===nt){ot=!0,nt=it,rt=st;break}lt=lt.sibling}if(!ot){for(lt=st.child;lt;){if(lt===rt){ot=!0,rt=st,nt=it;break}if(lt===nt){ot=!0,nt=st,rt=it;break}lt=lt.sibling}if(!ot)throw Error(p$1(189))}}if(rt.alternate!==nt)throw Error(p$1(190))}if(rt.tag!==3)throw Error(p$1(188));return rt.stateNode.current===rt?tt:et}function Zb(tt){return tt=Yb(tt),tt!==null?$b(tt):null}function $b(tt){if(tt.tag===5||tt.tag===6)return tt;for(tt=tt.child;tt!==null;){var et=$b(tt);if(et!==null)return et;tt=tt.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B$1=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc(tt){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,tt,void 0,(tt.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc(tt){return tt>>>=0,tt===0?32:31-(pc(tt)/qc|0)|0}var rc=64,sc=4194304;function tc(tt){switch(tt&-tt){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return tt&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return tt&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return tt}}function uc(tt,et){var rt=tt.pendingLanes;if(rt===0)return 0;var nt=0,it=tt.suspendedLanes,st=tt.pingedLanes,ot=rt&268435455;if(ot!==0){var lt=ot&~it;lt!==0?nt=tc(lt):(st&=ot,st!==0&&(nt=tc(st)))}else ot=rt&~it,ot!==0?nt=tc(ot):st!==0&&(nt=tc(st));if(nt===0)return 0;if(et!==0&&et!==nt&&!(et&it)&&(it=nt&-nt,st=et&-et,it>=st||it===16&&(st&4194240)!==0))return et;if(nt&4&&(nt|=rt&16),et=tt.entangledLanes,et!==0)for(tt=tt.entanglements,et&=nt;0<et;)rt=31-oc(et),it=1<<rt,nt|=tt[rt],et&=~it;return nt}function vc(tt,et){switch(tt){case 1:case 2:case 4:return et+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return et+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc(tt,et){for(var rt=tt.suspendedLanes,nt=tt.pingedLanes,it=tt.expirationTimes,st=tt.pendingLanes;0<st;){var ot=31-oc(st),lt=1<<ot,ut=it[ot];ut===-1?(!(lt&rt)||lt&nt)&&(it[ot]=vc(lt,et)):ut<=et&&(tt.expiredLanes|=lt),st&=~lt}}function xc(tt){return tt=tt.pendingLanes&-1073741825,tt!==0?tt:tt&1073741824?1073741824:0}function yc(){var tt=rc;return rc<<=1,!(rc&4194240)&&(rc=64),tt}function zc(tt){for(var et=[],rt=0;31>rt;rt++)et.push(tt);return et}function Ac(tt,et,rt){tt.pendingLanes|=et,et!==536870912&&(tt.suspendedLanes=0,tt.pingedLanes=0),tt=tt.eventTimes,et=31-oc(et),tt[et]=rt}function Bc(tt,et){var rt=tt.pendingLanes&~et;tt.pendingLanes=et,tt.suspendedLanes=0,tt.pingedLanes=0,tt.expiredLanes&=et,tt.mutableReadLanes&=et,tt.entangledLanes&=et,et=tt.entanglements;var nt=tt.eventTimes;for(tt=tt.expirationTimes;0<rt;){var it=31-oc(rt),st=1<<it;et[it]=0,nt[it]=-1,tt[it]=-1,rt&=~st}}function Cc(tt,et){var rt=tt.entangledLanes|=et;for(tt=tt.entanglements;rt;){var nt=31-oc(rt),it=1<<nt;it&et|tt[nt]&et&&(tt[nt]|=et),rt&=~it}}var C$1=0;function Dc(tt){return tt&=-tt,1<tt?4<tt?tt&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(tt,et){switch(tt){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(et.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(et.pointerId)}}function Tc(tt,et,rt,nt,it,st){return tt===null||tt.nativeEvent!==st?(tt={blockedOn:et,domEventName:rt,eventSystemFlags:nt,nativeEvent:st,targetContainers:[it]},et!==null&&(et=Cb(et),et!==null&&Fc(et)),tt):(tt.eventSystemFlags|=nt,et=tt.targetContainers,it!==null&&et.indexOf(it)===-1&&et.push(it),tt)}function Uc(tt,et,rt,nt,it){switch(et){case"focusin":return Lc=Tc(Lc,tt,et,rt,nt,it),!0;case"dragenter":return Mc=Tc(Mc,tt,et,rt,nt,it),!0;case"mouseover":return Nc=Tc(Nc,tt,et,rt,nt,it),!0;case"pointerover":var st=it.pointerId;return Oc.set(st,Tc(Oc.get(st)||null,tt,et,rt,nt,it)),!0;case"gotpointercapture":return st=it.pointerId,Pc.set(st,Tc(Pc.get(st)||null,tt,et,rt,nt,it)),!0}return!1}function Vc(tt){var et=Wc(tt.target);if(et!==null){var rt=Vb(et);if(rt!==null){if(et=rt.tag,et===13){if(et=Wb(rt),et!==null){tt.blockedOn=et,Ic(tt.priority,function(){Gc(rt)});return}}else if(et===3&&rt.stateNode.current.memoizedState.isDehydrated){tt.blockedOn=rt.tag===3?rt.stateNode.containerInfo:null;return}}}tt.blockedOn=null}function Xc(tt){if(tt.blockedOn!==null)return!1;for(var et=tt.targetContainers;0<et.length;){var rt=Yc(tt.domEventName,tt.eventSystemFlags,et[0],tt.nativeEvent);if(rt===null){rt=tt.nativeEvent;var nt=new rt.constructor(rt.type,rt);wb=nt,rt.target.dispatchEvent(nt),wb=null}else return et=Cb(rt),et!==null&&Fc(et),tt.blockedOn=rt,!1;et.shift()}return!0}function Zc(tt,et,rt){Xc(tt)&&rt.delete(et)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad(tt,et){tt.blockedOn===et&&(tt.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(tt){function et(it){return ad(it,tt)}if(0<Kc.length){ad(Kc[0],tt);for(var rt=1;rt<Kc.length;rt++){var nt=Kc[rt];nt.blockedOn===tt&&(nt.blockedOn=null)}}for(Lc!==null&&ad(Lc,tt),Mc!==null&&ad(Mc,tt),Nc!==null&&ad(Nc,tt),Oc.forEach(et),Pc.forEach(et),rt=0;rt<Qc.length;rt++)nt=Qc[rt],nt.blockedOn===tt&&(nt.blockedOn=null);for(;0<Qc.length&&(rt=Qc[0],rt.blockedOn===null);)Vc(rt),rt.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed(tt,et,rt,nt){var it=C$1,st=cd.transition;cd.transition=null;try{C$1=1,fd(tt,et,rt,nt)}finally{C$1=it,cd.transition=st}}function gd(tt,et,rt,nt){var it=C$1,st=cd.transition;cd.transition=null;try{C$1=4,fd(tt,et,rt,nt)}finally{C$1=it,cd.transition=st}}function fd(tt,et,rt,nt){if(dd){var it=Yc(tt,et,rt,nt);if(it===null)hd(tt,et,nt,id,rt),Sc(tt,nt);else if(Uc(it,tt,et,rt,nt))nt.stopPropagation();else if(Sc(tt,nt),et&4&&-1<Rc.indexOf(tt)){for(;it!==null;){var st=Cb(it);if(st!==null&&Ec(st),st=Yc(tt,et,rt,nt),st===null&&hd(tt,et,nt,id,rt),st===it)break;it=st}it!==null&&nt.stopPropagation()}else hd(tt,et,nt,null,rt)}}var id=null;function Yc(tt,et,rt,nt){if(id=null,tt=xb(nt),tt=Wc(tt),tt!==null)if(et=Vb(tt),et===null)tt=null;else if(rt=et.tag,rt===13){if(tt=Wb(et),tt!==null)return tt;tt=null}else if(rt===3){if(et.stateNode.current.memoizedState.isDehydrated)return et.tag===3?et.stateNode.containerInfo:null;tt=null}else et!==tt&&(tt=null);return id=tt,null}function jd(tt){switch(tt){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var tt,et=ld,rt=et.length,nt,it="value"in kd?kd.value:kd.textContent,st=it.length;for(tt=0;tt<rt&&et[tt]===it[tt];tt++);var ot=rt-tt;for(nt=1;nt<=ot&&et[rt-nt]===it[st-nt];nt++);return md=it.slice(tt,1<nt?1-nt:void 0)}function od(tt){var et=tt.keyCode;return"charCode"in tt?(tt=tt.charCode,tt===0&&et===13&&(tt=13)):tt=et,tt===10&&(tt=13),32<=tt||tt===13?tt:0}function pd(){return!0}function qd(){return!1}function rd(tt){function et(rt,nt,it,st,ot){this._reactName=rt,this._targetInst=it,this.type=nt,this.nativeEvent=st,this.target=ot,this.currentTarget=null;for(var lt in tt)tt.hasOwnProperty(lt)&&(rt=tt[lt],this[lt]=rt?rt(st):st[lt]);return this.isDefaultPrevented=(st.defaultPrevented!=null?st.defaultPrevented:st.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A$1(et.prototype,{preventDefault:function(){this.defaultPrevented=!0;var rt=this.nativeEvent;rt&&(rt.preventDefault?rt.preventDefault():typeof rt.returnValue!="unknown"&&(rt.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var rt=this.nativeEvent;rt&&(rt.stopPropagation?rt.stopPropagation():typeof rt.cancelBubble!="unknown"&&(rt.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),et}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(tt){return tt.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A$1({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A$1({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(tt){return tt.relatedTarget===void 0?tt.fromElement===tt.srcElement?tt.toElement:tt.fromElement:tt.relatedTarget},movementX:function(tt){return"movementX"in tt?tt.movementX:(tt!==yd&&(yd&&tt.type==="mousemove"?(wd=tt.screenX-yd.screenX,xd=tt.screenY-yd.screenY):xd=wd=0,yd=tt),wd)},movementY:function(tt){return"movementY"in tt?tt.movementY:xd}}),Bd=rd(Ad),Cd=A$1({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A$1({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A$1({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A$1({},sd,{clipboardData:function(tt){return"clipboardData"in tt?tt.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A$1({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(tt){var et=this.nativeEvent;return et.getModifierState?et.getModifierState(tt):(tt=Od[tt])?!!et[tt]:!1}function zd(){return Pd}var Qd=A$1({},ud,{key:function(tt){if(tt.key){var et=Md[tt.key]||tt.key;if(et!=="Unidentified")return et}return tt.type==="keypress"?(tt=od(tt),tt===13?"Enter":String.fromCharCode(tt)):tt.type==="keydown"||tt.type==="keyup"?Nd[tt.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(tt){return tt.type==="keypress"?od(tt):0},keyCode:function(tt){return tt.type==="keydown"||tt.type==="keyup"?tt.keyCode:0},which:function(tt){return tt.type==="keypress"?od(tt):tt.type==="keydown"||tt.type==="keyup"?tt.keyCode:0}}),Rd=rd(Qd),Sd=A$1({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A$1({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A$1({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A$1({},Ad,{deltaX:function(tt){return"deltaX"in tt?tt.deltaX:"wheelDeltaX"in tt?-tt.wheelDeltaX:0},deltaY:function(tt){return"deltaY"in tt?tt.deltaY:"wheelDeltaY"in tt?-tt.wheelDeltaY:"wheelDelta"in tt?-tt.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae=ia&&"CompositionEvent"in window,be=null;ia&&"documentMode"in document&&(be=document.documentMode);var ce$1=ia&&"TextEvent"in window&&!be,de$1=ia&&(!ae||be&&8<be&&11>=be),ee=" ",fe$1=!1;function ge$1(tt,et){switch(tt){case"keyup":return $d.indexOf(et.keyCode)!==-1;case"keydown":return et.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he$1(tt){return tt=tt.detail,typeof tt=="object"&&"data"in tt?tt.data:null}var ie=!1;function je$1(tt,et){switch(tt){case"compositionend":return he$1(et);case"keypress":return et.which!==32?null:(fe$1=!0,ee);case"textInput":return tt=et.data,tt===ee&&fe$1?null:tt;default:return null}}function ke$1(tt,et){if(ie)return tt==="compositionend"||!ae&&ge$1(tt,et)?(tt=nd(),md=ld=kd=null,ie=!1,tt):null;switch(tt){case"paste":return null;case"keypress":if(!(et.ctrlKey||et.altKey||et.metaKey)||et.ctrlKey&&et.altKey){if(et.char&&1<et.char.length)return et.char;if(et.which)return String.fromCharCode(et.which)}return null;case"compositionend":return de$1&&et.locale!=="ko"?null:et.data;default:return null}}var le$1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me$1(tt){var et=tt&&tt.nodeName&&tt.nodeName.toLowerCase();return et==="input"?!!le$1[tt.type]:et==="textarea"}function ne$1(tt,et,rt,nt){Eb(nt),et=oe$1(et,"onChange"),0<et.length&&(rt=new td("onChange","change",null,rt,nt),tt.push({event:rt,listeners:et}))}var pe$1=null,qe$1=null;function re$1(tt){se$1(tt,0)}function te$1(tt){var et=ue$1(tt);if(Wa(et))return tt}function ve(tt,et){if(tt==="change")return et}var we$1=!1;if(ia){var xe$1;if(ia){var ye="oninput"in document;if(!ye){var ze$1=document.createElement("div");ze$1.setAttribute("oninput","return;"),ye=typeof ze$1.oninput=="function"}xe$1=ye}else xe$1=!1;we$1=xe$1&&(!document.documentMode||9<document.documentMode)}function Ae$1(){pe$1&&(pe$1.detachEvent("onpropertychange",Be$1),qe$1=pe$1=null)}function Be$1(tt){if(tt.propertyName==="value"&&te$1(qe$1)){var et=[];ne$1(et,qe$1,tt,xb(tt)),Jb(re$1,et)}}function Ce$1(tt,et,rt){tt==="focusin"?(Ae$1(),pe$1=et,qe$1=rt,pe$1.attachEvent("onpropertychange",Be$1)):tt==="focusout"&&Ae$1()}function De$1(tt){if(tt==="selectionchange"||tt==="keyup"||tt==="keydown")return te$1(qe$1)}function Ee$1(tt,et){if(tt==="click")return te$1(et)}function Fe$1(tt,et){if(tt==="input"||tt==="change")return te$1(et)}function Ge$1(tt,et){return tt===et&&(tt!==0||1/tt===1/et)||tt!==tt&&et!==et}var He$1=typeof Object.is=="function"?Object.is:Ge$1;function Ie$1(tt,et){if(He$1(tt,et))return!0;if(typeof tt!="object"||tt===null||typeof et!="object"||et===null)return!1;var rt=Object.keys(tt),nt=Object.keys(et);if(rt.length!==nt.length)return!1;for(nt=0;nt<rt.length;nt++){var it=rt[nt];if(!ja.call(et,it)||!He$1(tt[it],et[it]))return!1}return!0}function Je(tt){for(;tt&&tt.firstChild;)tt=tt.firstChild;return tt}function Ke(tt,et){var rt=Je(tt);tt=0;for(var nt;rt;){if(rt.nodeType===3){if(nt=tt+rt.textContent.length,tt<=et&&nt>=et)return{node:rt,offset:et-tt};tt=nt}e:{for(;rt;){if(rt.nextSibling){rt=rt.nextSibling;break e}rt=rt.parentNode}rt=void 0}rt=Je(rt)}}function Le$1(tt,et){return tt&&et?tt===et?!0:tt&&tt.nodeType===3?!1:et&&et.nodeType===3?Le$1(tt,et.parentNode):"contains"in tt?tt.contains(et):tt.compareDocumentPosition?!!(tt.compareDocumentPosition(et)&16):!1:!1}function Me$1(){for(var tt=window,et=Xa();et instanceof tt.HTMLIFrameElement;){try{var rt=typeof et.contentWindow.location.href=="string"}catch{rt=!1}if(rt)tt=et.contentWindow;else break;et=Xa(tt.document)}return et}function Ne$1(tt){var et=tt&&tt.nodeName&&tt.nodeName.toLowerCase();return et&&(et==="input"&&(tt.type==="text"||tt.type==="search"||tt.type==="tel"||tt.type==="url"||tt.type==="password")||et==="textarea"||tt.contentEditable==="true")}function Oe$1(tt){var et=Me$1(),rt=tt.focusedElem,nt=tt.selectionRange;if(et!==rt&&rt&&rt.ownerDocument&&Le$1(rt.ownerDocument.documentElement,rt)){if(nt!==null&&Ne$1(rt)){if(et=nt.start,tt=nt.end,tt===void 0&&(tt=et),"selectionStart"in rt)rt.selectionStart=et,rt.selectionEnd=Math.min(tt,rt.value.length);else if(tt=(et=rt.ownerDocument||document)&&et.defaultView||window,tt.getSelection){tt=tt.getSelection();var it=rt.textContent.length,st=Math.min(nt.start,it);nt=nt.end===void 0?st:Math.min(nt.end,it),!tt.extend&&st>nt&&(it=nt,nt=st,st=it),it=Ke(rt,st);var ot=Ke(rt,nt);it&&ot&&(tt.rangeCount!==1||tt.anchorNode!==it.node||tt.anchorOffset!==it.offset||tt.focusNode!==ot.node||tt.focusOffset!==ot.offset)&&(et=et.createRange(),et.setStart(it.node,it.offset),tt.removeAllRanges(),st>nt?(tt.addRange(et),tt.extend(ot.node,ot.offset)):(et.setEnd(ot.node,ot.offset),tt.addRange(et)))}}for(et=[],tt=rt;tt=tt.parentNode;)tt.nodeType===1&&et.push({element:tt,left:tt.scrollLeft,top:tt.scrollTop});for(typeof rt.focus=="function"&&rt.focus(),rt=0;rt<et.length;rt++)tt=et[rt],tt.element.scrollLeft=tt.left,tt.element.scrollTop=tt.top}}var Pe$1=ia&&"documentMode"in document&&11>=document.documentMode,Qe=null,Re$1=null,Se$1=null,Te$1=!1;function Ue$1(tt,et,rt){var nt=rt.window===rt?rt.document:rt.nodeType===9?rt:rt.ownerDocument;Te$1||Qe==null||Qe!==Xa(nt)||(nt=Qe,"selectionStart"in nt&&Ne$1(nt)?nt={start:nt.selectionStart,end:nt.selectionEnd}:(nt=(nt.ownerDocument&&nt.ownerDocument.defaultView||window).getSelection(),nt={anchorNode:nt.anchorNode,anchorOffset:nt.anchorOffset,focusNode:nt.focusNode,focusOffset:nt.focusOffset}),Se$1&&Ie$1(Se$1,nt)||(Se$1=nt,nt=oe$1(Re$1,"onSelect"),0<nt.length&&(et=new td("onSelect","select",null,et,rt),tt.push({event:et,listeners:nt}),et.target=Qe)))}function Ve$1(tt,et){var rt={};return rt[tt.toLowerCase()]=et.toLowerCase(),rt["Webkit"+tt]="webkit"+et,rt["Moz"+tt]="moz"+et,rt}var We$1={animationend:Ve$1("Animation","AnimationEnd"),animationiteration:Ve$1("Animation","AnimationIteration"),animationstart:Ve$1("Animation","AnimationStart"),transitionend:Ve$1("Transition","TransitionEnd")},Xe={},Ye={};ia&&(Ye=document.createElement("div").style,"AnimationEvent"in window||(delete We$1.animationend.animation,delete We$1.animationiteration.animation,delete We$1.animationstart.animation),"TransitionEvent"in window||delete We$1.transitionend.transition);function Ze$1(tt){if(Xe[tt])return Xe[tt];if(!We$1[tt])return tt;var et=We$1[tt],rt;for(rt in et)if(et.hasOwnProperty(rt)&&rt in Ye)return Xe[tt]=et[rt];return tt}var $e$1=Ze$1("animationend"),af=Ze$1("animationiteration"),bf=Ze$1("animationstart"),cf=Ze$1("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(tt,et){df.set(tt,et),fa(et,[tt])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e$1,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(tt,et,rt){var nt=tt.type||"unknown-event";tt.currentTarget=rt,Ub(nt,et,void 0,tt),tt.currentTarget=null}function se$1(tt,et){et=(et&4)!==0;for(var rt=0;rt<tt.length;rt++){var nt=tt[rt],it=nt.event;nt=nt.listeners;e:{var st=void 0;if(et)for(var ot=nt.length-1;0<=ot;ot--){var lt=nt[ot],ut=lt.instance,ct=lt.currentTarget;if(lt=lt.listener,ut!==st&&it.isPropagationStopped())break e;nf(it,lt,ct),st=ut}else for(ot=0;ot<nt.length;ot++){if(lt=nt[ot],ut=lt.instance,ct=lt.currentTarget,lt=lt.listener,ut!==st&&it.isPropagationStopped())break e;nf(it,lt,ct),st=ut}}}if(Qb)throw tt=Rb,Qb=!1,Rb=null,tt}function D$2(tt,et){var rt=et[of];rt===void 0&&(rt=et[of]=new Set);var nt=tt+"__bubble";rt.has(nt)||(pf(et,tt,2,!1),rt.add(nt))}function qf(tt,et,rt){var nt=0;et&&(nt|=4),pf(rt,tt,nt,et)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(tt){if(!tt[rf]){tt[rf]=!0,da.forEach(function(rt){rt!=="selectionchange"&&(mf.has(rt)||qf(rt,!1,tt),qf(rt,!0,tt))});var et=tt.nodeType===9?tt:tt.ownerDocument;et===null||et[rf]||(et[rf]=!0,qf("selectionchange",!1,et))}}function pf(tt,et,rt,nt){switch(jd(et)){case 1:var it=ed;break;case 4:it=gd;break;default:it=fd}rt=it.bind(null,et,rt,tt),it=void 0,!Lb||et!=="touchstart"&&et!=="touchmove"&&et!=="wheel"||(it=!0),nt?it!==void 0?tt.addEventListener(et,rt,{capture:!0,passive:it}):tt.addEventListener(et,rt,!0):it!==void 0?tt.addEventListener(et,rt,{passive:it}):tt.addEventListener(et,rt,!1)}function hd(tt,et,rt,nt,it){var st=nt;if(!(et&1)&&!(et&2)&&nt!==null)e:for(;;){if(nt===null)return;var ot=nt.tag;if(ot===3||ot===4){var lt=nt.stateNode.containerInfo;if(lt===it||lt.nodeType===8&&lt.parentNode===it)break;if(ot===4)for(ot=nt.return;ot!==null;){var ut=ot.tag;if((ut===3||ut===4)&&(ut=ot.stateNode.containerInfo,ut===it||ut.nodeType===8&&ut.parentNode===it))return;ot=ot.return}for(;lt!==null;){if(ot=Wc(lt),ot===null)return;if(ut=ot.tag,ut===5||ut===6){nt=st=ot;continue e}lt=lt.parentNode}}nt=nt.return}Jb(function(){var ct=st,dt=xb(rt),pt=[];e:{var ft=df.get(tt);if(ft!==void 0){var gt=td,_r=tt;switch(tt){case"keypress":if(od(rt)===0)break e;case"keydown":case"keyup":gt=Rd;break;case"focusin":_r="focus",gt=Fd;break;case"focusout":_r="blur",gt=Fd;break;case"beforeblur":case"afterblur":gt=Fd;break;case"click":if(rt.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":gt=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":gt=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":gt=Vd;break;case $e$1:case af:case bf:gt=Hd;break;case cf:gt=Xd;break;case"scroll":gt=vd;break;case"wheel":gt=Zd;break;case"copy":case"cut":case"paste":gt=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":gt=Td}var Yr=(et&4)!==0,mt=!Yr&&tt==="scroll",Kr=Yr?ft!==null?ft+"Capture":null:ft;Yr=[];for(var Xr=ct,Zr;Xr!==null;){Zr=Xr;var Qr=Zr.stateNode;if(Zr.tag===5&&Qr!==null&&(Zr=Qr,Kr!==null&&(Qr=Kb(Xr,Kr),Qr!=null&&Yr.push(tf(Xr,Qr,Zr)))),mt)break;Xr=Xr.return}0<Yr.length&&(ft=new gt(ft,_r,null,rt,dt),pt.push({event:ft,listeners:Yr}))}}if(!(et&7)){e:{if(ft=tt==="mouseover"||tt==="pointerover",gt=tt==="mouseout"||tt==="pointerout",ft&&rt!==wb&&(_r=rt.relatedTarget||rt.fromElement)&&(Wc(_r)||_r[uf]))break e;if((gt||ft)&&(ft=dt.window===dt?dt:(ft=dt.ownerDocument)?ft.defaultView||ft.parentWindow:window,gt?(_r=rt.relatedTarget||rt.toElement,gt=ct,_r=_r?Wc(_r):null,_r!==null&&(mt=Vb(_r),_r!==mt||_r.tag!==5&&_r.tag!==6)&&(_r=null)):(gt=null,_r=ct),gt!==_r)){if(Yr=Bd,Qr="onMouseLeave",Kr="onMouseEnter",Xr="mouse",(tt==="pointerout"||tt==="pointerover")&&(Yr=Td,Qr="onPointerLeave",Kr="onPointerEnter",Xr="pointer"),mt=gt==null?ft:ue$1(gt),Zr=_r==null?ft:ue$1(_r),ft=new Yr(Qr,Xr+"leave",gt,rt,dt),ft.target=mt,ft.relatedTarget=Zr,Qr=null,Wc(dt)===ct&&(Yr=new Yr(Kr,Xr+"enter",_r,rt,dt),Yr.target=Zr,Yr.relatedTarget=mt,Qr=Yr),mt=Qr,gt&&_r)t:{for(Yr=gt,Kr=_r,Xr=0,Zr=Yr;Zr;Zr=vf(Zr))Xr++;for(Zr=0,Qr=Kr;Qr;Qr=vf(Qr))Zr++;for(;0<Xr-Zr;)Yr=vf(Yr),Xr--;for(;0<Zr-Xr;)Kr=vf(Kr),Zr--;for(;Xr--;){if(Yr===Kr||Kr!==null&&Yr===Kr.alternate)break t;Yr=vf(Yr),Kr=vf(Kr)}Yr=null}else Yr=null;gt!==null&&wf(pt,ft,gt,Yr,!1),_r!==null&&mt!==null&&wf(pt,mt,_r,Yr,!0)}}e:{if(ft=ct?ue$1(ct):window,gt=ft.nodeName&&ft.nodeName.toLowerCase(),gt==="select"||gt==="input"&&ft.type==="file")var _i=ve;else if(me$1(ft))if(we$1)_i=Fe$1;else{_i=De$1;var ns=Ce$1}else(gt=ft.nodeName)&&gt.toLowerCase()==="input"&&(ft.type==="checkbox"||ft.type==="radio")&&(_i=Ee$1);if(_i&&(_i=_i(tt,ct))){ne$1(pt,_i,rt,dt);break e}ns&&ns(tt,ft,ct),tt==="focusout"&&(ns=ft._wrapperState)&&ns.controlled&&ft.type==="number"&&cb(ft,"number",ft.value)}switch(ns=ct?ue$1(ct):window,tt){case"focusin":(me$1(ns)||ns.contentEditable==="true")&&(Qe=ns,Re$1=ct,Se$1=null);break;case"focusout":Se$1=Re$1=Qe=null;break;case"mousedown":Te$1=!0;break;case"contextmenu":case"mouseup":case"dragend":Te$1=!1,Ue$1(pt,rt,dt);break;case"selectionchange":if(Pe$1)break;case"keydown":case"keyup":Ue$1(pt,rt,dt)}var rs;if(ae)e:{switch(tt){case"compositionstart":var ss="onCompositionStart";break e;case"compositionend":ss="onCompositionEnd";break e;case"compositionupdate":ss="onCompositionUpdate";break e}ss=void 0}else ie?ge$1(tt,rt)&&(ss="onCompositionEnd"):tt==="keydown"&&rt.keyCode===229&&(ss="onCompositionStart");ss&&(de$1&&rt.locale!=="ko"&&(ie||ss!=="onCompositionStart"?ss==="onCompositionEnd"&&ie&&(rs=nd()):(kd=dt,ld="value"in kd?kd.value:kd.textContent,ie=!0)),ns=oe$1(ct,ss),0<ns.length&&(ss=new Ld(ss,tt,null,rt,dt),pt.push({event:ss,listeners:ns}),rs?ss.data=rs:(rs=he$1(rt),rs!==null&&(ss.data=rs)))),(rs=ce$1?je$1(tt,rt):ke$1(tt,rt))&&(ct=oe$1(ct,"onBeforeInput"),0<ct.length&&(dt=new Ld("onBeforeInput","beforeinput",null,rt,dt),pt.push({event:dt,listeners:ct}),dt.data=rs))}se$1(pt,et)})}function tf(tt,et,rt){return{instance:tt,listener:et,currentTarget:rt}}function oe$1(tt,et){for(var rt=et+"Capture",nt=[];tt!==null;){var it=tt,st=it.stateNode;it.tag===5&&st!==null&&(it=st,st=Kb(tt,rt),st!=null&&nt.unshift(tf(tt,st,it)),st=Kb(tt,et),st!=null&&nt.push(tf(tt,st,it))),tt=tt.return}return nt}function vf(tt){if(tt===null)return null;do tt=tt.return;while(tt&&tt.tag!==5);return tt||null}function wf(tt,et,rt,nt,it){for(var st=et._reactName,ot=[];rt!==null&&rt!==nt;){var lt=rt,ut=lt.alternate,ct=lt.stateNode;if(ut!==null&&ut===nt)break;lt.tag===5&&ct!==null&&(lt=ct,it?(ut=Kb(rt,st),ut!=null&&ot.unshift(tf(rt,ut,lt))):it||(ut=Kb(rt,st),ut!=null&&ot.push(tf(rt,ut,lt)))),rt=rt.return}ot.length!==0&&tt.push({event:et,listeners:ot})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(tt){return(typeof tt=="string"?tt:""+tt).replace(xf,`
`).replace(yf,"")}function Af(tt,et,rt){if(et=zf(et),zf(tt)!==et&&rt)throw Error(p$1(425))}function Bf(){}var Cf=null,Df=null;function Ef(tt,et){return tt==="textarea"||tt==="noscript"||typeof et.children=="string"||typeof et.children=="number"||typeof et.dangerouslySetInnerHTML=="object"&&et.dangerouslySetInnerHTML!==null&&et.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(tt){return Hf.resolve(null).then(tt).catch(If)}:Ff;function If(tt){setTimeout(function(){throw tt})}function Kf(tt,et){var rt=et,nt=0;do{var it=rt.nextSibling;if(tt.removeChild(rt),it&&it.nodeType===8)if(rt=it.data,rt==="/$"){if(nt===0){tt.removeChild(it),bd(et);return}nt--}else rt!=="$"&&rt!=="$?"&&rt!=="$!"||nt++;rt=it}while(rt);bd(et)}function Lf(tt){for(;tt!=null;tt=tt.nextSibling){var et=tt.nodeType;if(et===1||et===3)break;if(et===8){if(et=tt.data,et==="$"||et==="$!"||et==="$?")break;if(et==="/$")return null}}return tt}function Mf(tt){tt=tt.previousSibling;for(var et=0;tt;){if(tt.nodeType===8){var rt=tt.data;if(rt==="$"||rt==="$!"||rt==="$?"){if(et===0)return tt;et--}else rt==="/$"&&et++}tt=tt.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(tt){var et=tt[Of];if(et)return et;for(var rt=tt.parentNode;rt;){if(et=rt[uf]||rt[Of]){if(rt=et.alternate,et.child!==null||rt!==null&&rt.child!==null)for(tt=Mf(tt);tt!==null;){if(rt=tt[Of])return rt;tt=Mf(tt)}return et}tt=rt,rt=tt.parentNode}return null}function Cb(tt){return tt=tt[Of]||tt[uf],!tt||tt.tag!==5&&tt.tag!==6&&tt.tag!==13&&tt.tag!==3?null:tt}function ue$1(tt){if(tt.tag===5||tt.tag===6)return tt.stateNode;throw Error(p$1(33))}function Db(tt){return tt[Pf]||null}var Sf=[],Tf=-1;function Uf(tt){return{current:tt}}function E$1(tt){0>Tf||(tt.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G$1(tt,et){Tf++,Sf[Tf]=tt.current,tt.current=et}var Vf={},H$1=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf(tt,et){var rt=tt.type.contextTypes;if(!rt)return Vf;var nt=tt.stateNode;if(nt&&nt.__reactInternalMemoizedUnmaskedChildContext===et)return nt.__reactInternalMemoizedMaskedChildContext;var it={},st;for(st in rt)it[st]=et[st];return nt&&(tt=tt.stateNode,tt.__reactInternalMemoizedUnmaskedChildContext=et,tt.__reactInternalMemoizedMaskedChildContext=it),it}function Zf(tt){return tt=tt.childContextTypes,tt!=null}function $f(){E$1(Wf),E$1(H$1)}function ag(tt,et,rt){if(H$1.current!==Vf)throw Error(p$1(168));G$1(H$1,et),G$1(Wf,rt)}function bg(tt,et,rt){var nt=tt.stateNode;if(et=et.childContextTypes,typeof nt.getChildContext!="function")return rt;nt=nt.getChildContext();for(var it in nt)if(!(it in et))throw Error(p$1(108,Ra(tt)||"Unknown",it));return A$1({},rt,nt)}function cg(tt){return tt=(tt=tt.stateNode)&&tt.__reactInternalMemoizedMergedChildContext||Vf,Xf=H$1.current,G$1(H$1,tt),G$1(Wf,Wf.current),!0}function dg(tt,et,rt){var nt=tt.stateNode;if(!nt)throw Error(p$1(169));rt?(tt=bg(tt,et,Xf),nt.__reactInternalMemoizedMergedChildContext=tt,E$1(Wf),E$1(H$1),G$1(H$1,tt)):E$1(Wf),G$1(Wf,rt)}var eg=null,fg=!1,gg=!1;function hg(tt){eg===null?eg=[tt]:eg.push(tt)}function ig(tt){fg=!0,hg(tt)}function jg(){if(!gg&&eg!==null){gg=!0;var tt=0,et=C$1;try{var rt=eg;for(C$1=1;tt<rt.length;tt++){var nt=rt[tt];do nt=nt(!0);while(nt!==null)}eg=null,fg=!1}catch(it){throw eg!==null&&(eg=eg.slice(tt+1)),ac(fc,jg),it}finally{C$1=et,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg(tt,et){kg[lg++]=ng,kg[lg++]=mg,mg=tt,ng=et}function ug(tt,et,rt){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=tt;var nt=rg;tt=sg;var it=32-oc(nt)-1;nt&=~(1<<it),rt+=1;var st=32-oc(et)+it;if(30<st){var ot=it-it%5;st=(nt&(1<<ot)-1).toString(32),nt>>=ot,it-=ot,rg=1<<32-oc(et)+it|rt<<it|nt,sg=st+tt}else rg=1<<st|rt<<it|nt,sg=tt}function vg(tt){tt.return!==null&&(tg(tt,1),ug(tt,1,0))}function wg(tt){for(;tt===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;tt===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I$1=!1,zg=null;function Ag(tt,et){var rt=Bg(5,null,null,0);rt.elementType="DELETED",rt.stateNode=et,rt.return=tt,et=tt.deletions,et===null?(tt.deletions=[rt],tt.flags|=16):et.push(rt)}function Cg(tt,et){switch(tt.tag){case 5:var rt=tt.type;return et=et.nodeType!==1||rt.toLowerCase()!==et.nodeName.toLowerCase()?null:et,et!==null?(tt.stateNode=et,xg=tt,yg=Lf(et.firstChild),!0):!1;case 6:return et=tt.pendingProps===""||et.nodeType!==3?null:et,et!==null?(tt.stateNode=et,xg=tt,yg=null,!0):!1;case 13:return et=et.nodeType!==8?null:et,et!==null?(rt=qg!==null?{id:rg,overflow:sg}:null,tt.memoizedState={dehydrated:et,treeContext:rt,retryLane:1073741824},rt=Bg(18,null,null,0),rt.stateNode=et,rt.return=tt,tt.child=rt,xg=tt,yg=null,!0):!1;default:return!1}}function Dg(tt){return(tt.mode&1)!==0&&(tt.flags&128)===0}function Eg(tt){if(I$1){var et=yg;if(et){var rt=et;if(!Cg(tt,et)){if(Dg(tt))throw Error(p$1(418));et=Lf(rt.nextSibling);var nt=xg;et&&Cg(tt,et)?Ag(nt,rt):(tt.flags=tt.flags&-4097|2,I$1=!1,xg=tt)}}else{if(Dg(tt))throw Error(p$1(418));tt.flags=tt.flags&-4097|2,I$1=!1,xg=tt}}}function Fg(tt){for(tt=tt.return;tt!==null&&tt.tag!==5&&tt.tag!==3&&tt.tag!==13;)tt=tt.return;xg=tt}function Gg(tt){if(tt!==xg)return!1;if(!I$1)return Fg(tt),I$1=!0,!1;var et;if((et=tt.tag!==3)&&!(et=tt.tag!==5)&&(et=tt.type,et=et!=="head"&&et!=="body"&&!Ef(tt.type,tt.memoizedProps)),et&&(et=yg)){if(Dg(tt))throw Hg(),Error(p$1(418));for(;et;)Ag(tt,et),et=Lf(et.nextSibling)}if(Fg(tt),tt.tag===13){if(tt=tt.memoizedState,tt=tt!==null?tt.dehydrated:null,!tt)throw Error(p$1(317));e:{for(tt=tt.nextSibling,et=0;tt;){if(tt.nodeType===8){var rt=tt.data;if(rt==="/$"){if(et===0){yg=Lf(tt.nextSibling);break e}et--}else rt!=="$"&&rt!=="$!"&&rt!=="$?"||et++}tt=tt.nextSibling}yg=null}}else yg=xg?Lf(tt.stateNode.nextSibling):null;return!0}function Hg(){for(var tt=yg;tt;)tt=Lf(tt.nextSibling)}function Ig(){yg=xg=null,I$1=!1}function Jg(tt){zg===null?zg=[tt]:zg.push(tt)}var Kg=ua.ReactCurrentBatchConfig;function Lg(tt,et){if(tt&&tt.defaultProps){et=A$1({},et),tt=tt.defaultProps;for(var rt in tt)et[rt]===void 0&&(et[rt]=tt[rt]);return et}return et}var Mg=Uf(null),Ng=null,Og=null,Pg=null;function Qg(){Pg=Og=Ng=null}function Rg(tt){var et=Mg.current;E$1(Mg),tt._currentValue=et}function Sg(tt,et,rt){for(;tt!==null;){var nt=tt.alternate;if((tt.childLanes&et)!==et?(tt.childLanes|=et,nt!==null&&(nt.childLanes|=et)):nt!==null&&(nt.childLanes&et)!==et&&(nt.childLanes|=et),tt===rt)break;tt=tt.return}}function Tg(tt,et){Ng=tt,Pg=Og=null,tt=tt.dependencies,tt!==null&&tt.firstContext!==null&&(tt.lanes&et&&(Ug=!0),tt.firstContext=null)}function Vg(tt){var et=tt._currentValue;if(Pg!==tt)if(tt={context:tt,memoizedValue:et,next:null},Og===null){if(Ng===null)throw Error(p$1(308));Og=tt,Ng.dependencies={lanes:0,firstContext:tt}}else Og=Og.next=tt;return et}var Wg=null;function Xg(tt){Wg===null?Wg=[tt]:Wg.push(tt)}function Yg(tt,et,rt,nt){var it=et.interleaved;return it===null?(rt.next=rt,Xg(et)):(rt.next=it.next,it.next=rt),et.interleaved=rt,Zg(tt,nt)}function Zg(tt,et){tt.lanes|=et;var rt=tt.alternate;for(rt!==null&&(rt.lanes|=et),rt=tt,tt=tt.return;tt!==null;)tt.childLanes|=et,rt=tt.alternate,rt!==null&&(rt.childLanes|=et),rt=tt,tt=tt.return;return rt.tag===3?rt.stateNode:null}var $g=!1;function ah(tt){tt.updateQueue={baseState:tt.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function bh(tt,et){tt=tt.updateQueue,et.updateQueue===tt&&(et.updateQueue={baseState:tt.baseState,firstBaseUpdate:tt.firstBaseUpdate,lastBaseUpdate:tt.lastBaseUpdate,shared:tt.shared,effects:tt.effects})}function ch(tt,et){return{eventTime:tt,lane:et,tag:0,payload:null,callback:null,next:null}}function dh(tt,et,rt){var nt=tt.updateQueue;if(nt===null)return null;if(nt=nt.shared,K$2&2){var it=nt.pending;return it===null?et.next=et:(et.next=it.next,it.next=et),nt.pending=et,Zg(tt,rt)}return it=nt.interleaved,it===null?(et.next=et,Xg(nt)):(et.next=it.next,it.next=et),nt.interleaved=et,Zg(tt,rt)}function eh(tt,et,rt){if(et=et.updateQueue,et!==null&&(et=et.shared,(rt&4194240)!==0)){var nt=et.lanes;nt&=tt.pendingLanes,rt|=nt,et.lanes=rt,Cc(tt,rt)}}function fh(tt,et){var rt=tt.updateQueue,nt=tt.alternate;if(nt!==null&&(nt=nt.updateQueue,rt===nt)){var it=null,st=null;if(rt=rt.firstBaseUpdate,rt!==null){do{var ot={eventTime:rt.eventTime,lane:rt.lane,tag:rt.tag,payload:rt.payload,callback:rt.callback,next:null};st===null?it=st=ot:st=st.next=ot,rt=rt.next}while(rt!==null);st===null?it=st=et:st=st.next=et}else it=st=et;rt={baseState:nt.baseState,firstBaseUpdate:it,lastBaseUpdate:st,shared:nt.shared,effects:nt.effects},tt.updateQueue=rt;return}tt=rt.lastBaseUpdate,tt===null?rt.firstBaseUpdate=et:tt.next=et,rt.lastBaseUpdate=et}function gh(tt,et,rt,nt){var it=tt.updateQueue;$g=!1;var st=it.firstBaseUpdate,ot=it.lastBaseUpdate,lt=it.shared.pending;if(lt!==null){it.shared.pending=null;var ut=lt,ct=ut.next;ut.next=null,ot===null?st=ct:ot.next=ct,ot=ut;var dt=tt.alternate;dt!==null&&(dt=dt.updateQueue,lt=dt.lastBaseUpdate,lt!==ot&&(lt===null?dt.firstBaseUpdate=ct:lt.next=ct,dt.lastBaseUpdate=ut))}if(st!==null){var pt=it.baseState;ot=0,dt=ct=ut=null,lt=st;do{var ft=lt.lane,gt=lt.eventTime;if((nt&ft)===ft){dt!==null&&(dt=dt.next={eventTime:gt,lane:0,tag:lt.tag,payload:lt.payload,callback:lt.callback,next:null});e:{var _r=tt,Yr=lt;switch(ft=et,gt=rt,Yr.tag){case 1:if(_r=Yr.payload,typeof _r=="function"){pt=_r.call(gt,pt,ft);break e}pt=_r;break e;case 3:_r.flags=_r.flags&-65537|128;case 0:if(_r=Yr.payload,ft=typeof _r=="function"?_r.call(gt,pt,ft):_r,ft==null)break e;pt=A$1({},pt,ft);break e;case 2:$g=!0}}lt.callback!==null&&lt.lane!==0&&(tt.flags|=64,ft=it.effects,ft===null?it.effects=[lt]:ft.push(lt))}else gt={eventTime:gt,lane:ft,tag:lt.tag,payload:lt.payload,callback:lt.callback,next:null},dt===null?(ct=dt=gt,ut=pt):dt=dt.next=gt,ot|=ft;if(lt=lt.next,lt===null){if(lt=it.shared.pending,lt===null)break;ft=lt,lt=ft.next,ft.next=null,it.lastBaseUpdate=ft,it.shared.pending=null}}while(!0);if(dt===null&&(ut=pt),it.baseState=ut,it.firstBaseUpdate=ct,it.lastBaseUpdate=dt,et=it.shared.interleaved,et!==null){it=et;do ot|=it.lane,it=it.next;while(it!==et)}else st===null&&(it.shared.lanes=0);hh|=ot,tt.lanes=ot,tt.memoizedState=pt}}function ih(tt,et,rt){if(tt=et.effects,et.effects=null,tt!==null)for(et=0;et<tt.length;et++){var nt=tt[et],it=nt.callback;if(it!==null){if(nt.callback=null,nt=rt,typeof it!="function")throw Error(p$1(191,it));it.call(nt)}}}var jh=new aa.Component().refs;function kh(tt,et,rt,nt){et=tt.memoizedState,rt=rt(nt,et),rt=rt==null?et:A$1({},et,rt),tt.memoizedState=rt,tt.lanes===0&&(tt.updateQueue.baseState=rt)}var nh={isMounted:function(tt){return(tt=tt._reactInternals)?Vb(tt)===tt:!1},enqueueSetState:function(tt,et,rt){tt=tt._reactInternals;var nt=L$2(),it=lh(tt),st=ch(nt,it);st.payload=et,rt!=null&&(st.callback=rt),et=dh(tt,st,it),et!==null&&(mh(et,tt,it,nt),eh(et,tt,it))},enqueueReplaceState:function(tt,et,rt){tt=tt._reactInternals;var nt=L$2(),it=lh(tt),st=ch(nt,it);st.tag=1,st.payload=et,rt!=null&&(st.callback=rt),et=dh(tt,st,it),et!==null&&(mh(et,tt,it,nt),eh(et,tt,it))},enqueueForceUpdate:function(tt,et){tt=tt._reactInternals;var rt=L$2(),nt=lh(tt),it=ch(rt,nt);it.tag=2,et!=null&&(it.callback=et),et=dh(tt,it,nt),et!==null&&(mh(et,tt,nt,rt),eh(et,tt,nt))}};function oh(tt,et,rt,nt,it,st,ot){return tt=tt.stateNode,typeof tt.shouldComponentUpdate=="function"?tt.shouldComponentUpdate(nt,st,ot):et.prototype&&et.prototype.isPureReactComponent?!Ie$1(rt,nt)||!Ie$1(it,st):!0}function ph(tt,et,rt){var nt=!1,it=Vf,st=et.contextType;return typeof st=="object"&&st!==null?st=Vg(st):(it=Zf(et)?Xf:H$1.current,nt=et.contextTypes,st=(nt=nt!=null)?Yf(tt,it):Vf),et=new et(rt,st),tt.memoizedState=et.state!==null&&et.state!==void 0?et.state:null,et.updater=nh,tt.stateNode=et,et._reactInternals=tt,nt&&(tt=tt.stateNode,tt.__reactInternalMemoizedUnmaskedChildContext=it,tt.__reactInternalMemoizedMaskedChildContext=st),et}function qh(tt,et,rt,nt){tt=et.state,typeof et.componentWillReceiveProps=="function"&&et.componentWillReceiveProps(rt,nt),typeof et.UNSAFE_componentWillReceiveProps=="function"&&et.UNSAFE_componentWillReceiveProps(rt,nt),et.state!==tt&&nh.enqueueReplaceState(et,et.state,null)}function rh(tt,et,rt,nt){var it=tt.stateNode;it.props=rt,it.state=tt.memoizedState,it.refs=jh,ah(tt);var st=et.contextType;typeof st=="object"&&st!==null?it.context=Vg(st):(st=Zf(et)?Xf:H$1.current,it.context=Yf(tt,st)),it.state=tt.memoizedState,st=et.getDerivedStateFromProps,typeof st=="function"&&(kh(tt,et,st,rt),it.state=tt.memoizedState),typeof et.getDerivedStateFromProps=="function"||typeof it.getSnapshotBeforeUpdate=="function"||typeof it.UNSAFE_componentWillMount!="function"&&typeof it.componentWillMount!="function"||(et=it.state,typeof it.componentWillMount=="function"&&it.componentWillMount(),typeof it.UNSAFE_componentWillMount=="function"&&it.UNSAFE_componentWillMount(),et!==it.state&&nh.enqueueReplaceState(it,it.state,null),gh(tt,rt,it,nt),it.state=tt.memoizedState),typeof it.componentDidMount=="function"&&(tt.flags|=4194308)}function sh(tt,et,rt){if(tt=rt.ref,tt!==null&&typeof tt!="function"&&typeof tt!="object"){if(rt._owner){if(rt=rt._owner,rt){if(rt.tag!==1)throw Error(p$1(309));var nt=rt.stateNode}if(!nt)throw Error(p$1(147,tt));var it=nt,st=""+tt;return et!==null&&et.ref!==null&&typeof et.ref=="function"&&et.ref._stringRef===st?et.ref:(et=function(ot){var lt=it.refs;lt===jh&&(lt=it.refs={}),ot===null?delete lt[st]:lt[st]=ot},et._stringRef=st,et)}if(typeof tt!="string")throw Error(p$1(284));if(!rt._owner)throw Error(p$1(290,tt))}return tt}function th(tt,et){throw tt=Object.prototype.toString.call(et),Error(p$1(31,tt==="[object Object]"?"object with keys {"+Object.keys(et).join(", ")+"}":tt))}function uh(tt){var et=tt._init;return et(tt._payload)}function vh(tt){function et(Kr,Xr){if(tt){var Zr=Kr.deletions;Zr===null?(Kr.deletions=[Xr],Kr.flags|=16):Zr.push(Xr)}}function rt(Kr,Xr){if(!tt)return null;for(;Xr!==null;)et(Kr,Xr),Xr=Xr.sibling;return null}function nt(Kr,Xr){for(Kr=new Map;Xr!==null;)Xr.key!==null?Kr.set(Xr.key,Xr):Kr.set(Xr.index,Xr),Xr=Xr.sibling;return Kr}function it(Kr,Xr){return Kr=wh(Kr,Xr),Kr.index=0,Kr.sibling=null,Kr}function st(Kr,Xr,Zr){return Kr.index=Zr,tt?(Zr=Kr.alternate,Zr!==null?(Zr=Zr.index,Zr<Xr?(Kr.flags|=2,Xr):Zr):(Kr.flags|=2,Xr)):(Kr.flags|=1048576,Xr)}function ot(Kr){return tt&&Kr.alternate===null&&(Kr.flags|=2),Kr}function lt(Kr,Xr,Zr,Qr){return Xr===null||Xr.tag!==6?(Xr=xh(Zr,Kr.mode,Qr),Xr.return=Kr,Xr):(Xr=it(Xr,Zr),Xr.return=Kr,Xr)}function ut(Kr,Xr,Zr,Qr){var _i=Zr.type;return _i===ya?dt(Kr,Xr,Zr.props.children,Qr,Zr.key):Xr!==null&&(Xr.elementType===_i||typeof _i=="object"&&_i!==null&&_i.$$typeof===Ha&&uh(_i)===Xr.type)?(Qr=it(Xr,Zr.props),Qr.ref=sh(Kr,Xr,Zr),Qr.return=Kr,Qr):(Qr=yh(Zr.type,Zr.key,Zr.props,null,Kr.mode,Qr),Qr.ref=sh(Kr,Xr,Zr),Qr.return=Kr,Qr)}function ct(Kr,Xr,Zr,Qr){return Xr===null||Xr.tag!==4||Xr.stateNode.containerInfo!==Zr.containerInfo||Xr.stateNode.implementation!==Zr.implementation?(Xr=zh(Zr,Kr.mode,Qr),Xr.return=Kr,Xr):(Xr=it(Xr,Zr.children||[]),Xr.return=Kr,Xr)}function dt(Kr,Xr,Zr,Qr,_i){return Xr===null||Xr.tag!==7?(Xr=Ah(Zr,Kr.mode,Qr,_i),Xr.return=Kr,Xr):(Xr=it(Xr,Zr),Xr.return=Kr,Xr)}function pt(Kr,Xr,Zr){if(typeof Xr=="string"&&Xr!==""||typeof Xr=="number")return Xr=xh(""+Xr,Kr.mode,Zr),Xr.return=Kr,Xr;if(typeof Xr=="object"&&Xr!==null){switch(Xr.$$typeof){case va:return Zr=yh(Xr.type,Xr.key,Xr.props,null,Kr.mode,Zr),Zr.ref=sh(Kr,null,Xr),Zr.return=Kr,Zr;case wa:return Xr=zh(Xr,Kr.mode,Zr),Xr.return=Kr,Xr;case Ha:var Qr=Xr._init;return pt(Kr,Qr(Xr._payload),Zr)}if(eb(Xr)||Ka(Xr))return Xr=Ah(Xr,Kr.mode,Zr,null),Xr.return=Kr,Xr;th(Kr,Xr)}return null}function ft(Kr,Xr,Zr,Qr){var _i=Xr!==null?Xr.key:null;if(typeof Zr=="string"&&Zr!==""||typeof Zr=="number")return _i!==null?null:lt(Kr,Xr,""+Zr,Qr);if(typeof Zr=="object"&&Zr!==null){switch(Zr.$$typeof){case va:return Zr.key===_i?ut(Kr,Xr,Zr,Qr):null;case wa:return Zr.key===_i?ct(Kr,Xr,Zr,Qr):null;case Ha:return _i=Zr._init,ft(Kr,Xr,_i(Zr._payload),Qr)}if(eb(Zr)||Ka(Zr))return _i!==null?null:dt(Kr,Xr,Zr,Qr,null);th(Kr,Zr)}return null}function gt(Kr,Xr,Zr,Qr,_i){if(typeof Qr=="string"&&Qr!==""||typeof Qr=="number")return Kr=Kr.get(Zr)||null,lt(Xr,Kr,""+Qr,_i);if(typeof Qr=="object"&&Qr!==null){switch(Qr.$$typeof){case va:return Kr=Kr.get(Qr.key===null?Zr:Qr.key)||null,ut(Xr,Kr,Qr,_i);case wa:return Kr=Kr.get(Qr.key===null?Zr:Qr.key)||null,ct(Xr,Kr,Qr,_i);case Ha:var ns=Qr._init;return gt(Kr,Xr,Zr,ns(Qr._payload),_i)}if(eb(Qr)||Ka(Qr))return Kr=Kr.get(Zr)||null,dt(Xr,Kr,Qr,_i,null);th(Xr,Qr)}return null}function _r(Kr,Xr,Zr,Qr){for(var _i=null,ns=null,rs=Xr,ss=Xr=0,hs=null;rs!==null&&ss<Zr.length;ss++){rs.index>ss?(hs=rs,rs=null):hs=rs.sibling;var os=ft(Kr,rs,Zr[ss],Qr);if(os===null){rs===null&&(rs=hs);break}tt&&rs&&os.alternate===null&&et(Kr,rs),Xr=st(os,Xr,ss),ns===null?_i=os:ns.sibling=os,ns=os,rs=hs}if(ss===Zr.length)return rt(Kr,rs),I$1&&tg(Kr,ss),_i;if(rs===null){for(;ss<Zr.length;ss++)rs=pt(Kr,Zr[ss],Qr),rs!==null&&(Xr=st(rs,Xr,ss),ns===null?_i=rs:ns.sibling=rs,ns=rs);return I$1&&tg(Kr,ss),_i}for(rs=nt(Kr,rs);ss<Zr.length;ss++)hs=gt(rs,Kr,ss,Zr[ss],Qr),hs!==null&&(tt&&hs.alternate!==null&&rs.delete(hs.key===null?ss:hs.key),Xr=st(hs,Xr,ss),ns===null?_i=hs:ns.sibling=hs,ns=hs);return tt&&rs.forEach(function(is){return et(Kr,is)}),I$1&&tg(Kr,ss),_i}function Yr(Kr,Xr,Zr,Qr){var _i=Ka(Zr);if(typeof _i!="function")throw Error(p$1(150));if(Zr=_i.call(Zr),Zr==null)throw Error(p$1(151));for(var ns=_i=null,rs=Xr,ss=Xr=0,hs=null,os=Zr.next();rs!==null&&!os.done;ss++,os=Zr.next()){rs.index>ss?(hs=rs,rs=null):hs=rs.sibling;var is=ft(Kr,rs,os.value,Qr);if(is===null){rs===null&&(rs=hs);break}tt&&rs&&is.alternate===null&&et(Kr,rs),Xr=st(is,Xr,ss),ns===null?_i=is:ns.sibling=is,ns=is,rs=hs}if(os.done)return rt(Kr,rs),I$1&&tg(Kr,ss),_i;if(rs===null){for(;!os.done;ss++,os=Zr.next())os=pt(Kr,os.value,Qr),os!==null&&(Xr=st(os,Xr,ss),ns===null?_i=os:ns.sibling=os,ns=os);return I$1&&tg(Kr,ss),_i}for(rs=nt(Kr,rs);!os.done;ss++,os=Zr.next())os=gt(rs,Kr,ss,os.value,Qr),os!==null&&(tt&&os.alternate!==null&&rs.delete(os.key===null?ss:os.key),Xr=st(os,Xr,ss),ns===null?_i=os:ns.sibling=os,ns=os);return tt&&rs.forEach(function(cs){return et(Kr,cs)}),I$1&&tg(Kr,ss),_i}function mt(Kr,Xr,Zr,Qr){if(typeof Zr=="object"&&Zr!==null&&Zr.type===ya&&Zr.key===null&&(Zr=Zr.props.children),typeof Zr=="object"&&Zr!==null){switch(Zr.$$typeof){case va:e:{for(var _i=Zr.key,ns=Xr;ns!==null;){if(ns.key===_i){if(_i=Zr.type,_i===ya){if(ns.tag===7){rt(Kr,ns.sibling),Xr=it(ns,Zr.props.children),Xr.return=Kr,Kr=Xr;break e}}else if(ns.elementType===_i||typeof _i=="object"&&_i!==null&&_i.$$typeof===Ha&&uh(_i)===ns.type){rt(Kr,ns.sibling),Xr=it(ns,Zr.props),Xr.ref=sh(Kr,ns,Zr),Xr.return=Kr,Kr=Xr;break e}rt(Kr,ns);break}else et(Kr,ns);ns=ns.sibling}Zr.type===ya?(Xr=Ah(Zr.props.children,Kr.mode,Qr,Zr.key),Xr.return=Kr,Kr=Xr):(Qr=yh(Zr.type,Zr.key,Zr.props,null,Kr.mode,Qr),Qr.ref=sh(Kr,Xr,Zr),Qr.return=Kr,Kr=Qr)}return ot(Kr);case wa:e:{for(ns=Zr.key;Xr!==null;){if(Xr.key===ns)if(Xr.tag===4&&Xr.stateNode.containerInfo===Zr.containerInfo&&Xr.stateNode.implementation===Zr.implementation){rt(Kr,Xr.sibling),Xr=it(Xr,Zr.children||[]),Xr.return=Kr,Kr=Xr;break e}else{rt(Kr,Xr);break}else et(Kr,Xr);Xr=Xr.sibling}Xr=zh(Zr,Kr.mode,Qr),Xr.return=Kr,Kr=Xr}return ot(Kr);case Ha:return ns=Zr._init,mt(Kr,Xr,ns(Zr._payload),Qr)}if(eb(Zr))return _r(Kr,Xr,Zr,Qr);if(Ka(Zr))return Yr(Kr,Xr,Zr,Qr);th(Kr,Zr)}return typeof Zr=="string"&&Zr!==""||typeof Zr=="number"?(Zr=""+Zr,Xr!==null&&Xr.tag===6?(rt(Kr,Xr.sibling),Xr=it(Xr,Zr),Xr.return=Kr,Kr=Xr):(rt(Kr,Xr),Xr=xh(Zr,Kr.mode,Qr),Xr.return=Kr,Kr=Xr),ot(Kr)):rt(Kr,Xr)}return mt}var Bh=vh(!0),Ch=vh(!1),Dh={},Eh=Uf(Dh),Fh=Uf(Dh),Gh=Uf(Dh);function Hh(tt){if(tt===Dh)throw Error(p$1(174));return tt}function Ih(tt,et){switch(G$1(Gh,et),G$1(Fh,tt),G$1(Eh,Dh),tt=et.nodeType,tt){case 9:case 11:et=(et=et.documentElement)?et.namespaceURI:lb(null,"");break;default:tt=tt===8?et.parentNode:et,et=tt.namespaceURI||null,tt=tt.tagName,et=lb(et,tt)}E$1(Eh),G$1(Eh,et)}function Jh(){E$1(Eh),E$1(Fh),E$1(Gh)}function Kh(tt){Hh(Gh.current);var et=Hh(Eh.current),rt=lb(et,tt.type);et!==rt&&(G$1(Fh,tt),G$1(Eh,rt))}function Lh(tt){Fh.current===tt&&(E$1(Eh),E$1(Fh))}var M$1=Uf(0);function Mh(tt){for(var et=tt;et!==null;){if(et.tag===13){var rt=et.memoizedState;if(rt!==null&&(rt=rt.dehydrated,rt===null||rt.data==="$?"||rt.data==="$!"))return et}else if(et.tag===19&&et.memoizedProps.revealOrder!==void 0){if(et.flags&128)return et}else if(et.child!==null){et.child.return=et,et=et.child;continue}if(et===tt)break;for(;et.sibling===null;){if(et.return===null||et.return===tt)return null;et=et.return}et.sibling.return=et.return,et=et.sibling}return null}var Nh=[];function Oh(){for(var tt=0;tt<Nh.length;tt++)Nh[tt]._workInProgressVersionPrimary=null;Nh.length=0}var Ph=ua.ReactCurrentDispatcher,Qh=ua.ReactCurrentBatchConfig,Rh=0,N$2=null,O$2=null,P$1=null,Sh=!1,Th=!1,Uh=0,Vh=0;function Q$2(){throw Error(p$1(321))}function Wh(tt,et){if(et===null)return!1;for(var rt=0;rt<et.length&&rt<tt.length;rt++)if(!He$1(tt[rt],et[rt]))return!1;return!0}function Xh(tt,et,rt,nt,it,st){if(Rh=st,N$2=et,et.memoizedState=null,et.updateQueue=null,et.lanes=0,Ph.current=tt===null||tt.memoizedState===null?Yh:Zh,tt=rt(nt,it),Th){st=0;do{if(Th=!1,Uh=0,25<=st)throw Error(p$1(301));st+=1,P$1=O$2=null,et.updateQueue=null,Ph.current=$h,tt=rt(nt,it)}while(Th)}if(Ph.current=ai,et=O$2!==null&&O$2.next!==null,Rh=0,P$1=O$2=N$2=null,Sh=!1,et)throw Error(p$1(300));return tt}function bi(){var tt=Uh!==0;return Uh=0,tt}function ci(){var tt={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return P$1===null?N$2.memoizedState=P$1=tt:P$1=P$1.next=tt,P$1}function di(){if(O$2===null){var tt=N$2.alternate;tt=tt!==null?tt.memoizedState:null}else tt=O$2.next;var et=P$1===null?N$2.memoizedState:P$1.next;if(et!==null)P$1=et,O$2=tt;else{if(tt===null)throw Error(p$1(310));O$2=tt,tt={memoizedState:O$2.memoizedState,baseState:O$2.baseState,baseQueue:O$2.baseQueue,queue:O$2.queue,next:null},P$1===null?N$2.memoizedState=P$1=tt:P$1=P$1.next=tt}return P$1}function ei(tt,et){return typeof et=="function"?et(tt):et}function fi(tt){var et=di(),rt=et.queue;if(rt===null)throw Error(p$1(311));rt.lastRenderedReducer=tt;var nt=O$2,it=nt.baseQueue,st=rt.pending;if(st!==null){if(it!==null){var ot=it.next;it.next=st.next,st.next=ot}nt.baseQueue=it=st,rt.pending=null}if(it!==null){st=it.next,nt=nt.baseState;var lt=ot=null,ut=null,ct=st;do{var dt=ct.lane;if((Rh&dt)===dt)ut!==null&&(ut=ut.next={lane:0,action:ct.action,hasEagerState:ct.hasEagerState,eagerState:ct.eagerState,next:null}),nt=ct.hasEagerState?ct.eagerState:tt(nt,ct.action);else{var pt={lane:dt,action:ct.action,hasEagerState:ct.hasEagerState,eagerState:ct.eagerState,next:null};ut===null?(lt=ut=pt,ot=nt):ut=ut.next=pt,N$2.lanes|=dt,hh|=dt}ct=ct.next}while(ct!==null&&ct!==st);ut===null?ot=nt:ut.next=lt,He$1(nt,et.memoizedState)||(Ug=!0),et.memoizedState=nt,et.baseState=ot,et.baseQueue=ut,rt.lastRenderedState=nt}if(tt=rt.interleaved,tt!==null){it=tt;do st=it.lane,N$2.lanes|=st,hh|=st,it=it.next;while(it!==tt)}else it===null&&(rt.lanes=0);return[et.memoizedState,rt.dispatch]}function gi(tt){var et=di(),rt=et.queue;if(rt===null)throw Error(p$1(311));rt.lastRenderedReducer=tt;var nt=rt.dispatch,it=rt.pending,st=et.memoizedState;if(it!==null){rt.pending=null;var ot=it=it.next;do st=tt(st,ot.action),ot=ot.next;while(ot!==it);He$1(st,et.memoizedState)||(Ug=!0),et.memoizedState=st,et.baseQueue===null&&(et.baseState=st),rt.lastRenderedState=st}return[st,nt]}function hi(){}function ii(tt,et){var rt=N$2,nt=di(),it=et(),st=!He$1(nt.memoizedState,it);if(st&&(nt.memoizedState=it,Ug=!0),nt=nt.queue,ji(ki.bind(null,rt,nt,tt),[tt]),nt.getSnapshot!==et||st||P$1!==null&&P$1.memoizedState.tag&1){if(rt.flags|=2048,li(9,mi.bind(null,rt,nt,it,et),void 0,null),R$2===null)throw Error(p$1(349));Rh&30||ni(rt,et,it)}return it}function ni(tt,et,rt){tt.flags|=16384,tt={getSnapshot:et,value:rt},et=N$2.updateQueue,et===null?(et={lastEffect:null,stores:null},N$2.updateQueue=et,et.stores=[tt]):(rt=et.stores,rt===null?et.stores=[tt]:rt.push(tt))}function mi(tt,et,rt,nt){et.value=rt,et.getSnapshot=nt,oi(et)&&pi(tt)}function ki(tt,et,rt){return rt(function(){oi(et)&&pi(tt)})}function oi(tt){var et=tt.getSnapshot;tt=tt.value;try{var rt=et();return!He$1(tt,rt)}catch{return!0}}function pi(tt){var et=Zg(tt,1);et!==null&&mh(et,tt,1,-1)}function qi(tt){var et=ci();return typeof tt=="function"&&(tt=tt()),et.memoizedState=et.baseState=tt,tt={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ei,lastRenderedState:tt},et.queue=tt,tt=tt.dispatch=ri.bind(null,N$2,tt),[et.memoizedState,tt]}function li(tt,et,rt,nt){return tt={tag:tt,create:et,destroy:rt,deps:nt,next:null},et=N$2.updateQueue,et===null?(et={lastEffect:null,stores:null},N$2.updateQueue=et,et.lastEffect=tt.next=tt):(rt=et.lastEffect,rt===null?et.lastEffect=tt.next=tt:(nt=rt.next,rt.next=tt,tt.next=nt,et.lastEffect=tt)),tt}function si(){return di().memoizedState}function ti(tt,et,rt,nt){var it=ci();N$2.flags|=tt,it.memoizedState=li(1|et,rt,void 0,nt===void 0?null:nt)}function ui(tt,et,rt,nt){var it=di();nt=nt===void 0?null:nt;var st=void 0;if(O$2!==null){var ot=O$2.memoizedState;if(st=ot.destroy,nt!==null&&Wh(nt,ot.deps)){it.memoizedState=li(et,rt,st,nt);return}}N$2.flags|=tt,it.memoizedState=li(1|et,rt,st,nt)}function vi(tt,et){return ti(8390656,8,tt,et)}function ji(tt,et){return ui(2048,8,tt,et)}function wi(tt,et){return ui(4,2,tt,et)}function xi(tt,et){return ui(4,4,tt,et)}function yi(tt,et){if(typeof et=="function")return tt=tt(),et(tt),function(){et(null)};if(et!=null)return tt=tt(),et.current=tt,function(){et.current=null}}function zi(tt,et,rt){return rt=rt!=null?rt.concat([tt]):null,ui(4,4,yi.bind(null,et,tt),rt)}function Ai(){}function Bi(tt,et){var rt=di();et=et===void 0?null:et;var nt=rt.memoizedState;return nt!==null&&et!==null&&Wh(et,nt[1])?nt[0]:(rt.memoizedState=[tt,et],tt)}function Ci(tt,et){var rt=di();et=et===void 0?null:et;var nt=rt.memoizedState;return nt!==null&&et!==null&&Wh(et,nt[1])?nt[0]:(tt=tt(),rt.memoizedState=[tt,et],tt)}function Di(tt,et,rt){return Rh&21?(He$1(rt,et)||(rt=yc(),N$2.lanes|=rt,hh|=rt,tt.baseState=!0),et):(tt.baseState&&(tt.baseState=!1,Ug=!0),tt.memoizedState=rt)}function Ei(tt,et){var rt=C$1;C$1=rt!==0&&4>rt?rt:4,tt(!0);var nt=Qh.transition;Qh.transition={};try{tt(!1),et()}finally{C$1=rt,Qh.transition=nt}}function Fi(){return di().memoizedState}function Gi(tt,et,rt){var nt=lh(tt);if(rt={lane:nt,action:rt,hasEagerState:!1,eagerState:null,next:null},Hi(tt))Ii(et,rt);else if(rt=Yg(tt,et,rt,nt),rt!==null){var it=L$2();mh(rt,tt,nt,it),Ji(rt,et,nt)}}function ri(tt,et,rt){var nt=lh(tt),it={lane:nt,action:rt,hasEagerState:!1,eagerState:null,next:null};if(Hi(tt))Ii(et,it);else{var st=tt.alternate;if(tt.lanes===0&&(st===null||st.lanes===0)&&(st=et.lastRenderedReducer,st!==null))try{var ot=et.lastRenderedState,lt=st(ot,rt);if(it.hasEagerState=!0,it.eagerState=lt,He$1(lt,ot)){var ut=et.interleaved;ut===null?(it.next=it,Xg(et)):(it.next=ut.next,ut.next=it),et.interleaved=it;return}}catch{}finally{}rt=Yg(tt,et,it,nt),rt!==null&&(it=L$2(),mh(rt,tt,nt,it),Ji(rt,et,nt))}}function Hi(tt){var et=tt.alternate;return tt===N$2||et!==null&&et===N$2}function Ii(tt,et){Th=Sh=!0;var rt=tt.pending;rt===null?et.next=et:(et.next=rt.next,rt.next=et),tt.pending=et}function Ji(tt,et,rt){if(rt&4194240){var nt=et.lanes;nt&=tt.pendingLanes,rt|=nt,et.lanes=rt,Cc(tt,rt)}}var ai={readContext:Vg,useCallback:Q$2,useContext:Q$2,useEffect:Q$2,useImperativeHandle:Q$2,useInsertionEffect:Q$2,useLayoutEffect:Q$2,useMemo:Q$2,useReducer:Q$2,useRef:Q$2,useState:Q$2,useDebugValue:Q$2,useDeferredValue:Q$2,useTransition:Q$2,useMutableSource:Q$2,useSyncExternalStore:Q$2,useId:Q$2,unstable_isNewReconciler:!1},Yh={readContext:Vg,useCallback:function(tt,et){return ci().memoizedState=[tt,et===void 0?null:et],tt},useContext:Vg,useEffect:vi,useImperativeHandle:function(tt,et,rt){return rt=rt!=null?rt.concat([tt]):null,ti(4194308,4,yi.bind(null,et,tt),rt)},useLayoutEffect:function(tt,et){return ti(4194308,4,tt,et)},useInsertionEffect:function(tt,et){return ti(4,2,tt,et)},useMemo:function(tt,et){var rt=ci();return et=et===void 0?null:et,tt=tt(),rt.memoizedState=[tt,et],tt},useReducer:function(tt,et,rt){var nt=ci();return et=rt!==void 0?rt(et):et,nt.memoizedState=nt.baseState=et,tt={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:tt,lastRenderedState:et},nt.queue=tt,tt=tt.dispatch=Gi.bind(null,N$2,tt),[nt.memoizedState,tt]},useRef:function(tt){var et=ci();return tt={current:tt},et.memoizedState=tt},useState:qi,useDebugValue:Ai,useDeferredValue:function(tt){return ci().memoizedState=tt},useTransition:function(){var tt=qi(!1),et=tt[0];return tt=Ei.bind(null,tt[1]),ci().memoizedState=tt,[et,tt]},useMutableSource:function(){},useSyncExternalStore:function(tt,et,rt){var nt=N$2,it=ci();if(I$1){if(rt===void 0)throw Error(p$1(407));rt=rt()}else{if(rt=et(),R$2===null)throw Error(p$1(349));Rh&30||ni(nt,et,rt)}it.memoizedState=rt;var st={value:rt,getSnapshot:et};return it.queue=st,vi(ki.bind(null,nt,st,tt),[tt]),nt.flags|=2048,li(9,mi.bind(null,nt,st,rt,et),void 0,null),rt},useId:function(){var tt=ci(),et=R$2.identifierPrefix;if(I$1){var rt=sg,nt=rg;rt=(nt&~(1<<32-oc(nt)-1)).toString(32)+rt,et=":"+et+"R"+rt,rt=Uh++,0<rt&&(et+="H"+rt.toString(32)),et+=":"}else rt=Vh++,et=":"+et+"r"+rt.toString(32)+":";return tt.memoizedState=et},unstable_isNewReconciler:!1},Zh={readContext:Vg,useCallback:Bi,useContext:Vg,useEffect:ji,useImperativeHandle:zi,useInsertionEffect:wi,useLayoutEffect:xi,useMemo:Ci,useReducer:fi,useRef:si,useState:function(){return fi(ei)},useDebugValue:Ai,useDeferredValue:function(tt){var et=di();return Di(et,O$2.memoizedState,tt)},useTransition:function(){var tt=fi(ei)[0],et=di().memoizedState;return[tt,et]},useMutableSource:hi,useSyncExternalStore:ii,useId:Fi,unstable_isNewReconciler:!1},$h={readContext:Vg,useCallback:Bi,useContext:Vg,useEffect:ji,useImperativeHandle:zi,useInsertionEffect:wi,useLayoutEffect:xi,useMemo:Ci,useReducer:gi,useRef:si,useState:function(){return gi(ei)},useDebugValue:Ai,useDeferredValue:function(tt){var et=di();return O$2===null?et.memoizedState=tt:Di(et,O$2.memoizedState,tt)},useTransition:function(){var tt=gi(ei)[0],et=di().memoizedState;return[tt,et]},useMutableSource:hi,useSyncExternalStore:ii,useId:Fi,unstable_isNewReconciler:!1};function Ki(tt,et){try{var rt="",nt=et;do rt+=Pa(nt),nt=nt.return;while(nt);var it=rt}catch(st){it=`
Error generating stack: `+st.message+`
`+st.stack}return{value:tt,source:et,stack:it,digest:null}}function Li(tt,et,rt){return{value:tt,source:null,stack:rt??null,digest:et??null}}function Mi(tt,et){try{console.error(et.value)}catch(rt){setTimeout(function(){throw rt})}}var Ni=typeof WeakMap=="function"?WeakMap:Map;function Oi(tt,et,rt){rt=ch(-1,rt),rt.tag=3,rt.payload={element:null};var nt=et.value;return rt.callback=function(){Pi||(Pi=!0,Qi=nt),Mi(tt,et)},rt}function Ri(tt,et,rt){rt=ch(-1,rt),rt.tag=3;var nt=tt.type.getDerivedStateFromError;if(typeof nt=="function"){var it=et.value;rt.payload=function(){return nt(it)},rt.callback=function(){Mi(tt,et)}}var st=tt.stateNode;return st!==null&&typeof st.componentDidCatch=="function"&&(rt.callback=function(){Mi(tt,et),typeof nt!="function"&&(Si===null?Si=new Set([this]):Si.add(this));var ot=et.stack;this.componentDidCatch(et.value,{componentStack:ot!==null?ot:""})}),rt}function Ti(tt,et,rt){var nt=tt.pingCache;if(nt===null){nt=tt.pingCache=new Ni;var it=new Set;nt.set(et,it)}else it=nt.get(et),it===void 0&&(it=new Set,nt.set(et,it));it.has(rt)||(it.add(rt),tt=Ui.bind(null,tt,et,rt),et.then(tt,tt))}function Vi(tt){do{var et;if((et=tt.tag===13)&&(et=tt.memoizedState,et=et!==null?et.dehydrated!==null:!0),et)return tt;tt=tt.return}while(tt!==null);return null}function Wi(tt,et,rt,nt,it){return tt.mode&1?(tt.flags|=65536,tt.lanes=it,tt):(tt===et?tt.flags|=65536:(tt.flags|=128,rt.flags|=131072,rt.flags&=-52805,rt.tag===1&&(rt.alternate===null?rt.tag=17:(et=ch(-1,1),et.tag=2,dh(rt,et,1))),rt.lanes|=1),tt)}var Xi=ua.ReactCurrentOwner,Ug=!1;function Yi(tt,et,rt,nt){et.child=tt===null?Ch(et,null,rt,nt):Bh(et,tt.child,rt,nt)}function Zi(tt,et,rt,nt,it){rt=rt.render;var st=et.ref;return Tg(et,it),nt=Xh(tt,et,rt,nt,st,it),rt=bi(),tt!==null&&!Ug?(et.updateQueue=tt.updateQueue,et.flags&=-2053,tt.lanes&=~it,$i(tt,et,it)):(I$1&&rt&&vg(et),et.flags|=1,Yi(tt,et,nt,it),et.child)}function aj(tt,et,rt,nt,it){if(tt===null){var st=rt.type;return typeof st=="function"&&!bj(st)&&st.defaultProps===void 0&&rt.compare===null&&rt.defaultProps===void 0?(et.tag=15,et.type=st,cj(tt,et,st,nt,it)):(tt=yh(rt.type,null,nt,et,et.mode,it),tt.ref=et.ref,tt.return=et,et.child=tt)}if(st=tt.child,!(tt.lanes&it)){var ot=st.memoizedProps;if(rt=rt.compare,rt=rt!==null?rt:Ie$1,rt(ot,nt)&&tt.ref===et.ref)return $i(tt,et,it)}return et.flags|=1,tt=wh(st,nt),tt.ref=et.ref,tt.return=et,et.child=tt}function cj(tt,et,rt,nt,it){if(tt!==null){var st=tt.memoizedProps;if(Ie$1(st,nt)&&tt.ref===et.ref)if(Ug=!1,et.pendingProps=nt=st,(tt.lanes&it)!==0)tt.flags&131072&&(Ug=!0);else return et.lanes=tt.lanes,$i(tt,et,it)}return dj(tt,et,rt,nt,it)}function ej(tt,et,rt){var nt=et.pendingProps,it=nt.children,st=tt!==null?tt.memoizedState:null;if(nt.mode==="hidden")if(!(et.mode&1))et.memoizedState={baseLanes:0,cachePool:null,transitions:null},G$1(fj,gj),gj|=rt;else{if(!(rt&1073741824))return tt=st!==null?st.baseLanes|rt:rt,et.lanes=et.childLanes=1073741824,et.memoizedState={baseLanes:tt,cachePool:null,transitions:null},et.updateQueue=null,G$1(fj,gj),gj|=tt,null;et.memoizedState={baseLanes:0,cachePool:null,transitions:null},nt=st!==null?st.baseLanes:rt,G$1(fj,gj),gj|=nt}else st!==null?(nt=st.baseLanes|rt,et.memoizedState=null):nt=rt,G$1(fj,gj),gj|=nt;return Yi(tt,et,it,rt),et.child}function hj(tt,et){var rt=et.ref;(tt===null&&rt!==null||tt!==null&&tt.ref!==rt)&&(et.flags|=512,et.flags|=2097152)}function dj(tt,et,rt,nt,it){var st=Zf(rt)?Xf:H$1.current;return st=Yf(et,st),Tg(et,it),rt=Xh(tt,et,rt,nt,st,it),nt=bi(),tt!==null&&!Ug?(et.updateQueue=tt.updateQueue,et.flags&=-2053,tt.lanes&=~it,$i(tt,et,it)):(I$1&&nt&&vg(et),et.flags|=1,Yi(tt,et,rt,it),et.child)}function ij(tt,et,rt,nt,it){if(Zf(rt)){var st=!0;cg(et)}else st=!1;if(Tg(et,it),et.stateNode===null)jj(tt,et),ph(et,rt,nt),rh(et,rt,nt,it),nt=!0;else if(tt===null){var ot=et.stateNode,lt=et.memoizedProps;ot.props=lt;var ut=ot.context,ct=rt.contextType;typeof ct=="object"&&ct!==null?ct=Vg(ct):(ct=Zf(rt)?Xf:H$1.current,ct=Yf(et,ct));var dt=rt.getDerivedStateFromProps,pt=typeof dt=="function"||typeof ot.getSnapshotBeforeUpdate=="function";pt||typeof ot.UNSAFE_componentWillReceiveProps!="function"&&typeof ot.componentWillReceiveProps!="function"||(lt!==nt||ut!==ct)&&qh(et,ot,nt,ct),$g=!1;var ft=et.memoizedState;ot.state=ft,gh(et,nt,ot,it),ut=et.memoizedState,lt!==nt||ft!==ut||Wf.current||$g?(typeof dt=="function"&&(kh(et,rt,dt,nt),ut=et.memoizedState),(lt=$g||oh(et,rt,lt,nt,ft,ut,ct))?(pt||typeof ot.UNSAFE_componentWillMount!="function"&&typeof ot.componentWillMount!="function"||(typeof ot.componentWillMount=="function"&&ot.componentWillMount(),typeof ot.UNSAFE_componentWillMount=="function"&&ot.UNSAFE_componentWillMount()),typeof ot.componentDidMount=="function"&&(et.flags|=4194308)):(typeof ot.componentDidMount=="function"&&(et.flags|=4194308),et.memoizedProps=nt,et.memoizedState=ut),ot.props=nt,ot.state=ut,ot.context=ct,nt=lt):(typeof ot.componentDidMount=="function"&&(et.flags|=4194308),nt=!1)}else{ot=et.stateNode,bh(tt,et),lt=et.memoizedProps,ct=et.type===et.elementType?lt:Lg(et.type,lt),ot.props=ct,pt=et.pendingProps,ft=ot.context,ut=rt.contextType,typeof ut=="object"&&ut!==null?ut=Vg(ut):(ut=Zf(rt)?Xf:H$1.current,ut=Yf(et,ut));var gt=rt.getDerivedStateFromProps;(dt=typeof gt=="function"||typeof ot.getSnapshotBeforeUpdate=="function")||typeof ot.UNSAFE_componentWillReceiveProps!="function"&&typeof ot.componentWillReceiveProps!="function"||(lt!==pt||ft!==ut)&&qh(et,ot,nt,ut),$g=!1,ft=et.memoizedState,ot.state=ft,gh(et,nt,ot,it);var _r=et.memoizedState;lt!==pt||ft!==_r||Wf.current||$g?(typeof gt=="function"&&(kh(et,rt,gt,nt),_r=et.memoizedState),(ct=$g||oh(et,rt,ct,nt,ft,_r,ut)||!1)?(dt||typeof ot.UNSAFE_componentWillUpdate!="function"&&typeof ot.componentWillUpdate!="function"||(typeof ot.componentWillUpdate=="function"&&ot.componentWillUpdate(nt,_r,ut),typeof ot.UNSAFE_componentWillUpdate=="function"&&ot.UNSAFE_componentWillUpdate(nt,_r,ut)),typeof ot.componentDidUpdate=="function"&&(et.flags|=4),typeof ot.getSnapshotBeforeUpdate=="function"&&(et.flags|=1024)):(typeof ot.componentDidUpdate!="function"||lt===tt.memoizedProps&&ft===tt.memoizedState||(et.flags|=4),typeof ot.getSnapshotBeforeUpdate!="function"||lt===tt.memoizedProps&&ft===tt.memoizedState||(et.flags|=1024),et.memoizedProps=nt,et.memoizedState=_r),ot.props=nt,ot.state=_r,ot.context=ut,nt=ct):(typeof ot.componentDidUpdate!="function"||lt===tt.memoizedProps&&ft===tt.memoizedState||(et.flags|=4),typeof ot.getSnapshotBeforeUpdate!="function"||lt===tt.memoizedProps&&ft===tt.memoizedState||(et.flags|=1024),nt=!1)}return kj(tt,et,rt,nt,st,it)}function kj(tt,et,rt,nt,it,st){hj(tt,et);var ot=(et.flags&128)!==0;if(!nt&&!ot)return it&&dg(et,rt,!1),$i(tt,et,st);nt=et.stateNode,Xi.current=et;var lt=ot&&typeof rt.getDerivedStateFromError!="function"?null:nt.render();return et.flags|=1,tt!==null&&ot?(et.child=Bh(et,tt.child,null,st),et.child=Bh(et,null,lt,st)):Yi(tt,et,lt,st),et.memoizedState=nt.state,it&&dg(et,rt,!0),et.child}function lj(tt){var et=tt.stateNode;et.pendingContext?ag(tt,et.pendingContext,et.pendingContext!==et.context):et.context&&ag(tt,et.context,!1),Ih(tt,et.containerInfo)}function mj(tt,et,rt,nt,it){return Ig(),Jg(it),et.flags|=256,Yi(tt,et,rt,nt),et.child}var nj={dehydrated:null,treeContext:null,retryLane:0};function oj(tt){return{baseLanes:tt,cachePool:null,transitions:null}}function pj(tt,et,rt){var nt=et.pendingProps,it=M$1.current,st=!1,ot=(et.flags&128)!==0,lt;if((lt=ot)||(lt=tt!==null&&tt.memoizedState===null?!1:(it&2)!==0),lt?(st=!0,et.flags&=-129):(tt===null||tt.memoizedState!==null)&&(it|=1),G$1(M$1,it&1),tt===null)return Eg(et),tt=et.memoizedState,tt!==null&&(tt=tt.dehydrated,tt!==null)?(et.mode&1?tt.data==="$!"?et.lanes=8:et.lanes=1073741824:et.lanes=1,null):(ot=nt.children,tt=nt.fallback,st?(nt=et.mode,st=et.child,ot={mode:"hidden",children:ot},!(nt&1)&&st!==null?(st.childLanes=0,st.pendingProps=ot):st=qj(ot,nt,0,null),tt=Ah(tt,nt,rt,null),st.return=et,tt.return=et,st.sibling=tt,et.child=st,et.child.memoizedState=oj(rt),et.memoizedState=nj,tt):rj(et,ot));if(it=tt.memoizedState,it!==null&&(lt=it.dehydrated,lt!==null))return sj(tt,et,ot,nt,lt,it,rt);if(st){st=nt.fallback,ot=et.mode,it=tt.child,lt=it.sibling;var ut={mode:"hidden",children:nt.children};return!(ot&1)&&et.child!==it?(nt=et.child,nt.childLanes=0,nt.pendingProps=ut,et.deletions=null):(nt=wh(it,ut),nt.subtreeFlags=it.subtreeFlags&14680064),lt!==null?st=wh(lt,st):(st=Ah(st,ot,rt,null),st.flags|=2),st.return=et,nt.return=et,nt.sibling=st,et.child=nt,nt=st,st=et.child,ot=tt.child.memoizedState,ot=ot===null?oj(rt):{baseLanes:ot.baseLanes|rt,cachePool:null,transitions:ot.transitions},st.memoizedState=ot,st.childLanes=tt.childLanes&~rt,et.memoizedState=nj,nt}return st=tt.child,tt=st.sibling,nt=wh(st,{mode:"visible",children:nt.children}),!(et.mode&1)&&(nt.lanes=rt),nt.return=et,nt.sibling=null,tt!==null&&(rt=et.deletions,rt===null?(et.deletions=[tt],et.flags|=16):rt.push(tt)),et.child=nt,et.memoizedState=null,nt}function rj(tt,et){return et=qj({mode:"visible",children:et},tt.mode,0,null),et.return=tt,tt.child=et}function tj(tt,et,rt,nt){return nt!==null&&Jg(nt),Bh(et,tt.child,null,rt),tt=rj(et,et.pendingProps.children),tt.flags|=2,et.memoizedState=null,tt}function sj(tt,et,rt,nt,it,st,ot){if(rt)return et.flags&256?(et.flags&=-257,nt=Li(Error(p$1(422))),tj(tt,et,ot,nt)):et.memoizedState!==null?(et.child=tt.child,et.flags|=128,null):(st=nt.fallback,it=et.mode,nt=qj({mode:"visible",children:nt.children},it,0,null),st=Ah(st,it,ot,null),st.flags|=2,nt.return=et,st.return=et,nt.sibling=st,et.child=nt,et.mode&1&&Bh(et,tt.child,null,ot),et.child.memoizedState=oj(ot),et.memoizedState=nj,st);if(!(et.mode&1))return tj(tt,et,ot,null);if(it.data==="$!"){if(nt=it.nextSibling&&it.nextSibling.dataset,nt)var lt=nt.dgst;return nt=lt,st=Error(p$1(419)),nt=Li(st,nt,void 0),tj(tt,et,ot,nt)}if(lt=(ot&tt.childLanes)!==0,Ug||lt){if(nt=R$2,nt!==null){switch(ot&-ot){case 4:it=2;break;case 16:it=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:it=32;break;case 536870912:it=268435456;break;default:it=0}it=it&(nt.suspendedLanes|ot)?0:it,it!==0&&it!==st.retryLane&&(st.retryLane=it,Zg(tt,it),mh(nt,tt,it,-1))}return uj(),nt=Li(Error(p$1(421))),tj(tt,et,ot,nt)}return it.data==="$?"?(et.flags|=128,et.child=tt.child,et=vj.bind(null,tt),it._reactRetry=et,null):(tt=st.treeContext,yg=Lf(it.nextSibling),xg=et,I$1=!0,zg=null,tt!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=tt.id,sg=tt.overflow,qg=et),et=rj(et,nt.children),et.flags|=4096,et)}function wj(tt,et,rt){tt.lanes|=et;var nt=tt.alternate;nt!==null&&(nt.lanes|=et),Sg(tt.return,et,rt)}function xj(tt,et,rt,nt,it){var st=tt.memoizedState;st===null?tt.memoizedState={isBackwards:et,rendering:null,renderingStartTime:0,last:nt,tail:rt,tailMode:it}:(st.isBackwards=et,st.rendering=null,st.renderingStartTime=0,st.last=nt,st.tail=rt,st.tailMode=it)}function yj(tt,et,rt){var nt=et.pendingProps,it=nt.revealOrder,st=nt.tail;if(Yi(tt,et,nt.children,rt),nt=M$1.current,nt&2)nt=nt&1|2,et.flags|=128;else{if(tt!==null&&tt.flags&128)e:for(tt=et.child;tt!==null;){if(tt.tag===13)tt.memoizedState!==null&&wj(tt,rt,et);else if(tt.tag===19)wj(tt,rt,et);else if(tt.child!==null){tt.child.return=tt,tt=tt.child;continue}if(tt===et)break e;for(;tt.sibling===null;){if(tt.return===null||tt.return===et)break e;tt=tt.return}tt.sibling.return=tt.return,tt=tt.sibling}nt&=1}if(G$1(M$1,nt),!(et.mode&1))et.memoizedState=null;else switch(it){case"forwards":for(rt=et.child,it=null;rt!==null;)tt=rt.alternate,tt!==null&&Mh(tt)===null&&(it=rt),rt=rt.sibling;rt=it,rt===null?(it=et.child,et.child=null):(it=rt.sibling,rt.sibling=null),xj(et,!1,it,rt,st);break;case"backwards":for(rt=null,it=et.child,et.child=null;it!==null;){if(tt=it.alternate,tt!==null&&Mh(tt)===null){et.child=it;break}tt=it.sibling,it.sibling=rt,rt=it,it=tt}xj(et,!0,rt,null,st);break;case"together":xj(et,!1,null,null,void 0);break;default:et.memoizedState=null}return et.child}function jj(tt,et){!(et.mode&1)&&tt!==null&&(tt.alternate=null,et.alternate=null,et.flags|=2)}function $i(tt,et,rt){if(tt!==null&&(et.dependencies=tt.dependencies),hh|=et.lanes,!(rt&et.childLanes))return null;if(tt!==null&&et.child!==tt.child)throw Error(p$1(153));if(et.child!==null){for(tt=et.child,rt=wh(tt,tt.pendingProps),et.child=rt,rt.return=et;tt.sibling!==null;)tt=tt.sibling,rt=rt.sibling=wh(tt,tt.pendingProps),rt.return=et;rt.sibling=null}return et.child}function zj(tt,et,rt){switch(et.tag){case 3:lj(et),Ig();break;case 5:Kh(et);break;case 1:Zf(et.type)&&cg(et);break;case 4:Ih(et,et.stateNode.containerInfo);break;case 10:var nt=et.type._context,it=et.memoizedProps.value;G$1(Mg,nt._currentValue),nt._currentValue=it;break;case 13:if(nt=et.memoizedState,nt!==null)return nt.dehydrated!==null?(G$1(M$1,M$1.current&1),et.flags|=128,null):rt&et.child.childLanes?pj(tt,et,rt):(G$1(M$1,M$1.current&1),tt=$i(tt,et,rt),tt!==null?tt.sibling:null);G$1(M$1,M$1.current&1);break;case 19:if(nt=(rt&et.childLanes)!==0,tt.flags&128){if(nt)return yj(tt,et,rt);et.flags|=128}if(it=et.memoizedState,it!==null&&(it.rendering=null,it.tail=null,it.lastEffect=null),G$1(M$1,M$1.current),nt)break;return null;case 22:case 23:return et.lanes=0,ej(tt,et,rt)}return $i(tt,et,rt)}var Aj,Bj,Cj,Dj;Aj=function(tt,et){for(var rt=et.child;rt!==null;){if(rt.tag===5||rt.tag===6)tt.appendChild(rt.stateNode);else if(rt.tag!==4&&rt.child!==null){rt.child.return=rt,rt=rt.child;continue}if(rt===et)break;for(;rt.sibling===null;){if(rt.return===null||rt.return===et)return;rt=rt.return}rt.sibling.return=rt.return,rt=rt.sibling}};Bj=function(){};Cj=function(tt,et,rt,nt){var it=tt.memoizedProps;if(it!==nt){tt=et.stateNode,Hh(Eh.current);var st=null;switch(rt){case"input":it=Ya(tt,it),nt=Ya(tt,nt),st=[];break;case"select":it=A$1({},it,{value:void 0}),nt=A$1({},nt,{value:void 0}),st=[];break;case"textarea":it=gb(tt,it),nt=gb(tt,nt),st=[];break;default:typeof it.onClick!="function"&&typeof nt.onClick=="function"&&(tt.onclick=Bf)}ub(rt,nt);var ot;rt=null;for(ct in it)if(!nt.hasOwnProperty(ct)&&it.hasOwnProperty(ct)&&it[ct]!=null)if(ct==="style"){var lt=it[ct];for(ot in lt)lt.hasOwnProperty(ot)&&(rt||(rt={}),rt[ot]="")}else ct!=="dangerouslySetInnerHTML"&&ct!=="children"&&ct!=="suppressContentEditableWarning"&&ct!=="suppressHydrationWarning"&&ct!=="autoFocus"&&(ea.hasOwnProperty(ct)?st||(st=[]):(st=st||[]).push(ct,null));for(ct in nt){var ut=nt[ct];if(lt=it!=null?it[ct]:void 0,nt.hasOwnProperty(ct)&&ut!==lt&&(ut!=null||lt!=null))if(ct==="style")if(lt){for(ot in lt)!lt.hasOwnProperty(ot)||ut&&ut.hasOwnProperty(ot)||(rt||(rt={}),rt[ot]="");for(ot in ut)ut.hasOwnProperty(ot)&&lt[ot]!==ut[ot]&&(rt||(rt={}),rt[ot]=ut[ot])}else rt||(st||(st=[]),st.push(ct,rt)),rt=ut;else ct==="dangerouslySetInnerHTML"?(ut=ut?ut.__html:void 0,lt=lt?lt.__html:void 0,ut!=null&&lt!==ut&&(st=st||[]).push(ct,ut)):ct==="children"?typeof ut!="string"&&typeof ut!="number"||(st=st||[]).push(ct,""+ut):ct!=="suppressContentEditableWarning"&&ct!=="suppressHydrationWarning"&&(ea.hasOwnProperty(ct)?(ut!=null&&ct==="onScroll"&&D$2("scroll",tt),st||lt===ut||(st=[])):(st=st||[]).push(ct,ut))}rt&&(st=st||[]).push("style",rt);var ct=st;(et.updateQueue=ct)&&(et.flags|=4)}};Dj=function(tt,et,rt,nt){rt!==nt&&(et.flags|=4)};function Ej(tt,et){if(!I$1)switch(tt.tailMode){case"hidden":et=tt.tail;for(var rt=null;et!==null;)et.alternate!==null&&(rt=et),et=et.sibling;rt===null?tt.tail=null:rt.sibling=null;break;case"collapsed":rt=tt.tail;for(var nt=null;rt!==null;)rt.alternate!==null&&(nt=rt),rt=rt.sibling;nt===null?et||tt.tail===null?tt.tail=null:tt.tail.sibling=null:nt.sibling=null}}function S$2(tt){var et=tt.alternate!==null&&tt.alternate.child===tt.child,rt=0,nt=0;if(et)for(var it=tt.child;it!==null;)rt|=it.lanes|it.childLanes,nt|=it.subtreeFlags&14680064,nt|=it.flags&14680064,it.return=tt,it=it.sibling;else for(it=tt.child;it!==null;)rt|=it.lanes|it.childLanes,nt|=it.subtreeFlags,nt|=it.flags,it.return=tt,it=it.sibling;return tt.subtreeFlags|=nt,tt.childLanes=rt,et}function Fj(tt,et,rt){var nt=et.pendingProps;switch(wg(et),et.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S$2(et),null;case 1:return Zf(et.type)&&$f(),S$2(et),null;case 3:return nt=et.stateNode,Jh(),E$1(Wf),E$1(H$1),Oh(),nt.pendingContext&&(nt.context=nt.pendingContext,nt.pendingContext=null),(tt===null||tt.child===null)&&(Gg(et)?et.flags|=4:tt===null||tt.memoizedState.isDehydrated&&!(et.flags&256)||(et.flags|=1024,zg!==null&&(Gj(zg),zg=null))),Bj(tt,et),S$2(et),null;case 5:Lh(et);var it=Hh(Gh.current);if(rt=et.type,tt!==null&&et.stateNode!=null)Cj(tt,et,rt,nt,it),tt.ref!==et.ref&&(et.flags|=512,et.flags|=2097152);else{if(!nt){if(et.stateNode===null)throw Error(p$1(166));return S$2(et),null}if(tt=Hh(Eh.current),Gg(et)){nt=et.stateNode,rt=et.type;var st=et.memoizedProps;switch(nt[Of]=et,nt[Pf]=st,tt=(et.mode&1)!==0,rt){case"dialog":D$2("cancel",nt),D$2("close",nt);break;case"iframe":case"object":case"embed":D$2("load",nt);break;case"video":case"audio":for(it=0;it<lf.length;it++)D$2(lf[it],nt);break;case"source":D$2("error",nt);break;case"img":case"image":case"link":D$2("error",nt),D$2("load",nt);break;case"details":D$2("toggle",nt);break;case"input":Za(nt,st),D$2("invalid",nt);break;case"select":nt._wrapperState={wasMultiple:!!st.multiple},D$2("invalid",nt);break;case"textarea":hb(nt,st),D$2("invalid",nt)}ub(rt,st),it=null;for(var ot in st)if(st.hasOwnProperty(ot)){var lt=st[ot];ot==="children"?typeof lt=="string"?nt.textContent!==lt&&(st.suppressHydrationWarning!==!0&&Af(nt.textContent,lt,tt),it=["children",lt]):typeof lt=="number"&&nt.textContent!==""+lt&&(st.suppressHydrationWarning!==!0&&Af(nt.textContent,lt,tt),it=["children",""+lt]):ea.hasOwnProperty(ot)&&lt!=null&&ot==="onScroll"&&D$2("scroll",nt)}switch(rt){case"input":Va(nt),db(nt,st,!0);break;case"textarea":Va(nt),jb(nt);break;case"select":case"option":break;default:typeof st.onClick=="function"&&(nt.onclick=Bf)}nt=it,et.updateQueue=nt,nt!==null&&(et.flags|=4)}else{ot=it.nodeType===9?it:it.ownerDocument,tt==="http://www.w3.org/1999/xhtml"&&(tt=kb(rt)),tt==="http://www.w3.org/1999/xhtml"?rt==="script"?(tt=ot.createElement("div"),tt.innerHTML="<script><\/script>",tt=tt.removeChild(tt.firstChild)):typeof nt.is=="string"?tt=ot.createElement(rt,{is:nt.is}):(tt=ot.createElement(rt),rt==="select"&&(ot=tt,nt.multiple?ot.multiple=!0:nt.size&&(ot.size=nt.size))):tt=ot.createElementNS(tt,rt),tt[Of]=et,tt[Pf]=nt,Aj(tt,et,!1,!1),et.stateNode=tt;e:{switch(ot=vb(rt,nt),rt){case"dialog":D$2("cancel",tt),D$2("close",tt),it=nt;break;case"iframe":case"object":case"embed":D$2("load",tt),it=nt;break;case"video":case"audio":for(it=0;it<lf.length;it++)D$2(lf[it],tt);it=nt;break;case"source":D$2("error",tt),it=nt;break;case"img":case"image":case"link":D$2("error",tt),D$2("load",tt),it=nt;break;case"details":D$2("toggle",tt),it=nt;break;case"input":Za(tt,nt),it=Ya(tt,nt),D$2("invalid",tt);break;case"option":it=nt;break;case"select":tt._wrapperState={wasMultiple:!!nt.multiple},it=A$1({},nt,{value:void 0}),D$2("invalid",tt);break;case"textarea":hb(tt,nt),it=gb(tt,nt),D$2("invalid",tt);break;default:it=nt}ub(rt,it),lt=it;for(st in lt)if(lt.hasOwnProperty(st)){var ut=lt[st];st==="style"?sb(tt,ut):st==="dangerouslySetInnerHTML"?(ut=ut?ut.__html:void 0,ut!=null&&nb(tt,ut)):st==="children"?typeof ut=="string"?(rt!=="textarea"||ut!=="")&&ob(tt,ut):typeof ut=="number"&&ob(tt,""+ut):st!=="suppressContentEditableWarning"&&st!=="suppressHydrationWarning"&&st!=="autoFocus"&&(ea.hasOwnProperty(st)?ut!=null&&st==="onScroll"&&D$2("scroll",tt):ut!=null&&ta(tt,st,ut,ot))}switch(rt){case"input":Va(tt),db(tt,nt,!1);break;case"textarea":Va(tt),jb(tt);break;case"option":nt.value!=null&&tt.setAttribute("value",""+Sa(nt.value));break;case"select":tt.multiple=!!nt.multiple,st=nt.value,st!=null?fb(tt,!!nt.multiple,st,!1):nt.defaultValue!=null&&fb(tt,!!nt.multiple,nt.defaultValue,!0);break;default:typeof it.onClick=="function"&&(tt.onclick=Bf)}switch(rt){case"button":case"input":case"select":case"textarea":nt=!!nt.autoFocus;break e;case"img":nt=!0;break e;default:nt=!1}}nt&&(et.flags|=4)}et.ref!==null&&(et.flags|=512,et.flags|=2097152)}return S$2(et),null;case 6:if(tt&&et.stateNode!=null)Dj(tt,et,tt.memoizedProps,nt);else{if(typeof nt!="string"&&et.stateNode===null)throw Error(p$1(166));if(rt=Hh(Gh.current),Hh(Eh.current),Gg(et)){if(nt=et.stateNode,rt=et.memoizedProps,nt[Of]=et,(st=nt.nodeValue!==rt)&&(tt=xg,tt!==null))switch(tt.tag){case 3:Af(nt.nodeValue,rt,(tt.mode&1)!==0);break;case 5:tt.memoizedProps.suppressHydrationWarning!==!0&&Af(nt.nodeValue,rt,(tt.mode&1)!==0)}st&&(et.flags|=4)}else nt=(rt.nodeType===9?rt:rt.ownerDocument).createTextNode(nt),nt[Of]=et,et.stateNode=nt}return S$2(et),null;case 13:if(E$1(M$1),nt=et.memoizedState,tt===null||tt.memoizedState!==null&&tt.memoizedState.dehydrated!==null){if(I$1&&yg!==null&&et.mode&1&&!(et.flags&128))Hg(),Ig(),et.flags|=98560,st=!1;else if(st=Gg(et),nt!==null&&nt.dehydrated!==null){if(tt===null){if(!st)throw Error(p$1(318));if(st=et.memoizedState,st=st!==null?st.dehydrated:null,!st)throw Error(p$1(317));st[Of]=et}else Ig(),!(et.flags&128)&&(et.memoizedState=null),et.flags|=4;S$2(et),st=!1}else zg!==null&&(Gj(zg),zg=null),st=!0;if(!st)return et.flags&65536?et:null}return et.flags&128?(et.lanes=rt,et):(nt=nt!==null,nt!==(tt!==null&&tt.memoizedState!==null)&&nt&&(et.child.flags|=8192,et.mode&1&&(tt===null||M$1.current&1?T$2===0&&(T$2=3):uj())),et.updateQueue!==null&&(et.flags|=4),S$2(et),null);case 4:return Jh(),Bj(tt,et),tt===null&&sf(et.stateNode.containerInfo),S$2(et),null;case 10:return Rg(et.type._context),S$2(et),null;case 17:return Zf(et.type)&&$f(),S$2(et),null;case 19:if(E$1(M$1),st=et.memoizedState,st===null)return S$2(et),null;if(nt=(et.flags&128)!==0,ot=st.rendering,ot===null)if(nt)Ej(st,!1);else{if(T$2!==0||tt!==null&&tt.flags&128)for(tt=et.child;tt!==null;){if(ot=Mh(tt),ot!==null){for(et.flags|=128,Ej(st,!1),nt=ot.updateQueue,nt!==null&&(et.updateQueue=nt,et.flags|=4),et.subtreeFlags=0,nt=rt,rt=et.child;rt!==null;)st=rt,tt=nt,st.flags&=14680066,ot=st.alternate,ot===null?(st.childLanes=0,st.lanes=tt,st.child=null,st.subtreeFlags=0,st.memoizedProps=null,st.memoizedState=null,st.updateQueue=null,st.dependencies=null,st.stateNode=null):(st.childLanes=ot.childLanes,st.lanes=ot.lanes,st.child=ot.child,st.subtreeFlags=0,st.deletions=null,st.memoizedProps=ot.memoizedProps,st.memoizedState=ot.memoizedState,st.updateQueue=ot.updateQueue,st.type=ot.type,tt=ot.dependencies,st.dependencies=tt===null?null:{lanes:tt.lanes,firstContext:tt.firstContext}),rt=rt.sibling;return G$1(M$1,M$1.current&1|2),et.child}tt=tt.sibling}st.tail!==null&&B$1()>Hj&&(et.flags|=128,nt=!0,Ej(st,!1),et.lanes=4194304)}else{if(!nt)if(tt=Mh(ot),tt!==null){if(et.flags|=128,nt=!0,rt=tt.updateQueue,rt!==null&&(et.updateQueue=rt,et.flags|=4),Ej(st,!0),st.tail===null&&st.tailMode==="hidden"&&!ot.alternate&&!I$1)return S$2(et),null}else 2*B$1()-st.renderingStartTime>Hj&&rt!==1073741824&&(et.flags|=128,nt=!0,Ej(st,!1),et.lanes=4194304);st.isBackwards?(ot.sibling=et.child,et.child=ot):(rt=st.last,rt!==null?rt.sibling=ot:et.child=ot,st.last=ot)}return st.tail!==null?(et=st.tail,st.rendering=et,st.tail=et.sibling,st.renderingStartTime=B$1(),et.sibling=null,rt=M$1.current,G$1(M$1,nt?rt&1|2:rt&1),et):(S$2(et),null);case 22:case 23:return Ij(),nt=et.memoizedState!==null,tt!==null&&tt.memoizedState!==null!==nt&&(et.flags|=8192),nt&&et.mode&1?gj&1073741824&&(S$2(et),et.subtreeFlags&6&&(et.flags|=8192)):S$2(et),null;case 24:return null;case 25:return null}throw Error(p$1(156,et.tag))}function Jj(tt,et){switch(wg(et),et.tag){case 1:return Zf(et.type)&&$f(),tt=et.flags,tt&65536?(et.flags=tt&-65537|128,et):null;case 3:return Jh(),E$1(Wf),E$1(H$1),Oh(),tt=et.flags,tt&65536&&!(tt&128)?(et.flags=tt&-65537|128,et):null;case 5:return Lh(et),null;case 13:if(E$1(M$1),tt=et.memoizedState,tt!==null&&tt.dehydrated!==null){if(et.alternate===null)throw Error(p$1(340));Ig()}return tt=et.flags,tt&65536?(et.flags=tt&-65537|128,et):null;case 19:return E$1(M$1),null;case 4:return Jh(),null;case 10:return Rg(et.type._context),null;case 22:case 23:return Ij(),null;case 24:return null;default:return null}}var Kj=!1,U$1=!1,Lj=typeof WeakSet=="function"?WeakSet:Set,V$1=null;function Mj(tt,et){var rt=tt.ref;if(rt!==null)if(typeof rt=="function")try{rt(null)}catch(nt){W$2(tt,et,nt)}else rt.current=null}function Nj(tt,et,rt){try{rt()}catch(nt){W$2(tt,et,nt)}}var Oj=!1;function Pj(tt,et){if(Cf=dd,tt=Me$1(),Ne$1(tt)){if("selectionStart"in tt)var rt={start:tt.selectionStart,end:tt.selectionEnd};else e:{rt=(rt=tt.ownerDocument)&&rt.defaultView||window;var nt=rt.getSelection&&rt.getSelection();if(nt&&nt.rangeCount!==0){rt=nt.anchorNode;var it=nt.anchorOffset,st=nt.focusNode;nt=nt.focusOffset;try{rt.nodeType,st.nodeType}catch{rt=null;break e}var ot=0,lt=-1,ut=-1,ct=0,dt=0,pt=tt,ft=null;t:for(;;){for(var gt;pt!==rt||it!==0&&pt.nodeType!==3||(lt=ot+it),pt!==st||nt!==0&&pt.nodeType!==3||(ut=ot+nt),pt.nodeType===3&&(ot+=pt.nodeValue.length),(gt=pt.firstChild)!==null;)ft=pt,pt=gt;for(;;){if(pt===tt)break t;if(ft===rt&&++ct===it&&(lt=ot),ft===st&&++dt===nt&&(ut=ot),(gt=pt.nextSibling)!==null)break;pt=ft,ft=pt.parentNode}pt=gt}rt=lt===-1||ut===-1?null:{start:lt,end:ut}}else rt=null}rt=rt||{start:0,end:0}}else rt=null;for(Df={focusedElem:tt,selectionRange:rt},dd=!1,V$1=et;V$1!==null;)if(et=V$1,tt=et.child,(et.subtreeFlags&1028)!==0&&tt!==null)tt.return=et,V$1=tt;else for(;V$1!==null;){et=V$1;try{var _r=et.alternate;if(et.flags&1024)switch(et.tag){case 0:case 11:case 15:break;case 1:if(_r!==null){var Yr=_r.memoizedProps,mt=_r.memoizedState,Kr=et.stateNode,Xr=Kr.getSnapshotBeforeUpdate(et.elementType===et.type?Yr:Lg(et.type,Yr),mt);Kr.__reactInternalSnapshotBeforeUpdate=Xr}break;case 3:var Zr=et.stateNode.containerInfo;Zr.nodeType===1?Zr.textContent="":Zr.nodeType===9&&Zr.documentElement&&Zr.removeChild(Zr.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p$1(163))}}catch(Qr){W$2(et,et.return,Qr)}if(tt=et.sibling,tt!==null){tt.return=et.return,V$1=tt;break}V$1=et.return}return _r=Oj,Oj=!1,_r}function Qj(tt,et,rt){var nt=et.updateQueue;if(nt=nt!==null?nt.lastEffect:null,nt!==null){var it=nt=nt.next;do{if((it.tag&tt)===tt){var st=it.destroy;it.destroy=void 0,st!==void 0&&Nj(et,rt,st)}it=it.next}while(it!==nt)}}function Rj(tt,et){if(et=et.updateQueue,et=et!==null?et.lastEffect:null,et!==null){var rt=et=et.next;do{if((rt.tag&tt)===tt){var nt=rt.create;rt.destroy=nt()}rt=rt.next}while(rt!==et)}}function Sj(tt){var et=tt.ref;if(et!==null){var rt=tt.stateNode;switch(tt.tag){case 5:tt=rt;break;default:tt=rt}typeof et=="function"?et(tt):et.current=tt}}function Tj(tt){var et=tt.alternate;et!==null&&(tt.alternate=null,Tj(et)),tt.child=null,tt.deletions=null,tt.sibling=null,tt.tag===5&&(et=tt.stateNode,et!==null&&(delete et[Of],delete et[Pf],delete et[of],delete et[Qf],delete et[Rf])),tt.stateNode=null,tt.return=null,tt.dependencies=null,tt.memoizedProps=null,tt.memoizedState=null,tt.pendingProps=null,tt.stateNode=null,tt.updateQueue=null}function Uj(tt){return tt.tag===5||tt.tag===3||tt.tag===4}function Vj(tt){e:for(;;){for(;tt.sibling===null;){if(tt.return===null||Uj(tt.return))return null;tt=tt.return}for(tt.sibling.return=tt.return,tt=tt.sibling;tt.tag!==5&&tt.tag!==6&&tt.tag!==18;){if(tt.flags&2||tt.child===null||tt.tag===4)continue e;tt.child.return=tt,tt=tt.child}if(!(tt.flags&2))return tt.stateNode}}function Wj(tt,et,rt){var nt=tt.tag;if(nt===5||nt===6)tt=tt.stateNode,et?rt.nodeType===8?rt.parentNode.insertBefore(tt,et):rt.insertBefore(tt,et):(rt.nodeType===8?(et=rt.parentNode,et.insertBefore(tt,rt)):(et=rt,et.appendChild(tt)),rt=rt._reactRootContainer,rt!=null||et.onclick!==null||(et.onclick=Bf));else if(nt!==4&&(tt=tt.child,tt!==null))for(Wj(tt,et,rt),tt=tt.sibling;tt!==null;)Wj(tt,et,rt),tt=tt.sibling}function Xj(tt,et,rt){var nt=tt.tag;if(nt===5||nt===6)tt=tt.stateNode,et?rt.insertBefore(tt,et):rt.appendChild(tt);else if(nt!==4&&(tt=tt.child,tt!==null))for(Xj(tt,et,rt),tt=tt.sibling;tt!==null;)Xj(tt,et,rt),tt=tt.sibling}var X$2=null,Yj=!1;function Zj(tt,et,rt){for(rt=rt.child;rt!==null;)ak(tt,et,rt),rt=rt.sibling}function ak(tt,et,rt){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,rt)}catch{}switch(rt.tag){case 5:U$1||Mj(rt,et);case 6:var nt=X$2,it=Yj;X$2=null,Zj(tt,et,rt),X$2=nt,Yj=it,X$2!==null&&(Yj?(tt=X$2,rt=rt.stateNode,tt.nodeType===8?tt.parentNode.removeChild(rt):tt.removeChild(rt)):X$2.removeChild(rt.stateNode));break;case 18:X$2!==null&&(Yj?(tt=X$2,rt=rt.stateNode,tt.nodeType===8?Kf(tt.parentNode,rt):tt.nodeType===1&&Kf(tt,rt),bd(tt)):Kf(X$2,rt.stateNode));break;case 4:nt=X$2,it=Yj,X$2=rt.stateNode.containerInfo,Yj=!0,Zj(tt,et,rt),X$2=nt,Yj=it;break;case 0:case 11:case 14:case 15:if(!U$1&&(nt=rt.updateQueue,nt!==null&&(nt=nt.lastEffect,nt!==null))){it=nt=nt.next;do{var st=it,ot=st.destroy;st=st.tag,ot!==void 0&&(st&2||st&4)&&Nj(rt,et,ot),it=it.next}while(it!==nt)}Zj(tt,et,rt);break;case 1:if(!U$1&&(Mj(rt,et),nt=rt.stateNode,typeof nt.componentWillUnmount=="function"))try{nt.props=rt.memoizedProps,nt.state=rt.memoizedState,nt.componentWillUnmount()}catch(lt){W$2(rt,et,lt)}Zj(tt,et,rt);break;case 21:Zj(tt,et,rt);break;case 22:rt.mode&1?(U$1=(nt=U$1)||rt.memoizedState!==null,Zj(tt,et,rt),U$1=nt):Zj(tt,et,rt);break;default:Zj(tt,et,rt)}}function bk(tt){var et=tt.updateQueue;if(et!==null){tt.updateQueue=null;var rt=tt.stateNode;rt===null&&(rt=tt.stateNode=new Lj),et.forEach(function(nt){var it=ck.bind(null,tt,nt);rt.has(nt)||(rt.add(nt),nt.then(it,it))})}}function dk(tt,et){var rt=et.deletions;if(rt!==null)for(var nt=0;nt<rt.length;nt++){var it=rt[nt];try{var st=tt,ot=et,lt=ot;e:for(;lt!==null;){switch(lt.tag){case 5:X$2=lt.stateNode,Yj=!1;break e;case 3:X$2=lt.stateNode.containerInfo,Yj=!0;break e;case 4:X$2=lt.stateNode.containerInfo,Yj=!0;break e}lt=lt.return}if(X$2===null)throw Error(p$1(160));ak(st,ot,it),X$2=null,Yj=!1;var ut=it.alternate;ut!==null&&(ut.return=null),it.return=null}catch(ct){W$2(it,et,ct)}}if(et.subtreeFlags&12854)for(et=et.child;et!==null;)ek(et,tt),et=et.sibling}function ek(tt,et){var rt=tt.alternate,nt=tt.flags;switch(tt.tag){case 0:case 11:case 14:case 15:if(dk(et,tt),fk(tt),nt&4){try{Qj(3,tt,tt.return),Rj(3,tt)}catch(Yr){W$2(tt,tt.return,Yr)}try{Qj(5,tt,tt.return)}catch(Yr){W$2(tt,tt.return,Yr)}}break;case 1:dk(et,tt),fk(tt),nt&512&&rt!==null&&Mj(rt,rt.return);break;case 5:if(dk(et,tt),fk(tt),nt&512&&rt!==null&&Mj(rt,rt.return),tt.flags&32){var it=tt.stateNode;try{ob(it,"")}catch(Yr){W$2(tt,tt.return,Yr)}}if(nt&4&&(it=tt.stateNode,it!=null)){var st=tt.memoizedProps,ot=rt!==null?rt.memoizedProps:st,lt=tt.type,ut=tt.updateQueue;if(tt.updateQueue=null,ut!==null)try{lt==="input"&&st.type==="radio"&&st.name!=null&&ab(it,st),vb(lt,ot);var ct=vb(lt,st);for(ot=0;ot<ut.length;ot+=2){var dt=ut[ot],pt=ut[ot+1];dt==="style"?sb(it,pt):dt==="dangerouslySetInnerHTML"?nb(it,pt):dt==="children"?ob(it,pt):ta(it,dt,pt,ct)}switch(lt){case"input":bb(it,st);break;case"textarea":ib(it,st);break;case"select":var ft=it._wrapperState.wasMultiple;it._wrapperState.wasMultiple=!!st.multiple;var gt=st.value;gt!=null?fb(it,!!st.multiple,gt,!1):ft!==!!st.multiple&&(st.defaultValue!=null?fb(it,!!st.multiple,st.defaultValue,!0):fb(it,!!st.multiple,st.multiple?[]:"",!1))}it[Pf]=st}catch(Yr){W$2(tt,tt.return,Yr)}}break;case 6:if(dk(et,tt),fk(tt),nt&4){if(tt.stateNode===null)throw Error(p$1(162));it=tt.stateNode,st=tt.memoizedProps;try{it.nodeValue=st}catch(Yr){W$2(tt,tt.return,Yr)}}break;case 3:if(dk(et,tt),fk(tt),nt&4&&rt!==null&&rt.memoizedState.isDehydrated)try{bd(et.containerInfo)}catch(Yr){W$2(tt,tt.return,Yr)}break;case 4:dk(et,tt),fk(tt);break;case 13:dk(et,tt),fk(tt),it=tt.child,it.flags&8192&&(st=it.memoizedState!==null,it.stateNode.isHidden=st,!st||it.alternate!==null&&it.alternate.memoizedState!==null||(gk=B$1())),nt&4&&bk(tt);break;case 22:if(dt=rt!==null&&rt.memoizedState!==null,tt.mode&1?(U$1=(ct=U$1)||dt,dk(et,tt),U$1=ct):dk(et,tt),fk(tt),nt&8192){if(ct=tt.memoizedState!==null,(tt.stateNode.isHidden=ct)&&!dt&&tt.mode&1)for(V$1=tt,dt=tt.child;dt!==null;){for(pt=V$1=dt;V$1!==null;){switch(ft=V$1,gt=ft.child,ft.tag){case 0:case 11:case 14:case 15:Qj(4,ft,ft.return);break;case 1:Mj(ft,ft.return);var _r=ft.stateNode;if(typeof _r.componentWillUnmount=="function"){nt=ft,rt=ft.return;try{et=nt,_r.props=et.memoizedProps,_r.state=et.memoizedState,_r.componentWillUnmount()}catch(Yr){W$2(nt,rt,Yr)}}break;case 5:Mj(ft,ft.return);break;case 22:if(ft.memoizedState!==null){hk(pt);continue}}gt!==null?(gt.return=ft,V$1=gt):hk(pt)}dt=dt.sibling}e:for(dt=null,pt=tt;;){if(pt.tag===5){if(dt===null){dt=pt;try{it=pt.stateNode,ct?(st=it.style,typeof st.setProperty=="function"?st.setProperty("display","none","important"):st.display="none"):(lt=pt.stateNode,ut=pt.memoizedProps.style,ot=ut!=null&&ut.hasOwnProperty("display")?ut.display:null,lt.style.display=rb("display",ot))}catch(Yr){W$2(tt,tt.return,Yr)}}}else if(pt.tag===6){if(dt===null)try{pt.stateNode.nodeValue=ct?"":pt.memoizedProps}catch(Yr){W$2(tt,tt.return,Yr)}}else if((pt.tag!==22&&pt.tag!==23||pt.memoizedState===null||pt===tt)&&pt.child!==null){pt.child.return=pt,pt=pt.child;continue}if(pt===tt)break e;for(;pt.sibling===null;){if(pt.return===null||pt.return===tt)break e;dt===pt&&(dt=null),pt=pt.return}dt===pt&&(dt=null),pt.sibling.return=pt.return,pt=pt.sibling}}break;case 19:dk(et,tt),fk(tt),nt&4&&bk(tt);break;case 21:break;default:dk(et,tt),fk(tt)}}function fk(tt){var et=tt.flags;if(et&2){try{e:{for(var rt=tt.return;rt!==null;){if(Uj(rt)){var nt=rt;break e}rt=rt.return}throw Error(p$1(160))}switch(nt.tag){case 5:var it=nt.stateNode;nt.flags&32&&(ob(it,""),nt.flags&=-33);var st=Vj(tt);Xj(tt,st,it);break;case 3:case 4:var ot=nt.stateNode.containerInfo,lt=Vj(tt);Wj(tt,lt,ot);break;default:throw Error(p$1(161))}}catch(ut){W$2(tt,tt.return,ut)}tt.flags&=-3}et&4096&&(tt.flags&=-4097)}function ik(tt,et,rt){V$1=tt,jk(tt)}function jk(tt,et,rt){for(var nt=(tt.mode&1)!==0;V$1!==null;){var it=V$1,st=it.child;if(it.tag===22&&nt){var ot=it.memoizedState!==null||Kj;if(!ot){var lt=it.alternate,ut=lt!==null&&lt.memoizedState!==null||U$1;lt=Kj;var ct=U$1;if(Kj=ot,(U$1=ut)&&!ct)for(V$1=it;V$1!==null;)ot=V$1,ut=ot.child,ot.tag===22&&ot.memoizedState!==null?kk(it):ut!==null?(ut.return=ot,V$1=ut):kk(it);for(;st!==null;)V$1=st,jk(st),st=st.sibling;V$1=it,Kj=lt,U$1=ct}lk(tt)}else it.subtreeFlags&8772&&st!==null?(st.return=it,V$1=st):lk(tt)}}function lk(tt){for(;V$1!==null;){var et=V$1;if(et.flags&8772){var rt=et.alternate;try{if(et.flags&8772)switch(et.tag){case 0:case 11:case 15:U$1||Rj(5,et);break;case 1:var nt=et.stateNode;if(et.flags&4&&!U$1)if(rt===null)nt.componentDidMount();else{var it=et.elementType===et.type?rt.memoizedProps:Lg(et.type,rt.memoizedProps);nt.componentDidUpdate(it,rt.memoizedState,nt.__reactInternalSnapshotBeforeUpdate)}var st=et.updateQueue;st!==null&&ih(et,st,nt);break;case 3:var ot=et.updateQueue;if(ot!==null){if(rt=null,et.child!==null)switch(et.child.tag){case 5:rt=et.child.stateNode;break;case 1:rt=et.child.stateNode}ih(et,ot,rt)}break;case 5:var lt=et.stateNode;if(rt===null&&et.flags&4){rt=lt;var ut=et.memoizedProps;switch(et.type){case"button":case"input":case"select":case"textarea":ut.autoFocus&&rt.focus();break;case"img":ut.src&&(rt.src=ut.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(et.memoizedState===null){var ct=et.alternate;if(ct!==null){var dt=ct.memoizedState;if(dt!==null){var pt=dt.dehydrated;pt!==null&&bd(pt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p$1(163))}U$1||et.flags&512&&Sj(et)}catch(ft){W$2(et,et.return,ft)}}if(et===tt){V$1=null;break}if(rt=et.sibling,rt!==null){rt.return=et.return,V$1=rt;break}V$1=et.return}}function hk(tt){for(;V$1!==null;){var et=V$1;if(et===tt){V$1=null;break}var rt=et.sibling;if(rt!==null){rt.return=et.return,V$1=rt;break}V$1=et.return}}function kk(tt){for(;V$1!==null;){var et=V$1;try{switch(et.tag){case 0:case 11:case 15:var rt=et.return;try{Rj(4,et)}catch(ut){W$2(et,rt,ut)}break;case 1:var nt=et.stateNode;if(typeof nt.componentDidMount=="function"){var it=et.return;try{nt.componentDidMount()}catch(ut){W$2(et,it,ut)}}var st=et.return;try{Sj(et)}catch(ut){W$2(et,st,ut)}break;case 5:var ot=et.return;try{Sj(et)}catch(ut){W$2(et,ot,ut)}}}catch(ut){W$2(et,et.return,ut)}if(et===tt){V$1=null;break}var lt=et.sibling;if(lt!==null){lt.return=et.return,V$1=lt;break}V$1=et.return}}var mk=Math.ceil,nk=ua.ReactCurrentDispatcher,ok=ua.ReactCurrentOwner,pk=ua.ReactCurrentBatchConfig,K$2=0,R$2=null,Y$2=null,Z=0,gj=0,fj=Uf(0),T$2=0,qk=null,hh=0,rk=0,sk=0,tk=null,uk=null,gk=0,Hj=1/0,vk=null,Pi=!1,Qi=null,Si=null,wk=!1,xk=null,yk=0,zk=0,Ak=null,Bk=-1,Ck=0;function L$2(){return K$2&6?B$1():Bk!==-1?Bk:Bk=B$1()}function lh(tt){return tt.mode&1?K$2&2&&Z!==0?Z&-Z:Kg.transition!==null?(Ck===0&&(Ck=yc()),Ck):(tt=C$1,tt!==0||(tt=window.event,tt=tt===void 0?16:jd(tt.type)),tt):1}function mh(tt,et,rt,nt){if(50<zk)throw zk=0,Ak=null,Error(p$1(185));Ac(tt,rt,nt),(!(K$2&2)||tt!==R$2)&&(tt===R$2&&(!(K$2&2)&&(rk|=rt),T$2===4&&Dk(tt,Z)),Ek(tt,nt),rt===1&&K$2===0&&!(et.mode&1)&&(Hj=B$1()+500,fg&&jg()))}function Ek(tt,et){var rt=tt.callbackNode;wc(tt,et);var nt=uc(tt,tt===R$2?Z:0);if(nt===0)rt!==null&&bc(rt),tt.callbackNode=null,tt.callbackPriority=0;else if(et=nt&-nt,tt.callbackPriority!==et){if(rt!=null&&bc(rt),et===1)tt.tag===0?ig(Fk.bind(null,tt)):hg(Fk.bind(null,tt)),Jf(function(){!(K$2&6)&&jg()}),rt=null;else{switch(Dc(nt)){case 1:rt=fc;break;case 4:rt=gc;break;case 16:rt=hc;break;case 536870912:rt=jc;break;default:rt=hc}rt=Gk(rt,Hk.bind(null,tt))}tt.callbackPriority=et,tt.callbackNode=rt}}function Hk(tt,et){if(Bk=-1,Ck=0,K$2&6)throw Error(p$1(327));var rt=tt.callbackNode;if(Ik()&&tt.callbackNode!==rt)return null;var nt=uc(tt,tt===R$2?Z:0);if(nt===0)return null;if(nt&30||nt&tt.expiredLanes||et)et=Jk(tt,nt);else{et=nt;var it=K$2;K$2|=2;var st=Kk();(R$2!==tt||Z!==et)&&(vk=null,Hj=B$1()+500,Lk(tt,et));do try{Mk();break}catch(lt){Nk(tt,lt)}while(!0);Qg(),nk.current=st,K$2=it,Y$2!==null?et=0:(R$2=null,Z=0,et=T$2)}if(et!==0){if(et===2&&(it=xc(tt),it!==0&&(nt=it,et=Ok(tt,it))),et===1)throw rt=qk,Lk(tt,0),Dk(tt,nt),Ek(tt,B$1()),rt;if(et===6)Dk(tt,nt);else{if(it=tt.current.alternate,!(nt&30)&&!Pk(it)&&(et=Jk(tt,nt),et===2&&(st=xc(tt),st!==0&&(nt=st,et=Ok(tt,st))),et===1))throw rt=qk,Lk(tt,0),Dk(tt,nt),Ek(tt,B$1()),rt;switch(tt.finishedWork=it,tt.finishedLanes=nt,et){case 0:case 1:throw Error(p$1(345));case 2:Qk(tt,uk,vk);break;case 3:if(Dk(tt,nt),(nt&130023424)===nt&&(et=gk+500-B$1(),10<et)){if(uc(tt,0)!==0)break;if(it=tt.suspendedLanes,(it&nt)!==nt){L$2(),tt.pingedLanes|=tt.suspendedLanes&it;break}tt.timeoutHandle=Ff(Qk.bind(null,tt,uk,vk),et);break}Qk(tt,uk,vk);break;case 4:if(Dk(tt,nt),(nt&4194240)===nt)break;for(et=tt.eventTimes,it=-1;0<nt;){var ot=31-oc(nt);st=1<<ot,ot=et[ot],ot>it&&(it=ot),nt&=~st}if(nt=it,nt=B$1()-nt,nt=(120>nt?120:480>nt?480:1080>nt?1080:1920>nt?1920:3e3>nt?3e3:4320>nt?4320:1960*mk(nt/1960))-nt,10<nt){tt.timeoutHandle=Ff(Qk.bind(null,tt,uk,vk),nt);break}Qk(tt,uk,vk);break;case 5:Qk(tt,uk,vk);break;default:throw Error(p$1(329))}}}return Ek(tt,B$1()),tt.callbackNode===rt?Hk.bind(null,tt):null}function Ok(tt,et){var rt=tk;return tt.current.memoizedState.isDehydrated&&(Lk(tt,et).flags|=256),tt=Jk(tt,et),tt!==2&&(et=uk,uk=rt,et!==null&&Gj(et)),tt}function Gj(tt){uk===null?uk=tt:uk.push.apply(uk,tt)}function Pk(tt){for(var et=tt;;){if(et.flags&16384){var rt=et.updateQueue;if(rt!==null&&(rt=rt.stores,rt!==null))for(var nt=0;nt<rt.length;nt++){var it=rt[nt],st=it.getSnapshot;it=it.value;try{if(!He$1(st(),it))return!1}catch{return!1}}}if(rt=et.child,et.subtreeFlags&16384&&rt!==null)rt.return=et,et=rt;else{if(et===tt)break;for(;et.sibling===null;){if(et.return===null||et.return===tt)return!0;et=et.return}et.sibling.return=et.return,et=et.sibling}}return!0}function Dk(tt,et){for(et&=~sk,et&=~rk,tt.suspendedLanes|=et,tt.pingedLanes&=~et,tt=tt.expirationTimes;0<et;){var rt=31-oc(et),nt=1<<rt;tt[rt]=-1,et&=~nt}}function Fk(tt){if(K$2&6)throw Error(p$1(327));Ik();var et=uc(tt,0);if(!(et&1))return Ek(tt,B$1()),null;var rt=Jk(tt,et);if(tt.tag!==0&&rt===2){var nt=xc(tt);nt!==0&&(et=nt,rt=Ok(tt,nt))}if(rt===1)throw rt=qk,Lk(tt,0),Dk(tt,et),Ek(tt,B$1()),rt;if(rt===6)throw Error(p$1(345));return tt.finishedWork=tt.current.alternate,tt.finishedLanes=et,Qk(tt,uk,vk),Ek(tt,B$1()),null}function Rk(tt,et){var rt=K$2;K$2|=1;try{return tt(et)}finally{K$2=rt,K$2===0&&(Hj=B$1()+500,fg&&jg())}}function Sk(tt){xk!==null&&xk.tag===0&&!(K$2&6)&&Ik();var et=K$2;K$2|=1;var rt=pk.transition,nt=C$1;try{if(pk.transition=null,C$1=1,tt)return tt()}finally{C$1=nt,pk.transition=rt,K$2=et,!(K$2&6)&&jg()}}function Ij(){gj=fj.current,E$1(fj)}function Lk(tt,et){tt.finishedWork=null,tt.finishedLanes=0;var rt=tt.timeoutHandle;if(rt!==-1&&(tt.timeoutHandle=-1,Gf(rt)),Y$2!==null)for(rt=Y$2.return;rt!==null;){var nt=rt;switch(wg(nt),nt.tag){case 1:nt=nt.type.childContextTypes,nt!=null&&$f();break;case 3:Jh(),E$1(Wf),E$1(H$1),Oh();break;case 5:Lh(nt);break;case 4:Jh();break;case 13:E$1(M$1);break;case 19:E$1(M$1);break;case 10:Rg(nt.type._context);break;case 22:case 23:Ij()}rt=rt.return}if(R$2=tt,Y$2=tt=wh(tt.current,null),Z=gj=et,T$2=0,qk=null,sk=rk=hh=0,uk=tk=null,Wg!==null){for(et=0;et<Wg.length;et++)if(rt=Wg[et],nt=rt.interleaved,nt!==null){rt.interleaved=null;var it=nt.next,st=rt.pending;if(st!==null){var ot=st.next;st.next=it,nt.next=ot}rt.pending=nt}Wg=null}return tt}function Nk(tt,et){do{var rt=Y$2;try{if(Qg(),Ph.current=ai,Sh){for(var nt=N$2.memoizedState;nt!==null;){var it=nt.queue;it!==null&&(it.pending=null),nt=nt.next}Sh=!1}if(Rh=0,P$1=O$2=N$2=null,Th=!1,Uh=0,ok.current=null,rt===null||rt.return===null){T$2=1,qk=et,Y$2=null;break}e:{var st=tt,ot=rt.return,lt=rt,ut=et;if(et=Z,lt.flags|=32768,ut!==null&&typeof ut=="object"&&typeof ut.then=="function"){var ct=ut,dt=lt,pt=dt.tag;if(!(dt.mode&1)&&(pt===0||pt===11||pt===15)){var ft=dt.alternate;ft?(dt.updateQueue=ft.updateQueue,dt.memoizedState=ft.memoizedState,dt.lanes=ft.lanes):(dt.updateQueue=null,dt.memoizedState=null)}var gt=Vi(ot);if(gt!==null){gt.flags&=-257,Wi(gt,ot,lt,st,et),gt.mode&1&&Ti(st,ct,et),et=gt,ut=ct;var _r=et.updateQueue;if(_r===null){var Yr=new Set;Yr.add(ut),et.updateQueue=Yr}else _r.add(ut);break e}else{if(!(et&1)){Ti(st,ct,et),uj();break e}ut=Error(p$1(426))}}else if(I$1&&lt.mode&1){var mt=Vi(ot);if(mt!==null){!(mt.flags&65536)&&(mt.flags|=256),Wi(mt,ot,lt,st,et),Jg(Ki(ut,lt));break e}}st=ut=Ki(ut,lt),T$2!==4&&(T$2=2),tk===null?tk=[st]:tk.push(st),st=ot;do{switch(st.tag){case 3:st.flags|=65536,et&=-et,st.lanes|=et;var Kr=Oi(st,ut,et);fh(st,Kr);break e;case 1:lt=ut;var Xr=st.type,Zr=st.stateNode;if(!(st.flags&128)&&(typeof Xr.getDerivedStateFromError=="function"||Zr!==null&&typeof Zr.componentDidCatch=="function"&&(Si===null||!Si.has(Zr)))){st.flags|=65536,et&=-et,st.lanes|=et;var Qr=Ri(st,lt,et);fh(st,Qr);break e}}st=st.return}while(st!==null)}Tk(rt)}catch(_i){et=_i,Y$2===rt&&rt!==null&&(Y$2=rt=rt.return);continue}break}while(!0)}function Kk(){var tt=nk.current;return nk.current=ai,tt===null?ai:tt}function uj(){(T$2===0||T$2===3||T$2===2)&&(T$2=4),R$2===null||!(hh&268435455)&&!(rk&268435455)||Dk(R$2,Z)}function Jk(tt,et){var rt=K$2;K$2|=2;var nt=Kk();(R$2!==tt||Z!==et)&&(vk=null,Lk(tt,et));do try{Uk();break}catch(it){Nk(tt,it)}while(!0);if(Qg(),K$2=rt,nk.current=nt,Y$2!==null)throw Error(p$1(261));return R$2=null,Z=0,T$2}function Uk(){for(;Y$2!==null;)Vk(Y$2)}function Mk(){for(;Y$2!==null&&!cc();)Vk(Y$2)}function Vk(tt){var et=Wk(tt.alternate,tt,gj);tt.memoizedProps=tt.pendingProps,et===null?Tk(tt):Y$2=et,ok.current=null}function Tk(tt){var et=tt;do{var rt=et.alternate;if(tt=et.return,et.flags&32768){if(rt=Jj(rt,et),rt!==null){rt.flags&=32767,Y$2=rt;return}if(tt!==null)tt.flags|=32768,tt.subtreeFlags=0,tt.deletions=null;else{T$2=6,Y$2=null;return}}else if(rt=Fj(rt,et,gj),rt!==null){Y$2=rt;return}if(et=et.sibling,et!==null){Y$2=et;return}Y$2=et=tt}while(et!==null);T$2===0&&(T$2=5)}function Qk(tt,et,rt){var nt=C$1,it=pk.transition;try{pk.transition=null,C$1=1,Xk(tt,et,rt,nt)}finally{pk.transition=it,C$1=nt}return null}function Xk(tt,et,rt,nt){do Ik();while(xk!==null);if(K$2&6)throw Error(p$1(327));rt=tt.finishedWork;var it=tt.finishedLanes;if(rt===null)return null;if(tt.finishedWork=null,tt.finishedLanes=0,rt===tt.current)throw Error(p$1(177));tt.callbackNode=null,tt.callbackPriority=0;var st=rt.lanes|rt.childLanes;if(Bc(tt,st),tt===R$2&&(Y$2=R$2=null,Z=0),!(rt.subtreeFlags&2064)&&!(rt.flags&2064)||wk||(wk=!0,Gk(hc,function(){return Ik(),null})),st=(rt.flags&15990)!==0,rt.subtreeFlags&15990||st){st=pk.transition,pk.transition=null;var ot=C$1;C$1=1;var lt=K$2;K$2|=4,ok.current=null,Pj(tt,rt),ek(rt,tt),Oe$1(Df),dd=!!Cf,Df=Cf=null,tt.current=rt,ik(rt),dc(),K$2=lt,C$1=ot,pk.transition=st}else tt.current=rt;if(wk&&(wk=!1,xk=tt,yk=it),st=tt.pendingLanes,st===0&&(Si=null),mc(rt.stateNode),Ek(tt,B$1()),et!==null)for(nt=tt.onRecoverableError,rt=0;rt<et.length;rt++)it=et[rt],nt(it.value,{componentStack:it.stack,digest:it.digest});if(Pi)throw Pi=!1,tt=Qi,Qi=null,tt;return yk&1&&tt.tag!==0&&Ik(),st=tt.pendingLanes,st&1?tt===Ak?zk++:(zk=0,Ak=tt):zk=0,jg(),null}function Ik(){if(xk!==null){var tt=Dc(yk),et=pk.transition,rt=C$1;try{if(pk.transition=null,C$1=16>tt?16:tt,xk===null)var nt=!1;else{if(tt=xk,xk=null,yk=0,K$2&6)throw Error(p$1(331));var it=K$2;for(K$2|=4,V$1=tt.current;V$1!==null;){var st=V$1,ot=st.child;if(V$1.flags&16){var lt=st.deletions;if(lt!==null){for(var ut=0;ut<lt.length;ut++){var ct=lt[ut];for(V$1=ct;V$1!==null;){var dt=V$1;switch(dt.tag){case 0:case 11:case 15:Qj(8,dt,st)}var pt=dt.child;if(pt!==null)pt.return=dt,V$1=pt;else for(;V$1!==null;){dt=V$1;var ft=dt.sibling,gt=dt.return;if(Tj(dt),dt===ct){V$1=null;break}if(ft!==null){ft.return=gt,V$1=ft;break}V$1=gt}}}var _r=st.alternate;if(_r!==null){var Yr=_r.child;if(Yr!==null){_r.child=null;do{var mt=Yr.sibling;Yr.sibling=null,Yr=mt}while(Yr!==null)}}V$1=st}}if(st.subtreeFlags&2064&&ot!==null)ot.return=st,V$1=ot;else e:for(;V$1!==null;){if(st=V$1,st.flags&2048)switch(st.tag){case 0:case 11:case 15:Qj(9,st,st.return)}var Kr=st.sibling;if(Kr!==null){Kr.return=st.return,V$1=Kr;break e}V$1=st.return}}var Xr=tt.current;for(V$1=Xr;V$1!==null;){ot=V$1;var Zr=ot.child;if(ot.subtreeFlags&2064&&Zr!==null)Zr.return=ot,V$1=Zr;else e:for(ot=Xr;V$1!==null;){if(lt=V$1,lt.flags&2048)try{switch(lt.tag){case 0:case 11:case 15:Rj(9,lt)}}catch(_i){W$2(lt,lt.return,_i)}if(lt===ot){V$1=null;break e}var Qr=lt.sibling;if(Qr!==null){Qr.return=lt.return,V$1=Qr;break e}V$1=lt.return}}if(K$2=it,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,tt)}catch{}nt=!0}return nt}finally{C$1=rt,pk.transition=et}}return!1}function Yk(tt,et,rt){et=Ki(rt,et),et=Oi(tt,et,1),tt=dh(tt,et,1),et=L$2(),tt!==null&&(Ac(tt,1,et),Ek(tt,et))}function W$2(tt,et,rt){if(tt.tag===3)Yk(tt,tt,rt);else for(;et!==null;){if(et.tag===3){Yk(et,tt,rt);break}else if(et.tag===1){var nt=et.stateNode;if(typeof et.type.getDerivedStateFromError=="function"||typeof nt.componentDidCatch=="function"&&(Si===null||!Si.has(nt))){tt=Ki(rt,tt),tt=Ri(et,tt,1),et=dh(et,tt,1),tt=L$2(),et!==null&&(Ac(et,1,tt),Ek(et,tt));break}}et=et.return}}function Ui(tt,et,rt){var nt=tt.pingCache;nt!==null&&nt.delete(et),et=L$2(),tt.pingedLanes|=tt.suspendedLanes&rt,R$2===tt&&(Z&rt)===rt&&(T$2===4||T$2===3&&(Z&130023424)===Z&&500>B$1()-gk?Lk(tt,0):sk|=rt),Ek(tt,et)}function Zk(tt,et){et===0&&(tt.mode&1?(et=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):et=1);var rt=L$2();tt=Zg(tt,et),tt!==null&&(Ac(tt,et,rt),Ek(tt,rt))}function vj(tt){var et=tt.memoizedState,rt=0;et!==null&&(rt=et.retryLane),Zk(tt,rt)}function ck(tt,et){var rt=0;switch(tt.tag){case 13:var nt=tt.stateNode,it=tt.memoizedState;it!==null&&(rt=it.retryLane);break;case 19:nt=tt.stateNode;break;default:throw Error(p$1(314))}nt!==null&&nt.delete(et),Zk(tt,rt)}var Wk;Wk=function(tt,et,rt){if(tt!==null)if(tt.memoizedProps!==et.pendingProps||Wf.current)Ug=!0;else{if(!(tt.lanes&rt)&&!(et.flags&128))return Ug=!1,zj(tt,et,rt);Ug=!!(tt.flags&131072)}else Ug=!1,I$1&&et.flags&1048576&&ug(et,ng,et.index);switch(et.lanes=0,et.tag){case 2:var nt=et.type;jj(tt,et),tt=et.pendingProps;var it=Yf(et,H$1.current);Tg(et,rt),it=Xh(null,et,nt,tt,it,rt);var st=bi();return et.flags|=1,typeof it=="object"&&it!==null&&typeof it.render=="function"&&it.$$typeof===void 0?(et.tag=1,et.memoizedState=null,et.updateQueue=null,Zf(nt)?(st=!0,cg(et)):st=!1,et.memoizedState=it.state!==null&&it.state!==void 0?it.state:null,ah(et),it.updater=nh,et.stateNode=it,it._reactInternals=et,rh(et,nt,tt,rt),et=kj(null,et,nt,!0,st,rt)):(et.tag=0,I$1&&st&&vg(et),Yi(null,et,it,rt),et=et.child),et;case 16:nt=et.elementType;e:{switch(jj(tt,et),tt=et.pendingProps,it=nt._init,nt=it(nt._payload),et.type=nt,it=et.tag=$k(nt),tt=Lg(nt,tt),it){case 0:et=dj(null,et,nt,tt,rt);break e;case 1:et=ij(null,et,nt,tt,rt);break e;case 11:et=Zi(null,et,nt,tt,rt);break e;case 14:et=aj(null,et,nt,Lg(nt.type,tt),rt);break e}throw Error(p$1(306,nt,""))}return et;case 0:return nt=et.type,it=et.pendingProps,it=et.elementType===nt?it:Lg(nt,it),dj(tt,et,nt,it,rt);case 1:return nt=et.type,it=et.pendingProps,it=et.elementType===nt?it:Lg(nt,it),ij(tt,et,nt,it,rt);case 3:e:{if(lj(et),tt===null)throw Error(p$1(387));nt=et.pendingProps,st=et.memoizedState,it=st.element,bh(tt,et),gh(et,nt,null,rt);var ot=et.memoizedState;if(nt=ot.element,st.isDehydrated)if(st={element:nt,isDehydrated:!1,cache:ot.cache,pendingSuspenseBoundaries:ot.pendingSuspenseBoundaries,transitions:ot.transitions},et.updateQueue.baseState=st,et.memoizedState=st,et.flags&256){it=Ki(Error(p$1(423)),et),et=mj(tt,et,nt,rt,it);break e}else if(nt!==it){it=Ki(Error(p$1(424)),et),et=mj(tt,et,nt,rt,it);break e}else for(yg=Lf(et.stateNode.containerInfo.firstChild),xg=et,I$1=!0,zg=null,rt=Ch(et,null,nt,rt),et.child=rt;rt;)rt.flags=rt.flags&-3|4096,rt=rt.sibling;else{if(Ig(),nt===it){et=$i(tt,et,rt);break e}Yi(tt,et,nt,rt)}et=et.child}return et;case 5:return Kh(et),tt===null&&Eg(et),nt=et.type,it=et.pendingProps,st=tt!==null?tt.memoizedProps:null,ot=it.children,Ef(nt,it)?ot=null:st!==null&&Ef(nt,st)&&(et.flags|=32),hj(tt,et),Yi(tt,et,ot,rt),et.child;case 6:return tt===null&&Eg(et),null;case 13:return pj(tt,et,rt);case 4:return Ih(et,et.stateNode.containerInfo),nt=et.pendingProps,tt===null?et.child=Bh(et,null,nt,rt):Yi(tt,et,nt,rt),et.child;case 11:return nt=et.type,it=et.pendingProps,it=et.elementType===nt?it:Lg(nt,it),Zi(tt,et,nt,it,rt);case 7:return Yi(tt,et,et.pendingProps,rt),et.child;case 8:return Yi(tt,et,et.pendingProps.children,rt),et.child;case 12:return Yi(tt,et,et.pendingProps.children,rt),et.child;case 10:e:{if(nt=et.type._context,it=et.pendingProps,st=et.memoizedProps,ot=it.value,G$1(Mg,nt._currentValue),nt._currentValue=ot,st!==null)if(He$1(st.value,ot)){if(st.children===it.children&&!Wf.current){et=$i(tt,et,rt);break e}}else for(st=et.child,st!==null&&(st.return=et);st!==null;){var lt=st.dependencies;if(lt!==null){ot=st.child;for(var ut=lt.firstContext;ut!==null;){if(ut.context===nt){if(st.tag===1){ut=ch(-1,rt&-rt),ut.tag=2;var ct=st.updateQueue;if(ct!==null){ct=ct.shared;var dt=ct.pending;dt===null?ut.next=ut:(ut.next=dt.next,dt.next=ut),ct.pending=ut}}st.lanes|=rt,ut=st.alternate,ut!==null&&(ut.lanes|=rt),Sg(st.return,rt,et),lt.lanes|=rt;break}ut=ut.next}}else if(st.tag===10)ot=st.type===et.type?null:st.child;else if(st.tag===18){if(ot=st.return,ot===null)throw Error(p$1(341));ot.lanes|=rt,lt=ot.alternate,lt!==null&&(lt.lanes|=rt),Sg(ot,rt,et),ot=st.sibling}else ot=st.child;if(ot!==null)ot.return=st;else for(ot=st;ot!==null;){if(ot===et){ot=null;break}if(st=ot.sibling,st!==null){st.return=ot.return,ot=st;break}ot=ot.return}st=ot}Yi(tt,et,it.children,rt),et=et.child}return et;case 9:return it=et.type,nt=et.pendingProps.children,Tg(et,rt),it=Vg(it),nt=nt(it),et.flags|=1,Yi(tt,et,nt,rt),et.child;case 14:return nt=et.type,it=Lg(nt,et.pendingProps),it=Lg(nt.type,it),aj(tt,et,nt,it,rt);case 15:return cj(tt,et,et.type,et.pendingProps,rt);case 17:return nt=et.type,it=et.pendingProps,it=et.elementType===nt?it:Lg(nt,it),jj(tt,et),et.tag=1,Zf(nt)?(tt=!0,cg(et)):tt=!1,Tg(et,rt),ph(et,nt,it),rh(et,nt,it,rt),kj(null,et,nt,!0,tt,rt);case 19:return yj(tt,et,rt);case 22:return ej(tt,et,rt)}throw Error(p$1(156,et.tag))};function Gk(tt,et){return ac(tt,et)}function al(tt,et,rt,nt){this.tag=tt,this.key=rt,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=et,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=nt,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(tt,et,rt,nt){return new al(tt,et,rt,nt)}function bj(tt){return tt=tt.prototype,!(!tt||!tt.isReactComponent)}function $k(tt){if(typeof tt=="function")return bj(tt)?1:0;if(tt!=null){if(tt=tt.$$typeof,tt===Da)return 11;if(tt===Ga)return 14}return 2}function wh(tt,et){var rt=tt.alternate;return rt===null?(rt=Bg(tt.tag,et,tt.key,tt.mode),rt.elementType=tt.elementType,rt.type=tt.type,rt.stateNode=tt.stateNode,rt.alternate=tt,tt.alternate=rt):(rt.pendingProps=et,rt.type=tt.type,rt.flags=0,rt.subtreeFlags=0,rt.deletions=null),rt.flags=tt.flags&14680064,rt.childLanes=tt.childLanes,rt.lanes=tt.lanes,rt.child=tt.child,rt.memoizedProps=tt.memoizedProps,rt.memoizedState=tt.memoizedState,rt.updateQueue=tt.updateQueue,et=tt.dependencies,rt.dependencies=et===null?null:{lanes:et.lanes,firstContext:et.firstContext},rt.sibling=tt.sibling,rt.index=tt.index,rt.ref=tt.ref,rt}function yh(tt,et,rt,nt,it,st){var ot=2;if(nt=tt,typeof tt=="function")bj(tt)&&(ot=1);else if(typeof tt=="string")ot=5;else e:switch(tt){case ya:return Ah(rt.children,it,st,et);case za:ot=8,it|=8;break;case Aa:return tt=Bg(12,rt,et,it|2),tt.elementType=Aa,tt.lanes=st,tt;case Ea:return tt=Bg(13,rt,et,it),tt.elementType=Ea,tt.lanes=st,tt;case Fa:return tt=Bg(19,rt,et,it),tt.elementType=Fa,tt.lanes=st,tt;case Ia:return qj(rt,it,st,et);default:if(typeof tt=="object"&&tt!==null)switch(tt.$$typeof){case Ba:ot=10;break e;case Ca:ot=9;break e;case Da:ot=11;break e;case Ga:ot=14;break e;case Ha:ot=16,nt=null;break e}throw Error(p$1(130,tt==null?tt:typeof tt,""))}return et=Bg(ot,rt,et,it),et.elementType=tt,et.type=nt,et.lanes=st,et}function Ah(tt,et,rt,nt){return tt=Bg(7,tt,nt,et),tt.lanes=rt,tt}function qj(tt,et,rt,nt){return tt=Bg(22,tt,nt,et),tt.elementType=Ia,tt.lanes=rt,tt.stateNode={isHidden:!1},tt}function xh(tt,et,rt){return tt=Bg(6,tt,null,et),tt.lanes=rt,tt}function zh(tt,et,rt){return et=Bg(4,tt.children!==null?tt.children:[],tt.key,et),et.lanes=rt,et.stateNode={containerInfo:tt.containerInfo,pendingChildren:null,implementation:tt.implementation},et}function bl(tt,et,rt,nt,it){this.tag=et,this.containerInfo=tt,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=nt,this.onRecoverableError=it,this.mutableSourceEagerHydrationData=null}function cl(tt,et,rt,nt,it,st,ot,lt,ut){return tt=new bl(tt,et,rt,lt,ut),et===1?(et=1,st===!0&&(et|=8)):et=0,st=Bg(3,null,null,et),tt.current=st,st.stateNode=tt,st.memoizedState={element:nt,isDehydrated:rt,cache:null,transitions:null,pendingSuspenseBoundaries:null},ah(st),tt}function dl(tt,et,rt){var nt=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:nt==null?null:""+nt,children:tt,containerInfo:et,implementation:rt}}function el(tt){if(!tt)return Vf;tt=tt._reactInternals;e:{if(Vb(tt)!==tt||tt.tag!==1)throw Error(p$1(170));var et=tt;do{switch(et.tag){case 3:et=et.stateNode.context;break e;case 1:if(Zf(et.type)){et=et.stateNode.__reactInternalMemoizedMergedChildContext;break e}}et=et.return}while(et!==null);throw Error(p$1(171))}if(tt.tag===1){var rt=tt.type;if(Zf(rt))return bg(tt,rt,et)}return et}function fl(tt,et,rt,nt,it,st,ot,lt,ut){return tt=cl(rt,nt,!0,tt,it,st,ot,lt,ut),tt.context=el(null),rt=tt.current,nt=L$2(),it=lh(rt),st=ch(nt,it),st.callback=et??null,dh(rt,st,it),tt.current.lanes=it,Ac(tt,it,nt),Ek(tt,nt),tt}function gl(tt,et,rt,nt){var it=et.current,st=L$2(),ot=lh(it);return rt=el(rt),et.context===null?et.context=rt:et.pendingContext=rt,et=ch(st,ot),et.payload={element:tt},nt=nt===void 0?null:nt,nt!==null&&(et.callback=nt),tt=dh(it,et,ot),tt!==null&&(mh(tt,it,ot,st),eh(tt,it,ot)),ot}function hl(tt){if(tt=tt.current,!tt.child)return null;switch(tt.child.tag){case 5:return tt.child.stateNode;default:return tt.child.stateNode}}function il(tt,et){if(tt=tt.memoizedState,tt!==null&&tt.dehydrated!==null){var rt=tt.retryLane;tt.retryLane=rt!==0&&rt<et?rt:et}}function jl(tt,et){il(tt,et),(tt=tt.alternate)&&il(tt,et)}function kl(){return null}var ll=typeof reportError=="function"?reportError:function(tt){console.error(tt)};function ml(tt){this._internalRoot=tt}nl.prototype.render=ml.prototype.render=function(tt){var et=this._internalRoot;if(et===null)throw Error(p$1(409));gl(tt,et,null,null)};nl.prototype.unmount=ml.prototype.unmount=function(){var tt=this._internalRoot;if(tt!==null){this._internalRoot=null;var et=tt.containerInfo;Sk(function(){gl(null,tt,null,null)}),et[uf]=null}};function nl(tt){this._internalRoot=tt}nl.prototype.unstable_scheduleHydration=function(tt){if(tt){var et=Hc();tt={blockedOn:null,target:tt,priority:et};for(var rt=0;rt<Qc.length&&et!==0&&et<Qc[rt].priority;rt++);Qc.splice(rt,0,tt),rt===0&&Vc(tt)}};function ol(tt){return!(!tt||tt.nodeType!==1&&tt.nodeType!==9&&tt.nodeType!==11)}function pl(tt){return!(!tt||tt.nodeType!==1&&tt.nodeType!==9&&tt.nodeType!==11&&(tt.nodeType!==8||tt.nodeValue!==" react-mount-point-unstable "))}function ql(){}function rl(tt,et,rt,nt,it){if(it){if(typeof nt=="function"){var st=nt;nt=function(){var ct=hl(ot);st.call(ct)}}var ot=fl(et,nt,tt,0,null,!1,!1,"",ql);return tt._reactRootContainer=ot,tt[uf]=ot.current,sf(tt.nodeType===8?tt.parentNode:tt),Sk(),ot}for(;it=tt.lastChild;)tt.removeChild(it);if(typeof nt=="function"){var lt=nt;nt=function(){var ct=hl(ut);lt.call(ct)}}var ut=cl(tt,0,!1,null,null,!1,!1,"",ql);return tt._reactRootContainer=ut,tt[uf]=ut.current,sf(tt.nodeType===8?tt.parentNode:tt),Sk(function(){gl(et,ut,rt,nt)}),ut}function sl(tt,et,rt,nt,it){var st=rt._reactRootContainer;if(st){var ot=st;if(typeof it=="function"){var lt=it;it=function(){var ut=hl(ot);lt.call(ut)}}gl(et,ot,tt,it)}else ot=rl(rt,et,tt,it,nt);return hl(ot)}Ec=function(tt){switch(tt.tag){case 3:var et=tt.stateNode;if(et.current.memoizedState.isDehydrated){var rt=tc(et.pendingLanes);rt!==0&&(Cc(et,rt|1),Ek(et,B$1()),!(K$2&6)&&(Hj=B$1()+500,jg()))}break;case 13:Sk(function(){var nt=Zg(tt,1);if(nt!==null){var it=L$2();mh(nt,tt,1,it)}}),jl(tt,1)}};Fc=function(tt){if(tt.tag===13){var et=Zg(tt,134217728);if(et!==null){var rt=L$2();mh(et,tt,134217728,rt)}jl(tt,134217728)}};Gc=function(tt){if(tt.tag===13){var et=lh(tt),rt=Zg(tt,et);if(rt!==null){var nt=L$2();mh(rt,tt,et,nt)}jl(tt,et)}};Hc=function(){return C$1};Ic=function(tt,et){var rt=C$1;try{return C$1=tt,et()}finally{C$1=rt}};yb=function(tt,et,rt){switch(et){case"input":if(bb(tt,rt),et=rt.name,rt.type==="radio"&&et!=null){for(rt=tt;rt.parentNode;)rt=rt.parentNode;for(rt=rt.querySelectorAll("input[name="+JSON.stringify(""+et)+'][type="radio"]'),et=0;et<rt.length;et++){var nt=rt[et];if(nt!==tt&&nt.form===tt.form){var it=Db(nt);if(!it)throw Error(p$1(90));Wa(nt),bb(nt,it)}}}break;case"textarea":ib(tt,rt);break;case"select":et=rt.value,et!=null&&fb(tt,!!rt.multiple,et,!1)}};Gb=Rk;Hb=Sk;var tl={usingClientEntryPoint:!1,Events:[Cb,ue$1,Db,Eb,Fb,Rk]},ul={findFiberByHostInstance:Wc,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},vl={bundleType:ul.bundleType,version:ul.version,rendererPackageName:ul.rendererPackageName,rendererConfig:ul.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(tt){return tt=Zb(tt),tt===null?null:tt.stateNode},findFiberByHostInstance:ul.findFiberByHostInstance||kl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var wl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!wl.isDisabled&&wl.supportsFiber)try{kc=wl.inject(vl),lc=wl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tl;reactDom_production_min.createPortal=function(tt,et){var rt=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ol(et))throw Error(p$1(200));return dl(tt,et,null,rt)};reactDom_production_min.createRoot=function(tt,et){if(!ol(tt))throw Error(p$1(299));var rt=!1,nt="",it=ll;return et!=null&&(et.unstable_strictMode===!0&&(rt=!0),et.identifierPrefix!==void 0&&(nt=et.identifierPrefix),et.onRecoverableError!==void 0&&(it=et.onRecoverableError)),et=cl(tt,1,!1,null,null,rt,!1,nt,it),tt[uf]=et.current,sf(tt.nodeType===8?tt.parentNode:tt),new ml(et)};reactDom_production_min.findDOMNode=function(tt){if(tt==null)return null;if(tt.nodeType===1)return tt;var et=tt._reactInternals;if(et===void 0)throw typeof tt.render=="function"?Error(p$1(188)):(tt=Object.keys(tt).join(","),Error(p$1(268,tt)));return tt=Zb(et),tt=tt===null?null:tt.stateNode,tt};reactDom_production_min.flushSync=function(tt){return Sk(tt)};reactDom_production_min.hydrate=function(tt,et,rt){if(!pl(et))throw Error(p$1(200));return sl(null,tt,et,!0,rt)};reactDom_production_min.hydrateRoot=function(tt,et,rt){if(!ol(tt))throw Error(p$1(405));var nt=rt!=null&&rt.hydratedSources||null,it=!1,st="",ot=ll;if(rt!=null&&(rt.unstable_strictMode===!0&&(it=!0),rt.identifierPrefix!==void 0&&(st=rt.identifierPrefix),rt.onRecoverableError!==void 0&&(ot=rt.onRecoverableError)),et=fl(et,null,tt,1,rt??null,it,!1,st,ot),tt[uf]=et.current,sf(tt),nt)for(tt=0;tt<nt.length;tt++)rt=nt[tt],it=rt._getVersion,it=it(rt._source),et.mutableSourceEagerHydrationData==null?et.mutableSourceEagerHydrationData=[rt,it]:et.mutableSourceEagerHydrationData.push(rt,it);return new nl(et)};reactDom_production_min.render=function(tt,et,rt){if(!pl(et))throw Error(p$1(200));return sl(null,tt,et,!1,rt)};reactDom_production_min.unmountComponentAtNode=function(tt){if(!pl(tt))throw Error(p$1(40));return tt._reactRootContainer?(Sk(function(){sl(null,null,tt,!1,function(){tt._reactRootContainer=null,tt[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Rk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function(tt,et,rt,nt){if(!pl(rt))throw Error(p$1(200));if(tt==null||tt._reactInternals===void 0)throw Error(p$1(38));return sl(tt,et,rt,!1,nt)};reactDom_production_min.version="18.2.0-next-9e3b772b8-20220608";function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(tt){console.error(tt)}}checkDCE(),reactDom.exports=reactDom_production_min;var reactDomExports=reactDom.exports;const $7SXl2$reactdom=getDefaultExportFromCjs$1(reactDomExports);var createRoot,m$2=reactDomExports;createRoot=m$2.createRoot,m$2.hydrateRoot;var __defProp=Object.defineProperty,__defNormalProp=(tt,et,rt)=>et in tt?__defProp(tt,et,{enumerable:!0,configurable:!0,writable:!0,value:rt}):tt[et]=rt,__publicField=(tt,et,rt)=>(__defNormalProp(tt,typeof et!="symbol"?et+"":et,rt),rt);const EMPTY=[];Object.freeze(EMPTY);const emptyAnnotationPage={id:"https://iiif-parser/annotation-page",type:"AnnotationPage",behavior:EMPTY,motivation:null,label:null,thumbnail:EMPTY,summary:null,requiredStatement:null,metadata:EMPTY,rights:null,provider:EMPTY,items:EMPTY,seeAlso:EMPTY,homepage:EMPTY,logo:EMPTY,rendering:EMPTY,service:EMPTY},emptyCanvas={id:"https://iiif-parser/empty-canvas",type:"Canvas",label:null,behavior:EMPTY,motivation:null,thumbnail:EMPTY,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:EMPTY,rights:null,navDate:null,provider:EMPTY,items:EMPTY,annotations:EMPTY,seeAlso:EMPTY,homepage:EMPTY,logo:EMPTY,partOf:EMPTY,rendering:EMPTY,service:EMPTY,duration:0,height:0,width:0},emptyCollection={id:"https://iiif-parser/empty-collection",type:"Collection",label:null,viewingDirection:"left-to-right",behavior:EMPTY,motivation:null,thumbnail:EMPTY,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:EMPTY,rights:null,navDate:null,provider:EMPTY,items:EMPTY,annotations:EMPTY,seeAlso:EMPTY,homepage:EMPTY,logo:EMPTY,partOf:EMPTY,rendering:EMPTY,service:EMPTY,services:EMPTY},emptyManifest={id:"https://iiif-parser/empty-manifest",type:"Manifest",annotations:EMPTY,behavior:EMPTY,homepage:EMPTY,items:EMPTY,label:null,logo:EMPTY,metadata:EMPTY,motivation:null,navDate:null,provider:EMPTY,partOf:EMPTY,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,rendering:EMPTY,requiredStatement:null,rights:null,seeAlso:EMPTY,service:EMPTY,services:EMPTY,start:null,structures:EMPTY,summary:null,thumbnail:EMPTY,viewingDirection:"left-to-right"},emptyRange={id:"https://iiif-parser/empty-canvas",type:"Range",label:null,behavior:EMPTY,motivation:null,thumbnail:EMPTY,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:EMPTY,rights:null,navDate:null,provider:EMPTY,items:EMPTY,annotations:EMPTY,seeAlso:EMPTY,homepage:EMPTY,logo:EMPTY,partOf:EMPTY,rendering:EMPTY,service:EMPTY,start:null,supplementary:null,viewingDirection:"left-to-right"},emptyAgent={id:"https://iiif-parser/empty-agent",type:"Agent",label:{},logo:EMPTY,seeAlso:EMPTY,homepage:EMPTY};function ensureArray$1(tt){return Array.isArray(tt)?tt:[tt]}const types$1=["Collection","Manifest","Canvas","AnnotationPage","AnnotationCollection","Annotation","ContentResource","Range","Service","Selector","Agent"];function identifyResource$1(tt){if(typeof tt>"u"||tt===null)throw new Error("Null or undefined is not a valid entity.");if(Array.isArray(tt))throw new Error("Array is not a valid entity");if(typeof tt!="object")throw new Error(`${typeof tt} is not a valid entity`);if(typeof tt.type=="string"){const et=types$1.indexOf(tt.type);if(et!==-1)return types$1[et]}if(tt.profile)return"Service";throw new Error("Resource type is not known")}class Traverse$1{constructor(et,rt={}){__publicField(this,"traversals"),__publicField(this,"options"),this.traversals={collection:[],manifest:[],canvas:[],annotationCollection:[],annotationPage:[],annotation:[],contentResource:[],choice:[],range:[],service:[],agent:[],...et},this.options={allowUndefinedReturn:!1,...rt}}static all(et){return new Traverse$1({collection:[et],manifest:[et],canvas:[et],annotationCollection:[et],annotationPage:[et],annotation:[et],contentResource:[et],choice:[et],range:[et],service:[et]})}traverseDescriptive(et){return et.thumbnail&&(et.thumbnail=et.thumbnail.map(rt=>this.traverseType(rt,this.traversals.contentResource))),et.provider&&(et.provider=et.provider.map(rt=>this.traverseAgent(rt))),et}traverseLinking(et){return et.seeAlso&&(et.seeAlso=et.seeAlso.map(rt=>this.traverseType(rt,this.traversals.contentResource))),et.service&&(et.service=ensureArray$1(et.service).map(rt=>this.traverseType(rt,this.traversals.service))),et.services&&(et.services=et.services.map(rt=>this.traverseType(rt,this.traversals.service))),et.logo&&(et.logo=et.logo.map(rt=>this.traverseType(rt,this.traversals.contentResource))),et.homepage&&(et.homepage=et.homepage.map(rt=>this.traverseType(rt,this.traversals.contentResource))),et.partOf&&(et.partOf=et.partOf.map(rt=>typeof rt=="string"||!rt.type?this.traverseType(rt,this.traversals.contentResource):rt.type==="Canvas"?this.traverseType(rt,this.traversals.canvas):rt.type==="AnnotationCollection"?this.traverseType(rt,this.traversals.annotationCollection):rt.type==="Collection"?this.traverseType(rt,this.traversals.collection):this.traverseType(rt,this.traversals.contentResource))),et.start&&(et.start=et.start?this.traverseType(et.start,this.traversals.canvas):null),et.rendering&&(et.rendering=et.rendering.map(rt=>this.traverseType(rt,this.traversals.contentResource))),et.supplementary&&(et.supplementary=et.supplementary.map(rt=>this.traverseType(rt,this.traversals.contentResource))),et}traverseCollectionItems(et){return et.items&&et.items.map(rt=>rt.type==="Collection"?this.traverseCollection(rt):this.traverseManifest(rt)),et}traverseCollection(et){return this.traverseType(this.traverseDescriptive(this.traverseInlineAnnotationPages(this.traverseLinking(this.traversePosterCanvas(this.traverseCollectionItems(et))))),this.traversals.collection)}traverseManifestItems(et){return et.items&&(et.items=et.items.map(rt=>this.traverseCanvas(rt))),et}traverseManifestStructures(et){return et.structures&&(et.structures=et.structures.map(rt=>this.traverseRange(rt))),et}traverseManifest(et){return this.traverseType(this.traverseInlineAnnotationPages(this.traverseManifestStructures(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(et)))))),this.traversals.manifest)}traverseCanvasItems(et){return et.items=(et.items||[]).map(rt=>this.traverseAnnotationPage(rt)),et}traverseInlineAnnotationPages(et){return typeof et=="string"||!et||et.annotations&&(et.annotations=et.annotations.map(rt=>this.traverseAnnotationPage(rt))),et}traverseCanvas(et){return this.traverseType(this.traverseInlineAnnotationPages(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(et))))),this.traversals.canvas)}traverseAnnotationPageItems(et){return et.items&&(et.items=et.items.map(rt=>this.traverseAnnotation(rt))),et}traverseAnnotationPage(et){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationPageItems(et))),this.traversals.annotationPage)}traverseAnnotationBody(et){return Array.isArray(et.body)?et.body=et.body.map(rt=>this.traverseContentResource(rt)):et.body&&(et.body=this.traverseContentResource(et.body)),et}traversePosterCanvas(et){return et.posterCanvas&&(et.posterCanvas=this.traverseCanvas(et.posterCanvas)),et.placeholderCanvas&&(et.placeholderCanvas=this.traverseCanvas(et.placeholderCanvas)),et.accompanyingCanvas&&(et.accompanyingCanvas=this.traverseCanvas(et.accompanyingCanvas)),et}traverseAnnotation(et){return this.traverseType(this.traverseLinking(this.traverseAnnotationBody(et)),this.traversals.annotation)}traverseContentResourceLinking(et){return typeof et=="string"||!et||et&&et.service&&(et.service=ensureArray$1(et.service||[]).map(rt=>this.traverseType(rt,this.traversals.service))),et}traverseContentResource(et){return et.type==="Choice"&&(et.items=et.items.map(rt=>this.traverseContentResource(rt))),this.traverseType(this.traverseInlineAnnotationPages(this.traverseContentResourceLinking(et)),this.traversals.contentResource)}traverseRangeRanges(et){return et.items&&(et.items=et.items.map(rt=>typeof rt=="string"?this.traverseCanvas({id:rt,type:"Canvas"}):rt.type==="Manifest"?this.traverseManifest(rt):this.traverseRange(rt))),et}traverseRange(et){return this.traverseType(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseRangeRanges(et)))),this.traversals.range)}traverseAgent(et){return this.traverseType(this.traverseDescriptive(this.traverseLinking(et)),this.traversals.agent)}traverseType(et,rt){return rt.reduce((nt,it)=>{const st=it(nt);return typeof st>"u"&&!this.options.allowUndefinedReturn?nt:st},et)}traverseService(et){return this.traverseType(et,this.traversals.service)}traverseUnknown(et){const rt=identifyResource$1(et);switch(rt){case"Collection":return this.traverseCollection(et);case"Manifest":return this.traverseManifest(et);case"Canvas":return this.traverseCanvas(et);case"AnnotationPage":return this.traverseAnnotationPage(et);case"Annotation":return this.traverseAnnotation(et);case"ContentResource":return this.traverseContentResource(et);case"Range":return this.traverseRange(et);case"Service":return this.traverseService(et);case"Agent":return this.traverseAgent(et);default:throw new Error(`Unknown or unsupported resource type of ${rt}`)}}}const types=["sc:Collection","sc:Manifest","sc:Canvas","sc:AnnotationList","oa:Annotation","sc:Range","sc:Layer","sc:Sequence","oa:Choice","Service","ContentResource"];function identifyResource(tt){if(typeof tt>"u"||tt===null)throw new Error("Null or undefined is not a valid entity.");if(Array.isArray(tt))throw new Error("Array is not a valid entity");if(typeof tt!="object")throw new Error(`${typeof tt} is not a valid entity`);if(typeof tt["@type"]=="string"){const et=types.indexOf(tt["@type"]);if(et!==-1)return types[et]}if(tt.profile)return"Service";if(tt.format||tt["@type"])return"ContentResource";throw new Error("Resource type is not known")}class Traverse{constructor(et,rt={}){__publicField(this,"traversals"),__publicField(this,"options"),this.traversals={collection:[],manifest:[],canvas:[],annotationList:[],sequence:[],annotation:[],contentResource:[],choice:[],range:[],service:[],layer:[],...et},this.options={convertPropsToArray:!0,mergeMemberProperties:!0,allowUndefinedReturn:!1,...rt}}static all(et){return new Traverse({collection:[et],manifest:[et],canvas:[et],annotationList:[et],sequence:[et],annotation:[et],contentResource:[et],choice:[et],range:[et],service:[et],layer:[et]})}traverseCollection(et){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCollectionItems(et))),this.traversals.collection)}traverseCollectionItems(et){if(this.options.mergeMemberProperties){const rt=[...(et.manifests||[]).map(nt=>typeof nt=="string"?{"@id":nt,"@type":"sc:Manifest"}:nt),...(et.collections||[]).map(nt=>typeof nt=="string"?{"@id":nt,"@type":"sc:Collection"}:nt),...et.members||[]];delete et.collections,delete et.manifests,et.members=rt}return et.manifests&&(et.manifests=et.manifests.map(rt=>this.traverseManifest(typeof rt=="string"?{"@id":rt,"@type":"sc:Manifest"}:rt))),et.collections&&(et.collections=et.collections.map(rt=>this.traverseCollection(typeof rt=="string"?{"@id":rt,"@type":"sc:Collection"}:rt))),et.members&&(et.members=et.members.map(rt=>typeof rt=="string"?rt:this.traverseUnknown(rt))),et}traverseManifest(et){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(et))),this.traversals.manifest)}traverseManifestItems(et){return et.sequences&&(et.sequences=et.sequences.map(rt=>this.traverseSequence(rt))),et.structures&&(et.structures=et.structures.map(rt=>this.traverseRange(rt))),et}traverseSequence(et){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseSequenceItems(et))),this.traversals.sequence)}traverseSequenceItems(et){return et.canvases&&(et.canvases=et.canvases.map(rt=>this.traverseCanvas(rt))),et}traverseCanvas(et){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(et))),this.traversals.canvas)}traverseCanvasItems(et){return et.images&&(et.images=et.images.map(rt=>this.traverseAnnotation(rt))),et.otherContent&&(et.otherContent=et.otherContent.map(rt=>this.traverseAnnotationList(rt))),et}traverseRange(et){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseRangeItems(et))),this.traversals.range)}traverseRangeItems(et){if(this.options.mergeMemberProperties){const rt=[...(et.ranges||[]).map(nt=>typeof nt=="string"?{"@id":nt,"@type":"sc:Range"}:nt),...(et.canvases||[]).map(nt=>typeof nt=="string"?{"@id":nt,"@type":"sc:Canvas"}:nt),...et.members||[]];delete et.ranges,delete et.canvases,et.members=rt.length?rt.map(nt=>this.traverseUnknown(nt)):void 0}return et}traverseAnnotationList(et){const rt=typeof et=="string"?{"@id":et,"@type":"sc:AnnotationList"}:et;return this.traverseType(this.traverseDescriptive(this.traverseAnnotationListItems(rt)),this.traversals.annotationList)}traverseAnnotationListItems(et){return et.resources&&(et.resources=et.resources.map(rt=>this.traverseAnnotation(rt))),et}traverseAnnotation(et){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationItems(et))),this.traversals.annotation)}traverseAnnotationItems(et){return et.resource&&(Array.isArray(et.resource)?et.resource=et.resource.map(rt=>this.traverseContentResource(rt)):et.resource=this.traverseContentResource(et.resource)),et.on,et}traverseLayer(et){return this.traverseType(this.traverseLinking(this.traverseLayerItems(et)),this.traversals.layer)}traverseLayerItems(et){return et.otherContent&&(et.otherContent=et.otherContent.map(rt=>this.traverseAnnotationList(rt))),et}traverseChoice(et){return this.traverseType(this.traverseChoiceItems(et),this.traversals.choice)}traverseChoiceItems(et){return et.default&&et.default!=="rdf:nil"&&(et.default=this.traverseContentResource(et.default)),et.item&&et.item!=="rdf:nil"&&(et.item=et.item.map(rt=>this.traverseContentResource(rt))),et}traverseService(et){return this.traverseType(this.traverseLinking(et),this.traversals.service)}traverseContentResource(et){return et["@type"]==="oa:Choice"?this.traverseChoice(et):this.traverseType(this.traverseDescriptive(this.traverseLinking(et)),this.traversals.contentResource)}traverseUnknown(et){if(!et["@type"]||typeof et=="string")return et;switch(identifyResource(et)){case"sc:Collection":return this.traverseCollection(et);case"sc:Manifest":return this.traverseManifest(et);case"sc:Canvas":return this.traverseCanvas(et);case"sc:Sequence":return this.traverseSequence(et);case"sc:Range":return this.traverseRange(et);case"oa:Annotation":return this.traverseAnnotation(et);case"sc:AnnotationList":return this.traverseAnnotationList(et);case"sc:Layer":return this.traverseLayer(et);case"Service":return this.traverseService(et);case"oa:Choice":return this.traverseChoice(et);case"ContentResource":return this.traverseContentResource(et)}return et.profile?this.traverseService(et):et}traverseImageResource(et){const rt=Array.isArray(et),nt=Array.isArray(et)?et:[et],it=[];for(const st of nt)typeof st=="string"?it.push(this.traverseContentResource({"@id":st,"@type":"dctypes:Image"})):it.push(this.traverseContentResource(st));return!rt&&!this.options.convertPropsToArray?it[0]:it}traverseDescriptive(et){return et.thumbnail&&(et.thumbnail=this.traverseImageResource(et.thumbnail)),et.logo&&(et.logo=this.traverseImageResource(et.logo)),et}traverseOneOrMoreServices(et){const rt=Array.isArray(et),nt=Array.isArray(et)?et:[et],it=[];for(const st of nt)it.push(this.traverseService(st));return!rt&&!this.options.convertPropsToArray?it[0]:it}traverseLinking(et){return et.related&&(et.related=this.traverseOneOrManyType(et.related,this.traversals.contentResource)),et.rendering&&(et.rendering=this.traverseOneOrManyType(et.rendering,this.traversals.contentResource)),et.service&&(et.service=this.traverseOneOrMoreServices(et.service)),et.seeAlso&&(et.seeAlso=this.traverseOneOrManyType(et.seeAlso,this.traversals.contentResource)),et.within&&(typeof et.within=="string"||(et.within=this.traverseOneOrManyType(et.within,this.traversals.contentResource))),et.startCanvas&&(typeof et.startCanvas=="string"?et.startCanvas=this.traverseType({"@id":et.startCanvas,"@type":"sc:Canvas"},this.traversals.canvas):et.startCanvas&&this.traverseType(et.startCanvas,this.traversals.canvas)),et.contentLayer&&(typeof et.contentLayer=="string"?et.contentLayer=this.traverseLayer({"@id":et.contentLayer,"@type":"sc:Layer"}):et.contentLayer=this.traverseLayer(et.contentLayer)),et}traverseOneOrManyType(et,rt){if(!Array.isArray(et))if(this.options.convertPropsToArray)et=[et];else return this.traverseType(et,rt);return et.map(nt=>this.traverseType(nt,rt))}traverseType(et,rt){return rt.reduce((nt,it)=>{const st=it(nt);return typeof st>"u"&&!this.options.allowUndefinedReturn?nt:st},et)}}const STANFORD_IIIF_IMAGE_COMPLIANCE_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",STANFORD_IIIF_IMAGE_COMPLIANCE_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",STANFORD_IIIF_IMAGE_COMPLIANCE_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",STANFORD_IIIF_IMAGE_CONFORMANCE_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",STANFORD_IIIF_IMAGE_CONFORMANCE_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",STANFORD_IIIF_IMAGE_CONFORMANCE_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",STANFORD_IIIF_1_IMAGE_COMPLIANCE_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",STANFORD_IIIF_1_IMAGE_COMPLIANCE_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",STANFORD_IIIF_1_IMAGE_COMPLIANCE_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",STANFORD_IIIF_1_IMAGE_CONFORMANCE_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",STANFORD_IIIF_1_IMAGE_CONFORMANCE_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",STANFORD_IIIF_1_IMAGE_CONFORMANCE_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",IIIF_1_IMAGE_LEVEL_0="http://iiif.io/api/image/1/level0.json",IIIF_1_IMAGE_LEVEL_0_PROFILE="http://iiif.io/api/image/1/profiles/level0.json",IIIF_1_IMAGE_LEVEL_1="http://iiif.io/api/image/1/level1.json",IIIF_1_IMAGE_LEVEL_1_PROFILE="http://iiif.io/api/image/1/profiles/level1.json",IIIF_1_IMAGE_LEVEL_2="http://iiif.io/api/image/1/level2.json",IIIF_1_IMAGE_LEVEL_2_PROFILE="http://iiif.io/api/image/1/profiles/level2.json",IIIF_2_IMAGE_LEVEL_0="http://iiif.io/api/image/2/level0.json",IIIF_2_IMAGE_LEVEL_0_PROFILE="http://iiif.io/api/image/2/profiles/level0.json",IIIF_2_IMAGE_LEVEL_1="http://iiif.io/api/image/2/level1.json",IIIF_2_IMAGE_LEVEL_1_PROFILE="http://iiif.io/api/image/2/profiles/level1.json",IIIF_2_IMAGE_LEVEL_2="http://iiif.io/api/image/2/level2.json",IIIF_2_IMAGE_LEVEL_2_PROFILE="http://iiif.io/api/image/2/profiles/level2.json",IIIF_3_IMAGE_LEVEL_0="level0",IIIF_3_IMAGE_LEVEL_1="level1",IIIF_3_IMAGE_LEVEL_2="level2",IIIF_2_IMAGE_LEVEL_0_NO_JSON="http://iiif.io/api/image/2/level0",IIIF_2_IMAGE_LEVEL_1_NO_JSON="http://iiif.io/api/image/2/level1",IIIF_2_IMAGE_LEVEL_2_NO_JSON="http://iiif.io/api/image/2/level2",level1Support=[IIIF_2_IMAGE_LEVEL_1_NO_JSON,IIIF_2_IMAGE_LEVEL_2_NO_JSON,STANFORD_IIIF_IMAGE_COMPLIANCE_1,STANFORD_IIIF_IMAGE_COMPLIANCE_2,STANFORD_IIIF_IMAGE_CONFORMANCE_1,STANFORD_IIIF_IMAGE_CONFORMANCE_2,STANFORD_IIIF_1_IMAGE_COMPLIANCE_1,STANFORD_IIIF_1_IMAGE_COMPLIANCE_2,STANFORD_IIIF_1_IMAGE_CONFORMANCE_1,STANFORD_IIIF_1_IMAGE_CONFORMANCE_2,IIIF_1_IMAGE_LEVEL_1,IIIF_1_IMAGE_LEVEL_1_PROFILE,IIIF_1_IMAGE_LEVEL_2,IIIF_1_IMAGE_LEVEL_2_PROFILE,IIIF_2_IMAGE_LEVEL_1,IIIF_2_IMAGE_LEVEL_1_PROFILE,IIIF_2_IMAGE_LEVEL_2,IIIF_2_IMAGE_LEVEL_2_PROFILE,IIIF_3_IMAGE_LEVEL_1,IIIF_3_IMAGE_LEVEL_2],imageServiceProfiles=[IIIF_2_IMAGE_LEVEL_0_NO_JSON,IIIF_2_IMAGE_LEVEL_1_NO_JSON,IIIF_2_IMAGE_LEVEL_2_NO_JSON,STANFORD_IIIF_IMAGE_COMPLIANCE_0,STANFORD_IIIF_IMAGE_COMPLIANCE_1,STANFORD_IIIF_IMAGE_COMPLIANCE_2,STANFORD_IIIF_IMAGE_CONFORMANCE_0,STANFORD_IIIF_IMAGE_CONFORMANCE_1,STANFORD_IIIF_IMAGE_CONFORMANCE_2,STANFORD_IIIF_1_IMAGE_COMPLIANCE_0,STANFORD_IIIF_1_IMAGE_COMPLIANCE_1,STANFORD_IIIF_1_IMAGE_COMPLIANCE_2,STANFORD_IIIF_1_IMAGE_CONFORMANCE_0,STANFORD_IIIF_1_IMAGE_CONFORMANCE_1,STANFORD_IIIF_1_IMAGE_CONFORMANCE_2,IIIF_1_IMAGE_LEVEL_0,IIIF_1_IMAGE_LEVEL_0_PROFILE,IIIF_1_IMAGE_LEVEL_1,IIIF_1_IMAGE_LEVEL_1_PROFILE,IIIF_1_IMAGE_LEVEL_2,IIIF_1_IMAGE_LEVEL_2_PROFILE,IIIF_2_IMAGE_LEVEL_0,IIIF_2_IMAGE_LEVEL_0_PROFILE,IIIF_2_IMAGE_LEVEL_1,IIIF_2_IMAGE_LEVEL_1_PROFILE,IIIF_2_IMAGE_LEVEL_2,IIIF_2_IMAGE_LEVEL_2_PROFILE,IIIF_3_IMAGE_LEVEL_0,IIIF_3_IMAGE_LEVEL_1,IIIF_3_IMAGE_LEVEL_2],configuration={attributionLabel:"Attribution",lang:"none",providerId:"http://example.org/provider",providerName:"Unknown"};function convertLanguageMapping(tt,et="none"){if(!tt)return{};const rt=Array.isArray(tt)?tt:[tt],nt={};for(const it of rt){if(typeof it=="string"){nt[et]=nt[et]?nt[et]:[],nt[et].push(it||"");continue}if(!it["@language"]){nt[et]=nt[et]?nt[et]:[],nt[et].push(it["@value"]||"");continue}const st=it["@language"];nt[st]=nt[st]?nt[st]:[],nt[st].push(it["@value"]||"")}return nt}function getProfile(tt){if(Array.isArray(tt))return getProfile(tt.find(et=>typeof et=="string"));if(imageServiceProfiles.indexOf(tt)!==-1)return"level2";if(level1Support.indexOf(tt)!==-1)return"level1";if(typeof tt=="string")return tt}function getTypeFromContext(tt){const et=Array.isArray(tt)?tt:[tt];for(const rt of et)switch(rt){case"http://iiif.io/api/image/2/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2":return"ImageService2";case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":return"ImageService1";case"http://iiif.io/api/annex/openannotation/context.json":return"ImageApiSelector"}}function getTypeFromProfile(tt){switch(tt){case"http://iiif.io/api/image/2/level0.json":case"http://iiif.io/api/image/2/level1.json":case"http://iiif.io/api/image/2/level2.json":return"ImageService2";case"http://iiif.io/api/auth/1/kiosk":case"http://iiif.io/api/auth/1/login":case"http://iiif.io/api/auth/1/clickthrough":case"http://iiif.io/api/auth/1/external":case"http://iiif.io/api/auth/0/kiosk":case"http://iiif.io/api/auth/0/login":case"http://iiif.io/api/auth/0/clickthrough":case"http://iiif.io/api/auth/0/external":return"AuthCookieService1";case"http://iiif.io/api/auth/1/token":case"http://iiif.io/api/auth/0/token":return"AuthTokenService1";case"http://iiif.io/api/auth/1/logout":case"http://iiif.io/api/auth/0/logout":return"AuthLogoutService1";case"http://iiif.io/api/search/1/search":case"http://iiif.io/api/search/0/search":return"SearchService1";case"http://iiif.io/api/search/1/autocomplete":case"http://iiif.io/api/search/0/autocomplete":return"AutoCompleteService1"}}function removePrefix(tt){for(const et of["sc","oa","dcterms","dctypes","iiif"])if(tt.startsWith(`${et}:`))return tt.slice(et.length+1);return tt}const knownTypes=["Collection","Manifest","Annotation","AnnotationPage","Range","Service"];function getNewType(tt){const et=tt["@id"]||tt.id;let rt=tt["@type"]||tt.type;const nt=tt.profile||void 0,it=tt["@context"]||void 0;if(nt){const st=getTypeFromProfile(nt);if(st)return st}if(it){const st=getTypeFromContext(it);if(st)return st}if(rt){if(Array.isArray(rt)){if(rt.indexOf("oa:CssStylesheet")!==-1)return"CssStylesheet";if(rt.indexOf("cnt:ContentAsText")!==-1)return"TextualBody";rt=rt[0]}for(const st of["sc","oa","dcterms","dctypes","iiif"])if(rt.startsWith(`${st}:`)){rt=rt.slice(st.length+1);break}switch(rt){case"Layer":return"AnnotationCollection";case"AnnotationList":return"AnnotationPage";case"cnt:ContentAsText":return"TextualBody"}}if(rt&&knownTypes.indexOf(rt)!==-1)return rt;if(tt.format){if(tt.format.startsWith("image/"))return"Image";if(tt.format.startsWith("text/")||tt.format==="application/pdf")return"Text";if(tt.format.startsWith("application/"))return"Dataset"}return et&&(et.endsWith(".jpg")||et.endsWith(".png")||et.endsWith(".jpeg"))?"Image":rt||"unknown"}const licenseRegex=/http(s)?:\/\/(creativecommons.org|rightsstatements.org)[^"'\\<\n]+/gm;function extractLicense(tt){const et=tt.match(licenseRegex);return et?et[0]:tt}function fixLicense(tt,et="Rights/License",rt="none"){let nt=null;const it=[],st=Array.isArray(tt)?tt:[tt];for(const ot of st){const lt=ot?extractLicense(ot):void 0;if(lt&&(lt.indexOf("creativecommons.org")!==-1||lt.indexOf("rightsstatements.org")!==-1)){lt.startsWith("https://")?nt=`http://${lt.slice(8)}`:nt=lt;continue}lt&&it.push({label:{[rt]:[et]},value:{[rt]:[lt]}})}return[nt,it]}const removeContexts=["http://iiif.io/api/presentation/2/context.json","http://iiif.io/api/image/2/context.json","http://iiif.io/api/image/1/context.json","http://library.stanford.edu/iiif/image-api/1.1/context.json","http://iiif.io/api/search/1/context.json","http://iiif.io/api/search/0/context.json","http://iiif.io/api/auth/1/context.json","http://iiif.io/api/auth/0/context.json","http://iiif.io/api/annex/openannotation/context.json"];function fixContext(tt){if(tt){const et=Array.isArray(tt)?tt:[tt],rt=[];for(const nt of et)nt==="http://iiif.io/api/presentation/2/context.json"&&rt.push("http://iiif.io/api/presentation/3/context.json"),removeContexts.indexOf(nt)===-1&&rt.push(nt);if(et.length)return rt.length===1?rt[0]:rt}}function convertMetadata(tt){return tt?tt.map(et=>({label:convertLanguageMapping(et.label),value:convertLanguageMapping(et.value)})):[]}function removeUndefinedProperties(tt){for(const et in tt)(typeof tt[et]>"u"||tt[et]===null)&&delete tt[et];return tt}let mintedIdCounter=0;function mintNewIdFromResource(tt,et){const rt=encodeURI(tt.id||tt["@id"]||"").trim();return rt&&et?`${rt}/${et}`:rt||(mintedIdCounter++,`http://example.org/${tt["@type"]}${et?`/${et}`:""}/${mintedIdCounter}`)}function technicalProperties$2(tt){const et=[...tt.behavior||[]];tt.viewingHint&&et.push(tt.viewingHint);let rt;return Array.isArray(tt.motivation)?rt=tt.motivation.map(removePrefix):tt.motivation&&(rt=removePrefix(tt.motivation)),{"@context":tt["@context"]?fixContext(tt["@context"]):void 0,id:(tt["@id"]||mintNewIdFromResource(tt)).trim(),type:getNewType(tt),behavior:et.length?et:void 0,height:tt.height?tt.height:void 0,width:tt.width?tt.width:void 0,motivation:rt,viewingDirection:tt.viewingDirection,profile:tt.profile,format:tt.format?tt.format:void 0,duration:void 0,timeMode:void 0}}function descriptiveProperties$2(tt){const[et,rt]=fixLicense(tt.license),nt=[...tt.metadata?convertMetadata(tt.metadata):[],...rt];return{rights:et,metadata:nt.length?nt:void 0,label:tt.label?convertLanguageMapping(tt.label):void 0,requiredStatement:tt.attribution?{label:convertLanguageMapping(configuration.attributionLabel),value:convertLanguageMapping(tt.attribution)}:void 0,navDate:tt.navDate,summary:tt.description?convertLanguageMapping(tt.description):void 0,thumbnail:tt.thumbnail}}function parseWithin(tt){if(!tt.within)return;const et=Array.isArray(tt.within)?tt.within:[tt.within],rt=[];for(const nt of et)if(typeof nt=="string"){if(nt)switch(tt["@type"]){case"sc:Manifest":rt.push({id:nt,type:"Collection"});break}}else nt["@id"]&&rt.push({id:nt["@id"],type:getNewType(nt)});return rt.length?rt:void 0}function linkingProperties$2(tt){const et=tt.related?Array.isArray(tt.related)?tt.related:[tt.related]:[],rt=tt.contentLayer;return{provider:tt.logo||et.length?[{id:configuration.providerId,type:"Agent",homepage:et.length?[et[0]]:void 0,logo:tt.logo?Array.isArray(tt.logo)?tt.logo:[tt.logo]:void 0,label:convertLanguageMapping(configuration.providerName)}]:void 0,partOf:parseWithin(tt),rendering:tt.rendering,seeAlso:tt.seeAlso,start:tt.startCanvas,service:tt.service?ensureArray$1(tt.service):void 0,supplementary:rt?[rt]:void 0}}function embeddedContentProperties(tt){return{chars:tt.chars,format:tt.format?tt.format:void 0,language:tt.language}}function upgradeCollection(tt){return removeUndefinedProperties({...technicalProperties$2(tt),...descriptiveProperties$2(tt),...linkingProperties$2(tt),items:tt.members})}function upgradeManifest(tt){const et=[],rt=[];for(const it of tt.sequences||[])it.canvases.length&&et.push(...it.canvases),it.behavior&&rt.push(...it.behavior);const nt=technicalProperties$2(tt);return rt.length&&(nt.behavior?nt.behavior.push(...rt):nt.behavior=rt),removeUndefinedProperties({...nt,...descriptiveProperties$2(tt),...linkingProperties$2(tt),items:et,structures:tt.structures})}function upgradeCanvas(tt){return removeUndefinedProperties({...technicalProperties$2(tt),...descriptiveProperties$2(tt),...linkingProperties$2(tt),annotations:tt.otherContent&&tt.otherContent.length?tt.otherContent:void 0,items:tt.images&&tt.images.length?[{id:mintNewIdFromResource(tt,"annotation-page"),type:"AnnotationPage",items:tt.images}]:void 0})}function upgradeAnnotationList(tt){return removeUndefinedProperties({...technicalProperties$2(tt),...descriptiveProperties$2(tt),...linkingProperties$2(tt),items:tt.resources&&tt.resources.length?tt.resources:void 0})}function upgradeSequence(tt){return!tt.canvases||tt.canvases.length===0?{canvases:[],behavior:[]}:{canvases:tt.canvases,behavior:tt.viewingHint?[tt.viewingHint]:[]}}function upgradeAnnotation(tt){function et(rt){if(Array.isArray(rt)){if(rt.length>1)return{type:"List",items:rt.map(et)};rt=rt[0]}if(typeof rt=="string")return encodeURI(rt).trim();if("@type"in rt){let nt;if(typeof rt.full=="string")nt=rt.full;else if(rt.full["@type"]==="dctypes:Image")nt={id:rt.full["@id"],type:"Image"};else if(rt.full["@type"]==="sc:Canvas")nt={id:rt.full["@id"],type:"Canvas"};else throw new Error(`Unsupported source type on annotation: ${rt.full["@type"]}`);return{type:"SpecificResource",source:nt,selector:upgradeSelector(rt.selector)}}else return encodeURI(rt["@id"]).trim()}return removeUndefinedProperties({...technicalProperties$2(tt),...descriptiveProperties$2(tt),...linkingProperties$2(tt),target:et(tt.on),body:Array.isArray(tt.resource)?tt.resource.map(upgradeContentResource):upgradeContentResource(tt.resource)})}function upgradeContentResource(tt){const et=tt;return removeUndefinedProperties({...technicalProperties$2(et),...descriptiveProperties$2(et),...linkingProperties$2(et),...embeddedContentProperties(et)})}function upgradeChoice(tt){const et=[];return tt.default&&tt.default!=="rdf:nil"&&et.push(tt.default),tt.item&&tt.item!=="rdf:nil"&&et.push(...tt.item),{...technicalProperties$2(tt),...descriptiveProperties$2(tt),items:et}}function upgradeRange(tt){return removeUndefinedProperties({...technicalProperties$2(tt),...descriptiveProperties$2(tt),...linkingProperties$2(tt),items:tt.members})}function upgradeService(tt){const{"@id":et,"@type":rt,"@context":nt,profile:it,...st}=tt,ot={};return et&&(ot["@id"]=et),ot["@type"]=getNewType(tt),ot["@type"]==="unknown"&&(nt&&nt.length&&(ot["@context"]=nt),ot["@type"]="Service"),it&&(ot.profile=getProfile(it)),removeUndefinedProperties({...ot,...st})}function upgradeLayer(tt){return removeUndefinedProperties({...technicalProperties$2(tt),...descriptiveProperties$2(tt),...linkingProperties$2(tt)})}const presentation2to3=new Traverse({collection:[upgradeCollection],manifest:[upgradeManifest],canvas:[upgradeCanvas],annotationList:[upgradeAnnotationList],sequence:[upgradeSequence],annotation:[upgradeAnnotation],contentResource:[upgradeContentResource],choice:[upgradeChoice],range:[upgradeRange],service:[upgradeService],layer:[upgradeLayer]});function convertPresentation2(tt){return tt&&tt["@context"]&&(tt["@context"]==="http://iiif.io/api/presentation/2/context.json"||tt["@context"].indexOf("http://iiif.io/api/presentation/2/context.json")!==-1||tt["@context"]==="http://www.shared-canvas.org/ns/context.json")||tt["@context"]==="http://iiif.io/api/image/2/context.json"?presentation2to3.traverseUnknown(tt):tt}function upgradeSelector(tt){if((Array.isArray(tt["@type"])&&tt["@type"].includes("oa:SvgSelector")||tt["@type"]=="oa:SvgSelector")&&("chars"in tt||"value"in tt))return{type:"SvgSelector",value:"chars"in tt?tt.chars:tt.value};if(tt["@type"]==="oa:FragmentSelector")return{type:"FragmentSelector",value:tt.value};if(tt["@type"]==="oa:Choice")return[upgradeSelector(tt.default),...(Array.isArray(tt.item)?tt.item:[tt.item]).map(upgradeSelector)];if(tt["@type"]=="iiif:ImageApiSelector")return{type:"ImageApiSelector",region:"region"in tt?tt.region:void 0,rotation:"rotation"in tt?tt.rotation:void 0};throw new Error(`Unsupported selector type: ${tt["@type"]}`)}function getDefaultEntities$1(){return{Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}}}function getResource(tt,et){if(typeof tt=="string")return{id:tt,type:et};if(!tt.id)throw new Error(`Invalid resource does not have an ID (${et})`);return tt}function mapToEntities(tt){return(et,rt)=>{const nt=tt[et]?tt[et]:{};return it=>{const st=getResource(it,rt||et);return st&&st.id&&et?(nt[st.id]=nt[st.id]?mergeEntities(nt[st.id],st):Object.assign({},st),{id:st.id,type:et==="ContentResource"?et:st.type}):st}}}function merge(tt,et){if(!et)return tt;if(Array.isArray(tt)){if(!Array.isArray(et))throw new Error("Cannot merge array with non-array");const rt=[...tt];for(const nt of et)if(nt!=null)if(Array.isArray(nt))rt.push(nt);else if(typeof nt=="object"&&nt.id&&nt.type){const it=rt.findIndex(st=>st.id===nt.id&&st.type===nt.type);it>=0&&(rt[it]=merge(rt[it],nt))}else tt.indexOf(nt)===-1&&rt.push(nt);return rt}else if(typeof tt=="object"){if(Array.isArray(et)||typeof et!="object")throw new Error("Cannot merge object with non-object");const rt={...tt};for(const[nt,it]of Object.entries(et)){const st=rt[nt];st===EMPTY||!st?rt[nt]=it:rt[nt]=merge(st,it)}return rt}else if(tt)return tt;return et}function mergeEntities(tt,et){if(typeof tt=="string")return tt;if(et.id!==tt.id||et.type!==tt.type)throw new Error("Can only merge entities with identical identifiers and type!");return merge({...tt},et)}function recordTypeInMapping(tt){return(et,rt)=>nt=>{const{id:it,type:st}=getResource(nt,rt||et);if(typeof it>"u")throw new Error("Found invalid entity without an ID.");return et==="ContentResource"?tt[it]=et:tt[it]=st,nt}}function hash$1(tt){const et=JSON.stringify(tt);let rt=5381,nt=et.length;for(;nt;)rt=rt*33^et.charCodeAt(--nt);const st=(rt>>>0).toString(16);return st.length%2?"0"+st:st}function addMissingIdToContentResource(tt){return et=>typeof et=="string"?{id:et,type:tt}:et.id?et.type?et:{type:tt,...et}:{id:`vault://${hash$1(et)}`,type:tt,...et}}function ensureDefaultFields(tt){return et=>({...tt,...et})}function ensureArray(tt){return Array.isArray(tt)?tt:[tt]}function ensureArrayOnAnnotation(tt){return tt.body&&(tt.body=ensureArray(tt.body)),tt.seeAlso&&(tt.seeAlso=ensureArray(tt.seeAlso)),tt.body&&(tt.body=ensureArray(tt.body)),tt.audience&&(tt.audience=ensureArray(tt.audience)),tt.accessibility&&(tt.accessibility=ensureArray(tt.accessibility)),tt.motivation&&(tt.motivation=ensureArray(tt.motivation)),tt}function normalize(tt){const et=convertPresentation2(tt),rt=getDefaultEntities$1(),nt={},it=mapToEntities(rt),st=recordTypeInMapping(nt),lt=new Traverse$1({collection:[ensureDefaultFields(emptyCollection),st("Collection"),it("Collection")],manifest:[ensureDefaultFields(emptyManifest),st("Manifest"),it("Manifest")],canvas:[ensureDefaultFields(emptyCanvas),st("Canvas"),it("Canvas")],annotationPage:[addMissingIdToContentResource("AnnotationPage"),ensureDefaultFields(emptyAnnotationPage),st("AnnotationPage"),it("AnnotationPage")],annotation:[addMissingIdToContentResource("Annotation"),ensureArrayOnAnnotation,st("Annotation"),it("Annotation")],contentResource:[addMissingIdToContentResource("ContentResource"),st("ContentResource"),it("ContentResource")],range:[ensureDefaultFields(emptyRange),st("Range","Canvas"),it("Range","Canvas")],agent:[ensureDefaultFields(emptyAgent),st("Agent"),it("Agent")]}).traverseUnknown(et);return{entities:rt,resource:lt,mapping:nt}}const UNSET="__$UNSET$__",UNWRAP="__$UNWRAP$__";function resolveIfExists$1(tt,et){const rt=tt.requests[et],nt=tt.mapping[et];if(!(!nt||rt&&rt.resourceUri&&!tt.entities[nt][rt.resourceUri]))return tt.entities[nt][rt?rt.resourceUri:et]}function serializedFieldsToObject(tt){const et={};for(const[rt,nt]of tt){if(rt===UNWRAP&&nt!==UNSET)return nt;nt!==UNSET&&typeof nt<"u"&&nt!==null&&(et[rt]=nt)}return et}function serialize(tt,et,rt){if(!et.type||!et.id)throw new Error("Unknown entity");if(!rt[et.type])throw new Error(`Serializer not found for ${et.type}`);function nt(it){const st=rt[it.type];if(!st)return UNSET;const ot=resolveIfExists$1(tt,it.id)||(it.id&&it.type?it:null);if(!ot)return UNSET;const lt=st(ot,tt,{isTopLevel:et.id===it.id});let ut=lt.next();for(;!ut.done;){const ct=ut.value;let dt=UNSET;if(ct)if(Array.isArray(ct)){const pt=[];for(const ft of ct)pt.push(nt(ft));dt=pt}else dt=nt(ct);ut=lt.next(dt)}return ut.value===UNSET?UNSET:serializedFieldsToObject(ut.value)}return nt(et)}function languageString2to3(tt){if(!tt)return;const et=Object.keys(tt);if(et.length!==0){if(et.length===1){const rt=et[0];if(!rt)return"";const nt=(tt[rt]||[]).join("");return rt==="@none"||rt==="none"||rt==="en"?nt:{"@language":rt,"@value":nt}}return et.map(rt=>({"@language":rt,"@value":(tt[rt]||[]).join("")}))}}function parseCanvasTarget(tt){return Array.isArray(tt)?tt.map(et=>parseCanvasTarget(et)):typeof tt=="string"?tt:tt.type&&tt.type==="Canvas"?tt.id:tt}function unNestArray(tt,et=!1){if(tt)return tt.length>1&&!et?tt:tt[0]||void 0}function convertService(tt){if(tt){if(typeof tt=="string")return{"@id":tt};if("@id"in tt){const et={...tt};return delete et["@type"],et}return{"@context":"http://iiif.io/api/image/2/context.json","@id":tt.id,profile:`http://iiif.io/api/image/2/profiles/${tt.profile}.json`}}}function technicalProperties$1(tt,et){return[["@id",tt.id],["@type",et],["format",tt.format],["height",tt.height],["width",tt.width],["viewingDirection",tt.viewingDirection!=="left-to-right"?tt.viewingDirection:void 0]]}function*descriptiveProperties$1(tt){const et=tt.provider?yield tt.provider[0]:void 0;return[["label",languageString2to3(tt.label)],["metadata",tt.metadata&&tt.metadata.length?tt.metadata.map(rt=>({label:languageString2to3(rt.label)||"",value:languageString2to3(rt.value)||""})):void 0],["description",languageString2to3(tt.summary)],["thumbnail",unNestArray(yield tt.thumbnail)],["navDate",tt.navDate],["logo",et?unNestArray(et.logo):void 0],["homepage",et?et.homepage:void 0],["attribution",tt.requiredStatement?languageString2to3(tt.requiredStatement.value):void 0]]}function*linkingProperties$1(tt){return[["seeAlso",unNestArray(yield tt.seeAlso)],["service",unNestArray((tt.service||[]).map(convertService))],["rendering",unNestArray(yield tt.rendering)],["startCanvas",tt.start?tt.start.id:void 0]]}const serializeConfigPresentation2={Manifest:function*(tt){return[...technicalProperties$1(tt,"sc:Manifest"),...yield*descriptiveProperties$1(tt),...yield*linkingProperties$1(tt),["sequences",[{"@id":`${tt.id}/sequence0`,"@type":"sc:Sequence",canvases:yield tt.items}]],["structures",yield tt.structures]]},Canvas:function*(tt){const rt=(yield tt.items)[0];return[...technicalProperties$1(tt,"sc:Canvas"),...yield*descriptiveProperties$1(tt),...yield*linkingProperties$1(tt),["images",rt?[rt.resources]:void 0],["annotations",tt.annotations&&tt.annotations.length?unNestArray(yield tt.annotations):void 0]]},AnnotationPage:function*(tt){return[...technicalProperties$1(tt,"sc:AnnotationList"),...yield*descriptiveProperties$1(tt),["resources",tt.items&&tt.items.length?unNestArray(yield tt.items):void 0]]},Annotation:function*(tt){return[["@id",tt.id],["@type","oa:Annotation"],["motivation","sc:painting"],["on",parseCanvasTarget(tt.target)],["resource",unNestArray(yield tt.body,!0)]]},ContentResource:function*(tt){switch(tt.type){case"Image":return[...technicalProperties$1(tt,"dctypes:Image"),...yield*descriptiveProperties$1(tt),...yield*linkingProperties$1(tt)];case"Text":case"Dataset":default:return[...technicalProperties$1(tt,void 0),...yield*descriptiveProperties$1(tt)]}},AnnotationCollection:function*(tt){return[["@id",tt.id],["@type","sc:Layer"],["label",languageString2to3(tt.label)]]},Collection:function*(tt){return[...technicalProperties$1(tt,"sc:Collection"),...yield*descriptiveProperties$1(tt),...yield*linkingProperties$1(tt),["members",yield*tt.items]]},Range:function*(tt){const et=[],rt=[];if(tt.items)for(const nt of tt.items){const it=yield nt;et.push({"@id":nt.id,"@type":nt.type,label:it?it.label:void 0,within:tt.id}),nt.type==="Canvas"&&rt.push(nt.id)}return[...technicalProperties$1(tt,"sc:Range"),...yield*descriptiveProperties$1(tt),...yield*linkingProperties$1(tt),["canvases",rt.length===et.length?rt:void 0],["members",rt.length!==et.length?et:void 0]]}};function technicalProperties(tt){var et;return[["id",(et=tt.id)!=null&&et.startsWith("vault://")?void 0:tt.id],["type",tt.type],["format",tt.format],["profile",tt.profile],["height",tt.height],["width",tt.width],["duration",tt.duration||void 0],["viewingDirection",tt.viewingDirection!=="left-to-right"?tt.viewingDirection:void 0],["behavior",tt.behavior&&tt.behavior.length?tt.behavior:void 0],["timeMode",tt.timeMode],["motivation",Array.isArray(tt.motivation)?tt.motivation[0]:tt.motivation]]}function filterEmpty(tt){if(!(!tt||tt.length===0))return tt}function service2compat(tt){if(tt&&tt.type&&tt.type==="ImageService2"){const{id:et,type:rt,profile:nt,...it}=tt,st=typeof nt=="string"?nt:Array.isArray(nt)?nt.find(ot=>typeof ot=="string"):"";return{"@id":et,"@type":rt,profile:st?st.startsWith("http")?st:`http://iiif.io/api/image/2/${st}.json`:"http://iiif.io/api/image/2/level0.json",...it}}return tt}function filterService2Compat(tt){if(!(!tt||tt.length===0))return tt.map(service2compat)}function*descriptiveProperties(tt){return[["label",tt.label],["metadata",filterEmpty(tt.metadata)],["summary",tt.summary],["requiredStatement",tt.requiredStatement],["rights",tt.rights],["navDate",tt.navDate],["language",tt.language],["thumbnail",filterEmpty(yield tt.thumbnail)],["placeholderCanvas",yield tt.placeholderCanvas],["accompanyingCanvas",yield tt.accompanyingCanvas],["provider",filterEmpty(yield tt.provider)]]}function*linkingProperties(tt){return[["seeAlso",filterEmpty(yield tt.seeAlso)],["service",filterService2Compat(tt.service)],["services",filterService2Compat(tt.services)],["rendering",filterEmpty(yield tt.rendering)],["supplementary",filterEmpty(yield tt.supplementary)],["homepage",filterEmpty(yield tt.homepage)],["logo",filterEmpty(yield tt.logo)],["partOf",filterEmpty(yield tt.partOf)],["start",tt.start]]}const serializeConfigPresentation3={Manifest:function*(tt,et,{isTopLevel:rt}){return rt?[["@context","http://iiif.io/api/presentation/3/context.json"],...technicalProperties(tt),...yield*descriptiveProperties(tt),...yield*linkingProperties(tt),["items",yield tt.items],["structures",filterEmpty(yield tt.structures)],["annotations",filterEmpty(yield tt.annotations)]]:[...technicalProperties(tt),...yield*descriptiveProperties(tt)]},Canvas:function*(tt){return[...technicalProperties(tt),...yield*descriptiveProperties(tt),...yield*linkingProperties(tt),["items",yield tt.items],["annotations",filterEmpty(yield tt.annotations)]]},Agent:function*(tt){return[["id",tt.id],["type","Agent"],["label",tt.label],...yield*linkingProperties(tt)]},AnnotationPage:function*(tt){return[...Object.entries(tt).map(([rt,nt])=>[rt,Array.isArray(nt)?filterEmpty(nt):nt]).filter(([rt,nt])=>rt!=="items"),...yield*linkingProperties(tt),["items",yield tt.items]]},Service:function*(tt){return[[UNWRAP,service2compat(tt)]]},Annotation:function*(tt){const et=Object.entries(tt).map(([nt,it])=>nt==="motivation"?[nt,Array.isArray(it)?it[0]:it]:[nt,Array.isArray(it)?filterEmpty(it):it]).filter(([nt])=>nt!=="body"),rt=yield tt.body;return[...et,["body",rt.length===1?rt[0]:rt]]},ContentResource:function*(tt){return[...technicalProperties(tt),...yield*descriptiveProperties(tt),...yield*linkingProperties(tt),["annotations",filterEmpty(yield tt.annotations)],["items",filterEmpty(yield tt.items)]]},AnnotationCollection:function*(tt){return[["id",tt.id],["type","AnnotationCollection"],["label",tt.label]]},Collection:function*(tt,et,{isTopLevel:rt}){return rt?[["@context","http://iiif.io/api/presentation/3/context.json"],...technicalProperties(tt),...yield*descriptiveProperties(tt),...yield*linkingProperties(tt),["items",filterEmpty(yield tt.items)]]:[...technicalProperties(tt),...yield*descriptiveProperties(tt)]},Range:function*(tt){const et=[];for(const rt of tt.items)rt.type==="Range"?et.push(yield rt):et.push(rt);return[...technicalProperties(tt),...yield*descriptiveProperties(tt),...yield*linkingProperties(tt),["items",et],["annotations",filterEmpty(yield tt.annotations)]]}};function n$1(tt){return tt==null}function t$1(tt){throw new Error("Argument "+tt+" is empty.")}function o$1(tt){return typeof tt=="string"||typeof tt=="symbol"}function u$1(tt){return!o$1(tt)}function a$1(tt){throw new Error("Argument "+tt+" is invalid, it should be an action type of type: string | symbol")}function s$1(tt,et){return n$1(tt)&&t$1(1),u$1(tt)&&a$1(1),Object.assign(function(){var rt=et!=null?et.apply(void 0,arguments):void 0;return Object.assign({type:tt},rt)},{getType:function(){return tt},toString:function(){return tt}})}function y$1(tt,et,rt){return n$1(tt)&&t$1(1),u$1(tt)&&a$1(1),function(){return s$1(tt,function(){var nt=arguments.length<=0?void 0:arguments[0],it=arguments.length<=1?void 0:arguments[1];return et==null&&rt==null||(nt=et!=null?et.apply(void 0,arguments):void 0,it=rt!=null?rt.apply(void 0,arguments):void 0),Object.assign({},nt!==void 0&&{payload:nt},{},it!==void 0&&{meta:it})})}}function _typeof(tt){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(et){return typeof et}:function(et){return et&&typeof Symbol=="function"&&et.constructor===Symbol&&et!==Symbol.prototype?"symbol":typeof et},_typeof(tt)}function toPrimitive(tt,et){if(_typeof(tt)!="object"||!tt)return tt;var rt=tt[Symbol.toPrimitive];if(rt!==void 0){var nt=rt.call(tt,et||"default");if(_typeof(nt)!="object")return nt;throw new TypeError("@@toPrimitive must return a primitive value.")}return(et==="string"?String:Number)(tt)}function toPropertyKey(tt){var et=toPrimitive(tt,"string");return _typeof(et)=="symbol"?et:String(et)}function _defineProperty$1(tt,et,rt){return et=toPropertyKey(et),et in tt?Object.defineProperty(tt,et,{value:rt,enumerable:!0,configurable:!0,writable:!0}):tt[et]=rt,tt}function ownKeys$1(tt,et){var rt=Object.keys(tt);if(Object.getOwnPropertySymbols){var nt=Object.getOwnPropertySymbols(tt);et&&(nt=nt.filter(function(it){return Object.getOwnPropertyDescriptor(tt,it).enumerable})),rt.push.apply(rt,nt)}return rt}function _objectSpread2$1(tt){for(var et=1;et<arguments.length;et++){var rt=arguments[et]!=null?arguments[et]:{};et%2?ownKeys$1(Object(rt),!0).forEach(function(nt){_defineProperty$1(tt,nt,rt[nt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(tt,Object.getOwnPropertyDescriptors(rt)):ownKeys$1(Object(rt)).forEach(function(nt){Object.defineProperty(tt,nt,Object.getOwnPropertyDescriptor(rt,nt))})}return tt}function formatProdErrorMessage(tt){return"Minified Redux error #"+tt+"; visit https://redux.js.org/Errors?code="+tt+" for the full message or use the non-minified dev environment for full errors. "}var $$observable=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),randomString=function(){return Math.random().toString(36).substring(7).split("").join(".")},ActionTypes={INIT:"@@redux/INIT"+randomString(),REPLACE:"@@redux/REPLACE"+randomString(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+randomString()}};function isPlainObject$3(tt){if(typeof tt!="object"||tt===null)return!1;for(var et=tt;Object.getPrototypeOf(et)!==null;)et=Object.getPrototypeOf(et);return Object.getPrototypeOf(tt)===et}function createStore$1(tt,et,rt){var nt;if(typeof et=="function"&&typeof rt=="function"||typeof rt=="function"&&typeof arguments[3]=="function")throw new Error(formatProdErrorMessage(0));if(typeof et=="function"&&typeof rt>"u"&&(rt=et,et=void 0),typeof rt<"u"){if(typeof rt!="function")throw new Error(formatProdErrorMessage(1));return rt(createStore$1)(tt,et)}if(typeof tt!="function")throw new Error(formatProdErrorMessage(2));var it=tt,st=et,ot=[],lt=ot,ut=!1;function ct(){lt===ot&&(lt=ot.slice())}function dt(){if(ut)throw new Error(formatProdErrorMessage(3));return st}function pt(Yr){if(typeof Yr!="function")throw new Error(formatProdErrorMessage(4));if(ut)throw new Error(formatProdErrorMessage(5));var mt=!0;return ct(),lt.push(Yr),function(){if(mt){if(ut)throw new Error(formatProdErrorMessage(6));mt=!1,ct();var Xr=lt.indexOf(Yr);lt.splice(Xr,1),ot=null}}}function ft(Yr){if(!isPlainObject$3(Yr))throw new Error(formatProdErrorMessage(7));if(typeof Yr.type>"u")throw new Error(formatProdErrorMessage(8));if(ut)throw new Error(formatProdErrorMessage(9));try{ut=!0,st=it(st,Yr)}finally{ut=!1}for(var mt=ot=lt,Kr=0;Kr<mt.length;Kr++){var Xr=mt[Kr];Xr()}return Yr}function gt(Yr){if(typeof Yr!="function")throw new Error(formatProdErrorMessage(10));it=Yr,ft({type:ActionTypes.REPLACE})}function _r(){var Yr,mt=pt;return Yr={subscribe:function(Xr){if(typeof Xr!="object"||Xr===null)throw new Error(formatProdErrorMessage(11));function Zr(){Xr.next&&Xr.next(dt())}Zr();var Qr=mt(Zr);return{unsubscribe:Qr}}},Yr[$$observable]=function(){return this},Yr}return ft({type:ActionTypes.INIT}),nt={dispatch:ft,subscribe:pt,getState:dt,replaceReducer:gt},nt[$$observable]=_r,nt}function assertReducerShape(tt){Object.keys(tt).forEach(function(et){var rt=tt[et],nt=rt(void 0,{type:ActionTypes.INIT});if(typeof nt>"u")throw new Error(formatProdErrorMessage(12));if(typeof rt(void 0,{type:ActionTypes.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(formatProdErrorMessage(13))})}function combineReducers(tt){for(var et=Object.keys(tt),rt={},nt=0;nt<et.length;nt++){var it=et[nt];typeof tt[it]=="function"&&(rt[it]=tt[it])}var st=Object.keys(rt),ot;try{assertReducerShape(rt)}catch(lt){ot=lt}return function(ut,ct){if(ut===void 0&&(ut={}),ot)throw ot;for(var dt=!1,pt={},ft=0;ft<st.length;ft++){var gt=st[ft],_r=rt[gt],Yr=ut[gt],mt=_r(Yr,ct);if(typeof mt>"u")throw ct&&ct.type,new Error(formatProdErrorMessage(14));pt[gt]=mt,dt=dt||mt!==Yr}return dt=dt||st.length!==Object.keys(ut).length,dt?pt:ut}}function compose(){for(var tt=arguments.length,et=new Array(tt),rt=0;rt<tt;rt++)et[rt]=arguments[rt];return et.length===0?function(nt){return nt}:et.length===1?et[0]:et.reduce(function(nt,it){return function(){return nt(it.apply(void 0,arguments))}})}function applyMiddleware(){for(var tt=arguments.length,et=new Array(tt),rt=0;rt<tt;rt++)et[rt]=arguments[rt];return function(nt){return function(){var it=nt.apply(void 0,arguments),st=function(){throw new Error(formatProdErrorMessage(15))},ot={getState:it.getState,dispatch:function(){return st.apply(void 0,arguments)}},lt=et.map(function(ut){return ut(ot)});return st=compose.apply(void 0,lt)(it.dispatch),_objectSpread2$1(_objectSpread2$1({},it),{},{dispatch:st})}}}const IMPORT_ENTITIES="@iiif/IMPORT_ENTITIES",MODIFY_ENTITY_FIELD="@iiif/MODIFY_ENTITY_FIELD",REORDER_ENTITY_FIELD="@iiif/REORDER_ENTITY_FIELD",ADD_REFERENCE="@iiif/ADD_REFERENCE",REMOVE_REFERENCE="@iiif/REMOVE_REFERENCE",importEntities=y$1(IMPORT_ENTITIES)(),modifyEntityField=y$1(MODIFY_ENTITY_FIELD)(),reorderEntityField=y$1(REORDER_ENTITY_FIELD)(),addReference=y$1(ADD_REFERENCE)(),removeReference=y$1(REMOVE_REFERENCE)(),entityActions={importEntities,modifyEntityField,reorderEntityField,addReference,removeReference},ADD_MAPPING="@iiif/ADD_MAPPING",ADD_MAPPINGS="@iiif/ADD_MAPPINGS",addMapping=y$1(ADD_MAPPING)(),addMappings=y$1(ADD_MAPPINGS)(),SET_META_VALUE="@iiif/SET_META_VALUE",SET_META_VALUE_DYNAMIC="@iiif/SET_META_VALUE_DYNAMIC",UNSET_META_VALUE="@iiif/UNSET_META_VALUE",setMetaValue=y$1(SET_META_VALUE)(),setMetaValueDynamic=y$1(SET_META_VALUE_DYNAMIC)(),unsetMetaValue=y$1(UNSET_META_VALUE)(),metaActions={setMetaValue,setMetaValueDynamic,unsetMetaValue},RESOURCE_ERROR="RESOURCE_ERROR",RESOURCE_LOADING="RESOURCE_LOADING",RESOURCE_READY="RESOURCE_READY",REQUEST_RESOURCE="@iiif/REQUEST_RESOURCE",REQUEST_ERROR="@iiif/REQUEST_ERROR",REQUEST_MISMATCH="@iiif/REQUEST_MISMATCH",REQUEST_COMPLETE="@iiif/REQUEST_COMPLETE",REQUEST_OFFLINE_RESOURCE="@iiif/REQUEST_OFFLINE_RESOURCE",requestResource=y$1(REQUEST_RESOURCE)(),requestError=y$1(REQUEST_ERROR)(),requestMismatch=y$1(REQUEST_MISMATCH)(),requestComplete=y$1(REQUEST_COMPLETE)();y$1(REQUEST_OFFLINE_RESOURCE)();const BATCH_ACTIONS="@iiif/BATCH",BATCH_IMPORT="@iiif/BATCH_IMPORT",batchActions=y$1(BATCH_ACTIONS)();y$1(BATCH_IMPORT)();const actionListFromResource=(tt,et)=>{const{entities:rt,resource:nt,mapping:it}=normalize(et);if(nt.id===void 0)return[requestError({id:tt,message:"ID is not defined in resource."})];const st=[importEntities({entities:rt}),addMappings({mapping:it})];return nt.id!==tt&&(st.push(addMapping({id:tt,type:nt.type})),st.push(requestMismatch({requestId:tt,actualId:nt.id}))),st.push(requestComplete({id:tt})),st},safeIsNaN=Number.isNaN||function(et){return typeof et=="number"&&et!==et};function isEqual(tt,et){return!!(tt===et||safeIsNaN(tt)&&safeIsNaN(et))}function areInputsEqual(tt,et){if(!Array.isArray(tt)||!Array.isArray(et))return tt===et;if(tt.length!==et.length)return!1;for(let rt=0;rt<tt.length;rt++)if(!isEqual(tt[rt],et[rt]))return!1;return!0}function resolveIfExists(tt,et){const rt=tt.iiif.requests[et],nt=tt.iiif.mapping[et];if(!(!nt||!tt.iiif.entities[nt][rt.resourceUri]))return tt.iiif.entities[nt][rt.resourceUri]}function createFetchHelper(tt,et,{waitTimeout:rt=30}={}){return async(nt,it)=>{const st=tt.getState(),ot=st.iiif.requests[nt];if(ot)switch(ot.loadingState){case RESOURCE_ERROR:break;case RESOURCE_LOADING:{let lt,ut=!1;try{const ct=await Promise.race([new Promise((dt,pt)=>{ut||(lt=tt.subscribe(()=>{const ft=tt.getState();if(ft.iiif.requests[nt].loadingState===RESOURCE_ERROR){pt();return}if(ft.iiif.requests[nt].loadingState===RESOURCE_READY){const gt=resolveIfExists(ft,nt);gt?dt(gt):pt()}}))}),new Promise((dt,pt)=>setTimeout(()=>{ut=!0,pt()},rt*60))]);if(lt&&lt(),ct)return ct}catch{lt&&lt();break}break}case RESOURCE_READY:{const lt=resolveIfExists(st,nt);if(lt)return lt;break}}tt.dispatch(requestResource({id:nt}));try{const lt=await et(nt,it);!lt.id&&!lt["@id"]&&(lt["@type"]&&(lt["@id"]=nt),lt.id=nt);const ut=actionListFromResource(nt,lt);return tt.dispatch(batchActions({actions:ut})),resolveIfExists(tt.getState(),nt)}catch(lt){throw tt.dispatch(requestError({id:nt,message:lt.toString()})),lt}}}function getDefaultEntities(){return{Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}}}const mappingReducer=(tt={},et)=>{switch(et.type){case ADD_MAPPING:return{...tt,[et.payload.id]:et.payload.type};case ADD_MAPPINGS:return{...tt,...et.payload.mapping};default:return tt}};function isReferenceList(tt,et,rt,nt){return!(!tt[rt]||!tt[rt][et]||!tt[rt][et][nt]||!Array.isArray(tt[rt][et][nt]))}function quickMerge(tt,et){const rt={},nt=[];for(const[it,st]of Object.entries(tt||{})){nt.push(it);const ot=(et||{})[it];if(!ot||ot.length===0){rt[it]=st;continue}rt[it]=ot}for(const[it,st]of Object.entries(et||{}))nt.indexOf(it)===-1&&(rt[it]=st);return rt}const entitiesReducer=(tt=getDefaultEntities(),et)=>{var rt;switch(et.type){case MODIFY_ENTITY_FIELD:{if(!tt[et.payload.type]||!tt[et.payload.type][et.payload.id])return tt;const nt=tt[et.payload.type][et.payload.id];return typeof nt=="string"?tt:{...tt,[et.payload.type]:{...tt[et.payload.type],[et.payload.id]:{...nt,[et.payload.key]:et.payload.value}}}}case REORDER_ENTITY_FIELD:{if(!isReferenceList(tt,et.payload.id,et.payload.type,et.payload.key))return tt;const nt=tt[et.payload.type][et.payload.id];if(typeof nt=="string")return tt;const it=Array.from(nt[et.payload.key]),[st]=it.splice(et.payload.startIndex,1);return it.splice(et.payload.endIndex,0,st),{...tt,[et.payload.type]:{...tt[et.payload.type],[et.payload.id]:{...nt,[et.payload.key]:it}}}}case IMPORT_ENTITIES:{const nt=Object.keys(et.payload.entities),it={...tt};for(const st of nt){const ot=et.payload.entities[st],lt={...tt[st]||{}};let ut=!1;const ct=Object.keys(ot||{})||[];if(ot&&ct){for(const dt of ct)ut=!0,lt[dt]=tt[st][dt]?quickMerge(tt[st][dt],ot[dt]):ot[dt];ut&&(it[st]=lt)}}return it}case ADD_REFERENCE:{if(!isReferenceList(tt,et.payload.id,et.payload.type,et.payload.key))return tt;const nt=tt[et.payload.type][et.payload.id],it=Array.from(nt[et.payload.key]);return it.splice(et.payload.index||it.length+1,0,et.payload.reference),{...tt,[et.payload.type]:{...tt[et.payload.type],[et.payload.id]:{...nt,[et.payload.key]:it}}}}case REMOVE_REFERENCE:{if(!isReferenceList(tt,et.payload.id,et.payload.type,et.payload.key))return tt;const nt=tt[et.payload.type][et.payload.id],it=Array.from(nt[et.payload.key]),st=et.payload.index||it.findIndex(ot=>ot&&ot.id===et.payload.reference.id);return st===-1||((rt=it[st])==null?void 0:rt.id)!==et.payload.reference.id?tt:(it.splice(st,1),{...tt,[et.payload.type]:{...tt[et.payload.type],[et.payload.id]:{...nt,[et.payload.key]:it}}})}default:return tt}},requestReducer=(tt={},et)=>{switch(et.type){case REQUEST_RESOURCE:case REQUEST_OFFLINE_RESOURCE:return{...tt,[et.payload.id]:{requestUri:et.payload.id,loadingState:RESOURCE_LOADING,uriMismatch:!1,resourceUri:et.payload.id}};case REQUEST_MISMATCH:return{...tt,[et.payload.requestId]:{...tt[et.payload.requestId]||{},uriMismatch:!0,resourceUri:et.payload.actualId},[et.payload.actualId]:{requestUri:et.payload.requestId,loadingState:tt[et.payload.requestId].loadingState,uriMismatch:!0,resourceUri:et.payload.actualId}};case REQUEST_ERROR:return{...tt,[et.payload.id]:{...tt[et.payload.id]||{},loadingState:RESOURCE_ERROR,error:et.payload.message}};case REQUEST_COMPLETE:return{...tt,[et.payload.id]:{...tt[et.payload.id]||{},loadingState:RESOURCE_READY,error:void 0}}}return tt},metaReducer=(tt={},et)=>{const{id:rt,updateValue:nt,value:it,meta:st,key:ot}=et&&et.payload||{};switch(et.type){case SET_META_VALUE:return{...tt,[rt]:{...tt[rt]||{},[st]:{...tt[rt]?tt[rt][st]||{}:{},[ot]:it}}};case SET_META_VALUE_DYNAMIC:return{...tt,[rt]:{...tt[rt]||{},[st]:{...tt[rt]?tt[rt][st]||{}:{},[ot]:tt[rt]&&tt[rt][st]?nt(tt[rt][st][ot]):nt(void 0)}}};case UNSET_META_VALUE:return tt[rt]&&tt[rt][st]&&tt[rt][st][ot]?{...tt,[rt]:{...tt[rt]||{},[st]:{...tt[rt]?tt[rt][st]||{}:{},[ot]:void 0}}}:tt;default:return tt}};function createBatchReducer(tt){return(et,rt)=>rt&&rt.type===BATCH_ACTIONS?rt.payload.actions.reduce(tt,et):rt&&rt.type===BATCH_IMPORT?rt.payload.state:tt(et,rt)}const reducers=combineReducers({mapping:mappingReducer,entities:entitiesReducer,requests:requestReducer,meta:metaReducer}),composeEnhancers=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||compose;function createStore(tt={}){const{enableDevtools:et=!0,iiifStoreName:rt="iiif",defaultState:nt={},extraMiddleware:it=[],customReducers:st={}}=tt,ot=combineReducers({[rt]:reducers,...st});return createStore$1(createBatchReducer(ot),nt,et?composeEnhancers(applyMiddleware(...it)):compose(applyMiddleware(...it)))}function mitt(tt){return{all:tt=tt||new Map,on:function(et,rt){var nt=tt.get(et);nt?nt.push(rt):tt.set(et,[rt])},off:function(et,rt){var nt=tt.get(et);nt&&(rt?nt.splice(nt.indexOf(rt)>>>0,1):tt.set(et,[]))},emit:function(et,rt){var nt=tt.get(et);nt&&nt.slice().map(function(it){it(rt)}),(nt=tt.get("*"))&&nt.slice().map(function(it){it(et,rt)})}}}class Vault{constructor(et,rt){eo(this,"options");eo(this,"store");eo(this,"emitter");eo(this,"isBatching",!1);eo(this,"batchQueue",[]);eo(this,"remoteFetcher");eo(this,"staticFetcher");eo(this,"defaultFetcher",et=>fetch(et).then(rt=>rt.json()));eo(this,"middleware",et=>rt=>nt=>{if(nt.type===BATCH_ACTIONS){for(const ot of nt.payload.actions)this.emitter.emit(ot.type,{realAction:ot,state:et.getState()});const st=rt(nt);for(const ot of nt.payload.actions)this.emitter.emit(`after:${nt.type}`,{action:nt,state:st});return st}this.emitter.emit(nt.type,{action:nt,state:et.getState()});const it=rt(nt);return this.emitter.emit(`after:${nt.type}`,{action:nt,state:it}),it});this.options=Object.assign({reducers:{},middleware:[],defaultState:{},customFetcher:this.defaultFetcher,enableDevtools:!0},et||{}),this.store=rt||createStore({customReducers:this.options.reducers,extraMiddleware:[...this.options.middleware,this.middleware],defaultState:this.options.defaultState,enableDevtools:this.options.enableDevtools}),this.emitter=mitt(),this.remoteFetcher=createFetchHelper(this.store,this.options.customFetcher),this.staticFetcher=createFetchHelper(this.store,(nt,it)=>it)}batch(et){this.isBatching=!0;try{et(this),this.store.dispatch(batchActions({actions:this.batchQueue}))}catch(rt){throw this.batchQueue=[],this.isBatching=!1,rt}this.batchQueue=[],this.isBatching=!1}async asyncBatch(et){this.isBatching=!0;try{await et(this),this.store.dispatch(batchActions({actions:this.batchQueue}))}catch(rt){throw this.batchQueue=[],this.isBatching=!1,rt}this.batchQueue=[],this.isBatching=!1}modifyEntityField(et,rt,nt){this.dispatch(entityActions.modifyEntityField({id:et.id,type:et.type,key:rt,value:nt}))}dispatch(et){this.isBatching?this.batchQueue.push(et):this.store.dispatch(et)}serialize(et,rt){return serialize(this.getState().iiif,et,rt)}toPresentation2(et){return this.serialize(et,serializeConfigPresentation2)}toPresentation3(et){return this.serialize(et,serializeConfigPresentation3)}hydrate(et,rt){return this.get(et,rt,{skipSelfReturn:!1})}get(et,rt,nt={}){typeof rt!="string"&&(nt=rt||{},rt=void 0);const{skipSelfReturn:it=!0}=nt||{};if(Array.isArray(et))return et.map(ct=>this.get(ct,nt));const st=this.getState();if(typeof et=="string"){const ct=rt||st.iiif.mapping[et];if(!ct)return it?null:{id:et,type:"unknown"};et={id:et,type:ct}}const ot=rt||et.type,lt=et.id,ut=st.iiif.entities[ot];if(!ut){const ct=st.iiif.requests[lt];return ct&&ct.resourceUri!==lt?this.get(ct.resourceUri,nt):it?null:et}return ut[et.id]||(it?null:et)}select(et){return et(this.getState())}getStore(){return this.store}getState(){return this.store.getState()}loadManifest(et,rt){const nt=typeof et=="string"?et:et.id;return this.load(nt,rt)}loadCollection(et,rt){const nt=typeof et=="string"?et:et.id;return this.load(nt,rt)}load(et,rt){const nt=typeof et=="string"?et:et.id;return rt?this.staticFetcher(nt,rt):this.remoteFetcher(nt)}areInputsEqual(et,rt){return areInputsEqual(et,rt)}subscribe(et,rt,nt){typeof nt>"u"&&(typeof rt>"u"||rt===!1||rt===!0)&&(nt=rt,rt=et,et=st=>st);let it=nt?null:et(this.store.getState());return nt||rt(it,this),this.store.subscribe(()=>{const st=this.store.getState(),ot=et(st);it!==ot&&!areInputsEqual(it,ot)&&rt(ot,this),it=ot})}async ensureLoaded(et){const rt=typeof et=="string"?et:et.id;this.requestStatus(rt)||await this.load(rt)}requestStatus(et){return this.select(rt=>rt.iiif.requests[et])}getResourceMeta(et,rt){const nt=this.getState().iiif.meta[et];if(nt)return rt?nt[rt]:nt}setMetaValue([et,rt,nt],it){this.dispatch(typeof it=="function"?metaActions.setMetaValueDynamic({id:et,meta:rt,key:nt,updateValue:it}):metaActions.setMetaValue({id:et,meta:rt,key:nt,value:it}))}}function _extends$1(){return _extends$1=Object.assign?Object.assign.bind():function(tt){for(var et=1;et<arguments.length;et++){var rt=arguments[et];for(var nt in rt)Object.prototype.hasOwnProperty.call(rt,nt)&&(tt[nt]=rt[nt])}return tt},_extends$1.apply(this,arguments)}function $e42e1063c40fb3ef$export$b9ecd428b558ff10(tt,et,{checkForDefaultPrevented:rt=!0}={}){return function(it){if(tt==null||tt(it),rt===!1||!it.defaultPrevented)return et==null?void 0:et(it)}}function $c512c27ab02ef895$export$50c7b4e9d9f19c1(tt,et=[]){let rt=[];function nt(st,ot){const lt=reactExports.createContext(ot),ut=rt.length;rt=[...rt,ot];function ct(pt){const{scope:ft,children:gt,..._r}=pt,Yr=(ft==null?void 0:ft[tt][ut])||lt,mt=reactExports.useMemo(()=>_r,Object.values(_r));return reactExports.createElement(Yr.Provider,{value:mt},gt)}function dt(pt,ft){const gt=(ft==null?void 0:ft[tt][ut])||lt,_r=reactExports.useContext(gt);if(_r)return _r;if(ot!==void 0)return ot;throw new Error(`\`${pt}\` must be used within \`${st}\``)}return ct.displayName=st+"Provider",[ct,dt]}const it=()=>{const st=rt.map(ot=>reactExports.createContext(ot));return function(lt){const ut=(lt==null?void 0:lt[tt])||st;return reactExports.useMemo(()=>({[`__scope${tt}`]:{...lt,[tt]:ut}}),[lt,ut])}};return it.scopeName=tt,[nt,$c512c27ab02ef895$var$composeContextScopes(it,...et)]}function $c512c27ab02ef895$var$composeContextScopes(...tt){const et=tt[0];if(tt.length===1)return et;const rt=()=>{const nt=tt.map(it=>({useScope:it(),scopeName:it.scopeName}));return function(st){const ot=nt.reduce((lt,{useScope:ut,scopeName:ct})=>{const pt=ut(st)[`__scope${ct}`];return{...lt,...pt}},{});return reactExports.useMemo(()=>({[`__scope${et.scopeName}`]:ot}),[ot])}};return rt.scopeName=et.scopeName,rt}function $b1b2314f5f9a1d84$export$25bec8c6f54ee79a(tt){const et=reactExports.useRef(tt);return reactExports.useEffect(()=>{et.current=tt}),reactExports.useMemo(()=>(...rt)=>{var nt;return(nt=et.current)===null||nt===void 0?void 0:nt.call(et,...rt)},[])}function $71cd76cc60e0454e$export$6f32135080cb4c3({prop:tt,defaultProp:et,onChange:rt=()=>{}}){const[nt,it]=$71cd76cc60e0454e$var$useUncontrolledState({defaultProp:et,onChange:rt}),st=tt!==void 0,ot=st?tt:nt,lt=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(rt),ut=reactExports.useCallback(ct=>{if(st){const pt=typeof ct=="function"?ct(tt):ct;pt!==tt&&lt(pt)}else it(ct)},[st,tt,it,lt]);return[ot,ut]}function $71cd76cc60e0454e$var$useUncontrolledState({defaultProp:tt,onChange:et}){const rt=reactExports.useState(tt),[nt]=rt,it=reactExports.useRef(nt),st=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(et);return reactExports.useEffect(()=>{it.current!==nt&&(st(nt),it.current=nt)},[nt,it,st]),rt}const $9f79659886946c16$export$e5c5a5f917a5871c=globalThis!=null&&globalThis.document?reactExports.useLayoutEffect:()=>{};function $6ed0406888f73fc4$var$setRef(tt,et){typeof tt=="function"?tt(et):tt!=null&&(tt.current=et)}function $6ed0406888f73fc4$export$43e446d32b3d21af(...tt){return et=>tt.forEach(rt=>$6ed0406888f73fc4$var$setRef(rt,et))}function $6ed0406888f73fc4$export$c7b2cbe3552a0d05(...tt){return reactExports.useCallback($6ed0406888f73fc4$export$43e446d32b3d21af(...tt),tt)}const $5e63c961fc1ce211$export$8c6ed5c666ac1360=reactExports.forwardRef((tt,et)=>{const{children:rt,...nt}=tt,it=reactExports.Children.toArray(rt),st=it.find($5e63c961fc1ce211$var$isSlottable);if(st){const ot=st.props.children,lt=it.map(ut=>ut===st?reactExports.Children.count(ot)>1?reactExports.Children.only(null):reactExports.isValidElement(ot)?ot.props.children:null:ut);return reactExports.createElement($5e63c961fc1ce211$var$SlotClone,_extends$1({},nt,{ref:et}),reactExports.isValidElement(ot)?reactExports.cloneElement(ot,void 0,lt):null)}return reactExports.createElement($5e63c961fc1ce211$var$SlotClone,_extends$1({},nt,{ref:et}),rt)});$5e63c961fc1ce211$export$8c6ed5c666ac1360.displayName="Slot";const $5e63c961fc1ce211$var$SlotClone=reactExports.forwardRef((tt,et)=>{const{children:rt,...nt}=tt;return reactExports.isValidElement(rt)?reactExports.cloneElement(rt,{...$5e63c961fc1ce211$var$mergeProps(nt,rt.props),ref:et?$6ed0406888f73fc4$export$43e446d32b3d21af(et,rt.ref):rt.ref}):reactExports.Children.count(rt)>1?reactExports.Children.only(null):null});$5e63c961fc1ce211$var$SlotClone.displayName="SlotClone";const $5e63c961fc1ce211$export$d9f1ccf0bdb05d45=({children:tt})=>reactExports.createElement(reactExports.Fragment,null,tt);function $5e63c961fc1ce211$var$isSlottable(tt){return reactExports.isValidElement(tt)&&tt.type===$5e63c961fc1ce211$export$d9f1ccf0bdb05d45}function $5e63c961fc1ce211$var$mergeProps(tt,et){const rt={...et};for(const nt in et){const it=tt[nt],st=et[nt];/^on[A-Z]/.test(nt)?it&&st?rt[nt]=(...lt)=>{st(...lt),it(...lt)}:it&&(rt[nt]=it):nt==="style"?rt[nt]={...it,...st}:nt==="className"&&(rt[nt]=[it,st].filter(Boolean).join(" "))}return{...tt,...rt}}const $8927f6f2acc4f386$var$NODES=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],$8927f6f2acc4f386$export$250ffa63cdc0d034=$8927f6f2acc4f386$var$NODES.reduce((tt,et)=>{const rt=reactExports.forwardRef((nt,it)=>{const{asChild:st,...ot}=nt,lt=st?$5e63c961fc1ce211$export$8c6ed5c666ac1360:et;return reactExports.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),reactExports.createElement(lt,_extends$1({},ot,{ref:it}))});return rt.displayName=`Primitive.${et}`,{...tt,[et]:rt}},{});function $8927f6f2acc4f386$export$6d1a0317bde7de7f(tt,et){tt&&reactDomExports.flushSync(()=>tt.dispatchEvent(et))}function $fe963b355347cc68$export$3e6543de14f8614f(tt,et){return reactExports.useReducer((rt,nt)=>{const it=et[rt][nt];return it??rt},tt)}const $921a889cee6df7e8$export$99c2b779aa4e8b8b=tt=>{const{present:et,children:rt}=tt,nt=$921a889cee6df7e8$var$usePresence(et),it=typeof rt=="function"?rt({present:nt.isPresent}):reactExports.Children.only(rt),st=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(nt.ref,it.ref);return typeof rt=="function"||nt.isPresent?reactExports.cloneElement(it,{ref:st}):null};$921a889cee6df7e8$export$99c2b779aa4e8b8b.displayName="Presence";function $921a889cee6df7e8$var$usePresence(tt){const[et,rt]=reactExports.useState(),nt=reactExports.useRef({}),it=reactExports.useRef(tt),st=reactExports.useRef("none"),ot=tt?"mounted":"unmounted",[lt,ut]=$fe963b355347cc68$export$3e6543de14f8614f(ot,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return reactExports.useEffect(()=>{const ct=$921a889cee6df7e8$var$getAnimationName(nt.current);st.current=lt==="mounted"?ct:"none"},[lt]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{const ct=nt.current,dt=it.current;if(dt!==tt){const ft=st.current,gt=$921a889cee6df7e8$var$getAnimationName(ct);tt?ut("MOUNT"):gt==="none"||(ct==null?void 0:ct.display)==="none"?ut("UNMOUNT"):ut(dt&&ft!==gt?"ANIMATION_OUT":"UNMOUNT"),it.current=tt}},[tt,ut]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{if(et){const ct=pt=>{const gt=$921a889cee6df7e8$var$getAnimationName(nt.current).includes(pt.animationName);pt.target===et&&gt&&reactDomExports.flushSync(()=>ut("ANIMATION_END"))},dt=pt=>{pt.target===et&&(st.current=$921a889cee6df7e8$var$getAnimationName(nt.current))};return et.addEventListener("animationstart",dt),et.addEventListener("animationcancel",ct),et.addEventListener("animationend",ct),()=>{et.removeEventListener("animationstart",dt),et.removeEventListener("animationcancel",ct),et.removeEventListener("animationend",ct)}}else ut("ANIMATION_END")},[et,ut]),{isPresent:["mounted","unmountSuspended"].includes(lt),ref:reactExports.useCallback(ct=>{ct&&(nt.current=getComputedStyle(ct)),rt(ct)},[])}}function $921a889cee6df7e8$var$getAnimationName(tt){return(tt==null?void 0:tt.animationName)||"none"}const $1746a345f3d73bb7$var$useReactId=$2AODx$react.useId||(()=>{});let $1746a345f3d73bb7$var$count=0;function $1746a345f3d73bb7$export$f680877a34711e37(tt){const[et,rt]=reactExports.useState($1746a345f3d73bb7$var$useReactId());return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{tt||rt(nt=>nt??String($1746a345f3d73bb7$var$count++))},[tt]),tt||(et?`radix-${et}`:"")}const $409067139f391064$var$COLLAPSIBLE_NAME="Collapsible",[$409067139f391064$var$createCollapsibleContext,$409067139f391064$export$952b32dcbe73087a]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($409067139f391064$var$COLLAPSIBLE_NAME),[$409067139f391064$var$CollapsibleProvider,$409067139f391064$var$useCollapsibleContext]=$409067139f391064$var$createCollapsibleContext($409067139f391064$var$COLLAPSIBLE_NAME),$409067139f391064$export$6eb0f7ddcda6131f=reactExports.forwardRef((tt,et)=>{const{__scopeCollapsible:rt,open:nt,defaultOpen:it,disabled:st,onOpenChange:ot,...lt}=tt,[ut=!1,ct]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:nt,defaultProp:it,onChange:ot});return reactExports.createElement($409067139f391064$var$CollapsibleProvider,{scope:rt,disabled:st,contentId:$1746a345f3d73bb7$export$f680877a34711e37(),open:ut,onOpenToggle:reactExports.useCallback(()=>ct(dt=>!dt),[ct])},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"data-state":$409067139f391064$var$getState(ut),"data-disabled":st?"":void 0},lt,{ref:et})))}),$409067139f391064$var$TRIGGER_NAME="CollapsibleTrigger",$409067139f391064$export$c135dce7b15bbbdc=reactExports.forwardRef((tt,et)=>{const{__scopeCollapsible:rt,...nt}=tt,it=$409067139f391064$var$useCollapsibleContext($409067139f391064$var$TRIGGER_NAME,rt);return reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button","aria-controls":it.contentId,"aria-expanded":it.open||!1,"data-state":$409067139f391064$var$getState(it.open),"data-disabled":it.disabled?"":void 0,disabled:it.disabled},nt,{ref:et,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onClick,it.onOpenToggle)}))}),$409067139f391064$var$CONTENT_NAME="CollapsibleContent",$409067139f391064$export$aadde00976f34151=reactExports.forwardRef((tt,et)=>{const{forceMount:rt,...nt}=tt,it=$409067139f391064$var$useCollapsibleContext($409067139f391064$var$CONTENT_NAME,tt.__scopeCollapsible);return reactExports.createElement($921a889cee6df7e8$export$99c2b779aa4e8b8b,{present:rt||it.open},({present:st})=>reactExports.createElement($409067139f391064$var$CollapsibleContentImpl,_extends$1({},nt,{ref:et,present:st})))}),$409067139f391064$var$CollapsibleContentImpl=reactExports.forwardRef((tt,et)=>{const{__scopeCollapsible:rt,present:nt,children:it,...st}=tt,ot=$409067139f391064$var$useCollapsibleContext($409067139f391064$var$CONTENT_NAME,rt),[lt,ut]=reactExports.useState(nt),ct=reactExports.useRef(null),dt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,ct),pt=reactExports.useRef(0),ft=pt.current,gt=reactExports.useRef(0),_r=gt.current,Yr=ot.open||lt,mt=reactExports.useRef(Yr),Kr=reactExports.useRef();return reactExports.useEffect(()=>{const Xr=requestAnimationFrame(()=>mt.current=!1);return()=>cancelAnimationFrame(Xr)},[]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{const Xr=ct.current;if(Xr){Kr.current=Kr.current||{transitionDuration:Xr.style.transitionDuration,animationName:Xr.style.animationName},Xr.style.transitionDuration="0s",Xr.style.animationName="none";const Zr=Xr.getBoundingClientRect();pt.current=Zr.height,gt.current=Zr.width,mt.current||(Xr.style.transitionDuration=Kr.current.transitionDuration,Xr.style.animationName=Kr.current.animationName),ut(nt)}},[ot.open,nt]),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"data-state":$409067139f391064$var$getState(ot.open),"data-disabled":ot.disabled?"":void 0,id:ot.contentId,hidden:!Yr},st,{ref:dt,style:{"--radix-collapsible-content-height":ft?`${ft}px`:void 0,"--radix-collapsible-content-width":_r?`${_r}px`:void 0,...tt.style}}),Yr&&it)});function $409067139f391064$var$getState(tt){return tt?"open":"closed"}const $409067139f391064$export$be92b6f5f03c0fe9=$409067139f391064$export$6eb0f7ddcda6131f,$409067139f391064$export$41fb9f06171c75f4=$409067139f391064$export$c135dce7b15bbbdc,$409067139f391064$export$7c6e2c02157bb7d2=$409067139f391064$export$aadde00976f34151,ErrorBoundaryContext=reactExports.createContext(null),initialState={didCatch:!1,error:null};class ErrorBoundary extends reactExports.Component{constructor(et){super(et),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=initialState}static getDerivedStateFromError(et){return{didCatch:!0,error:et}}resetErrorBoundary(){const{error:et}=this.state;if(et!==null){for(var rt,nt,it=arguments.length,st=new Array(it),ot=0;ot<it;ot++)st[ot]=arguments[ot];(rt=(nt=this.props).onReset)===null||rt===void 0||rt.call(nt,{args:st,reason:"imperative-api"}),this.setState(initialState)}}componentDidCatch(et,rt){var nt,it;(nt=(it=this.props).onError)===null||nt===void 0||nt.call(it,et,rt)}componentDidUpdate(et,rt){const{didCatch:nt}=this.state,{resetKeys:it}=this.props;if(nt&&rt.error!==null&&hasArrayChanged(et.resetKeys,it)){var st,ot;(st=(ot=this.props).onReset)===null||st===void 0||st.call(ot,{next:it,prev:et.resetKeys,reason:"keys"}),this.setState(initialState)}}render(){const{children:et,fallbackRender:rt,FallbackComponent:nt,fallback:it}=this.props,{didCatch:st,error:ot}=this.state;let lt=et;if(st){const ut={error:ot,resetErrorBoundary:this.resetErrorBoundary};if(typeof rt=="function")lt=rt(ut);else if(nt)lt=reactExports.createElement(nt,ut);else if(it===null||reactExports.isValidElement(it))lt=it;else throw ot}return reactExports.createElement(ErrorBoundaryContext.Provider,{value:{didCatch:st,error:ot,resetErrorBoundary:this.resetErrorBoundary}},lt)}}function hasArrayChanged(){let tt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],et=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return tt.length!==et.length||tt.some((rt,nt)=>!Object.is(rt,et[nt]))}var e="colors",t="sizes",r="space",n={gap:r,gridGap:r,columnGap:r,gridColumnGap:r,rowGap:r,gridRowGap:r,inset:r,insetBlock:r,insetBlockEnd:r,insetBlockStart:r,insetInline:r,insetInlineEnd:r,insetInlineStart:r,margin:r,marginTop:r,marginRight:r,marginBottom:r,marginLeft:r,marginBlock:r,marginBlockEnd:r,marginBlockStart:r,marginInline:r,marginInlineEnd:r,marginInlineStart:r,padding:r,paddingTop:r,paddingRight:r,paddingBottom:r,paddingLeft:r,paddingBlock:r,paddingBlockEnd:r,paddingBlockStart:r,paddingInline:r,paddingInlineEnd:r,paddingInlineStart:r,top:r,right:r,bottom:r,left:r,scrollMargin:r,scrollMarginTop:r,scrollMarginRight:r,scrollMarginBottom:r,scrollMarginLeft:r,scrollMarginX:r,scrollMarginY:r,scrollMarginBlock:r,scrollMarginBlockEnd:r,scrollMarginBlockStart:r,scrollMarginInline:r,scrollMarginInlineEnd:r,scrollMarginInlineStart:r,scrollPadding:r,scrollPaddingTop:r,scrollPaddingRight:r,scrollPaddingBottom:r,scrollPaddingLeft:r,scrollPaddingX:r,scrollPaddingY:r,scrollPaddingBlock:r,scrollPaddingBlockEnd:r,scrollPaddingBlockStart:r,scrollPaddingInline:r,scrollPaddingInlineEnd:r,scrollPaddingInlineStart:r,fontSize:"fontSizes",background:e,backgroundColor:e,backgroundImage:e,borderImage:e,border:e,borderBlock:e,borderBlockEnd:e,borderBlockStart:e,borderBottom:e,borderBottomColor:e,borderColor:e,borderInline:e,borderInlineEnd:e,borderInlineStart:e,borderLeft:e,borderLeftColor:e,borderRight:e,borderRightColor:e,borderTop:e,borderTopColor:e,caretColor:e,color:e,columnRuleColor:e,fill:e,outline:e,outlineColor:e,stroke:e,textDecorationColor:e,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:t,minBlockSize:t,maxBlockSize:t,inlineSize:t,minInlineSize:t,maxInlineSize:t,width:t,minWidth:t,maxWidth:t,height:t,minHeight:t,maxHeight:t,flexBasis:t,gridTemplateColumns:t,gridTemplateRows:t,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},i=(tt,et)=>typeof et=="function"?{"()":Function.prototype.toString.call(et)}:et,o=()=>{const tt=Object.create(null);return(et,rt,...nt)=>{const it=(st=>JSON.stringify(st,i))(et);return it in tt?tt[it]:tt[it]=rt(et,...nt)}},l=Symbol.for("sxs.internal"),s=(tt,et)=>Object.defineProperties(tt,Object.getOwnPropertyDescriptors(et)),a=tt=>{for(const et in tt)return!0;return!1},{hasOwnProperty:c}=Object.prototype,d=tt=>tt.includes("-")?tt:tt.replace(/[A-Z]/g,et=>"-"+et.toLowerCase()),g=/\s+(?![^()]*\))/,p=tt=>et=>tt(...typeof et=="string"?String(et).split(g):[et]),u={appearance:tt=>({WebkitAppearance:tt,appearance:tt}),backfaceVisibility:tt=>({WebkitBackfaceVisibility:tt,backfaceVisibility:tt}),backdropFilter:tt=>({WebkitBackdropFilter:tt,backdropFilter:tt}),backgroundClip:tt=>({WebkitBackgroundClip:tt,backgroundClip:tt}),boxDecorationBreak:tt=>({WebkitBoxDecorationBreak:tt,boxDecorationBreak:tt}),clipPath:tt=>({WebkitClipPath:tt,clipPath:tt}),content:tt=>({content:tt.includes('"')||tt.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(tt)?tt:`"${tt}"`}),hyphens:tt=>({WebkitHyphens:tt,hyphens:tt}),maskImage:tt=>({WebkitMaskImage:tt,maskImage:tt}),maskSize:tt=>({WebkitMaskSize:tt,maskSize:tt}),tabSize:tt=>({MozTabSize:tt,tabSize:tt}),textSizeAdjust:tt=>({WebkitTextSizeAdjust:tt,textSizeAdjust:tt}),userSelect:tt=>({WebkitUserSelect:tt,userSelect:tt}),marginBlock:p((tt,et)=>({marginBlockStart:tt,marginBlockEnd:et||tt})),marginInline:p((tt,et)=>({marginInlineStart:tt,marginInlineEnd:et||tt})),maxSize:p((tt,et)=>({maxBlockSize:tt,maxInlineSize:et||tt})),minSize:p((tt,et)=>({minBlockSize:tt,minInlineSize:et||tt})),paddingBlock:p((tt,et)=>({paddingBlockStart:tt,paddingBlockEnd:et||tt})),paddingInline:p((tt,et)=>({paddingInlineStart:tt,paddingInlineEnd:et||tt}))},h=/([\d.]+)([^]*)/,f=(tt,et)=>tt.length?tt.reduce((rt,nt)=>(rt.push(...et.map(it=>it.includes("&")?it.replace(/&/g,/[ +>|~]/.test(nt)&&/&.*&/.test(it)?`:is(${nt})`:nt):nt+" "+it)),rt),[]):et,m$1=(tt,et)=>tt in b&&typeof et=="string"?et.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,(rt,nt,it,st)=>nt+(it==="stretch"?`-moz-available${st};${d(tt)}:${nt}-webkit-fill-available`:`-moz-fit-content${st};${d(tt)}:${nt}fit-content`)+st):String(et),b={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},S$1=tt=>tt?tt+"-":"",k$1=(tt,et,rt)=>tt.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,(nt,it,st,ot,lt)=>ot=="$"==!!st?nt:(it||ot=="--"?"calc(":"")+"var(--"+(ot==="$"?S$1(et)+(lt.includes("$")?"":S$1(rt))+lt.replace(/\$/g,"-"):lt)+")"+(it||ot=="--"?"*"+(it||"")+(st||"1")+")":"")),y=/\s*,\s*(?![^()]*\))/,B=Object.prototype.toString,$=(tt,et,rt,nt,it)=>{let st,ot,lt;const ut=(ct,dt,pt)=>{let ft,gt;const _r=Yr=>{for(ft in Yr){const Xr=ft.charCodeAt(0)===64,Zr=Xr&&Array.isArray(Yr[ft])?Yr[ft]:[Yr[ft]];for(gt of Zr){const Qr=/[A-Z]/.test(Kr=ft)?Kr:Kr.replace(/-[^]/g,ns=>ns[1].toUpperCase()),_i=typeof gt=="object"&&gt&&gt.toString===B&&(!nt.utils[Qr]||!dt.length);if(Qr in nt.utils&&!_i){const ns=nt.utils[Qr];if(ns!==ot){ot=ns,_r(ns(gt)),ot=null;continue}}else if(Qr in u){const ns=u[Qr];if(ns!==lt){lt=ns,_r(ns(gt)),lt=null;continue}}if(Xr&&(mt=ft.slice(1)in nt.media?"@media "+nt.media[ft.slice(1)]:ft,ft=mt.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,(ns,rs,ss,hs,os,is)=>{const cs=h.test(rs),ps=.0625*(cs?-1:1),[vs,ls]=cs?[hs,rs]:[rs,hs];return"("+(ss[0]==="="?"":ss[0]===">"===cs?"max-":"min-")+vs+":"+(ss[0]!=="="&&ss.length===1?ls.replace(h,(ms,us,gs)=>Number(us)+ps*(ss===">"?1:-1)+gs):ls)+(os?") and ("+(os[0]===">"?"min-":"max-")+vs+":"+(os.length===1?is.replace(h,(ms,us,gs)=>Number(us)+ps*(os===">"?-1:1)+gs):is):"")+")"})),_i){const ns=Xr?pt.concat(ft):[...pt],rs=Xr?[...dt]:f(dt,ft.split(y));st!==void 0&&it(x$1(...st)),st=void 0,ut(gt,rs,ns)}else st===void 0&&(st=[[],dt,pt]),ft=Xr||ft.charCodeAt(0)!==36?ft:`--${S$1(nt.prefix)}${ft.slice(1).replace(/\$/g,"-")}`,gt=_i?gt:typeof gt=="number"?gt&&Qr in I?String(gt)+"px":String(gt):k$1(m$1(Qr,gt??""),nt.prefix,nt.themeMap[Qr]),st[0].push(`${Xr?`${ft} `:`${d(ft)}:`}${gt}`)}}var mt,Kr};_r(ct),st!==void 0&&it(x$1(...st)),st=void 0};ut(tt,et,rt)},x$1=(tt,et,rt)=>`${rt.map(nt=>`${nt}{`).join("")}${et.length?`${et.join(",")}{`:""}${tt.join(";")}${et.length?"}":""}${Array(rt.length?rt.length+1:0).join("}")}`,I={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},R$1=tt=>String.fromCharCode(tt+(tt>25?39:97)),z$1=tt=>(et=>{let rt,nt="";for(rt=Math.abs(et);rt>52;rt=rt/52|0)nt=R$1(rt%52)+nt;return R$1(rt%52)+nt})(((et,rt)=>{let nt=rt.length;for(;nt;)et=33*et^rt.charCodeAt(--nt);return et})(5381,JSON.stringify(tt))>>>0),W$1=["themed","global","styled","onevar","resonevar","allvar","inline"],j$1=tt=>{if(tt.href&&!tt.href.startsWith(location.origin))return!1;try{return!!tt.cssRules}catch{return!1}},E=tt=>{let et;const rt=()=>{const{cssRules:it}=et.sheet;return[].map.call(it,(st,ot)=>{const{cssText:lt}=st;let ut="";if(lt.startsWith("--sxs"))return"";if(it[ot-1]&&(ut=it[ot-1].cssText).startsWith("--sxs")){if(!st.cssRules.length)return"";for(const ct in et.rules)if(et.rules[ct].group===st)return`--sxs{--sxs:${[...et.rules[ct].cache].join(" ")}}${lt}`;return st.cssRules.length?`${ut}${lt}`:""}return lt}).join("")},nt=()=>{if(et){const{rules:lt,sheet:ut}=et;if(!ut.deleteRule){for(;Object(Object(ut.cssRules)[0]).type===3;)ut.cssRules.splice(0,1);ut.cssRules=[]}for(const ct in lt)delete lt[ct]}const it=Object(tt).styleSheets||[];for(const lt of it)if(j$1(lt)){for(let ut=0,ct=lt.cssRules;ct[ut];++ut){const dt=Object(ct[ut]);if(dt.type!==1)continue;const pt=Object(ct[ut+1]);if(pt.type!==4)continue;++ut;const{cssText:ft}=dt;if(!ft.startsWith("--sxs"))continue;const gt=ft.slice(14,-3).trim().split(/\s+/),_r=W$1[gt[0]];_r&&(et||(et={sheet:lt,reset:nt,rules:{},toString:rt}),et.rules[_r]={group:pt,index:ut,cache:new Set(gt)})}if(et)break}if(!et){const lt=(ut,ct)=>({type:ct,cssRules:[],insertRule(dt,pt){this.cssRules.splice(pt,0,lt(dt,{import:3,undefined:1}[(dt.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return ut==="@media{}"?`@media{${[].map.call(this.cssRules,dt=>dt.cssText).join("")}}`:ut}});et={sheet:tt?(tt.head||tt).appendChild(document.createElement("style")).sheet:lt("","text/css"),rules:{},reset:nt,toString:rt}}const{sheet:st,rules:ot}=et;for(let lt=W$1.length-1;lt>=0;--lt){const ut=W$1[lt];if(!ot[ut]){const ct=W$1[lt+1],dt=ot[ct]?ot[ct].index:st.cssRules.length;st.insertRule("@media{}",dt),st.insertRule(`--sxs{--sxs:${lt}}`,dt),ot[ut]={group:st.cssRules[dt+1],index:dt,cache:new Set([lt])}}v(ot[ut])}};return nt(),et},v=tt=>{const et=tt.group;let rt=et.cssRules.length;tt.apply=nt=>{try{et.insertRule(nt,rt),++rt}catch{}}},T$1=Symbol(),w=o(),M=(tt,et)=>w(tt,()=>(...rt)=>{let nt={type:null,composers:new Set};for(const it of rt)if(it!=null)if(it[l]){nt.type==null&&(nt.type=it[l].type);for(const st of it[l].composers)nt.composers.add(st)}else it.constructor!==Object||it.$$typeof?nt.type==null&&(nt.type=it):nt.composers.add(C(it,tt));return nt.type==null&&(nt.type="span"),nt.composers.size||nt.composers.add(["PJLV",{},[],[],{},[]]),P(tt,nt,et)}),C=({variants:tt,compoundVariants:et,defaultVariants:rt,...nt},it)=>{const st=`${S$1(it.prefix)}c-${z$1(nt)}`,ot=[],lt=[],ut=Object.create(null),ct=[];for(const ft in rt)ut[ft]=String(rt[ft]);if(typeof tt=="object"&&tt)for(const ft in tt){dt=ut,pt=ft,c.call(dt,pt)||(ut[ft]="undefined");const gt=tt[ft];for(const _r in gt){const Yr={[ft]:String(_r)};String(_r)==="undefined"&&ct.push(ft);const mt=gt[_r],Kr=[Yr,mt,!a(mt)];ot.push(Kr)}}var dt,pt;if(typeof et=="object"&&et)for(const ft of et){let{css:gt,..._r}=ft;gt=typeof gt=="object"&&gt||{};for(const mt in _r)_r[mt]=String(_r[mt]);const Yr=[_r,gt,!a(gt)];lt.push(Yr)}return[st,nt,ot,lt,ut,ct]},P=(tt,et,rt)=>{const[nt,it,st,ot]=L$1(et.composers),lt=typeof et.type=="function"||et.type.$$typeof?(pt=>{function ft(){for(let gt=0;gt<ft[T$1].length;gt++){const[_r,Yr]=ft[T$1][gt];pt.rules[_r].apply(Yr)}return ft[T$1]=[],null}return ft[T$1]=[],ft.rules={},W$1.forEach(gt=>ft.rules[gt]={apply:_r=>ft[T$1].push([gt,_r])}),ft})(rt):null,ut=(lt||rt).rules,ct=`.${nt}${it.length>1?`:where(.${it.slice(1).join(".")})`:""}`,dt=pt=>{pt=typeof pt=="object"&&pt||A;const{css:ft,...gt}=pt,_r={};for(const Kr in st)if(delete gt[Kr],Kr in pt){let Xr=pt[Kr];typeof Xr=="object"&&Xr?_r[Kr]={"@initial":st[Kr],...Xr}:(Xr=String(Xr),_r[Kr]=Xr!=="undefined"||ot.has(Kr)?Xr:st[Kr])}else _r[Kr]=st[Kr];const Yr=new Set([...it]);for(const[Kr,Xr,Zr,Qr]of et.composers){rt.rules.styled.cache.has(Kr)||(rt.rules.styled.cache.add(Kr),$(Xr,[`.${Kr}`],[],tt,rs=>{ut.styled.apply(rs)}));const _i=O$1(Zr,_r,tt.media),ns=O$1(Qr,_r,tt.media,!0);for(const rs of _i)if(rs!==void 0)for(const[ss,hs,os]of rs){const is=`${Kr}-${z$1(hs)}-${ss}`;Yr.add(is);const cs=(os?rt.rules.resonevar:rt.rules.onevar).cache,ps=os?ut.resonevar:ut.onevar;cs.has(is)||(cs.add(is),$(hs,[`.${is}`],[],tt,vs=>{ps.apply(vs)}))}for(const rs of ns)if(rs!==void 0)for(const[ss,hs]of rs){const os=`${Kr}-${z$1(hs)}-${ss}`;Yr.add(os),rt.rules.allvar.cache.has(os)||(rt.rules.allvar.cache.add(os),$(hs,[`.${os}`],[],tt,is=>{ut.allvar.apply(is)}))}}if(typeof ft=="object"&&ft){const Kr=`${nt}-i${z$1(ft)}-css`;Yr.add(Kr),rt.rules.inline.cache.has(Kr)||(rt.rules.inline.cache.add(Kr),$(ft,[`.${Kr}`],[],tt,Xr=>{ut.inline.apply(Xr)}))}for(const Kr of String(pt.className||"").trim().split(/\s+/))Kr&&Yr.add(Kr);const mt=gt.className=[...Yr].join(" ");return{type:et.type,className:mt,selector:ct,props:gt,toString:()=>mt,deferredInjector:lt}};return s(dt,{className:nt,selector:ct,[l]:et,toString:()=>(rt.rules.styled.cache.has(nt)||dt(),nt)})},L$1=tt=>{let et="";const rt=[],nt={},it=[];for(const[st,,,,ot,lt]of tt){et===""&&(et=st),rt.push(st),it.push(...lt);for(const ut in ot){const ct=ot[ut];(nt[ut]===void 0||ct!=="undefined"||lt.includes(ct))&&(nt[ut]=ct)}}return[et,rt,nt,new Set(it)]},O$1=(tt,et,rt,nt)=>{const it=[];e:for(let[st,ot,lt]of tt){if(lt)continue;let ut,ct=0,dt=!1;for(ut in st){const pt=st[ut];let ft=et[ut];if(ft!==pt){if(typeof ft!="object"||!ft)continue e;{let gt,_r,Yr=0;for(const mt in ft){if(pt===String(ft[mt])){if(mt!=="@initial"){const Kr=mt.slice(1);(_r=_r||[]).push(Kr in rt?rt[Kr]:mt.replace(/^@media ?/,"")),dt=!0}ct+=Yr,gt=!0}++Yr}if(_r&&_r.length&&(ot={["@media "+_r.join(", ")]:ot}),!gt)continue e}}}(it[ct]=it[ct]||[]).push([nt?"cv":`${ut}-${st[ut]}`,ot,dt])}return it},A={},N$1=o(),D$1=(tt,et)=>N$1(tt,()=>(...rt)=>{const nt=()=>{for(let it of rt){it=typeof it=="object"&&it||{};let st=z$1(it);if(!et.rules.global.cache.has(st)){if(et.rules.global.cache.add(st),"@import"in it){let ot=[].indexOf.call(et.sheet.cssRules,et.rules.themed.group)-1;for(let lt of[].concat(it["@import"]))lt=lt.includes('"')||lt.includes("'")?lt:`"${lt}"`,et.sheet.insertRule(`@import ${lt};`,ot++);delete it["@import"]}$(it,[],[],tt,ot=>{et.rules.global.apply(ot)})}}return""};return s(nt,{toString:nt})}),H=o(),V=(tt,et)=>H(tt,()=>rt=>{const nt=`${S$1(tt.prefix)}k-${z$1(rt)}`,it=()=>{if(!et.rules.global.cache.has(nt)){et.rules.global.cache.add(nt);const st=[];$(rt,[],[],tt,lt=>st.push(lt));const ot=`@keyframes ${nt}{${st.join("")}}`;et.rules.global.apply(ot)}return nt};return s(it,{get name(){return it()},toString:it})}),G=class{constructor(tt,et,rt,nt){this.token=tt==null?"":String(tt),this.value=et==null?"":String(et),this.scale=rt==null?"":String(rt),this.prefix=nt==null?"":String(nt)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+S$1(this.prefix)+S$1(this.scale)+this.token}toString(){return this.computedValue}},F=o(),J$1=(tt,et)=>F(tt,()=>(rt,nt)=>{nt=typeof rt=="object"&&rt||Object(nt);const it=`.${rt=(rt=typeof rt=="string"?rt:"")||`${S$1(tt.prefix)}t-${z$1(nt)}`}`,st={},ot=[];for(const ut in nt){st[ut]={};for(const ct in nt[ut]){const dt=`--${S$1(tt.prefix)}${ut}-${ct}`,pt=k$1(String(nt[ut][ct]),tt.prefix,ut);st[ut][ct]=new G(ct,pt,ut,tt.prefix),ot.push(`${dt}:${pt}`)}}const lt=()=>{if(ot.length&&!et.rules.themed.cache.has(rt)){et.rules.themed.cache.add(rt);const ut=`${nt===tt.theme?":root,":""}.${rt}{${ot.join(";")}}`;et.rules.themed.apply(ut)}return rt};return{...st,get className(){return lt()},selector:it,toString:lt}}),U=o(),X$1,Y$1=o(),q=tt=>{const et=(rt=>{let nt=!1;const it=U(rt,st=>{nt=!0;const ot="prefix"in(st=typeof st=="object"&&st||{})?String(st.prefix):"",lt=typeof st.media=="object"&&st.media||{},ut=typeof st.root=="object"?st.root||null:globalThis.document||null,ct=typeof st.theme=="object"&&st.theme||{},dt={prefix:ot,media:lt,theme:ct,themeMap:typeof st.themeMap=="object"&&st.themeMap||{...n},utils:typeof st.utils=="object"&&st.utils||{}},pt=E(ut),ft={css:M(dt,pt),globalCss:D$1(dt,pt),keyframes:V(dt,pt),createTheme:J$1(dt,pt),reset(){pt.reset(),ft.theme.toString()},theme:{},sheet:pt,config:dt,prefix:ot,getCssText:pt.toString,toString:pt.toString};return String(ft.theme=ft.createTheme(ct)),ft});return nt||it.reset(),it})(tt);return et.styled=(({config:rt,sheet:nt})=>Y$1(rt,()=>{const it=M(rt,nt);return(...st)=>{const ot=it(...st),lt=ot[l].type,ut=e$1.forwardRef((ct,dt)=>{const pt=ct&&ct.as||lt,{props:ft,deferredInjector:gt}=ot(ct);return delete ft.as,ft.ref=dt,gt?e$1.createElement(e$1.Fragment,null,e$1.createElement(pt,ft),e$1.createElement(gt,null)):e$1.createElement(pt,ft)});return ut.className=ot.className,ut.displayName=`Styled.${lt.displayName||lt.name||lt}`,ut.selector=ot.selector,ut.toString=()=>ot.selector,ut[l]=ot[l],ut}}))(et),et},K$1=()=>X$1||(X$1=q()),Q$1=(...tt)=>K$1().createTheme(...tt);function $e02a7d9cb1dc128c$export$c74125a8e3af6bb2(tt){const et=tt+"CollectionProvider",[rt,nt]=$c512c27ab02ef895$export$50c7b4e9d9f19c1(et),[it,st]=rt(et,{collectionRef:{current:null},itemMap:new Map}),ot=gt=>{const{scope:_r,children:Yr}=gt,mt=e$1.useRef(null),Kr=e$1.useRef(new Map).current;return e$1.createElement(it,{scope:_r,itemMap:Kr,collectionRef:mt},Yr)},lt=tt+"CollectionSlot",ut=e$1.forwardRef((gt,_r)=>{const{scope:Yr,children:mt}=gt,Kr=st(lt,Yr),Xr=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(_r,Kr.collectionRef);return e$1.createElement($5e63c961fc1ce211$export$8c6ed5c666ac1360,{ref:Xr},mt)}),ct=tt+"CollectionItemSlot",dt="data-radix-collection-item",pt=e$1.forwardRef((gt,_r)=>{const{scope:Yr,children:mt,...Kr}=gt,Xr=e$1.useRef(null),Zr=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(_r,Xr),Qr=st(ct,Yr);return e$1.useEffect(()=>(Qr.itemMap.set(Xr,{ref:Xr,...Kr}),()=>void Qr.itemMap.delete(Xr))),e$1.createElement($5e63c961fc1ce211$export$8c6ed5c666ac1360,{[dt]:"",ref:Zr},mt)});function ft(gt){const _r=st(tt+"CollectionConsumer",gt);return e$1.useCallback(()=>{const mt=_r.collectionRef.current;if(!mt)return[];const Kr=Array.from(mt.querySelectorAll(`[${dt}]`));return Array.from(_r.itemMap.values()).sort((Qr,_i)=>Kr.indexOf(Qr.ref.current)-Kr.indexOf(_i.ref.current))},[_r.collectionRef,_r.itemMap])}return[{Provider:ot,Slot:ut,ItemSlot:pt},ft,nt]}const $f631663db3294ace$var$DirectionContext=reactExports.createContext(void 0);function $f631663db3294ace$export$b39126d51d94e6f3(tt){const et=reactExports.useContext($f631663db3294ace$var$DirectionContext);return tt||et||"ltr"}const $d7bdfb9eb0fdf311$var$ENTRY_FOCUS="rovingFocusGroup.onEntryFocus",$d7bdfb9eb0fdf311$var$EVENT_OPTIONS={bubbles:!1,cancelable:!0},$d7bdfb9eb0fdf311$var$GROUP_NAME="RovingFocusGroup",[$d7bdfb9eb0fdf311$var$Collection,$d7bdfb9eb0fdf311$var$useCollection,$d7bdfb9eb0fdf311$var$createCollectionScope]=$e02a7d9cb1dc128c$export$c74125a8e3af6bb2($d7bdfb9eb0fdf311$var$GROUP_NAME),[$d7bdfb9eb0fdf311$var$createRovingFocusGroupContext,$d7bdfb9eb0fdf311$export$c7109489551a4f4]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($d7bdfb9eb0fdf311$var$GROUP_NAME,[$d7bdfb9eb0fdf311$var$createCollectionScope]),[$d7bdfb9eb0fdf311$var$RovingFocusProvider,$d7bdfb9eb0fdf311$var$useRovingFocusContext]=$d7bdfb9eb0fdf311$var$createRovingFocusGroupContext($d7bdfb9eb0fdf311$var$GROUP_NAME),$d7bdfb9eb0fdf311$export$8699f7c8af148338=reactExports.forwardRef((tt,et)=>reactExports.createElement($d7bdfb9eb0fdf311$var$Collection.Provider,{scope:tt.__scopeRovingFocusGroup},reactExports.createElement($d7bdfb9eb0fdf311$var$Collection.Slot,{scope:tt.__scopeRovingFocusGroup},reactExports.createElement($d7bdfb9eb0fdf311$var$RovingFocusGroupImpl,_extends$1({},tt,{ref:et}))))),$d7bdfb9eb0fdf311$var$RovingFocusGroupImpl=reactExports.forwardRef((tt,et)=>{const{__scopeRovingFocusGroup:rt,orientation:nt,loop:it=!1,dir:st,currentTabStopId:ot,defaultCurrentTabStopId:lt,onCurrentTabStopIdChange:ut,onEntryFocus:ct,...dt}=tt,pt=reactExports.useRef(null),ft=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,pt),gt=$f631663db3294ace$export$b39126d51d94e6f3(st),[_r=null,Yr]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:ot,defaultProp:lt,onChange:ut}),[mt,Kr]=reactExports.useState(!1),Xr=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(ct),Zr=$d7bdfb9eb0fdf311$var$useCollection(rt),Qr=reactExports.useRef(!1),[_i,ns]=reactExports.useState(0);return reactExports.useEffect(()=>{const rs=pt.current;if(rs)return rs.addEventListener($d7bdfb9eb0fdf311$var$ENTRY_FOCUS,Xr),()=>rs.removeEventListener($d7bdfb9eb0fdf311$var$ENTRY_FOCUS,Xr)},[Xr]),reactExports.createElement($d7bdfb9eb0fdf311$var$RovingFocusProvider,{scope:rt,orientation:nt,dir:gt,loop:it,currentTabStopId:_r,onItemFocus:reactExports.useCallback(rs=>Yr(rs),[Yr]),onItemShiftTab:reactExports.useCallback(()=>Kr(!0),[]),onFocusableItemAdd:reactExports.useCallback(()=>ns(rs=>rs+1),[]),onFocusableItemRemove:reactExports.useCallback(()=>ns(rs=>rs-1),[])},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({tabIndex:mt||_i===0?-1:0,"data-orientation":nt},dt,{ref:ft,style:{outline:"none",...tt.style},onMouseDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onMouseDown,()=>{Qr.current=!0}),onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onFocus,rs=>{const ss=!Qr.current;if(rs.target===rs.currentTarget&&ss&&!mt){const hs=new CustomEvent($d7bdfb9eb0fdf311$var$ENTRY_FOCUS,$d7bdfb9eb0fdf311$var$EVENT_OPTIONS);if(rs.currentTarget.dispatchEvent(hs),!hs.defaultPrevented){const os=Zr().filter(ls=>ls.focusable),is=os.find(ls=>ls.active),cs=os.find(ls=>ls.id===_r),vs=[is,cs,...os].filter(Boolean).map(ls=>ls.ref.current);$d7bdfb9eb0fdf311$var$focusFirst(vs)}}Qr.current=!1}),onBlur:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onBlur,()=>Kr(!1))})))}),$d7bdfb9eb0fdf311$var$ITEM_NAME="RovingFocusGroupItem",$d7bdfb9eb0fdf311$export$ab9df7c53fe8454=reactExports.forwardRef((tt,et)=>{const{__scopeRovingFocusGroup:rt,focusable:nt=!0,active:it=!1,tabStopId:st,...ot}=tt,lt=$1746a345f3d73bb7$export$f680877a34711e37(),ut=st||lt,ct=$d7bdfb9eb0fdf311$var$useRovingFocusContext($d7bdfb9eb0fdf311$var$ITEM_NAME,rt),dt=ct.currentTabStopId===ut,pt=$d7bdfb9eb0fdf311$var$useCollection(rt),{onFocusableItemAdd:ft,onFocusableItemRemove:gt}=ct;return reactExports.useEffect(()=>{if(nt)return ft(),()=>gt()},[nt,ft,gt]),reactExports.createElement($d7bdfb9eb0fdf311$var$Collection.ItemSlot,{scope:rt,id:ut,focusable:nt,active:it},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({tabIndex:dt?0:-1,"data-orientation":ct.orientation},ot,{ref:et,onMouseDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onMouseDown,_r=>{nt?ct.onItemFocus(ut):_r.preventDefault()}),onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onFocus,()=>ct.onItemFocus(ut)),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onKeyDown,_r=>{if(_r.key==="Tab"&&_r.shiftKey){ct.onItemShiftTab();return}if(_r.target!==_r.currentTarget)return;const Yr=$d7bdfb9eb0fdf311$var$getFocusIntent(_r,ct.orientation,ct.dir);if(Yr!==void 0){_r.preventDefault();let Kr=pt().filter(Xr=>Xr.focusable).map(Xr=>Xr.ref.current);if(Yr==="last")Kr.reverse();else if(Yr==="prev"||Yr==="next"){Yr==="prev"&&Kr.reverse();const Xr=Kr.indexOf(_r.currentTarget);Kr=ct.loop?$d7bdfb9eb0fdf311$var$wrapArray(Kr,Xr+1):Kr.slice(Xr+1)}setTimeout(()=>$d7bdfb9eb0fdf311$var$focusFirst(Kr))}})})))}),$d7bdfb9eb0fdf311$var$MAP_KEY_TO_FOCUS_INTENT={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function $d7bdfb9eb0fdf311$var$getDirectionAwareKey(tt,et){return et!=="rtl"?tt:tt==="ArrowLeft"?"ArrowRight":tt==="ArrowRight"?"ArrowLeft":tt}function $d7bdfb9eb0fdf311$var$getFocusIntent(tt,et,rt){const nt=$d7bdfb9eb0fdf311$var$getDirectionAwareKey(tt.key,rt);if(!(et==="vertical"&&["ArrowLeft","ArrowRight"].includes(nt))&&!(et==="horizontal"&&["ArrowUp","ArrowDown"].includes(nt)))return $d7bdfb9eb0fdf311$var$MAP_KEY_TO_FOCUS_INTENT[nt]}function $d7bdfb9eb0fdf311$var$focusFirst(tt){const et=document.activeElement;for(const rt of tt)if(rt===et||(rt.focus(),document.activeElement!==et))return}function $d7bdfb9eb0fdf311$var$wrapArray(tt,et){return tt.map((rt,nt)=>tt[(et+nt)%tt.length])}const $d7bdfb9eb0fdf311$export$be92b6f5f03c0fe9=$d7bdfb9eb0fdf311$export$8699f7c8af148338,$d7bdfb9eb0fdf311$export$6d08773d2e66f8f2=$d7bdfb9eb0fdf311$export$ab9df7c53fe8454,$69cb30bb0017df05$var$TABS_NAME="Tabs",[$69cb30bb0017df05$var$createTabsContext,$69cb30bb0017df05$export$355f5bd209d7b13a]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($69cb30bb0017df05$var$TABS_NAME,[$d7bdfb9eb0fdf311$export$c7109489551a4f4]),$69cb30bb0017df05$var$useRovingFocusGroupScope=$d7bdfb9eb0fdf311$export$c7109489551a4f4(),[$69cb30bb0017df05$var$TabsProvider,$69cb30bb0017df05$var$useTabsContext]=$69cb30bb0017df05$var$createTabsContext($69cb30bb0017df05$var$TABS_NAME),$69cb30bb0017df05$export$b2539bed5023c21c=reactExports.forwardRef((tt,et)=>{const{__scopeTabs:rt,value:nt,onValueChange:it,defaultValue:st,orientation:ot="horizontal",dir:lt,activationMode:ut="automatic",...ct}=tt,dt=$f631663db3294ace$export$b39126d51d94e6f3(lt),[pt,ft]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:nt,onChange:it,defaultProp:st});return reactExports.createElement($69cb30bb0017df05$var$TabsProvider,{scope:rt,baseId:$1746a345f3d73bb7$export$f680877a34711e37(),value:pt,onValueChange:ft,orientation:ot,dir:dt,activationMode:ut},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({dir:dt,"data-orientation":ot},ct,{ref:et})))}),$69cb30bb0017df05$var$TAB_LIST_NAME="TabsList",$69cb30bb0017df05$export$9712d22edc0d78c1=reactExports.forwardRef((tt,et)=>{const{__scopeTabs:rt,loop:nt=!0,...it}=tt,st=$69cb30bb0017df05$var$useTabsContext($69cb30bb0017df05$var$TAB_LIST_NAME,rt),ot=$69cb30bb0017df05$var$useRovingFocusGroupScope(rt);return reactExports.createElement($d7bdfb9eb0fdf311$export$be92b6f5f03c0fe9,_extends$1({asChild:!0},ot,{orientation:st.orientation,dir:st.dir,loop:nt}),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({role:"tablist","aria-orientation":st.orientation},it,{ref:et})))}),$69cb30bb0017df05$var$TRIGGER_NAME="TabsTrigger",$69cb30bb0017df05$export$8114b9fdfdf9f3ba=reactExports.forwardRef((tt,et)=>{const{__scopeTabs:rt,value:nt,disabled:it=!1,...st}=tt,ot=$69cb30bb0017df05$var$useTabsContext($69cb30bb0017df05$var$TRIGGER_NAME,rt),lt=$69cb30bb0017df05$var$useRovingFocusGroupScope(rt),ut=$69cb30bb0017df05$var$makeTriggerId(ot.baseId,nt),ct=$69cb30bb0017df05$var$makeContentId(ot.baseId,nt),dt=nt===ot.value;return reactExports.createElement($d7bdfb9eb0fdf311$export$6d08773d2e66f8f2,_extends$1({asChild:!0},lt,{focusable:!it,active:dt}),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button",role:"tab","aria-selected":dt,"aria-controls":ct,"data-state":dt?"active":"inactive","data-disabled":it?"":void 0,disabled:it,id:ut},st,{ref:et,onMouseDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onMouseDown,pt=>{!it&&pt.button===0&&pt.ctrlKey===!1?ot.onValueChange(nt):pt.preventDefault()}),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onKeyDown,pt=>{[" ","Enter"].includes(pt.key)&&ot.onValueChange(nt)}),onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onFocus,()=>{const pt=ot.activationMode!=="manual";!dt&&!it&&pt&&ot.onValueChange(nt)})})))}),$69cb30bb0017df05$var$CONTENT_NAME="TabsContent",$69cb30bb0017df05$export$bd905d70e8fd2ebb=reactExports.forwardRef((tt,et)=>{const{__scopeTabs:rt,value:nt,forceMount:it,children:st,...ot}=tt,lt=$69cb30bb0017df05$var$useTabsContext($69cb30bb0017df05$var$CONTENT_NAME,rt),ut=$69cb30bb0017df05$var$makeTriggerId(lt.baseId,nt),ct=$69cb30bb0017df05$var$makeContentId(lt.baseId,nt),dt=nt===lt.value,pt=reactExports.useRef(dt);return reactExports.useEffect(()=>{const ft=requestAnimationFrame(()=>pt.current=!1);return()=>cancelAnimationFrame(ft)},[]),reactExports.createElement($921a889cee6df7e8$export$99c2b779aa4e8b8b,{present:it||dt},({present:ft})=>reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"data-state":dt?"active":"inactive","data-orientation":lt.orientation,role:"tabpanel","aria-labelledby":ut,hidden:!ft,id:ct,tabIndex:0},ot,{ref:et,style:{...tt.style,animationDuration:pt.current?"0s":void 0}}),ft&&st))});function $69cb30bb0017df05$var$makeTriggerId(tt,et){return`${tt}-trigger-${et}`}function $69cb30bb0017df05$var$makeContentId(tt,et){return`${tt}-content-${et}`}const $69cb30bb0017df05$export$be92b6f5f03c0fe9=$69cb30bb0017df05$export$b2539bed5023c21c,$69cb30bb0017df05$export$54c2e3dc7acea9f5=$69cb30bb0017df05$export$9712d22edc0d78c1,$69cb30bb0017df05$export$41fb9f06171c75f4=$69cb30bb0017df05$export$8114b9fdfdf9f3ba,$69cb30bb0017df05$export$7c6e2c02157bb7d2=$69cb30bb0017df05$export$bd905d70e8fd2ebb;var lib$5={},Parser$3={},Tokenizer={},decode={},decodeDataHtml={};Object.defineProperty(decodeDataHtml,"__esModule",{value:!0});decodeDataHtml.default=new Uint16Array('<\0\0\0\0\0\0EMabcfglmnoprstu\\bfmsligP&cutereve;iyx}rc;r;ravepha;acr;d;gpon;f;plyFunction;ingcsr;ign;ildemlaceforsucrkslash;;ed;y;crtause;noullis;a;r;pf;eve;cmpeq;HOacdefhilorsucy;PYcpyute;;italDifferentialD;leys;aeioron;dilrc;nint;ot;dnilla;terDot;i;rcleDMPTot;inus;lus;imes;ocskwiseContourIntegral;eCurlyDQoubleQuote;uote;lnpuon;e;gitruent;nt;ourIntegral;fr;oduct;nterClockwiseContourIntegral;oss;cr;p;Cap;DJSZacefios;otrahd;cy;cy;cy;grsger;r;hv;ayron;;l;ta;r;afcmriticalADGTcute;o;bleAcute;rave;ilde;ond;ferentialD;\0\0\0\0f;;DEot;qual;bleCDLRUVontourIntegrao\0\0nArrow;eoftARTrrow;ightArrow;engLReftARrrow;ightArrow;ightArrow;ightATrrow;ee;p\0\0rrow;ownArrow;erticalBar;nABLRTarrow;BUar;pArrow;reve;eft\0\0ightVector;eeVector;ector;Bar;ight\0eeVector;ector;Bar;ee;Arrow;ctr;rok;NTacdfglmopqstuxG;Hcuteaiyron;rc;ot;r;raveement;apcr;ty\0\0mallSquare;erySmallSquare;gpon;f;silon;uail;Tilde;librium;cir;m;a;mlipsts;onentialE;cfiosy;r;lled\0\0mallSquare;erySmallSquare;\0\0\0f;All;riertrf;cJTabcdfgorstcy;>mma;d;reve;eiydil;rc;;ot;r;;pf;eaterEFGLSTqual;Less;ullEqual;reater;ess;lantEqual;ilde;cr;;AacfiosuRDcy;ctek;;irc;r;lbertSpace;\0f;izontalLine;ctrok;mpownHumqual;EJOacdfgmnostucy;lig;cy;cuteiyrc;ot;r;rave;apcgr;inaryI;lie\0;egrral;section;isibleCTomma;imes;gpton;f;a;cr;ilde;\0cy;lcfosuiyrc;;r;pf;\0r;rcy;kcy;HJacfoscy;cy;ppa;eydil;;r;pf;cr;JTaceflmostcy;<cmnprute;bda;g;lacetrf;r;aeyron;dil;;fstACDFRTUVarnrgleBracket;row;BRar;ightArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ightAVrrow;ector;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;ightsEFGLSTqualGreater;ullEqual;reater;ess;lantEqual;ilde;r;;eftarrow;idot;npwgLRlreftARrrow;ightArrow;ightArrow;eftarightightf;erLReftArrow;ightArrow;cht;rok;;acefiosup;y;dliumSpace;lintrf;r;nusPlus;pf;c;Jacefostucy;cute;aeyron;dil;;gswativeMTVediumSpace;hicneryThitedGLreaterGreateessLesLine;r;Bnptreak;BreakingSpace;f;;CDEGHLNPRSTVoungruent;pCap;oubleVerticalBar;lqxement;ual;Tilde;ists;reater;EFGLSTqual;ullEqual;reater;ess;lantEqual;ilde;umpownHump;qual;efstTriangle;BEar;qual;s;EGLSTqual;reater;ess;lantEqual;ilde;estedGLreaterGreater;essLess;recedes;ESqual;lantEqual;eiverseElement;ghtTriangle;BEar;qual;quuareSubpset;Equal;erset;Equal;bcpset;Equal;ceeds;ESTqual;lantEqual;ilde;erset;Equal;ilde;EFTqual;ullEqual;ilde;erticalBar;cr;ilde;Eacdfgmoprstuvlig;cuteiyrc;blac;r;raveaeicr;ga;cron;pf;enCurlyDQoubleQuote;uote;;clr;ashidees;mlerBParr;acek;et;arenthesis;acfhilorsrtialD;y;r;i;;usMinus;ipncareplanf;;eiocedes;ESTqual;lantEqual;ilde;me;dpuct;ortion;al;cir;;UfosOT"r;pf;cr;BEacefhiorsuarr;Gcnrute;g;r;tl;aeyron;dil;;;verseEUlqement;uilibrium;pEquilibrium;ro;ghtACDFTUVanrgleBracket;row;BLar;eftArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;puf;ndImplies;ightarrow;chr;;leDelayed;HOacfhimoqstuCcHcy;y;FTcy;cute;;aeiyron;dil;rc;;r;ortDLRUownArroweftArrowightArrowpArrow;gma;allCircle;pf;\0\0t;are;ISUntersection;ubpset;Equal;erset;Equal;nion;cr;ar;bcmp;set;Equal;cheeds;ESTqual;lantEqual;ilde;Th;;esrset;Equal;etHRSacfhiorsORNADE;Hccy;y;bu;;aeyron;dil;;r;ei\0efore;a;cnkSpace;Space;lde;EFTqual;ullEqual;ilde;pf;ipleDot;ctr;rok;\0\0\0\0\0\0\0cruter;ocir;r\0y;ve;iyrc;blac;r;raveacr;dierBParr;acek;et;arenthesis;on;Plus;gpon;f;ADETadpsrrow;BDar;ownArrow;ownArrow;quilibrium;ee;Arrow;ownerLReftArrow;ightArrow;i;lon;ing;cr;ilde;mlDbcdefosvash;ar;y;ash;l;er;btyar;;icalBLSTar;ine;eparator;ilde;ThinSpace;r;pf;cr;dash;cefosirc;dge;r;pf;cr;fiosr;;pf;cr;AIUacfosucy;cy;cy;cuteiyrc;;r;pf;cr;ml;Hacdefoscy;cute;ayron;;ot;\0oWidta;r;pf;cr;\0\0\0\0\0\0\0cutereve;;Ediuy;;rcte;lig;r;raveepfpsym;ha;apcclr;g;\0\0;adsvnd;;lope;;;elmrsz;esd;a;;;;;;;;t;vb;d;pth;arr;gpon;f;;Eaeiop;cir;;d;s;rox;eingctyr;;mp;eildemlcioninnt;Nabcdefiklnoprsuot;crkcepsong;psilon;rime;im;eq;ee;ed;gerk;tbrk;oy;quo;cmprtaus;eptyv;snoahw;;een;r;gcostuvwaiurc;pdptot;lus;imes;\0\0cup;ar;riangleduown;p;plus;earow;akocnklstozenge;riangle;dlrown;eft;ight;k;\0\0;;4;ck;eo;q=uiv;t;ptwxf;;tomtie;DHUVbdhmptuvLRlr;;;;;DUdu;;;;LRlr;;;;;HLRhlr;;;;;;ox;LRlr;;;;;DUdu;;;;inus;lus;imes;LRlr;;;;;HLRhlr;;;;;;evbarceior;mi;m;el;bh;sub;l;etp;Ee;;q\0\0\0\0\0\0\0\0\0\0cprute;;abcdsnd;rcup;aup;p;ot;;eot;aeiu\0s;on;dilrc;ps;sm;ot;dmnilptyv;t;err;ceiy;ck;mark;r;Ecefms;;elq;e\0\0rrowlreft;ight;RSacd;st;irc;ash;nint;id;cir;ubs;uit\0on;e;q\0\0a;t;;flemxente\0;dot;nfry;o;sr;aorr;ss;cur;bp;e;;e;dot;delprvwarrlr;;\0\0r;c;arr;p;;bcdosrcap;aup;p;ot;r;;alrvrr;m;yevwq\0\0reuee;edge;enearrowlreftightecioninnt;lcty;AHabcdefhijlorstuwzrar;glrsger;eth;h;varow;aayron;;;aogrr;tseq;glmta;ptyv;irsht;;arlraegsvm;osnd;suit;amma;in;;iode;ontimes;ncy;c\0\0rn;op;lptuwlar;f;;empsq;dot;inus;lus;quare;blebarwedgnadhownarrowarpoonlrefighkaro\0\0rn;op;cotry;;l;rok;drot;i;fahraangle;ciy;grarr;DacdefglmnopqrstuxDoocsuteter;aioyron;r;clon;;ot;Drot;;;rsave;dot;;ilsnters;;;dot;apscr;ty;svetp1;;;gs;p;gpon;f;alsr;sl;us;i;lvon;csuviorc\0\0antgltressaeils;st;v;DD;parsl;Daot;rr;cdir;oah;mrlo;cipl;seoctationential\0\0\0\0\0\0\0llingdotsey;male;ilrlig;\0\0g;ig;;lig;lig;fjaltt;ig;ns;of;\0f;ak;v;artint;aocs\0\0;;;;\0;;\0\0;;5;\0;;8;l;wn;cr;Eabcdefgijlnorstv;l;cmpute;ma;d;reve;iyrc;;ot;;lqs;qslan;cdlc;ot;o;l;;es;r;;gmel;cy;;Eaj;;;Eaes;p;prox;q;qim;pf;cir;m;el;;>;cdlqrci;r;ot;Par;uest;adels\0pror;qlqlesienrtneqq;Aabcefkosyrilmrrsfildrcy;;cwir;;ar;irc;alrrts;uitlip;con;r;sewarow;arow;amoprrr;tht;klreftarrow;ightarrow;f;bar;cltr;asrok;bpull;hen\0\0\0\0\0\0cute;iyrc;cxy;clfr;rave;inoinnt;t;fin;ta;lig;aopcgtr;elpinarh;f;ed;;cfotare;in;tie;do;celpal;grerarhk;rod;cgpty;on;f;a;uestcir;n;Edsv;ot;;v;;ilde;\0cy;lcfmosuiyrc;;r;ath;pf;\0r;rcy;kcy;acfghjosppa;v;eydil;;r;reen;cy;cy;pf;cr;ABEHabcdefghjlmnoprstuvartrail;arr;;g;ar;\0\0\0\0\0\0\0\0\0ute;mptyv;rabda;g;dl;;uor;bfhlpst;fs;s;p;l;im;l;;aeil;;s;abrrr;rk;akcek;;es;ldu;;aeuyron;diil;;cqrsa;uo;rduhar;shar;h;;fgqstahlrtrrow;taarpoonduownpeftarrows;ightahsrrow;sarpoonquigarrohreetimes;;qslan;cdgsc;ot;o;r;;es;adegspproot;qgqgtiilrsht;;;E;rdu;l;lk;cy;;achtrorneard;ri;iodot;ust;acheEaes;p;prox;q;qim;abnoptwznrg;r;rglmreftarightapsto;ightparrowlrefight;aflr;;us;imes;st;;efngear;lt;achmtrornear;d;;ri;achiqtquo;r;m;eg;;buo;r;rok;<;cdhilqrci;r;remes;arr;uest;Piar;;efrdushar;har;enrtneqq;DacdefhilnopsuDot;clprret;;ese;sto;dluowefker;oymma;;ash;asuredangler;o;cdnro;acdsir;otus;bd;u;p;dpels;f;ctr;pos;lmtimap;GLRVabcdefghijlmoprstuvwgt;;veltftarrrow;ightarrow;;;vightarrow;Ddash;ash;bcnptlaute;g;;Eiop;d;s;rour;al;s\0pmp;eaeouy\0;on;dil;ng;dot;p;;ash;;Aadqsxrr;rhrk;;oot;uieiar;ist;sr;Eest;qs;qslani;rAaprrr;ar;;sv;d;cy;AEadestr;rr;r;;fqstarrroightarro;qslan;si;ri;eiptf;;inn;Edv;ot;;;i;v;;aorr;astllel;;lint;;ceu;c;eAaitrrr;cw;;ghtarrowri;echimpqu;ceru;ort\0\0arm;e;qsubpbcp;Ees;et;eq;qc;e;Ees;et;eq;qgilrldeianglelreft;eight;e;m;esro;p;DHadgilrsash;arr;p;ash;et;;>nfin;Aetrr;;;r<ie;Atrr;rie;im;Aanrr;rhrk;;oear;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0csuteiyr;c;abioslac;v;old;lig;crir;;\0\0\0n;ave;bmar;acitrirr;oss;n;aeicr;ga;cdnron;;pf;aelr;rp;;adiosvr;efmr;ofgof;r;lope;;cloashl;idees;as;mlbar;\0\0\0\0\0\0\0\0\0r;ast;lle\0\0m;;y;rcimptnt;od;il;enk;r;imo;v;mane;;tvchfork;aunckk;h;s;abcdemstcir;ir;ou;;nim;wo;ipuntint;f;nd;Eaceinosu;p;u;c;acenspprourlyeaespprox;qq;im;ime;sEasdfpalslar;ine;urf;;trel;cir;;ncsp;fiopsur;pf;rime;cr;aeoteirnionnt;st;eABHabcdefhilmnoprstuxartrail;arar;cdenqrteu;te;imptyv;g;del;;uor;abcfhlpstwp;;fs;;s;l;im;l;;aiil;o;nalabrrrk;akcek;;es;ldu;;aeuyron;diil;;clqsa;dhar;uo;rh;acgl;ipsnart;ilrsht;;aordu;l;;v;gnshtahlrstrrow;taarpoonduowpeftahrrowarpoonightarrows;quigarrohreetimes;g;ingdotseahmra;oust;achemid;abptnrg;r;raflr;;us;imes;apr;gt;olint;arachqquo;r;buo;rhirremes;i;efltri;luhar;;\0\0\0\0\0\0\0cute;qu;Eaceinpsy;\0;on;u;dil;rc;Eas;p;im;olint;i;ot;be;Aacmstxrr;rhr;oti;war;minnut;r;oacoyrp;hycy;;rt\0\0iaragmma;fv;;deglnprot;;q;E;;E;e;lus;arr;araeitlslsetmhp;parsl;dle;;e;s;flptcy;;b;ar;f;adres;uitcsuaup;s;p;s;ubp;eset;e;eset;e;afrarcemtr;tmiararr;fanighteppsilohsbcmnp;Edemnprs;ot;;dot;ult;Ee;;lus;arr;eiut;enq;qeq;qm;bp;;c;acenspprourlyeaespproqg;123;Edehlmnps;ost;ub;;dot;soul;b;arr;ult;Ee;;lus;eiut;enq;qeq;qm;bp;;Aanrr;rhr;owar;lig\0\0\0\0\0\0\0\0\0\0\0\0get;;raeyron;dil;;lrec;r;eiko\0e4fa;svym;cnkaspproimsasrnes;bd;ar;;eps;bcfot;ir;;ork;rime;aipdadempstngle;dlqrowneft;e;ight;eot;inus;lus;b;ime;ezium;chtry;;cy;rok;ioxheadlreftarroightarrowAHabcdfghlmoprstuwrar;cruter\0y;ve;iyrc;abhrlac;airsht;;raverlrlk;ct\0\0rn;erop;ri;alcr;gpon;f;adhlsuownarpoonlrefighi;hlonparrows;cit\0\0rn;erop;ng;ri;cr;dirot;lde;i;famrlangle;ABDacdeflnoprszrar;v;asnrgrt;eknprstappothinhirop;hiugmbpsetneq;q;setneq;q;hretianglelreftighty;ashelr;bear;q;lip;btar;trsubppf;rotrcur;bpnEenEeigzag;cefoprsirc;dibgar;e;q;erp;r;pf;;eatcr;\0\0\0\0\0\0\0trr;Aarr;Aarrais;dptfl;imAarrcqr;ptracefiosucuyte;iyrc;;nr;cy;pf;cr;cmy;lacdefhioswcute;ayron;;ot;ettra;r;cy;grarr;pf;cr;jn;j;'.split("").map(function(tt){return tt.charCodeAt(0)}));var decodeDataXml={};Object.defineProperty(decodeDataXml,"__esModule",{value:!0});decodeDataXml.default=new Uint16Array("aglq	\x1B\0\0p;os;t;t;uot;".split("").map(function(tt){return tt.charCodeAt(0)}));var decode_codepoint={};(function(tt){var et;Object.defineProperty(tt,"__esModule",{value:!0}),tt.replaceCodePoint=tt.fromCodePoint=void 0;var rt=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]);tt.fromCodePoint=(et=String.fromCodePoint)!==null&&et!==void 0?et:function(st){var ot="";return st>65535&&(st-=65536,ot+=String.fromCharCode(st>>>10&1023|55296),st=56320|st&1023),ot+=String.fromCharCode(st),ot};function nt(st){var ot;return st>=55296&&st<=57343||st>1114111?65533:(ot=rt.get(st))!==null&&ot!==void 0?ot:st}tt.replaceCodePoint=nt;function it(st){return(0,tt.fromCodePoint)(nt(st))}tt.default=it})(decode_codepoint);(function(tt){var et=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(is,cs,ps,vs){vs===void 0&&(vs=ps);var ls=Object.getOwnPropertyDescriptor(cs,ps);(!ls||("get"in ls?!cs.__esModule:ls.writable||ls.configurable))&&(ls={enumerable:!0,get:function(){return cs[ps]}}),Object.defineProperty(is,vs,ls)}:function(is,cs,ps,vs){vs===void 0&&(vs=ps),is[vs]=cs[ps]}),rt=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(is,cs){Object.defineProperty(is,"default",{enumerable:!0,value:cs})}:function(is,cs){is.default=cs}),nt=commonjsGlobal&&commonjsGlobal.__importStar||function(is){if(is&&is.__esModule)return is;var cs={};if(is!=null)for(var ps in is)ps!=="default"&&Object.prototype.hasOwnProperty.call(is,ps)&&et(cs,is,ps);return rt(cs,is),cs},it=commonjsGlobal&&commonjsGlobal.__importDefault||function(is){return is&&is.__esModule?is:{default:is}};Object.defineProperty(tt,"__esModule",{value:!0}),tt.decodeXML=tt.decodeHTMLStrict=tt.decodeHTMLAttribute=tt.decodeHTML=tt.determineBranch=tt.EntityDecoder=tt.DecodingMode=tt.BinTrieFlags=tt.fromCodePoint=tt.replaceCodePoint=tt.decodeCodePoint=tt.xmlDecodeTree=tt.htmlDecodeTree=void 0;var st=it(decodeDataHtml);tt.htmlDecodeTree=st.default;var ot=it(decodeDataXml);tt.xmlDecodeTree=ot.default;var lt=nt(decode_codepoint);tt.decodeCodePoint=lt.default;var ut=decode_codepoint;Object.defineProperty(tt,"replaceCodePoint",{enumerable:!0,get:function(){return ut.replaceCodePoint}}),Object.defineProperty(tt,"fromCodePoint",{enumerable:!0,get:function(){return ut.fromCodePoint}});var ct;(function(is){is[is.NUM=35]="NUM",is[is.SEMI=59]="SEMI",is[is.EQUALS=61]="EQUALS",is[is.ZERO=48]="ZERO",is[is.NINE=57]="NINE",is[is.LOWER_A=97]="LOWER_A",is[is.LOWER_F=102]="LOWER_F",is[is.LOWER_X=120]="LOWER_X",is[is.LOWER_Z=122]="LOWER_Z",is[is.UPPER_A=65]="UPPER_A",is[is.UPPER_F=70]="UPPER_F",is[is.UPPER_Z=90]="UPPER_Z"})(ct||(ct={}));var dt=32,pt;(function(is){is[is.VALUE_LENGTH=49152]="VALUE_LENGTH",is[is.BRANCH_LENGTH=16256]="BRANCH_LENGTH",is[is.JUMP_TABLE=127]="JUMP_TABLE"})(pt=tt.BinTrieFlags||(tt.BinTrieFlags={}));function ft(is){return is>=ct.ZERO&&is<=ct.NINE}function gt(is){return is>=ct.UPPER_A&&is<=ct.UPPER_F||is>=ct.LOWER_A&&is<=ct.LOWER_F}function _r(is){return is>=ct.UPPER_A&&is<=ct.UPPER_Z||is>=ct.LOWER_A&&is<=ct.LOWER_Z||ft(is)}function Yr(is){return is===ct.EQUALS||_r(is)}var mt;(function(is){is[is.EntityStart=0]="EntityStart",is[is.NumericStart=1]="NumericStart",is[is.NumericDecimal=2]="NumericDecimal",is[is.NumericHex=3]="NumericHex",is[is.NamedEntity=4]="NamedEntity"})(mt||(mt={}));var Kr;(function(is){is[is.Legacy=0]="Legacy",is[is.Strict=1]="Strict",is[is.Attribute=2]="Attribute"})(Kr=tt.DecodingMode||(tt.DecodingMode={}));var Xr=function(){function is(cs,ps,vs){this.decodeTree=cs,this.emitCodePoint=ps,this.errors=vs,this.state=mt.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=Kr.Strict}return is.prototype.startEntity=function(cs){this.decodeMode=cs,this.state=mt.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1},is.prototype.write=function(cs,ps){switch(this.state){case mt.EntityStart:return cs.charCodeAt(ps)===ct.NUM?(this.state=mt.NumericStart,this.consumed+=1,this.stateNumericStart(cs,ps+1)):(this.state=mt.NamedEntity,this.stateNamedEntity(cs,ps));case mt.NumericStart:return this.stateNumericStart(cs,ps);case mt.NumericDecimal:return this.stateNumericDecimal(cs,ps);case mt.NumericHex:return this.stateNumericHex(cs,ps);case mt.NamedEntity:return this.stateNamedEntity(cs,ps)}},is.prototype.stateNumericStart=function(cs,ps){return ps>=cs.length?-1:(cs.charCodeAt(ps)|dt)===ct.LOWER_X?(this.state=mt.NumericHex,this.consumed+=1,this.stateNumericHex(cs,ps+1)):(this.state=mt.NumericDecimal,this.stateNumericDecimal(cs,ps))},is.prototype.addToNumericResult=function(cs,ps,vs,ls){if(ps!==vs){var ms=vs-ps;this.result=this.result*Math.pow(ls,ms)+parseInt(cs.substr(ps,ms),ls),this.consumed+=ms}},is.prototype.stateNumericHex=function(cs,ps){for(var vs=ps;ps<cs.length;){var ls=cs.charCodeAt(ps);if(ft(ls)||gt(ls))ps+=1;else return this.addToNumericResult(cs,vs,ps,16),this.emitNumericEntity(ls,3)}return this.addToNumericResult(cs,vs,ps,16),-1},is.prototype.stateNumericDecimal=function(cs,ps){for(var vs=ps;ps<cs.length;){var ls=cs.charCodeAt(ps);if(ft(ls))ps+=1;else return this.addToNumericResult(cs,vs,ps,10),this.emitNumericEntity(ls,2)}return this.addToNumericResult(cs,vs,ps,10),-1},is.prototype.emitNumericEntity=function(cs,ps){var vs;if(this.consumed<=ps)return(vs=this.errors)===null||vs===void 0||vs.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(cs===ct.SEMI)this.consumed+=1;else if(this.decodeMode===Kr.Strict)return 0;return this.emitCodePoint((0,lt.replaceCodePoint)(this.result),this.consumed),this.errors&&(cs!==ct.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed},is.prototype.stateNamedEntity=function(cs,ps){for(var vs=this.decodeTree,ls=vs[this.treeIndex],ms=(ls&pt.VALUE_LENGTH)>>14;ps<cs.length;ps++,this.excess++){var us=cs.charCodeAt(ps);if(this.treeIndex=Qr(vs,ls,this.treeIndex+Math.max(1,ms),us),this.treeIndex<0)return this.result===0||this.decodeMode===Kr.Attribute&&(ms===0||Yr(us))?0:this.emitNotTerminatedNamedEntity();if(ls=vs[this.treeIndex],ms=(ls&pt.VALUE_LENGTH)>>14,ms!==0){if(us===ct.SEMI)return this.emitNamedEntityData(this.treeIndex,ms,this.consumed+this.excess);this.decodeMode!==Kr.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1},is.prototype.emitNotTerminatedNamedEntity=function(){var cs,ps=this,vs=ps.result,ls=ps.decodeTree,ms=(ls[vs]&pt.VALUE_LENGTH)>>14;return this.emitNamedEntityData(vs,ms,this.consumed),(cs=this.errors)===null||cs===void 0||cs.missingSemicolonAfterCharacterReference(),this.consumed},is.prototype.emitNamedEntityData=function(cs,ps,vs){var ls=this.decodeTree;return this.emitCodePoint(ps===1?ls[cs]&~pt.VALUE_LENGTH:ls[cs+1],vs),ps===3&&this.emitCodePoint(ls[cs+2],vs),vs},is.prototype.end=function(){var cs;switch(this.state){case mt.NamedEntity:return this.result!==0&&(this.decodeMode!==Kr.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case mt.NumericDecimal:return this.emitNumericEntity(0,2);case mt.NumericHex:return this.emitNumericEntity(0,3);case mt.NumericStart:return(cs=this.errors)===null||cs===void 0||cs.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case mt.EntityStart:return 0}},is}();tt.EntityDecoder=Xr;function Zr(is){var cs="",ps=new Xr(is,function(vs){return cs+=(0,lt.fromCodePoint)(vs)});return function(ls,ms){for(var us=0,gs=0;(gs=ls.indexOf("&",gs))>=0;){cs+=ls.slice(us,gs),ps.startEntity(ms);var ys=ps.write(ls,gs+1);if(ys<0){us=gs+ps.end();break}us=gs+ys,gs=ys===0?us+1:us}var Es=cs+ls.slice(us);return cs="",Es}}function Qr(is,cs,ps,vs){var ls=(cs&pt.BRANCH_LENGTH)>>7,ms=cs&pt.JUMP_TABLE;if(ls===0)return ms!==0&&vs===ms?ps:-1;if(ms){var us=vs-ms;return us<0||us>=ls?-1:is[ps+us]-1}for(var gs=ps,ys=gs+ls-1;gs<=ys;){var Es=gs+ys>>>1,Ss=is[Es];if(Ss<vs)gs=Es+1;else if(Ss>vs)ys=Es-1;else return is[Es+ls]}return-1}tt.determineBranch=Qr;var _i=Zr(st.default),ns=Zr(ot.default);function rs(is,cs){return cs===void 0&&(cs=Kr.Legacy),_i(is,cs)}tt.decodeHTML=rs;function ss(is){return _i(is,Kr.Attribute)}tt.decodeHTMLAttribute=ss;function hs(is){return _i(is,Kr.Strict)}tt.decodeHTMLStrict=hs;function os(is){return ns(is,Kr.Strict)}tt.decodeXML=os})(decode);(function(tt){Object.defineProperty(tt,"__esModule",{value:!0}),tt.QuoteType=void 0;var et=decode,rt;(function(ft){ft[ft.Tab=9]="Tab",ft[ft.NewLine=10]="NewLine",ft[ft.FormFeed=12]="FormFeed",ft[ft.CarriageReturn=13]="CarriageReturn",ft[ft.Space=32]="Space",ft[ft.ExclamationMark=33]="ExclamationMark",ft[ft.Number=35]="Number",ft[ft.Amp=38]="Amp",ft[ft.SingleQuote=39]="SingleQuote",ft[ft.DoubleQuote=34]="DoubleQuote",ft[ft.Dash=45]="Dash",ft[ft.Slash=47]="Slash",ft[ft.Zero=48]="Zero",ft[ft.Nine=57]="Nine",ft[ft.Semi=59]="Semi",ft[ft.Lt=60]="Lt",ft[ft.Eq=61]="Eq",ft[ft.Gt=62]="Gt",ft[ft.Questionmark=63]="Questionmark",ft[ft.UpperA=65]="UpperA",ft[ft.LowerA=97]="LowerA",ft[ft.UpperF=70]="UpperF",ft[ft.LowerF=102]="LowerF",ft[ft.UpperZ=90]="UpperZ",ft[ft.LowerZ=122]="LowerZ",ft[ft.LowerX=120]="LowerX",ft[ft.OpeningSquareBracket=91]="OpeningSquareBracket"})(rt||(rt={}));var nt;(function(ft){ft[ft.Text=1]="Text",ft[ft.BeforeTagName=2]="BeforeTagName",ft[ft.InTagName=3]="InTagName",ft[ft.InSelfClosingTag=4]="InSelfClosingTag",ft[ft.BeforeClosingTagName=5]="BeforeClosingTagName",ft[ft.InClosingTagName=6]="InClosingTagName",ft[ft.AfterClosingTagName=7]="AfterClosingTagName",ft[ft.BeforeAttributeName=8]="BeforeAttributeName",ft[ft.InAttributeName=9]="InAttributeName",ft[ft.AfterAttributeName=10]="AfterAttributeName",ft[ft.BeforeAttributeValue=11]="BeforeAttributeValue",ft[ft.InAttributeValueDq=12]="InAttributeValueDq",ft[ft.InAttributeValueSq=13]="InAttributeValueSq",ft[ft.InAttributeValueNq=14]="InAttributeValueNq",ft[ft.BeforeDeclaration=15]="BeforeDeclaration",ft[ft.InDeclaration=16]="InDeclaration",ft[ft.InProcessingInstruction=17]="InProcessingInstruction",ft[ft.BeforeComment=18]="BeforeComment",ft[ft.CDATASequence=19]="CDATASequence",ft[ft.InSpecialComment=20]="InSpecialComment",ft[ft.InCommentLike=21]="InCommentLike",ft[ft.BeforeSpecialS=22]="BeforeSpecialS",ft[ft.SpecialStartSequence=23]="SpecialStartSequence",ft[ft.InSpecialTag=24]="InSpecialTag",ft[ft.BeforeEntity=25]="BeforeEntity",ft[ft.BeforeNumericEntity=26]="BeforeNumericEntity",ft[ft.InNamedEntity=27]="InNamedEntity",ft[ft.InNumericEntity=28]="InNumericEntity",ft[ft.InHexEntity=29]="InHexEntity"})(nt||(nt={}));function it(ft){return ft===rt.Space||ft===rt.NewLine||ft===rt.Tab||ft===rt.FormFeed||ft===rt.CarriageReturn}function st(ft){return ft===rt.Slash||ft===rt.Gt||it(ft)}function ot(ft){return ft>=rt.Zero&&ft<=rt.Nine}function lt(ft){return ft>=rt.LowerA&&ft<=rt.LowerZ||ft>=rt.UpperA&&ft<=rt.UpperZ}function ut(ft){return ft>=rt.UpperA&&ft<=rt.UpperF||ft>=rt.LowerA&&ft<=rt.LowerF}var ct;(function(ft){ft[ft.NoValue=0]="NoValue",ft[ft.Unquoted=1]="Unquoted",ft[ft.Single=2]="Single",ft[ft.Double=3]="Double"})(ct=tt.QuoteType||(tt.QuoteType={}));var dt={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101])},pt=function(){function ft(gt,_r){var Yr=gt.xmlMode,mt=Yr===void 0?!1:Yr,Kr=gt.decodeEntities,Xr=Kr===void 0?!0:Kr;this.cbs=_r,this.state=nt.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=nt.Text,this.isSpecial=!1,this.running=!0,this.offset=0,this.currentSequence=void 0,this.sequenceIndex=0,this.trieIndex=0,this.trieCurrent=0,this.entityResult=0,this.entityExcess=0,this.xmlMode=mt,this.decodeEntities=Xr,this.entityTrie=mt?et.xmlDecodeTree:et.htmlDecodeTree}return ft.prototype.reset=function(){this.state=nt.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=nt.Text,this.currentSequence=void 0,this.running=!0,this.offset=0},ft.prototype.write=function(gt){this.offset+=this.buffer.length,this.buffer=gt,this.parse()},ft.prototype.end=function(){this.running&&this.finish()},ft.prototype.pause=function(){this.running=!1},ft.prototype.resume=function(){this.running=!0,this.index<this.buffer.length+this.offset&&this.parse()},ft.prototype.getIndex=function(){return this.index},ft.prototype.getSectionStart=function(){return this.sectionStart},ft.prototype.stateText=function(gt){gt===rt.Lt||!this.decodeEntities&&this.fastForwardTo(rt.Lt)?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=nt.BeforeTagName,this.sectionStart=this.index):this.decodeEntities&&gt===rt.Amp&&(this.state=nt.BeforeEntity)},ft.prototype.stateSpecialStartSequence=function(gt){var _r=this.sequenceIndex===this.currentSequence.length,Yr=_r?st(gt):(gt|32)===this.currentSequence[this.sequenceIndex];if(!Yr)this.isSpecial=!1;else if(!_r){this.sequenceIndex++;return}this.sequenceIndex=0,this.state=nt.InTagName,this.stateInTagName(gt)},ft.prototype.stateInSpecialTag=function(gt){if(this.sequenceIndex===this.currentSequence.length){if(gt===rt.Gt||it(gt)){var _r=this.index-this.currentSequence.length;if(this.sectionStart<_r){var Yr=this.index;this.index=_r,this.cbs.ontext(this.sectionStart,_r),this.index=Yr}this.isSpecial=!1,this.sectionStart=_r+2,this.stateInClosingTagName(gt);return}this.sequenceIndex=0}(gt|32)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:this.sequenceIndex===0?this.currentSequence===dt.TitleEnd?this.decodeEntities&&gt===rt.Amp&&(this.state=nt.BeforeEntity):this.fastForwardTo(rt.Lt)&&(this.sequenceIndex=1):this.sequenceIndex=+(gt===rt.Lt)},ft.prototype.stateCDATASequence=function(gt){gt===dt.Cdata[this.sequenceIndex]?++this.sequenceIndex===dt.Cdata.length&&(this.state=nt.InCommentLike,this.currentSequence=dt.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=nt.InDeclaration,this.stateInDeclaration(gt))},ft.prototype.fastForwardTo=function(gt){for(;++this.index<this.buffer.length+this.offset;)if(this.buffer.charCodeAt(this.index-this.offset)===gt)return!0;return this.index=this.buffer.length+this.offset-1,!1},ft.prototype.stateInCommentLike=function(gt){gt===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===dt.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index,2):this.cbs.oncomment(this.sectionStart,this.index,2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=nt.Text):this.sequenceIndex===0?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):gt!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)},ft.prototype.isTagStartChar=function(gt){return this.xmlMode?!st(gt):lt(gt)},ft.prototype.startSpecial=function(gt,_r){this.isSpecial=!0,this.currentSequence=gt,this.sequenceIndex=_r,this.state=nt.SpecialStartSequence},ft.prototype.stateBeforeTagName=function(gt){if(gt===rt.ExclamationMark)this.state=nt.BeforeDeclaration,this.sectionStart=this.index+1;else if(gt===rt.Questionmark)this.state=nt.InProcessingInstruction,this.sectionStart=this.index+1;else if(this.isTagStartChar(gt)){var _r=gt|32;this.sectionStart=this.index,!this.xmlMode&&_r===dt.TitleEnd[2]?this.startSpecial(dt.TitleEnd,3):this.state=!this.xmlMode&&_r===dt.ScriptEnd[2]?nt.BeforeSpecialS:nt.InTagName}else gt===rt.Slash?this.state=nt.BeforeClosingTagName:(this.state=nt.Text,this.stateText(gt))},ft.prototype.stateInTagName=function(gt){st(gt)&&(this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=nt.BeforeAttributeName,this.stateBeforeAttributeName(gt))},ft.prototype.stateBeforeClosingTagName=function(gt){it(gt)||(gt===rt.Gt?this.state=nt.Text:(this.state=this.isTagStartChar(gt)?nt.InClosingTagName:nt.InSpecialComment,this.sectionStart=this.index))},ft.prototype.stateInClosingTagName=function(gt){(gt===rt.Gt||it(gt))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=nt.AfterClosingTagName,this.stateAfterClosingTagName(gt))},ft.prototype.stateAfterClosingTagName=function(gt){(gt===rt.Gt||this.fastForwardTo(rt.Gt))&&(this.state=nt.Text,this.baseState=nt.Text,this.sectionStart=this.index+1)},ft.prototype.stateBeforeAttributeName=function(gt){gt===rt.Gt?(this.cbs.onopentagend(this.index),this.isSpecial?(this.state=nt.InSpecialTag,this.sequenceIndex=0):this.state=nt.Text,this.baseState=this.state,this.sectionStart=this.index+1):gt===rt.Slash?this.state=nt.InSelfClosingTag:it(gt)||(this.state=nt.InAttributeName,this.sectionStart=this.index)},ft.prototype.stateInSelfClosingTag=function(gt){gt===rt.Gt?(this.cbs.onselfclosingtag(this.index),this.state=nt.Text,this.baseState=nt.Text,this.sectionStart=this.index+1,this.isSpecial=!1):it(gt)||(this.state=nt.BeforeAttributeName,this.stateBeforeAttributeName(gt))},ft.prototype.stateInAttributeName=function(gt){(gt===rt.Eq||st(gt))&&(this.cbs.onattribname(this.sectionStart,this.index),this.sectionStart=-1,this.state=nt.AfterAttributeName,this.stateAfterAttributeName(gt))},ft.prototype.stateAfterAttributeName=function(gt){gt===rt.Eq?this.state=nt.BeforeAttributeValue:gt===rt.Slash||gt===rt.Gt?(this.cbs.onattribend(ct.NoValue,this.index),this.state=nt.BeforeAttributeName,this.stateBeforeAttributeName(gt)):it(gt)||(this.cbs.onattribend(ct.NoValue,this.index),this.state=nt.InAttributeName,this.sectionStart=this.index)},ft.prototype.stateBeforeAttributeValue=function(gt){gt===rt.DoubleQuote?(this.state=nt.InAttributeValueDq,this.sectionStart=this.index+1):gt===rt.SingleQuote?(this.state=nt.InAttributeValueSq,this.sectionStart=this.index+1):it(gt)||(this.sectionStart=this.index,this.state=nt.InAttributeValueNq,this.stateInAttributeValueNoQuotes(gt))},ft.prototype.handleInAttributeValue=function(gt,_r){gt===_r||!this.decodeEntities&&this.fastForwardTo(_r)?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(_r===rt.DoubleQuote?ct.Double:ct.Single,this.index),this.state=nt.BeforeAttributeName):this.decodeEntities&&gt===rt.Amp&&(this.baseState=this.state,this.state=nt.BeforeEntity)},ft.prototype.stateInAttributeValueDoubleQuotes=function(gt){this.handleInAttributeValue(gt,rt.DoubleQuote)},ft.prototype.stateInAttributeValueSingleQuotes=function(gt){this.handleInAttributeValue(gt,rt.SingleQuote)},ft.prototype.stateInAttributeValueNoQuotes=function(gt){it(gt)||gt===rt.Gt?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(ct.Unquoted,this.index),this.state=nt.BeforeAttributeName,this.stateBeforeAttributeName(gt)):this.decodeEntities&&gt===rt.Amp&&(this.baseState=this.state,this.state=nt.BeforeEntity)},ft.prototype.stateBeforeDeclaration=function(gt){gt===rt.OpeningSquareBracket?(this.state=nt.CDATASequence,this.sequenceIndex=0):this.state=gt===rt.Dash?nt.BeforeComment:nt.InDeclaration},ft.prototype.stateInDeclaration=function(gt){(gt===rt.Gt||this.fastForwardTo(rt.Gt))&&(this.cbs.ondeclaration(this.sectionStart,this.index),this.state=nt.Text,this.sectionStart=this.index+1)},ft.prototype.stateInProcessingInstruction=function(gt){(gt===rt.Gt||this.fastForwardTo(rt.Gt))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=nt.Text,this.sectionStart=this.index+1)},ft.prototype.stateBeforeComment=function(gt){gt===rt.Dash?(this.state=nt.InCommentLike,this.currentSequence=dt.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=nt.InDeclaration},ft.prototype.stateInSpecialComment=function(gt){(gt===rt.Gt||this.fastForwardTo(rt.Gt))&&(this.cbs.oncomment(this.sectionStart,this.index,0),this.state=nt.Text,this.sectionStart=this.index+1)},ft.prototype.stateBeforeSpecialS=function(gt){var _r=gt|32;_r===dt.ScriptEnd[3]?this.startSpecial(dt.ScriptEnd,4):_r===dt.StyleEnd[3]?this.startSpecial(dt.StyleEnd,4):(this.state=nt.InTagName,this.stateInTagName(gt))},ft.prototype.stateBeforeEntity=function(gt){this.entityExcess=1,this.entityResult=0,gt===rt.Number?this.state=nt.BeforeNumericEntity:gt===rt.Amp||(this.trieIndex=0,this.trieCurrent=this.entityTrie[0],this.state=nt.InNamedEntity,this.stateInNamedEntity(gt))},ft.prototype.stateInNamedEntity=function(gt){if(this.entityExcess+=1,this.trieIndex=(0,et.determineBranch)(this.entityTrie,this.trieCurrent,this.trieIndex+1,gt),this.trieIndex<0){this.emitNamedEntity(),this.index--;return}this.trieCurrent=this.entityTrie[this.trieIndex];var _r=this.trieCurrent&et.BinTrieFlags.VALUE_LENGTH;if(_r){var Yr=(_r>>14)-1;if(!this.allowLegacyEntity()&&gt!==rt.Semi)this.trieIndex+=Yr;else{var mt=this.index-this.entityExcess+1;mt>this.sectionStart&&this.emitPartial(this.sectionStart,mt),this.entityResult=this.trieIndex,this.trieIndex+=Yr,this.entityExcess=0,this.sectionStart=this.index+1,Yr===0&&this.emitNamedEntity()}}},ft.prototype.emitNamedEntity=function(){if(this.state=this.baseState,this.entityResult!==0){var gt=(this.entityTrie[this.entityResult]&et.BinTrieFlags.VALUE_LENGTH)>>14;switch(gt){case 1:{this.emitCodePoint(this.entityTrie[this.entityResult]&~et.BinTrieFlags.VALUE_LENGTH);break}case 2:{this.emitCodePoint(this.entityTrie[this.entityResult+1]);break}case 3:this.emitCodePoint(this.entityTrie[this.entityResult+1]),this.emitCodePoint(this.entityTrie[this.entityResult+2])}}},ft.prototype.stateBeforeNumericEntity=function(gt){(gt|32)===rt.LowerX?(this.entityExcess++,this.state=nt.InHexEntity):(this.state=nt.InNumericEntity,this.stateInNumericEntity(gt))},ft.prototype.emitNumericEntity=function(gt){var _r=this.index-this.entityExcess-1,Yr=_r+2+ +(this.state===nt.InHexEntity);Yr!==this.index&&(_r>this.sectionStart&&this.emitPartial(this.sectionStart,_r),this.sectionStart=this.index+Number(gt),this.emitCodePoint((0,et.replaceCodePoint)(this.entityResult))),this.state=this.baseState},ft.prototype.stateInNumericEntity=function(gt){gt===rt.Semi?this.emitNumericEntity(!0):ot(gt)?(this.entityResult=this.entityResult*10+(gt-rt.Zero),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)},ft.prototype.stateInHexEntity=function(gt){gt===rt.Semi?this.emitNumericEntity(!0):ot(gt)?(this.entityResult=this.entityResult*16+(gt-rt.Zero),this.entityExcess++):ut(gt)?(this.entityResult=this.entityResult*16+((gt|32)-rt.LowerA+10),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)},ft.prototype.allowLegacyEntity=function(){return!this.xmlMode&&(this.baseState===nt.Text||this.baseState===nt.InSpecialTag)},ft.prototype.cleanup=function(){this.running&&this.sectionStart!==this.index&&(this.state===nt.Text||this.state===nt.InSpecialTag&&this.sequenceIndex===0?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):(this.state===nt.InAttributeValueDq||this.state===nt.InAttributeValueSq||this.state===nt.InAttributeValueNq)&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))},ft.prototype.shouldContinue=function(){return this.index<this.buffer.length+this.offset&&this.running},ft.prototype.parse=function(){for(;this.shouldContinue();){var gt=this.buffer.charCodeAt(this.index-this.offset);switch(this.state){case nt.Text:{this.stateText(gt);break}case nt.SpecialStartSequence:{this.stateSpecialStartSequence(gt);break}case nt.InSpecialTag:{this.stateInSpecialTag(gt);break}case nt.CDATASequence:{this.stateCDATASequence(gt);break}case nt.InAttributeValueDq:{this.stateInAttributeValueDoubleQuotes(gt);break}case nt.InAttributeName:{this.stateInAttributeName(gt);break}case nt.InCommentLike:{this.stateInCommentLike(gt);break}case nt.InSpecialComment:{this.stateInSpecialComment(gt);break}case nt.BeforeAttributeName:{this.stateBeforeAttributeName(gt);break}case nt.InTagName:{this.stateInTagName(gt);break}case nt.InClosingTagName:{this.stateInClosingTagName(gt);break}case nt.BeforeTagName:{this.stateBeforeTagName(gt);break}case nt.AfterAttributeName:{this.stateAfterAttributeName(gt);break}case nt.InAttributeValueSq:{this.stateInAttributeValueSingleQuotes(gt);break}case nt.BeforeAttributeValue:{this.stateBeforeAttributeValue(gt);break}case nt.BeforeClosingTagName:{this.stateBeforeClosingTagName(gt);break}case nt.AfterClosingTagName:{this.stateAfterClosingTagName(gt);break}case nt.BeforeSpecialS:{this.stateBeforeSpecialS(gt);break}case nt.InAttributeValueNq:{this.stateInAttributeValueNoQuotes(gt);break}case nt.InSelfClosingTag:{this.stateInSelfClosingTag(gt);break}case nt.InDeclaration:{this.stateInDeclaration(gt);break}case nt.BeforeDeclaration:{this.stateBeforeDeclaration(gt);break}case nt.BeforeComment:{this.stateBeforeComment(gt);break}case nt.InProcessingInstruction:{this.stateInProcessingInstruction(gt);break}case nt.InNamedEntity:{this.stateInNamedEntity(gt);break}case nt.BeforeEntity:{this.stateBeforeEntity(gt);break}case nt.InHexEntity:{this.stateInHexEntity(gt);break}case nt.InNumericEntity:{this.stateInNumericEntity(gt);break}default:this.stateBeforeNumericEntity(gt)}this.index++}this.cleanup()},ft.prototype.finish=function(){this.state===nt.InNamedEntity&&this.emitNamedEntity(),this.sectionStart<this.index&&this.handleTrailingData(),this.cbs.onend()},ft.prototype.handleTrailingData=function(){var gt=this.buffer.length+this.offset;this.state===nt.InCommentLike?this.currentSequence===dt.CdataEnd?this.cbs.oncdata(this.sectionStart,gt,0):this.cbs.oncomment(this.sectionStart,gt,0):this.state===nt.InNumericEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===nt.InHexEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===nt.InTagName||this.state===nt.BeforeAttributeName||this.state===nt.BeforeAttributeValue||this.state===nt.AfterAttributeName||this.state===nt.InAttributeName||this.state===nt.InAttributeValueSq||this.state===nt.InAttributeValueDq||this.state===nt.InAttributeValueNq||this.state===nt.InClosingTagName||this.cbs.ontext(this.sectionStart,gt)},ft.prototype.emitPartial=function(gt,_r){this.baseState!==nt.Text&&this.baseState!==nt.InSpecialTag?this.cbs.onattribdata(gt,_r):this.cbs.ontext(gt,_r)},ft.prototype.emitCodePoint=function(gt){this.baseState!==nt.Text&&this.baseState!==nt.InSpecialTag?this.cbs.onattribentity(gt):this.cbs.ontextentity(gt)},ft}();tt.default=pt})(Tokenizer);var __createBinding$1=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(tt,et,rt,nt){nt===void 0&&(nt=rt);var it=Object.getOwnPropertyDescriptor(et,rt);(!it||("get"in it?!et.__esModule:it.writable||it.configurable))&&(it={enumerable:!0,get:function(){return et[rt]}}),Object.defineProperty(tt,nt,it)}:function(tt,et,rt,nt){nt===void 0&&(nt=rt),tt[nt]=et[rt]}),__setModuleDefault$1=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(tt,et){Object.defineProperty(tt,"default",{enumerable:!0,value:et})}:function(tt,et){tt.default=et}),__importStar$1=commonjsGlobal&&commonjsGlobal.__importStar||function(tt){if(tt&&tt.__esModule)return tt;var et={};if(tt!=null)for(var rt in tt)rt!=="default"&&Object.prototype.hasOwnProperty.call(tt,rt)&&__createBinding$1(et,tt,rt);return __setModuleDefault$1(et,tt),et};Object.defineProperty(Parser$3,"__esModule",{value:!0});Parser$3.Parser=void 0;var Tokenizer_js_1=__importStar$1(Tokenizer),decode_js_1=decode,formTags=new Set(["input","option","optgroup","select","button","datalist","textarea"]),pTag=new Set(["p"]),tableSectionTags=new Set(["thead","tbody"]),ddtTags=new Set(["dd","dt"]),rtpTags=new Set(["rt","rp"]),openImpliesClose=new Map([["tr",new Set(["tr","th","td"])],["th",new Set(["th"])],["td",new Set(["thead","th","td"])],["body",new Set(["head","link","script"])],["li",new Set(["li"])],["p",pTag],["h1",pTag],["h2",pTag],["h3",pTag],["h4",pTag],["h5",pTag],["h6",pTag],["select",formTags],["input",formTags],["output",formTags],["button",formTags],["datalist",formTags],["textarea",formTags],["option",new Set(["option"])],["optgroup",new Set(["optgroup","option"])],["dd",ddtTags],["dt",ddtTags],["address",pTag],["article",pTag],["aside",pTag],["blockquote",pTag],["details",pTag],["div",pTag],["dl",pTag],["fieldset",pTag],["figcaption",pTag],["figure",pTag],["footer",pTag],["form",pTag],["header",pTag],["hr",pTag],["main",pTag],["nav",pTag],["ol",pTag],["pre",pTag],["section",pTag],["table",pTag],["ul",pTag],["rt",rtpTags],["rp",rtpTags],["tbody",tableSectionTags],["tfoot",tableSectionTags]]),voidElements=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),foreignContextElements=new Set(["math","svg"]),htmlIntegrationElements=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignobject","desc","title"]),reNameEnd=/\s|\//,Parser$2=function(){function tt(et,rt){rt===void 0&&(rt={});var nt,it,st,ot,lt;this.options=rt,this.startIndex=0,this.endIndex=0,this.openTagStart=0,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.foreignContext=[],this.buffers=[],this.bufferOffset=0,this.writeIndex=0,this.ended=!1,this.cbs=et??{},this.lowerCaseTagNames=(nt=rt.lowerCaseTags)!==null&&nt!==void 0?nt:!rt.xmlMode,this.lowerCaseAttributeNames=(it=rt.lowerCaseAttributeNames)!==null&&it!==void 0?it:!rt.xmlMode,this.tokenizer=new((st=rt.Tokenizer)!==null&&st!==void 0?st:Tokenizer_js_1.default)(this.options,this),(lt=(ot=this.cbs).onparserinit)===null||lt===void 0||lt.call(ot,this)}return tt.prototype.ontext=function(et,rt){var nt,it,st=this.getSlice(et,rt);this.endIndex=rt-1,(it=(nt=this.cbs).ontext)===null||it===void 0||it.call(nt,st),this.startIndex=rt},tt.prototype.ontextentity=function(et){var rt,nt,it=this.tokenizer.getSectionStart();this.endIndex=it-1,(nt=(rt=this.cbs).ontext)===null||nt===void 0||nt.call(rt,(0,decode_js_1.fromCodePoint)(et)),this.startIndex=it},tt.prototype.isVoidElement=function(et){return!this.options.xmlMode&&voidElements.has(et)},tt.prototype.onopentagname=function(et,rt){this.endIndex=rt;var nt=this.getSlice(et,rt);this.lowerCaseTagNames&&(nt=nt.toLowerCase()),this.emitOpenTag(nt)},tt.prototype.emitOpenTag=function(et){var rt,nt,it,st;this.openTagStart=this.startIndex,this.tagname=et;var ot=!this.options.xmlMode&&openImpliesClose.get(et);if(ot)for(;this.stack.length>0&&ot.has(this.stack[this.stack.length-1]);){var lt=this.stack.pop();(nt=(rt=this.cbs).onclosetag)===null||nt===void 0||nt.call(rt,lt,!0)}this.isVoidElement(et)||(this.stack.push(et),foreignContextElements.has(et)?this.foreignContext.push(!0):htmlIntegrationElements.has(et)&&this.foreignContext.push(!1)),(st=(it=this.cbs).onopentagname)===null||st===void 0||st.call(it,et),this.cbs.onopentag&&(this.attribs={})},tt.prototype.endOpenTag=function(et){var rt,nt;this.startIndex=this.openTagStart,this.attribs&&((nt=(rt=this.cbs).onopentag)===null||nt===void 0||nt.call(rt,this.tagname,this.attribs,et),this.attribs=null),this.cbs.onclosetag&&this.isVoidElement(this.tagname)&&this.cbs.onclosetag(this.tagname,!0),this.tagname=""},tt.prototype.onopentagend=function(et){this.endIndex=et,this.endOpenTag(!1),this.startIndex=et+1},tt.prototype.onclosetag=function(et,rt){var nt,it,st,ot,lt,ut;this.endIndex=rt;var ct=this.getSlice(et,rt);if(this.lowerCaseTagNames&&(ct=ct.toLowerCase()),(foreignContextElements.has(ct)||htmlIntegrationElements.has(ct))&&this.foreignContext.pop(),this.isVoidElement(ct))!this.options.xmlMode&&ct==="br"&&((it=(nt=this.cbs).onopentagname)===null||it===void 0||it.call(nt,"br"),(ot=(st=this.cbs).onopentag)===null||ot===void 0||ot.call(st,"br",{},!0),(ut=(lt=this.cbs).onclosetag)===null||ut===void 0||ut.call(lt,"br",!1));else{var dt=this.stack.lastIndexOf(ct);if(dt!==-1)if(this.cbs.onclosetag)for(var pt=this.stack.length-dt;pt--;)this.cbs.onclosetag(this.stack.pop(),pt!==0);else this.stack.length=dt;else!this.options.xmlMode&&ct==="p"&&(this.emitOpenTag("p"),this.closeCurrentTag(!0))}this.startIndex=rt+1},tt.prototype.onselfclosingtag=function(et){this.endIndex=et,this.options.xmlMode||this.options.recognizeSelfClosing||this.foreignContext[this.foreignContext.length-1]?(this.closeCurrentTag(!1),this.startIndex=et+1):this.onopentagend(et)},tt.prototype.closeCurrentTag=function(et){var rt,nt,it=this.tagname;this.endOpenTag(et),this.stack[this.stack.length-1]===it&&((nt=(rt=this.cbs).onclosetag)===null||nt===void 0||nt.call(rt,it,!et),this.stack.pop())},tt.prototype.onattribname=function(et,rt){this.startIndex=et;var nt=this.getSlice(et,rt);this.attribname=this.lowerCaseAttributeNames?nt.toLowerCase():nt},tt.prototype.onattribdata=function(et,rt){this.attribvalue+=this.getSlice(et,rt)},tt.prototype.onattribentity=function(et){this.attribvalue+=(0,decode_js_1.fromCodePoint)(et)},tt.prototype.onattribend=function(et,rt){var nt,it;this.endIndex=rt,(it=(nt=this.cbs).onattribute)===null||it===void 0||it.call(nt,this.attribname,this.attribvalue,et===Tokenizer_js_1.QuoteType.Double?'"':et===Tokenizer_js_1.QuoteType.Single?"'":et===Tokenizer_js_1.QuoteType.NoValue?void 0:null),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribvalue=""},tt.prototype.getInstructionName=function(et){var rt=et.search(reNameEnd),nt=rt<0?et:et.substr(0,rt);return this.lowerCaseTagNames&&(nt=nt.toLowerCase()),nt},tt.prototype.ondeclaration=function(et,rt){this.endIndex=rt;var nt=this.getSlice(et,rt);if(this.cbs.onprocessinginstruction){var it=this.getInstructionName(nt);this.cbs.onprocessinginstruction("!".concat(it),"!".concat(nt))}this.startIndex=rt+1},tt.prototype.onprocessinginstruction=function(et,rt){this.endIndex=rt;var nt=this.getSlice(et,rt);if(this.cbs.onprocessinginstruction){var it=this.getInstructionName(nt);this.cbs.onprocessinginstruction("?".concat(it),"?".concat(nt))}this.startIndex=rt+1},tt.prototype.oncomment=function(et,rt,nt){var it,st,ot,lt;this.endIndex=rt,(st=(it=this.cbs).oncomment)===null||st===void 0||st.call(it,this.getSlice(et,rt-nt)),(lt=(ot=this.cbs).oncommentend)===null||lt===void 0||lt.call(ot),this.startIndex=rt+1},tt.prototype.oncdata=function(et,rt,nt){var it,st,ot,lt,ut,ct,dt,pt,ft,gt;this.endIndex=rt;var _r=this.getSlice(et,rt-nt);this.options.xmlMode||this.options.recognizeCDATA?((st=(it=this.cbs).oncdatastart)===null||st===void 0||st.call(it),(lt=(ot=this.cbs).ontext)===null||lt===void 0||lt.call(ot,_r),(ct=(ut=this.cbs).oncdataend)===null||ct===void 0||ct.call(ut)):((pt=(dt=this.cbs).oncomment)===null||pt===void 0||pt.call(dt,"[CDATA[".concat(_r,"]]")),(gt=(ft=this.cbs).oncommentend)===null||gt===void 0||gt.call(ft)),this.startIndex=rt+1},tt.prototype.onend=function(){var et,rt;if(this.cbs.onclosetag){this.endIndex=this.startIndex;for(var nt=this.stack.length;nt>0;this.cbs.onclosetag(this.stack[--nt],!0));}(rt=(et=this.cbs).onend)===null||rt===void 0||rt.call(et)},tt.prototype.reset=function(){var et,rt,nt,it;(rt=(et=this.cbs).onreset)===null||rt===void 0||rt.call(et),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack.length=0,this.startIndex=0,this.endIndex=0,(it=(nt=this.cbs).onparserinit)===null||it===void 0||it.call(nt,this),this.buffers.length=0,this.bufferOffset=0,this.writeIndex=0,this.ended=!1},tt.prototype.parseComplete=function(et){this.reset(),this.end(et)},tt.prototype.getSlice=function(et,rt){for(;et-this.bufferOffset>=this.buffers[0].length;)this.shiftBuffer();for(var nt=this.buffers[0].slice(et-this.bufferOffset,rt-this.bufferOffset);rt-this.bufferOffset>this.buffers[0].length;)this.shiftBuffer(),nt+=this.buffers[0].slice(0,rt-this.bufferOffset);return nt},tt.prototype.shiftBuffer=function(){this.bufferOffset+=this.buffers[0].length,this.writeIndex--,this.buffers.shift()},tt.prototype.write=function(et){var rt,nt;if(this.ended){(nt=(rt=this.cbs).onerror)===null||nt===void 0||nt.call(rt,new Error(".write() after done!"));return}this.buffers.push(et),this.tokenizer.running&&(this.tokenizer.write(et),this.writeIndex++)},tt.prototype.end=function(et){var rt,nt;if(this.ended){(nt=(rt=this.cbs).onerror)===null||nt===void 0||nt.call(rt,new Error(".end() after done!"));return}et&&this.write(et),this.ended=!0,this.tokenizer.end()},tt.prototype.pause=function(){this.tokenizer.pause()},tt.prototype.resume=function(){for(this.tokenizer.resume();this.tokenizer.running&&this.writeIndex<this.buffers.length;)this.tokenizer.write(this.buffers[this.writeIndex++]);this.ended&&this.tokenizer.end()},tt.prototype.parseChunk=function(et){this.write(et)},tt.prototype.done=function(et){this.end(et)},tt}();Parser$3.Parser=Parser$2;var lib$4={},lib$3={};(function(tt){Object.defineProperty(tt,"__esModule",{value:!0}),tt.Doctype=tt.CDATA=tt.Tag=tt.Style=tt.Script=tt.Comment=tt.Directive=tt.Text=tt.Root=tt.isTag=tt.ElementType=void 0;var et;(function(nt){nt.Root="root",nt.Text="text",nt.Directive="directive",nt.Comment="comment",nt.Script="script",nt.Style="style",nt.Tag="tag",nt.CDATA="cdata",nt.Doctype="doctype"})(et=tt.ElementType||(tt.ElementType={}));function rt(nt){return nt.type===et.Tag||nt.type===et.Script||nt.type===et.Style}tt.isTag=rt,tt.Root=et.Root,tt.Text=et.Text,tt.Directive=et.Directive,tt.Comment=et.Comment,tt.Script=et.Script,tt.Style=et.Style,tt.Tag=et.Tag,tt.CDATA=et.CDATA,tt.Doctype=et.Doctype})(lib$3);var node$1={},__extends=commonjsGlobal&&commonjsGlobal.__extends||function(){var tt=function(et,rt){return tt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(nt,it){nt.__proto__=it}||function(nt,it){for(var st in it)Object.prototype.hasOwnProperty.call(it,st)&&(nt[st]=it[st])},tt(et,rt)};return function(et,rt){if(typeof rt!="function"&&rt!==null)throw new TypeError("Class extends value "+String(rt)+" is not a constructor or null");tt(et,rt);function nt(){this.constructor=et}et.prototype=rt===null?Object.create(rt):(nt.prototype=rt.prototype,new nt)}}(),__assign$2=commonjsGlobal&&commonjsGlobal.__assign||function(){return __assign$2=Object.assign||function(tt){for(var et,rt=1,nt=arguments.length;rt<nt;rt++){et=arguments[rt];for(var it in et)Object.prototype.hasOwnProperty.call(et,it)&&(tt[it]=et[it])}return tt},__assign$2.apply(this,arguments)};Object.defineProperty(node$1,"__esModule",{value:!0});node$1.cloneNode=node$1.hasChildren=node$1.isDocument=node$1.isDirective=node$1.isComment=node$1.isText=node$1.isCDATA=node$1.isTag=node$1.Element=node$1.Document=node$1.CDATA=node$1.NodeWithChildren=node$1.ProcessingInstruction=node$1.Comment=node$1.Text=node$1.DataNode=node$1.Node=void 0;var domelementtype_1$1=lib$3,Node$6=function(){function tt(){this.parent=null,this.prev=null,this.next=null,this.startIndex=null,this.endIndex=null}return Object.defineProperty(tt.prototype,"parentNode",{get:function(){return this.parent},set:function(et){this.parent=et},enumerable:!1,configurable:!0}),Object.defineProperty(tt.prototype,"previousSibling",{get:function(){return this.prev},set:function(et){this.prev=et},enumerable:!1,configurable:!0}),Object.defineProperty(tt.prototype,"nextSibling",{get:function(){return this.next},set:function(et){this.next=et},enumerable:!1,configurable:!0}),tt.prototype.cloneNode=function(et){return et===void 0&&(et=!1),cloneNode$1(this,et)},tt}();node$1.Node=Node$6;var DataNode=function(tt){__extends(et,tt);function et(rt){var nt=tt.call(this)||this;return nt.data=rt,nt}return Object.defineProperty(et.prototype,"nodeValue",{get:function(){return this.data},set:function(rt){this.data=rt},enumerable:!1,configurable:!0}),et}(Node$6);node$1.DataNode=DataNode;var Text=function(tt){__extends(et,tt);function et(){var rt=tt!==null&&tt.apply(this,arguments)||this;return rt.type=domelementtype_1$1.ElementType.Text,rt}return Object.defineProperty(et.prototype,"nodeType",{get:function(){return 3},enumerable:!1,configurable:!0}),et}(DataNode);node$1.Text=Text;var Comment$5=function(tt){__extends(et,tt);function et(){var rt=tt!==null&&tt.apply(this,arguments)||this;return rt.type=domelementtype_1$1.ElementType.Comment,rt}return Object.defineProperty(et.prototype,"nodeType",{get:function(){return 8},enumerable:!1,configurable:!0}),et}(DataNode);node$1.Comment=Comment$5;var ProcessingInstruction=function(tt){__extends(et,tt);function et(rt,nt){var it=tt.call(this,nt)||this;return it.name=rt,it.type=domelementtype_1$1.ElementType.Directive,it}return Object.defineProperty(et.prototype,"nodeType",{get:function(){return 1},enumerable:!1,configurable:!0}),et}(DataNode);node$1.ProcessingInstruction=ProcessingInstruction;var NodeWithChildren=function(tt){__extends(et,tt);function et(rt){var nt=tt.call(this)||this;return nt.children=rt,nt}return Object.defineProperty(et.prototype,"firstChild",{get:function(){var rt;return(rt=this.children[0])!==null&&rt!==void 0?rt:null},enumerable:!1,configurable:!0}),Object.defineProperty(et.prototype,"lastChild",{get:function(){return this.children.length>0?this.children[this.children.length-1]:null},enumerable:!1,configurable:!0}),Object.defineProperty(et.prototype,"childNodes",{get:function(){return this.children},set:function(rt){this.children=rt},enumerable:!1,configurable:!0}),et}(Node$6);node$1.NodeWithChildren=NodeWithChildren;var CDATA=function(tt){__extends(et,tt);function et(){var rt=tt!==null&&tt.apply(this,arguments)||this;return rt.type=domelementtype_1$1.ElementType.CDATA,rt}return Object.defineProperty(et.prototype,"nodeType",{get:function(){return 4},enumerable:!1,configurable:!0}),et}(NodeWithChildren);node$1.CDATA=CDATA;var Document$4=function(tt){__extends(et,tt);function et(){var rt=tt!==null&&tt.apply(this,arguments)||this;return rt.type=domelementtype_1$1.ElementType.Root,rt}return Object.defineProperty(et.prototype,"nodeType",{get:function(){return 9},enumerable:!1,configurable:!0}),et}(NodeWithChildren);node$1.Document=Document$4;var Element$1=function(tt){__extends(et,tt);function et(rt,nt,it,st){it===void 0&&(it=[]),st===void 0&&(st=rt==="script"?domelementtype_1$1.ElementType.Script:rt==="style"?domelementtype_1$1.ElementType.Style:domelementtype_1$1.ElementType.Tag);var ot=tt.call(this,it)||this;return ot.name=rt,ot.attribs=nt,ot.type=st,ot}return Object.defineProperty(et.prototype,"nodeType",{get:function(){return 1},enumerable:!1,configurable:!0}),Object.defineProperty(et.prototype,"tagName",{get:function(){return this.name},set:function(rt){this.name=rt},enumerable:!1,configurable:!0}),Object.defineProperty(et.prototype,"attributes",{get:function(){var rt=this;return Object.keys(this.attribs).map(function(nt){var it,st;return{name:nt,value:rt.attribs[nt],namespace:(it=rt["x-attribsNamespace"])===null||it===void 0?void 0:it[nt],prefix:(st=rt["x-attribsPrefix"])===null||st===void 0?void 0:st[nt]}})},enumerable:!1,configurable:!0}),et}(NodeWithChildren);node$1.Element=Element$1;function isTag(tt){return(0,domelementtype_1$1.isTag)(tt)}node$1.isTag=isTag;function isCDATA(tt){return tt.type===domelementtype_1$1.ElementType.CDATA}node$1.isCDATA=isCDATA;function isText(tt){return tt.type===domelementtype_1$1.ElementType.Text}node$1.isText=isText;function isComment(tt){return tt.type===domelementtype_1$1.ElementType.Comment}node$1.isComment=isComment;function isDirective(tt){return tt.type===domelementtype_1$1.ElementType.Directive}node$1.isDirective=isDirective;function isDocument(tt){return tt.type===domelementtype_1$1.ElementType.Root}node$1.isDocument=isDocument;function hasChildren(tt){return Object.prototype.hasOwnProperty.call(tt,"children")}node$1.hasChildren=hasChildren;function cloneNode$1(tt,et){et===void 0&&(et=!1);var rt;if(isText(tt))rt=new Text(tt.data);else if(isComment(tt))rt=new Comment$5(tt.data);else if(isTag(tt)){var nt=et?cloneChildren(tt.children):[],it=new Element$1(tt.name,__assign$2({},tt.attribs),nt);nt.forEach(function(ut){return ut.parent=it}),tt.namespace!=null&&(it.namespace=tt.namespace),tt["x-attribsNamespace"]&&(it["x-attribsNamespace"]=__assign$2({},tt["x-attribsNamespace"])),tt["x-attribsPrefix"]&&(it["x-attribsPrefix"]=__assign$2({},tt["x-attribsPrefix"])),rt=it}else if(isCDATA(tt)){var nt=et?cloneChildren(tt.children):[],st=new CDATA(nt);nt.forEach(function(ct){return ct.parent=st}),rt=st}else if(isDocument(tt)){var nt=et?cloneChildren(tt.children):[],ot=new Document$4(nt);nt.forEach(function(ct){return ct.parent=ot}),tt["x-mode"]&&(ot["x-mode"]=tt["x-mode"]),rt=ot}else if(isDirective(tt)){var lt=new ProcessingInstruction(tt.name,tt.data);tt["x-name"]!=null&&(lt["x-name"]=tt["x-name"],lt["x-publicId"]=tt["x-publicId"],lt["x-systemId"]=tt["x-systemId"]),rt=lt}else throw new Error("Not implemented yet: ".concat(tt.type));return rt.startIndex=tt.startIndex,rt.endIndex=tt.endIndex,tt.sourceCodeLocation!=null&&(rt.sourceCodeLocation=tt.sourceCodeLocation),rt}node$1.cloneNode=cloneNode$1;function cloneChildren(tt){for(var et=tt.map(function(nt){return cloneNode$1(nt,!0)}),rt=1;rt<et.length;rt++)et[rt].prev=et[rt-1],et[rt-1].next=et[rt];return et}(function(tt){var et=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(lt,ut,ct,dt){dt===void 0&&(dt=ct);var pt=Object.getOwnPropertyDescriptor(ut,ct);(!pt||("get"in pt?!ut.__esModule:pt.writable||pt.configurable))&&(pt={enumerable:!0,get:function(){return ut[ct]}}),Object.defineProperty(lt,dt,pt)}:function(lt,ut,ct,dt){dt===void 0&&(dt=ct),lt[dt]=ut[ct]}),rt=commonjsGlobal&&commonjsGlobal.__exportStar||function(lt,ut){for(var ct in lt)ct!=="default"&&!Object.prototype.hasOwnProperty.call(ut,ct)&&et(ut,lt,ct)};Object.defineProperty(tt,"__esModule",{value:!0}),tt.DomHandler=void 0;var nt=lib$3,it=node$1;rt(node$1,tt);var st={withStartIndices:!1,withEndIndices:!1,xmlMode:!1},ot=function(){function lt(ut,ct,dt){this.dom=[],this.root=new it.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null,typeof ct=="function"&&(dt=ct,ct=st),typeof ut=="object"&&(ct=ut,ut=void 0),this.callback=ut??null,this.options=ct??st,this.elementCB=dt??null}return lt.prototype.onparserinit=function(ut){this.parser=ut},lt.prototype.onreset=function(){this.dom=[],this.root=new it.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null},lt.prototype.onend=function(){this.done||(this.done=!0,this.parser=null,this.handleCallback(null))},lt.prototype.onerror=function(ut){this.handleCallback(ut)},lt.prototype.onclosetag=function(){this.lastNode=null;var ut=this.tagStack.pop();this.options.withEndIndices&&(ut.endIndex=this.parser.endIndex),this.elementCB&&this.elementCB(ut)},lt.prototype.onopentag=function(ut,ct){var dt=this.options.xmlMode?nt.ElementType.Tag:void 0,pt=new it.Element(ut,ct,void 0,dt);this.addNode(pt),this.tagStack.push(pt)},lt.prototype.ontext=function(ut){var ct=this.lastNode;if(ct&&ct.type===nt.ElementType.Text)ct.data+=ut,this.options.withEndIndices&&(ct.endIndex=this.parser.endIndex);else{var dt=new it.Text(ut);this.addNode(dt),this.lastNode=dt}},lt.prototype.oncomment=function(ut){if(this.lastNode&&this.lastNode.type===nt.ElementType.Comment){this.lastNode.data+=ut;return}var ct=new it.Comment(ut);this.addNode(ct),this.lastNode=ct},lt.prototype.oncommentend=function(){this.lastNode=null},lt.prototype.oncdatastart=function(){var ut=new it.Text(""),ct=new it.CDATA([ut]);this.addNode(ct),ut.parent=ct,this.lastNode=ut},lt.prototype.oncdataend=function(){this.lastNode=null},lt.prototype.onprocessinginstruction=function(ut,ct){var dt=new it.ProcessingInstruction(ut,ct);this.addNode(dt)},lt.prototype.handleCallback=function(ut){if(typeof this.callback=="function")this.callback(ut,this.dom);else if(ut)throw ut},lt.prototype.addNode=function(ut){var ct=this.tagStack[this.tagStack.length-1],dt=ct.children[ct.children.length-1];this.options.withStartIndices&&(ut.startIndex=this.parser.startIndex),this.options.withEndIndices&&(ut.endIndex=this.parser.endIndex),ct.children.push(ut),dt&&(ut.prev=dt,dt.next=ut),ut.parent=ct,this.lastNode=null},lt}();tt.DomHandler=ot,tt.default=ot})(lib$4);var lib$2={},stringify$5={},lib$1={},lib={},encode={},encodeHtml={};Object.defineProperty(encodeHtml,"__esModule",{value:!0});function restoreDiff(tt){for(var et=1;et<tt.length;et++)tt[et][0]+=tt[et-1][0]+1;return tt}encodeHtml.default=new Map(restoreDiff([[9,"&Tab;"],[0,"&NewLine;"],[22,"&excl;"],[0,"&quot;"],[0,"&num;"],[0,"&dollar;"],[0,"&percnt;"],[0,"&amp;"],[0,"&apos;"],[0,"&lpar;"],[0,"&rpar;"],[0,"&ast;"],[0,"&plus;"],[0,"&comma;"],[1,"&period;"],[0,"&sol;"],[10,"&colon;"],[0,"&semi;"],[0,{v:"&lt;",n:8402,o:"&nvlt;"}],[0,{v:"&equals;",n:8421,o:"&bne;"}],[0,{v:"&gt;",n:8402,o:"&nvgt;"}],[0,"&quest;"],[0,"&commat;"],[26,"&lbrack;"],[0,"&bsol;"],[0,"&rbrack;"],[0,"&Hat;"],[0,"&lowbar;"],[0,"&DiacriticalGrave;"],[5,{n:106,o:"&fjlig;"}],[20,"&lbrace;"],[0,"&verbar;"],[0,"&rbrace;"],[34,"&nbsp;"],[0,"&iexcl;"],[0,"&cent;"],[0,"&pound;"],[0,"&curren;"],[0,"&yen;"],[0,"&brvbar;"],[0,"&sect;"],[0,"&die;"],[0,"&copy;"],[0,"&ordf;"],[0,"&laquo;"],[0,"&not;"],[0,"&shy;"],[0,"&circledR;"],[0,"&macr;"],[0,"&deg;"],[0,"&PlusMinus;"],[0,"&sup2;"],[0,"&sup3;"],[0,"&acute;"],[0,"&micro;"],[0,"&para;"],[0,"&centerdot;"],[0,"&cedil;"],[0,"&sup1;"],[0,"&ordm;"],[0,"&raquo;"],[0,"&frac14;"],[0,"&frac12;"],[0,"&frac34;"],[0,"&iquest;"],[0,"&Agrave;"],[0,"&Aacute;"],[0,"&Acirc;"],[0,"&Atilde;"],[0,"&Auml;"],[0,"&angst;"],[0,"&AElig;"],[0,"&Ccedil;"],[0,"&Egrave;"],[0,"&Eacute;"],[0,"&Ecirc;"],[0,"&Euml;"],[0,"&Igrave;"],[0,"&Iacute;"],[0,"&Icirc;"],[0,"&Iuml;"],[0,"&ETH;"],[0,"&Ntilde;"],[0,"&Ograve;"],[0,"&Oacute;"],[0,"&Ocirc;"],[0,"&Otilde;"],[0,"&Ouml;"],[0,"&times;"],[0,"&Oslash;"],[0,"&Ugrave;"],[0,"&Uacute;"],[0,"&Ucirc;"],[0,"&Uuml;"],[0,"&Yacute;"],[0,"&THORN;"],[0,"&szlig;"],[0,"&agrave;"],[0,"&aacute;"],[0,"&acirc;"],[0,"&atilde;"],[0,"&auml;"],[0,"&aring;"],[0,"&aelig;"],[0,"&ccedil;"],[0,"&egrave;"],[0,"&eacute;"],[0,"&ecirc;"],[0,"&euml;"],[0,"&igrave;"],[0,"&iacute;"],[0,"&icirc;"],[0,"&iuml;"],[0,"&eth;"],[0,"&ntilde;"],[0,"&ograve;"],[0,"&oacute;"],[0,"&ocirc;"],[0,"&otilde;"],[0,"&ouml;"],[0,"&div;"],[0,"&oslash;"],[0,"&ugrave;"],[0,"&uacute;"],[0,"&ucirc;"],[0,"&uuml;"],[0,"&yacute;"],[0,"&thorn;"],[0,"&yuml;"],[0,"&Amacr;"],[0,"&amacr;"],[0,"&Abreve;"],[0,"&abreve;"],[0,"&Aogon;"],[0,"&aogon;"],[0,"&Cacute;"],[0,"&cacute;"],[0,"&Ccirc;"],[0,"&ccirc;"],[0,"&Cdot;"],[0,"&cdot;"],[0,"&Ccaron;"],[0,"&ccaron;"],[0,"&Dcaron;"],[0,"&dcaron;"],[0,"&Dstrok;"],[0,"&dstrok;"],[0,"&Emacr;"],[0,"&emacr;"],[2,"&Edot;"],[0,"&edot;"],[0,"&Eogon;"],[0,"&eogon;"],[0,"&Ecaron;"],[0,"&ecaron;"],[0,"&Gcirc;"],[0,"&gcirc;"],[0,"&Gbreve;"],[0,"&gbreve;"],[0,"&Gdot;"],[0,"&gdot;"],[0,"&Gcedil;"],[1,"&Hcirc;"],[0,"&hcirc;"],[0,"&Hstrok;"],[0,"&hstrok;"],[0,"&Itilde;"],[0,"&itilde;"],[0,"&Imacr;"],[0,"&imacr;"],[2,"&Iogon;"],[0,"&iogon;"],[0,"&Idot;"],[0,"&imath;"],[0,"&IJlig;"],[0,"&ijlig;"],[0,"&Jcirc;"],[0,"&jcirc;"],[0,"&Kcedil;"],[0,"&kcedil;"],[0,"&kgreen;"],[0,"&Lacute;"],[0,"&lacute;"],[0,"&Lcedil;"],[0,"&lcedil;"],[0,"&Lcaron;"],[0,"&lcaron;"],[0,"&Lmidot;"],[0,"&lmidot;"],[0,"&Lstrok;"],[0,"&lstrok;"],[0,"&Nacute;"],[0,"&nacute;"],[0,"&Ncedil;"],[0,"&ncedil;"],[0,"&Ncaron;"],[0,"&ncaron;"],[0,"&napos;"],[0,"&ENG;"],[0,"&eng;"],[0,"&Omacr;"],[0,"&omacr;"],[2,"&Odblac;"],[0,"&odblac;"],[0,"&OElig;"],[0,"&oelig;"],[0,"&Racute;"],[0,"&racute;"],[0,"&Rcedil;"],[0,"&rcedil;"],[0,"&Rcaron;"],[0,"&rcaron;"],[0,"&Sacute;"],[0,"&sacute;"],[0,"&Scirc;"],[0,"&scirc;"],[0,"&Scedil;"],[0,"&scedil;"],[0,"&Scaron;"],[0,"&scaron;"],[0,"&Tcedil;"],[0,"&tcedil;"],[0,"&Tcaron;"],[0,"&tcaron;"],[0,"&Tstrok;"],[0,"&tstrok;"],[0,"&Utilde;"],[0,"&utilde;"],[0,"&Umacr;"],[0,"&umacr;"],[0,"&Ubreve;"],[0,"&ubreve;"],[0,"&Uring;"],[0,"&uring;"],[0,"&Udblac;"],[0,"&udblac;"],[0,"&Uogon;"],[0,"&uogon;"],[0,"&Wcirc;"],[0,"&wcirc;"],[0,"&Ycirc;"],[0,"&ycirc;"],[0,"&Yuml;"],[0,"&Zacute;"],[0,"&zacute;"],[0,"&Zdot;"],[0,"&zdot;"],[0,"&Zcaron;"],[0,"&zcaron;"],[19,"&fnof;"],[34,"&imped;"],[63,"&gacute;"],[65,"&jmath;"],[142,"&circ;"],[0,"&caron;"],[16,"&breve;"],[0,"&DiacriticalDot;"],[0,"&ring;"],[0,"&ogon;"],[0,"&DiacriticalTilde;"],[0,"&dblac;"],[51,"&DownBreve;"],[127,"&Alpha;"],[0,"&Beta;"],[0,"&Gamma;"],[0,"&Delta;"],[0,"&Epsilon;"],[0,"&Zeta;"],[0,"&Eta;"],[0,"&Theta;"],[0,"&Iota;"],[0,"&Kappa;"],[0,"&Lambda;"],[0,"&Mu;"],[0,"&Nu;"],[0,"&Xi;"],[0,"&Omicron;"],[0,"&Pi;"],[0,"&Rho;"],[1,"&Sigma;"],[0,"&Tau;"],[0,"&Upsilon;"],[0,"&Phi;"],[0,"&Chi;"],[0,"&Psi;"],[0,"&ohm;"],[7,"&alpha;"],[0,"&beta;"],[0,"&gamma;"],[0,"&delta;"],[0,"&epsi;"],[0,"&zeta;"],[0,"&eta;"],[0,"&theta;"],[0,"&iota;"],[0,"&kappa;"],[0,"&lambda;"],[0,"&mu;"],[0,"&nu;"],[0,"&xi;"],[0,"&omicron;"],[0,"&pi;"],[0,"&rho;"],[0,"&sigmaf;"],[0,"&sigma;"],[0,"&tau;"],[0,"&upsi;"],[0,"&phi;"],[0,"&chi;"],[0,"&psi;"],[0,"&omega;"],[7,"&thetasym;"],[0,"&Upsi;"],[2,"&phiv;"],[0,"&piv;"],[5,"&Gammad;"],[0,"&digamma;"],[18,"&kappav;"],[0,"&rhov;"],[3,"&epsiv;"],[0,"&backepsilon;"],[10,"&IOcy;"],[0,"&DJcy;"],[0,"&GJcy;"],[0,"&Jukcy;"],[0,"&DScy;"],[0,"&Iukcy;"],[0,"&YIcy;"],[0,"&Jsercy;"],[0,"&LJcy;"],[0,"&NJcy;"],[0,"&TSHcy;"],[0,"&KJcy;"],[1,"&Ubrcy;"],[0,"&DZcy;"],[0,"&Acy;"],[0,"&Bcy;"],[0,"&Vcy;"],[0,"&Gcy;"],[0,"&Dcy;"],[0,"&IEcy;"],[0,"&ZHcy;"],[0,"&Zcy;"],[0,"&Icy;"],[0,"&Jcy;"],[0,"&Kcy;"],[0,"&Lcy;"],[0,"&Mcy;"],[0,"&Ncy;"],[0,"&Ocy;"],[0,"&Pcy;"],[0,"&Rcy;"],[0,"&Scy;"],[0,"&Tcy;"],[0,"&Ucy;"],[0,"&Fcy;"],[0,"&KHcy;"],[0,"&TScy;"],[0,"&CHcy;"],[0,"&SHcy;"],[0,"&SHCHcy;"],[0,"&HARDcy;"],[0,"&Ycy;"],[0,"&SOFTcy;"],[0,"&Ecy;"],[0,"&YUcy;"],[0,"&YAcy;"],[0,"&acy;"],[0,"&bcy;"],[0,"&vcy;"],[0,"&gcy;"],[0,"&dcy;"],[0,"&iecy;"],[0,"&zhcy;"],[0,"&zcy;"],[0,"&icy;"],[0,"&jcy;"],[0,"&kcy;"],[0,"&lcy;"],[0,"&mcy;"],[0,"&ncy;"],[0,"&ocy;"],[0,"&pcy;"],[0,"&rcy;"],[0,"&scy;"],[0,"&tcy;"],[0,"&ucy;"],[0,"&fcy;"],[0,"&khcy;"],[0,"&tscy;"],[0,"&chcy;"],[0,"&shcy;"],[0,"&shchcy;"],[0,"&hardcy;"],[0,"&ycy;"],[0,"&softcy;"],[0,"&ecy;"],[0,"&yucy;"],[0,"&yacy;"],[1,"&iocy;"],[0,"&djcy;"],[0,"&gjcy;"],[0,"&jukcy;"],[0,"&dscy;"],[0,"&iukcy;"],[0,"&yicy;"],[0,"&jsercy;"],[0,"&ljcy;"],[0,"&njcy;"],[0,"&tshcy;"],[0,"&kjcy;"],[1,"&ubrcy;"],[0,"&dzcy;"],[7074,"&ensp;"],[0,"&emsp;"],[0,"&emsp13;"],[0,"&emsp14;"],[1,"&numsp;"],[0,"&puncsp;"],[0,"&ThinSpace;"],[0,"&hairsp;"],[0,"&NegativeMediumSpace;"],[0,"&zwnj;"],[0,"&zwj;"],[0,"&lrm;"],[0,"&rlm;"],[0,"&dash;"],[2,"&ndash;"],[0,"&mdash;"],[0,"&horbar;"],[0,"&Verbar;"],[1,"&lsquo;"],[0,"&CloseCurlyQuote;"],[0,"&lsquor;"],[1,"&ldquo;"],[0,"&CloseCurlyDoubleQuote;"],[0,"&bdquo;"],[1,"&dagger;"],[0,"&Dagger;"],[0,"&bull;"],[2,"&nldr;"],[0,"&hellip;"],[9,"&permil;"],[0,"&pertenk;"],[0,"&prime;"],[0,"&Prime;"],[0,"&tprime;"],[0,"&backprime;"],[3,"&lsaquo;"],[0,"&rsaquo;"],[3,"&oline;"],[2,"&caret;"],[1,"&hybull;"],[0,"&frasl;"],[10,"&bsemi;"],[7,"&qprime;"],[7,{v:"&MediumSpace;",n:8202,o:"&ThickSpace;"}],[0,"&NoBreak;"],[0,"&af;"],[0,"&InvisibleTimes;"],[0,"&ic;"],[72,"&euro;"],[46,"&tdot;"],[0,"&DotDot;"],[37,"&complexes;"],[2,"&incare;"],[4,"&gscr;"],[0,"&hamilt;"],[0,"&Hfr;"],[0,"&Hopf;"],[0,"&planckh;"],[0,"&hbar;"],[0,"&imagline;"],[0,"&Ifr;"],[0,"&lagran;"],[0,"&ell;"],[1,"&naturals;"],[0,"&numero;"],[0,"&copysr;"],[0,"&weierp;"],[0,"&Popf;"],[0,"&Qopf;"],[0,"&realine;"],[0,"&real;"],[0,"&reals;"],[0,"&rx;"],[3,"&trade;"],[1,"&integers;"],[2,"&mho;"],[0,"&zeetrf;"],[0,"&iiota;"],[2,"&bernou;"],[0,"&Cayleys;"],[1,"&escr;"],[0,"&Escr;"],[0,"&Fouriertrf;"],[1,"&Mellintrf;"],[0,"&order;"],[0,"&alefsym;"],[0,"&beth;"],[0,"&gimel;"],[0,"&daleth;"],[12,"&CapitalDifferentialD;"],[0,"&dd;"],[0,"&ee;"],[0,"&ii;"],[10,"&frac13;"],[0,"&frac23;"],[0,"&frac15;"],[0,"&frac25;"],[0,"&frac35;"],[0,"&frac45;"],[0,"&frac16;"],[0,"&frac56;"],[0,"&frac18;"],[0,"&frac38;"],[0,"&frac58;"],[0,"&frac78;"],[49,"&larr;"],[0,"&ShortUpArrow;"],[0,"&rarr;"],[0,"&darr;"],[0,"&harr;"],[0,"&updownarrow;"],[0,"&nwarr;"],[0,"&nearr;"],[0,"&LowerRightArrow;"],[0,"&LowerLeftArrow;"],[0,"&nlarr;"],[0,"&nrarr;"],[1,{v:"&rarrw;",n:824,o:"&nrarrw;"}],[0,"&Larr;"],[0,"&Uarr;"],[0,"&Rarr;"],[0,"&Darr;"],[0,"&larrtl;"],[0,"&rarrtl;"],[0,"&LeftTeeArrow;"],[0,"&mapstoup;"],[0,"&map;"],[0,"&DownTeeArrow;"],[1,"&hookleftarrow;"],[0,"&hookrightarrow;"],[0,"&larrlp;"],[0,"&looparrowright;"],[0,"&harrw;"],[0,"&nharr;"],[1,"&lsh;"],[0,"&rsh;"],[0,"&ldsh;"],[0,"&rdsh;"],[1,"&crarr;"],[0,"&cularr;"],[0,"&curarr;"],[2,"&circlearrowleft;"],[0,"&circlearrowright;"],[0,"&leftharpoonup;"],[0,"&DownLeftVector;"],[0,"&RightUpVector;"],[0,"&LeftUpVector;"],[0,"&rharu;"],[0,"&DownRightVector;"],[0,"&dharr;"],[0,"&dharl;"],[0,"&RightArrowLeftArrow;"],[0,"&udarr;"],[0,"&LeftArrowRightArrow;"],[0,"&leftleftarrows;"],[0,"&upuparrows;"],[0,"&rightrightarrows;"],[0,"&ddarr;"],[0,"&leftrightharpoons;"],[0,"&Equilibrium;"],[0,"&nlArr;"],[0,"&nhArr;"],[0,"&nrArr;"],[0,"&DoubleLeftArrow;"],[0,"&DoubleUpArrow;"],[0,"&DoubleRightArrow;"],[0,"&dArr;"],[0,"&DoubleLeftRightArrow;"],[0,"&DoubleUpDownArrow;"],[0,"&nwArr;"],[0,"&neArr;"],[0,"&seArr;"],[0,"&swArr;"],[0,"&lAarr;"],[0,"&rAarr;"],[1,"&zigrarr;"],[6,"&larrb;"],[0,"&rarrb;"],[15,"&DownArrowUpArrow;"],[7,"&loarr;"],[0,"&roarr;"],[0,"&hoarr;"],[0,"&forall;"],[0,"&comp;"],[0,{v:"&part;",n:824,o:"&npart;"}],[0,"&exist;"],[0,"&nexist;"],[0,"&empty;"],[1,"&Del;"],[0,"&Element;"],[0,"&NotElement;"],[1,"&ni;"],[0,"&notni;"],[2,"&prod;"],[0,"&coprod;"],[0,"&sum;"],[0,"&minus;"],[0,"&MinusPlus;"],[0,"&dotplus;"],[1,"&Backslash;"],[0,"&lowast;"],[0,"&compfn;"],[1,"&radic;"],[2,"&prop;"],[0,"&infin;"],[0,"&angrt;"],[0,{v:"&ang;",n:8402,o:"&nang;"}],[0,"&angmsd;"],[0,"&angsph;"],[0,"&mid;"],[0,"&nmid;"],[0,"&DoubleVerticalBar;"],[0,"&NotDoubleVerticalBar;"],[0,"&and;"],[0,"&or;"],[0,{v:"&cap;",n:65024,o:"&caps;"}],[0,{v:"&cup;",n:65024,o:"&cups;"}],[0,"&int;"],[0,"&Int;"],[0,"&iiint;"],[0,"&conint;"],[0,"&Conint;"],[0,"&Cconint;"],[0,"&cwint;"],[0,"&ClockwiseContourIntegral;"],[0,"&awconint;"],[0,"&there4;"],[0,"&becaus;"],[0,"&ratio;"],[0,"&Colon;"],[0,"&dotminus;"],[1,"&mDDot;"],[0,"&homtht;"],[0,{v:"&sim;",n:8402,o:"&nvsim;"}],[0,{v:"&backsim;",n:817,o:"&race;"}],[0,{v:"&ac;",n:819,o:"&acE;"}],[0,"&acd;"],[0,"&VerticalTilde;"],[0,"&NotTilde;"],[0,{v:"&eqsim;",n:824,o:"&nesim;"}],[0,"&sime;"],[0,"&NotTildeEqual;"],[0,"&cong;"],[0,"&simne;"],[0,"&ncong;"],[0,"&ap;"],[0,"&nap;"],[0,"&ape;"],[0,{v:"&apid;",n:824,o:"&napid;"}],[0,"&backcong;"],[0,{v:"&asympeq;",n:8402,o:"&nvap;"}],[0,{v:"&bump;",n:824,o:"&nbump;"}],[0,{v:"&bumpe;",n:824,o:"&nbumpe;"}],[0,{v:"&doteq;",n:824,o:"&nedot;"}],[0,"&doteqdot;"],[0,"&efDot;"],[0,"&erDot;"],[0,"&Assign;"],[0,"&ecolon;"],[0,"&ecir;"],[0,"&circeq;"],[1,"&wedgeq;"],[0,"&veeeq;"],[1,"&triangleq;"],[2,"&equest;"],[0,"&ne;"],[0,{v:"&Congruent;",n:8421,o:"&bnequiv;"}],[0,"&nequiv;"],[1,{v:"&le;",n:8402,o:"&nvle;"}],[0,{v:"&ge;",n:8402,o:"&nvge;"}],[0,{v:"&lE;",n:824,o:"&nlE;"}],[0,{v:"&gE;",n:824,o:"&ngE;"}],[0,{v:"&lnE;",n:65024,o:"&lvertneqq;"}],[0,{v:"&gnE;",n:65024,o:"&gvertneqq;"}],[0,{v:"&ll;",n:new Map(restoreDiff([[824,"&nLtv;"],[7577,"&nLt;"]]))}],[0,{v:"&gg;",n:new Map(restoreDiff([[824,"&nGtv;"],[7577,"&nGt;"]]))}],[0,"&between;"],[0,"&NotCupCap;"],[0,"&nless;"],[0,"&ngt;"],[0,"&nle;"],[0,"&nge;"],[0,"&lesssim;"],[0,"&GreaterTilde;"],[0,"&nlsim;"],[0,"&ngsim;"],[0,"&LessGreater;"],[0,"&gl;"],[0,"&NotLessGreater;"],[0,"&NotGreaterLess;"],[0,"&pr;"],[0,"&sc;"],[0,"&prcue;"],[0,"&sccue;"],[0,"&PrecedesTilde;"],[0,{v:"&scsim;",n:824,o:"&NotSucceedsTilde;"}],[0,"&NotPrecedes;"],[0,"&NotSucceeds;"],[0,{v:"&sub;",n:8402,o:"&NotSubset;"}],[0,{v:"&sup;",n:8402,o:"&NotSuperset;"}],[0,"&nsub;"],[0,"&nsup;"],[0,"&sube;"],[0,"&supe;"],[0,"&NotSubsetEqual;"],[0,"&NotSupersetEqual;"],[0,{v:"&subne;",n:65024,o:"&varsubsetneq;"}],[0,{v:"&supne;",n:65024,o:"&varsupsetneq;"}],[1,"&cupdot;"],[0,"&UnionPlus;"],[0,{v:"&sqsub;",n:824,o:"&NotSquareSubset;"}],[0,{v:"&sqsup;",n:824,o:"&NotSquareSuperset;"}],[0,"&sqsube;"],[0,"&sqsupe;"],[0,{v:"&sqcap;",n:65024,o:"&sqcaps;"}],[0,{v:"&sqcup;",n:65024,o:"&sqcups;"}],[0,"&CirclePlus;"],[0,"&CircleMinus;"],[0,"&CircleTimes;"],[0,"&osol;"],[0,"&CircleDot;"],[0,"&circledcirc;"],[0,"&circledast;"],[1,"&circleddash;"],[0,"&boxplus;"],[0,"&boxminus;"],[0,"&boxtimes;"],[0,"&dotsquare;"],[0,"&RightTee;"],[0,"&dashv;"],[0,"&DownTee;"],[0,"&bot;"],[1,"&models;"],[0,"&DoubleRightTee;"],[0,"&Vdash;"],[0,"&Vvdash;"],[0,"&VDash;"],[0,"&nvdash;"],[0,"&nvDash;"],[0,"&nVdash;"],[0,"&nVDash;"],[0,"&prurel;"],[1,"&LeftTriangle;"],[0,"&RightTriangle;"],[0,{v:"&LeftTriangleEqual;",n:8402,o:"&nvltrie;"}],[0,{v:"&RightTriangleEqual;",n:8402,o:"&nvrtrie;"}],[0,"&origof;"],[0,"&imof;"],[0,"&multimap;"],[0,"&hercon;"],[0,"&intcal;"],[0,"&veebar;"],[1,"&barvee;"],[0,"&angrtvb;"],[0,"&lrtri;"],[0,"&bigwedge;"],[0,"&bigvee;"],[0,"&bigcap;"],[0,"&bigcup;"],[0,"&diam;"],[0,"&sdot;"],[0,"&sstarf;"],[0,"&divideontimes;"],[0,"&bowtie;"],[0,"&ltimes;"],[0,"&rtimes;"],[0,"&leftthreetimes;"],[0,"&rightthreetimes;"],[0,"&backsimeq;"],[0,"&curlyvee;"],[0,"&curlywedge;"],[0,"&Sub;"],[0,"&Sup;"],[0,"&Cap;"],[0,"&Cup;"],[0,"&fork;"],[0,"&epar;"],[0,"&lessdot;"],[0,"&gtdot;"],[0,{v:"&Ll;",n:824,o:"&nLl;"}],[0,{v:"&Gg;",n:824,o:"&nGg;"}],[0,{v:"&leg;",n:65024,o:"&lesg;"}],[0,{v:"&gel;",n:65024,o:"&gesl;"}],[2,"&cuepr;"],[0,"&cuesc;"],[0,"&NotPrecedesSlantEqual;"],[0,"&NotSucceedsSlantEqual;"],[0,"&NotSquareSubsetEqual;"],[0,"&NotSquareSupersetEqual;"],[2,"&lnsim;"],[0,"&gnsim;"],[0,"&precnsim;"],[0,"&scnsim;"],[0,"&nltri;"],[0,"&NotRightTriangle;"],[0,"&nltrie;"],[0,"&NotRightTriangleEqual;"],[0,"&vellip;"],[0,"&ctdot;"],[0,"&utdot;"],[0,"&dtdot;"],[0,"&disin;"],[0,"&isinsv;"],[0,"&isins;"],[0,{v:"&isindot;",n:824,o:"&notindot;"}],[0,"&notinvc;"],[0,"&notinvb;"],[1,{v:"&isinE;",n:824,o:"&notinE;"}],[0,"&nisd;"],[0,"&xnis;"],[0,"&nis;"],[0,"&notnivc;"],[0,"&notnivb;"],[6,"&barwed;"],[0,"&Barwed;"],[1,"&lceil;"],[0,"&rceil;"],[0,"&LeftFloor;"],[0,"&rfloor;"],[0,"&drcrop;"],[0,"&dlcrop;"],[0,"&urcrop;"],[0,"&ulcrop;"],[0,"&bnot;"],[1,"&profline;"],[0,"&profsurf;"],[1,"&telrec;"],[0,"&target;"],[5,"&ulcorn;"],[0,"&urcorn;"],[0,"&dlcorn;"],[0,"&drcorn;"],[2,"&frown;"],[0,"&smile;"],[9,"&cylcty;"],[0,"&profalar;"],[7,"&topbot;"],[6,"&ovbar;"],[1,"&solbar;"],[60,"&angzarr;"],[51,"&lmoustache;"],[0,"&rmoustache;"],[2,"&OverBracket;"],[0,"&bbrk;"],[0,"&bbrktbrk;"],[37,"&OverParenthesis;"],[0,"&UnderParenthesis;"],[0,"&OverBrace;"],[0,"&UnderBrace;"],[2,"&trpezium;"],[4,"&elinters;"],[59,"&blank;"],[164,"&circledS;"],[55,"&boxh;"],[1,"&boxv;"],[9,"&boxdr;"],[3,"&boxdl;"],[3,"&boxur;"],[3,"&boxul;"],[3,"&boxvr;"],[7,"&boxvl;"],[7,"&boxhd;"],[7,"&boxhu;"],[7,"&boxvh;"],[19,"&boxH;"],[0,"&boxV;"],[0,"&boxdR;"],[0,"&boxDr;"],[0,"&boxDR;"],[0,"&boxdL;"],[0,"&boxDl;"],[0,"&boxDL;"],[0,"&boxuR;"],[0,"&boxUr;"],[0,"&boxUR;"],[0,"&boxuL;"],[0,"&boxUl;"],[0,"&boxUL;"],[0,"&boxvR;"],[0,"&boxVr;"],[0,"&boxVR;"],[0,"&boxvL;"],[0,"&boxVl;"],[0,"&boxVL;"],[0,"&boxHd;"],[0,"&boxhD;"],[0,"&boxHD;"],[0,"&boxHu;"],[0,"&boxhU;"],[0,"&boxHU;"],[0,"&boxvH;"],[0,"&boxVh;"],[0,"&boxVH;"],[19,"&uhblk;"],[3,"&lhblk;"],[3,"&block;"],[8,"&blk14;"],[0,"&blk12;"],[0,"&blk34;"],[13,"&square;"],[8,"&blacksquare;"],[0,"&EmptyVerySmallSquare;"],[1,"&rect;"],[0,"&marker;"],[2,"&fltns;"],[1,"&bigtriangleup;"],[0,"&blacktriangle;"],[0,"&triangle;"],[2,"&blacktriangleright;"],[0,"&rtri;"],[3,"&bigtriangledown;"],[0,"&blacktriangledown;"],[0,"&dtri;"],[2,"&blacktriangleleft;"],[0,"&ltri;"],[6,"&loz;"],[0,"&cir;"],[32,"&tridot;"],[2,"&bigcirc;"],[8,"&ultri;"],[0,"&urtri;"],[0,"&lltri;"],[0,"&EmptySmallSquare;"],[0,"&FilledSmallSquare;"],[8,"&bigstar;"],[0,"&star;"],[7,"&phone;"],[49,"&female;"],[1,"&male;"],[29,"&spades;"],[2,"&clubs;"],[1,"&hearts;"],[0,"&diamondsuit;"],[3,"&sung;"],[2,"&flat;"],[0,"&natural;"],[0,"&sharp;"],[163,"&check;"],[3,"&cross;"],[8,"&malt;"],[21,"&sext;"],[33,"&VerticalSeparator;"],[25,"&lbbrk;"],[0,"&rbbrk;"],[84,"&bsolhsub;"],[0,"&suphsol;"],[28,"&LeftDoubleBracket;"],[0,"&RightDoubleBracket;"],[0,"&lang;"],[0,"&rang;"],[0,"&Lang;"],[0,"&Rang;"],[0,"&loang;"],[0,"&roang;"],[7,"&longleftarrow;"],[0,"&longrightarrow;"],[0,"&longleftrightarrow;"],[0,"&DoubleLongLeftArrow;"],[0,"&DoubleLongRightArrow;"],[0,"&DoubleLongLeftRightArrow;"],[1,"&longmapsto;"],[2,"&dzigrarr;"],[258,"&nvlArr;"],[0,"&nvrArr;"],[0,"&nvHarr;"],[0,"&Map;"],[6,"&lbarr;"],[0,"&bkarow;"],[0,"&lBarr;"],[0,"&dbkarow;"],[0,"&drbkarow;"],[0,"&DDotrahd;"],[0,"&UpArrowBar;"],[0,"&DownArrowBar;"],[2,"&Rarrtl;"],[2,"&latail;"],[0,"&ratail;"],[0,"&lAtail;"],[0,"&rAtail;"],[0,"&larrfs;"],[0,"&rarrfs;"],[0,"&larrbfs;"],[0,"&rarrbfs;"],[2,"&nwarhk;"],[0,"&nearhk;"],[0,"&hksearow;"],[0,"&hkswarow;"],[0,"&nwnear;"],[0,"&nesear;"],[0,"&seswar;"],[0,"&swnwar;"],[8,{v:"&rarrc;",n:824,o:"&nrarrc;"}],[1,"&cudarrr;"],[0,"&ldca;"],[0,"&rdca;"],[0,"&cudarrl;"],[0,"&larrpl;"],[2,"&curarrm;"],[0,"&cularrp;"],[7,"&rarrpl;"],[2,"&harrcir;"],[0,"&Uarrocir;"],[0,"&lurdshar;"],[0,"&ldrushar;"],[2,"&LeftRightVector;"],[0,"&RightUpDownVector;"],[0,"&DownLeftRightVector;"],[0,"&LeftUpDownVector;"],[0,"&LeftVectorBar;"],[0,"&RightVectorBar;"],[0,"&RightUpVectorBar;"],[0,"&RightDownVectorBar;"],[0,"&DownLeftVectorBar;"],[0,"&DownRightVectorBar;"],[0,"&LeftUpVectorBar;"],[0,"&LeftDownVectorBar;"],[0,"&LeftTeeVector;"],[0,"&RightTeeVector;"],[0,"&RightUpTeeVector;"],[0,"&RightDownTeeVector;"],[0,"&DownLeftTeeVector;"],[0,"&DownRightTeeVector;"],[0,"&LeftUpTeeVector;"],[0,"&LeftDownTeeVector;"],[0,"&lHar;"],[0,"&uHar;"],[0,"&rHar;"],[0,"&dHar;"],[0,"&luruhar;"],[0,"&ldrdhar;"],[0,"&ruluhar;"],[0,"&rdldhar;"],[0,"&lharul;"],[0,"&llhard;"],[0,"&rharul;"],[0,"&lrhard;"],[0,"&udhar;"],[0,"&duhar;"],[0,"&RoundImplies;"],[0,"&erarr;"],[0,"&simrarr;"],[0,"&larrsim;"],[0,"&rarrsim;"],[0,"&rarrap;"],[0,"&ltlarr;"],[1,"&gtrarr;"],[0,"&subrarr;"],[1,"&suplarr;"],[0,"&lfisht;"],[0,"&rfisht;"],[0,"&ufisht;"],[0,"&dfisht;"],[5,"&lopar;"],[0,"&ropar;"],[4,"&lbrke;"],[0,"&rbrke;"],[0,"&lbrkslu;"],[0,"&rbrksld;"],[0,"&lbrksld;"],[0,"&rbrkslu;"],[0,"&langd;"],[0,"&rangd;"],[0,"&lparlt;"],[0,"&rpargt;"],[0,"&gtlPar;"],[0,"&ltrPar;"],[3,"&vzigzag;"],[1,"&vangrt;"],[0,"&angrtvbd;"],[6,"&ange;"],[0,"&range;"],[0,"&dwangle;"],[0,"&uwangle;"],[0,"&angmsdaa;"],[0,"&angmsdab;"],[0,"&angmsdac;"],[0,"&angmsdad;"],[0,"&angmsdae;"],[0,"&angmsdaf;"],[0,"&angmsdag;"],[0,"&angmsdah;"],[0,"&bemptyv;"],[0,"&demptyv;"],[0,"&cemptyv;"],[0,"&raemptyv;"],[0,"&laemptyv;"],[0,"&ohbar;"],[0,"&omid;"],[0,"&opar;"],[1,"&operp;"],[1,"&olcross;"],[0,"&odsold;"],[1,"&olcir;"],[0,"&ofcir;"],[0,"&olt;"],[0,"&ogt;"],[0,"&cirscir;"],[0,"&cirE;"],[0,"&solb;"],[0,"&bsolb;"],[3,"&boxbox;"],[3,"&trisb;"],[0,"&rtriltri;"],[0,{v:"&LeftTriangleBar;",n:824,o:"&NotLeftTriangleBar;"}],[0,{v:"&RightTriangleBar;",n:824,o:"&NotRightTriangleBar;"}],[11,"&iinfin;"],[0,"&infintie;"],[0,"&nvinfin;"],[4,"&eparsl;"],[0,"&smeparsl;"],[0,"&eqvparsl;"],[5,"&blacklozenge;"],[8,"&RuleDelayed;"],[1,"&dsol;"],[9,"&bigodot;"],[0,"&bigoplus;"],[0,"&bigotimes;"],[1,"&biguplus;"],[1,"&bigsqcup;"],[5,"&iiiint;"],[0,"&fpartint;"],[2,"&cirfnint;"],[0,"&awint;"],[0,"&rppolint;"],[0,"&scpolint;"],[0,"&npolint;"],[0,"&pointint;"],[0,"&quatint;"],[0,"&intlarhk;"],[10,"&pluscir;"],[0,"&plusacir;"],[0,"&simplus;"],[0,"&plusdu;"],[0,"&plussim;"],[0,"&plustwo;"],[1,"&mcomma;"],[0,"&minusdu;"],[2,"&loplus;"],[0,"&roplus;"],[0,"&Cross;"],[0,"&timesd;"],[0,"&timesbar;"],[1,"&smashp;"],[0,"&lotimes;"],[0,"&rotimes;"],[0,"&otimesas;"],[0,"&Otimes;"],[0,"&odiv;"],[0,"&triplus;"],[0,"&triminus;"],[0,"&tritime;"],[0,"&intprod;"],[2,"&amalg;"],[0,"&capdot;"],[1,"&ncup;"],[0,"&ncap;"],[0,"&capand;"],[0,"&cupor;"],[0,"&cupcap;"],[0,"&capcup;"],[0,"&cupbrcap;"],[0,"&capbrcup;"],[0,"&cupcup;"],[0,"&capcap;"],[0,"&ccups;"],[0,"&ccaps;"],[2,"&ccupssm;"],[2,"&And;"],[0,"&Or;"],[0,"&andand;"],[0,"&oror;"],[0,"&orslope;"],[0,"&andslope;"],[1,"&andv;"],[0,"&orv;"],[0,"&andd;"],[0,"&ord;"],[1,"&wedbar;"],[6,"&sdote;"],[3,"&simdot;"],[2,{v:"&congdot;",n:824,o:"&ncongdot;"}],[0,"&easter;"],[0,"&apacir;"],[0,{v:"&apE;",n:824,o:"&napE;"}],[0,"&eplus;"],[0,"&pluse;"],[0,"&Esim;"],[0,"&Colone;"],[0,"&Equal;"],[1,"&ddotseq;"],[0,"&equivDD;"],[0,"&ltcir;"],[0,"&gtcir;"],[0,"&ltquest;"],[0,"&gtquest;"],[0,{v:"&leqslant;",n:824,o:"&nleqslant;"}],[0,{v:"&geqslant;",n:824,o:"&ngeqslant;"}],[0,"&lesdot;"],[0,"&gesdot;"],[0,"&lesdoto;"],[0,"&gesdoto;"],[0,"&lesdotor;"],[0,"&gesdotol;"],[0,"&lap;"],[0,"&gap;"],[0,"&lne;"],[0,"&gne;"],[0,"&lnap;"],[0,"&gnap;"],[0,"&lEg;"],[0,"&gEl;"],[0,"&lsime;"],[0,"&gsime;"],[0,"&lsimg;"],[0,"&gsiml;"],[0,"&lgE;"],[0,"&glE;"],[0,"&lesges;"],[0,"&gesles;"],[0,"&els;"],[0,"&egs;"],[0,"&elsdot;"],[0,"&egsdot;"],[0,"&el;"],[0,"&eg;"],[2,"&siml;"],[0,"&simg;"],[0,"&simlE;"],[0,"&simgE;"],[0,{v:"&LessLess;",n:824,o:"&NotNestedLessLess;"}],[0,{v:"&GreaterGreater;",n:824,o:"&NotNestedGreaterGreater;"}],[1,"&glj;"],[0,"&gla;"],[0,"&ltcc;"],[0,"&gtcc;"],[0,"&lescc;"],[0,"&gescc;"],[0,"&smt;"],[0,"&lat;"],[0,{v:"&smte;",n:65024,o:"&smtes;"}],[0,{v:"&late;",n:65024,o:"&lates;"}],[0,"&bumpE;"],[0,{v:"&PrecedesEqual;",n:824,o:"&NotPrecedesEqual;"}],[0,{v:"&sce;",n:824,o:"&NotSucceedsEqual;"}],[2,"&prE;"],[0,"&scE;"],[0,"&precneqq;"],[0,"&scnE;"],[0,"&prap;"],[0,"&scap;"],[0,"&precnapprox;"],[0,"&scnap;"],[0,"&Pr;"],[0,"&Sc;"],[0,"&subdot;"],[0,"&supdot;"],[0,"&subplus;"],[0,"&supplus;"],[0,"&submult;"],[0,"&supmult;"],[0,"&subedot;"],[0,"&supedot;"],[0,{v:"&subE;",n:824,o:"&nsubE;"}],[0,{v:"&supE;",n:824,o:"&nsupE;"}],[0,"&subsim;"],[0,"&supsim;"],[2,{v:"&subnE;",n:65024,o:"&varsubsetneqq;"}],[0,{v:"&supnE;",n:65024,o:"&varsupsetneqq;"}],[2,"&csub;"],[0,"&csup;"],[0,"&csube;"],[0,"&csupe;"],[0,"&subsup;"],[0,"&supsub;"],[0,"&subsub;"],[0,"&supsup;"],[0,"&suphsub;"],[0,"&supdsub;"],[0,"&forkv;"],[0,"&topfork;"],[0,"&mlcp;"],[8,"&Dashv;"],[1,"&Vdashl;"],[0,"&Barv;"],[0,"&vBar;"],[0,"&vBarv;"],[1,"&Vbar;"],[0,"&Not;"],[0,"&bNot;"],[0,"&rnmid;"],[0,"&cirmid;"],[0,"&midcir;"],[0,"&topcir;"],[0,"&nhpar;"],[0,"&parsim;"],[9,{v:"&parsl;",n:8421,o:"&nparsl;"}],[44343,{n:new Map(restoreDiff([[56476,"&Ascr;"],[1,"&Cscr;"],[0,"&Dscr;"],[2,"&Gscr;"],[2,"&Jscr;"],[0,"&Kscr;"],[2,"&Nscr;"],[0,"&Oscr;"],[0,"&Pscr;"],[0,"&Qscr;"],[1,"&Sscr;"],[0,"&Tscr;"],[0,"&Uscr;"],[0,"&Vscr;"],[0,"&Wscr;"],[0,"&Xscr;"],[0,"&Yscr;"],[0,"&Zscr;"],[0,"&ascr;"],[0,"&bscr;"],[0,"&cscr;"],[0,"&dscr;"],[1,"&fscr;"],[1,"&hscr;"],[0,"&iscr;"],[0,"&jscr;"],[0,"&kscr;"],[0,"&lscr;"],[0,"&mscr;"],[0,"&nscr;"],[1,"&pscr;"],[0,"&qscr;"],[0,"&rscr;"],[0,"&sscr;"],[0,"&tscr;"],[0,"&uscr;"],[0,"&vscr;"],[0,"&wscr;"],[0,"&xscr;"],[0,"&yscr;"],[0,"&zscr;"],[52,"&Afr;"],[0,"&Bfr;"],[1,"&Dfr;"],[0,"&Efr;"],[0,"&Ffr;"],[0,"&Gfr;"],[2,"&Jfr;"],[0,"&Kfr;"],[0,"&Lfr;"],[0,"&Mfr;"],[0,"&Nfr;"],[0,"&Ofr;"],[0,"&Pfr;"],[0,"&Qfr;"],[1,"&Sfr;"],[0,"&Tfr;"],[0,"&Ufr;"],[0,"&Vfr;"],[0,"&Wfr;"],[0,"&Xfr;"],[0,"&Yfr;"],[1,"&afr;"],[0,"&bfr;"],[0,"&cfr;"],[0,"&dfr;"],[0,"&efr;"],[0,"&ffr;"],[0,"&gfr;"],[0,"&hfr;"],[0,"&ifr;"],[0,"&jfr;"],[0,"&kfr;"],[0,"&lfr;"],[0,"&mfr;"],[0,"&nfr;"],[0,"&ofr;"],[0,"&pfr;"],[0,"&qfr;"],[0,"&rfr;"],[0,"&sfr;"],[0,"&tfr;"],[0,"&ufr;"],[0,"&vfr;"],[0,"&wfr;"],[0,"&xfr;"],[0,"&yfr;"],[0,"&zfr;"],[0,"&Aopf;"],[0,"&Bopf;"],[1,"&Dopf;"],[0,"&Eopf;"],[0,"&Fopf;"],[0,"&Gopf;"],[1,"&Iopf;"],[0,"&Jopf;"],[0,"&Kopf;"],[0,"&Lopf;"],[0,"&Mopf;"],[1,"&Oopf;"],[3,"&Sopf;"],[0,"&Topf;"],[0,"&Uopf;"],[0,"&Vopf;"],[0,"&Wopf;"],[0,"&Xopf;"],[0,"&Yopf;"],[1,"&aopf;"],[0,"&bopf;"],[0,"&copf;"],[0,"&dopf;"],[0,"&eopf;"],[0,"&fopf;"],[0,"&gopf;"],[0,"&hopf;"],[0,"&iopf;"],[0,"&jopf;"],[0,"&kopf;"],[0,"&lopf;"],[0,"&mopf;"],[0,"&nopf;"],[0,"&oopf;"],[0,"&popf;"],[0,"&qopf;"],[0,"&ropf;"],[0,"&sopf;"],[0,"&topf;"],[0,"&uopf;"],[0,"&vopf;"],[0,"&wopf;"],[0,"&xopf;"],[0,"&yopf;"],[0,"&zopf;"]]))}],[8906,"&fflig;"],[0,"&filig;"],[0,"&fllig;"],[0,"&ffilig;"],[0,"&ffllig;"]]));var _escape={};(function(tt){Object.defineProperty(tt,"__esModule",{value:!0}),tt.escapeText=tt.escapeAttribute=tt.escapeUTF8=tt.escape=tt.encodeXML=tt.getCodePoint=tt.xmlReplacer=void 0,tt.xmlReplacer=/["&'<>$\x80-\uFFFF]/g;var et=new Map([[34,"&quot;"],[38,"&amp;"],[39,"&apos;"],[60,"&lt;"],[62,"&gt;"]]);tt.getCodePoint=String.prototype.codePointAt!=null?function(it,st){return it.codePointAt(st)}:function(it,st){return(it.charCodeAt(st)&64512)===55296?(it.charCodeAt(st)-55296)*1024+it.charCodeAt(st+1)-56320+65536:it.charCodeAt(st)};function rt(it){for(var st="",ot=0,lt;(lt=tt.xmlReplacer.exec(it))!==null;){var ut=lt.index,ct=it.charCodeAt(ut),dt=et.get(ct);dt!==void 0?(st+=it.substring(ot,ut)+dt,ot=ut+1):(st+="".concat(it.substring(ot,ut),"&#x").concat((0,tt.getCodePoint)(it,ut).toString(16),";"),ot=tt.xmlReplacer.lastIndex+=+((ct&64512)===55296))}return st+it.substr(ot)}tt.encodeXML=rt,tt.escape=rt;function nt(it,st){return function(lt){for(var ut,ct=0,dt="";ut=it.exec(lt);)ct!==ut.index&&(dt+=lt.substring(ct,ut.index)),dt+=st.get(ut[0].charCodeAt(0)),ct=ut.index+1;return dt+lt.substring(ct)}}tt.escapeUTF8=nt(/[&<>'"]/g,et),tt.escapeAttribute=nt(/["&\u00A0]/g,new Map([[34,"&quot;"],[38,"&amp;"],[160,"&nbsp;"]])),tt.escapeText=nt(/[&<>\u00A0]/g,new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[160,"&nbsp;"]]))})(_escape);var __importDefault$1=commonjsGlobal&&commonjsGlobal.__importDefault||function(tt){return tt&&tt.__esModule?tt:{default:tt}};Object.defineProperty(encode,"__esModule",{value:!0});encode.encodeNonAsciiHTML=encode.encodeHTML=void 0;var encode_html_js_1=__importDefault$1(encodeHtml),escape_js_1=_escape,htmlReplacer=/[\t\n!-,./:-@[-`\f{-}$\x80-\uFFFF]/g;function encodeHTML(tt){return encodeHTMLTrieRe(htmlReplacer,tt)}encode.encodeHTML=encodeHTML;function encodeNonAsciiHTML(tt){return encodeHTMLTrieRe(escape_js_1.xmlReplacer,tt)}encode.encodeNonAsciiHTML=encodeNonAsciiHTML;function encodeHTMLTrieRe(tt,et){for(var rt="",nt=0,it;(it=tt.exec(et))!==null;){var st=it.index;rt+=et.substring(nt,st);var ot=et.charCodeAt(st),lt=encode_html_js_1.default.get(ot);if(typeof lt=="object"){if(st+1<et.length){var ut=et.charCodeAt(st+1),ct=typeof lt.n=="number"?lt.n===ut?lt.o:void 0:lt.n.get(ut);if(ct!==void 0){rt+=ct,nt=tt.lastIndex+=1;continue}}lt=lt.v}if(lt!==void 0)rt+=lt,nt=st+1;else{var dt=(0,escape_js_1.getCodePoint)(et,st);rt+="&#x".concat(dt.toString(16),";"),nt=tt.lastIndex+=+(dt!==ot)}}return rt+et.substr(nt)}(function(tt){Object.defineProperty(tt,"__esModule",{value:!0}),tt.decodeXMLStrict=tt.decodeHTML5Strict=tt.decodeHTML4Strict=tt.decodeHTML5=tt.decodeHTML4=tt.decodeHTMLAttribute=tt.decodeHTMLStrict=tt.decodeHTML=tt.decodeXML=tt.DecodingMode=tt.EntityDecoder=tt.encodeHTML5=tt.encodeHTML4=tt.encodeNonAsciiHTML=tt.encodeHTML=tt.escapeText=tt.escapeAttribute=tt.escapeUTF8=tt.escape=tt.encodeXML=tt.encode=tt.decodeStrict=tt.decode=tt.EncodingMode=tt.EntityLevel=void 0;var et=decode,rt=encode,nt=_escape,it;(function(ft){ft[ft.XML=0]="XML",ft[ft.HTML=1]="HTML"})(it=tt.EntityLevel||(tt.EntityLevel={}));var st;(function(ft){ft[ft.UTF8=0]="UTF8",ft[ft.ASCII=1]="ASCII",ft[ft.Extensive=2]="Extensive",ft[ft.Attribute=3]="Attribute",ft[ft.Text=4]="Text"})(st=tt.EncodingMode||(tt.EncodingMode={}));function ot(ft,gt){gt===void 0&&(gt=it.XML);var _r=typeof gt=="number"?gt:gt.level;if(_r===it.HTML){var Yr=typeof gt=="object"?gt.mode:void 0;return(0,et.decodeHTML)(ft,Yr)}return(0,et.decodeXML)(ft)}tt.decode=ot;function lt(ft,gt){var _r;gt===void 0&&(gt=it.XML);var Yr=typeof gt=="number"?{level:gt}:gt;return(_r=Yr.mode)!==null&&_r!==void 0||(Yr.mode=et.DecodingMode.Strict),ot(ft,Yr)}tt.decodeStrict=lt;function ut(ft,gt){gt===void 0&&(gt=it.XML);var _r=typeof gt=="number"?{level:gt}:gt;return _r.mode===st.UTF8?(0,nt.escapeUTF8)(ft):_r.mode===st.Attribute?(0,nt.escapeAttribute)(ft):_r.mode===st.Text?(0,nt.escapeText)(ft):_r.level===it.HTML?_r.mode===st.ASCII?(0,rt.encodeNonAsciiHTML)(ft):(0,rt.encodeHTML)(ft):(0,nt.encodeXML)(ft)}tt.encode=ut;var ct=_escape;Object.defineProperty(tt,"encodeXML",{enumerable:!0,get:function(){return ct.encodeXML}}),Object.defineProperty(tt,"escape",{enumerable:!0,get:function(){return ct.escape}}),Object.defineProperty(tt,"escapeUTF8",{enumerable:!0,get:function(){return ct.escapeUTF8}}),Object.defineProperty(tt,"escapeAttribute",{enumerable:!0,get:function(){return ct.escapeAttribute}}),Object.defineProperty(tt,"escapeText",{enumerable:!0,get:function(){return ct.escapeText}});var dt=encode;Object.defineProperty(tt,"encodeHTML",{enumerable:!0,get:function(){return dt.encodeHTML}}),Object.defineProperty(tt,"encodeNonAsciiHTML",{enumerable:!0,get:function(){return dt.encodeNonAsciiHTML}}),Object.defineProperty(tt,"encodeHTML4",{enumerable:!0,get:function(){return dt.encodeHTML}}),Object.defineProperty(tt,"encodeHTML5",{enumerable:!0,get:function(){return dt.encodeHTML}});var pt=decode;Object.defineProperty(tt,"EntityDecoder",{enumerable:!0,get:function(){return pt.EntityDecoder}}),Object.defineProperty(tt,"DecodingMode",{enumerable:!0,get:function(){return pt.DecodingMode}}),Object.defineProperty(tt,"decodeXML",{enumerable:!0,get:function(){return pt.decodeXML}}),Object.defineProperty(tt,"decodeHTML",{enumerable:!0,get:function(){return pt.decodeHTML}}),Object.defineProperty(tt,"decodeHTMLStrict",{enumerable:!0,get:function(){return pt.decodeHTMLStrict}}),Object.defineProperty(tt,"decodeHTMLAttribute",{enumerable:!0,get:function(){return pt.decodeHTMLAttribute}}),Object.defineProperty(tt,"decodeHTML4",{enumerable:!0,get:function(){return pt.decodeHTML}}),Object.defineProperty(tt,"decodeHTML5",{enumerable:!0,get:function(){return pt.decodeHTML}}),Object.defineProperty(tt,"decodeHTML4Strict",{enumerable:!0,get:function(){return pt.decodeHTMLStrict}}),Object.defineProperty(tt,"decodeHTML5Strict",{enumerable:!0,get:function(){return pt.decodeHTMLStrict}}),Object.defineProperty(tt,"decodeXMLStrict",{enumerable:!0,get:function(){return pt.decodeXML}})})(lib);var foreignNames={};Object.defineProperty(foreignNames,"__esModule",{value:!0});foreignNames.attributeNames=foreignNames.elementNames=void 0;foreignNames.elementNames=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(function(tt){return[tt.toLowerCase(),tt]}));foreignNames.attributeNames=new Map(["definitionURL","attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(function(tt){return[tt.toLowerCase(),tt]}));var __assign$1=commonjsGlobal&&commonjsGlobal.__assign||function(){return __assign$1=Object.assign||function(tt){for(var et,rt=1,nt=arguments.length;rt<nt;rt++){et=arguments[rt];for(var it in et)Object.prototype.hasOwnProperty.call(et,it)&&(tt[it]=et[it])}return tt},__assign$1.apply(this,arguments)},__createBinding=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(tt,et,rt,nt){nt===void 0&&(nt=rt);var it=Object.getOwnPropertyDescriptor(et,rt);(!it||("get"in it?!et.__esModule:it.writable||it.configurable))&&(it={enumerable:!0,get:function(){return et[rt]}}),Object.defineProperty(tt,nt,it)}:function(tt,et,rt,nt){nt===void 0&&(nt=rt),tt[nt]=et[rt]}),__setModuleDefault=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(tt,et){Object.defineProperty(tt,"default",{enumerable:!0,value:et})}:function(tt,et){tt.default=et}),__importStar=commonjsGlobal&&commonjsGlobal.__importStar||function(tt){if(tt&&tt.__esModule)return tt;var et={};if(tt!=null)for(var rt in tt)rt!=="default"&&Object.prototype.hasOwnProperty.call(tt,rt)&&__createBinding(et,tt,rt);return __setModuleDefault(et,tt),et};Object.defineProperty(lib$1,"__esModule",{value:!0});lib$1.render=void 0;var ElementType=__importStar(lib$3),entities_1=lib,foreignNames_js_1=foreignNames,unencodedElements=new Set(["style","script","xmp","iframe","noembed","noframes","plaintext","noscript"]);function replaceQuotes(tt){return tt.replace(/"/g,"&quot;")}function formatAttributes(tt,et){var rt;if(tt){var nt=((rt=et.encodeEntities)!==null&&rt!==void 0?rt:et.decodeEntities)===!1?replaceQuotes:et.xmlMode||et.encodeEntities!=="utf8"?entities_1.encodeXML:entities_1.escapeAttribute;return Object.keys(tt).map(function(it){var st,ot,lt=(st=tt[it])!==null&&st!==void 0?st:"";return et.xmlMode==="foreign"&&(it=(ot=foreignNames_js_1.attributeNames.get(it))!==null&&ot!==void 0?ot:it),!et.emptyAttrs&&!et.xmlMode&&lt===""?it:"".concat(it,'="').concat(nt(lt),'"')}).join(" ")}}var singleTag=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]);function render(tt,et){et===void 0&&(et={});for(var rt=("length"in tt)?tt:[tt],nt="",it=0;it<rt.length;it++)nt+=renderNode(rt[it],et);return nt}lib$1.render=render;lib$1.default=render;function renderNode(tt,et){switch(tt.type){case ElementType.Root:return render(tt.children,et);case ElementType.Doctype:case ElementType.Directive:return renderDirective(tt);case ElementType.Comment:return renderComment(tt);case ElementType.CDATA:return renderCdata(tt);case ElementType.Script:case ElementType.Style:case ElementType.Tag:return renderTag(tt,et);case ElementType.Text:return renderText(tt,et)}}var foreignModeIntegrationPoints=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"]),foreignElements=new Set(["svg","math"]);function renderTag(tt,et){var rt;et.xmlMode==="foreign"&&(tt.name=(rt=foreignNames_js_1.elementNames.get(tt.name))!==null&&rt!==void 0?rt:tt.name,tt.parent&&foreignModeIntegrationPoints.has(tt.parent.name)&&(et=__assign$1(__assign$1({},et),{xmlMode:!1}))),!et.xmlMode&&foreignElements.has(tt.name)&&(et=__assign$1(__assign$1({},et),{xmlMode:"foreign"}));var nt="<".concat(tt.name),it=formatAttributes(tt.attribs,et);return it&&(nt+=" ".concat(it)),tt.children.length===0&&(et.xmlMode?et.selfClosingTags!==!1:et.selfClosingTags&&singleTag.has(tt.name))?(et.xmlMode||(nt+=" "),nt+="/>"):(nt+=">",tt.children.length>0&&(nt+=render(tt.children,et)),(et.xmlMode||!singleTag.has(tt.name))&&(nt+="</".concat(tt.name,">"))),nt}function renderDirective(tt){return"<".concat(tt.data,">")}function renderText(tt,et){var rt,nt=tt.data||"";return((rt=et.encodeEntities)!==null&&rt!==void 0?rt:et.decodeEntities)!==!1&&!(!et.xmlMode&&tt.parent&&unencodedElements.has(tt.parent.name))&&(nt=et.xmlMode||et.encodeEntities!=="utf8"?(0,entities_1.encodeXML)(nt):(0,entities_1.escapeText)(nt)),nt}function renderCdata(tt){return"<![CDATA[".concat(tt.children[0].data,"]]>")}function renderComment(tt){return"<!--".concat(tt.data,"-->")}var __importDefault=commonjsGlobal&&commonjsGlobal.__importDefault||function(tt){return tt&&tt.__esModule?tt:{default:tt}};Object.defineProperty(stringify$5,"__esModule",{value:!0});stringify$5.innerText=stringify$5.textContent=stringify$5.getText=stringify$5.getInnerHTML=stringify$5.getOuterHTML=void 0;var domhandler_1$3=lib$4,dom_serializer_1=__importDefault(lib$1),domelementtype_1=lib$3;function getOuterHTML(tt,et){return(0,dom_serializer_1.default)(tt,et)}stringify$5.getOuterHTML=getOuterHTML;function getInnerHTML(tt,et){return(0,domhandler_1$3.hasChildren)(tt)?tt.children.map(function(rt){return getOuterHTML(rt,et)}).join(""):""}stringify$5.getInnerHTML=getInnerHTML;function getText(tt){return Array.isArray(tt)?tt.map(getText).join(""):(0,domhandler_1$3.isTag)(tt)?tt.name==="br"?`
`:getText(tt.children):(0,domhandler_1$3.isCDATA)(tt)?getText(tt.children):(0,domhandler_1$3.isText)(tt)?tt.data:""}stringify$5.getText=getText;function textContent(tt){return Array.isArray(tt)?tt.map(textContent).join(""):(0,domhandler_1$3.hasChildren)(tt)&&!(0,domhandler_1$3.isComment)(tt)?textContent(tt.children):(0,domhandler_1$3.isText)(tt)?tt.data:""}stringify$5.textContent=textContent;function innerText(tt){return Array.isArray(tt)?tt.map(innerText).join(""):(0,domhandler_1$3.hasChildren)(tt)&&(tt.type===domelementtype_1.ElementType.Tag||(0,domhandler_1$3.isCDATA)(tt))?innerText(tt.children):(0,domhandler_1$3.isText)(tt)?tt.data:""}stringify$5.innerText=innerText;var traversal={};Object.defineProperty(traversal,"__esModule",{value:!0});traversal.prevElementSibling=traversal.nextElementSibling=traversal.getName=traversal.hasAttrib=traversal.getAttributeValue=traversal.getSiblings=traversal.getParent=traversal.getChildren=void 0;var domhandler_1$2=lib$4;function getChildren(tt){return(0,domhandler_1$2.hasChildren)(tt)?tt.children:[]}traversal.getChildren=getChildren;function getParent(tt){return tt.parent||null}traversal.getParent=getParent;function getSiblings(tt){var et,rt,nt=getParent(tt);if(nt!=null)return getChildren(nt);for(var it=[tt],st=tt.prev,ot=tt.next;st!=null;)it.unshift(st),et=st,st=et.prev;for(;ot!=null;)it.push(ot),rt=ot,ot=rt.next;return it}traversal.getSiblings=getSiblings;function getAttributeValue(tt,et){var rt;return(rt=tt.attribs)===null||rt===void 0?void 0:rt[et]}traversal.getAttributeValue=getAttributeValue;function hasAttrib(tt,et){return tt.attribs!=null&&Object.prototype.hasOwnProperty.call(tt.attribs,et)&&tt.attribs[et]!=null}traversal.hasAttrib=hasAttrib;function getName(tt){return tt.name}traversal.getName=getName;function nextElementSibling(tt){for(var et,rt=tt.next;rt!==null&&!(0,domhandler_1$2.isTag)(rt);)et=rt,rt=et.next;return rt}traversal.nextElementSibling=nextElementSibling;function prevElementSibling(tt){for(var et,rt=tt.prev;rt!==null&&!(0,domhandler_1$2.isTag)(rt);)et=rt,rt=et.prev;return rt}traversal.prevElementSibling=prevElementSibling;var manipulation={};Object.defineProperty(manipulation,"__esModule",{value:!0});manipulation.prepend=manipulation.prependChild=manipulation.append=manipulation.appendChild=manipulation.replaceElement=manipulation.removeElement=void 0;function removeElement(tt){if(tt.prev&&(tt.prev.next=tt.next),tt.next&&(tt.next.prev=tt.prev),tt.parent){var et=tt.parent.children,rt=et.lastIndexOf(tt);rt>=0&&et.splice(rt,1)}tt.next=null,tt.prev=null,tt.parent=null}manipulation.removeElement=removeElement;function replaceElement(tt,et){var rt=et.prev=tt.prev;rt&&(rt.next=et);var nt=et.next=tt.next;nt&&(nt.prev=et);var it=et.parent=tt.parent;if(it){var st=it.children;st[st.lastIndexOf(tt)]=et,tt.parent=null}}manipulation.replaceElement=replaceElement;function appendChild(tt,et){if(removeElement(et),et.next=null,et.parent=tt,tt.children.push(et)>1){var rt=tt.children[tt.children.length-2];rt.next=et,et.prev=rt}else et.prev=null}manipulation.appendChild=appendChild;function append(tt,et){removeElement(et);var rt=tt.parent,nt=tt.next;if(et.next=nt,et.prev=tt,tt.next=et,et.parent=rt,nt){if(nt.prev=et,rt){var it=rt.children;it.splice(it.lastIndexOf(nt),0,et)}}else rt&&rt.children.push(et)}manipulation.append=append;function prependChild(tt,et){if(removeElement(et),et.parent=tt,et.prev=null,tt.children.unshift(et)!==1){var rt=tt.children[1];rt.prev=et,et.next=rt}else et.next=null}manipulation.prependChild=prependChild;function prepend(tt,et){removeElement(et);var rt=tt.parent;if(rt){var nt=rt.children;nt.splice(nt.indexOf(tt),0,et)}tt.prev&&(tt.prev.next=et),et.parent=rt,et.prev=tt.prev,et.next=tt,tt.prev=et}manipulation.prepend=prepend;var querying={};Object.defineProperty(querying,"__esModule",{value:!0});querying.findAll=querying.existsOne=querying.findOne=querying.findOneChild=querying.find=querying.filter=void 0;var domhandler_1$1=lib$4;function filter$1(tt,et,rt,nt){return rt===void 0&&(rt=!0),nt===void 0&&(nt=1/0),find(tt,Array.isArray(et)?et:[et],rt,nt)}querying.filter=filter$1;function find(tt,et,rt,nt){for(var it=[],st=[et],ot=[0];;){if(ot[0]>=st[0].length){if(ot.length===1)return it;st.shift(),ot.shift();continue}var lt=st[0][ot[0]++];if(tt(lt)&&(it.push(lt),--nt<=0))return it;rt&&(0,domhandler_1$1.hasChildren)(lt)&&lt.children.length>0&&(ot.unshift(0),st.unshift(lt.children))}}querying.find=find;function findOneChild(tt,et){return et.find(tt)}querying.findOneChild=findOneChild;function findOne(tt,et,rt){rt===void 0&&(rt=!0);for(var nt=null,it=0;it<et.length&&!nt;it++){var st=et[it];if((0,domhandler_1$1.isTag)(st))tt(st)?nt=st:rt&&st.children.length>0&&(nt=findOne(tt,st.children,!0));else continue}return nt}querying.findOne=findOne;function existsOne(tt,et){return et.some(function(rt){return(0,domhandler_1$1.isTag)(rt)&&(tt(rt)||existsOne(tt,rt.children))})}querying.existsOne=existsOne;function findAll(tt,et){for(var rt=[],nt=[et],it=[0];;){if(it[0]>=nt[0].length){if(nt.length===1)return rt;nt.shift(),it.shift();continue}var st=nt[0][it[0]++];(0,domhandler_1$1.isTag)(st)&&(tt(st)&&rt.push(st),st.children.length>0&&(it.unshift(0),nt.unshift(st.children)))}}querying.findAll=findAll;var legacy={};Object.defineProperty(legacy,"__esModule",{value:!0});legacy.getElementsByTagType=legacy.getElementsByTagName=legacy.getElementById=legacy.getElements=legacy.testElement=void 0;var domhandler_1=lib$4,querying_js_1=querying,Checks={tag_name:function(tt){return typeof tt=="function"?function(et){return(0,domhandler_1.isTag)(et)&&tt(et.name)}:tt==="*"?domhandler_1.isTag:function(et){return(0,domhandler_1.isTag)(et)&&et.name===tt}},tag_type:function(tt){return typeof tt=="function"?function(et){return tt(et.type)}:function(et){return et.type===tt}},tag_contains:function(tt){return typeof tt=="function"?function(et){return(0,domhandler_1.isText)(et)&&tt(et.data)}:function(et){return(0,domhandler_1.isText)(et)&&et.data===tt}}};function getAttribCheck(tt,et){return typeof et=="function"?function(rt){return(0,domhandler_1.isTag)(rt)&&et(rt.attribs[tt])}:function(rt){return(0,domhandler_1.isTag)(rt)&&rt.attribs[tt]===et}}function combineFuncs(tt,et){return function(rt){return tt(rt)||et(rt)}}function compileTest(tt){var et=Object.keys(tt).map(function(rt){var nt=tt[rt];return Object.prototype.hasOwnProperty.call(Checks,rt)?Checks[rt](nt):getAttribCheck(rt,nt)});return et.length===0?null:et.reduce(combineFuncs)}function testElement(tt,et){var rt=compileTest(tt);return rt?rt(et):!0}legacy.testElement=testElement;function getElements(tt,et,rt,nt){nt===void 0&&(nt=1/0);var it=compileTest(tt);return it?(0,querying_js_1.filter)(it,et,rt,nt):[]}legacy.getElements=getElements;function getElementById(tt,et,rt){return rt===void 0&&(rt=!0),Array.isArray(et)||(et=[et]),(0,querying_js_1.findOne)(getAttribCheck("id",tt),et,rt)}legacy.getElementById=getElementById;function getElementsByTagName(tt,et,rt,nt){return rt===void 0&&(rt=!0),nt===void 0&&(nt=1/0),(0,querying_js_1.filter)(Checks.tag_name(tt),et,rt,nt)}legacy.getElementsByTagName=getElementsByTagName;function getElementsByTagType(tt,et,rt,nt){return rt===void 0&&(rt=!0),nt===void 0&&(nt=1/0),(0,querying_js_1.filter)(Checks.tag_type(tt),et,rt,nt)}legacy.getElementsByTagType=getElementsByTagType;var helpers={};(function(tt){Object.defineProperty(tt,"__esModule",{value:!0}),tt.uniqueSort=tt.compareDocumentPosition=tt.DocumentPosition=tt.removeSubsets=void 0;var et=lib$4;function rt(ot){for(var lt=ot.length;--lt>=0;){var ut=ot[lt];if(lt>0&&ot.lastIndexOf(ut,lt-1)>=0){ot.splice(lt,1);continue}for(var ct=ut.parent;ct;ct=ct.parent)if(ot.includes(ct)){ot.splice(lt,1);break}}return ot}tt.removeSubsets=rt;var nt;(function(ot){ot[ot.DISCONNECTED=1]="DISCONNECTED",ot[ot.PRECEDING=2]="PRECEDING",ot[ot.FOLLOWING=4]="FOLLOWING",ot[ot.CONTAINS=8]="CONTAINS",ot[ot.CONTAINED_BY=16]="CONTAINED_BY"})(nt=tt.DocumentPosition||(tt.DocumentPosition={}));function it(ot,lt){var ut=[],ct=[];if(ot===lt)return 0;for(var dt=(0,et.hasChildren)(ot)?ot:ot.parent;dt;)ut.unshift(dt),dt=dt.parent;for(dt=(0,et.hasChildren)(lt)?lt:lt.parent;dt;)ct.unshift(dt),dt=dt.parent;for(var pt=Math.min(ut.length,ct.length),ft=0;ft<pt&&ut[ft]===ct[ft];)ft++;if(ft===0)return nt.DISCONNECTED;var gt=ut[ft-1],_r=gt.children,Yr=ut[ft],mt=ct[ft];return _r.indexOf(Yr)>_r.indexOf(mt)?gt===lt?nt.FOLLOWING|nt.CONTAINED_BY:nt.FOLLOWING:gt===ot?nt.PRECEDING|nt.CONTAINS:nt.PRECEDING}tt.compareDocumentPosition=it;function st(ot){return ot=ot.filter(function(lt,ut,ct){return!ct.includes(lt,ut+1)}),ot.sort(function(lt,ut){var ct=it(lt,ut);return ct&nt.PRECEDING?-1:ct&nt.FOLLOWING?1:0}),ot}tt.uniqueSort=st})(helpers);var feeds={};Object.defineProperty(feeds,"__esModule",{value:!0});feeds.getFeed=void 0;var stringify_js_1=stringify$5,legacy_js_1=legacy;function getFeed(tt){var et=getOneElement(isValidFeed,tt);return et?et.name==="feed"?getAtomFeed(et):getRssFeed(et):null}feeds.getFeed=getFeed;function getAtomFeed(tt){var et,rt=tt.children,nt={type:"atom",items:(0,legacy_js_1.getElementsByTagName)("entry",rt).map(function(ot){var lt,ut=ot.children,ct={media:getMediaElements(ut)};addConditionally(ct,"id","id",ut),addConditionally(ct,"title","title",ut);var dt=(lt=getOneElement("link",ut))===null||lt===void 0?void 0:lt.attribs.href;dt&&(ct.link=dt);var pt=fetch$1("summary",ut)||fetch$1("content",ut);pt&&(ct.description=pt);var ft=fetch$1("updated",ut);return ft&&(ct.pubDate=new Date(ft)),ct})};addConditionally(nt,"id","id",rt),addConditionally(nt,"title","title",rt);var it=(et=getOneElement("link",rt))===null||et===void 0?void 0:et.attribs.href;it&&(nt.link=it),addConditionally(nt,"description","subtitle",rt);var st=fetch$1("updated",rt);return st&&(nt.updated=new Date(st)),addConditionally(nt,"author","email",rt,!0),nt}function getRssFeed(tt){var et,rt,nt=(rt=(et=getOneElement("channel",tt.children))===null||et===void 0?void 0:et.children)!==null&&rt!==void 0?rt:[],it={type:tt.name.substr(0,3),id:"",items:(0,legacy_js_1.getElementsByTagName)("item",tt.children).map(function(ot){var lt=ot.children,ut={media:getMediaElements(lt)};addConditionally(ut,"id","guid",lt),addConditionally(ut,"title","title",lt),addConditionally(ut,"link","link",lt),addConditionally(ut,"description","description",lt);var ct=fetch$1("pubDate",lt)||fetch$1("dc:date",lt);return ct&&(ut.pubDate=new Date(ct)),ut})};addConditionally(it,"title","title",nt),addConditionally(it,"link","link",nt),addConditionally(it,"description","description",nt);var st=fetch$1("lastBuildDate",nt);return st&&(it.updated=new Date(st)),addConditionally(it,"author","managingEditor",nt,!0),it}var MEDIA_KEYS_STRING=["url","type","lang"],MEDIA_KEYS_INT=["fileSize","bitrate","framerate","samplingrate","channels","duration","height","width"];function getMediaElements(tt){return(0,legacy_js_1.getElementsByTagName)("media:content",tt).map(function(et){for(var rt=et.attribs,nt={medium:rt.medium,isDefault:!!rt.isDefault},it=0,st=MEDIA_KEYS_STRING;it<st.length;it++){var ot=st[it];rt[ot]&&(nt[ot]=rt[ot])}for(var lt=0,ut=MEDIA_KEYS_INT;lt<ut.length;lt++){var ot=ut[lt];rt[ot]&&(nt[ot]=parseInt(rt[ot],10))}return rt.expression&&(nt.expression=rt.expression),nt})}function getOneElement(tt,et){return(0,legacy_js_1.getElementsByTagName)(tt,et,!0,1)[0]}function fetch$1(tt,et,rt){return rt===void 0&&(rt=!1),(0,stringify_js_1.textContent)((0,legacy_js_1.getElementsByTagName)(tt,et,rt,1)).trim()}function addConditionally(tt,et,rt,nt,it){it===void 0&&(it=!1);var st=fetch$1(rt,nt,it);st&&(tt[et]=st)}function isValidFeed(tt){return tt==="rss"||tt==="feed"||tt==="rdf:RDF"}(function(tt){var et=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(it,st,ot,lt){lt===void 0&&(lt=ot);var ut=Object.getOwnPropertyDescriptor(st,ot);(!ut||("get"in ut?!st.__esModule:ut.writable||ut.configurable))&&(ut={enumerable:!0,get:function(){return st[ot]}}),Object.defineProperty(it,lt,ut)}:function(it,st,ot,lt){lt===void 0&&(lt=ot),it[lt]=st[ot]}),rt=commonjsGlobal&&commonjsGlobal.__exportStar||function(it,st){for(var ot in it)ot!=="default"&&!Object.prototype.hasOwnProperty.call(st,ot)&&et(st,it,ot)};Object.defineProperty(tt,"__esModule",{value:!0}),tt.hasChildren=tt.isDocument=tt.isComment=tt.isText=tt.isCDATA=tt.isTag=void 0,rt(stringify$5,tt),rt(traversal,tt),rt(manipulation,tt),rt(querying,tt),rt(legacy,tt),rt(helpers,tt),rt(feeds,tt);var nt=lib$4;Object.defineProperty(tt,"isTag",{enumerable:!0,get:function(){return nt.isTag}}),Object.defineProperty(tt,"isCDATA",{enumerable:!0,get:function(){return nt.isCDATA}}),Object.defineProperty(tt,"isText",{enumerable:!0,get:function(){return nt.isText}}),Object.defineProperty(tt,"isComment",{enumerable:!0,get:function(){return nt.isComment}}),Object.defineProperty(tt,"isDocument",{enumerable:!0,get:function(){return nt.isDocument}}),Object.defineProperty(tt,"hasChildren",{enumerable:!0,get:function(){return nt.hasChildren}})})(lib$2);(function(tt){var et=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(Kr,Xr,Zr,Qr){Qr===void 0&&(Qr=Zr);var _i=Object.getOwnPropertyDescriptor(Xr,Zr);(!_i||("get"in _i?!Xr.__esModule:_i.writable||_i.configurable))&&(_i={enumerable:!0,get:function(){return Xr[Zr]}}),Object.defineProperty(Kr,Qr,_i)}:function(Kr,Xr,Zr,Qr){Qr===void 0&&(Qr=Zr),Kr[Qr]=Xr[Zr]}),rt=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(Kr,Xr){Object.defineProperty(Kr,"default",{enumerable:!0,value:Xr})}:function(Kr,Xr){Kr.default=Xr}),nt=commonjsGlobal&&commonjsGlobal.__importStar||function(Kr){if(Kr&&Kr.__esModule)return Kr;var Xr={};if(Kr!=null)for(var Zr in Kr)Zr!=="default"&&Object.prototype.hasOwnProperty.call(Kr,Zr)&&et(Xr,Kr,Zr);return rt(Xr,Kr),Xr},it=commonjsGlobal&&commonjsGlobal.__importDefault||function(Kr){return Kr&&Kr.__esModule?Kr:{default:Kr}};Object.defineProperty(tt,"__esModule",{value:!0}),tt.DomUtils=tt.parseFeed=tt.getFeed=tt.ElementType=tt.Tokenizer=tt.createDomStream=tt.parseDOM=tt.parseDocument=tt.DefaultHandler=tt.DomHandler=tt.Parser=void 0;var st=Parser$3,ot=Parser$3;Object.defineProperty(tt,"Parser",{enumerable:!0,get:function(){return ot.Parser}});var lt=lib$4,ut=lib$4;Object.defineProperty(tt,"DomHandler",{enumerable:!0,get:function(){return ut.DomHandler}}),Object.defineProperty(tt,"DefaultHandler",{enumerable:!0,get:function(){return ut.DomHandler}});function ct(Kr,Xr){var Zr=new lt.DomHandler(void 0,Xr);return new st.Parser(Zr,Xr).end(Kr),Zr.root}tt.parseDocument=ct;function dt(Kr,Xr){return ct(Kr,Xr).children}tt.parseDOM=dt;function pt(Kr,Xr,Zr){var Qr=new lt.DomHandler(Kr,Xr,Zr);return new st.Parser(Qr,Xr)}tt.createDomStream=pt;var ft=Tokenizer;Object.defineProperty(tt,"Tokenizer",{enumerable:!0,get:function(){return it(ft).default}}),tt.ElementType=nt(lib$3);var gt=lib$2,_r=lib$2;Object.defineProperty(tt,"getFeed",{enumerable:!0,get:function(){return _r.getFeed}});var Yr={xmlMode:!0};function mt(Kr,Xr){return Xr===void 0&&(Xr=Yr),(0,gt.getFeed)(dt(Kr,Xr))}tt.parseFeed=mt,tt.DomUtils=nt(lib$2)})(lib$5);var escapeStringRegexp$1=tt=>{if(typeof tt!="string")throw new TypeError("Expected a string");return tt.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")},isPlainObject$2={};Object.defineProperty(isPlainObject$2,"__esModule",{value:!0});/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */function isObject(tt){return Object.prototype.toString.call(tt)==="[object Object]"}function isPlainObject$1(tt){var et,rt;return isObject(tt)===!1?!1:(et=tt.constructor,et===void 0?!0:(rt=et.prototype,!(isObject(rt)===!1||rt.hasOwnProperty("isPrototypeOf")===!1)))}isPlainObject$2.isPlainObject=isPlainObject$1;var isMergeableObject=function(et){return isNonNullObject(et)&&!isSpecial(et)};function isNonNullObject(tt){return!!tt&&typeof tt=="object"}function isSpecial(tt){var et=Object.prototype.toString.call(tt);return et==="[object RegExp]"||et==="[object Date]"||isReactElement(tt)}var canUseSymbol=typeof Symbol=="function"&&Symbol.for,REACT_ELEMENT_TYPE=canUseSymbol?Symbol.for("react.element"):60103;function isReactElement(tt){return tt.$$typeof===REACT_ELEMENT_TYPE}function emptyTarget(tt){return Array.isArray(tt)?[]:{}}function cloneUnlessOtherwiseSpecified(tt,et){return et.clone!==!1&&et.isMergeableObject(tt)?deepmerge$1(emptyTarget(tt),tt,et):tt}function defaultArrayMerge(tt,et,rt){return tt.concat(et).map(function(nt){return cloneUnlessOtherwiseSpecified(nt,rt)})}function getMergeFunction(tt,et){if(!et.customMerge)return deepmerge$1;var rt=et.customMerge(tt);return typeof rt=="function"?rt:deepmerge$1}function getEnumerableOwnPropertySymbols(tt){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(tt).filter(function(et){return Object.propertyIsEnumerable.call(tt,et)}):[]}function getKeys(tt){return Object.keys(tt).concat(getEnumerableOwnPropertySymbols(tt))}function propertyIsOnObject(tt,et){try{return et in tt}catch{return!1}}function propertyIsUnsafe(tt,et){return propertyIsOnObject(tt,et)&&!(Object.hasOwnProperty.call(tt,et)&&Object.propertyIsEnumerable.call(tt,et))}function mergeObject(tt,et,rt){var nt={};return rt.isMergeableObject(tt)&&getKeys(tt).forEach(function(it){nt[it]=cloneUnlessOtherwiseSpecified(tt[it],rt)}),getKeys(et).forEach(function(it){propertyIsUnsafe(tt,it)||(propertyIsOnObject(tt,it)&&rt.isMergeableObject(et[it])?nt[it]=getMergeFunction(it,rt)(tt[it],et[it],rt):nt[it]=cloneUnlessOtherwiseSpecified(et[it],rt))}),nt}function deepmerge$1(tt,et,rt){rt=rt||{},rt.arrayMerge=rt.arrayMerge||defaultArrayMerge,rt.isMergeableObject=rt.isMergeableObject||isMergeableObject,rt.cloneUnlessOtherwiseSpecified=cloneUnlessOtherwiseSpecified;var nt=Array.isArray(et),it=Array.isArray(tt),st=nt===it;return st?nt?rt.arrayMerge(tt,et,rt):mergeObject(tt,et,rt):cloneUnlessOtherwiseSpecified(et,rt)}deepmerge$1.all=function(et,rt){if(!Array.isArray(et))throw new Error("first argument should be an array");return et.reduce(function(nt,it){return deepmerge$1(nt,it,rt)},{})};var deepmerge_1=deepmerge$1,cjs=deepmerge_1,parseSrcset$1={exports:{}};(function(tt){(function(et,rt){tt.exports?tt.exports=rt():et.parseSrcset=rt()})(commonjsGlobal,function(){return function(et){function rt(Qr){return Qr===" "||Qr==="	"||Qr===`
`||Qr==="\f"||Qr==="\r"}function nt(Qr){var _i,ns=Qr.exec(et.substring(mt));if(ns)return _i=ns[0],mt+=_i.length,_i}for(var it=et.length,st=/^[ \t\n\r\u000c]+/,ot=/^[, \t\n\r\u000c]+/,lt=/^[^ \t\n\r\u000c]+/,ut=/[,]+$/,ct=/^\d+$/,dt=/^-?(?:[0-9]+|[0-9]*\.[0-9]+)(?:[eE][+-]?[0-9]+)?$/,pt,ft,gt,_r,Yr,mt=0,Kr=[];;){if(nt(ot),mt>=it)return Kr;pt=nt(lt),ft=[],pt.slice(-1)===","?(pt=pt.replace(ut,""),Zr()):Xr()}function Xr(){for(nt(st),gt="",_r="in descriptor";;){if(Yr=et.charAt(mt),_r==="in descriptor")if(rt(Yr))gt&&(ft.push(gt),gt="",_r="after descriptor");else if(Yr===","){mt+=1,gt&&ft.push(gt),Zr();return}else if(Yr==="(")gt=gt+Yr,_r="in parens";else if(Yr===""){gt&&ft.push(gt),Zr();return}else gt=gt+Yr;else if(_r==="in parens")if(Yr===")")gt=gt+Yr,_r="in descriptor";else if(Yr===""){ft.push(gt),Zr();return}else gt=gt+Yr;else if(_r==="after descriptor"&&!rt(Yr))if(Yr===""){Zr();return}else _r="in descriptor",mt-=1;mt+=1}}function Zr(){var Qr=!1,_i,ns,rs,ss,hs={},os,is,cs,ps,vs;for(ss=0;ss<ft.length;ss++)os=ft[ss],is=os[os.length-1],cs=os.substring(0,os.length-1),ps=parseInt(cs,10),vs=parseFloat(cs),ct.test(cs)&&is==="w"?((_i||ns)&&(Qr=!0),ps===0?Qr=!0:_i=ps):dt.test(cs)&&is==="x"?((_i||ns||rs)&&(Qr=!0),vs<0?Qr=!0:ns=vs):ct.test(cs)&&is==="h"?((rs||ns)&&(Qr=!0),ps===0?Qr=!0:rs=ps):Qr=!0;Qr?console&&console.log&&console.log("Invalid srcset descriptor found in '"+et+"' at '"+os+"'."):(hs.url=pt,_i&&(hs.w=_i),ns&&(hs.d=ns),rs&&(hs.h=rs),Kr.push(hs))}}})})(parseSrcset$1);var parseSrcsetExports=parseSrcset$1.exports,picocolors_browser={exports:{}},x=String,create=function(){return{isColorSupported:!1,reset:x,bold:x,dim:x,italic:x,underline:x,inverse:x,hidden:x,strikethrough:x,black:x,red:x,green:x,yellow:x,blue:x,magenta:x,cyan:x,white:x,gray:x,bgBlack:x,bgRed:x,bgGreen:x,bgYellow:x,bgBlue:x,bgMagenta:x,bgCyan:x,bgWhite:x}};picocolors_browser.exports=create();picocolors_browser.exports.createColors=create;var picocolors_browserExports=picocolors_browser.exports;const require$$2=getAugmentedNamespace(__viteBrowserExternal);let pico=picocolors_browserExports,terminalHighlight$1=require$$2,CssSyntaxError$3=class ho extends Error{constructor(et,rt,nt,it,st,ot){super(et),this.name="CssSyntaxError",this.reason=et,st&&(this.file=st),it&&(this.source=it),ot&&(this.plugin=ot),typeof rt<"u"&&typeof nt<"u"&&(typeof rt=="number"?(this.line=rt,this.column=nt):(this.line=rt.line,this.column=rt.column,this.endLine=nt.line,this.endColumn=nt.column)),this.setMessage(),Error.captureStackTrace&&Error.captureStackTrace(this,ho)}setMessage(){this.message=this.plugin?this.plugin+": ":"",this.message+=this.file?this.file:"<css input>",typeof this.line<"u"&&(this.message+=":"+this.line+":"+this.column),this.message+=": "+this.reason}showSourceCode(et){if(!this.source)return"";let rt=this.source;et==null&&(et=pico.isColorSupported),terminalHighlight$1&&et&&(rt=terminalHighlight$1(rt));let nt=rt.split(/\r?\n/),it=Math.max(this.line-3,0),st=Math.min(this.line+2,nt.length),ot=String(st).length,lt,ut;if(et){let{bold:ct,gray:dt,red:pt}=pico.createColors(!0);lt=ft=>ct(pt(ft)),ut=ft=>dt(ft)}else lt=ut=ct=>ct;return nt.slice(it,st).map((ct,dt)=>{let pt=it+1+dt,ft=" "+(" "+pt).slice(-ot)+" | ";if(pt===this.line){let gt=ut(ft.replace(/\d/g," "))+ct.slice(0,this.column-1).replace(/[^\t]/g," ");return lt(">")+ut(ft)+ct+`
 `+gt+lt("^")}return" "+ut(ft)+ct}).join(`
`)}toString(){let et=this.showSourceCode();return et&&(et=`

`+et+`
`),this.name+": "+this.message+et}};var cssSyntaxError=CssSyntaxError$3;CssSyntaxError$3.default=CssSyntaxError$3;var symbols={};symbols.isClean=Symbol("isClean");symbols.my=Symbol("my");const DEFAULT_RAW={after:`
`,beforeClose:`
`,beforeComment:`
`,beforeDecl:`
`,beforeOpen:" ",beforeRule:`
`,colon:": ",commentLeft:" ",commentRight:" ",emptyBody:"",indent:"    ",semicolon:!1};function capitalize(tt){return tt[0].toUpperCase()+tt.slice(1)}let Stringifier$2=class{constructor(et){this.builder=et}atrule(et,rt){let nt="@"+et.name,it=et.params?this.rawValue(et,"params"):"";if(typeof et.raws.afterName<"u"?nt+=et.raws.afterName:it&&(nt+=" "),et.nodes)this.block(et,nt+it);else{let st=(et.raws.between||"")+(rt?";":"");this.builder(nt+it+st,et)}}beforeAfter(et,rt){let nt;et.type==="decl"?nt=this.raw(et,null,"beforeDecl"):et.type==="comment"?nt=this.raw(et,null,"beforeComment"):rt==="before"?nt=this.raw(et,null,"beforeRule"):nt=this.raw(et,null,"beforeClose");let it=et.parent,st=0;for(;it&&it.type!=="root";)st+=1,it=it.parent;if(nt.includes(`
`)){let ot=this.raw(et,null,"indent");if(ot.length)for(let lt=0;lt<st;lt++)nt+=ot}return nt}block(et,rt){let nt=this.raw(et,"between","beforeOpen");this.builder(rt+nt+"{",et,"start");let it;et.nodes&&et.nodes.length?(this.body(et),it=this.raw(et,"after")):it=this.raw(et,"after","emptyBody"),it&&this.builder(it),this.builder("}",et,"end")}body(et){let rt=et.nodes.length-1;for(;rt>0&&et.nodes[rt].type==="comment";)rt-=1;let nt=this.raw(et,"semicolon");for(let it=0;it<et.nodes.length;it++){let st=et.nodes[it],ot=this.raw(st,"before");ot&&this.builder(ot),this.stringify(st,rt!==it||nt)}}comment(et){let rt=this.raw(et,"left","commentLeft"),nt=this.raw(et,"right","commentRight");this.builder("/*"+rt+et.text+nt+"*/",et)}decl(et,rt){let nt=this.raw(et,"between","colon"),it=et.prop+nt+this.rawValue(et,"value");et.important&&(it+=et.raws.important||" !important"),rt&&(it+=";"),this.builder(it,et)}document(et){this.body(et)}raw(et,rt,nt){let it;if(nt||(nt=rt),rt&&(it=et.raws[rt],typeof it<"u"))return it;let st=et.parent;if(nt==="before"&&(!st||st.type==="root"&&st.first===et||st&&st.type==="document"))return"";if(!st)return DEFAULT_RAW[nt];let ot=et.root();if(ot.rawCache||(ot.rawCache={}),typeof ot.rawCache[nt]<"u")return ot.rawCache[nt];if(nt==="before"||nt==="after")return this.beforeAfter(et,nt);{let lt="raw"+capitalize(nt);this[lt]?it=this[lt](ot,et):ot.walk(ut=>{if(it=ut.raws[rt],typeof it<"u")return!1})}return typeof it>"u"&&(it=DEFAULT_RAW[nt]),ot.rawCache[nt]=it,it}rawBeforeClose(et){let rt;return et.walk(nt=>{if(nt.nodes&&nt.nodes.length>0&&typeof nt.raws.after<"u")return rt=nt.raws.after,rt.includes(`
`)&&(rt=rt.replace(/[^\n]+$/,"")),!1}),rt&&(rt=rt.replace(/\S/g,"")),rt}rawBeforeComment(et,rt){let nt;return et.walkComments(it=>{if(typeof it.raws.before<"u")return nt=it.raws.before,nt.includes(`
`)&&(nt=nt.replace(/[^\n]+$/,"")),!1}),typeof nt>"u"?nt=this.raw(rt,null,"beforeDecl"):nt&&(nt=nt.replace(/\S/g,"")),nt}rawBeforeDecl(et,rt){let nt;return et.walkDecls(it=>{if(typeof it.raws.before<"u")return nt=it.raws.before,nt.includes(`
`)&&(nt=nt.replace(/[^\n]+$/,"")),!1}),typeof nt>"u"?nt=this.raw(rt,null,"beforeRule"):nt&&(nt=nt.replace(/\S/g,"")),nt}rawBeforeOpen(et){let rt;return et.walk(nt=>{if(nt.type!=="decl"&&(rt=nt.raws.between,typeof rt<"u"))return!1}),rt}rawBeforeRule(et){let rt;return et.walk(nt=>{if(nt.nodes&&(nt.parent!==et||et.first!==nt)&&typeof nt.raws.before<"u")return rt=nt.raws.before,rt.includes(`
`)&&(rt=rt.replace(/[^\n]+$/,"")),!1}),rt&&(rt=rt.replace(/\S/g,"")),rt}rawColon(et){let rt;return et.walkDecls(nt=>{if(typeof nt.raws.between<"u")return rt=nt.raws.between.replace(/[^\s:]/g,""),!1}),rt}rawEmptyBody(et){let rt;return et.walk(nt=>{if(nt.nodes&&nt.nodes.length===0&&(rt=nt.raws.after,typeof rt<"u"))return!1}),rt}rawIndent(et){if(et.raws.indent)return et.raws.indent;let rt;return et.walk(nt=>{let it=nt.parent;if(it&&it!==et&&it.parent&&it.parent===et&&typeof nt.raws.before<"u"){let st=nt.raws.before.split(`
`);return rt=st[st.length-1],rt=rt.replace(/\S/g,""),!1}}),rt}rawSemicolon(et){let rt;return et.walk(nt=>{if(nt.nodes&&nt.nodes.length&&nt.last.type==="decl"&&(rt=nt.raws.semicolon,typeof rt<"u"))return!1}),rt}rawValue(et,rt){let nt=et[rt],it=et.raws[rt];return it&&it.value===nt?it.raw:nt}root(et){this.body(et),et.raws.after&&this.builder(et.raws.after)}rule(et){this.block(et,this.rawValue(et,"selector")),et.raws.ownSemicolon&&this.builder(et.raws.ownSemicolon,et,"end")}stringify(et,rt){if(!this[et.type])throw new Error("Unknown AST node type "+et.type+". Maybe you need to change PostCSS stringifier.");this[et.type](et,rt)}};var stringifier=Stringifier$2;Stringifier$2.default=Stringifier$2;let Stringifier$1=stringifier;function stringify$4(tt,et){new Stringifier$1(et).stringify(tt)}var stringify_1=stringify$4;stringify$4.default=stringify$4;let{isClean:isClean$2,my:my$2}=symbols,CssSyntaxError$2=cssSyntaxError,Stringifier=stringifier,stringify$3=stringify_1;function cloneNode(tt,et){let rt=new tt.constructor;for(let nt in tt){if(!Object.prototype.hasOwnProperty.call(tt,nt)||nt==="proxyCache")continue;let it=tt[nt],st=typeof it;nt==="parent"&&st==="object"?et&&(rt[nt]=et):nt==="source"?rt[nt]=it:Array.isArray(it)?rt[nt]=it.map(ot=>cloneNode(ot,rt)):(st==="object"&&it!==null&&(it=cloneNode(it)),rt[nt]=it)}return rt}let Node$5=class{constructor(et={}){this.raws={},this[isClean$2]=!1,this[my$2]=!0;for(let rt in et)if(rt==="nodes"){this.nodes=[];for(let nt of et[rt])typeof nt.clone=="function"?this.append(nt.clone()):this.append(nt)}else this[rt]=et[rt]}addToError(et){if(et.postcssNode=this,et.stack&&this.source&&/\n\s{4}at /.test(et.stack)){let rt=this.source;et.stack=et.stack.replace(/\n\s{4}at /,`$&${rt.input.from}:${rt.start.line}:${rt.start.column}$&`)}return et}after(et){return this.parent.insertAfter(this,et),this}assign(et={}){for(let rt in et)this[rt]=et[rt];return this}before(et){return this.parent.insertBefore(this,et),this}cleanRaws(et){delete this.raws.before,delete this.raws.after,et||delete this.raws.between}clone(et={}){let rt=cloneNode(this);for(let nt in et)rt[nt]=et[nt];return rt}cloneAfter(et={}){let rt=this.clone(et);return this.parent.insertAfter(this,rt),rt}cloneBefore(et={}){let rt=this.clone(et);return this.parent.insertBefore(this,rt),rt}error(et,rt={}){if(this.source){let{end:nt,start:it}=this.rangeBy(rt);return this.source.input.error(et,{column:it.column,line:it.line},{column:nt.column,line:nt.line},rt)}return new CssSyntaxError$2(et)}getProxyProcessor(){return{get(et,rt){return rt==="proxyOf"?et:rt==="root"?()=>et.root().toProxy():et[rt]},set(et,rt,nt){return et[rt]===nt||(et[rt]=nt,(rt==="prop"||rt==="value"||rt==="name"||rt==="params"||rt==="important"||rt==="text")&&et.markDirty()),!0}}}markDirty(){if(this[isClean$2]){this[isClean$2]=!1;let et=this;for(;et=et.parent;)et[isClean$2]=!1}}next(){if(!this.parent)return;let et=this.parent.index(this);return this.parent.nodes[et+1]}positionBy(et,rt){let nt=this.source.start;if(et.index)nt=this.positionInside(et.index,rt);else if(et.word){rt=this.toString();let it=rt.indexOf(et.word);it!==-1&&(nt=this.positionInside(it,rt))}return nt}positionInside(et,rt){let nt=rt||this.toString(),it=this.source.start.column,st=this.source.start.line;for(let ot=0;ot<et;ot++)nt[ot]===`
`?(it=1,st+=1):it+=1;return{column:it,line:st}}prev(){if(!this.parent)return;let et=this.parent.index(this);return this.parent.nodes[et-1]}rangeBy(et){let rt={column:this.source.start.column,line:this.source.start.line},nt=this.source.end?{column:this.source.end.column+1,line:this.source.end.line}:{column:rt.column+1,line:rt.line};if(et.word){let it=this.toString(),st=it.indexOf(et.word);st!==-1&&(rt=this.positionInside(st,it),nt=this.positionInside(st+et.word.length,it))}else et.start?rt={column:et.start.column,line:et.start.line}:et.index&&(rt=this.positionInside(et.index)),et.end?nt={column:et.end.column,line:et.end.line}:et.endIndex?nt=this.positionInside(et.endIndex):et.index&&(nt=this.positionInside(et.index+1));return(nt.line<rt.line||nt.line===rt.line&&nt.column<=rt.column)&&(nt={column:rt.column+1,line:rt.line}),{end:nt,start:rt}}raw(et,rt){return new Stringifier().raw(this,et,rt)}remove(){return this.parent&&this.parent.removeChild(this),this.parent=void 0,this}replaceWith(...et){if(this.parent){let rt=this,nt=!1;for(let it of et)it===this?nt=!0:nt?(this.parent.insertAfter(rt,it),rt=it):this.parent.insertBefore(rt,it);nt||this.remove()}return this}root(){let et=this;for(;et.parent&&et.parent.type!=="document";)et=et.parent;return et}toJSON(et,rt){let nt={},it=rt==null;rt=rt||new Map;let st=0;for(let ot in this){if(!Object.prototype.hasOwnProperty.call(this,ot)||ot==="parent"||ot==="proxyCache")continue;let lt=this[ot];if(Array.isArray(lt))nt[ot]=lt.map(ut=>typeof ut=="object"&&ut.toJSON?ut.toJSON(null,rt):ut);else if(typeof lt=="object"&&lt.toJSON)nt[ot]=lt.toJSON(null,rt);else if(ot==="source"){let ut=rt.get(lt.input);ut==null&&(ut=st,rt.set(lt.input,st),st++),nt[ot]={end:lt.end,inputId:ut,start:lt.start}}else nt[ot]=lt}return it&&(nt.inputs=[...rt.keys()].map(ot=>ot.toJSON())),nt}toProxy(){return this.proxyCache||(this.proxyCache=new Proxy(this,this.getProxyProcessor())),this.proxyCache}toString(et=stringify$3){et.stringify&&(et=et.stringify);let rt="";return et(this,nt=>{rt+=nt}),rt}warn(et,rt,nt){let it={node:this};for(let st in nt)it[st]=nt[st];return et.warn(rt,it)}get proxyOf(){return this}};var node=Node$5;Node$5.default=Node$5;let Node$4=node,Declaration$4=class extends Node$4{constructor(et){et&&typeof et.value<"u"&&typeof et.value!="string"&&(et={...et,value:String(et.value)}),super(et),this.type="decl"}get variable(){return this.prop.startsWith("--")||this.prop[0]==="$"}};var declaration=Declaration$4;Declaration$4.default=Declaration$4;let urlAlphabet="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",customAlphabet=(tt,et=21)=>(rt=et)=>{let nt="",it=rt;for(;it--;)nt+=tt[Math.random()*tt.length|0];return nt},nanoid$1=(tt=21)=>{let et="",rt=tt;for(;rt--;)et+=urlAlphabet[Math.random()*64|0];return et};var nonSecure={nanoid:nanoid$1,customAlphabet};let{SourceMapConsumer:SourceMapConsumer$2,SourceMapGenerator:SourceMapGenerator$2}=require$$2,{existsSync,readFileSync}=require$$2,{dirname:dirname$1,join}=require$$2;function fromBase64(tt){return Buffer?Buffer.from(tt,"base64").toString():window.atob(tt)}let PreviousMap$2=class{constructor(et,rt){if(rt.map===!1)return;this.loadAnnotation(et),this.inline=this.startWith(this.annotation,"data:");let nt=rt.map?rt.map.prev:void 0,it=this.loadMap(rt.from,nt);!this.mapFile&&rt.from&&(this.mapFile=rt.from),this.mapFile&&(this.root=dirname$1(this.mapFile)),it&&(this.text=it)}consumer(){return this.consumerCache||(this.consumerCache=new SourceMapConsumer$2(this.text)),this.consumerCache}decodeInline(et){let rt=/^data:application\/json;charset=utf-?8;base64,/,nt=/^data:application\/json;base64,/,it=/^data:application\/json;charset=utf-?8,/,st=/^data:application\/json,/;if(it.test(et)||st.test(et))return decodeURIComponent(et.substr(RegExp.lastMatch.length));if(rt.test(et)||nt.test(et))return fromBase64(et.substr(RegExp.lastMatch.length));let ot=et.match(/data:application\/json;([^,]+),/)[1];throw new Error("Unsupported source map encoding "+ot)}getAnnotationURL(et){return et.replace(/^\/\*\s*# sourceMappingURL=/,"").trim()}isMap(et){return typeof et!="object"?!1:typeof et.mappings=="string"||typeof et._mappings=="string"||Array.isArray(et.sections)}loadAnnotation(et){let rt=et.match(/\/\*\s*# sourceMappingURL=/gm);if(!rt)return;let nt=et.lastIndexOf(rt.pop()),it=et.indexOf("*/",nt);nt>-1&&it>-1&&(this.annotation=this.getAnnotationURL(et.substring(nt,it)))}loadFile(et){if(this.root=dirname$1(et),existsSync(et))return this.mapFile=et,readFileSync(et,"utf-8").toString().trim()}loadMap(et,rt){if(rt===!1)return!1;if(rt){if(typeof rt=="string")return rt;if(typeof rt=="function"){let nt=rt(et);if(nt){let it=this.loadFile(nt);if(!it)throw new Error("Unable to load previous source map: "+nt.toString());return it}}else{if(rt instanceof SourceMapConsumer$2)return SourceMapGenerator$2.fromSourceMap(rt).toString();if(rt instanceof SourceMapGenerator$2)return rt.toString();if(this.isMap(rt))return JSON.stringify(rt);throw new Error("Unsupported previous source map format: "+rt.toString())}}else{if(this.inline)return this.decodeInline(this.annotation);if(this.annotation){let nt=this.annotation;return et&&(nt=join(dirname$1(et),nt)),this.loadFile(nt)}}}startWith(et,rt){return et?et.substr(0,rt.length)===rt:!1}withContent(){return!!(this.consumer().sourcesContent&&this.consumer().sourcesContent.length>0)}};var previousMap=PreviousMap$2;PreviousMap$2.default=PreviousMap$2;let{SourceMapConsumer:SourceMapConsumer$1,SourceMapGenerator:SourceMapGenerator$1}=require$$2,{fileURLToPath,pathToFileURL:pathToFileURL$1}=require$$2,{isAbsolute,resolve:resolve$1}=require$$2,{nanoid}=nonSecure,terminalHighlight=require$$2,CssSyntaxError$1=cssSyntaxError,PreviousMap$1=previousMap,fromOffsetCache=Symbol("fromOffsetCache"),sourceMapAvailable$1=!!(SourceMapConsumer$1&&SourceMapGenerator$1),pathAvailable$1=!!(resolve$1&&isAbsolute),Input$4=class{constructor(et,rt={}){if(et===null||typeof et>"u"||typeof et=="object"&&!et.toString)throw new Error(`PostCSS received ${et} instead of CSS string`);if(this.css=et.toString(),this.css[0]==="\uFEFF"||this.css[0]===""?(this.hasBOM=!0,this.css=this.css.slice(1)):this.hasBOM=!1,rt.from&&(!pathAvailable$1||/^\w+:\/\//.test(rt.from)||isAbsolute(rt.from)?this.file=rt.from:this.file=resolve$1(rt.from)),pathAvailable$1&&sourceMapAvailable$1){let nt=new PreviousMap$1(this.css,rt);if(nt.text){this.map=nt;let it=nt.consumer().file;!this.file&&it&&(this.file=this.mapResolve(it))}}this.file||(this.id="<input css "+nanoid(6)+">"),this.map&&(this.map.file=this.from)}error(et,rt,nt,it={}){let st,ot,lt;if(rt&&typeof rt=="object"){let ct=rt,dt=nt;if(typeof ct.offset=="number"){let pt=this.fromOffset(ct.offset);rt=pt.line,nt=pt.col}else rt=ct.line,nt=ct.column;if(typeof dt.offset=="number"){let pt=this.fromOffset(dt.offset);ot=pt.line,lt=pt.col}else ot=dt.line,lt=dt.column}else if(!nt){let ct=this.fromOffset(rt);rt=ct.line,nt=ct.col}let ut=this.origin(rt,nt,ot,lt);return ut?st=new CssSyntaxError$1(et,ut.endLine===void 0?ut.line:{column:ut.column,line:ut.line},ut.endLine===void 0?ut.column:{column:ut.endColumn,line:ut.endLine},ut.source,ut.file,it.plugin):st=new CssSyntaxError$1(et,ot===void 0?rt:{column:nt,line:rt},ot===void 0?nt:{column:lt,line:ot},this.css,this.file,it.plugin),st.input={column:nt,endColumn:lt,endLine:ot,line:rt,source:this.css},this.file&&(pathToFileURL$1&&(st.input.url=pathToFileURL$1(this.file).toString()),st.input.file=this.file),st}fromOffset(et){let rt,nt;if(this[fromOffsetCache])nt=this[fromOffsetCache];else{let st=this.css.split(`
`);nt=new Array(st.length);let ot=0;for(let lt=0,ut=st.length;lt<ut;lt++)nt[lt]=ot,ot+=st[lt].length+1;this[fromOffsetCache]=nt}rt=nt[nt.length-1];let it=0;if(et>=rt)it=nt.length-1;else{let st=nt.length-2,ot;for(;it<st;)if(ot=it+(st-it>>1),et<nt[ot])st=ot-1;else if(et>=nt[ot+1])it=ot+1;else{it=ot;break}}return{col:et-nt[it]+1,line:it+1}}mapResolve(et){return/^\w+:\/\//.test(et)?et:resolve$1(this.map.consumer().sourceRoot||this.map.root||".",et)}origin(et,rt,nt,it){if(!this.map)return!1;let st=this.map.consumer(),ot=st.originalPositionFor({column:rt,line:et});if(!ot.source)return!1;let lt;typeof nt=="number"&&(lt=st.originalPositionFor({column:it,line:nt}));let ut;isAbsolute(ot.source)?ut=pathToFileURL$1(ot.source):ut=new URL(ot.source,this.map.consumer().sourceRoot||pathToFileURL$1(this.map.mapFile));let ct={column:ot.column,endColumn:lt&&lt.column,endLine:lt&&lt.line,line:ot.line,url:ut.toString()};if(ut.protocol==="file:")if(fileURLToPath)ct.file=fileURLToPath(ut);else throw new Error("file: protocol is not available in this PostCSS build");let dt=st.sourceContentFor(ot.source);return dt&&(ct.source=dt),ct}toJSON(){let et={};for(let rt of["hasBOM","css","file","id"])this[rt]!=null&&(et[rt]=this[rt]);return this.map&&(et.map={...this.map},et.map.consumerCache&&(et.map.consumerCache=void 0)),et}get from(){return this.file||this.id}};var input=Input$4;Input$4.default=Input$4;terminalHighlight&&terminalHighlight.registerInput&&terminalHighlight.registerInput(Input$4);let{SourceMapConsumer,SourceMapGenerator}=require$$2,{dirname,relative,resolve,sep}=require$$2,{pathToFileURL}=require$$2,Input$3=input,sourceMapAvailable=!!(SourceMapConsumer&&SourceMapGenerator),pathAvailable=!!(dirname&&resolve&&relative&&sep),MapGenerator$2=class{constructor(et,rt,nt,it){this.stringify=et,this.mapOpts=nt.map||{},this.root=rt,this.opts=nt,this.css=it,this.originalCSS=it,this.usesFileUrls=!this.mapOpts.from&&this.mapOpts.absolute,this.memoizedFileURLs=new Map,this.memoizedPaths=new Map,this.memoizedURLs=new Map}addAnnotation(){let et;this.isInline()?et="data:application/json;base64,"+this.toBase64(this.map.toString()):typeof this.mapOpts.annotation=="string"?et=this.mapOpts.annotation:typeof this.mapOpts.annotation=="function"?et=this.mapOpts.annotation(this.opts.to,this.root):et=this.outputFile()+".map";let rt=`
`;this.css.includes(`\r
`)&&(rt=`\r
`),this.css+=rt+"/*# sourceMappingURL="+et+" */"}applyPrevMaps(){for(let et of this.previous()){let rt=this.toUrl(this.path(et.file)),nt=et.root||dirname(et.file),it;this.mapOpts.sourcesContent===!1?(it=new SourceMapConsumer(et.text),it.sourcesContent&&(it.sourcesContent=it.sourcesContent.map(()=>null))):it=et.consumer(),this.map.applySourceMap(it,rt,this.toUrl(this.path(nt)))}}clearAnnotation(){if(this.mapOpts.annotation!==!1)if(this.root){let et;for(let rt=this.root.nodes.length-1;rt>=0;rt--)et=this.root.nodes[rt],et.type==="comment"&&et.text.indexOf("# sourceMappingURL=")===0&&this.root.removeChild(rt)}else this.css&&(this.css=this.css.replace(/\n*?\/\*#[\S\s]*?\*\/$/gm,""))}generate(){if(this.clearAnnotation(),pathAvailable&&sourceMapAvailable&&this.isMap())return this.generateMap();{let et="";return this.stringify(this.root,rt=>{et+=rt}),[et]}}generateMap(){if(this.root)this.generateString();else if(this.previous().length===1){let et=this.previous()[0].consumer();et.file=this.outputFile(),this.map=SourceMapGenerator.fromSourceMap(et)}else this.map=new SourceMapGenerator({file:this.outputFile()}),this.map.addMapping({generated:{column:0,line:1},original:{column:0,line:1},source:this.opts.from?this.toUrl(this.path(this.opts.from)):"<no source>"});return this.isSourcesContent()&&this.setSourcesContent(),this.root&&this.previous().length>0&&this.applyPrevMaps(),this.isAnnotation()&&this.addAnnotation(),this.isInline()?[this.css]:[this.css,this.map]}generateString(){this.css="",this.map=new SourceMapGenerator({file:this.outputFile()});let et=1,rt=1,nt="<no source>",it={generated:{column:0,line:0},original:{column:0,line:0},source:""},st,ot;this.stringify(this.root,(lt,ut,ct)=>{if(this.css+=lt,ut&&ct!=="end"&&(it.generated.line=et,it.generated.column=rt-1,ut.source&&ut.source.start?(it.source=this.sourcePath(ut),it.original.line=ut.source.start.line,it.original.column=ut.source.start.column-1,this.map.addMapping(it)):(it.source=nt,it.original.line=1,it.original.column=0,this.map.addMapping(it))),st=lt.match(/\n/g),st?(et+=st.length,ot=lt.lastIndexOf(`
`),rt=lt.length-ot):rt+=lt.length,ut&&ct!=="start"){let dt=ut.parent||{raws:{}};(!(ut.type==="decl"||ut.type==="atrule"&&!ut.nodes)||ut!==dt.last||dt.raws.semicolon)&&(ut.source&&ut.source.end?(it.source=this.sourcePath(ut),it.original.line=ut.source.end.line,it.original.column=ut.source.end.column-1,it.generated.line=et,it.generated.column=rt-2,this.map.addMapping(it)):(it.source=nt,it.original.line=1,it.original.column=0,it.generated.line=et,it.generated.column=rt-1,this.map.addMapping(it)))}})}isAnnotation(){return this.isInline()?!0:typeof this.mapOpts.annotation<"u"?this.mapOpts.annotation:this.previous().length?this.previous().some(et=>et.annotation):!0}isInline(){if(typeof this.mapOpts.inline<"u")return this.mapOpts.inline;let et=this.mapOpts.annotation;return typeof et<"u"&&et!==!0?!1:this.previous().length?this.previous().some(rt=>rt.inline):!0}isMap(){return typeof this.opts.map<"u"?!!this.opts.map:this.previous().length>0}isSourcesContent(){return typeof this.mapOpts.sourcesContent<"u"?this.mapOpts.sourcesContent:this.previous().length?this.previous().some(et=>et.withContent()):!0}outputFile(){return this.opts.to?this.path(this.opts.to):this.opts.from?this.path(this.opts.from):"to.css"}path(et){if(this.mapOpts.absolute||et.charCodeAt(0)===60||/^\w+:\/\//.test(et))return et;let rt=this.memoizedPaths.get(et);if(rt)return rt;let nt=this.opts.to?dirname(this.opts.to):".";typeof this.mapOpts.annotation=="string"&&(nt=dirname(resolve(nt,this.mapOpts.annotation)));let it=relative(nt,et);return this.memoizedPaths.set(et,it),it}previous(){if(!this.previousMaps)if(this.previousMaps=[],this.root)this.root.walk(et=>{if(et.source&&et.source.input.map){let rt=et.source.input.map;this.previousMaps.includes(rt)||this.previousMaps.push(rt)}});else{let et=new Input$3(this.originalCSS,this.opts);et.map&&this.previousMaps.push(et.map)}return this.previousMaps}setSourcesContent(){let et={};if(this.root)this.root.walk(rt=>{if(rt.source){let nt=rt.source.input.from;if(nt&&!et[nt]){et[nt]=!0;let it=this.usesFileUrls?this.toFileUrl(nt):this.toUrl(this.path(nt));this.map.setSourceContent(it,rt.source.input.css)}}});else if(this.css){let rt=this.opts.from?this.toUrl(this.path(this.opts.from)):"<no source>";this.map.setSourceContent(rt,this.css)}}sourcePath(et){return this.mapOpts.from?this.toUrl(this.mapOpts.from):this.usesFileUrls?this.toFileUrl(et.source.input.from):this.toUrl(this.path(et.source.input.from))}toBase64(et){return Buffer?Buffer.from(et).toString("base64"):window.btoa(unescape(encodeURIComponent(et)))}toFileUrl(et){let rt=this.memoizedFileURLs.get(et);if(rt)return rt;if(pathToFileURL){let nt=pathToFileURL(et).toString();return this.memoizedFileURLs.set(et,nt),nt}else throw new Error("`map.absolute` option is not available in this PostCSS build")}toUrl(et){let rt=this.memoizedURLs.get(et);if(rt)return rt;sep==="\\"&&(et=et.replace(/\\/g,"/"));let nt=encodeURI(et).replace(/[#?]/g,encodeURIComponent);return this.memoizedURLs.set(et,nt),nt}};var mapGenerator=MapGenerator$2;let Node$3=node,Comment$4=class extends Node$3{constructor(et){super(et),this.type="comment"}};var comment=Comment$4;Comment$4.default=Comment$4;let{isClean:isClean$1,my:my$1}=symbols,Declaration$3=declaration,Comment$3=comment,Node$2=node,parse$8,Rule$4,AtRule$4,Root$6;function cleanSource(tt){return tt.map(et=>(et.nodes&&(et.nodes=cleanSource(et.nodes)),delete et.source,et))}function markDirtyUp(tt){if(tt[isClean$1]=!1,tt.proxyOf.nodes)for(let et of tt.proxyOf.nodes)markDirtyUp(et)}let Container$7=class po extends Node$2{append(...et){for(let rt of et){let nt=this.normalize(rt,this.last);for(let it of nt)this.proxyOf.nodes.push(it)}return this.markDirty(),this}cleanRaws(et){if(super.cleanRaws(et),this.nodes)for(let rt of this.nodes)rt.cleanRaws(et)}each(et){if(!this.proxyOf.nodes)return;let rt=this.getIterator(),nt,it;for(;this.indexes[rt]<this.proxyOf.nodes.length&&(nt=this.indexes[rt],it=et(this.proxyOf.nodes[nt],nt),it!==!1);)this.indexes[rt]+=1;return delete this.indexes[rt],it}every(et){return this.nodes.every(et)}getIterator(){this.lastEach||(this.lastEach=0),this.indexes||(this.indexes={}),this.lastEach+=1;let et=this.lastEach;return this.indexes[et]=0,et}getProxyProcessor(){return{get(et,rt){return rt==="proxyOf"?et:et[rt]?rt==="each"||typeof rt=="string"&&rt.startsWith("walk")?(...nt)=>et[rt](...nt.map(it=>typeof it=="function"?(st,ot)=>it(st.toProxy(),ot):it)):rt==="every"||rt==="some"?nt=>et[rt]((it,...st)=>nt(it.toProxy(),...st)):rt==="root"?()=>et.root().toProxy():rt==="nodes"?et.nodes.map(nt=>nt.toProxy()):rt==="first"||rt==="last"?et[rt].toProxy():et[rt]:et[rt]},set(et,rt,nt){return et[rt]===nt||(et[rt]=nt,(rt==="name"||rt==="params"||rt==="selector")&&et.markDirty()),!0}}}index(et){return typeof et=="number"?et:(et.proxyOf&&(et=et.proxyOf),this.proxyOf.nodes.indexOf(et))}insertAfter(et,rt){let nt=this.index(et),it=this.normalize(rt,this.proxyOf.nodes[nt]).reverse();nt=this.index(et);for(let ot of it)this.proxyOf.nodes.splice(nt+1,0,ot);let st;for(let ot in this.indexes)st=this.indexes[ot],nt<st&&(this.indexes[ot]=st+it.length);return this.markDirty(),this}insertBefore(et,rt){let nt=this.index(et),it=nt===0?"prepend":!1,st=this.normalize(rt,this.proxyOf.nodes[nt],it).reverse();nt=this.index(et);for(let lt of st)this.proxyOf.nodes.splice(nt,0,lt);let ot;for(let lt in this.indexes)ot=this.indexes[lt],nt<=ot&&(this.indexes[lt]=ot+st.length);return this.markDirty(),this}normalize(et,rt){if(typeof et=="string")et=cleanSource(parse$8(et).nodes);else if(Array.isArray(et)){et=et.slice(0);for(let it of et)it.parent&&it.parent.removeChild(it,"ignore")}else if(et.type==="root"&&this.type!=="document"){et=et.nodes.slice(0);for(let it of et)it.parent&&it.parent.removeChild(it,"ignore")}else if(et.type)et=[et];else if(et.prop){if(typeof et.value>"u")throw new Error("Value field is missed in node creation");typeof et.value!="string"&&(et.value=String(et.value)),et=[new Declaration$3(et)]}else if(et.selector)et=[new Rule$4(et)];else if(et.name)et=[new AtRule$4(et)];else if(et.text)et=[new Comment$3(et)];else throw new Error("Unknown node type in node creation");return et.map(it=>(it[my$1]||po.rebuild(it),it=it.proxyOf,it.parent&&it.parent.removeChild(it),it[isClean$1]&&markDirtyUp(it),typeof it.raws.before>"u"&&rt&&typeof rt.raws.before<"u"&&(it.raws.before=rt.raws.before.replace(/\S/g,"")),it.parent=this.proxyOf,it))}prepend(...et){et=et.reverse();for(let rt of et){let nt=this.normalize(rt,this.first,"prepend").reverse();for(let it of nt)this.proxyOf.nodes.unshift(it);for(let it in this.indexes)this.indexes[it]=this.indexes[it]+nt.length}return this.markDirty(),this}push(et){return et.parent=this,this.proxyOf.nodes.push(et),this}removeAll(){for(let et of this.proxyOf.nodes)et.parent=void 0;return this.proxyOf.nodes=[],this.markDirty(),this}removeChild(et){et=this.index(et),this.proxyOf.nodes[et].parent=void 0,this.proxyOf.nodes.splice(et,1);let rt;for(let nt in this.indexes)rt=this.indexes[nt],rt>=et&&(this.indexes[nt]=rt-1);return this.markDirty(),this}replaceValues(et,rt,nt){return nt||(nt=rt,rt={}),this.walkDecls(it=>{rt.props&&!rt.props.includes(it.prop)||rt.fast&&!it.value.includes(rt.fast)||(it.value=it.value.replace(et,nt))}),this.markDirty(),this}some(et){return this.nodes.some(et)}walk(et){return this.each((rt,nt)=>{let it;try{it=et(rt,nt)}catch(st){throw rt.addToError(st)}return it!==!1&&rt.walk&&(it=rt.walk(et)),it})}walkAtRules(et,rt){return rt?et instanceof RegExp?this.walk((nt,it)=>{if(nt.type==="atrule"&&et.test(nt.name))return rt(nt,it)}):this.walk((nt,it)=>{if(nt.type==="atrule"&&nt.name===et)return rt(nt,it)}):(rt=et,this.walk((nt,it)=>{if(nt.type==="atrule")return rt(nt,it)}))}walkComments(et){return this.walk((rt,nt)=>{if(rt.type==="comment")return et(rt,nt)})}walkDecls(et,rt){return rt?et instanceof RegExp?this.walk((nt,it)=>{if(nt.type==="decl"&&et.test(nt.prop))return rt(nt,it)}):this.walk((nt,it)=>{if(nt.type==="decl"&&nt.prop===et)return rt(nt,it)}):(rt=et,this.walk((nt,it)=>{if(nt.type==="decl")return rt(nt,it)}))}walkRules(et,rt){return rt?et instanceof RegExp?this.walk((nt,it)=>{if(nt.type==="rule"&&et.test(nt.selector))return rt(nt,it)}):this.walk((nt,it)=>{if(nt.type==="rule"&&nt.selector===et)return rt(nt,it)}):(rt=et,this.walk((nt,it)=>{if(nt.type==="rule")return rt(nt,it)}))}get first(){if(this.proxyOf.nodes)return this.proxyOf.nodes[0]}get last(){if(this.proxyOf.nodes)return this.proxyOf.nodes[this.proxyOf.nodes.length-1]}};Container$7.registerParse=tt=>{parse$8=tt};Container$7.registerRule=tt=>{Rule$4=tt};Container$7.registerAtRule=tt=>{AtRule$4=tt};Container$7.registerRoot=tt=>{Root$6=tt};var container=Container$7;Container$7.default=Container$7;Container$7.rebuild=tt=>{tt.type==="atrule"?Object.setPrototypeOf(tt,AtRule$4.prototype):tt.type==="rule"?Object.setPrototypeOf(tt,Rule$4.prototype):tt.type==="decl"?Object.setPrototypeOf(tt,Declaration$3.prototype):tt.type==="comment"?Object.setPrototypeOf(tt,Comment$3.prototype):tt.type==="root"&&Object.setPrototypeOf(tt,Root$6.prototype),tt[my$1]=!0,tt.nodes&&tt.nodes.forEach(et=>{Container$7.rebuild(et)})};let Container$6=container,LazyResult$4,Processor$3,Document$3=class extends Container$6{constructor(et){super({type:"document",...et}),this.nodes||(this.nodes=[])}toResult(et={}){return new LazyResult$4(new Processor$3,this,et).stringify()}};Document$3.registerLazyResult=tt=>{LazyResult$4=tt};Document$3.registerProcessor=tt=>{Processor$3=tt};var document$1=Document$3;Document$3.default=Document$3;let Warning$2=class{constructor(et,rt={}){if(this.type="warning",this.text=et,rt.node&&rt.node.source){let nt=rt.node.rangeBy(rt);this.line=nt.start.line,this.column=nt.start.column,this.endLine=nt.end.line,this.endColumn=nt.end.column}for(let nt in rt)this[nt]=rt[nt]}toString(){return this.node?this.node.error(this.text,{index:this.index,plugin:this.plugin,word:this.word}).message:this.plugin?this.plugin+": "+this.text:this.text}};var warning=Warning$2;Warning$2.default=Warning$2;let Warning$1=warning,Result$3=class{constructor(et,rt,nt){this.processor=et,this.messages=[],this.root=rt,this.opts=nt,this.css=void 0,this.map=void 0}toString(){return this.css}warn(et,rt={}){rt.plugin||this.lastPlugin&&this.lastPlugin.postcssPlugin&&(rt.plugin=this.lastPlugin.postcssPlugin);let nt=new Warning$1(et,rt);return this.messages.push(nt),nt}warnings(){return this.messages.filter(et=>et.type==="warning")}get content(){return this.css}};var result=Result$3;Result$3.default=Result$3;const SINGLE_QUOTE=39,DOUBLE_QUOTE=34,BACKSLASH=92,SLASH=47,NEWLINE=10,SPACE=32,FEED=12,TAB=9,CR=13,OPEN_SQUARE=91,CLOSE_SQUARE=93,OPEN_PARENTHESES=40,CLOSE_PARENTHESES=41,OPEN_CURLY=123,CLOSE_CURLY=125,SEMICOLON=59,ASTERISK=42,COLON=58,AT=64,RE_AT_END=/[\t\n\f\r "#'()/;[\\\]{}]/g,RE_WORD_END=/[\t\n\f\r !"#'():;@[\\\]{}]|\/(?=\*)/g,RE_BAD_BRACKET=/.[\r\n"'(/\\]/,RE_HEX_ESCAPE=/[\da-f]/i;var tokenize=function(et,rt={}){let nt=et.css.valueOf(),it=rt.ignoreErrors,st,ot,lt,ut,ct,dt,pt,ft,gt,_r,Yr=nt.length,mt=0,Kr=[],Xr=[];function Zr(){return mt}function Qr(ss){throw et.error("Unclosed "+ss,mt)}function _i(){return Xr.length===0&&mt>=Yr}function ns(ss){if(Xr.length)return Xr.pop();if(mt>=Yr)return;let hs=ss?ss.ignoreUnclosed:!1;switch(st=nt.charCodeAt(mt),st){case NEWLINE:case SPACE:case TAB:case CR:case FEED:{ot=mt;do ot+=1,st=nt.charCodeAt(ot);while(st===SPACE||st===NEWLINE||st===TAB||st===CR||st===FEED);_r=["space",nt.slice(mt,ot)],mt=ot-1;break}case OPEN_SQUARE:case CLOSE_SQUARE:case OPEN_CURLY:case CLOSE_CURLY:case COLON:case SEMICOLON:case CLOSE_PARENTHESES:{let os=String.fromCharCode(st);_r=[os,os,mt];break}case OPEN_PARENTHESES:{if(ft=Kr.length?Kr.pop()[1]:"",gt=nt.charCodeAt(mt+1),ft==="url"&&gt!==SINGLE_QUOTE&&gt!==DOUBLE_QUOTE&&gt!==SPACE&&gt!==NEWLINE&&gt!==TAB&&gt!==FEED&&gt!==CR){ot=mt;do{if(dt=!1,ot=nt.indexOf(")",ot+1),ot===-1)if(it||hs){ot=mt;break}else Qr("bracket");for(pt=ot;nt.charCodeAt(pt-1)===BACKSLASH;)pt-=1,dt=!dt}while(dt);_r=["brackets",nt.slice(mt,ot+1),mt,ot],mt=ot}else ot=nt.indexOf(")",mt+1),ut=nt.slice(mt,ot+1),ot===-1||RE_BAD_BRACKET.test(ut)?_r=["(","(",mt]:(_r=["brackets",ut,mt,ot],mt=ot);break}case SINGLE_QUOTE:case DOUBLE_QUOTE:{lt=st===SINGLE_QUOTE?"'":'"',ot=mt;do{if(dt=!1,ot=nt.indexOf(lt,ot+1),ot===-1)if(it||hs){ot=mt+1;break}else Qr("string");for(pt=ot;nt.charCodeAt(pt-1)===BACKSLASH;)pt-=1,dt=!dt}while(dt);_r=["string",nt.slice(mt,ot+1),mt,ot],mt=ot;break}case AT:{RE_AT_END.lastIndex=mt+1,RE_AT_END.test(nt),RE_AT_END.lastIndex===0?ot=nt.length-1:ot=RE_AT_END.lastIndex-2,_r=["at-word",nt.slice(mt,ot+1),mt,ot],mt=ot;break}case BACKSLASH:{for(ot=mt,ct=!0;nt.charCodeAt(ot+1)===BACKSLASH;)ot+=1,ct=!ct;if(st=nt.charCodeAt(ot+1),ct&&st!==SLASH&&st!==SPACE&&st!==NEWLINE&&st!==TAB&&st!==CR&&st!==FEED&&(ot+=1,RE_HEX_ESCAPE.test(nt.charAt(ot)))){for(;RE_HEX_ESCAPE.test(nt.charAt(ot+1));)ot+=1;nt.charCodeAt(ot+1)===SPACE&&(ot+=1)}_r=["word",nt.slice(mt,ot+1),mt,ot],mt=ot;break}default:{st===SLASH&&nt.charCodeAt(mt+1)===ASTERISK?(ot=nt.indexOf("*/",mt+2)+1,ot===0&&(it||hs?ot=nt.length:Qr("comment")),_r=["comment",nt.slice(mt,ot+1),mt,ot],mt=ot):(RE_WORD_END.lastIndex=mt+1,RE_WORD_END.test(nt),RE_WORD_END.lastIndex===0?ot=nt.length-1:ot=RE_WORD_END.lastIndex-2,_r=["word",nt.slice(mt,ot+1),mt,ot],Kr.push(_r),mt=ot);break}}return mt++,_r}function rs(ss){Xr.push(ss)}return{back:rs,endOfFile:_i,nextToken:ns,position:Zr}};let Container$5=container,AtRule$3=class extends Container$5{constructor(et){super(et),this.type="atrule"}append(...et){return this.proxyOf.nodes||(this.nodes=[]),super.append(...et)}prepend(...et){return this.proxyOf.nodes||(this.nodes=[]),super.prepend(...et)}};var atRule=AtRule$3;AtRule$3.default=AtRule$3;Container$5.registerAtRule(AtRule$3);let Container$4=container,LazyResult$3,Processor$2,Root$5=class extends Container$4{constructor(et){super(et),this.type="root",this.nodes||(this.nodes=[])}normalize(et,rt,nt){let it=super.normalize(et);if(rt){if(nt==="prepend")this.nodes.length>1?rt.raws.before=this.nodes[1].raws.before:delete rt.raws.before;else if(this.first!==rt)for(let st of it)st.raws.before=rt.raws.before}return it}removeChild(et,rt){let nt=this.index(et);return!rt&&nt===0&&this.nodes.length>1&&(this.nodes[1].raws.before=this.nodes[nt].raws.before),super.removeChild(et)}toResult(et={}){return new LazyResult$3(new Processor$2,this,et).stringify()}};Root$5.registerLazyResult=tt=>{LazyResult$3=tt};Root$5.registerProcessor=tt=>{Processor$2=tt};var root=Root$5;Root$5.default=Root$5;Container$4.registerRoot(Root$5);let list$2={comma(tt){return list$2.split(tt,[","],!0)},space(tt){let et=[" ",`
`,"	"];return list$2.split(tt,et)},split(tt,et,rt){let nt=[],it="",st=!1,ot=0,lt=!1,ut="",ct=!1;for(let dt of tt)ct?ct=!1:dt==="\\"?ct=!0:lt?dt===ut&&(lt=!1):dt==='"'||dt==="'"?(lt=!0,ut=dt):dt==="("?ot+=1:dt===")"?ot>0&&(ot-=1):ot===0&&et.includes(dt)&&(st=!0),st?(it!==""&&nt.push(it.trim()),it="",st=!1):it+=dt;return(rt||it!=="")&&nt.push(it.trim()),nt}};var list_1=list$2;list$2.default=list$2;let Container$3=container,list$1=list_1,Rule$3=class extends Container$3{constructor(et){super(et),this.type="rule",this.nodes||(this.nodes=[])}get selectors(){return list$1.comma(this.selector)}set selectors(et){let rt=this.selector?this.selector.match(/,\s*/):null,nt=rt?rt[0]:","+this.raw("between","beforeOpen");this.selector=et.join(nt)}};var rule=Rule$3;Rule$3.default=Rule$3;Container$3.registerRule(Rule$3);let Declaration$2=declaration,tokenizer=tokenize,Comment$2=comment,AtRule$2=atRule,Root$4=root,Rule$2=rule;const SAFE_COMMENT_NEIGHBOR={empty:!0,space:!0};function findLastWithPosition(tt){for(let et=tt.length-1;et>=0;et--){let rt=tt[et],nt=rt[3]||rt[2];if(nt)return nt}}let Parser$1=class{constructor(et){this.input=et,this.root=new Root$4,this.current=this.root,this.spaces="",this.semicolon=!1,this.customProperty=!1,this.createTokenizer(),this.root.source={input:et,start:{column:1,line:1,offset:0}}}atrule(et){let rt=new AtRule$2;rt.name=et[1].slice(1),rt.name===""&&this.unnamedAtrule(rt,et),this.init(rt,et[2]);let nt,it,st,ot=!1,lt=!1,ut=[],ct=[];for(;!this.tokenizer.endOfFile();){if(et=this.tokenizer.nextToken(),nt=et[0],nt==="("||nt==="["?ct.push(nt==="("?")":"]"):nt==="{"&&ct.length>0?ct.push("}"):nt===ct[ct.length-1]&&ct.pop(),ct.length===0)if(nt===";"){rt.source.end=this.getPosition(et[2]),rt.source.end.offset++,this.semicolon=!0;break}else if(nt==="{"){lt=!0;break}else if(nt==="}"){if(ut.length>0){for(st=ut.length-1,it=ut[st];it&&it[0]==="space";)it=ut[--st];it&&(rt.source.end=this.getPosition(it[3]||it[2]),rt.source.end.offset++)}this.end(et);break}else ut.push(et);else ut.push(et);if(this.tokenizer.endOfFile()){ot=!0;break}}rt.raws.between=this.spacesAndCommentsFromEnd(ut),ut.length?(rt.raws.afterName=this.spacesAndCommentsFromStart(ut),this.raw(rt,"params",ut),ot&&(et=ut[ut.length-1],rt.source.end=this.getPosition(et[3]||et[2]),rt.source.end.offset++,this.spaces=rt.raws.between,rt.raws.between="")):(rt.raws.afterName="",rt.params=""),lt&&(rt.nodes=[],this.current=rt)}checkMissedSemicolon(et){let rt=this.colon(et);if(rt===!1)return;let nt=0,it;for(let st=rt-1;st>=0&&(it=et[st],!(it[0]!=="space"&&(nt+=1,nt===2)));st--);throw this.input.error("Missed semicolon",it[0]==="word"?it[3]+1:it[2])}colon(et){let rt=0,nt,it,st;for(let[ot,lt]of et.entries()){if(nt=lt,it=nt[0],it==="("&&(rt+=1),it===")"&&(rt-=1),rt===0&&it===":")if(!st)this.doubleColon(nt);else{if(st[0]==="word"&&st[1]==="progid")continue;return ot}st=nt}return!1}comment(et){let rt=new Comment$2;this.init(rt,et[2]),rt.source.end=this.getPosition(et[3]||et[2]),rt.source.end.offset++;let nt=et[1].slice(2,-2);if(/^\s*$/.test(nt))rt.text="",rt.raws.left=nt,rt.raws.right="";else{let it=nt.match(/^(\s*)([^]*\S)(\s*)$/);rt.text=it[2],rt.raws.left=it[1],rt.raws.right=it[3]}}createTokenizer(){this.tokenizer=tokenizer(this.input)}decl(et,rt){let nt=new Declaration$2;this.init(nt,et[0][2]);let it=et[et.length-1];for(it[0]===";"&&(this.semicolon=!0,et.pop()),nt.source.end=this.getPosition(it[3]||it[2]||findLastWithPosition(et)),nt.source.end.offset++;et[0][0]!=="word";)et.length===1&&this.unknownWord(et),nt.raws.before+=et.shift()[1];for(nt.source.start=this.getPosition(et[0][2]),nt.prop="";et.length;){let ct=et[0][0];if(ct===":"||ct==="space"||ct==="comment")break;nt.prop+=et.shift()[1]}nt.raws.between="";let st;for(;et.length;)if(st=et.shift(),st[0]===":"){nt.raws.between+=st[1];break}else st[0]==="word"&&/\w/.test(st[1])&&this.unknownWord([st]),nt.raws.between+=st[1];(nt.prop[0]==="_"||nt.prop[0]==="*")&&(nt.raws.before+=nt.prop[0],nt.prop=nt.prop.slice(1));let ot=[],lt;for(;et.length&&(lt=et[0][0],!(lt!=="space"&&lt!=="comment"));)ot.push(et.shift());this.precheckMissedSemicolon(et);for(let ct=et.length-1;ct>=0;ct--){if(st=et[ct],st[1].toLowerCase()==="!important"){nt.important=!0;let dt=this.stringFrom(et,ct);dt=this.spacesFromEnd(et)+dt,dt!==" !important"&&(nt.raws.important=dt);break}else if(st[1].toLowerCase()==="important"){let dt=et.slice(0),pt="";for(let ft=ct;ft>0;ft--){let gt=dt[ft][0];if(pt.trim().indexOf("!")===0&&gt!=="space")break;pt=dt.pop()[1]+pt}pt.trim().indexOf("!")===0&&(nt.important=!0,nt.raws.important=pt,et=dt)}if(st[0]!=="space"&&st[0]!=="comment")break}et.some(ct=>ct[0]!=="space"&&ct[0]!=="comment")&&(nt.raws.between+=ot.map(ct=>ct[1]).join(""),ot=[]),this.raw(nt,"value",ot.concat(et),rt),nt.value.includes(":")&&!rt&&this.checkMissedSemicolon(et)}doubleColon(et){throw this.input.error("Double colon",{offset:et[2]},{offset:et[2]+et[1].length})}emptyRule(et){let rt=new Rule$2;this.init(rt,et[2]),rt.selector="",rt.raws.between="",this.current=rt}end(et){this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.semicolon=!1,this.current.raws.after=(this.current.raws.after||"")+this.spaces,this.spaces="",this.current.parent?(this.current.source.end=this.getPosition(et[2]),this.current.source.end.offset++,this.current=this.current.parent):this.unexpectedClose(et)}endFile(){this.current.parent&&this.unclosedBlock(),this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.current.raws.after=(this.current.raws.after||"")+this.spaces,this.root.source.end=this.getPosition(this.tokenizer.position())}freeSemicolon(et){if(this.spaces+=et[1],this.current.nodes){let rt=this.current.nodes[this.current.nodes.length-1];rt&&rt.type==="rule"&&!rt.raws.ownSemicolon&&(rt.raws.ownSemicolon=this.spaces,this.spaces="")}}getPosition(et){let rt=this.input.fromOffset(et);return{column:rt.col,line:rt.line,offset:et}}init(et,rt){this.current.push(et),et.source={input:this.input,start:this.getPosition(rt)},et.raws.before=this.spaces,this.spaces="",et.type!=="comment"&&(this.semicolon=!1)}other(et){let rt=!1,nt=null,it=!1,st=null,ot=[],lt=et[1].startsWith("--"),ut=[],ct=et;for(;ct;){if(nt=ct[0],ut.push(ct),nt==="("||nt==="[")st||(st=ct),ot.push(nt==="("?")":"]");else if(lt&&it&&nt==="{")st||(st=ct),ot.push("}");else if(ot.length===0)if(nt===";")if(it){this.decl(ut,lt);return}else break;else if(nt==="{"){this.rule(ut);return}else if(nt==="}"){this.tokenizer.back(ut.pop()),rt=!0;break}else nt===":"&&(it=!0);else nt===ot[ot.length-1]&&(ot.pop(),ot.length===0&&(st=null));ct=this.tokenizer.nextToken()}if(this.tokenizer.endOfFile()&&(rt=!0),ot.length>0&&this.unclosedBracket(st),rt&&it){if(!lt)for(;ut.length&&(ct=ut[ut.length-1][0],!(ct!=="space"&&ct!=="comment"));)this.tokenizer.back(ut.pop());this.decl(ut,lt)}else this.unknownWord(ut)}parse(){let et;for(;!this.tokenizer.endOfFile();)switch(et=this.tokenizer.nextToken(),et[0]){case"space":this.spaces+=et[1];break;case";":this.freeSemicolon(et);break;case"}":this.end(et);break;case"comment":this.comment(et);break;case"at-word":this.atrule(et);break;case"{":this.emptyRule(et);break;default:this.other(et);break}this.endFile()}precheckMissedSemicolon(){}raw(et,rt,nt,it){let st,ot,lt=nt.length,ut="",ct=!0,dt,pt;for(let ft=0;ft<lt;ft+=1)st=nt[ft],ot=st[0],ot==="space"&&ft===lt-1&&!it?ct=!1:ot==="comment"?(pt=nt[ft-1]?nt[ft-1][0]:"empty",dt=nt[ft+1]?nt[ft+1][0]:"empty",!SAFE_COMMENT_NEIGHBOR[pt]&&!SAFE_COMMENT_NEIGHBOR[dt]?ut.slice(-1)===","?ct=!1:ut+=st[1]:ct=!1):ut+=st[1];if(!ct){let ft=nt.reduce((gt,_r)=>gt+_r[1],"");et.raws[rt]={raw:ft,value:ut}}et[rt]=ut}rule(et){et.pop();let rt=new Rule$2;this.init(rt,et[0][2]),rt.raws.between=this.spacesAndCommentsFromEnd(et),this.raw(rt,"selector",et),this.current=rt}spacesAndCommentsFromEnd(et){let rt,nt="";for(;et.length&&(rt=et[et.length-1][0],!(rt!=="space"&&rt!=="comment"));)nt=et.pop()[1]+nt;return nt}spacesAndCommentsFromStart(et){let rt,nt="";for(;et.length&&(rt=et[0][0],!(rt!=="space"&&rt!=="comment"));)nt+=et.shift()[1];return nt}spacesFromEnd(et){let rt,nt="";for(;et.length&&(rt=et[et.length-1][0],rt==="space");)nt=et.pop()[1]+nt;return nt}stringFrom(et,rt){let nt="";for(let it=rt;it<et.length;it++)nt+=et[it][1];return et.splice(rt,et.length-rt),nt}unclosedBlock(){let et=this.current.source.start;throw this.input.error("Unclosed block",et.line,et.column)}unclosedBracket(et){throw this.input.error("Unclosed bracket",{offset:et[2]},{offset:et[2]+1})}unexpectedClose(et){throw this.input.error("Unexpected }",{offset:et[2]},{offset:et[2]+1})}unknownWord(et){throw this.input.error("Unknown word",{offset:et[0][2]},{offset:et[0][2]+et[0][1].length})}unnamedAtrule(et,rt){throw this.input.error("At-rule without name",{offset:rt[2]},{offset:rt[2]+rt[1].length})}};var parser$1=Parser$1;let Container$2=container,Parser=parser$1,Input$2=input;function parse$7(tt,et){let rt=new Input$2(tt,et),nt=new Parser(rt);try{nt.parse()}catch(it){throw it}return nt.root}var parse_1=parse$7;parse$7.default=parse$7;Container$2.registerParse(parse$7);let{isClean,my}=symbols,MapGenerator$1=mapGenerator,stringify$2=stringify_1,Container$1=container,Document$2=document$1,Result$2=result,parse$6=parse_1,Root$3=root;const TYPE_TO_CLASS_NAME={atrule:"AtRule",comment:"Comment",decl:"Declaration",document:"Document",root:"Root",rule:"Rule"},PLUGIN_PROPS={AtRule:!0,AtRuleExit:!0,Comment:!0,CommentExit:!0,Declaration:!0,DeclarationExit:!0,Document:!0,DocumentExit:!0,Once:!0,OnceExit:!0,postcssPlugin:!0,prepare:!0,Root:!0,RootExit:!0,Rule:!0,RuleExit:!0},NOT_VISITORS={Once:!0,postcssPlugin:!0,prepare:!0},CHILDREN=0;function isPromise$1(tt){return typeof tt=="object"&&typeof tt.then=="function"}function getEvents(tt){let et=!1,rt=TYPE_TO_CLASS_NAME[tt.type];return tt.type==="decl"?et=tt.prop.toLowerCase():tt.type==="atrule"&&(et=tt.name.toLowerCase()),et&&tt.append?[rt,rt+"-"+et,CHILDREN,rt+"Exit",rt+"Exit-"+et]:et?[rt,rt+"-"+et,rt+"Exit",rt+"Exit-"+et]:tt.append?[rt,CHILDREN,rt+"Exit"]:[rt,rt+"Exit"]}function toStack(tt){let et;return tt.type==="document"?et=["Document",CHILDREN,"DocumentExit"]:tt.type==="root"?et=["Root",CHILDREN,"RootExit"]:et=getEvents(tt),{eventIndex:0,events:et,iterator:0,node:tt,visitorIndex:0,visitors:[]}}function cleanMarks(tt){return tt[isClean]=!1,tt.nodes&&tt.nodes.forEach(et=>cleanMarks(et)),tt}let postcss$1={},LazyResult$2=class mo{constructor(et,rt,nt){this.stringified=!1,this.processed=!1;let it;if(typeof rt=="object"&&rt!==null&&(rt.type==="root"||rt.type==="document"))it=cleanMarks(rt);else if(rt instanceof mo||rt instanceof Result$2)it=cleanMarks(rt.root),rt.map&&(typeof nt.map>"u"&&(nt.map={}),nt.map.inline||(nt.map.inline=!1),nt.map.prev=rt.map);else{let st=parse$6;nt.syntax&&(st=nt.syntax.parse),nt.parser&&(st=nt.parser),st.parse&&(st=st.parse);try{it=st(rt,nt)}catch(ot){this.processed=!0,this.error=ot}it&&!it[my]&&Container$1.rebuild(it)}this.result=new Result$2(et,it,nt),this.helpers={...postcss$1,postcss:postcss$1,result:this.result},this.plugins=this.processor.plugins.map(st=>typeof st=="object"&&st.prepare?{...st,...st.prepare(this.result)}:st)}async(){return this.error?Promise.reject(this.error):this.processed?Promise.resolve(this.result):(this.processing||(this.processing=this.runAsync()),this.processing)}catch(et){return this.async().catch(et)}finally(et){return this.async().then(et,et)}getAsyncError(){throw new Error("Use process(css).then(cb) to work with async plugins")}handleError(et,rt){let nt=this.result.lastPlugin;try{rt&&rt.addToError(et),this.error=et,et.name==="CssSyntaxError"&&!et.plugin?(et.plugin=nt.postcssPlugin,et.setMessage()):nt.postcssVersion}catch(it){console&&console.error&&console.error(it)}return et}prepareVisitors(){this.listeners={};let et=(rt,nt,it)=>{this.listeners[nt]||(this.listeners[nt]=[]),this.listeners[nt].push([rt,it])};for(let rt of this.plugins)if(typeof rt=="object")for(let nt in rt){if(!PLUGIN_PROPS[nt]&&/^[A-Z]/.test(nt))throw new Error(`Unknown event ${nt} in ${rt.postcssPlugin}. Try to update PostCSS (${this.processor.version} now).`);if(!NOT_VISITORS[nt])if(typeof rt[nt]=="object")for(let it in rt[nt])it==="*"?et(rt,nt,rt[nt][it]):et(rt,nt+"-"+it.toLowerCase(),rt[nt][it]);else typeof rt[nt]=="function"&&et(rt,nt,rt[nt])}this.hasListener=Object.keys(this.listeners).length>0}async runAsync(){this.plugin=0;for(let et=0;et<this.plugins.length;et++){let rt=this.plugins[et],nt=this.runOnRoot(rt);if(isPromise$1(nt))try{await nt}catch(it){throw this.handleError(it)}}if(this.prepareVisitors(),this.hasListener){let et=this.result.root;for(;!et[isClean];){et[isClean]=!0;let rt=[toStack(et)];for(;rt.length>0;){let nt=this.visitTick(rt);if(isPromise$1(nt))try{await nt}catch(it){let st=rt[rt.length-1].node;throw this.handleError(it,st)}}}if(this.listeners.OnceExit)for(let[rt,nt]of this.listeners.OnceExit){this.result.lastPlugin=rt;try{if(et.type==="document"){let it=et.nodes.map(st=>nt(st,this.helpers));await Promise.all(it)}else await nt(et,this.helpers)}catch(it){throw this.handleError(it)}}}return this.processed=!0,this.stringify()}runOnRoot(et){this.result.lastPlugin=et;try{if(typeof et=="object"&&et.Once){if(this.result.root.type==="document"){let rt=this.result.root.nodes.map(nt=>et.Once(nt,this.helpers));return isPromise$1(rt[0])?Promise.all(rt):rt}return et.Once(this.result.root,this.helpers)}else if(typeof et=="function")return et(this.result.root,this.result)}catch(rt){throw this.handleError(rt)}}stringify(){if(this.error)throw this.error;if(this.stringified)return this.result;this.stringified=!0,this.sync();let et=this.result.opts,rt=stringify$2;et.syntax&&(rt=et.syntax.stringify),et.stringifier&&(rt=et.stringifier),rt.stringify&&(rt=rt.stringify);let it=new MapGenerator$1(rt,this.result.root,this.result.opts).generate();return this.result.css=it[0],this.result.map=it[1],this.result}sync(){if(this.error)throw this.error;if(this.processed)return this.result;if(this.processed=!0,this.processing)throw this.getAsyncError();for(let et of this.plugins){let rt=this.runOnRoot(et);if(isPromise$1(rt))throw this.getAsyncError()}if(this.prepareVisitors(),this.hasListener){let et=this.result.root;for(;!et[isClean];)et[isClean]=!0,this.walkSync(et);if(this.listeners.OnceExit)if(et.type==="document")for(let rt of et.nodes)this.visitSync(this.listeners.OnceExit,rt);else this.visitSync(this.listeners.OnceExit,et)}return this.result}then(et,rt){return this.async().then(et,rt)}toString(){return this.css}visitSync(et,rt){for(let[nt,it]of et){this.result.lastPlugin=nt;let st;try{st=it(rt,this.helpers)}catch(ot){throw this.handleError(ot,rt.proxyOf)}if(rt.type!=="root"&&rt.type!=="document"&&!rt.parent)return!0;if(isPromise$1(st))throw this.getAsyncError()}}visitTick(et){let rt=et[et.length-1],{node:nt,visitors:it}=rt;if(nt.type!=="root"&&nt.type!=="document"&&!nt.parent){et.pop();return}if(it.length>0&&rt.visitorIndex<it.length){let[ot,lt]=it[rt.visitorIndex];rt.visitorIndex+=1,rt.visitorIndex===it.length&&(rt.visitors=[],rt.visitorIndex=0),this.result.lastPlugin=ot;try{return lt(nt.toProxy(),this.helpers)}catch(ut){throw this.handleError(ut,nt)}}if(rt.iterator!==0){let ot=rt.iterator,lt;for(;lt=nt.nodes[nt.indexes[ot]];)if(nt.indexes[ot]+=1,!lt[isClean]){lt[isClean]=!0,et.push(toStack(lt));return}rt.iterator=0,delete nt.indexes[ot]}let st=rt.events;for(;rt.eventIndex<st.length;){let ot=st[rt.eventIndex];if(rt.eventIndex+=1,ot===CHILDREN){nt.nodes&&nt.nodes.length&&(nt[isClean]=!0,rt.iterator=nt.getIterator());return}else if(this.listeners[ot]){rt.visitors=this.listeners[ot];return}}et.pop()}walkSync(et){et[isClean]=!0;let rt=getEvents(et);for(let nt of rt)if(nt===CHILDREN)et.nodes&&et.each(it=>{it[isClean]||this.walkSync(it)});else{let it=this.listeners[nt];if(it&&this.visitSync(it,et.toProxy()))return}}warnings(){return this.sync().warnings()}get content(){return this.stringify().content}get css(){return this.stringify().css}get map(){return this.stringify().map}get messages(){return this.sync().messages}get opts(){return this.result.opts}get processor(){return this.result.processor}get root(){return this.sync().root}get[Symbol.toStringTag](){return"LazyResult"}};LazyResult$2.registerPostcss=tt=>{postcss$1=tt};var lazyResult=LazyResult$2;LazyResult$2.default=LazyResult$2;Root$3.registerLazyResult(LazyResult$2);Document$2.registerLazyResult(LazyResult$2);let MapGenerator=mapGenerator,stringify$1=stringify_1,parse$5=parse_1;const Result$1=result;let NoWorkResult$1=class{constructor(et,rt,nt){rt=rt.toString(),this.stringified=!1,this._processor=et,this._css=rt,this._opts=nt,this._map=void 0;let it,st=stringify$1;this.result=new Result$1(this._processor,it,this._opts),this.result.css=rt;let ot=this;Object.defineProperty(this.result,"root",{get(){return ot.root}});let lt=new MapGenerator(st,it,this._opts,rt);if(lt.isMap()){let[ut,ct]=lt.generate();ut&&(this.result.css=ut),ct&&(this.result.map=ct)}else lt.clearAnnotation(),this.result.css=lt.css}async(){return this.error?Promise.reject(this.error):Promise.resolve(this.result)}catch(et){return this.async().catch(et)}finally(et){return this.async().then(et,et)}sync(){if(this.error)throw this.error;return this.result}then(et,rt){return this.async().then(et,rt)}toString(){return this._css}warnings(){return[]}get content(){return this.result.css}get css(){return this.result.css}get map(){return this.result.map}get messages(){return[]}get opts(){return this.result.opts}get processor(){return this.result.processor}get root(){if(this._root)return this._root;let et,rt=parse$5;try{et=rt(this._css,this._opts)}catch(nt){this.error=nt}if(this.error)throw this.error;return this._root=et,et}get[Symbol.toStringTag](){return"NoWorkResult"}};var noWorkResult=NoWorkResult$1;NoWorkResult$1.default=NoWorkResult$1;let NoWorkResult=noWorkResult,LazyResult$1=lazyResult,Document$1=document$1,Root$2=root,Processor$1=class{constructor(et=[]){this.version="8.4.33",this.plugins=this.normalize(et)}normalize(et){let rt=[];for(let nt of et)if(nt.postcss===!0?nt=nt():nt.postcss&&(nt=nt.postcss),typeof nt=="object"&&Array.isArray(nt.plugins))rt=rt.concat(nt.plugins);else if(typeof nt=="object"&&nt.postcssPlugin)rt.push(nt);else if(typeof nt=="function")rt.push(nt);else if(!(typeof nt=="object"&&(nt.parse||nt.stringify)))throw new Error(nt+" is not a PostCSS plugin");return rt}process(et,rt={}){return!this.plugins.length&&!rt.parser&&!rt.stringifier&&!rt.syntax?new NoWorkResult(this,et,rt):new LazyResult$1(this,et,rt)}use(et){return this.plugins=this.plugins.concat(this.normalize([et])),this}};var processor=Processor$1;Processor$1.default=Processor$1;Root$2.registerProcessor(Processor$1);Document$1.registerProcessor(Processor$1);let Declaration$1=declaration,PreviousMap=previousMap,Comment$1=comment,AtRule$1=atRule,Input$1=input,Root$1=root,Rule$1=rule;function fromJSON$1(tt,et){if(Array.isArray(tt))return tt.map(it=>fromJSON$1(it));let{inputs:rt,...nt}=tt;if(rt){et=[];for(let it of rt){let st={...it,__proto__:Input$1.prototype};st.map&&(st.map={...st.map,__proto__:PreviousMap.prototype}),et.push(st)}}if(nt.nodes&&(nt.nodes=tt.nodes.map(it=>fromJSON$1(it,et))),nt.source){let{inputId:it,...st}=nt.source;nt.source=st,it!=null&&(nt.source.input=et[it])}if(nt.type==="root")return new Root$1(nt);if(nt.type==="decl")return new Declaration$1(nt);if(nt.type==="rule")return new Rule$1(nt);if(nt.type==="comment")return new Comment$1(nt);if(nt.type==="atrule")return new AtRule$1(nt);throw new Error("Unknown node type: "+tt.type)}var fromJSON_1=fromJSON$1;fromJSON$1.default=fromJSON$1;var define_process_env_default={};let CssSyntaxError=cssSyntaxError,Declaration=declaration,LazyResult=lazyResult,Container=container,Processor=processor,stringify=stringify_1,fromJSON=fromJSON_1,Document=document$1,Warning=warning,Comment=comment,AtRule=atRule,Result=result,Input=input,parse$4=parse_1,list=list_1,Rule=rule,Root=root,Node$1=node;function postcss(...tt){return tt.length===1&&Array.isArray(tt[0])&&(tt=tt[0]),new Processor(tt)}postcss.plugin=function(et,rt){let nt=!1;function it(...ot){console&&console.warn&&!nt&&(nt=!0,console.warn(et+`: postcss.plugin was deprecated. Migration guide:
https://evilmartians.com/chronicles/postcss-8-plugin-migration`),define_process_env_default.LANG&&define_process_env_default.LANG.startsWith("cn")&&console.warn(et+`:  postcss.plugin . :
https://www.w3ctech.com/topic/2226`));let lt=rt(...ot);return lt.postcssPlugin=et,lt.postcssVersion=new Processor().version,lt}let st;return Object.defineProperty(it,"postcss",{get(){return st||(st=it()),st}}),it.process=function(ot,lt,ut){return postcss([it(ut)]).process(ot,lt)},it};postcss.stringify=stringify;postcss.parse=parse$4;postcss.fromJSON=fromJSON;postcss.list=list;postcss.comment=tt=>new Comment(tt);postcss.atRule=tt=>new AtRule(tt);postcss.decl=tt=>new Declaration(tt);postcss.rule=tt=>new Rule(tt);postcss.root=tt=>new Root(tt);postcss.document=tt=>new Document(tt);postcss.CssSyntaxError=CssSyntaxError;postcss.Declaration=Declaration;postcss.Container=Container;postcss.Processor=Processor;postcss.Document=Document;postcss.Comment=Comment;postcss.Warning=Warning;postcss.AtRule=AtRule;postcss.Result=Result;postcss.Input=Input;postcss.Rule=Rule;postcss.Root=Root;postcss.Node=Node$1;LazyResult.registerPostcss(postcss);var postcss_1=postcss;postcss.default=postcss;const htmlparser=lib$5,escapeStringRegexp=escapeStringRegexp$1,{isPlainObject}=isPlainObject$2,deepmerge=cjs,parseSrcset=parseSrcsetExports,{parse:postcssParse}=postcss_1,mediaTags=["img","audio","video","picture","svg","object","map","iframe","embed"],vulnerableTags=["script","style"];function each(tt,et){tt&&Object.keys(tt).forEach(function(rt){et(tt[rt],rt)})}function has(tt,et){return{}.hasOwnProperty.call(tt,et)}function filter(tt,et){const rt=[];return each(tt,function(nt){et(nt)&&rt.push(nt)}),rt}function isEmptyObject(tt){for(const et in tt)if(has(tt,et))return!1;return!0}function stringifySrcset(tt){return tt.map(function(et){if(!et.url)throw new Error("URL missing");return et.url+(et.w?` ${et.w}w`:"")+(et.h?` ${et.h}h`:"")+(et.d?` ${et.d}x`:"")}).join(", ")}var sanitizeHtml_1=sanitizeHtml;const VALID_HTML_ATTRIBUTE_NAME=/^[^\0\t\n\f\r /<=>]+$/;function sanitizeHtml(tt,et,rt){if(tt==null)return"";typeof tt=="number"&&(tt=tt.toString());let nt="",it="";function st(ls,ms){const us=this;this.tag=ls,this.attribs=ms||{},this.tagPosition=nt.length,this.text="",this.mediaChildren=[],this.updateParentNodeText=function(){if(mt.length){const gs=mt[mt.length-1];gs.text+=us.text}},this.updateParentNodeMediaChildren=function(){mt.length&&mediaTags.includes(this.tag)&&mt[mt.length-1].mediaChildren.push(this.tag)}}et=Object.assign({},sanitizeHtml.defaults,et),et.parser=Object.assign({},htmlParserDefaults,et.parser);const ot=function(ls){return et.allowedTags===!1||(et.allowedTags||[]).indexOf(ls)>-1};vulnerableTags.forEach(function(ls){ot(ls)&&!et.allowVulnerableTags&&console.warn(`

 Your \`allowedTags\` option includes, \`${ls}\`, which is inherently
vulnerable to XSS attacks. Please remove it from \`allowedTags\`.
Or, to disable this warning, add the \`allowVulnerableTags\` option
and ensure you are accounting for this risk.

`)});const lt=et.nonTextTags||["script","style","textarea","option"];let ut,ct;et.allowedAttributes&&(ut={},ct={},each(et.allowedAttributes,function(ls,ms){ut[ms]=[];const us=[];ls.forEach(function(gs){typeof gs=="string"&&gs.indexOf("*")>=0?us.push(escapeStringRegexp(gs).replace(/\\\*/g,".*")):ut[ms].push(gs)}),us.length&&(ct[ms]=new RegExp("^("+us.join("|")+")$"))}));const dt={},pt={},ft={};each(et.allowedClasses,function(ls,ms){if(ut&&(has(ut,ms)||(ut[ms]=[]),ut[ms].push("class")),dt[ms]=ls,Array.isArray(ls)){const us=[];dt[ms]=[],ft[ms]=[],ls.forEach(function(gs){typeof gs=="string"&&gs.indexOf("*")>=0?us.push(escapeStringRegexp(gs).replace(/\\\*/g,".*")):gs instanceof RegExp?ft[ms].push(gs):dt[ms].push(gs)}),us.length&&(pt[ms]=new RegExp("^("+us.join("|")+")$"))}});const gt={};let _r;each(et.transformTags,function(ls,ms){let us;typeof ls=="function"?us=ls:typeof ls=="string"&&(us=sanitizeHtml.simpleTransform(ls)),ms==="*"?_r=us:gt[ms]=us});let Yr,mt,Kr,Xr,Zr,Qr,_i=!1;rs();const ns=new htmlparser.Parser({onopentag:function(ls,ms){if(et.enforceHtmlBoundary&&ls==="html"&&rs(),Zr){Qr++;return}const us=new st(ls,ms);mt.push(us);let gs=!1;const ys=!!us.text;let Es;if(has(gt,ls)&&(Es=gt[ls](ls,ms),us.attribs=ms=Es.attribs,Es.text!==void 0&&(us.innerText=Es.text),ls!==Es.tagName&&(us.name=ls=Es.tagName,Xr[Yr]=Es.tagName)),_r&&(Es=_r(ls,ms),us.attribs=ms=Es.attribs,ls!==Es.tagName&&(us.name=ls=Es.tagName,Xr[Yr]=Es.tagName)),(!ot(ls)||et.disallowedTagsMode==="recursiveEscape"&&!isEmptyObject(Kr)||et.nestingLimit!=null&&Yr>=et.nestingLimit)&&(gs=!0,Kr[Yr]=!0,et.disallowedTagsMode==="discard"&&lt.indexOf(ls)!==-1&&(Zr=!0,Qr=1),Kr[Yr]=!0),Yr++,gs){if(et.disallowedTagsMode==="discard")return;it=nt,nt=""}nt+="<"+ls,ls==="script"&&(et.allowedScriptHostnames||et.allowedScriptDomains)&&(us.innerText=""),(!ut||has(ut,ls)||ut["*"])&&each(ms,function(Ss,Ts){if(!VALID_HTML_ATTRIBUTE_NAME.test(Ts)){delete us.attribs[Ts];return}if(Ss===""&&(et.nonBooleanAttributes.includes(Ts)||et.nonBooleanAttributes.includes("*"))){delete us.attribs[Ts];return}let Ds=!1;if(!ut||has(ut,ls)&&ut[ls].indexOf(Ts)!==-1||ut["*"]&&ut["*"].indexOf(Ts)!==-1||has(ct,ls)&&ct[ls].test(Ts)||ct["*"]&&ct["*"].test(Ts))Ds=!0;else if(ut&&ut[ls]){for(const Rs of ut[ls])if(isPlainObject(Rs)&&Rs.name&&Rs.name===Ts){Ds=!0;let Is="";if(Rs.multiple===!0){const ks=Ss.split(" ");for(const As of ks)Rs.values.indexOf(As)!==-1&&(Is===""?Is=As:Is+=" "+As)}else Rs.values.indexOf(Ss)>=0&&(Is=Ss);Ss=Is}}if(Ds){if(et.allowedSchemesAppliedToAttributes.indexOf(Ts)!==-1&&hs(ls,Ss)){delete us.attribs[Ts];return}if(ls==="script"&&Ts==="src"){let Rs=!0;try{const Is=os(Ss);if(et.allowedScriptHostnames||et.allowedScriptDomains){const ks=(et.allowedScriptHostnames||[]).find(function(Os){return Os===Is.url.hostname}),As=(et.allowedScriptDomains||[]).find(function(Os){return Is.url.hostname===Os||Is.url.hostname.endsWith(`.${Os}`)});Rs=ks||As}}catch{Rs=!1}if(!Rs){delete us.attribs[Ts];return}}if(ls==="iframe"&&Ts==="src"){let Rs=!0;try{const Is=os(Ss);if(Is.isRelativeUrl)Rs=has(et,"allowIframeRelativeUrls")?et.allowIframeRelativeUrls:!et.allowedIframeHostnames&&!et.allowedIframeDomains;else if(et.allowedIframeHostnames||et.allowedIframeDomains){const ks=(et.allowedIframeHostnames||[]).find(function(Os){return Os===Is.url.hostname}),As=(et.allowedIframeDomains||[]).find(function(Os){return Is.url.hostname===Os||Is.url.hostname.endsWith(`.${Os}`)});Rs=ks||As}}catch{Rs=!1}if(!Rs){delete us.attribs[Ts];return}}if(Ts==="srcset")try{let Rs=parseSrcset(Ss);if(Rs.forEach(function(Is){hs("srcset",Is.url)&&(Is.evil=!0)}),Rs=filter(Rs,function(Is){return!Is.evil}),Rs.length)Ss=stringifySrcset(filter(Rs,function(Is){return!Is.evil})),us.attribs[Ts]=Ss;else{delete us.attribs[Ts];return}}catch{delete us.attribs[Ts];return}if(Ts==="class"){const Rs=dt[ls],Is=dt["*"],ks=pt[ls],As=ft[ls],Os=pt["*"],Ys=[ks,Os].concat(As).filter(function(Vs){return Vs});if(Rs&&Is?Ss=vs(Ss,deepmerge(Rs,Is),Ys):Ss=vs(Ss,Rs||Is,Ys),!Ss.length){delete us.attribs[Ts];return}}if(Ts==="style"){if(et.parseStyleAttributes)try{const Rs=postcssParse(ls+" {"+Ss+"}"),Is=is(Rs,et.allowedStyles);if(Ss=cs(Is),Ss.length===0){delete us.attribs[Ts];return}}catch{typeof window<"u"&&console.warn('Failed to parse "'+ls+" {"+Ss+`}", If you're running this in a browser, we recommend to disable style parsing: options.parseStyleAttributes: false, since this only works in a node environment due to a postcss dependency, More info: https://github.com/apostrophecms/sanitize-html/issues/547`),delete us.attribs[Ts];return}else if(et.allowedStyles)throw new Error("allowedStyles option cannot be used together with parseStyleAttributes: false.")}nt+=" "+Ts,Ss&&Ss.length&&(nt+='="'+ss(Ss,!0)+'"')}else delete us.attribs[Ts]}),et.selfClosing.indexOf(ls)!==-1?nt+=" />":(nt+=">",us.innerText&&!ys&&!et.textFilter&&(nt+=ss(us.innerText),_i=!0)),gs&&(nt=it+ss(nt),it="")},ontext:function(ls){if(Zr)return;const ms=mt[mt.length-1];let us;if(ms&&(us=ms.tag,ls=ms.innerText!==void 0?ms.innerText:ls),et.disallowedTagsMode==="discard"&&(us==="script"||us==="style"))nt+=ls;else{const gs=ss(ls,!1);et.textFilter&&!_i?nt+=et.textFilter(gs,us):_i||(nt+=gs)}if(mt.length){const gs=mt[mt.length-1];gs.text+=ls}},onclosetag:function(ls,ms){if(Zr)if(Qr--,!Qr)Zr=!1;else return;const us=mt.pop();if(!us)return;if(us.tag!==ls){mt.push(us);return}Zr=et.enforceHtmlBoundary?ls==="html":!1,Yr--;const gs=Kr[Yr];if(gs){if(delete Kr[Yr],et.disallowedTagsMode==="discard"){us.updateParentNodeText();return}it=nt,nt=""}if(Xr[Yr]&&(ls=Xr[Yr],delete Xr[Yr]),et.exclusiveFilter&&et.exclusiveFilter(us)){nt=nt.substr(0,us.tagPosition);return}if(us.updateParentNodeMediaChildren(),us.updateParentNodeText(),et.selfClosing.indexOf(ls)!==-1||ms&&!ot(ls)&&["escape","recursiveEscape"].indexOf(et.disallowedTagsMode)>=0){gs&&(nt=it,it="");return}nt+="</"+ls+">",gs&&(nt=it+ss(nt),it=""),_i=!1}},et.parser);return ns.write(tt),ns.end(),nt;function rs(){nt="",Yr=0,mt=[],Kr={},Xr={},Zr=!1,Qr=0}function ss(ls,ms){return typeof ls!="string"&&(ls=ls+""),et.parser.decodeEntities&&(ls=ls.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),ms&&(ls=ls.replace(/"/g,"&quot;"))),ls=ls.replace(/&(?![a-zA-Z0-9#]{1,20};)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),ms&&(ls=ls.replace(/"/g,"&quot;")),ls}function hs(ls,ms){for(ms=ms.replace(/[\x00-\x20]+/g,"");;){const ys=ms.indexOf("<!--");if(ys===-1)break;const Es=ms.indexOf("-->",ys+4);if(Es===-1)break;ms=ms.substring(0,ys)+ms.substring(Es+3)}const us=ms.match(/^([a-zA-Z][a-zA-Z0-9.\-+]*):/);if(!us)return ms.match(/^[/\\]{2}/)?!et.allowProtocolRelative:!1;const gs=us[1].toLowerCase();return has(et.allowedSchemesByTag,ls)?et.allowedSchemesByTag[ls].indexOf(gs)===-1:!et.allowedSchemes||et.allowedSchemes.indexOf(gs)===-1}function os(ls){if(ls=ls.replace(/^(\w+:)?\s*[\\/]\s*[\\/]/,"$1//"),ls.startsWith("relative:"))throw new Error("relative: exploit attempt");let ms="relative://relative-site";for(let ys=0;ys<100;ys++)ms+=`/${ys}`;const us=new URL(ls,ms);return{isRelativeUrl:us&&us.hostname==="relative-site"&&us.protocol==="relative:",url:us}}function is(ls,ms){if(!ms)return ls;const us=ls.nodes[0];let gs;return ms[us.selector]&&ms["*"]?gs=deepmerge(ms[us.selector],ms["*"]):gs=ms[us.selector]||ms["*"],gs&&(ls.nodes[0].nodes=us.nodes.reduce(ps(gs),[])),ls}function cs(ls){return ls.nodes[0].nodes.reduce(function(ms,us){return ms.push(`${us.prop}:${us.value}${us.important?" !important":""}`),ms},[]).join(";")}function ps(ls){return function(ms,us){return has(ls,us.prop)&&ls[us.prop].some(function(ys){return ys.test(us.value)})&&ms.push(us),ms}}function vs(ls,ms,us){return ms?(ls=ls.split(/\s+/),ls.filter(function(gs){return ms.indexOf(gs)!==-1||us.some(function(ys){return ys.test(gs)})}).join(" ")):ls}}const htmlParserDefaults={decodeEntities:!0};sanitizeHtml.defaults={allowedTags:["address","article","aside","footer","header","h1","h2","h3","h4","h5","h6","hgroup","main","nav","section","blockquote","dd","div","dl","dt","figcaption","figure","hr","li","main","ol","p","pre","ul","a","abbr","b","bdi","bdo","br","cite","code","data","dfn","em","i","kbd","mark","q","rb","rp","rt","rtc","ruby","s","samp","small","span","strong","sub","sup","time","u","var","wbr","caption","col","colgroup","table","tbody","td","tfoot","th","thead","tr"],nonBooleanAttributes:["abbr","accept","accept-charset","accesskey","action","allow","alt","as","autocapitalize","autocomplete","blocking","charset","cite","class","color","cols","colspan","content","contenteditable","coords","crossorigin","data","datetime","decoding","dir","dirname","download","draggable","enctype","enterkeyhint","fetchpriority","for","form","formaction","formenctype","formmethod","formtarget","headers","height","hidden","high","href","hreflang","http-equiv","id","imagesizes","imagesrcset","inputmode","integrity","is","itemid","itemprop","itemref","itemtype","kind","label","lang","list","loading","low","max","maxlength","media","method","min","minlength","name","nonce","optimum","pattern","ping","placeholder","popover","popovertarget","popovertargetaction","poster","preload","referrerpolicy","rel","rows","rowspan","sandbox","scope","shape","size","sizes","slot","span","spellcheck","src","srcdoc","srclang","srcset","start","step","style","tabindex","target","title","translate","type","usemap","value","width","wrap","onauxclick","onafterprint","onbeforematch","onbeforeprint","onbeforeunload","onbeforetoggle","onblur","oncancel","oncanplay","oncanplaythrough","onchange","onclick","onclose","oncontextlost","oncontextmenu","oncontextrestored","oncopy","oncuechange","oncut","ondblclick","ondrag","ondragend","ondragenter","ondragleave","ondragover","ondragstart","ondrop","ondurationchange","onemptied","onended","onerror","onfocus","onformdata","onhashchange","oninput","oninvalid","onkeydown","onkeypress","onkeyup","onlanguagechange","onload","onloadeddata","onloadedmetadata","onloadstart","onmessage","onmessageerror","onmousedown","onmouseenter","onmouseleave","onmousemove","onmouseout","onmouseover","onmouseup","onoffline","ononline","onpagehide","onpageshow","onpaste","onpause","onplay","onplaying","onpopstate","onprogress","onratechange","onreset","onresize","onrejectionhandled","onscroll","onscrollend","onsecuritypolicyviolation","onseeked","onseeking","onselect","onslotchange","onstalled","onstorage","onsubmit","onsuspend","ontimeupdate","ontoggle","onunhandledrejection","onunload","onvolumechange","onwaiting","onwheel"],disallowedTagsMode:"discard",allowedAttributes:{a:["href","name","target"],img:["src","srcset","alt","title","width","height","loading"]},selfClosing:["img","br","hr","area","base","basefont","input","link","meta"],allowedSchemes:["http","https","ftp","mailto","tel"],allowedSchemesByTag:{},allowedSchemesAppliedToAttributes:["href","src","cite"],allowProtocolRelative:!0,enforceHtmlBoundary:!1,parseStyleAttributes:!0};sanitizeHtml.simpleTransform=function(tt,et,rt){return rt=rt===void 0?!0:rt,et=et||{},function(nt,it){let st;if(rt)for(st in et)it[st]=et[st];else it=et;return{tagName:tt,attribs:it}}};const at=getDefaultExportFromCjs$1(sanitizeHtml_1);function getDefaultExportFromCjs(tt){return tt&&tt.__esModule&&Object.prototype.hasOwnProperty.call(tt,"default")?tt.default:tt}var urlToolkit={exports:{}};(function(tt,et){(function(rt){var nt=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,it=/^(?=([^\/?#]*))\1([^]*)$/,st=/(?:\/|^)\.(?=\/)/g,ot=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,lt={buildAbsoluteURL:function(ut,ct,dt){if(dt=dt||{},ut=ut.trim(),ct=ct.trim(),!ct){if(!dt.alwaysNormalize)return ut;var pt=lt.parseURL(ut);if(!pt)throw new Error("Error trying to parse base URL.");return pt.path=lt.normalizePath(pt.path),lt.buildURLFromParts(pt)}var ft=lt.parseURL(ct);if(!ft)throw new Error("Error trying to parse relative URL.");if(ft.scheme)return dt.alwaysNormalize?(ft.path=lt.normalizePath(ft.path),lt.buildURLFromParts(ft)):ct;var gt=lt.parseURL(ut);if(!gt)throw new Error("Error trying to parse base URL.");if(!gt.netLoc&&gt.path&&gt.path[0]!=="/"){var _r=it.exec(gt.path);gt.netLoc=_r[1],gt.path=_r[2]}gt.netLoc&&!gt.path&&(gt.path="/");var Yr={scheme:gt.scheme,netLoc:ft.netLoc,path:null,params:ft.params,query:ft.query,fragment:ft.fragment};if(!ft.netLoc&&(Yr.netLoc=gt.netLoc,ft.path[0]!=="/"))if(!ft.path)Yr.path=gt.path,ft.params||(Yr.params=gt.params,ft.query||(Yr.query=gt.query));else{var mt=gt.path,Kr=mt.substring(0,mt.lastIndexOf("/")+1)+ft.path;Yr.path=lt.normalizePath(Kr)}return Yr.path===null&&(Yr.path=dt.alwaysNormalize?lt.normalizePath(ft.path):ft.path),lt.buildURLFromParts(Yr)},parseURL:function(ut){var ct=nt.exec(ut);return ct?{scheme:ct[1]||"",netLoc:ct[2]||"",path:ct[3]||"",params:ct[4]||"",query:ct[5]||"",fragment:ct[6]||""}:null},normalizePath:function(ut){for(ut=ut.split("").reverse().join("").replace(st,"");ut.length!==(ut=ut.replace(ot,"")).length;);return ut.split("").reverse().join("")},buildURLFromParts:function(ut){return ut.scheme+ut.netLoc+ut.path+ut.params+ut.query+ut.fragment}};tt.exports=lt})()})(urlToolkit);var urlToolkitExports=urlToolkit.exports;function ownKeys(tt,et){var rt=Object.keys(tt);if(Object.getOwnPropertySymbols){var nt=Object.getOwnPropertySymbols(tt);et&&(nt=nt.filter(function(it){return Object.getOwnPropertyDescriptor(tt,it).enumerable})),rt.push.apply(rt,nt)}return rt}function _objectSpread2(tt){for(var et=1;et<arguments.length;et++){var rt=arguments[et]!=null?arguments[et]:{};et%2?ownKeys(Object(rt),!0).forEach(function(nt){_defineProperty(tt,nt,rt[nt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(tt,Object.getOwnPropertyDescriptors(rt)):ownKeys(Object(rt)).forEach(function(nt){Object.defineProperty(tt,nt,Object.getOwnPropertyDescriptor(rt,nt))})}return tt}function _toPrimitive(tt,et){if(typeof tt!="object"||!tt)return tt;var rt=tt[Symbol.toPrimitive];if(rt!==void 0){var nt=rt.call(tt,et||"default");if(typeof nt!="object")return nt;throw new TypeError("@@toPrimitive must return a primitive value.")}return(et==="string"?String:Number)(tt)}function _toPropertyKey(tt){var et=_toPrimitive(tt,"string");return typeof et=="symbol"?et:String(et)}function _defineProperty(tt,et,rt){return et=_toPropertyKey(et),et in tt?Object.defineProperty(tt,et,{value:rt,enumerable:!0,configurable:!0,writable:!0}):tt[et]=rt,tt}function _extends(){return _extends=Object.assign?Object.assign.bind():function(tt){for(var et=1;et<arguments.length;et++){var rt=arguments[et];for(var nt in rt)Object.prototype.hasOwnProperty.call(rt,nt)&&(tt[nt]=rt[nt])}return tt},_extends.apply(this,arguments)}const isFiniteNumber=Number.isFinite||function(tt){return typeof tt=="number"&&isFinite(tt)},isSafeInteger=Number.isSafeInteger||function(tt){return typeof tt=="number"&&Math.abs(tt)<=MAX_SAFE_INTEGER},MAX_SAFE_INTEGER=Number.MAX_SAFE_INTEGER||9007199254740991;let Events=function(tt){return tt.MEDIA_ATTACHING="hlsMediaAttaching",tt.MEDIA_ATTACHED="hlsMediaAttached",tt.MEDIA_DETACHING="hlsMediaDetaching",tt.MEDIA_DETACHED="hlsMediaDetached",tt.BUFFER_RESET="hlsBufferReset",tt.BUFFER_CODECS="hlsBufferCodecs",tt.BUFFER_CREATED="hlsBufferCreated",tt.BUFFER_APPENDING="hlsBufferAppending",tt.BUFFER_APPENDED="hlsBufferAppended",tt.BUFFER_EOS="hlsBufferEos",tt.BUFFER_FLUSHING="hlsBufferFlushing",tt.BUFFER_FLUSHED="hlsBufferFlushed",tt.MANIFEST_LOADING="hlsManifestLoading",tt.MANIFEST_LOADED="hlsManifestLoaded",tt.MANIFEST_PARSED="hlsManifestParsed",tt.LEVEL_SWITCHING="hlsLevelSwitching",tt.LEVEL_SWITCHED="hlsLevelSwitched",tt.LEVEL_LOADING="hlsLevelLoading",tt.LEVEL_LOADED="hlsLevelLoaded",tt.LEVEL_UPDATED="hlsLevelUpdated",tt.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",tt.LEVELS_UPDATED="hlsLevelsUpdated",tt.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",tt.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",tt.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",tt.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",tt.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",tt.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",tt.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",tt.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",tt.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",tt.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",tt.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",tt.CUES_PARSED="hlsCuesParsed",tt.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",tt.INIT_PTS_FOUND="hlsInitPtsFound",tt.FRAG_LOADING="hlsFragLoading",tt.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",tt.FRAG_LOADED="hlsFragLoaded",tt.FRAG_DECRYPTED="hlsFragDecrypted",tt.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",tt.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",tt.FRAG_PARSING_METADATA="hlsFragParsingMetadata",tt.FRAG_PARSED="hlsFragParsed",tt.FRAG_BUFFERED="hlsFragBuffered",tt.FRAG_CHANGED="hlsFragChanged",tt.FPS_DROP="hlsFpsDrop",tt.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",tt.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",tt.ERROR="hlsError",tt.DESTROYING="hlsDestroying",tt.KEY_LOADING="hlsKeyLoading",tt.KEY_LOADED="hlsKeyLoaded",tt.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",tt.BACK_BUFFER_REACHED="hlsBackBufferReached",tt.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",tt}({}),ErrorTypes=function(tt){return tt.NETWORK_ERROR="networkError",tt.MEDIA_ERROR="mediaError",tt.KEY_SYSTEM_ERROR="keySystemError",tt.MUX_ERROR="muxError",tt.OTHER_ERROR="otherError",tt}({}),ErrorDetails=function(tt){return tt.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",tt.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",tt.KEY_SYSTEM_NO_SESSION="keySystemNoSession",tt.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",tt.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",tt.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",tt.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",tt.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",tt.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",tt.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",tt.MANIFEST_LOAD_ERROR="manifestLoadError",tt.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",tt.MANIFEST_PARSING_ERROR="manifestParsingError",tt.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",tt.LEVEL_EMPTY_ERROR="levelEmptyError",tt.LEVEL_LOAD_ERROR="levelLoadError",tt.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",tt.LEVEL_PARSING_ERROR="levelParsingError",tt.LEVEL_SWITCH_ERROR="levelSwitchError",tt.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",tt.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",tt.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",tt.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",tt.FRAG_LOAD_ERROR="fragLoadError",tt.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",tt.FRAG_DECRYPT_ERROR="fragDecryptError",tt.FRAG_PARSING_ERROR="fragParsingError",tt.FRAG_GAP="fragGap",tt.REMUX_ALLOC_ERROR="remuxAllocError",tt.KEY_LOAD_ERROR="keyLoadError",tt.KEY_LOAD_TIMEOUT="keyLoadTimeOut",tt.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",tt.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",tt.BUFFER_APPEND_ERROR="bufferAppendError",tt.BUFFER_APPENDING_ERROR="bufferAppendingError",tt.BUFFER_STALLED_ERROR="bufferStalledError",tt.BUFFER_FULL_ERROR="bufferFullError",tt.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",tt.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",tt.INTERNAL_EXCEPTION="internalException",tt.INTERNAL_ABORTED="aborted",tt.UNKNOWN="unknown",tt}({});const noop=function(){},fakeLogger={trace:noop,debug:noop,log:noop,warn:noop,info:noop,error:noop};let exportedLogger=fakeLogger;function consolePrintFn(tt){const et=self.console[tt];return et?et.bind(self.console,`[${tt}] >`):noop}function exportLoggerFunctions(tt,...et){et.forEach(function(rt){exportedLogger[rt]=tt[rt]?tt[rt].bind(tt):consolePrintFn(rt)})}function enableLogs(tt,et){if(typeof console=="object"&&tt===!0||typeof tt=="object"){exportLoggerFunctions(tt,"debug","log","info","warn","error");try{exportedLogger.log(`Debug logs enabled for "${et}" in hls.js version 1.5.3`)}catch{exportedLogger=fakeLogger}}else exportedLogger=fakeLogger}const logger=exportedLogger,DECIMAL_RESOLUTION_REGEX=/^(\d+)x(\d+)$/,ATTR_LIST_REGEX=/(.+?)=(".*?"|.*?)(?:,|$)/g;class AttrList{constructor(et){typeof et=="string"&&(et=AttrList.parseAttrList(et)),_extends(this,et)}get clientAttrs(){return Object.keys(this).filter(et=>et.substring(0,2)==="X-")}decimalInteger(et){const rt=parseInt(this[et],10);return rt>Number.MAX_SAFE_INTEGER?1/0:rt}hexadecimalInteger(et){if(this[et]){let rt=(this[et]||"0x").slice(2);rt=(rt.length&1?"0":"")+rt;const nt=new Uint8Array(rt.length/2);for(let it=0;it<rt.length/2;it++)nt[it]=parseInt(rt.slice(it*2,it*2+2),16);return nt}else return null}hexadecimalIntegerAsNumber(et){const rt=parseInt(this[et],16);return rt>Number.MAX_SAFE_INTEGER?1/0:rt}decimalFloatingPoint(et){return parseFloat(this[et])}optionalFloat(et,rt){const nt=this[et];return nt?parseFloat(nt):rt}enumeratedString(et){return this[et]}bool(et){return this[et]==="YES"}decimalResolution(et){const rt=DECIMAL_RESOLUTION_REGEX.exec(this[et]);if(rt!==null)return{width:parseInt(rt[1],10),height:parseInt(rt[2],10)}}static parseAttrList(et){let rt;const nt={},it='"';for(ATTR_LIST_REGEX.lastIndex=0;(rt=ATTR_LIST_REGEX.exec(et))!==null;){let st=rt[2];st.indexOf(it)===0&&st.lastIndexOf(it)===st.length-1&&(st=st.slice(1,-1));const ot=rt[1].trim();nt[ot]=st}return nt}}function isDateRangeCueAttribute(tt){return tt!=="ID"&&tt!=="CLASS"&&tt!=="START-DATE"&&tt!=="DURATION"&&tt!=="END-DATE"&&tt!=="END-ON-NEXT"}function isSCTE35Attribute(tt){return tt==="SCTE35-OUT"||tt==="SCTE35-IN"}class DateRange{constructor(et,rt){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,rt){const nt=rt.attr;for(const it in nt)if(Object.prototype.hasOwnProperty.call(et,it)&&et[it]!==nt[it]){logger.warn(`DATERANGE tag attribute: "${it}" does not match for tags with ID: "${et.ID}"`),this._badValueForSameId=it;break}et=_extends(new AttrList({}),nt,et)}if(this.attr=et,this._startDate=new Date(et["START-DATE"]),"END-DATE"in this.attr){const nt=new Date(this.attr["END-DATE"]);isFiniteNumber(nt.getTime())&&(this._endDate=nt)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const et=this.duration;return et!==null?new Date(this._startDate.getTime()+et*1e3):null}get duration(){if("DURATION"in this.attr){const et=this.attr.decimalFloatingPoint("DURATION");if(isFiniteNumber(et))return et}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&isFiniteNumber(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class LoadStats{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var ElementaryStreamTypes={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class BaseSegment{constructor(et){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[ElementaryStreamTypes.AUDIO]:null,[ElementaryStreamTypes.VIDEO]:null,[ElementaryStreamTypes.AUDIOVIDEO]:null},this.baseurl=et}setByteRange(et,rt){const nt=et.split("@",2);let it;nt.length===1?it=(rt==null?void 0:rt.byteRangeEndOffset)||0:it=parseInt(nt[1]),this._byteRange=[it,parseInt(nt[0])+it]}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=urlToolkitExports.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(et){this._url=et}}class Fragment extends BaseSegment{constructor(et,rt){super(rt),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new LoadStats,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=et}get decryptdata(){const{levelkeys:et}=this;if(!et&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const rt=this.levelkeys.identity;if(rt)this._decryptdata=rt.getDecryptData(this.sn);else{const nt=Object.keys(this.levelkeys);if(nt.length===1)return this._decryptdata=this.levelkeys[nt[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null||!isFiniteNumber(this.programDateTime))return null;const et=isFiniteNumber(this.duration)?this.duration:0;return this.programDateTime+et*1e3}get encrypted(){var et;if((et=this._decryptdata)!=null&&et.encrypted)return!0;if(this.levelkeys){const rt=Object.keys(this.levelkeys),nt=rt.length;if(nt>1||nt===1&&this.levelkeys[rt[0]].encrypted)return!0}return!1}setKeyFormat(et){if(this.levelkeys){const rt=this.levelkeys[et];rt&&!this._decryptdata&&(this._decryptdata=rt.getDecryptData(this.sn))}}abortRequests(){var et,rt;(et=this.loader)==null||et.abort(),(rt=this.keyLoader)==null||rt.abort()}setElementaryStreamInfo(et,rt,nt,it,st,ot=!1){const{elementaryStreams:lt}=this,ut=lt[et];if(!ut){lt[et]={startPTS:rt,endPTS:nt,startDTS:it,endDTS:st,partial:ot};return}ut.startPTS=Math.min(ut.startPTS,rt),ut.endPTS=Math.max(ut.endPTS,nt),ut.startDTS=Math.min(ut.startDTS,it),ut.endDTS=Math.max(ut.endDTS,st)}clearElementaryStreamInfo(){const{elementaryStreams:et}=this;et[ElementaryStreamTypes.AUDIO]=null,et[ElementaryStreamTypes.VIDEO]=null,et[ElementaryStreamTypes.AUDIOVIDEO]=null}}class Part extends BaseSegment{constructor(et,rt,nt,it,st){super(nt),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new LoadStats,this.duration=et.decimalFloatingPoint("DURATION"),this.gap=et.bool("GAP"),this.independent=et.bool("INDEPENDENT"),this.relurl=et.enumeratedString("URI"),this.fragment=rt,this.index=it;const ot=et.enumeratedString("BYTERANGE");ot&&this.setByteRange(ot,st),st&&(this.fragOffset=st.fragOffset+st.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:et}=this;return!!(et.audio||et.video||et.audiovideo)}}const DEFAULT_TARGET_DURATION=10;class LevelDetails{constructor(et){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=et}reloaded(et){if(!et){this.advanced=!0,this.updated=!0;return}const rt=this.lastPartSn-et.lastPartSn,nt=this.lastPartIndex-et.lastPartIndex;this.updated=this.endSN!==et.endSN||!!nt||!!rt||!this.live,this.advanced=this.endSN>et.endSN||rt>0||rt===0&&nt>0,this.updated||this.advanced?this.misses=Math.floor(et.misses*.6):this.misses=et.misses+1,this.availabilityDelay=et.availabilityDelay}get hasProgramDateTime(){return this.fragments.length?isFiniteNumber(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||DEFAULT_TARGET_DURATION}get drift(){const et=this.driftEndTime-this.driftStartTime;return et>0?(this.driftEnd-this.driftStart)*1e3/et:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var et;return(et=this.partList)!=null&&et.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var et;return(et=this.fragments)!=null&&et.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var et;return(et=this.partList)!=null&&et.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var et;return(et=this.partList)!=null&&et.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function base64Decode(tt){return Uint8Array.from(atob(tt),et=>et.charCodeAt(0))}function getKeyIdBytes(tt){const et=strToUtf8array(tt).subarray(0,16),rt=new Uint8Array(16);return rt.set(et,16-et.length),rt}function changeEndianness(tt){const et=function(nt,it,st){const ot=nt[it];nt[it]=nt[st],nt[st]=ot};et(tt,0,3),et(tt,1,2),et(tt,4,5),et(tt,6,7)}function convertDataUriToArrayBytes(tt){const et=tt.split(":");let rt=null;if(et[0]==="data"&&et.length===2){const nt=et[1].split(";"),it=nt[nt.length-1].split(",");if(it.length===2){const st=it[0]==="base64",ot=it[1];st?(nt.splice(-1,1),rt=base64Decode(ot)):rt=getKeyIdBytes(ot)}}return rt}function strToUtf8array(tt){return Uint8Array.from(unescape(encodeURIComponent(tt)),et=>et.charCodeAt(0))}const optionalSelf=typeof self<"u"?self:void 0;var KeySystems={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},KeySystemFormats={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function keySystemFormatToKeySystemDomain(tt){switch(tt){case KeySystemFormats.FAIRPLAY:return KeySystems.FAIRPLAY;case KeySystemFormats.PLAYREADY:return KeySystems.PLAYREADY;case KeySystemFormats.WIDEVINE:return KeySystems.WIDEVINE;case KeySystemFormats.CLEARKEY:return KeySystems.CLEARKEY}}var KeySystemIds={WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function keySystemIdToKeySystemDomain(tt){if(tt===KeySystemIds.WIDEVINE)return KeySystems.WIDEVINE}function keySystemDomainToKeySystemFormat(tt){switch(tt){case KeySystems.FAIRPLAY:return KeySystemFormats.FAIRPLAY;case KeySystems.PLAYREADY:return KeySystemFormats.PLAYREADY;case KeySystems.WIDEVINE:return KeySystemFormats.WIDEVINE;case KeySystems.CLEARKEY:return KeySystemFormats.CLEARKEY}}function getKeySystemsForConfig(tt){const{drmSystems:et,widevineLicenseUrl:rt}=tt,nt=et?[KeySystems.FAIRPLAY,KeySystems.WIDEVINE,KeySystems.PLAYREADY,KeySystems.CLEARKEY].filter(it=>!!et[it]):[];return!nt[KeySystems.WIDEVINE]&&rt&&nt.push(KeySystems.WIDEVINE),nt}const requestMediaKeySystemAccess=function(tt){return optionalSelf!=null&&(tt=optionalSelf.navigator)!=null&&tt.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function getSupportedMediaKeySystemConfigurations(tt,et,rt,nt){let it;switch(tt){case KeySystems.FAIRPLAY:it=["cenc","sinf"];break;case KeySystems.WIDEVINE:case KeySystems.PLAYREADY:it=["cenc"];break;case KeySystems.CLEARKEY:it=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${tt}`)}return createMediaKeySystemConfigurations(it,et,rt,nt)}function createMediaKeySystemConfigurations(tt,et,rt,nt){return[{initDataTypes:tt,persistentState:nt.persistentState||"optional",distinctiveIdentifier:nt.distinctiveIdentifier||"optional",sessionTypes:nt.sessionTypes||[nt.sessionType||"temporary"],audioCapabilities:et.map(st=>({contentType:`audio/mp4; codecs="${st}"`,robustness:nt.audioRobustness||"",encryptionScheme:nt.audioEncryptionScheme||null})),videoCapabilities:rt.map(st=>({contentType:`video/mp4; codecs="${st}"`,robustness:nt.videoRobustness||"",encryptionScheme:nt.videoEncryptionScheme||null}))}]}function sliceUint8(tt,et,rt){return Uint8Array.prototype.slice?tt.slice(et,rt):new Uint8Array(Array.prototype.slice.call(tt,et,rt))}const isHeader$2=(tt,et)=>et+10<=tt.length&&tt[et]===73&&tt[et+1]===68&&tt[et+2]===51&&tt[et+3]<255&&tt[et+4]<255&&tt[et+6]<128&&tt[et+7]<128&&tt[et+8]<128&&tt[et+9]<128,isFooter=(tt,et)=>et+10<=tt.length&&tt[et]===51&&tt[et+1]===68&&tt[et+2]===73&&tt[et+3]<255&&tt[et+4]<255&&tt[et+6]<128&&tt[et+7]<128&&tt[et+8]<128&&tt[et+9]<128,getID3Data=(tt,et)=>{const rt=et;let nt=0;for(;isHeader$2(tt,et);){nt+=10;const it=readSize(tt,et+6);nt+=it,isFooter(tt,et+10)&&(nt+=10),et+=nt}if(nt>0)return tt.subarray(rt,rt+nt)},readSize=(tt,et)=>{let rt=0;return rt=(tt[et]&127)<<21,rt|=(tt[et+1]&127)<<14,rt|=(tt[et+2]&127)<<7,rt|=tt[et+3]&127,rt},canParse$2=(tt,et)=>isHeader$2(tt,et)&&readSize(tt,et+6)+10<=tt.length-et,getTimeStamp=tt=>{const et=getID3Frames(tt);for(let rt=0;rt<et.length;rt++){const nt=et[rt];if(isTimeStampFrame(nt))return readTimeStamp(nt)}},isTimeStampFrame=tt=>tt&&tt.key==="PRIV"&&tt.info==="com.apple.streaming.transportStreamTimestamp",getFrameData=tt=>{const et=String.fromCharCode(tt[0],tt[1],tt[2],tt[3]),rt=readSize(tt,4),nt=10;return{type:et,size:rt,data:tt.subarray(nt,nt+rt)}},getID3Frames=tt=>{let et=0;const rt=[];for(;isHeader$2(tt,et);){const nt=readSize(tt,et+6);et+=10;const it=et+nt;for(;et+8<it;){const st=getFrameData(tt.subarray(et)),ot=decodeFrame(st);ot&&rt.push(ot),et+=st.size+10}isFooter(tt,et)&&(et+=10)}return rt},decodeFrame=tt=>tt.type==="PRIV"?decodePrivFrame(tt):tt.type[0]==="W"?decodeURLFrame(tt):decodeTextFrame(tt),decodePrivFrame=tt=>{if(tt.size<2)return;const et=utf8ArrayToStr(tt.data,!0),rt=new Uint8Array(tt.data.subarray(et.length+1));return{key:tt.type,info:et,data:rt.buffer}},decodeTextFrame=tt=>{if(tt.size<2)return;if(tt.type==="TXXX"){let rt=1;const nt=utf8ArrayToStr(tt.data.subarray(rt),!0);rt+=nt.length+1;const it=utf8ArrayToStr(tt.data.subarray(rt));return{key:tt.type,info:nt,data:it}}const et=utf8ArrayToStr(tt.data.subarray(1));return{key:tt.type,data:et}},decodeURLFrame=tt=>{if(tt.type==="WXXX"){if(tt.size<2)return;let rt=1;const nt=utf8ArrayToStr(tt.data.subarray(rt),!0);rt+=nt.length+1;const it=utf8ArrayToStr(tt.data.subarray(rt));return{key:tt.type,info:nt,data:it}}const et=utf8ArrayToStr(tt.data);return{key:tt.type,data:et}},readTimeStamp=tt=>{if(tt.data.byteLength===8){const et=new Uint8Array(tt.data),rt=et[3]&1;let nt=(et[4]<<23)+(et[5]<<15)+(et[6]<<7)+et[7];return nt/=45,rt&&(nt+=4772185884e-2),Math.round(nt)}},utf8ArrayToStr=(tt,et=!1)=>{const rt=getTextDecoder();if(rt){const ct=rt.decode(tt);if(et){const dt=ct.indexOf("\0");return dt!==-1?ct.substring(0,dt):ct}return ct.replace(/\0/g,"")}const nt=tt.length;let it,st,ot,lt="",ut=0;for(;ut<nt;){if(it=tt[ut++],it===0&&et)return lt;if(it===0||it===3)continue;switch(it>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:lt+=String.fromCharCode(it);break;case 12:case 13:st=tt[ut++],lt+=String.fromCharCode((it&31)<<6|st&63);break;case 14:st=tt[ut++],ot=tt[ut++],lt+=String.fromCharCode((it&15)<<12|(st&63)<<6|(ot&63)<<0);break}}return lt};let decoder;function getTextDecoder(){if(!navigator.userAgent.includes("PlayStation 4"))return!decoder&&typeof self.TextDecoder<"u"&&(decoder=new self.TextDecoder("utf-8")),decoder}const Hex={hexDump:function(tt){let et="";for(let rt=0;rt<tt.length;rt++){let nt=tt[rt].toString(16);nt.length<2&&(nt="0"+nt),et+=nt}return et}},UINT32_MAX$1=Math.pow(2,32)-1,push=[].push,RemuxerTrackIdConfig={video:1,audio:2,id3:3,text:4};function bin2str(tt){return String.fromCharCode.apply(null,tt)}function readUint16(tt,et){const rt=tt[et]<<8|tt[et+1];return rt<0?65536+rt:rt}function readUint32(tt,et){const rt=readSint32(tt,et);return rt<0?4294967296+rt:rt}function readSint32(tt,et){return tt[et]<<24|tt[et+1]<<16|tt[et+2]<<8|tt[et+3]}function writeUint32(tt,et,rt){tt[et]=rt>>24,tt[et+1]=rt>>16&255,tt[et+2]=rt>>8&255,tt[et+3]=rt&255}function hasMoofData(tt){const et=tt.byteLength;for(let rt=0;rt<et;){const nt=readUint32(tt,rt);if(nt>8&&tt[rt+4]===109&&tt[rt+5]===111&&tt[rt+6]===111&&tt[rt+7]===102)return!0;rt=nt>1?rt+nt:et}return!1}function findBox(tt,et){const rt=[];if(!et.length)return rt;const nt=tt.byteLength;for(let it=0;it<nt;){const st=readUint32(tt,it),ot=bin2str(tt.subarray(it+4,it+8)),lt=st>1?it+st:nt;if(ot===et[0])if(et.length===1)rt.push(tt.subarray(it+8,lt));else{const ut=findBox(tt.subarray(it+8,lt),et.slice(1));ut.length&&push.apply(rt,ut)}it=lt}return rt}function parseSegmentIndex(tt){const et=[],rt=tt[0];let nt=8;const it=readUint32(tt,nt);nt+=4;const st=0,ot=0;rt===0?nt+=8:nt+=16,nt+=2;let lt=tt.length+ot;const ut=readUint16(tt,nt);nt+=2;for(let ct=0;ct<ut;ct++){let dt=nt;const pt=readUint32(tt,dt);dt+=4;const ft=pt&2147483647;if((pt&2147483648)>>>31===1)return logger.warn("SIDX has hierarchical references (not supported)"),null;const _r=readUint32(tt,dt);dt+=4,et.push({referenceSize:ft,subsegmentDuration:_r,info:{duration:_r/it,start:lt,end:lt+ft-1}}),lt+=ft,dt+=4,nt=dt}return{earliestPresentationTime:st,timescale:it,version:rt,referencesCount:ut,references:et}}function parseInitSegment(tt){const et=[],rt=findBox(tt,["moov","trak"]);for(let it=0;it<rt.length;it++){const st=rt[it],ot=findBox(st,["tkhd"])[0];if(ot){let lt=ot[0];const ut=readUint32(ot,lt===0?12:20),ct=findBox(st,["mdia","mdhd"])[0];if(ct){lt=ct[0];const dt=readUint32(ct,lt===0?12:20),pt=findBox(st,["mdia","hdlr"])[0];if(pt){const ft=bin2str(pt.subarray(8,12)),gt={soun:ElementaryStreamTypes.AUDIO,vide:ElementaryStreamTypes.VIDEO}[ft];if(gt){const _r=findBox(st,["mdia","minf","stbl","stsd"])[0],Yr=parseStsd(_r);et[ut]={timescale:dt,type:gt},et[gt]=_objectSpread2({timescale:dt,id:ut},Yr)}}}}}return findBox(tt,["moov","mvex","trex"]).forEach(it=>{const st=readUint32(it,4),ot=et[st];ot&&(ot.default={duration:readUint32(it,12),flags:readUint32(it,20)})}),et}function parseStsd(tt){const et=tt.subarray(8),rt=et.subarray(86),nt=bin2str(et.subarray(4,8));let it=nt;const st=nt==="enca"||nt==="encv";if(st){const lt=findBox(et,[nt])[0].subarray(nt==="enca"?28:78);findBox(lt,["sinf"]).forEach(ct=>{const dt=findBox(ct,["schm"])[0];if(dt){const pt=bin2str(dt.subarray(4,8));if(pt==="cbcs"||pt==="cenc"){const ft=findBox(ct,["frma"])[0];ft&&(it=bin2str(ft))}}})}switch(it){case"avc1":case"avc2":case"avc3":case"avc4":{const ot=findBox(rt,["avcC"])[0];it+="."+toHex(ot[1])+toHex(ot[2])+toHex(ot[3]);break}case"mp4a":{const ot=findBox(et,[nt])[0],lt=findBox(ot.subarray(28),["esds"])[0];if(lt&&lt.length>12){let ut=4;if(lt[ut++]!==3)break;ut=skipBERInteger(lt,ut),ut+=2;const ct=lt[ut++];if(ct&128&&(ut+=2),ct&64&&(ut+=lt[ut++]),lt[ut++]!==4)break;ut=skipBERInteger(lt,ut);const dt=lt[ut++];if(dt===64)it+="."+toHex(dt);else break;if(ut+=12,lt[ut++]!==5)break;ut=skipBERInteger(lt,ut);const pt=lt[ut++];let ft=(pt&248)>>3;ft===31&&(ft+=1+((pt&7)<<3)+((lt[ut]&224)>>5)),it+="."+ft}break}case"hvc1":case"hev1":{const ot=findBox(rt,["hvcC"])[0],lt=ot[1],ut=["","A","B","C"][lt>>6],ct=lt&31,dt=readUint32(ot,2),pt=(lt&32)>>5?"H":"L",ft=ot[12],gt=ot.subarray(6,12);it+="."+ut+ct,it+="."+dt.toString(16).toUpperCase(),it+="."+pt+ft;let _r="";for(let Yr=gt.length;Yr--;){const mt=gt[Yr];(mt||_r)&&(_r="."+mt.toString(16).toUpperCase()+_r)}it+=_r;break}case"dvh1":case"dvhe":{const ot=findBox(rt,["dvcC"])[0],lt=ot[2]>>1&127,ut=ot[2]<<5&32|ot[3]>>3&31;it+="."+addLeadingZero(lt)+"."+addLeadingZero(ut);break}case"vp09":{const ot=findBox(rt,["vpcC"])[0],lt=ot[4],ut=ot[5],ct=ot[6]>>4&15;it+="."+addLeadingZero(lt)+"."+addLeadingZero(ut)+"."+addLeadingZero(ct);break}case"av01":{const ot=findBox(rt,["av1C"])[0],lt=ot[1]>>>5,ut=ot[1]&31,ct=ot[2]>>>7?"H":"M",dt=(ot[2]&64)>>6,pt=(ot[2]&32)>>5,ft=lt===2&&dt?pt?12:10:dt?10:8,gt=(ot[2]&16)>>4,_r=(ot[2]&8)>>3,Yr=(ot[2]&4)>>2,mt=ot[2]&3;it+="."+lt+"."+addLeadingZero(ut)+ct+"."+addLeadingZero(ft)+"."+gt+"."+_r+Yr+mt+"."+addLeadingZero(1)+"."+addLeadingZero(1)+"."+addLeadingZero(1)+"."+0;break}}return{codec:it,encrypted:st}}function skipBERInteger(tt,et){const rt=et+5;for(;tt[et++]&128&&et<rt;);return et}function toHex(tt){return("0"+tt.toString(16).toUpperCase()).slice(-2)}function addLeadingZero(tt){return(tt<10?"0":"")+tt}function patchEncyptionData(tt,et){if(!tt||!et)return tt;const rt=et.keyId;return rt&&et.isCommonEncryption&&findBox(tt,["moov","trak"]).forEach(it=>{const ot=findBox(it,["mdia","minf","stbl","stsd"])[0].subarray(8);let lt=findBox(ot,["enca"]);const ut=lt.length>0;ut||(lt=findBox(ot,["encv"])),lt.forEach(ct=>{const dt=ut?ct.subarray(28):ct.subarray(78);findBox(dt,["sinf"]).forEach(ft=>{const gt=parseSinf(ft);if(gt){const _r=gt.subarray(8,24);_r.some(Yr=>Yr!==0)||(logger.log(`[eme] Patching keyId in 'enc${ut?"a":"v"}>sinf>>tenc' box: ${Hex.hexDump(_r)} -> ${Hex.hexDump(rt)}`),gt.set(rt,8))}})})}),tt}function parseSinf(tt){const et=findBox(tt,["schm"])[0];if(et){const rt=bin2str(et.subarray(4,8));if(rt==="cbcs"||rt==="cenc")return findBox(tt,["schi","tenc"])[0]}return logger.error("[eme] missing 'schm' box"),null}function getStartDTS(tt,et){return findBox(et,["moof","traf"]).reduce((rt,nt)=>{const it=findBox(nt,["tfdt"])[0],st=it[0],ot=findBox(nt,["tfhd"]).reduce((lt,ut)=>{const ct=readUint32(ut,4),dt=tt[ct];if(dt){let pt=readUint32(it,4);if(st===1){if(pt===UINT32_MAX$1)return logger.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),lt;pt*=UINT32_MAX$1+1,pt+=readUint32(it,8)}const ft=dt.timescale||9e4,gt=pt/ft;if(isFiniteNumber(gt)&&(lt===null||gt<lt))return gt}return lt},null);return ot!==null&&isFiniteNumber(ot)&&(rt===null||ot<rt)?ot:rt},null)}function getDuration(tt,et){let rt=0,nt=0,it=0;const st=findBox(tt,["moof","traf"]);for(let ot=0;ot<st.length;ot++){const lt=st[ot],ut=findBox(lt,["tfhd"])[0],ct=readUint32(ut,4),dt=et[ct];if(!dt)continue;const pt=dt.default,ft=readUint32(ut,0)|(pt==null?void 0:pt.flags);let gt=pt==null?void 0:pt.duration;ft&8&&(ft&2?gt=readUint32(ut,12):gt=readUint32(ut,8));const _r=dt.timescale||9e4,Yr=findBox(lt,["trun"]);for(let mt=0;mt<Yr.length;mt++){if(rt=computeRawDurationFromSamples(Yr[mt]),!rt&&gt){const Kr=readUint32(Yr[mt],4);rt=gt*Kr}dt.type===ElementaryStreamTypes.VIDEO?nt+=rt/_r:dt.type===ElementaryStreamTypes.AUDIO&&(it+=rt/_r)}}if(nt===0&&it===0){let ot=0;const lt=findBox(tt,["sidx"]);for(let ut=0;ut<lt.length;ut++){const ct=parseSegmentIndex(lt[ut]);ct!=null&&ct.references&&(ot+=ct.references.reduce((dt,pt)=>dt+pt.info.duration||0,0))}return ot}return nt||it}function computeRawDurationFromSamples(tt){const et=readUint32(tt,0);let rt=8;et&1&&(rt+=4),et&4&&(rt+=4);let nt=0;const it=readUint32(tt,4);for(let st=0;st<it;st++){if(et&256){const ot=readUint32(tt,rt);nt+=ot,rt+=4}et&512&&(rt+=4),et&1024&&(rt+=4),et&2048&&(rt+=4)}return nt}function offsetStartDTS(tt,et,rt){findBox(et,["moof","traf"]).forEach(nt=>{findBox(nt,["tfhd"]).forEach(it=>{const st=readUint32(it,4),ot=tt[st];if(!ot)return;const lt=ot.timescale||9e4;findBox(nt,["tfdt"]).forEach(ut=>{const ct=ut[0],dt=rt*lt;if(dt){let pt=readUint32(ut,4);if(ct===0)pt-=dt,pt=Math.max(pt,0),writeUint32(ut,4,pt);else{pt*=Math.pow(2,32),pt+=readUint32(ut,8),pt-=dt,pt=Math.max(pt,0);const ft=Math.floor(pt/(UINT32_MAX$1+1)),gt=Math.floor(pt%(UINT32_MAX$1+1));writeUint32(ut,4,ft),writeUint32(ut,8,gt)}}})})})}function segmentValidRange(tt){const et={valid:null,remainder:null},rt=findBox(tt,["moof"]);if(rt.length<2)return et.remainder=tt,et;const nt=rt[rt.length-1];return et.valid=sliceUint8(tt,0,nt.byteOffset-8),et.remainder=sliceUint8(tt,nt.byteOffset-8),et}function appendUint8Array(tt,et){const rt=new Uint8Array(tt.length+et.length);return rt.set(tt),rt.set(et,tt.length),rt}function parseSamples(tt,et){const rt=[],nt=et.samples,it=et.timescale,st=et.id;let ot=!1;return findBox(nt,["moof"]).map(ut=>{const ct=ut.byteOffset-8;findBox(ut,["traf"]).map(pt=>{const ft=findBox(pt,["tfdt"]).map(gt=>{const _r=gt[0];let Yr=readUint32(gt,4);return _r===1&&(Yr*=Math.pow(2,32),Yr+=readUint32(gt,8)),Yr/it})[0];return ft!==void 0&&(tt=ft),findBox(pt,["tfhd"]).map(gt=>{const _r=readUint32(gt,4),Yr=readUint32(gt,0)&16777215,mt=(Yr&1)!==0,Kr=(Yr&2)!==0,Xr=(Yr&8)!==0;let Zr=0;const Qr=(Yr&16)!==0;let _i=0;const ns=(Yr&32)!==0;let rs=8;_r===st&&(mt&&(rs+=8),Kr&&(rs+=4),Xr&&(Zr=readUint32(gt,rs),rs+=4),Qr&&(_i=readUint32(gt,rs),rs+=4),ns&&(rs+=4),et.type==="video"&&(ot=isHEVC(et.codec)),findBox(pt,["trun"]).map(ss=>{const hs=ss[0],os=readUint32(ss,0)&16777215,is=(os&1)!==0;let cs=0;const ps=(os&4)!==0,vs=(os&256)!==0;let ls=0;const ms=(os&512)!==0;let us=0;const gs=(os&1024)!==0,ys=(os&2048)!==0;let Es=0;const Ss=readUint32(ss,4);let Ts=8;is&&(cs=readUint32(ss,Ts),Ts+=4),ps&&(Ts+=4);let Ds=cs+ct;for(let Rs=0;Rs<Ss;Rs++){if(vs?(ls=readUint32(ss,Ts),Ts+=4):ls=Zr,ms?(us=readUint32(ss,Ts),Ts+=4):us=_i,gs&&(Ts+=4),ys&&(hs===0?Es=readUint32(ss,Ts):Es=readSint32(ss,Ts),Ts+=4),et.type===ElementaryStreamTypes.VIDEO){let Is=0;for(;Is<us;){const ks=readUint32(nt,Ds);if(Ds+=4,isSEIMessage(ot,nt[Ds])){const As=nt.subarray(Ds,Ds+ks);parseSEIMessageFromNALu(As,ot?2:1,tt+Es/it,rt)}Ds+=ks,Is+=ks+4}}tt+=ls/it}}))})})}),rt}function isHEVC(tt){if(!tt)return!1;const et=tt.indexOf("."),rt=et<0?tt:tt.substring(0,et);return rt==="hvc1"||rt==="hev1"||rt==="dvh1"||rt==="dvhe"}function isSEIMessage(tt,et){if(tt){const rt=et>>1&63;return rt===39||rt===40}else return(et&31)===6}function parseSEIMessageFromNALu(tt,et,rt,nt){const it=discardEPB(tt);let st=0;st+=et;let ot=0,lt=0,ut=0;for(;st<it.length;){ot=0;do{if(st>=it.length)break;ut=it[st++],ot+=ut}while(ut===255);lt=0;do{if(st>=it.length)break;ut=it[st++],lt+=ut}while(ut===255);const ct=it.length-st;let dt=st;if(lt<ct)st+=lt;else if(lt>ct){logger.error(`Malformed SEI payload. ${lt} is too small, only ${ct} bytes left to parse.`);break}if(ot===4){if(it[dt++]===181){const ft=readUint16(it,dt);if(dt+=2,ft===49){const gt=readUint32(it,dt);if(dt+=4,gt===1195456820){const _r=it[dt++];if(_r===3){const Yr=it[dt++],mt=31&Yr,Kr=64&Yr,Xr=Kr?2+mt*3:0,Zr=new Uint8Array(Xr);if(Kr){Zr[0]=Yr;for(let Qr=1;Qr<Xr;Qr++)Zr[Qr]=it[dt++]}nt.push({type:_r,payloadType:ot,pts:rt,bytes:Zr})}}}}}else if(ot===5&&lt>16){const pt=[];for(let _r=0;_r<16;_r++){const Yr=it[dt++].toString(16);pt.push(Yr.length==1?"0"+Yr:Yr),(_r===3||_r===5||_r===7||_r===9)&&pt.push("-")}const ft=lt-16,gt=new Uint8Array(ft);for(let _r=0;_r<ft;_r++)gt[_r]=it[dt++];nt.push({payloadType:ot,pts:rt,uuid:pt.join(""),userData:utf8ArrayToStr(gt),userDataBytes:gt})}}}function discardEPB(tt){const et=tt.byteLength,rt=[];let nt=1;for(;nt<et-2;)tt[nt]===0&&tt[nt+1]===0&&tt[nt+2]===3?(rt.push(nt+2),nt+=2):nt++;if(rt.length===0)return tt;const it=et-rt.length,st=new Uint8Array(it);let ot=0;for(nt=0;nt<it;ot++,nt++)ot===rt[0]&&(ot++,rt.shift()),st[nt]=tt[ot];return st}function parseEmsg(tt){const et=tt[0];let rt="",nt="",it=0,st=0,ot=0,lt=0,ut=0,ct=0;if(et===0){for(;bin2str(tt.subarray(ct,ct+1))!=="\0";)rt+=bin2str(tt.subarray(ct,ct+1)),ct+=1;for(rt+=bin2str(tt.subarray(ct,ct+1)),ct+=1;bin2str(tt.subarray(ct,ct+1))!=="\0";)nt+=bin2str(tt.subarray(ct,ct+1)),ct+=1;nt+=bin2str(tt.subarray(ct,ct+1)),ct+=1,it=readUint32(tt,12),st=readUint32(tt,16),lt=readUint32(tt,20),ut=readUint32(tt,24),ct=28}else if(et===1){ct+=4,it=readUint32(tt,ct),ct+=4;const pt=readUint32(tt,ct);ct+=4;const ft=readUint32(tt,ct);for(ct+=4,ot=2**32*pt+ft,isSafeInteger(ot)||(ot=Number.MAX_SAFE_INTEGER,logger.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),lt=readUint32(tt,ct),ct+=4,ut=readUint32(tt,ct),ct+=4;bin2str(tt.subarray(ct,ct+1))!=="\0";)rt+=bin2str(tt.subarray(ct,ct+1)),ct+=1;for(rt+=bin2str(tt.subarray(ct,ct+1)),ct+=1;bin2str(tt.subarray(ct,ct+1))!=="\0";)nt+=bin2str(tt.subarray(ct,ct+1)),ct+=1;nt+=bin2str(tt.subarray(ct,ct+1)),ct+=1}const dt=tt.subarray(ct,tt.byteLength);return{schemeIdUri:rt,value:nt,timeScale:it,presentationTime:ot,presentationTimeDelta:st,eventDuration:lt,id:ut,payload:dt}}function mp4Box(tt,...et){const rt=et.length;let nt=8,it=rt;for(;it--;)nt+=et[it].byteLength;const st=new Uint8Array(nt);for(st[0]=nt>>24&255,st[1]=nt>>16&255,st[2]=nt>>8&255,st[3]=nt&255,st.set(tt,4),it=0,nt=8;it<rt;it++)st.set(et[it],nt),nt+=et[it].byteLength;return st}function mp4pssh(tt,et,rt){if(tt.byteLength!==16)throw new RangeError("Invalid system id");let nt,it;if(et){nt=1,it=new Uint8Array(et.length*16);for(let lt=0;lt<et.length;lt++){const ut=et[lt];if(ut.byteLength!==16)throw new RangeError("Invalid key");it.set(ut,lt*16)}}else nt=0,it=new Uint8Array;let st;nt>0?(st=new Uint8Array(4),et.length>0&&new DataView(st.buffer).setUint32(0,et.length,!1)):st=new Uint8Array;const ot=new Uint8Array(4);return rt&&rt.byteLength>0&&new DataView(ot.buffer).setUint32(0,rt.byteLength,!1),mp4Box([112,115,115,104],new Uint8Array([nt,0,0,0]),tt,st,it,ot,rt||new Uint8Array)}function parsePssh(tt){if(!(tt instanceof ArrayBuffer)||tt.byteLength<32)return null;const et={version:0,systemId:"",kids:null,data:null},rt=new DataView(tt),nt=rt.getUint32(0);if(tt.byteLength!==nt&&nt>44||rt.getUint32(4)!==1886614376||(et.version=rt.getUint32(8)>>>24,et.version>1))return null;et.systemId=Hex.hexDump(new Uint8Array(tt,12,16));const st=rt.getUint32(28);if(et.version===0){if(nt-32<st)return null;et.data=new Uint8Array(tt,32,st)}else if(et.version===1){et.kids=[];for(let ot=0;ot<st;ot++)et.kids.push(new Uint8Array(tt,32+ot*16,16))}return et}let keyUriToKeyIdMap={};class LevelKey{static clearKeyUriToKeyIdMap(){keyUriToKeyIdMap={}}constructor(et,rt,nt,it=[1],st=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=et,this.uri=rt,this.keyFormat=nt,this.keyFormatVersions=it,this.iv=st,this.encrypted=et?et!=="NONE":!1,this.isCommonEncryption=this.encrypted&&et!=="AES-128"}isSupported(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case KeySystemFormats.FAIRPLAY:case KeySystemFormats.WIDEVINE:case KeySystemFormats.PLAYREADY:case KeySystemFormats.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(et){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof et!="number"&&(this.method==="AES-128"&&!this.iv&&logger.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),et=0);const nt=createInitializationVector(et);return new LevelKey(this.method,this.uri,"identity",this.keyFormatVersions,nt)}const rt=convertDataUriToArrayBytes(this.uri);if(rt)switch(this.keyFormat){case KeySystemFormats.WIDEVINE:this.pssh=rt,rt.length>=22&&(this.keyId=rt.subarray(rt.length-22,rt.length-6));break;case KeySystemFormats.PLAYREADY:{const nt=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=mp4pssh(nt,null,rt);const it=new Uint16Array(rt.buffer,rt.byteOffset,rt.byteLength/2),st=String.fromCharCode.apply(null,Array.from(it)),ot=st.substring(st.indexOf("<"),st.length),ct=new DOMParser().parseFromString(ot,"text/xml").getElementsByTagName("KID")[0];if(ct){const dt=ct.childNodes[0]?ct.childNodes[0].nodeValue:ct.getAttribute("VALUE");if(dt){const pt=base64Decode(dt).subarray(0,16);changeEndianness(pt),this.keyId=pt}}break}default:{let nt=rt.subarray(0,16);if(nt.length!==16){const it=new Uint8Array(16);it.set(nt,16-nt.length),nt=it}this.keyId=nt;break}}if(!this.keyId||this.keyId.byteLength!==16){let nt=keyUriToKeyIdMap[this.uri];if(!nt){const it=Object.keys(keyUriToKeyIdMap).length%Number.MAX_SAFE_INTEGER;nt=new Uint8Array(16),new DataView(nt.buffer,12,4).setUint32(0,it),keyUriToKeyIdMap[this.uri]=nt}this.keyId=nt}return this}}function createInitializationVector(tt){const et=new Uint8Array(16);for(let rt=12;rt<16;rt++)et[rt]=tt>>8*(15-rt)&255;return et}const VARIABLE_REPLACEMENT_REGEX=/\{\$([a-zA-Z0-9-_]+)\}/g;function hasVariableReferences(tt){return VARIABLE_REPLACEMENT_REGEX.test(tt)}function substituteVariablesInAttributes(tt,et,rt){if(tt.variableList!==null||tt.hasVariableRefs)for(let nt=rt.length;nt--;){const it=rt[nt],st=et[it];st&&(et[it]=substituteVariables(tt,st))}}function substituteVariables(tt,et){if(tt.variableList!==null||tt.hasVariableRefs){const rt=tt.variableList;return et.replace(VARIABLE_REPLACEMENT_REGEX,nt=>{const it=nt.substring(2,nt.length-1),st=rt==null?void 0:rt[it];return st===void 0?(tt.playlistParsingError||(tt.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${it}"`)),nt):st})}return et}function addVariableDefinition(tt,et,rt){let nt=tt.variableList;nt||(tt.variableList=nt={});let it,st;if("QUERYPARAM"in et){it=et.QUERYPARAM;try{const ot=new self.URL(rt).searchParams;if(ot.has(it))st=ot.get(it);else throw new Error(`"${it}" does not match any query parameter in URI: "${rt}"`)}catch(ot){tt.playlistParsingError||(tt.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${ot.message}`))}}else it=et.NAME,st=et.VALUE;it in nt?tt.playlistParsingError||(tt.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${it}"`)):nt[it]=st||""}function importVariableDefinition(tt,et,rt){const nt=et.IMPORT;if(rt&&nt in rt){let it=tt.variableList;it||(tt.variableList=it={}),it[nt]=rt[nt]}else tt.playlistParsingError||(tt.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${nt}"`))}function getMediaSource(tt=!0){return typeof self>"u"?void 0:(tt||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}const sampleEntryCodesISO={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function isCodecType(tt,et){const rt=sampleEntryCodesISO[et];return!!rt&&!!rt[tt.slice(0,4)]}function areCodecsMediaSourceSupported(tt,et,rt=!0){return!tt.split(",").some(nt=>!isCodecMediaSourceSupported(nt,et,rt))}function isCodecMediaSourceSupported(tt,et,rt=!0){var nt;const it=getMediaSource(rt);return(nt=it==null?void 0:it.isTypeSupported(mimeTypeForCodec(tt,et)))!=null?nt:!1}function mimeTypeForCodec(tt,et){return`${et}/mp4;codecs="${tt}"`}function videoCodecPreferenceValue(tt){if(tt){const et=tt.substring(0,4);return sampleEntryCodesISO.video[et]}return 2}function codecsSetSelectionPreferenceValue(tt){return tt.split(",").reduce((et,rt)=>{const nt=sampleEntryCodesISO.video[rt];return nt?(nt*2+et)/(et?3:2):(sampleEntryCodesISO.audio[rt]+et)/(et?2:1)},0)}const CODEC_COMPATIBLE_NAMES={};function getCodecCompatibleNameLower(tt,et=!0){if(CODEC_COMPATIBLE_NAMES[tt])return CODEC_COMPATIBLE_NAMES[tt];const rt={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"]}[tt];for(let nt=0;nt<rt.length;nt++)if(isCodecMediaSourceSupported(rt[nt],"audio",et))return CODEC_COMPATIBLE_NAMES[tt]=rt[nt],rt[nt];return tt}const AUDIO_CODEC_REGEXP=/flac|opus/i;function getCodecCompatibleName(tt,et=!0){return tt.replace(AUDIO_CODEC_REGEXP,rt=>getCodecCompatibleNameLower(rt.toLowerCase(),et))}function pickMostCompleteCodecName(tt,et){return tt&&tt!=="mp4a"?tt:et}function convertAVC1ToAVCOTI(tt){const et=tt.split(".");if(et.length>2){let rt=et.shift()+".";return rt+=parseInt(et.shift()).toString(16),rt+=("000"+parseInt(et.shift()).toString(16)).slice(-4),rt}return tt}const MASTER_PLAYLIST_REGEX=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,MASTER_PLAYLIST_MEDIA_REGEX=/#EXT-X-MEDIA:(.*)/g,IS_MEDIA_PLAYLIST=/^#EXT(?:INF|-X-TARGETDURATION):/m,LEVEL_PLAYLIST_REGEX_FAST=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),LEVEL_PLAYLIST_REGEX_SLOW=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class M3U8Parser{static findGroup(et,rt){for(let nt=0;nt<et.length;nt++){const it=et[nt];if(it.id===rt)return it}}static resolve(et,rt){return urlToolkitExports.buildAbsoluteURL(rt,et,{alwaysNormalize:!0})}static isMediaPlaylist(et){return IS_MEDIA_PLAYLIST.test(et)}static parseMasterPlaylist(et,rt){const nt=hasVariableReferences(et),it={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:nt},st=[];MASTER_PLAYLIST_REGEX.lastIndex=0;let ot;for(;(ot=MASTER_PLAYLIST_REGEX.exec(et))!=null;)if(ot[1]){var lt;const ct=new AttrList(ot[1]);substituteVariablesInAttributes(it,ct,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const dt=substituteVariables(it,ot[2]),pt={attrs:ct,bitrate:ct.decimalInteger("BANDWIDTH")||ct.decimalInteger("AVERAGE-BANDWIDTH"),name:ct.NAME,url:M3U8Parser.resolve(dt,rt)},ft=ct.decimalResolution("RESOLUTION");ft&&(pt.width=ft.width,pt.height=ft.height),setCodecs(ct.CODECS,pt),(lt=pt.unknownCodecs)!=null&&lt.length||st.push(pt),it.levels.push(pt)}else if(ot[3]){const ct=ot[3],dt=ot[4];switch(ct){case"SESSION-DATA":{const pt=new AttrList(dt);substituteVariablesInAttributes(it,pt,["DATA-ID","LANGUAGE","VALUE","URI"]);const ft=pt["DATA-ID"];ft&&(it.sessionData===null&&(it.sessionData={}),it.sessionData[ft]=pt);break}case"SESSION-KEY":{const pt=parseKey(dt,rt,it);pt.encrypted&&pt.isSupported()?(it.sessionKeys===null&&(it.sessionKeys=[]),it.sessionKeys.push(pt)):logger.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${dt}"`);break}case"DEFINE":{{const pt=new AttrList(dt);substituteVariablesInAttributes(it,pt,["NAME","VALUE","QUERYPARAM"]),addVariableDefinition(it,pt,rt)}break}case"CONTENT-STEERING":{const pt=new AttrList(dt);substituteVariablesInAttributes(it,pt,["SERVER-URI","PATHWAY-ID"]),it.contentSteering={uri:M3U8Parser.resolve(pt["SERVER-URI"],rt),pathwayId:pt["PATHWAY-ID"]||"."};break}case"START":{it.startTimeOffset=parseStartTimeOffset(dt);break}}}const ut=st.length>0&&st.length<it.levels.length;return it.levels=ut?st:it.levels,it.levels.length===0&&(it.playlistParsingError=new Error("no levels found in manifest")),it}static parseMasterPlaylistMedia(et,rt,nt){let it;const st={},ot=nt.levels,lt={AUDIO:ot.map(ct=>({id:ct.attrs.AUDIO,audioCodec:ct.audioCodec})),SUBTITLES:ot.map(ct=>({id:ct.attrs.SUBTITLES,textCodec:ct.textCodec})),"CLOSED-CAPTIONS":[]};let ut=0;for(MASTER_PLAYLIST_MEDIA_REGEX.lastIndex=0;(it=MASTER_PLAYLIST_MEDIA_REGEX.exec(et))!==null;){const ct=new AttrList(it[1]),dt=ct.TYPE;if(dt){const pt=lt[dt],ft=st[dt]||[];st[dt]=ft,substituteVariablesInAttributes(nt,ct,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const gt=ct.LANGUAGE,_r=ct["ASSOC-LANGUAGE"],Yr=ct.CHANNELS,mt=ct.CHARACTERISTICS,Kr=ct["INSTREAM-ID"],Xr={attrs:ct,bitrate:0,id:ut++,groupId:ct["GROUP-ID"]||"",name:ct.NAME||gt||"",type:dt,default:ct.bool("DEFAULT"),autoselect:ct.bool("AUTOSELECT"),forced:ct.bool("FORCED"),lang:gt,url:ct.URI?M3U8Parser.resolve(ct.URI,rt):""};if(_r&&(Xr.assocLang=_r),Yr&&(Xr.channels=Yr),mt&&(Xr.characteristics=mt),Kr&&(Xr.instreamId=Kr),pt!=null&&pt.length){const Zr=M3U8Parser.findGroup(pt,Xr.groupId)||pt[0];assignCodec(Xr,Zr,"audioCodec"),assignCodec(Xr,Zr,"textCodec")}ft.push(Xr)}}return st}static parseLevelPlaylist(et,rt,nt,it,st,ot){const lt=new LevelDetails(rt),ut=lt.fragments;let ct=null,dt=0,pt=0,ft=0,gt=0,_r=null,Yr=new Fragment(it,rt),mt,Kr,Xr,Zr=-1,Qr=!1,_i=null;for(LEVEL_PLAYLIST_REGEX_FAST.lastIndex=0,lt.m3u8=et,lt.hasVariableRefs=hasVariableReferences(et);(mt=LEVEL_PLAYLIST_REGEX_FAST.exec(et))!==null;){Qr&&(Qr=!1,Yr=new Fragment(it,rt),Yr.start=ft,Yr.sn=dt,Yr.cc=gt,Yr.level=nt,ct&&(Yr.initSegment=ct,Yr.rawProgramDateTime=ct.rawProgramDateTime,ct.rawProgramDateTime=null,_i&&(Yr.setByteRange(_i),_i=null)));const hs=mt[1];if(hs){Yr.duration=parseFloat(hs);const os=(" "+mt[2]).slice(1);Yr.title=os||null,Yr.tagList.push(os?["INF",hs,os]:["INF",hs])}else if(mt[3]){if(isFiniteNumber(Yr.duration)){Yr.start=ft,Xr&&setFragLevelKeys(Yr,Xr,lt),Yr.sn=dt,Yr.level=nt,Yr.cc=gt,ut.push(Yr);const os=(" "+mt[3]).slice(1);Yr.relurl=substituteVariables(lt,os),assignProgramDateTime(Yr,_r),_r=Yr,ft+=Yr.duration,dt++,pt=0,Qr=!0}}else if(mt[4]){const os=(" "+mt[4]).slice(1);_r?Yr.setByteRange(os,_r):Yr.setByteRange(os)}else if(mt[5])Yr.rawProgramDateTime=(" "+mt[5]).slice(1),Yr.tagList.push(["PROGRAM-DATE-TIME",Yr.rawProgramDateTime]),Zr===-1&&(Zr=ut.length);else{if(mt=mt[0].match(LEVEL_PLAYLIST_REGEX_SLOW),!mt){logger.warn("No matches on slow regex match for level playlist!");continue}for(Kr=1;Kr<mt.length&&!(typeof mt[Kr]<"u");Kr++);const os=(" "+mt[Kr]).slice(1),is=(" "+mt[Kr+1]).slice(1),cs=mt[Kr+2]?(" "+mt[Kr+2]).slice(1):"";switch(os){case"PLAYLIST-TYPE":lt.type=is.toUpperCase();break;case"MEDIA-SEQUENCE":dt=lt.startSN=parseInt(is);break;case"SKIP":{const ps=new AttrList(is);substituteVariablesInAttributes(lt,ps,["RECENTLY-REMOVED-DATERANGES"]);const vs=ps.decimalInteger("SKIPPED-SEGMENTS");if(isFiniteNumber(vs)){lt.skippedSegments=vs;for(let ms=vs;ms--;)ut.unshift(null);dt+=vs}const ls=ps.enumeratedString("RECENTLY-REMOVED-DATERANGES");ls&&(lt.recentlyRemovedDateranges=ls.split("	"));break}case"TARGETDURATION":lt.targetduration=Math.max(parseInt(is),1);break;case"VERSION":lt.version=parseInt(is);break;case"INDEPENDENT-SEGMENTS":case"EXTM3U":break;case"ENDLIST":lt.live=!1;break;case"#":(is||cs)&&Yr.tagList.push(cs?[is,cs]:[is]);break;case"DISCONTINUITY":gt++,Yr.tagList.push(["DIS"]);break;case"GAP":Yr.gap=!0,Yr.tagList.push([os]);break;case"BITRATE":Yr.tagList.push([os,is]);break;case"DATERANGE":{const ps=new AttrList(is);substituteVariablesInAttributes(lt,ps,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),substituteVariablesInAttributes(lt,ps,ps.clientAttrs);const vs=new DateRange(ps,lt.dateRanges[ps.ID]);vs.isValid||lt.skippedSegments?lt.dateRanges[vs.id]=vs:logger.warn(`Ignoring invalid DATERANGE tag: "${is}"`),Yr.tagList.push(["EXT-X-DATERANGE",is]);break}case"DEFINE":{{const ps=new AttrList(is);substituteVariablesInAttributes(lt,ps,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in ps?importVariableDefinition(lt,ps,ot):addVariableDefinition(lt,ps,rt)}break}case"DISCONTINUITY-SEQUENCE":gt=parseInt(is);break;case"KEY":{const ps=parseKey(is,rt,lt);if(ps.isSupported()){if(ps.method==="NONE"){Xr=void 0;break}Xr||(Xr={}),Xr[ps.keyFormat]&&(Xr=_extends({},Xr)),Xr[ps.keyFormat]=ps}else logger.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${is}"`);break}case"START":lt.startTimeOffset=parseStartTimeOffset(is);break;case"MAP":{const ps=new AttrList(is);if(substituteVariablesInAttributes(lt,ps,["BYTERANGE","URI"]),Yr.duration){const vs=new Fragment(it,rt);setInitSegment(vs,ps,nt,Xr),ct=vs,Yr.initSegment=ct,ct.rawProgramDateTime&&!Yr.rawProgramDateTime&&(Yr.rawProgramDateTime=ct.rawProgramDateTime)}else{const vs=Yr.byteRangeEndOffset;if(vs){const ls=Yr.byteRangeStartOffset;_i=`${vs-ls}@${ls}`}else _i=null;setInitSegment(Yr,ps,nt,Xr),ct=Yr,Qr=!0}break}case"SERVER-CONTROL":{const ps=new AttrList(is);lt.canBlockReload=ps.bool("CAN-BLOCK-RELOAD"),lt.canSkipUntil=ps.optionalFloat("CAN-SKIP-UNTIL",0),lt.canSkipDateRanges=lt.canSkipUntil>0&&ps.bool("CAN-SKIP-DATERANGES"),lt.partHoldBack=ps.optionalFloat("PART-HOLD-BACK",0),lt.holdBack=ps.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const ps=new AttrList(is);lt.partTarget=ps.decimalFloatingPoint("PART-TARGET");break}case"PART":{let ps=lt.partList;ps||(ps=lt.partList=[]);const vs=pt>0?ps[ps.length-1]:void 0,ls=pt++,ms=new AttrList(is);substituteVariablesInAttributes(lt,ms,["BYTERANGE","URI"]);const us=new Part(ms,Yr,rt,ls,vs);ps.push(us),Yr.duration+=us.duration;break}case"PRELOAD-HINT":{const ps=new AttrList(is);substituteVariablesInAttributes(lt,ps,["URI"]),lt.preloadHint=ps;break}case"RENDITION-REPORT":{const ps=new AttrList(is);substituteVariablesInAttributes(lt,ps,["URI"]),lt.renditionReports=lt.renditionReports||[],lt.renditionReports.push(ps);break}default:logger.warn(`line parsed but not handled: ${mt}`);break}}}_r&&!_r.relurl?(ut.pop(),ft-=_r.duration,lt.partList&&(lt.fragmentHint=_r)):lt.partList&&(assignProgramDateTime(Yr,_r),Yr.cc=gt,lt.fragmentHint=Yr,Xr&&setFragLevelKeys(Yr,Xr,lt));const ns=ut.length,rs=ut[0],ss=ut[ns-1];if(ft+=lt.skippedSegments*lt.targetduration,ft>0&&ns&&ss){lt.averagetargetduration=ft/ns;const hs=ss.sn;lt.endSN=hs!=="initSegment"?hs:0,lt.live||(ss.endList=!0),rs&&(lt.startCC=rs.cc)}else lt.endSN=0,lt.startCC=0;return lt.fragmentHint&&(ft+=lt.fragmentHint.duration),lt.totalduration=ft,lt.endCC=gt,Zr>0&&backfillProgramDateTimes(ut,Zr),lt}}function parseKey(tt,et,rt){var nt,it;const st=new AttrList(tt);substituteVariablesInAttributes(rt,st,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const ot=(nt=st.METHOD)!=null?nt:"",lt=st.URI,ut=st.hexadecimalInteger("IV"),ct=st.KEYFORMATVERSIONS,dt=(it=st.KEYFORMAT)!=null?it:"identity";lt&&st.IV&&!ut&&logger.error(`Invalid IV: ${st.IV}`);const pt=lt?M3U8Parser.resolve(lt,et):"",ft=(ct||"1").split("/").map(Number).filter(Number.isFinite);return new LevelKey(ot,pt,dt,ft,ut)}function parseStartTimeOffset(tt){const rt=new AttrList(tt).decimalFloatingPoint("TIME-OFFSET");return isFiniteNumber(rt)?rt:null}function setCodecs(tt,et){let rt=(tt||"").split(/[ ,]+/).filter(nt=>nt);["video","audio","text"].forEach(nt=>{const it=rt.filter(st=>isCodecType(st,nt));it.length&&(et[`${nt}Codec`]=it.join(","),rt=rt.filter(st=>it.indexOf(st)===-1))}),et.unknownCodecs=rt}function assignCodec(tt,et,rt){const nt=et[rt];nt&&(tt[rt]=nt)}function backfillProgramDateTimes(tt,et){let rt=tt[et];for(let nt=et;nt--;){const it=tt[nt];if(!it)return;it.programDateTime=rt.programDateTime-it.duration*1e3,rt=it}}function assignProgramDateTime(tt,et){tt.rawProgramDateTime?tt.programDateTime=Date.parse(tt.rawProgramDateTime):et!=null&&et.programDateTime&&(tt.programDateTime=et.endProgramDateTime),isFiniteNumber(tt.programDateTime)||(tt.programDateTime=null,tt.rawProgramDateTime=null)}function setInitSegment(tt,et,rt,nt){tt.relurl=et.URI,et.BYTERANGE&&tt.setByteRange(et.BYTERANGE),tt.level=rt,tt.sn="initSegment",nt&&(tt.levelkeys=nt),tt.initSegment=null}function setFragLevelKeys(tt,et,rt){tt.levelkeys=et;const{encryptedFragments:nt}=rt;(!nt.length||nt[nt.length-1].levelkeys!==et)&&Object.keys(et).some(it=>et[it].isCommonEncryption)&&nt.push(tt)}var PlaylistContextType={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},PlaylistLevelType={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function mapContextToLevelType(tt){const{type:et}=tt;switch(et){case PlaylistContextType.AUDIO_TRACK:return PlaylistLevelType.AUDIO;case PlaylistContextType.SUBTITLE_TRACK:return PlaylistLevelType.SUBTITLE;default:return PlaylistLevelType.MAIN}}function getResponseUrl(tt,et){let rt=tt.url;return(rt===void 0||rt.indexOf("data:")===0)&&(rt=et.url),rt}class PlaylistLoader{constructor(et){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=et,this.registerListeners()}startLoad(et){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:et}=this;et.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.on(Events.LEVEL_LOADING,this.onLevelLoading,this),et.on(Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),et.on(Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:et}=this;et.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.off(Events.LEVEL_LOADING,this.onLevelLoading,this),et.off(Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),et.off(Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(et){const rt=this.hls.config,nt=rt.pLoader,it=rt.loader,st=nt||it,ot=new st(rt);return this.loaders[et.type]=ot,ot}getInternalLoader(et){return this.loaders[et.type]}resetInternalLoader(et){this.loaders[et]&&delete this.loaders[et]}destroyInternalLoaders(){for(const et in this.loaders){const rt=this.loaders[et];rt&&rt.destroy(),this.resetInternalLoader(et)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(et,rt){const{url:nt}=rt;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:PlaylistContextType.MANIFEST,url:nt,deliveryDirectives:null})}onLevelLoading(et,rt){const{id:nt,level:it,pathwayId:st,url:ot,deliveryDirectives:lt}=rt;this.load({id:nt,level:it,pathwayId:st,responseType:"text",type:PlaylistContextType.LEVEL,url:ot,deliveryDirectives:lt})}onAudioTrackLoading(et,rt){const{id:nt,groupId:it,url:st,deliveryDirectives:ot}=rt;this.load({id:nt,groupId:it,level:null,responseType:"text",type:PlaylistContextType.AUDIO_TRACK,url:st,deliveryDirectives:ot})}onSubtitleTrackLoading(et,rt){const{id:nt,groupId:it,url:st,deliveryDirectives:ot}=rt;this.load({id:nt,groupId:it,level:null,responseType:"text",type:PlaylistContextType.SUBTITLE_TRACK,url:st,deliveryDirectives:ot})}load(et){var rt;const nt=this.hls.config;let it=this.getInternalLoader(et);if(it){const ct=it.context;if(ct&&ct.url===et.url&&ct.level===et.level){logger.trace("[playlist-loader]: playlist request ongoing");return}logger.log(`[playlist-loader]: aborting previous loader for type: ${et.type}`),it.abort()}let st;if(et.type===PlaylistContextType.MANIFEST?st=nt.manifestLoadPolicy.default:st=_extends({},nt.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),it=this.createInternalLoader(et),isFiniteNumber((rt=et.deliveryDirectives)==null?void 0:rt.part)){let ct;if(et.type===PlaylistContextType.LEVEL&&et.level!==null?ct=this.hls.levels[et.level].details:et.type===PlaylistContextType.AUDIO_TRACK&&et.id!==null?ct=this.hls.audioTracks[et.id].details:et.type===PlaylistContextType.SUBTITLE_TRACK&&et.id!==null&&(ct=this.hls.subtitleTracks[et.id].details),ct){const dt=ct.partTarget,pt=ct.targetduration;if(dt&&pt){const ft=Math.max(dt*3,pt*.8)*1e3;st=_extends({},st,{maxTimeToFirstByteMs:Math.min(ft,st.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(ft,st.maxTimeToFirstByteMs)})}}}const ot=st.errorRetry||st.timeoutRetry||{},lt={loadPolicy:st,timeout:st.maxLoadTimeMs,maxRetry:ot.maxNumRetry||0,retryDelay:ot.retryDelayMs||0,maxRetryDelay:ot.maxRetryDelayMs||0},ut={onSuccess:(ct,dt,pt,ft)=>{const gt=this.getInternalLoader(pt);this.resetInternalLoader(pt.type);const _r=ct.data;if(_r.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(ct,pt,new Error("no EXTM3U delimiter"),ft||null,dt);return}dt.parsing.start=performance.now(),M3U8Parser.isMediaPlaylist(_r)?this.handleTrackOrLevelPlaylist(ct,dt,pt,ft||null,gt):this.handleMasterPlaylist(ct,dt,pt,ft)},onError:(ct,dt,pt,ft)=>{this.handleNetworkError(dt,pt,!1,ct,ft)},onTimeout:(ct,dt,pt)=>{this.handleNetworkError(dt,pt,!0,void 0,ct)}};it.load(et,lt,ut)}handleMasterPlaylist(et,rt,nt,it){const st=this.hls,ot=et.data,lt=getResponseUrl(et,nt),ut=M3U8Parser.parseMasterPlaylist(ot,lt);if(ut.playlistParsingError){this.handleManifestParsingError(et,nt,ut.playlistParsingError,it,rt);return}const{contentSteering:ct,levels:dt,sessionData:pt,sessionKeys:ft,startTimeOffset:gt,variableList:_r}=ut;this.variableList=_r;const{AUDIO:Yr=[],SUBTITLES:mt,"CLOSED-CAPTIONS":Kr}=M3U8Parser.parseMasterPlaylistMedia(ot,lt,ut);Yr.length&&!Yr.some(Zr=>!Zr.url)&&dt[0].audioCodec&&!dt[0].attrs.AUDIO&&(logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),Yr.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new AttrList({}),bitrate:0,url:""})),st.trigger(Events.MANIFEST_LOADED,{levels:dt,audioTracks:Yr,subtitles:mt,captions:Kr,contentSteering:ct,url:lt,stats:rt,networkDetails:it,sessionData:pt,sessionKeys:ft,startTimeOffset:gt,variableList:_r})}handleTrackOrLevelPlaylist(et,rt,nt,it,st){const ot=this.hls,{id:lt,level:ut,type:ct}=nt,dt=getResponseUrl(et,nt),pt=0,ft=isFiniteNumber(ut)?ut:isFiniteNumber(lt)?lt:0,gt=mapContextToLevelType(nt),_r=M3U8Parser.parseLevelPlaylist(et.data,dt,ft,gt,pt,this.variableList);if(ct===PlaylistContextType.MANIFEST){const Yr={attrs:new AttrList({}),bitrate:0,details:_r,name:"",url:dt};ot.trigger(Events.MANIFEST_LOADED,{levels:[Yr],audioTracks:[],url:dt,stats:rt,networkDetails:it,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}rt.parsing.end=performance.now(),nt.levelDetails=_r,this.handlePlaylistLoaded(_r,et,rt,nt,it,st)}handleManifestParsingError(et,rt,nt,it,st){this.hls.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.MANIFEST_PARSING_ERROR,fatal:rt.type===PlaylistContextType.MANIFEST,url:et.url,err:nt,error:nt,reason:nt.message,response:et,context:rt,networkDetails:it,stats:st})}handleNetworkError(et,rt,nt=!1,it,st){let ot=`A network ${nt?"timeout":"error"+(it?" (status "+it.code+")":"")} occurred while loading ${et.type}`;et.type===PlaylistContextType.LEVEL?ot+=`: ${et.level} id: ${et.id}`:(et.type===PlaylistContextType.AUDIO_TRACK||et.type===PlaylistContextType.SUBTITLE_TRACK)&&(ot+=` id: ${et.id} group-id: "${et.groupId}"`);const lt=new Error(ot);logger.warn(`[playlist-loader]: ${ot}`);let ut=ErrorDetails.UNKNOWN,ct=!1;const dt=this.getInternalLoader(et);switch(et.type){case PlaylistContextType.MANIFEST:ut=nt?ErrorDetails.MANIFEST_LOAD_TIMEOUT:ErrorDetails.MANIFEST_LOAD_ERROR,ct=!0;break;case PlaylistContextType.LEVEL:ut=nt?ErrorDetails.LEVEL_LOAD_TIMEOUT:ErrorDetails.LEVEL_LOAD_ERROR,ct=!1;break;case PlaylistContextType.AUDIO_TRACK:ut=nt?ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:ErrorDetails.AUDIO_TRACK_LOAD_ERROR,ct=!1;break;case PlaylistContextType.SUBTITLE_TRACK:ut=nt?ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:ErrorDetails.SUBTITLE_LOAD_ERROR,ct=!1;break}dt&&this.resetInternalLoader(et.type);const pt={type:ErrorTypes.NETWORK_ERROR,details:ut,fatal:ct,url:et.url,loader:dt,context:et,error:lt,networkDetails:rt,stats:st};if(it){const ft=(rt==null?void 0:rt.url)||et.url;pt.response=_objectSpread2({url:ft,data:void 0},it)}this.hls.trigger(Events.ERROR,pt)}handlePlaylistLoaded(et,rt,nt,it,st,ot){const lt=this.hls,{type:ut,level:ct,id:dt,groupId:pt,deliveryDirectives:ft}=it,gt=getResponseUrl(rt,it),_r=mapContextToLevelType(it),Yr=typeof it.level=="number"&&_r===PlaylistLevelType.MAIN?ct:void 0;if(!et.fragments.length){const Kr=new Error("No Segments found in Playlist");lt.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:gt,error:Kr,reason:Kr.message,response:rt,context:it,level:Yr,parent:_r,networkDetails:st,stats:nt});return}et.targetduration||(et.playlistParsingError=new Error("Missing Target Duration"));const mt=et.playlistParsingError;if(mt){lt.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.LEVEL_PARSING_ERROR,fatal:!1,url:gt,error:mt,reason:mt.message,response:rt,context:it,level:Yr,parent:_r,networkDetails:st,stats:nt});return}switch(et.live&&ot&&(ot.getCacheAge&&(et.ageHeader=ot.getCacheAge()||0),(!ot.getCacheAge||isNaN(et.ageHeader))&&(et.ageHeader=0)),ut){case PlaylistContextType.MANIFEST:case PlaylistContextType.LEVEL:lt.trigger(Events.LEVEL_LOADED,{details:et,level:Yr||0,id:dt||0,stats:nt,networkDetails:st,deliveryDirectives:ft});break;case PlaylistContextType.AUDIO_TRACK:lt.trigger(Events.AUDIO_TRACK_LOADED,{details:et,id:dt||0,groupId:pt||"",stats:nt,networkDetails:st,deliveryDirectives:ft});break;case PlaylistContextType.SUBTITLE_TRACK:lt.trigger(Events.SUBTITLE_TRACK_LOADED,{details:et,id:dt||0,groupId:pt||"",stats:nt,networkDetails:st,deliveryDirectives:ft});break}}}function sendAddTrackEvent(tt,et){let rt;try{rt=new Event("addtrack")}catch{rt=document.createEvent("Event"),rt.initEvent("addtrack",!1,!1)}rt.track=tt,et.dispatchEvent(rt)}function addCueToTrack(tt,et){const rt=tt.mode;if(rt==="disabled"&&(tt.mode="hidden"),tt.cues&&!tt.cues.getCueById(et.id))try{if(tt.addCue(et),!tt.cues.getCueById(et.id))throw new Error(`addCue is failed for: ${et}`)}catch(nt){logger.debug(`[texttrack-utils]: ${nt}`);try{const it=new self.TextTrackCue(et.startTime,et.endTime,et.text);it.id=et.id,tt.addCue(it)}catch(it){logger.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${it}`)}}rt==="disabled"&&(tt.mode=rt)}function clearCurrentCues(tt){const et=tt.mode;if(et==="disabled"&&(tt.mode="hidden"),tt.cues)for(let rt=tt.cues.length;rt--;)tt.removeCue(tt.cues[rt]);et==="disabled"&&(tt.mode=et)}function removeCuesInRange(tt,et,rt,nt){const it=tt.mode;if(it==="disabled"&&(tt.mode="hidden"),tt.cues&&tt.cues.length>0){const st=getCuesInRange(tt.cues,et,rt);for(let ot=0;ot<st.length;ot++)(!nt||nt(st[ot]))&&tt.removeCue(st[ot])}it==="disabled"&&(tt.mode=it)}function getFirstCueIndexAfterTime(tt,et){if(et<tt[0].startTime)return 0;const rt=tt.length-1;if(et>tt[rt].endTime)return-1;let nt=0,it=rt;for(;nt<=it;){const st=Math.floor((it+nt)/2);if(et<tt[st].startTime)it=st-1;else if(et>tt[st].startTime&&nt<rt)nt=st+1;else return st}return tt[nt].startTime-et<et-tt[it].startTime?nt:it}function getCuesInRange(tt,et,rt){const nt=[],it=getFirstCueIndexAfterTime(tt,et);if(it>-1)for(let st=it,ot=tt.length;st<ot;st++){const lt=tt[st];if(lt.startTime>=et&&lt.endTime<=rt)nt.push(lt);else if(lt.startTime>rt)return nt}return nt}function filterSubtitleTracks(tt){const et=[];for(let rt=0;rt<tt.length;rt++){const nt=tt[rt];(nt.kind==="subtitles"||nt.kind==="captions")&&nt.label&&et.push(tt[rt])}return et}var MetadataSchema={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"};const MIN_CUE_DURATION=.25;function getCueClass(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function createCueWithDataFields(tt,et,rt,nt,it){let st=new tt(et,rt,"");try{st.value=nt,it&&(st.type=it)}catch{st=new tt(et,rt,JSON.stringify(it?_objectSpread2({type:it},nt):nt))}return st}const MAX_CUE_ENDTIME=(()=>{const tt=getCueClass();try{tt&&new tt(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function dateRangeDateToTimelineSeconds(tt,et){return tt.getTime()/1e3-et}function hexToArrayBuffer(tt){return Uint8Array.from(tt.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class ID3TrackController{constructor(et){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=et,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:et}=this;et.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),et.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),et.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.on(Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),et.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),et.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:et}=this;et.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),et.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),et.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.off(Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),et.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),et.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(et,rt){this.media=rt.media}onMediaDetaching(){this.id3Track&&(clearCurrentCues(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(et){const rt=this.getID3Track(et.textTracks);return rt.mode="hidden",rt}getID3Track(et){if(this.media){for(let rt=0;rt<et.length;rt++){const nt=et[rt];if(nt.kind==="metadata"&&nt.label==="id3")return sendAddTrackEvent(nt,this.media),nt}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(et,rt){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:nt,enableID3MetadataCues:it}}}=this;if(!nt&&!it)return;const{samples:st}=rt;this.id3Track||(this.id3Track=this.createTrack(this.media));const ot=getCueClass();if(ot)for(let lt=0;lt<st.length;lt++){const ut=st[lt].type;if(ut===MetadataSchema.emsg&&!nt||!it)continue;const ct=getID3Frames(st[lt].data);if(ct){const dt=st[lt].pts;let pt=dt+st[lt].duration;pt>MAX_CUE_ENDTIME&&(pt=MAX_CUE_ENDTIME),pt-dt<=0&&(pt=dt+MIN_CUE_DURATION);for(let gt=0;gt<ct.length;gt++){const _r=ct[gt];if(!isTimeStampFrame(_r)){this.updateId3CueEnds(dt,ut);const Yr=createCueWithDataFields(ot,dt,pt,_r,ut);Yr&&this.id3Track.addCue(Yr)}}}}}updateId3CueEnds(et,rt){var nt;const it=(nt=this.id3Track)==null?void 0:nt.cues;if(it)for(let st=it.length;st--;){const ot=it[st];ot.type===rt&&ot.startTime<et&&ot.endTime===MAX_CUE_ENDTIME&&(ot.endTime=et)}}onBufferFlushing(et,{startOffset:rt,endOffset:nt,type:it}){const{id3Track:st,hls:ot}=this;if(!ot)return;const{config:{enableEmsgMetadataCues:lt,enableID3MetadataCues:ut}}=ot;if(st&&(lt||ut)){let ct;it==="audio"?ct=dt=>dt.type===MetadataSchema.audioId3&&ut:it==="video"?ct=dt=>dt.type===MetadataSchema.emsg&&lt:ct=dt=>dt.type===MetadataSchema.audioId3&&ut||dt.type===MetadataSchema.emsg&&lt,removeCuesInRange(st,rt,nt,ct)}}onLevelUpdated(et,{details:rt}){if(!this.media||!rt.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:nt,id3Track:it}=this,{dateRanges:st}=rt,ot=Object.keys(st);if(it){const dt=Object.keys(nt).filter(pt=>!ot.includes(pt));for(let pt=dt.length;pt--;){const ft=dt[pt];Object.keys(nt[ft].cues).forEach(gt=>{it.removeCue(nt[ft].cues[gt])}),delete nt[ft]}}const lt=rt.fragments[rt.fragments.length-1];if(ot.length===0||!isFiniteNumber(lt==null?void 0:lt.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const ut=lt.programDateTime/1e3-lt.start,ct=getCueClass();for(let dt=0;dt<ot.length;dt++){const pt=ot[dt],ft=st[pt],gt=dateRangeDateToTimelineSeconds(ft.startDate,ut),_r=nt[pt],Yr=(_r==null?void 0:_r.cues)||{};let mt=(_r==null?void 0:_r.durationKnown)||!1,Kr=MAX_CUE_ENDTIME;const Xr=ft.endDate;if(Xr)Kr=dateRangeDateToTimelineSeconds(Xr,ut),mt=!0;else if(ft.endOnNext&&!mt){const Qr=ot.reduce((_i,ns)=>{if(ns!==ft.id){const rs=st[ns];if(rs.class===ft.class&&rs.startDate>ft.startDate&&(!_i||ft.startDate<_i.startDate))return rs}return _i},null);Qr&&(Kr=dateRangeDateToTimelineSeconds(Qr.startDate,ut),mt=!0)}const Zr=Object.keys(ft.attr);for(let Qr=0;Qr<Zr.length;Qr++){const _i=Zr[Qr];if(!isDateRangeCueAttribute(_i))continue;const ns=Yr[_i];if(ns)mt&&!_r.durationKnown&&(ns.endTime=Kr);else if(ct){let rs=ft.attr[_i];isSCTE35Attribute(_i)&&(rs=hexToArrayBuffer(rs));const ss=createCueWithDataFields(ct,gt,Kr,{key:_i,data:rs},MetadataSchema.dateRange);ss&&(ss.id=pt,this.id3Track.addCue(ss),Yr[_i]=ss)}}nt[pt]={cues:Yr,dateRange:ft,durationKnown:mt}}}}class LatencyController{constructor(et){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=et,this.config=et.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:et,levelDetails:rt}=this;return et.liveMaxLatencyDuration!==void 0?et.liveMaxLatencyDuration:rt?et.liveMaxLatencyDurationCount*rt.targetduration:0}get targetLatency(){const{levelDetails:et}=this;if(et===null)return null;const{holdBack:rt,partHoldBack:nt,targetduration:it}=et,{liveSyncDuration:st,liveSyncDurationCount:ot,lowLatencyMode:lt}=this.config,ut=this.hls.userConfig;let ct=lt&&nt||rt;(ut.liveSyncDuration||ut.liveSyncDurationCount||ct===0)&&(ct=st!==void 0?st:ot*it);const dt=it;return ct+Math.min(this.stallCount*1,dt)}get liveSyncPosition(){const et=this.estimateLiveEdge(),rt=this.targetLatency,nt=this.levelDetails;if(et===null||rt===null||nt===null)return null;const it=nt.edge,st=et-rt-this.edgeStalled,ot=it-nt.totalduration,lt=it-(this.config.lowLatencyMode&&nt.partTarget||nt.targetduration);return Math.min(Math.max(ot,st),lt)}get drift(){const{levelDetails:et}=this;return et===null?1:et.drift}get edgeStalled(){const{levelDetails:et}=this;if(et===null)return 0;const rt=(this.config.lowLatencyMode&&et.partTarget||et.targetduration)*3;return Math.max(et.age-rt,0)}get forwardBufferLength(){const{media:et,levelDetails:rt}=this;if(!et||!rt)return 0;const nt=et.buffered.length;return(nt?et.buffered.end(nt-1):rt.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(Events.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(Events.ERROR,this.onError,this)}onMediaAttached(et,rt){this.media=rt.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(et,{details:rt}){this.levelDetails=rt,rt.advanced&&this.timeupdate(),!rt.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(et,rt){var nt;rt.details===ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,(nt=this.levelDetails)!=null&&nt.live&&logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:et,levelDetails:rt}=this;if(!et||!rt)return;this.currentTime=et.currentTime;const nt=this.computeLatency();if(nt===null)return;this._latency=nt;const{lowLatencyMode:it,maxLiveSyncPlaybackRate:st}=this.config;if(!it||st===1||!rt.live)return;const ot=this.targetLatency;if(ot===null)return;const lt=nt-ot,ut=Math.min(this.maxLatency,ot+rt.targetduration);if(lt<ut&&lt>.05&&this.forwardBufferLength>1){const dt=Math.min(2,Math.max(1,st)),pt=Math.round(2/(1+Math.exp(-.75*lt-this.edgeStalled))*20)/20;et.playbackRate=Math.min(dt,Math.max(1,pt))}else et.playbackRate!==1&&et.playbackRate!==0&&(et.playbackRate=1)}estimateLiveEdge(){const{levelDetails:et}=this;return et===null?null:et.edge+et.age}computeLatency(){const et=this.estimateLiveEdge();return et===null?null:et-this.currentTime}}const HdcpLevels=["NONE","TYPE-0","TYPE-1",null];function isHdcpLevel(tt){return HdcpLevels.indexOf(tt)>-1}const VideoRangeValues=["SDR","PQ","HLG"];function isVideoRange(tt){return!!tt&&VideoRangeValues.indexOf(tt)>-1}var HlsSkip={No:"",Yes:"YES",v2:"v2"};function getSkipValue(tt,et){const{canSkipUntil:rt,canSkipDateRanges:nt,endSN:it}=tt,st=et!==void 0?et-it:0;return rt&&st<rt?nt?HlsSkip.v2:HlsSkip.Yes:HlsSkip.No}class HlsUrlParameters{constructor(et,rt,nt){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=et,this.part=rt,this.skip=nt}addDirectives(et){const rt=new self.URL(et);return this.msn!==void 0&&rt.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&rt.searchParams.set("_HLS_part",this.part.toString()),this.skip&&rt.searchParams.set("_HLS_skip",this.skip),rt.href}}class Level{constructor(et){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[et.url],this._attrs=[et.attrs],this.bitrate=et.bitrate,et.details&&(this.details=et.details),this.id=et.id||0,this.name=et.name,this.width=et.width||0,this.height=et.height||0,this.frameRate=et.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=et.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=et.audioCodec,this.videoCodec=et.videoCodec,this.codecSet=[et.videoCodec,et.audioCodec].filter(rt=>!!rt).map(rt=>rt.substring(0,4)).join(","),this.addGroupId("audio",et.attrs.AUDIO),this.addGroupId("text",et.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(et){return hasGroup(this._audioGroups,et)}hasSubtitleGroup(et){return hasGroup(this._subtitleGroups,et)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(et,rt){if(rt){if(et==="audio"){let nt=this._audioGroups;nt||(nt=this._audioGroups=[]),nt.indexOf(rt)===-1&&nt.push(rt)}else if(et==="text"){let nt=this._subtitleGroups;nt||(nt=this._subtitleGroups=[]),nt.indexOf(rt)===-1&&nt.push(rt)}}}get urlId(){return 0}set urlId(et){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var et;return(et=this.audioGroups)==null?void 0:et[0]}get textGroupId(){var et;return(et=this.subtitleGroups)==null?void 0:et[0]}addFallback(){}}function hasGroup(tt,et){return!et||!tt?!1:tt.indexOf(et)!==-1}function updateFromToPTS(tt,et){const rt=et.startPTS;if(isFiniteNumber(rt)){let nt=0,it;et.sn>tt.sn?(nt=rt-tt.start,it=tt):(nt=tt.start-rt,it=et),it.duration!==nt&&(it.duration=nt)}else et.sn>tt.sn?tt.cc===et.cc&&tt.minEndPTS?et.start=tt.start+(tt.minEndPTS-tt.start):et.start=tt.start+tt.duration:et.start=Math.max(tt.start-et.duration,0)}function updateFragPTSDTS(tt,et,rt,nt,it,st){nt-rt<=0&&(logger.warn("Fragment should have a positive duration",et),nt=rt+et.duration,st=it+et.duration);let lt=rt,ut=nt;const ct=et.startPTS,dt=et.endPTS;if(isFiniteNumber(ct)){const mt=Math.abs(ct-rt);isFiniteNumber(et.deltaPTS)?et.deltaPTS=Math.max(mt,et.deltaPTS):et.deltaPTS=mt,lt=Math.max(rt,ct),rt=Math.min(rt,ct),it=Math.min(it,et.startDTS),ut=Math.min(nt,dt),nt=Math.max(nt,dt),st=Math.max(st,et.endDTS)}const pt=rt-et.start;et.start!==0&&(et.start=rt),et.duration=nt-et.start,et.startPTS=rt,et.maxStartPTS=lt,et.startDTS=it,et.endPTS=nt,et.minEndPTS=ut,et.endDTS=st;const ft=et.sn;if(!tt||ft<tt.startSN||ft>tt.endSN)return 0;let gt;const _r=ft-tt.startSN,Yr=tt.fragments;for(Yr[_r]=et,gt=_r;gt>0;gt--)updateFromToPTS(Yr[gt],Yr[gt-1]);for(gt=_r;gt<Yr.length-1;gt++)updateFromToPTS(Yr[gt],Yr[gt+1]);return tt.fragmentHint&&updateFromToPTS(Yr[Yr.length-1],tt.fragmentHint),tt.PTSKnown=tt.alignedSliding=!0,pt}function mergeDetails(tt,et){let rt=null;const nt=tt.fragments;for(let ut=nt.length-1;ut>=0;ut--){const ct=nt[ut].initSegment;if(ct){rt=ct;break}}tt.fragmentHint&&delete tt.fragmentHint.endPTS;let it=0,st;if(mapFragmentIntersection(tt,et,(ut,ct)=>{ut.relurl&&(it=ut.cc-ct.cc),isFiniteNumber(ut.startPTS)&&isFiniteNumber(ut.endPTS)&&(ct.start=ct.startPTS=ut.startPTS,ct.startDTS=ut.startDTS,ct.maxStartPTS=ut.maxStartPTS,ct.endPTS=ut.endPTS,ct.endDTS=ut.endDTS,ct.minEndPTS=ut.minEndPTS,ct.duration=ut.endPTS-ut.startPTS,ct.duration&&(st=ct),et.PTSKnown=et.alignedSliding=!0),ct.elementaryStreams=ut.elementaryStreams,ct.loader=ut.loader,ct.stats=ut.stats,ut.initSegment&&(ct.initSegment=ut.initSegment,rt=ut.initSegment)}),rt&&(et.fragmentHint?et.fragments.concat(et.fragmentHint):et.fragments).forEach(ct=>{var dt;ct&&(!ct.initSegment||ct.initSegment.relurl===((dt=rt)==null?void 0:dt.relurl))&&(ct.initSegment=rt)}),et.skippedSegments)if(et.deltaUpdateFailed=et.fragments.some(ut=>!ut),et.deltaUpdateFailed){logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let ut=et.skippedSegments;ut--;)et.fragments.shift();et.startSN=et.fragments[0].sn,et.startCC=et.fragments[0].cc}else et.canSkipDateRanges&&(et.dateRanges=mergeDateRanges(tt.dateRanges,et.dateRanges,et.recentlyRemovedDateranges));const ot=et.fragments;if(it){logger.warn("discontinuity sliding from playlist, take drift into account");for(let ut=0;ut<ot.length;ut++)ot[ut].cc+=it}et.skippedSegments&&(et.startCC=et.fragments[0].cc),mapPartIntersection(tt.partList,et.partList,(ut,ct)=>{ct.elementaryStreams=ut.elementaryStreams,ct.stats=ut.stats}),st?updateFragPTSDTS(et,st,st.startPTS,st.endPTS,st.startDTS,st.endDTS):adjustSliding(tt,et),ot.length&&(et.totalduration=et.edge-ot[0].start),et.driftStartTime=tt.driftStartTime,et.driftStart=tt.driftStart;const lt=et.advancedDateTime;if(et.advanced&&lt){const ut=et.edge;et.driftStart||(et.driftStartTime=lt,et.driftStart=ut),et.driftEndTime=lt,et.driftEnd=ut}else et.driftEndTime=tt.driftEndTime,et.driftEnd=tt.driftEnd,et.advancedDateTime=tt.advancedDateTime}function mergeDateRanges(tt,et,rt){const nt=_extends({},tt);return rt&&rt.forEach(it=>{delete nt[it]}),Object.keys(et).forEach(it=>{const st=new DateRange(et[it].attr,nt[it]);st.isValid?nt[it]=st:logger.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(et[it].attr)}"`)}),nt}function mapPartIntersection(tt,et,rt){if(tt&&et){let nt=0;for(let it=0,st=tt.length;it<=st;it++){const ot=tt[it],lt=et[it+nt];ot&&lt&&ot.index===lt.index&&ot.fragment.sn===lt.fragment.sn?rt(ot,lt):nt--}}}function mapFragmentIntersection(tt,et,rt){const nt=et.skippedSegments,it=Math.max(tt.startSN,et.startSN)-et.startSN,st=(tt.fragmentHint?1:0)+(nt?et.endSN:Math.min(tt.endSN,et.endSN))-et.startSN,ot=et.startSN-tt.startSN,lt=et.fragmentHint?et.fragments.concat(et.fragmentHint):et.fragments,ut=tt.fragmentHint?tt.fragments.concat(tt.fragmentHint):tt.fragments;for(let ct=it;ct<=st;ct++){const dt=ut[ot+ct];let pt=lt[ct];nt&&!pt&&ct<nt&&(pt=et.fragments[ct]=dt),dt&&pt&&rt(dt,pt)}}function adjustSliding(tt,et){const rt=et.startSN+et.skippedSegments-tt.startSN,nt=tt.fragments;rt<0||rt>=nt.length||addSliding(et,nt[rt].start)}function addSliding(tt,et){if(et){const rt=tt.fragments;for(let nt=tt.skippedSegments;nt<rt.length;nt++)rt[nt].start+=et;tt.fragmentHint&&(tt.fragmentHint.start+=et)}}function computeReloadInterval(tt,et=1/0){let rt=1e3*tt.targetduration;if(tt.updated){const nt=tt.fragments;if(nt.length&&rt*4>et){const st=nt[nt.length-1].duration*1e3;st<rt&&(rt=st)}}else rt/=2;return Math.round(rt)}function getFragmentWithSN(tt,et,rt){if(!(tt!=null&&tt.details))return null;const nt=tt.details;let it=nt.fragments[et-nt.startSN];return it||(it=nt.fragmentHint,it&&it.sn===et)?it:et<nt.startSN&&rt&&rt.sn===et?rt:null}function getPartWith(tt,et,rt){var nt;return tt!=null&&tt.details?findPart((nt=tt.details)==null?void 0:nt.partList,et,rt):null}function findPart(tt,et,rt){if(tt)for(let nt=tt.length;nt--;){const it=tt[nt];if(it.index===rt&&it.fragment.sn===et)return it}return null}function reassignFragmentLevelIndexes(tt){tt.forEach((et,rt)=>{const{details:nt}=et;nt!=null&&nt.fragments&&nt.fragments.forEach(it=>{it.level=rt})})}function isTimeoutError(tt){switch(tt.details){case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_TIMEOUT:case ErrorDetails.LEVEL_LOAD_TIMEOUT:case ErrorDetails.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function getRetryConfig(tt,et){const rt=isTimeoutError(et);return tt.default[`${rt?"timeout":"error"}Retry`]}function getRetryDelay(tt,et){const rt=tt.backoff==="linear"?1:Math.pow(2,et);return Math.min(rt*tt.retryDelayMs,tt.maxRetryDelayMs)}function getLoaderConfigWithoutReties(tt){return _objectSpread2(_objectSpread2({},tt),{errorRetry:null,timeoutRetry:null})}function shouldRetry(tt,et,rt,nt){if(!tt)return!1;const it=nt==null?void 0:nt.code,st=et<tt.maxNumRetry&&(retryForHttpStatus(it)||!!rt);return tt.shouldRetry?tt.shouldRetry(tt,et,rt,nt,st):st}function retryForHttpStatus(tt){return tt===0&&navigator.onLine===!1||!!tt&&(tt<400||tt>499)}const BinarySearch={search:function(tt,et){let rt=0,nt=tt.length-1,it=null,st=null;for(;rt<=nt;){it=(rt+nt)/2|0,st=tt[it];const ot=et(st);if(ot>0)rt=it+1;else if(ot<0)nt=it-1;else return st}return null}};function findFragmentByPDT(tt,et,rt){if(et===null||!Array.isArray(tt)||!tt.length||!isFiniteNumber(et))return null;const nt=tt[0].programDateTime;if(et<(nt||0))return null;const it=tt[tt.length-1].endProgramDateTime;if(et>=(it||0))return null;rt=rt||0;for(let st=0;st<tt.length;++st){const ot=tt[st];if(pdtWithinToleranceTest(et,rt,ot))return ot}return null}function findFragmentByPTS(tt,et,rt=0,nt=0){let it=null;if(tt){it=et[tt.sn-et[0].sn+1]||null;const ot=tt.endDTS-rt;ot>0&&ot<15e-7&&(rt+=15e-7)}else rt===0&&et[0].start===0&&(it=et[0]);if(it&&(!tt||tt.level===it.level)&&fragmentWithinToleranceTest(rt,nt,it)===0)return it;const st=BinarySearch.search(et,fragmentWithinToleranceTest.bind(null,rt,nt));return st&&(st!==tt||!it)?st:it}function fragmentWithinToleranceTest(tt=0,et=0,rt){if(rt.start<=tt&&rt.start+rt.duration>tt)return 0;const nt=Math.min(et,rt.duration+(rt.deltaPTS?rt.deltaPTS:0));return rt.start+rt.duration-nt<=tt?1:rt.start-nt>tt&&rt.start?-1:0}function pdtWithinToleranceTest(tt,et,rt){const nt=Math.min(et,rt.duration+(rt.deltaPTS?rt.deltaPTS:0))*1e3;return(rt.endProgramDateTime||0)-nt>tt}function findFragWithCC(tt,et){return BinarySearch.search(tt,rt=>rt.cc<et?1:rt.cc>et?-1:0)}var NetworkErrorAction={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},ErrorActionFlags={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class ErrorController{constructor(et){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=et,this.log=logger.log.bind(logger,"[info]:"),this.warn=logger.warn.bind(logger,"[warning]:"),this.error=logger.error.bind(logger,"[error]:"),this.registerListeners()}registerListeners(){const et=this.hls;et.on(Events.ERROR,this.onError,this),et.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const et=this.hls;et&&(et.off(Events.ERROR,this.onError,this),et.off(Events.ERROR,this.onErrorOut,this),et.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(et){}stopLoad(){this.playlistError=0}getVariantLevelIndex(et){return(et==null?void 0:et.type)===PlaylistLevelType.MAIN?et.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(et,rt){var nt,it;if(rt.fatal)return;const st=this.hls,ot=rt.context;switch(rt.details){case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:rt.errorAction=this.getFragRetryOrSwitchAction(rt);return;case ErrorDetails.FRAG_PARSING_ERROR:if((nt=rt.frag)!=null&&nt.gap){rt.errorAction={action:NetworkErrorAction.DoNothing,flags:ErrorActionFlags.None};return}case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_DECRYPT_ERROR:{rt.errorAction=this.getFragRetryOrSwitchAction(rt),rt.errorAction.action=NetworkErrorAction.SendAlternateToPenaltyBox;return}case ErrorDetails.LEVEL_EMPTY_ERROR:case ErrorDetails.LEVEL_PARSING_ERROR:{var lt,ut;const ct=rt.parent===PlaylistLevelType.MAIN?rt.level:st.loadLevel;rt.details===ErrorDetails.LEVEL_EMPTY_ERROR&&((lt=rt.context)!=null&&(ut=lt.levelDetails)!=null&&ut.live)?rt.errorAction=this.getPlaylistRetryOrSwitchAction(rt,ct):(rt.levelRetry=!1,rt.errorAction=this.getLevelSwitchAction(rt,ct))}return;case ErrorDetails.LEVEL_LOAD_ERROR:case ErrorDetails.LEVEL_LOAD_TIMEOUT:typeof(ot==null?void 0:ot.level)=="number"&&(rt.errorAction=this.getPlaylistRetryOrSwitchAction(rt,ot.level));return;case ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case ErrorDetails.SUBTITLE_LOAD_ERROR:case ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:if(ot){const ct=st.levels[st.loadLevel];if(ct&&(ot.type===PlaylistContextType.AUDIO_TRACK&&ct.hasAudioGroup(ot.groupId)||ot.type===PlaylistContextType.SUBTITLE_TRACK&&ct.hasSubtitleGroup(ot.groupId))){rt.errorAction=this.getPlaylistRetryOrSwitchAction(rt,st.loadLevel),rt.errorAction.action=NetworkErrorAction.SendAlternateToPenaltyBox,rt.errorAction.flags=ErrorActionFlags.MoveAllAlternatesMatchingHost;return}}return;case ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const ct=st.levels[st.loadLevel],dt=ct==null?void 0:ct.attrs["HDCP-LEVEL"];dt?rt.errorAction={action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.MoveAllAlternatesMatchingHDCP,hdcpLevel:dt}:this.keySystemError(rt)}return;case ErrorDetails.BUFFER_ADD_CODEC_ERROR:case ErrorDetails.REMUX_ALLOC_ERROR:case ErrorDetails.BUFFER_APPEND_ERROR:rt.errorAction=this.getLevelSwitchAction(rt,(it=rt.level)!=null?it:st.loadLevel);return;case ErrorDetails.INTERNAL_EXCEPTION:case ErrorDetails.BUFFER_APPENDING_ERROR:case ErrorDetails.BUFFER_FULL_ERROR:case ErrorDetails.LEVEL_SWITCH_ERROR:case ErrorDetails.BUFFER_STALLED_ERROR:case ErrorDetails.BUFFER_SEEK_OVER_HOLE:case ErrorDetails.BUFFER_NUDGE_ON_STALL:rt.errorAction={action:NetworkErrorAction.DoNothing,flags:ErrorActionFlags.None};return}rt.type===ErrorTypes.KEY_SYSTEM_ERROR&&this.keySystemError(rt)}keySystemError(et){const rt=this.getVariantLevelIndex(et.frag);et.levelRetry=!1,et.errorAction=this.getLevelSwitchAction(et,rt)}getPlaylistRetryOrSwitchAction(et,rt){const nt=this.hls,it=getRetryConfig(nt.config.playlistLoadPolicy,et),st=this.playlistError++;if(shouldRetry(it,st,isTimeoutError(et),et.response))return{action:NetworkErrorAction.RetryRequest,flags:ErrorActionFlags.None,retryConfig:it,retryCount:st};const lt=this.getLevelSwitchAction(et,rt);return it&&(lt.retryConfig=it,lt.retryCount=st),lt}getFragRetryOrSwitchAction(et){const rt=this.hls,nt=this.getVariantLevelIndex(et.frag),it=rt.levels[nt],{fragLoadPolicy:st,keyLoadPolicy:ot}=rt.config,lt=getRetryConfig(et.details.startsWith("key")?ot:st,et),ut=rt.levels.reduce((dt,pt)=>dt+pt.fragmentError,0);if(it&&(et.details!==ErrorDetails.FRAG_GAP&&it.fragmentError++,shouldRetry(lt,ut,isTimeoutError(et),et.response)))return{action:NetworkErrorAction.RetryRequest,flags:ErrorActionFlags.None,retryConfig:lt,retryCount:ut};const ct=this.getLevelSwitchAction(et,nt);return lt&&(ct.retryConfig=lt,ct.retryCount=ut),ct}getLevelSwitchAction(et,rt){const nt=this.hls;rt==null&&(rt=nt.loadLevel);const it=this.hls.levels[rt];if(it){var st,ot;const ct=et.details;it.loadError++,ct===ErrorDetails.BUFFER_APPEND_ERROR&&it.fragmentError++;let dt=-1;const{levels:pt,loadLevel:ft,minAutoLevel:gt,maxAutoLevel:_r}=nt;nt.autoLevelEnabled||(nt.loadLevel=-1);const Yr=(st=et.frag)==null?void 0:st.type,Kr=(Yr===PlaylistLevelType.AUDIO&&ct===ErrorDetails.FRAG_PARSING_ERROR||et.sourceBufferName==="audio"&&(ct===ErrorDetails.BUFFER_ADD_CODEC_ERROR||ct===ErrorDetails.BUFFER_APPEND_ERROR))&&pt.some(({audioCodec:ns})=>it.audioCodec!==ns),Zr=et.sourceBufferName==="video"&&(ct===ErrorDetails.BUFFER_ADD_CODEC_ERROR||ct===ErrorDetails.BUFFER_APPEND_ERROR)&&pt.some(({codecSet:ns,audioCodec:rs})=>it.codecSet!==ns&&it.audioCodec===rs),{type:Qr,groupId:_i}=(ot=et.context)!=null?ot:{};for(let ns=pt.length;ns--;){const rs=(ns+ft)%pt.length;if(rs!==ft&&rs>=gt&&rs<=_r&&pt[rs].loadError===0){var lt,ut;const ss=pt[rs];if(ct===ErrorDetails.FRAG_GAP&&et.frag){const hs=pt[rs].details;if(hs){const os=findFragmentByPTS(et.frag,hs.fragments,et.frag.start);if(os!=null&&os.gap)continue}}else{if(Qr===PlaylistContextType.AUDIO_TRACK&&ss.hasAudioGroup(_i)||Qr===PlaylistContextType.SUBTITLE_TRACK&&ss.hasSubtitleGroup(_i))continue;if(Yr===PlaylistLevelType.AUDIO&&(lt=it.audioGroups)!=null&&lt.some(hs=>ss.hasAudioGroup(hs))||Yr===PlaylistLevelType.SUBTITLE&&(ut=it.subtitleGroups)!=null&&ut.some(hs=>ss.hasSubtitleGroup(hs))||Kr&&it.audioCodec===ss.audioCodec||!Kr&&it.audioCodec!==ss.audioCodec||Zr&&it.codecSet===ss.codecSet)continue}dt=rs;break}}if(dt>-1&&nt.loadLevel!==dt)return et.levelRetry=!0,this.playlistError=0,{action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.None,nextAutoLevel:dt}}return{action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.MoveAllAlternatesMatchingHost}}onErrorOut(et,rt){var nt;switch((nt=rt.errorAction)==null?void 0:nt.action){case NetworkErrorAction.DoNothing:break;case NetworkErrorAction.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(rt),!rt.errorAction.resolved&&rt.details!==ErrorDetails.FRAG_GAP?rt.fatal=!0:/MediaSource readyState: ended/.test(rt.error.message)&&(this.warn(`MediaSource ended after "${rt.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(rt.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(et){const rt=this.hls,nt=et.errorAction;if(!nt)return;const{flags:it,hdcpLevel:st,nextAutoLevel:ot}=nt;switch(it){case ErrorActionFlags.None:this.switchLevel(et,ot);break;case ErrorActionFlags.MoveAllAlternatesMatchingHDCP:st&&(rt.maxHdcpLevel=HdcpLevels[HdcpLevels.indexOf(st)-1],nt.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${rt.maxHdcpLevel}" or lower`);break}nt.resolved||this.switchLevel(et,ot)}switchLevel(et,rt){rt!==void 0&&et.errorAction&&(this.warn(`switching to level ${rt} after ${et.details}`),this.hls.nextAutoLevel=rt,et.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}}class BasePlaylistController{constructor(et,rt){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=logger.log.bind(logger,`${rt}:`),this.warn=logger.warn.bind(logger,`${rt}:`),this.hls=et}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(et,rt){const nt=rt==null?void 0:rt.renditionReports;if(nt){let it=-1;for(let st=0;st<nt.length;st++){const ot=nt[st];let lt;try{lt=new self.URL(ot.URI,rt.url).href}catch(ut){logger.warn(`Could not construct new URL for Rendition Report: ${ut}`),lt=ot.URI||""}if(lt===et){it=st;break}else lt===et.substring(0,lt.length)&&(it=st)}if(it!==-1){const st=nt[it],ot=parseInt(st["LAST-MSN"])||(rt==null?void 0:rt.lastPartSn);let lt=parseInt(st["LAST-PART"])||(rt==null?void 0:rt.lastPartIndex);if(this.hls.config.lowLatencyMode){const ut=Math.min(rt.age-rt.partTarget,rt.targetduration);lt>=0&&ut>rt.partTarget&&(lt+=1)}return new HlsUrlParameters(ot,lt>=0?lt:void 0,HlsSkip.No)}}}loadPlaylist(et){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(et){return this.canLoad&&!!et&&!!et.url&&(!et.details||et.details.live)}shouldReloadPlaylist(et){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(et)}playlistLoaded(et,rt,nt){const{details:it,stats:st}=rt,ot=self.performance.now(),lt=st.loading.first?Math.max(0,ot-st.loading.first):0;if(it.advancedDateTime=Date.now()-lt,it.live||nt!=null&&nt.live){if(it.reloaded(nt),nt&&this.log(`live playlist ${et} ${it.advanced?"REFRESHED "+it.lastPartSn+"-"+it.lastPartIndex:it.updated?"UPDATED":"MISSED"}`),nt&&it.fragments.length>0&&mergeDetails(nt,it),!this.canLoad||!it.live)return;let ut,ct,dt;if(it.canBlockReload&&it.endSN&&it.advanced){const mt=this.hls.config.lowLatencyMode,Kr=it.lastPartSn,Xr=it.endSN,Zr=it.lastPartIndex,Qr=Zr!==-1,_i=Kr===Xr,ns=mt?0:Zr;Qr?(ct=_i?Xr+1:Kr,dt=_i?ns:Zr+1):ct=Xr+1;const rs=it.age,ss=rs+it.ageHeader;let hs=Math.min(ss-it.partTarget,it.targetduration*1.5);if(hs>0){if(nt&&hs>nt.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${nt.tuneInGoal} to: ${hs} with playlist age: ${it.age}`),hs=0;else{const os=Math.floor(hs/it.targetduration);if(ct+=os,dt!==void 0){const is=Math.round(hs%it.targetduration/it.partTarget);dt+=is}this.log(`CDN Tune-in age: ${it.ageHeader}s last advanced ${rs.toFixed(2)}s goal: ${hs} skip sn ${os} to part ${dt}`)}it.tuneInGoal=hs}if(ut=this.getDeliveryDirectives(it,rt.deliveryDirectives,ct,dt),mt||!_i){this.loadPlaylist(ut);return}}else(it.canBlockReload||it.canSkipUntil)&&(ut=this.getDeliveryDirectives(it,rt.deliveryDirectives,ct,dt));const pt=this.hls.mainForwardBufferInfo,ft=pt?pt.end-pt.len:0,gt=(it.edge-ft)*1e3,_r=computeReloadInterval(it,gt);it.updated&&ot>this.requestScheduled+_r&&(this.requestScheduled=st.loading.start),ct!==void 0&&it.canBlockReload?this.requestScheduled=st.loading.first+_r-(it.partTarget*1e3||1e3):this.requestScheduled===-1||this.requestScheduled+_r<ot?this.requestScheduled=ot:this.requestScheduled-ot<=0&&(this.requestScheduled+=_r);let Yr=this.requestScheduled-ot;Yr=Math.max(0,Yr),this.log(`reload live playlist ${et} in ${Math.round(Yr)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(ut),Yr)}else this.clearTimer()}getDeliveryDirectives(et,rt,nt,it){let st=getSkipValue(et,nt);return rt!=null&&rt.skip&&et.deltaUpdateFailed&&(nt=rt.msn,it=rt.part,st=HlsSkip.No),new HlsUrlParameters(nt,it,st)}checkRetry(et){const rt=et.details,nt=isTimeoutError(et),it=et.errorAction,{action:st,retryCount:ot=0,retryConfig:lt}=it||{},ut=!!it&&!!lt&&(st===NetworkErrorAction.RetryRequest||!it.resolved&&st===NetworkErrorAction.SendAlternateToPenaltyBox);if(ut){var ct;if(this.requestScheduled=-1,ot>=lt.maxNumRetry)return!1;if(nt&&(ct=et.context)!=null&&ct.deliveryDirectives)this.warn(`Retrying playlist loading ${ot+1}/${lt.maxNumRetry} after "${rt}" without delivery-directives`),this.loadPlaylist();else{const dt=getRetryDelay(lt,ot);this.timer=self.setTimeout(()=>this.loadPlaylist(),dt),this.warn(`Retrying playlist loading ${ot+1}/${lt.maxNumRetry} after "${rt}" in ${dt}ms`)}et.levelRetry=!0,it.resolved=!0}return ut}}class EWMA{constructor(et,rt=0,nt=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=et,this.alpha_=et?Math.exp(Math.log(.5)/et):0,this.estimate_=rt,this.totalWeight_=nt}sample(et,rt){const nt=Math.pow(this.alpha_,et);this.estimate_=rt*(1-nt)+nt*this.estimate_,this.totalWeight_+=et}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const et=1-Math.pow(this.alpha_,this.totalWeight_);if(et)return this.estimate_/et}return this.estimate_}}class EwmaBandWidthEstimator{constructor(et,rt,nt,it=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=nt,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new EWMA(et),this.fast_=new EWMA(rt),this.defaultTTFB_=it,this.ttfb_=new EWMA(et)}update(et,rt){const{slow_:nt,fast_:it,ttfb_:st}=this;nt.halfLife!==et&&(this.slow_=new EWMA(et,nt.getEstimate(),nt.getTotalWeight())),it.halfLife!==rt&&(this.fast_=new EWMA(rt,it.getEstimate(),it.getTotalWeight())),st.halfLife!==et&&(this.ttfb_=new EWMA(et,st.getEstimate(),st.getTotalWeight()))}sample(et,rt){et=Math.max(et,this.minDelayMs_);const nt=8*rt,it=et/1e3,st=nt/it;this.fast_.sample(it,st),this.slow_.sample(it,st)}sampleTTFB(et){const rt=et/1e3,nt=Math.sqrt(2)*Math.exp(-Math.pow(rt,2)/2);this.ttfb_.sample(nt,Math.max(et,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}const SUPPORTED_INFO_DEFAULT={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]},SUPPORTED_INFO_CACHE={};function requiresMediaCapabilitiesDecodingInfo(tt,et,rt,nt,it,st){const ot=tt.audioCodec?tt.audioGroups:null,lt=st==null?void 0:st.audioCodec,ut=st==null?void 0:st.channels,ct=ut?parseInt(ut):lt?1/0:2;let dt=null;if(ot!=null&&ot.length)try{ot.length===1&&ot[0]?dt=et.groups[ot[0]].channels:dt=ot.reduce((pt,ft)=>{if(ft){const gt=et.groups[ft];if(!gt)throw new Error(`Audio track group ${ft} not found`);Object.keys(gt.channels).forEach(_r=>{pt[_r]=(pt[_r]||0)+gt.channels[_r]})}return pt},{2:0})}catch{return!0}return tt.videoCodec!==void 0&&(tt.width>1920&&tt.height>1088||tt.height>1920&&tt.width>1088||tt.frameRate>Math.max(nt,30)||tt.videoRange!=="SDR"&&tt.videoRange!==rt||tt.bitrate>Math.max(it,8e6))||!!dt&&isFiniteNumber(ct)&&Object.keys(dt).some(pt=>parseInt(pt)>ct)}function getMediaDecodingInfoPromise(tt,et,rt){const nt=tt.videoCodec,it=tt.audioCodec;if(!nt||!it||!rt)return Promise.resolve(SUPPORTED_INFO_DEFAULT);const st={width:tt.width,height:tt.height,bitrate:Math.ceil(Math.max(tt.bitrate*.9,tt.averageBitrate)),framerate:tt.frameRate||30},ot=tt.videoRange;ot!=="SDR"&&(st.transferFunction=ot.toLowerCase());const lt=nt.split(",").map(ut=>({type:"media-source",video:_objectSpread2(_objectSpread2({},st),{},{contentType:mimeTypeForCodec(ut,"video")})}));return it&&tt.audioGroups&&tt.audioGroups.forEach(ut=>{var ct;ut&&((ct=et.groups[ut])==null||ct.tracks.forEach(dt=>{if(dt.groupId===ut){const pt=dt.channels||"",ft=parseFloat(pt);isFiniteNumber(ft)&&ft>2&&lt.push.apply(lt,it.split(",").map(gt=>({type:"media-source",audio:{contentType:mimeTypeForCodec(gt,"audio"),channels:""+ft}})))}}))}),Promise.all(lt.map(ut=>{const ct=getMediaDecodingInfoKey(ut);return SUPPORTED_INFO_CACHE[ct]||(SUPPORTED_INFO_CACHE[ct]=rt.decodingInfo(ut))})).then(ut=>({supported:!ut.some(ct=>!ct.supported),configurations:lt,decodingInfoResults:ut})).catch(ut=>({supported:!1,configurations:lt,decodingInfoResults:[],error:ut}))}function getMediaDecodingInfoKey(tt){const{audio:et,video:rt}=tt,nt=rt||et;if(nt){const it=nt.contentType.split('"')[1];if(rt)return`r${rt.height}x${rt.width}f${Math.ceil(rt.framerate)}${rt.transferFunction||"sd"}_${it}_${Math.ceil(rt.bitrate/1e5)}`;if(et)return`c${et.channels}${et.spatialRendering?"s":"n"}_${it}`}return""}function isHdrSupported(){if(typeof matchMedia=="function"){const tt=matchMedia("(dynamic-range: high)"),et=matchMedia("bad query");if(tt.media!==et.media)return tt.matches===!0}return!1}function getVideoSelectionOptions(tt,et){let rt=!1,nt=[];return tt&&(rt=tt!=="SDR",nt=[tt]),et&&(nt=et.allowedVideoRanges||VideoRangeValues.slice(0),rt=et.preferHDR!==void 0?et.preferHDR:isHdrSupported(),rt?nt=nt.filter(it=>it!=="SDR"):nt=["SDR"]),{preferHDR:rt,allowedVideoRanges:nt}}function getStartCodecTier(tt,et,rt,nt,it){const st=Object.keys(tt),ot=nt==null?void 0:nt.channels,lt=nt==null?void 0:nt.audioCodec,ut=ot&&parseInt(ot)===2;let ct=!0,dt=!1,pt=1/0,ft=1/0,gt=1/0,_r=0,Yr=[];const{preferHDR:mt,allowedVideoRanges:Kr}=getVideoSelectionOptions(et,it);for(let _i=st.length;_i--;){const ns=tt[st[_i]];ct=ns.channels[2]>0,pt=Math.min(pt,ns.minHeight),ft=Math.min(ft,ns.minFramerate),gt=Math.min(gt,ns.minBitrate);const rs=Kr.filter(ss=>ns.videoRanges[ss]>0);rs.length>0&&(dt=!0,Yr=rs)}pt=isFiniteNumber(pt)?pt:0,ft=isFiniteNumber(ft)?ft:0;const Xr=Math.max(1080,pt),Zr=Math.max(30,ft);return gt=isFiniteNumber(gt)?gt:rt,rt=Math.max(gt,rt),dt||(et=void 0,Yr=[]),{codecSet:st.reduce((_i,ns)=>{const rs=tt[ns];if(ns===_i)return _i;if(rs.minBitrate>rt)return logStartCodecCandidateIgnored(ns,`min bitrate of ${rs.minBitrate} > current estimate of ${rt}`),_i;if(!rs.hasDefaultAudio)return logStartCodecCandidateIgnored(ns,"no renditions with default or auto-select sound found"),_i;if(lt&&ns.indexOf(lt.substring(0,4))%5!==0)return logStartCodecCandidateIgnored(ns,`audio codec preference "${lt}" not found`),_i;if(ot&&!ut){if(!rs.channels[ot])return logStartCodecCandidateIgnored(ns,`no renditions with ${ot} channel sound found (channels options: ${Object.keys(rs.channels)})`),_i}else if((!lt||ut)&&ct&&rs.channels[2]===0)return logStartCodecCandidateIgnored(ns,"no renditions with stereo sound found"),_i;return rs.minHeight>Xr?(logStartCodecCandidateIgnored(ns,`min resolution of ${rs.minHeight} > maximum of ${Xr}`),_i):rs.minFramerate>Zr?(logStartCodecCandidateIgnored(ns,`min framerate of ${rs.minFramerate} > maximum of ${Zr}`),_i):Yr.some(ss=>rs.videoRanges[ss]>0)?rs.maxScore<_r?(logStartCodecCandidateIgnored(ns,`max score of ${rs.maxScore} < selected max of ${_r}`),_i):_i&&(codecsSetSelectionPreferenceValue(ns)>=codecsSetSelectionPreferenceValue(_i)||rs.fragmentError>tt[_i].fragmentError)?_i:(_r=rs.maxScore,ns):(logStartCodecCandidateIgnored(ns,`no variants with VIDEO-RANGE of ${JSON.stringify(Yr)} found`),_i)},void 0),videoRanges:Yr,preferHDR:mt,minFramerate:ft,minBitrate:gt}}function logStartCodecCandidateIgnored(tt,et){logger.log(`[abr] start candidates with "${tt}" ignored because ${et}`)}function getAudioTracksByGroup(tt){return tt.reduce((et,rt)=>{let nt=et.groups[rt.groupId];nt||(nt=et.groups[rt.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),nt.tracks.push(rt);const it=rt.channels||"2";return nt.channels[it]=(nt.channels[it]||0)+1,nt.hasDefault=nt.hasDefault||rt.default,nt.hasAutoSelect=nt.hasAutoSelect||rt.autoselect,nt.hasDefault&&(et.hasDefaultAudio=!0),nt.hasAutoSelect&&(et.hasAutoSelectAudio=!0),et},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function getCodecTiers(tt,et,rt,nt){return tt.slice(rt,nt+1).reduce((it,st)=>{if(!st.codecSet)return it;const ot=st.audioGroups;let lt=it[st.codecSet];lt||(it[st.codecSet]=lt={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!ot,fragmentError:0}),lt.minBitrate=Math.min(lt.minBitrate,st.bitrate);const ut=Math.min(st.height,st.width);return lt.minHeight=Math.min(lt.minHeight,ut),lt.minFramerate=Math.min(lt.minFramerate,st.frameRate),lt.maxScore=Math.max(lt.maxScore,st.score),lt.fragmentError+=st.fragmentError,lt.videoRanges[st.videoRange]=(lt.videoRanges[st.videoRange]||0)+1,ot&&ot.forEach(ct=>{if(!ct)return;const dt=et.groups[ct];lt.hasDefaultAudio=lt.hasDefaultAudio||et.hasDefaultAudio?dt.hasDefault:dt.hasAutoSelect||!et.hasDefaultAudio&&!et.hasAutoSelectAudio,Object.keys(dt.channels).forEach(pt=>{lt.channels[pt]=(lt.channels[pt]||0)+dt.channels[pt]})}),it},{})}function findMatchingOption(tt,et,rt){if("attrs"in tt){const nt=et.indexOf(tt);if(nt!==-1)return nt}for(let nt=0;nt<et.length;nt++){const it=et[nt];if(matchesOption(tt,it,rt))return nt}return-1}function matchesOption(tt,et,rt){const{groupId:nt,name:it,lang:st,assocLang:ot,characteristics:lt,default:ut}=tt,ct=tt.forced;return(nt===void 0||et.groupId===nt)&&(it===void 0||et.name===it)&&(st===void 0||et.lang===st)&&(st===void 0||et.assocLang===ot)&&(ut===void 0||et.default===ut)&&(ct===void 0||et.forced===ct)&&(lt===void 0||characteristicsMatch(lt,et.characteristics))&&(rt===void 0||rt(tt,et))}function characteristicsMatch(tt,et=""){const rt=tt.split(","),nt=et.split(",");return rt.length===nt.length&&!rt.some(it=>nt.indexOf(it)===-1)}function audioMatchPredicate(tt,et){const{audioCodec:rt,channels:nt}=tt;return(rt===void 0||(et.audioCodec||"").substring(0,4)===rt.substring(0,4))&&(nt===void 0||nt===(et.channels||"2"))}function findClosestLevelWithAudioGroup(tt,et,rt,nt,it){const st=et[nt],lt=et.reduce((ft,gt,_r)=>{const Yr=gt.uri;return(ft[Yr]||(ft[Yr]=[])).push(_r),ft},{})[st.uri];lt.length>1&&(nt=Math.max.apply(Math,lt));const ut=st.videoRange,ct=st.frameRate,dt=st.codecSet.substring(0,4),pt=searchDownAndUpList(et,nt,ft=>{if(ft.videoRange!==ut||ft.frameRate!==ct||ft.codecSet.substring(0,4)!==dt)return!1;const gt=ft.audioGroups,_r=rt.filter(Yr=>!gt||gt.indexOf(Yr.groupId)!==-1);return findMatchingOption(tt,_r,it)>-1});return pt>-1?pt:searchDownAndUpList(et,nt,ft=>{const gt=ft.audioGroups,_r=rt.filter(Yr=>!gt||gt.indexOf(Yr.groupId)!==-1);return findMatchingOption(tt,_r,it)>-1})}function searchDownAndUpList(tt,et,rt){for(let nt=et;nt;nt--)if(rt(tt[nt]))return nt;for(let nt=et+1;nt<tt.length;nt++)if(rt(tt[nt]))return nt;return-1}class AbrController{constructor(et){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this._abandonRulesCheck=()=>{const{fragCurrent:rt,partCurrent:nt,hls:it}=this,{autoLevelEnabled:st,media:ot}=it;if(!rt||!ot)return;const lt=performance.now(),ut=nt?nt.stats:rt.stats,ct=nt?nt.duration:rt.duration,dt=lt-ut.loading.start,pt=it.minAutoLevel;if(ut.aborted||ut.loaded&&ut.loaded===ut.total||rt.level<=pt){this.clearTimer(),this._nextAutoLevel=-1;return}if(!st||ot.paused||!ot.playbackRate||!ot.readyState)return;const ft=it.mainForwardBufferInfo;if(ft===null)return;const gt=this.bwEstimator.getEstimateTTFB(),_r=Math.abs(ot.playbackRate);if(dt<=Math.max(gt,1e3*(ct/(_r*2))))return;const Yr=ft.len/_r,mt=ut.loading.first?ut.loading.first-ut.loading.start:-1,Kr=ut.loaded&&mt>-1,Xr=this.getBwEstimate(),Zr=it.levels,Qr=Zr[rt.level],_i=ut.total||Math.max(ut.loaded,Math.round(ct*Qr.averageBitrate/8));let ns=Kr?dt-mt:dt;ns<1&&Kr&&(ns=Math.min(dt,ut.loaded*8/Xr));const rs=Kr?ut.loaded*1e3/ns:0,ss=rs?(_i-ut.loaded)/rs:_i*8/Xr+gt/1e3;if(ss<=Yr)return;const hs=rs?rs*8:Xr;let os=Number.POSITIVE_INFINITY,is;for(is=rt.level-1;is>pt;is--){const ps=Zr[is].maxBitrate;if(os=this.getTimeToLoadFrag(gt/1e3,hs,ct*ps,!Zr[is].details),os<Yr)break}if(os>=ss||os>ct*10)return;it.nextLoadLevel=it.nextAutoLevel=is,Kr?this.bwEstimator.sample(dt-Math.min(gt,mt),ut.loaded):this.bwEstimator.sampleTTFB(dt);const cs=Zr[is].maxBitrate;this.getBwEstimate()*this.hls.config.abrBandWidthUpFactor>cs&&this.resetEstimator(cs),this.clearTimer(),logger.warn(`[abr] Fragment ${rt.sn}${nt?" part "+nt.index:""} of level ${rt.level} is loading too slowly;
      Time to underbuffer: ${Yr.toFixed(3)} s
      Estimated load time for current fragment: ${ss.toFixed(3)} s
      Estimated load time for down switch fragment: ${os.toFixed(3)} s
      TTFB estimate: ${mt|0} ms
      Current BW estimate: ${isFiniteNumber(Xr)?Xr|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${is} @ ${cs|0} bps`),it.trigger(Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:rt,part:nt,stats:ut})},this.hls=et,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(et){et&&(logger.log(`setting initial bwe to ${et}`),this.hls.config.abrEwmaDefaultEstimate=et),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const et=this.hls.config;return new EwmaBandWidthEstimator(et.abrEwmaSlowVoD,et.abrEwmaFastVoD,et.abrEwmaDefaultEstimate)}registerListeners(){const{hls:et}=this;et.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.on(Events.FRAG_LOADING,this.onFragLoading,this),et.on(Events.FRAG_LOADED,this.onFragLoaded,this),et.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),et.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),et.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),et.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),et.on(Events.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),et.on(Events.ERROR,this.onError,this)}unregisterListeners(){const{hls:et}=this;et&&(et.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.off(Events.FRAG_LOADING,this.onFragLoading,this),et.off(Events.FRAG_LOADED,this.onFragLoaded,this),et.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),et.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),et.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),et.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),et.off(Events.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),et.off(Events.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(et,rt){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(et,rt){const nt=rt.frag;if(!this.ignoreFragment(nt)){if(!nt.bitrateTest){var it;this.fragCurrent=nt,this.partCurrent=(it=rt.part)!=null?it:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(et,rt){this.clearTimer()}onError(et,rt){if(!rt.fatal)switch(rt.details){case ErrorDetails.BUFFER_ADD_CODEC_ERROR:case ErrorDetails.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case ErrorDetails.FRAG_LOAD_TIMEOUT:{const nt=rt.frag,{fragCurrent:it,partCurrent:st}=this;if(nt&&it&&nt.sn===it.sn&&nt.level===it.level){const ot=performance.now(),lt=st?st.stats:nt.stats,ut=ot-lt.loading.start,ct=lt.loading.first?lt.loading.first-lt.loading.start:-1;if(lt.loaded&&ct>-1){const pt=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(ut-Math.min(pt,ct),lt.loaded)}else this.bwEstimator.sampleTTFB(ut)}break}}}getTimeToLoadFrag(et,rt,nt,it){const st=et+nt/rt,ot=it?this.lastLevelLoadSec:0;return st+ot}onLevelLoaded(et,rt){const nt=this.hls.config,{loading:it}=rt.stats,st=it.end-it.start;isFiniteNumber(st)&&(this.lastLevelLoadSec=st/1e3),rt.details.live?this.bwEstimator.update(nt.abrEwmaSlowLive,nt.abrEwmaFastLive):this.bwEstimator.update(nt.abrEwmaSlowVoD,nt.abrEwmaFastVoD)}onFragLoaded(et,{frag:rt,part:nt}){const it=nt?nt.stats:rt.stats;if(rt.type===PlaylistLevelType.MAIN&&this.bwEstimator.sampleTTFB(it.loading.first-it.loading.start),!this.ignoreFragment(rt)){if(this.clearTimer(),rt.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const st=nt?nt.duration:rt.duration,ot=this.hls.levels[rt.level],lt=(ot.loaded?ot.loaded.bytes:0)+it.loaded,ut=(ot.loaded?ot.loaded.duration:0)+st;ot.loaded={bytes:lt,duration:ut},ot.realBitrate=Math.round(8*lt/ut)}if(rt.bitrateTest){const st={stats:it,frag:rt,part:nt,id:rt.type};this.onFragBuffered(Events.FRAG_BUFFERED,st),rt.bitrateTest=!1}else this.lastLoadedFragLevel=rt.level}}onFragBuffered(et,rt){const{frag:nt,part:it}=rt,st=it!=null&&it.stats.loaded?it.stats:nt.stats;if(st.aborted||this.ignoreFragment(nt))return;const ot=st.parsing.end-st.loading.start-Math.min(st.loading.first-st.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(ot,st.loaded),st.bwEstimate=this.getBwEstimate(),nt.bitrateTest?this.bitrateTestDelay=ot/1e3:this.bitrateTestDelay=0}ignoreFragment(et){return et.type!==PlaylistLevelType.MAIN||et.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:et,minAutoLevel:rt}=this.hls,nt=this.getBwEstimate(),it=this.hls.config.maxStarvationDelay,st=this.findBestLevel(nt,rt,et,0,it,1,1);if(st>-1)return st;const ot=this.hls.firstLevel,lt=Math.min(Math.max(ot,rt),et);return logger.warn(`[abr] Could not find best starting auto level. Defaulting to first in playlist ${ot} clamped to ${lt}`),lt}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const et=this.forcedAutoLevel,nt=this.bwEstimator.canEstimate(),it=this.lastLoadedFragLevel>-1;if(et!==-1&&(!nt||!it||this.nextAutoLevelKey===this.getAutoLevelKey()))return et;const st=nt&&it?this.getNextABRAutoLevel():this.firstAutoLevel;if(et!==-1){const ot=this.hls.levels;if(ot.length>Math.max(et,st)&&ot[et].loadError<=ot[st].loadError)return et}return this._nextAutoLevel=st,this.nextAutoLevelKey=this.getAutoLevelKey(),st}getAutoLevelKey(){var et;return`${this.getBwEstimate()}_${(et=this.hls.mainForwardBufferInfo)==null?void 0:et.len}`}getNextABRAutoLevel(){const{fragCurrent:et,partCurrent:rt,hls:nt}=this,{maxAutoLevel:it,config:st,minAutoLevel:ot,media:lt}=nt,ut=rt?rt.duration:et?et.duration:0,ct=lt&&lt.playbackRate!==0?Math.abs(lt.playbackRate):1,dt=this.getBwEstimate(),pt=nt.mainForwardBufferInfo,ft=(pt?pt.len:0)/ct;let gt=st.abrBandWidthFactor,_r=st.abrBandWidthUpFactor;if(ft){const Zr=this.findBestLevel(dt,ot,it,ft,0,gt,_r);if(Zr>=0)return Zr}let Yr=ut?Math.min(ut,st.maxStarvationDelay):st.maxStarvationDelay;if(!ft){const Zr=this.bitrateTestDelay;Zr&&(Yr=(ut?Math.min(ut,st.maxLoadingDelay):st.maxLoadingDelay)-Zr,logger.info(`[abr] bitrate test took ${Math.round(1e3*Zr)}ms, set first fragment max fetchDuration to ${Math.round(1e3*Yr)} ms`),gt=_r=1)}const mt=this.findBestLevel(dt,ot,it,ft,Yr,gt,_r);if(logger.info(`[abr] ${ft?"rebuffering expected":"buffer is empty"}, optimal quality level ${mt}`),mt>-1)return mt;const Kr=nt.levels[ot],Xr=nt.levels[nt.loadLevel];return(Kr==null?void 0:Kr.bitrate)<(Xr==null?void 0:Xr.bitrate)?ot:nt.loadLevel}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(et,rt,nt,it,st,ot,lt){var ut;const ct=it+st,dt=this.lastLoadedFragLevel,pt=dt===-1?this.hls.firstLevel:dt,{fragCurrent:ft,partCurrent:gt}=this,{levels:_r,allAudioTracks:Yr,loadLevel:mt,config:Kr}=this.hls;if(_r.length===1)return 0;const Xr=_r[pt],Zr=!!(Xr!=null&&(ut=Xr.details)!=null&&ut.live),Qr=mt===-1||dt===-1;let _i,ns="SDR",rs=(Xr==null?void 0:Xr.frameRate)||0;const{audioPreference:ss,videoPreference:hs}=Kr,os=this.audioTracksByGroup||(this.audioTracksByGroup=getAudioTracksByGroup(Yr));if(Qr){if(this.firstSelection!==-1)return this.firstSelection;const ls=this.codecTiers||(this.codecTiers=getCodecTiers(_r,os,rt,nt)),ms=getStartCodecTier(ls,ns,et,ss,hs),{codecSet:us,videoRanges:gs,minFramerate:ys,minBitrate:Es,preferHDR:Ss}=ms;_i=us,ns=Ss?gs[gs.length-1]:gs[0],rs=ys,et=Math.max(et,Es),logger.log(`[abr] picked start tier ${JSON.stringify(ms)}`)}else _i=Xr==null?void 0:Xr.codecSet,ns=Xr==null?void 0:Xr.videoRange;const is=gt?gt.duration:ft?ft.duration:0,cs=this.bwEstimator.getEstimateTTFB()/1e3,ps=[];for(let ls=nt;ls>=rt;ls--){var vs;const ms=_r[ls],us=ls>pt;if(!ms)continue;if(Kr.useMediaCapabilities&&!ms.supportedResult&&!ms.supportedPromise){const Rs=navigator.mediaCapabilities;typeof(Rs==null?void 0:Rs.decodingInfo)=="function"&&requiresMediaCapabilitiesDecodingInfo(ms,os,ns,rs,et,ss)?(ms.supportedPromise=getMediaDecodingInfoPromise(ms,os,Rs),ms.supportedPromise.then(Is=>{ms.supportedResult=Is;const ks=this.hls.levels,As=ks.indexOf(ms);Is.error?logger.warn(`[abr] MediaCapabilities decodingInfo error: "${Is.error}" for level ${As} ${JSON.stringify(Is)}`):Is.supported||(logger.warn(`[abr] Unsupported MediaCapabilities decodingInfo result for level ${As} ${JSON.stringify(Is)}`),As>-1&&ks.length>1&&(logger.log(`[abr] Removing unsupported level ${As}`),this.hls.removeLevel(As)))})):ms.supportedResult=SUPPORTED_INFO_DEFAULT}if(_i&&ms.codecSet!==_i||ns&&ms.videoRange!==ns||us&&rs>ms.frameRate||!us&&rs>0&&rs<ms.frameRate||ms.supportedResult&&!((vs=ms.supportedResult.decodingInfoResults)!=null&&vs[0].smooth)){ps.push(ls);continue}const gs=ms.details,ys=(gt?gs==null?void 0:gs.partTarget:gs==null?void 0:gs.averagetargetduration)||is;let Es;us?Es=lt*et:Es=ot*et;const Ss=is&&it>=is*2&&st===0?_r[ls].averageBitrate:_r[ls].maxBitrate,Ts=this.getTimeToLoadFrag(cs,Es,Ss*ys,gs===void 0);if(Es>=Ss&&(ls===dt||ms.loadError===0&&ms.fragmentError===0)&&(Ts<=cs||!isFiniteNumber(Ts)||Zr&&!this.bitrateTestDelay||Ts<ct)){const Rs=this.forcedAutoLevel;return ls!==mt&&(Rs===-1||Rs!==mt)&&(ps.length&&logger.trace(`[abr] Skipped level(s) ${ps.join(",")} of ${nt} max with CODECS and VIDEO-RANGE:"${_r[ps[0]].codecs}" ${_r[ps[0]].videoRange}; not compatible with "${Xr.codecs}" ${ns}`),logger.info(`[abr] switch candidate:${pt}->${ls} adjustedbw(${Math.round(Es)})-bitrate=${Math.round(Es-Ss)} ttfb:${cs.toFixed(1)} avgDuration:${ys.toFixed(1)} maxFetchDuration:${ct.toFixed(1)} fetchDuration:${Ts.toFixed(1)} firstSelection:${Qr} codecSet:${_i} videoRange:${ns} hls.loadLevel:${mt}`)),Qr&&(this.firstSelection=ls),ls}}return-1}set nextAutoLevel(et){const rt=Math.max(this.hls.minAutoLevel,et);this._nextAutoLevel!=rt&&(this.nextAutoLevelKey="",this._nextAutoLevel=rt)}}class TaskLoop{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(et){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,et),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}var FragmentState={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class FragmentTracker{constructor(et){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=et,this._registerListeners()}_registerListeners(){const{hls:et}=this;et.on(Events.BUFFER_APPENDED,this.onBufferAppended,this),et.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),et.on(Events.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:et}=this;et.off(Events.BUFFER_APPENDED,this.onBufferAppended,this),et.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),et.off(Events.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(et,rt){const nt=this.activePartLists[rt];if(nt)for(let it=nt.length;it--;){const st=nt[it];if(!st)break;const ot=st.end;if(st.start<=et&&ot!==null&&et<=ot)return st}return this.getBufferedFrag(et,rt)}getBufferedFrag(et,rt){const{fragments:nt}=this,it=Object.keys(nt);for(let st=it.length;st--;){const ot=nt[it[st]];if((ot==null?void 0:ot.body.type)===rt&&ot.buffered){const lt=ot.body;if(lt.start<=et&&et<=lt.end)return lt}}return null}detectEvictedFragments(et,rt,nt,it){this.timeRanges&&(this.timeRanges[et]=rt);const st=(it==null?void 0:it.fragment.sn)||-1;Object.keys(this.fragments).forEach(ot=>{const lt=this.fragments[ot];if(!lt||st>=lt.body.sn)return;if(!lt.buffered&&!lt.loaded){lt.body.type===nt&&this.removeFragment(lt.body);return}const ut=lt.range[et];ut&&ut.time.some(ct=>{const dt=!this.isTimeBuffered(ct.startPTS,ct.endPTS,rt);return dt&&this.removeFragment(lt.body),dt})})}detectPartialFragments(et){const rt=this.timeRanges,{frag:nt,part:it}=et;if(!rt||nt.sn==="initSegment")return;const st=getFragmentKey(nt),ot=this.fragments[st];if(!ot||ot.buffered&&nt.gap)return;const lt=!nt.relurl;Object.keys(rt).forEach(ut=>{const ct=nt.elementaryStreams[ut];if(!ct)return;const dt=rt[ut],pt=lt||ct.partial===!0;ot.range[ut]=this.getBufferedTimes(nt,it,pt,dt)}),ot.loaded=null,Object.keys(ot.range).length?(ot.buffered=!0,(ot.body.endList=nt.endList||ot.body.endList)&&(this.endListFragments[ot.body.type]=ot),isPartial(ot)||this.removeParts(nt.sn-1,nt.type)):this.removeFragment(ot.body)}removeParts(et,rt){const nt=this.activePartLists[rt];nt&&(this.activePartLists[rt]=nt.filter(it=>it.fragment.sn>=et))}fragBuffered(et,rt){const nt=getFragmentKey(et);let it=this.fragments[nt];!it&&rt&&(it=this.fragments[nt]={body:et,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},et.gap&&(this.hasGaps=!0)),it&&(it.loaded=null,it.buffered=!0)}getBufferedTimes(et,rt,nt,it){const st={time:[],partial:nt},ot=et.start,lt=et.end,ut=et.minEndPTS||lt,ct=et.maxStartPTS||ot;for(let dt=0;dt<it.length;dt++){const pt=it.start(dt)-this.bufferPadding,ft=it.end(dt)+this.bufferPadding;if(ct>=pt&&ut<=ft){st.time.push({startPTS:Math.max(ot,it.start(dt)),endPTS:Math.min(lt,it.end(dt))});break}else if(ot<ft&&lt>pt){const gt=Math.max(ot,it.start(dt)),_r=Math.min(lt,it.end(dt));_r>gt&&(st.partial=!0,st.time.push({startPTS:gt,endPTS:_r}))}else if(lt<=pt)break}return st}getPartialFragment(et){let rt=null,nt,it,st,ot=0;const{bufferPadding:lt,fragments:ut}=this;return Object.keys(ut).forEach(ct=>{const dt=ut[ct];dt&&isPartial(dt)&&(it=dt.body.start-lt,st=dt.body.end+lt,et>=it&&et<=st&&(nt=Math.min(et-it,st-et),ot<=nt&&(rt=dt.body,ot=nt)))}),rt}isEndListAppended(et){const rt=this.endListFragments[et];return rt!==void 0&&(rt.buffered||isPartial(rt))}getState(et){const rt=getFragmentKey(et),nt=this.fragments[rt];return nt?nt.buffered?isPartial(nt)?FragmentState.PARTIAL:FragmentState.OK:FragmentState.APPENDING:FragmentState.NOT_LOADED}isTimeBuffered(et,rt,nt){let it,st;for(let ot=0;ot<nt.length;ot++){if(it=nt.start(ot)-this.bufferPadding,st=nt.end(ot)+this.bufferPadding,et>=it&&rt<=st)return!0;if(rt<=it)return!1}return!1}onFragLoaded(et,rt){const{frag:nt,part:it}=rt;if(nt.sn==="initSegment"||nt.bitrateTest)return;const st=it?null:rt,ot=getFragmentKey(nt);this.fragments[ot]={body:nt,appendedPTS:null,loaded:st,buffered:!1,range:Object.create(null)}}onBufferAppended(et,rt){const{frag:nt,part:it,timeRanges:st}=rt;if(nt.sn==="initSegment")return;const ot=nt.type;if(it){let lt=this.activePartLists[ot];lt||(this.activePartLists[ot]=lt=[]),lt.push(it)}this.timeRanges=st,Object.keys(st).forEach(lt=>{const ut=st[lt];this.detectEvictedFragments(lt,ut,ot,it)})}onFragBuffered(et,rt){this.detectPartialFragments(rt)}hasFragment(et){const rt=getFragmentKey(et);return!!this.fragments[rt]}hasParts(et){var rt;return!!((rt=this.activePartLists[et])!=null&&rt.length)}removeFragmentsInRange(et,rt,nt,it,st){it&&!this.hasGaps||Object.keys(this.fragments).forEach(ot=>{const lt=this.fragments[ot];if(!lt)return;const ut=lt.body;ut.type!==nt||it&&!ut.gap||ut.start<rt&&ut.end>et&&(lt.buffered||st)&&this.removeFragment(ut)})}removeFragment(et){const rt=getFragmentKey(et);et.stats.loaded=0,et.clearElementaryStreamInfo();const nt=this.activePartLists[et.type];if(nt){const it=et.sn;this.activePartLists[et.type]=nt.filter(st=>st.fragment.sn!==it)}delete this.fragments[rt],et.endList&&delete this.endListFragments[et.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function isPartial(tt){var et,rt,nt;return tt.buffered&&(tt.body.gap||((et=tt.range.video)==null?void 0:et.partial)||((rt=tt.range.audio)==null?void 0:rt.partial)||((nt=tt.range.audiovideo)==null?void 0:nt.partial))}function getFragmentKey(tt){return`${tt.type}_${tt.level}_${tt.sn}`}const noopBuffered={length:0,start:()=>0,end:()=>0};class BufferHelper{static isBuffered(et,rt){try{if(et){const nt=BufferHelper.getBuffered(et);for(let it=0;it<nt.length;it++)if(rt>=nt.start(it)&&rt<=nt.end(it))return!0}}catch{}return!1}static bufferInfo(et,rt,nt){try{if(et){const it=BufferHelper.getBuffered(et),st=[];let ot;for(ot=0;ot<it.length;ot++)st.push({start:it.start(ot),end:it.end(ot)});return this.bufferedInfo(st,rt,nt)}}catch{}return{len:0,start:rt,end:rt,nextStart:void 0}}static bufferedInfo(et,rt,nt){rt=Math.max(0,rt),et.sort(function(ct,dt){const pt=ct.start-dt.start;return pt||dt.end-ct.end});let it=[];if(nt)for(let ct=0;ct<et.length;ct++){const dt=it.length;if(dt){const pt=it[dt-1].end;et[ct].start-pt<nt?et[ct].end>pt&&(it[dt-1].end=et[ct].end):it.push(et[ct])}else it.push(et[ct])}else it=et;let st=0,ot,lt=rt,ut=rt;for(let ct=0;ct<it.length;ct++){const dt=it[ct].start,pt=it[ct].end;if(rt+nt>=dt&&rt<pt)lt=dt,ut=pt,st=ut-rt;else if(rt+nt<dt){ot=dt;break}}return{len:st,start:lt||0,end:ut||0,nextStart:ot}}static getBuffered(et){try{return et.buffered}catch(rt){return logger.log("failed to get media.buffered",rt),noopBuffered}}}class ChunkMetadata{constructor(et,rt,nt,it=0,st=-1,ot=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=getNewPerformanceTiming(),this.buffering={audio:getNewPerformanceTiming(),video:getNewPerformanceTiming(),audiovideo:getNewPerformanceTiming()},this.level=et,this.sn=rt,this.id=nt,this.size=it,this.part=st,this.partial=ot}}function getNewPerformanceTiming(){return{start:0,executeStart:0,executeEnd:0,end:0}}function findFirstFragWithCC(tt,et){for(let nt=0,it=tt.length;nt<it;nt++){var rt;if(((rt=tt[nt])==null?void 0:rt.cc)===et)return tt[nt]}return null}function shouldAlignOnDiscontinuities(tt,et,rt){return!!(et&&(rt.endCC>rt.startCC||tt&&tt.cc<rt.startCC))}function findDiscontinuousReferenceFrag(tt,et){const rt=tt.fragments,nt=et.fragments;if(!nt.length||!rt.length){logger.log("No fragments to align");return}const it=findFirstFragWithCC(rt,nt[0].cc);if(!it||it&&!it.startPTS){logger.log("No frag in previous level to align on");return}return it}function adjustFragmentStart(tt,et){if(tt){const rt=tt.start+et;tt.start=tt.startPTS=rt,tt.endPTS=rt+tt.duration}}function adjustSlidingStart(tt,et){const rt=et.fragments;for(let nt=0,it=rt.length;nt<it;nt++)adjustFragmentStart(rt[nt],tt);et.fragmentHint&&adjustFragmentStart(et.fragmentHint,tt),et.alignedSliding=!0}function alignStream(tt,et,rt){et&&(alignDiscontinuities(tt,rt,et),!rt.alignedSliding&&et&&alignMediaPlaylistByPDT(rt,et),!rt.alignedSliding&&et&&!rt.skippedSegments&&adjustSliding(et,rt))}function alignDiscontinuities(tt,et,rt){if(shouldAlignOnDiscontinuities(tt,rt,et)){const nt=findDiscontinuousReferenceFrag(rt,et);nt&&isFiniteNumber(nt.start)&&(logger.log(`Adjusting PTS using last level due to CC increase within current level ${et.url}`),adjustSlidingStart(nt.start,et))}}function alignMediaPlaylistByPDT(tt,et){if(!tt.hasProgramDateTime||!et.hasProgramDateTime)return;const rt=tt.fragments,nt=et.fragments;if(!rt.length||!nt.length)return;let it,st;const ot=Math.min(et.endCC,tt.endCC);et.startCC<ot&&tt.startCC<ot&&(it=findFirstFragWithCC(nt,ot),st=findFirstFragWithCC(rt,ot)),(!it||!st)&&(it=nt[Math.floor(nt.length/2)],st=findFirstFragWithCC(rt,it.cc)||rt[Math.floor(rt.length/2)]);const lt=it.programDateTime,ut=st.programDateTime;if(!lt||!ut)return;const ct=(ut-lt)/1e3-(st.start-it.start);adjustSlidingStart(ct,tt)}const MIN_CHUNK_SIZE=Math.pow(2,17);class FragmentLoader{constructor(et){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=et}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(et,rt){const nt=et.url;if(!nt)return Promise.reject(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:et,error:new Error(`Fragment does not have a ${nt?"part list":"url"}`),networkDetails:null}));this.abort();const it=this.config,st=it.fLoader,ot=it.loader;return new Promise((lt,ut)=>{if(this.loader&&this.loader.destroy(),et.gap)if(et.tagList.some(gt=>gt[0]==="GAP")){ut(createGapLoadError(et));return}else et.gap=!1;const ct=this.loader=et.loader=st?new st(it):new ot(it),dt=createLoaderContext(et),pt=getLoaderConfigWithoutReties(it.fragLoadPolicy.default),ft={loadPolicy:pt,timeout:pt.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:et.sn==="initSegment"?1/0:MIN_CHUNK_SIZE};et.stats=ct.stats,ct.load(dt,ft,{onSuccess:(gt,_r,Yr,mt)=>{this.resetLoader(et,ct);let Kr=gt.data;Yr.resetIV&&et.decryptdata&&(et.decryptdata.iv=new Uint8Array(Kr.slice(0,16)),Kr=Kr.slice(16)),lt({frag:et,part:null,payload:Kr,networkDetails:mt})},onError:(gt,_r,Yr,mt)=>{this.resetLoader(et,ct),ut(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:et,response:_objectSpread2({url:nt,data:void 0},gt),error:new Error(`HTTP Error ${gt.code} ${gt.text}`),networkDetails:Yr,stats:mt}))},onAbort:(gt,_r,Yr)=>{this.resetLoader(et,ct),ut(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:et,error:new Error("Aborted"),networkDetails:Yr,stats:gt}))},onTimeout:(gt,_r,Yr)=>{this.resetLoader(et,ct),ut(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:et,error:new Error(`Timeout after ${ft.timeout}ms`),networkDetails:Yr,stats:gt}))},onProgress:(gt,_r,Yr,mt)=>{rt&&rt({frag:et,part:null,payload:Yr,networkDetails:mt})}})})}loadPart(et,rt,nt){this.abort();const it=this.config,st=it.fLoader,ot=it.loader;return new Promise((lt,ut)=>{if(this.loader&&this.loader.destroy(),et.gap||rt.gap){ut(createGapLoadError(et,rt));return}const ct=this.loader=et.loader=st?new st(it):new ot(it),dt=createLoaderContext(et,rt),pt=getLoaderConfigWithoutReties(it.fragLoadPolicy.default),ft={loadPolicy:pt,timeout:pt.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:MIN_CHUNK_SIZE};rt.stats=ct.stats,ct.load(dt,ft,{onSuccess:(gt,_r,Yr,mt)=>{this.resetLoader(et,ct),this.updateStatsFromPart(et,rt);const Kr={frag:et,part:rt,payload:gt.data,networkDetails:mt};nt(Kr),lt(Kr)},onError:(gt,_r,Yr,mt)=>{this.resetLoader(et,ct),ut(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:et,part:rt,response:_objectSpread2({url:dt.url,data:void 0},gt),error:new Error(`HTTP Error ${gt.code} ${gt.text}`),networkDetails:Yr,stats:mt}))},onAbort:(gt,_r,Yr)=>{et.stats.aborted=rt.stats.aborted,this.resetLoader(et,ct),ut(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:et,part:rt,error:new Error("Aborted"),networkDetails:Yr,stats:gt}))},onTimeout:(gt,_r,Yr)=>{this.resetLoader(et,ct),ut(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:et,part:rt,error:new Error(`Timeout after ${ft.timeout}ms`),networkDetails:Yr,stats:gt}))}})})}updateStatsFromPart(et,rt){const nt=et.stats,it=rt.stats,st=it.total;if(nt.loaded+=it.loaded,st){const ut=Math.round(et.duration/rt.duration),ct=Math.min(Math.round(nt.loaded/st),ut),pt=(ut-ct)*Math.round(nt.loaded/ct);nt.total=nt.loaded+pt}else nt.total=Math.max(nt.loaded,nt.total);const ot=nt.loading,lt=it.loading;ot.start?ot.first+=lt.first-lt.start:(ot.start=lt.start,ot.first=lt.first),ot.end=lt.end}resetLoader(et,rt){et.loader=null,this.loader===rt&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),rt.destroy()}}function createLoaderContext(tt,et=null){const rt=et||tt,nt={frag:tt,part:et,responseType:"arraybuffer",url:rt.url,headers:{},rangeStart:0,rangeEnd:0},it=rt.byteRangeStartOffset,st=rt.byteRangeEndOffset;if(isFiniteNumber(it)&&isFiniteNumber(st)){var ot;let lt=it,ut=st;if(tt.sn==="initSegment"&&((ot=tt.decryptdata)==null?void 0:ot.method)==="AES-128"){const ct=st-it;ct%16&&(ut=st+(16-ct%16)),it!==0&&(nt.resetIV=!0,lt=it-16)}nt.rangeStart=lt,nt.rangeEnd=ut}return nt}function createGapLoadError(tt,et){const rt=new Error(`GAP ${tt.gap?"tag":"attribute"} found`),nt={type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_GAP,fatal:!1,frag:tt,error:rt,networkDetails:null};return et&&(nt.part=et),(et||tt).stats.aborted=!0,new LoadError(nt)}class LoadError extends Error{constructor(et){super(et.error.message),this.data=void 0,this.data=et}}class AESCrypto{constructor(et,rt){this.subtle=void 0,this.aesIV=void 0,this.subtle=et,this.aesIV=rt}decrypt(et,rt){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},rt,et)}}class FastAESKey{constructor(et,rt){this.subtle=void 0,this.key=void 0,this.subtle=et,this.key=rt}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}function removePadding(tt){const et=tt.byteLength,rt=et&&new DataView(tt.buffer).getUint8(et-1);return rt?sliceUint8(tt,0,et-rt):tt}class AESDecryptor{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(et){const rt=new DataView(et),nt=new Uint32Array(4);for(let it=0;it<4;it++)nt[it]=rt.getUint32(it*4);return nt}initTable(){const et=this.sBox,rt=this.invSBox,nt=this.subMix,it=nt[0],st=nt[1],ot=nt[2],lt=nt[3],ut=this.invSubMix,ct=ut[0],dt=ut[1],pt=ut[2],ft=ut[3],gt=new Uint32Array(256);let _r=0,Yr=0,mt=0;for(mt=0;mt<256;mt++)mt<128?gt[mt]=mt<<1:gt[mt]=mt<<1^283;for(mt=0;mt<256;mt++){let Kr=Yr^Yr<<1^Yr<<2^Yr<<3^Yr<<4;Kr=Kr>>>8^Kr&255^99,et[_r]=Kr,rt[Kr]=_r;const Xr=gt[_r],Zr=gt[Xr],Qr=gt[Zr];let _i=gt[Kr]*257^Kr*16843008;it[_r]=_i<<24|_i>>>8,st[_r]=_i<<16|_i>>>16,ot[_r]=_i<<8|_i>>>24,lt[_r]=_i,_i=Qr*16843009^Zr*65537^Xr*257^_r*16843008,ct[Kr]=_i<<24|_i>>>8,dt[Kr]=_i<<16|_i>>>16,pt[Kr]=_i<<8|_i>>>24,ft[Kr]=_i,_r?(_r=Xr^gt[gt[gt[Qr^Xr]]],Yr^=gt[gt[Yr]]):_r=Yr=1}}expandKey(et){const rt=this.uint8ArrayToUint32Array_(et);let nt=!0,it=0;for(;it<rt.length&&nt;)nt=rt[it]===this.key[it],it++;if(nt)return;this.key=rt;const st=this.keySize=rt.length;if(st!==4&&st!==6&&st!==8)throw new Error("Invalid aes key size="+st);const ot=this.ksRows=(st+6+1)*4;let lt,ut;const ct=this.keySchedule=new Uint32Array(ot),dt=this.invKeySchedule=new Uint32Array(ot),pt=this.sBox,ft=this.rcon,gt=this.invSubMix,_r=gt[0],Yr=gt[1],mt=gt[2],Kr=gt[3];let Xr,Zr;for(lt=0;lt<ot;lt++){if(lt<st){Xr=ct[lt]=rt[lt];continue}Zr=Xr,lt%st===0?(Zr=Zr<<8|Zr>>>24,Zr=pt[Zr>>>24]<<24|pt[Zr>>>16&255]<<16|pt[Zr>>>8&255]<<8|pt[Zr&255],Zr^=ft[lt/st|0]<<24):st>6&&lt%st===4&&(Zr=pt[Zr>>>24]<<24|pt[Zr>>>16&255]<<16|pt[Zr>>>8&255]<<8|pt[Zr&255]),ct[lt]=Xr=(ct[lt-st]^Zr)>>>0}for(ut=0;ut<ot;ut++)lt=ot-ut,ut&3?Zr=ct[lt]:Zr=ct[lt-4],ut<4||lt<=4?dt[ut]=Zr:dt[ut]=_r[pt[Zr>>>24]]^Yr[pt[Zr>>>16&255]]^mt[pt[Zr>>>8&255]]^Kr[pt[Zr&255]],dt[ut]=dt[ut]>>>0}networkToHostOrderSwap(et){return et<<24|(et&65280)<<8|(et&16711680)>>8|et>>>24}decrypt(et,rt,nt){const it=this.keySize+6,st=this.invKeySchedule,ot=this.invSBox,lt=this.invSubMix,ut=lt[0],ct=lt[1],dt=lt[2],pt=lt[3],ft=this.uint8ArrayToUint32Array_(nt);let gt=ft[0],_r=ft[1],Yr=ft[2],mt=ft[3];const Kr=new Int32Array(et),Xr=new Int32Array(Kr.length);let Zr,Qr,_i,ns,rs,ss,hs,os,is,cs,ps,vs,ls,ms;const us=this.networkToHostOrderSwap;for(;rt<Kr.length;){for(is=us(Kr[rt]),cs=us(Kr[rt+1]),ps=us(Kr[rt+2]),vs=us(Kr[rt+3]),rs=is^st[0],ss=vs^st[1],hs=ps^st[2],os=cs^st[3],ls=4,ms=1;ms<it;ms++)Zr=ut[rs>>>24]^ct[ss>>16&255]^dt[hs>>8&255]^pt[os&255]^st[ls],Qr=ut[ss>>>24]^ct[hs>>16&255]^dt[os>>8&255]^pt[rs&255]^st[ls+1],_i=ut[hs>>>24]^ct[os>>16&255]^dt[rs>>8&255]^pt[ss&255]^st[ls+2],ns=ut[os>>>24]^ct[rs>>16&255]^dt[ss>>8&255]^pt[hs&255]^st[ls+3],rs=Zr,ss=Qr,hs=_i,os=ns,ls=ls+4;Zr=ot[rs>>>24]<<24^ot[ss>>16&255]<<16^ot[hs>>8&255]<<8^ot[os&255]^st[ls],Qr=ot[ss>>>24]<<24^ot[hs>>16&255]<<16^ot[os>>8&255]<<8^ot[rs&255]^st[ls+1],_i=ot[hs>>>24]<<24^ot[os>>16&255]<<16^ot[rs>>8&255]<<8^ot[ss&255]^st[ls+2],ns=ot[os>>>24]<<24^ot[rs>>16&255]<<16^ot[ss>>8&255]<<8^ot[hs&255]^st[ls+3],Xr[rt]=us(Zr^gt),Xr[rt+1]=us(ns^_r),Xr[rt+2]=us(_i^Yr),Xr[rt+3]=us(Qr^mt),gt=is,_r=cs,Yr=ps,mt=vs,rt=rt+4}return Xr.buffer}}const CHUNK_SIZE=16;class Decrypter{constructor(et,{removePKCS7Padding:rt=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=et.enableSoftwareAES,this.removePKCS7Padding=rt,rt)try{const nt=self.crypto;nt&&(this.subtle=nt.subtle||nt.webkitSubtle)}catch{}this.subtle===null&&(this.useSoftware=!0)}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:et,remainderData:rt}=this;if(!et||rt)return this.reset(),null;const nt=new Uint8Array(et);return this.reset(),this.removePKCS7Padding?removePadding(nt):nt}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(et,rt,nt){return this.useSoftware?new Promise((it,st)=>{this.softwareDecrypt(new Uint8Array(et),rt,nt);const ot=this.flush();ot?it(ot.buffer):st(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(et),rt,nt)}softwareDecrypt(et,rt,nt){const{currentIV:it,currentResult:st,remainderData:ot}=this;this.logOnce("JS AES decrypt"),ot&&(et=appendUint8Array(ot,et),this.remainderData=null);const lt=this.getValidChunk(et);if(!lt.length)return null;it&&(nt=it);let ut=this.softwareDecrypter;ut||(ut=this.softwareDecrypter=new AESDecryptor),ut.expandKey(rt);const ct=st;return this.currentResult=ut.decrypt(lt.buffer,0,nt),this.currentIV=sliceUint8(lt,-16).buffer,ct||null}webCryptoDecrypt(et,rt,nt){const it=this.subtle;return(this.key!==rt||!this.fastAesKey)&&(this.key=rt,this.fastAesKey=new FastAESKey(it,rt)),this.fastAesKey.expandKey().then(st=>it?(this.logOnce("WebCrypto AES decrypt"),new AESCrypto(it,new Uint8Array(nt)).decrypt(et.buffer,st)):Promise.reject(new Error("web crypto not initialized"))).catch(st=>(logger.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${st.name}: ${st.message}`),this.onWebCryptoError(et,rt,nt)))}onWebCryptoError(et,rt,nt){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(et,rt,nt);const it=this.flush();if(it)return it.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(et){let rt=et;const nt=et.length-et.length%CHUNK_SIZE;return nt!==et.length&&(rt=sliceUint8(et,0,nt),this.remainderData=sliceUint8(et,nt)),rt}logOnce(et){this.logEnabled&&(logger.log(`[decrypter]: ${et}`),this.logEnabled=!1)}}const TimeRanges={toString:function(tt){let et="";const rt=tt.length;for(let nt=0;nt<rt;nt++)et+=`[${tt.start(nt).toFixed(3)}-${tt.end(nt).toFixed(3)}]`;return et}},State={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class BaseStreamController extends TaskLoop{constructor(et,rt,nt,it,st){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=State.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=st,this.logPrefix=it,this.log=logger.log.bind(logger,`${it}:`),this.warn=logger.warn.bind(logger,`${it}:`),this.hls=et,this.fragmentLoader=new FragmentLoader(et.config),this.keyLoader=nt,this.fragmentTracker=rt,this.config=et.config,this.decrypter=new Decrypter(et.config),et.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(et){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const et=this.fragCurrent;et!=null&&et.loader&&(et.abortRequests(),this.fragmentTracker.removeFragment(et)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=State.STOPPED}_streamEnded(et,rt){if(rt.live||et.nextStart||!et.end||!this.media)return!1;const nt=rt.partList;if(nt!=null&&nt.length){const st=nt[nt.length-1];return BufferHelper.isBuffered(this.media,st.start+st.duration/2)}const it=rt.fragments[rt.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(it)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var et;return(et=this.levelLastLoaded)==null?void 0:et.details}}onMediaAttached(et,rt){const nt=this.media=this.mediaBuffer=rt.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),nt.addEventListener("seeking",this.onvseeking),nt.addEventListener("ended",this.onvended);const it=this.config;this.levels&&it.autoStartLoad&&this.state===State.STOPPED&&this.startLoad(it.startPosition)}onMediaDetaching(){const et=this.media;et!=null&&et.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),et&&this.onvseeking&&this.onvended&&(et.removeEventListener("seeking",this.onvseeking),et.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:et,fragCurrent:rt,media:nt,mediaBuffer:it,state:st}=this,ot=nt?nt.currentTime:0,lt=BufferHelper.bufferInfo(it||nt,ot,et.maxBufferHole);if(this.log(`media seeking to ${isFiniteNumber(ot)?ot.toFixed(3):ot}, state: ${st}`),this.state===State.ENDED)this.resetLoadingState();else if(rt){const ut=et.maxFragLookUpTolerance,ct=rt.start-ut,dt=rt.start+rt.duration+ut;if(!lt.len||dt<lt.start||ct>lt.end){const pt=ot>dt;(ot<ct||pt)&&(pt&&rt.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),rt.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}nt&&(this.fragmentTracker.removeFragmentsInRange(ot,1/0,this.playlistType,!0),this.lastCurrentTime=ot),!this.loadedmetadata&&!lt.len&&(this.nextLoadPosition=this.startPosition=ot),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(et,rt){this.startTimeOffset=rt.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.hls.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),this.stopLoad(),super.onHandlerDestroying(),this.hls=null}onHandlerDestroyed(){this.state=State.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(et,rt,nt){this._loadFragForPlayback(et,rt,nt)}_loadFragForPlayback(et,rt,nt){const it=st=>{if(this.fragContextChanged(et)){this.warn(`Fragment ${et.sn}${st.part?" p: "+st.part.index:""} of level ${et.level} was dropped during download.`),this.fragmentTracker.removeFragment(et);return}et.stats.chunkCount++,this._handleFragmentLoadProgress(st)};this._doFragLoad(et,rt,nt,it).then(st=>{if(!st)return;const ot=this.state;if(this.fragContextChanged(et)){(ot===State.FRAG_LOADING||!this.fragCurrent&&ot===State.PARSING)&&(this.fragmentTracker.removeFragment(et),this.state=State.IDLE);return}"payload"in st&&(this.log(`Loaded fragment ${et.sn} of level ${et.level}`),this.hls.trigger(Events.FRAG_LOADED,st)),this._handleFragmentLoadComplete(st)}).catch(st=>{this.state===State.STOPPED||this.state===State.ERROR||(this.warn(st),this.resetFragmentLoading(et))})}clearTrackerIfNeeded(et){var rt;const{fragmentTracker:nt}=this;if(nt.getState(et)===FragmentState.APPENDING){const st=et.type,ot=this.getFwdBufferInfo(this.mediaBuffer,st),lt=Math.max(et.duration,ot?ot.len:this.config.maxBufferLength);this.reduceMaxBufferLength(lt)&&nt.removeFragment(et)}else((rt=this.mediaBuffer)==null?void 0:rt.buffered.length)===0?nt.removeAllFragments():nt.hasParts(et.type)&&(nt.detectPartialFragments({frag:et,part:null,stats:et.stats,id:et.type}),nt.getState(et)===FragmentState.PARTIAL&&nt.removeFragment(et))}checkLiveUpdate(et){if(et.updated&&!et.live){const rt=et.fragments[et.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:rt,part:null,stats:rt.stats,id:rt.type})}et.fragments[0]||(et.deltaUpdateFailed=!0)}flushMainBuffer(et,rt,nt=null){if(!(et-rt))return;const it={startOffset:et,endOffset:rt,type:nt};this.hls.trigger(Events.BUFFER_FLUSHING,it)}_loadInitSegment(et,rt){this._doFragLoad(et,rt).then(nt=>{if(!nt||this.fragContextChanged(et)||!this.levels)throw new Error("init load aborted");return nt}).then(nt=>{const{hls:it}=this,{payload:st}=nt,ot=et.decryptdata;if(st&&st.byteLength>0&&ot!=null&&ot.key&&ot.iv&&ot.method==="AES-128"){const lt=self.performance.now();return this.decrypter.decrypt(new Uint8Array(st),ot.key.buffer,ot.iv.buffer).catch(ut=>{throw it.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!1,error:ut,reason:ut.message,frag:et}),ut}).then(ut=>{const ct=self.performance.now();return it.trigger(Events.FRAG_DECRYPTED,{frag:et,payload:ut,stats:{tstart:lt,tdecrypt:ct}}),nt.payload=ut,this.completeInitSegmentLoad(nt)})}return this.completeInitSegmentLoad(nt)}).catch(nt=>{this.state===State.STOPPED||this.state===State.ERROR||(this.warn(nt),this.resetFragmentLoading(et))})}completeInitSegmentLoad(et){const{levels:rt}=this;if(!rt)throw new Error("init load aborted, missing levels");const nt=et.frag.stats;this.state=State.IDLE,et.frag.data=new Uint8Array(et.payload),nt.parsing.start=nt.buffering.start=self.performance.now(),nt.parsing.end=nt.buffering.end=self.performance.now(),this.tick()}fragContextChanged(et){const{fragCurrent:rt}=this;return!et||!rt||et.sn!==rt.sn||et.level!==rt.level}fragBufferedComplete(et,rt){var nt,it,st,ot;const lt=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${et.type} sn: ${et.sn}${rt?" part: "+rt.index:""} of ${this.playlistType===PlaylistLevelType.MAIN?"level":"track"} ${et.level} (frag:[${((nt=et.startPTS)!=null?nt:NaN).toFixed(3)}-${((it=et.endPTS)!=null?it:NaN).toFixed(3)}] > buffer:${lt?TimeRanges.toString(BufferHelper.getBuffered(lt)):"(detached)"})`),et.sn!=="initSegment"){var ut;if(et.type!==PlaylistLevelType.SUBTITLE){const dt=et.elementaryStreams;if(!Object.keys(dt).some(pt=>!!dt[pt])){this.state=State.IDLE;return}}const ct=(ut=this.levels)==null?void 0:ut[et.level];ct!=null&&ct.fragmentError&&(this.log(`Resetting level fragment error count of ${ct.fragmentError} on frag buffered`),ct.fragmentError=0)}this.state=State.IDLE,lt&&(!this.loadedmetadata&&et.type==PlaylistLevelType.MAIN&&lt.buffered.length&&((st=this.fragCurrent)==null?void 0:st.sn)===((ot=this.fragPrevious)==null?void 0:ot.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(et){const{transmuxer:rt}=this;if(!rt)return;const{frag:nt,part:it,partsLoaded:st}=et,ot=!st||st.length===0||st.some(ut=>!ut),lt=new ChunkMetadata(nt.level,nt.sn,nt.stats.chunkCount+1,0,it?it.index:-1,!ot);rt.flush(lt)}_handleFragmentLoadProgress(et){}_doFragLoad(et,rt,nt=null,it){var st;const ot=rt==null?void 0:rt.details;if(!this.levels||!ot)throw new Error(`frag load aborted, missing level${ot?"":" detail"}s`);let lt=null;if(et.encrypted&&!((st=et.decryptdata)!=null&&st.key)?(this.log(`Loading key for ${et.sn} of [${ot.startSN}-${ot.endSN}], ${this.logPrefix==="[stream-controller]"?"level":"track"} ${et.level}`),this.state=State.KEY_LOADING,this.fragCurrent=et,lt=this.keyLoader.load(et).then(dt=>{if(!this.fragContextChanged(dt.frag))return this.hls.trigger(Events.KEY_LOADED,dt),this.state===State.KEY_LOADING&&(this.state=State.IDLE),dt}),this.hls.trigger(Events.KEY_LOADING,{frag:et}),this.fragCurrent===null&&(lt=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!et.encrypted&&ot.encryptedFragments.length&&this.keyLoader.loadClear(et,ot.encryptedFragments),nt=Math.max(et.start,nt||0),this.config.lowLatencyMode&&et.sn!=="initSegment"){const dt=ot.partList;if(dt&&it){nt>et.end&&ot.fragmentHint&&(et=ot.fragmentHint);const pt=this.getNextPart(dt,et,nt);if(pt>-1){const ft=dt[pt];this.log(`Loading part sn: ${et.sn} p: ${ft.index} cc: ${et.cc} of playlist [${ot.startSN}-${ot.endSN}] parts [0-${pt}-${dt.length-1}] ${this.logPrefix==="[stream-controller]"?"level":"track"}: ${et.level}, target: ${parseFloat(nt.toFixed(3))}`),this.nextLoadPosition=ft.start+ft.duration,this.state=State.FRAG_LOADING;let gt;return lt?gt=lt.then(_r=>!_r||this.fragContextChanged(_r.frag)?null:this.doFragPartsLoad(et,ft,rt,it)).catch(_r=>this.handleFragLoadError(_r)):gt=this.doFragPartsLoad(et,ft,rt,it).catch(_r=>this.handleFragLoadError(_r)),this.hls.trigger(Events.FRAG_LOADING,{frag:et,part:ft,targetBufferTime:nt}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):gt}else if(!et.url||this.loadedEndOfParts(dt,nt))return Promise.resolve(null)}}this.log(`Loading fragment ${et.sn} cc: ${et.cc} ${ot?"of ["+ot.startSN+"-"+ot.endSN+"] ":""}${this.logPrefix==="[stream-controller]"?"level":"track"}: ${et.level}, target: ${parseFloat(nt.toFixed(3))}`),isFiniteNumber(et.sn)&&!this.bitrateTest&&(this.nextLoadPosition=et.start+et.duration),this.state=State.FRAG_LOADING;const ut=this.config.progressive;let ct;return ut&&lt?ct=lt.then(dt=>!dt||this.fragContextChanged(dt==null?void 0:dt.frag)?null:this.fragmentLoader.load(et,it)).catch(dt=>this.handleFragLoadError(dt)):ct=Promise.all([this.fragmentLoader.load(et,ut?it:void 0),lt]).then(([dt])=>(!ut&&dt&&it&&it(dt),dt)).catch(dt=>this.handleFragLoadError(dt)),this.hls.trigger(Events.FRAG_LOADING,{frag:et,targetBufferTime:nt}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):ct}doFragPartsLoad(et,rt,nt,it){return new Promise((st,ot)=>{var lt;const ut=[],ct=(lt=nt.details)==null?void 0:lt.partList,dt=pt=>{this.fragmentLoader.loadPart(et,pt,it).then(ft=>{ut[pt.index]=ft;const gt=ft.part;this.hls.trigger(Events.FRAG_LOADED,ft);const _r=getPartWith(nt,et.sn,pt.index+1)||findPart(ct,et.sn,pt.index+1);if(_r)dt(_r);else return st({frag:et,part:gt,partsLoaded:ut})}).catch(ot)};dt(rt)})}handleFragLoadError(et){if("data"in et){const rt=et.data;et.data&&rt.details===ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(rt.frag,rt.part):this.hls.trigger(Events.ERROR,rt)}else this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,err:et,error:et,fatal:!0});return null}_handleTransmuxerFlush(et){const rt=this.getCurrentContext(et);if(!rt||this.state!==State.PARSING){!this.fragCurrent&&this.state!==State.STOPPED&&this.state!==State.ERROR&&(this.state=State.IDLE);return}const{frag:nt,part:it,level:st}=rt,ot=self.performance.now();nt.stats.parsing.end=ot,it&&(it.stats.parsing.end=ot),this.updateLevelTiming(nt,it,st,et.partial)}getCurrentContext(et){const{levels:rt,fragCurrent:nt}=this,{level:it,sn:st,part:ot}=et;if(!(rt!=null&&rt[it]))return this.warn(`Levels object was unset while buffering fragment ${st} of level ${it}. The current chunk will not be buffered.`),null;const lt=rt[it],ut=ot>-1?getPartWith(lt,st,ot):null,ct=ut?ut.fragment:getFragmentWithSN(lt,st,nt);return ct?(nt&&nt!==ct&&(ct.stats=nt.stats),{frag:ct,part:ut,level:lt}):null}bufferFragmentData(et,rt,nt,it,st){var ot;if(!et||this.state!==State.PARSING)return;const{data1:lt,data2:ut}=et;let ct=lt;if(lt&&ut&&(ct=appendUint8Array(lt,ut)),!((ot=ct)!=null&&ot.length))return;const dt={type:et.type,frag:rt,part:nt,chunkMeta:it,parent:rt.type,data:ct};if(this.hls.trigger(Events.BUFFER_APPENDING,dt),et.dropped&&et.independent&&!nt){if(st)return;this.flushBufferGap(rt)}}flushBufferGap(et){const rt=this.media;if(!rt)return;if(!BufferHelper.isBuffered(rt,rt.currentTime)){this.flushMainBuffer(0,et.start);return}const nt=rt.currentTime,it=BufferHelper.bufferInfo(rt,nt,0),st=et.duration,ot=Math.min(this.config.maxFragLookUpTolerance*2,st*.25),lt=Math.max(Math.min(et.start-ot,it.end-ot),nt+ot);et.start-lt>ot&&this.flushMainBuffer(lt,et.start)}getFwdBufferInfo(et,rt){const nt=this.getLoadPosition();return isFiniteNumber(nt)?this.getFwdBufferInfoAtPos(et,nt,rt):null}getFwdBufferInfoAtPos(et,rt,nt){const{config:{maxBufferHole:it}}=this,st=BufferHelper.bufferInfo(et,rt,it);if(st.len===0&&st.nextStart!==void 0){const ot=this.fragmentTracker.getBufferedFrag(rt,nt);if(ot&&st.nextStart<ot.end)return BufferHelper.bufferInfo(et,rt,Math.max(st.nextStart,it))}return st}getMaxBufferLength(et){const{config:rt}=this;let nt;return et?nt=Math.max(8*rt.maxBufferSize/et,rt.maxBufferLength):nt=rt.maxBufferLength,Math.min(nt,rt.maxMaxBufferLength)}reduceMaxBufferLength(et){const rt=this.config,nt=et||rt.maxBufferLength;return rt.maxMaxBufferLength>=nt?(rt.maxMaxBufferLength/=2,this.warn(`Reduce max buffer length to ${rt.maxMaxBufferLength}s`),!0):!1}getAppendedFrag(et,rt=PlaylistLevelType.MAIN){const nt=this.fragmentTracker.getAppendedFrag(et,PlaylistLevelType.MAIN);return nt&&"fragment"in nt?nt.fragment:nt}getNextFragment(et,rt){const nt=rt.fragments,it=nt.length;if(!it)return null;const{config:st}=this,ot=nt[0].start;let lt;if(rt.live){const ut=st.initialLiveManifestSize;if(it<ut)return this.warn(`Not enough fragments to start playback (have: ${it}, need: ${ut})`),null;(!rt.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||et<ot)&&(lt=this.getInitialLiveFragment(rt,nt),this.startPosition=this.nextLoadPosition=lt?this.hls.liveSyncPosition||lt.start:et)}else et<=ot&&(lt=nt[0]);if(!lt){const ut=st.lowLatencyMode?rt.partEnd:rt.fragmentEnd;lt=this.getFragmentAtPosition(et,ut,rt)}return this.mapToInitFragWhenRequired(lt)}isLoopLoading(et,rt){const nt=this.fragmentTracker.getState(et);return(nt===FragmentState.OK||nt===FragmentState.PARTIAL&&!!et.gap)&&this.nextLoadPosition>rt}getNextFragmentLoopLoading(et,rt,nt,it,st){const ot=et.gap,lt=this.getNextFragment(this.nextLoadPosition,rt);if(lt===null)return lt;if(et=lt,ot&&et&&!et.gap&&nt.nextStart){const ut=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,nt.nextStart,it);if(ut!==null&&nt.len+ut.len>=st)return this.log(`buffer full after gaps in "${it}" playlist starting at sn: ${et.sn}`),null}return et}mapToInitFragWhenRequired(et){return et!=null&&et.initSegment&&!(et!=null&&et.initSegment.data)&&!this.bitrateTest?et.initSegment:et}getNextPart(et,rt,nt){let it=-1,st=!1,ot=!0;for(let lt=0,ut=et.length;lt<ut;lt++){const ct=et[lt];if(ot=ot&&!ct.independent,it>-1&&nt<ct.start)break;const dt=ct.loaded;dt?it=-1:(st||ct.independent||ot)&&ct.fragment===rt&&(it=lt),st=dt}return it}loadedEndOfParts(et,rt){const nt=et[et.length-1];return nt&&rt>nt.start&&nt.loaded}getInitialLiveFragment(et,rt){const nt=this.fragPrevious;let it=null;if(nt){if(et.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${nt.programDateTime}`),it=findFragmentByPDT(rt,nt.endProgramDateTime,this.config.maxFragLookUpTolerance)),!it){const st=nt.sn+1;if(st>=et.startSN&&st<=et.endSN){const ot=rt[st-et.startSN];nt.cc===ot.cc&&(it=ot,this.log(`Live playlist, switching playlist, load frag with next SN: ${it.sn}`))}it||(it=findFragWithCC(rt,nt.cc),it&&this.log(`Live playlist, switching playlist, load frag with same CC: ${it.sn}`))}}else{const st=this.hls.liveSyncPosition;st!==null&&(it=this.getFragmentAtPosition(st,this.bitrateTest?et.fragmentEnd:et.edge,et))}return it}getFragmentAtPosition(et,rt,nt){const{config:it}=this;let{fragPrevious:st}=this,{fragments:ot,endSN:lt}=nt;const{fragmentHint:ut}=nt,ct=it.maxFragLookUpTolerance,dt=nt.partList,pt=!!(it.lowLatencyMode&&dt!=null&&dt.length&&ut);pt&&ut&&!this.bitrateTest&&(ot=ot.concat(ut),lt=ut.sn);let ft;if(et<rt){const gt=et>rt-ct?0:ct;ft=findFragmentByPTS(st,ot,et,gt)}else ft=ot[ot.length-1];if(ft){const gt=ft.sn-nt.startSN,_r=this.fragmentTracker.getState(ft);if((_r===FragmentState.OK||_r===FragmentState.PARTIAL&&ft.gap)&&(st=ft),st&&ft.sn===st.sn&&(!pt||dt[0].fragment.sn>ft.sn)&&st&&ft.level===st.level){const mt=ot[gt+1];ft.sn<lt&&this.fragmentTracker.getState(mt)!==FragmentState.OK?ft=mt:ft=null}}return ft}synchronizeToLiveEdge(et){const{config:rt,media:nt}=this;if(!nt)return;const it=this.hls.liveSyncPosition,st=nt.currentTime,ot=et.fragments[0].start,lt=et.edge,ut=st>=ot-rt.maxFragLookUpTolerance&&st<=lt;if(it!==null&&nt.duration>it&&(st<it||!ut)){const ct=rt.liveMaxLatencyDuration!==void 0?rt.liveMaxLatencyDuration:rt.liveMaxLatencyDurationCount*et.targetduration;(!ut&&nt.readyState<4||st<lt-ct)&&(this.loadedmetadata||(this.nextLoadPosition=it),nt.readyState&&(this.warn(`Playback: ${st.toFixed(3)} is located too far from the end of live sliding playlist: ${lt}, reset currentTime to : ${it.toFixed(3)}`),nt.currentTime=it))}}alignPlaylists(et,rt,nt){const it=et.fragments.length;if(!it)return this.warn("No fragments in live playlist"),0;const st=et.fragments[0].start,ot=!rt,lt=et.alignedSliding&&isFiniteNumber(st);if(ot||!lt&&!st){const{fragPrevious:ut}=this;alignStream(ut,nt,et);const ct=et.fragments[0].start;return this.log(`Live playlist sliding: ${ct.toFixed(2)} start-sn: ${rt?rt.startSN:"na"}->${et.startSN} prev-sn: ${ut?ut.sn:"na"} fragments: ${it}`),ct}return st}waitForCdnTuneIn(et){return et.live&&et.canBlockReload&&et.partTarget&&et.tuneInGoal>Math.max(et.partHoldBack,et.partTarget*3)}setStartPosition(et,rt){let nt=this.startPosition;if(nt<rt&&(nt=-1),nt===-1||this.lastCurrentTime===-1){const it=this.startTimeOffset!==null,st=it?this.startTimeOffset:et.startTimeOffset;st!==null&&isFiniteNumber(st)?(nt=rt+st,st<0&&(nt+=et.totalduration),nt=Math.min(Math.max(rt,nt),rt+et.totalduration),this.log(`Start time offset ${st} found in ${it?"multivariant":"media"} playlist, adjust startPosition to ${nt}`),this.startPosition=nt):et.live?nt=this.hls.liveSyncPosition||rt:this.startPosition=nt=0,this.lastCurrentTime=nt}this.nextLoadPosition=nt}getLoadPosition(){const{media:et}=this;let rt=0;return this.loadedmetadata&&et?rt=et.currentTime:this.nextLoadPosition&&(rt=this.nextLoadPosition),rt}handleFragLoadAborted(et,rt){this.transmuxer&&et.sn!=="initSegment"&&et.stats.aborted&&(this.warn(`Fragment ${et.sn}${rt?" part "+rt.index:""} of level ${et.level} was aborted`),this.resetFragmentLoading(et))}resetFragmentLoading(et){(!this.fragCurrent||!this.fragContextChanged(et)&&this.state!==State.FRAG_LOADING_WAITING_RETRY)&&(this.state=State.IDLE)}onFragmentOrKeyLoadError(et,rt){if(rt.chunkMeta&&!rt.frag){const dt=this.getCurrentContext(rt.chunkMeta);dt&&(rt.frag=dt.frag)}const nt=rt.frag;if(!nt||nt.type!==et||!this.levels)return;if(this.fragContextChanged(nt)){var it;this.warn(`Frag load error must match current frag to retry ${nt.url} > ${(it=this.fragCurrent)==null?void 0:it.url}`);return}const st=rt.details===ErrorDetails.FRAG_GAP;st&&this.fragmentTracker.fragBuffered(nt,!0);const ot=rt.errorAction,{action:lt,retryCount:ut=0,retryConfig:ct}=ot||{};if(ot&&lt===NetworkErrorAction.RetryRequest&&ct){this.resetStartWhenNotLoaded(this.levelLastLoaded);const dt=getRetryDelay(ct,ut);this.warn(`Fragment ${nt.sn} of ${et} ${nt.level} errored with ${rt.details}, retrying loading ${ut+1}/${ct.maxNumRetry} in ${dt}ms`),ot.resolved=!0,this.retryDate=self.performance.now()+dt,this.state=State.FRAG_LOADING_WAITING_RETRY}else if(ct&&ot)if(this.resetFragmentErrors(et),ut<ct.maxNumRetry)!st&&lt!==NetworkErrorAction.RemoveAlternatePermanently&&(ot.resolved=!0);else{logger.warn(`${rt.details} reached or exceeded max retry (${ut})`);return}else(ot==null?void 0:ot.action)===NetworkErrorAction.SendAlternateToPenaltyBox?this.state=State.WAITING_LEVEL:this.state=State.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(et){if(this.state===State.PARSING||this.state===State.PARSED){const rt=et.parent,nt=this.getFwdBufferInfo(this.mediaBuffer,rt),it=nt&&nt.len>.5;it&&this.reduceMaxBufferLength(nt.len);const st=!it;return st&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${rt} buffer`),et.frag&&(this.fragmentTracker.removeFragment(et.frag),this.nextLoadPosition=et.frag.start),this.resetLoadingState(),st}return!1}resetFragmentErrors(et){et===PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==State.STOPPED&&(this.state=State.IDLE)}afterBufferFlushed(et,rt,nt){if(!et)return;const it=BufferHelper.getBuffered(et);this.fragmentTracker.detectEvictedFragments(rt,it,nt),this.state===State.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=State.IDLE}resetStartWhenNotLoaded(et){if(!this.loadedmetadata){this.startFragRequested=!1;const rt=et?et.details:null;rt!=null&&rt.live?(this.startPosition=-1,this.setStartPosition(rt,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(et){this.warn(`The loading context changed while buffering fragment ${et.sn} of level ${et.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(et=0){this.fragmentTracker.removeFragmentsInRange(et,1/0,this.playlistType,!1,!0)}updateLevelTiming(et,rt,nt,it){var st;const ot=nt.details;if(!ot){this.warn("level.details undefined");return}if(!Object.keys(et.elementaryStreams).reduce((ut,ct)=>{const dt=et.elementaryStreams[ct];if(dt){const pt=dt.endPTS-dt.startPTS;if(pt<=0)return this.warn(`Could not parse fragment ${et.sn} ${ct} duration reliably (${pt})`),ut||!1;const ft=it?0:updateFragPTSDTS(ot,et,dt.startPTS,dt.endPTS,dt.startDTS,dt.endDTS);return this.hls.trigger(Events.LEVEL_PTS_UPDATED,{details:ot,level:nt,drift:ft,type:ct,frag:et,start:dt.startPTS,end:dt.endPTS}),!0}return ut},!1)&&((st=this.transmuxer)==null?void 0:st.error)===null){const ut=new Error(`Found no media in fragment ${et.sn} of level ${et.level} resetting transmuxer to fallback to playlist timing`);if(nt.fragmentError===0&&(nt.fragmentError++,et.gap=!0,this.fragmentTracker.removeFragment(et),this.fragmentTracker.fragBuffered(et,!0)),this.warn(ut.message),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:ut,frag:et,reason:`Found no media in msn ${et.sn} of level "${nt.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=State.PARSED,this.hls.trigger(Events.FRAG_PARSED,{frag:et,part:rt})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(et){et.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(et){const rt=this._state;rt!==et&&(this._state=et,this.log(`${rt}->${et}`))}get state(){return this._state}}class ChunkCache{constructor(){this.chunks=[],this.dataLength=0}push(et){this.chunks.push(et),this.dataLength+=et.length}flush(){const{chunks:et,dataLength:rt}=this;let nt;if(et.length)et.length===1?nt=et[0]:nt=concatUint8Arrays(et,rt);else return new Uint8Array(0);return this.reset(),nt}reset(){this.chunks.length=0,this.dataLength=0}}function concatUint8Arrays(tt,et){const rt=new Uint8Array(et);let nt=0;for(let it=0;it<tt.length;it++){const st=tt[it];rt.set(st,nt),nt+=st.length}return rt}function hasUMDWorker(){return typeof __HLS_WORKER_BUNDLE__=="function"}function injectWorker(){const tt=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),et=self.URL.createObjectURL(tt);return{worker:new self.Worker(et),objectURL:et}}function loadWorker(tt){const et=new self.URL(tt,self.location.href).href;return{worker:new self.Worker(et),scriptURL:et}}function dummyTrack(tt="",et=9e4){return{type:tt,id:-1,pid:-1,inputTimeScale:et,sequenceNumber:-1,samples:[],dropped:0}}class BaseAudioDemuxer{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(et,rt,nt,it){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(et){this.initPTS=et,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(et,rt){return!1}appendFrame(et,rt,nt){}demux(et,rt){this.cachedData&&(et=appendUint8Array(this.cachedData,et),this.cachedData=null);let nt=getID3Data(et,0),it=nt?nt.length:0,st;const ot=this._audioTrack,lt=this._id3Track,ut=nt?getTimeStamp(nt):void 0,ct=et.length;for((this.basePTS===null||this.frameIndex===0&&isFiniteNumber(ut))&&(this.basePTS=initPTSFn(ut,rt,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),nt&&nt.length>0&&lt.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:nt,type:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});it<ct;){if(this.canParse(et,it)){const dt=this.appendFrame(ot,et,it);dt?(this.frameIndex++,this.lastPTS=dt.sample.pts,it+=dt.length,st=it):it=ct}else canParse$2(et,it)?(nt=getID3Data(et,it),lt.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:nt,type:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),it+=nt.length,st=it):it++;if(it===ct&&st!==ct){const dt=sliceUint8(et,st);this.cachedData?this.cachedData=appendUint8Array(this.cachedData,dt):this.cachedData=dt}}return{audioTrack:ot,videoTrack:dummyTrack(),id3Track:lt,textTrack:dummyTrack()}}demuxSampleAes(et,rt,nt){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(et){const rt=this.cachedData;return rt&&(this.cachedData=null,this.demux(rt,0)),{audioTrack:this._audioTrack,videoTrack:dummyTrack(),id3Track:this._id3Track,textTrack:dummyTrack()}}destroy(){}}const initPTSFn=(tt,et,rt)=>{if(isFiniteNumber(tt))return tt*90;const nt=rt?rt.baseTime*9e4/rt.timescale:0;return et*9e4+nt};function getAudioConfig(tt,et,rt,nt){let it,st,ot,lt;const ut=navigator.userAgent.toLowerCase(),ct=nt,dt=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];it=((et[rt+2]&192)>>>6)+1;const pt=(et[rt+2]&60)>>>2;if(pt>dt.length-1){const ft=new Error(`invalid ADTS sampling index:${pt}`);tt.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,error:ft,reason:ft.message});return}return ot=(et[rt+2]&1)<<2,ot|=(et[rt+3]&192)>>>6,logger.log(`manifest codec:${nt}, ADTS type:${it}, samplingIndex:${pt}`),/firefox/i.test(ut)?pt>=6?(it=5,lt=new Array(4),st=pt-3):(it=2,lt=new Array(2),st=pt):ut.indexOf("android")!==-1?(it=2,lt=new Array(2),st=pt):(it=5,lt=new Array(4),nt&&(nt.indexOf("mp4a.40.29")!==-1||nt.indexOf("mp4a.40.5")!==-1)||!nt&&pt>=6?st=pt-3:((nt&&nt.indexOf("mp4a.40.2")!==-1&&(pt>=6&&ot===1||/vivaldi/i.test(ut))||!nt&&ot===1)&&(it=2,lt=new Array(2)),st=pt)),lt[0]=it<<3,lt[0]|=(pt&14)>>1,lt[1]|=(pt&1)<<7,lt[1]|=ot<<3,it===5&&(lt[1]|=(st&14)>>1,lt[2]=(st&1)<<7,lt[2]|=8,lt[3]=0),{config:lt,samplerate:dt[pt],channelCount:ot,codec:"mp4a.40."+it,manifestCodec:ct}}function isHeaderPattern$1(tt,et){return tt[et]===255&&(tt[et+1]&246)===240}function getHeaderLength(tt,et){return tt[et+1]&1?7:9}function getFullFrameLength(tt,et){return(tt[et+3]&3)<<11|tt[et+4]<<3|(tt[et+5]&224)>>>5}function canGetFrameLength(tt,et){return et+5<tt.length}function isHeader$1(tt,et){return et+1<tt.length&&isHeaderPattern$1(tt,et)}function canParse$1(tt,et){return canGetFrameLength(tt,et)&&isHeaderPattern$1(tt,et)&&getFullFrameLength(tt,et)<=tt.length-et}function probe$1(tt,et){if(isHeader$1(tt,et)){const rt=getHeaderLength(tt,et);if(et+rt>=tt.length)return!1;const nt=getFullFrameLength(tt,et);if(nt<=rt)return!1;const it=et+nt;return it===tt.length||isHeader$1(tt,it)}return!1}function initTrackConfig(tt,et,rt,nt,it){if(!tt.samplerate){const st=getAudioConfig(et,rt,nt,it);if(!st)return;tt.config=st.config,tt.samplerate=st.samplerate,tt.channelCount=st.channelCount,tt.codec=st.codec,tt.manifestCodec=st.manifestCodec,logger.log(`parsed codec:${tt.codec}, rate:${st.samplerate}, channels:${st.channelCount}`)}}function getFrameDuration(tt){return 1024*9e4/tt}function parseFrameHeader(tt,et){const rt=getHeaderLength(tt,et);if(et+rt<=tt.length){const nt=getFullFrameLength(tt,et)-rt;if(nt>0)return{headerLength:rt,frameLength:nt}}}function appendFrame$2(tt,et,rt,nt,it){const st=getFrameDuration(tt.samplerate),ot=nt+it*st,lt=parseFrameHeader(et,rt);let ut;if(lt){const{frameLength:pt,headerLength:ft}=lt,gt=ft+pt,_r=Math.max(0,rt+gt-et.length);_r?(ut=new Uint8Array(gt-ft),ut.set(et.subarray(rt+ft,et.length),0)):ut=et.subarray(rt+ft,rt+gt);const Yr={unit:ut,pts:ot};return _r||tt.samples.push(Yr),{sample:Yr,length:gt,missing:_r}}const ct=et.length-rt;return ut=new Uint8Array(ct),ut.set(et.subarray(rt,et.length),0),{sample:{unit:ut,pts:ot},length:ct,missing:-1}}let chromeVersion$1=null;const BitratesMap=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot=[0,1,1,4];function appendFrame$1(tt,et,rt,nt,it){if(rt+24>et.length)return;const st=parseHeader(et,rt);if(st&&rt+st.frameLength<=et.length){const ot=st.samplesPerFrame*9e4/st.sampleRate,lt=nt+it*ot,ut={unit:et.subarray(rt,rt+st.frameLength),pts:lt,dts:lt};return tt.config=[],tt.channelCount=st.channelCount,tt.samplerate=st.sampleRate,tt.samples.push(ut),{sample:ut,length:st.frameLength,missing:0}}}function parseHeader(tt,et){const rt=tt[et+1]>>3&3,nt=tt[et+1]>>1&3,it=tt[et+2]>>4&15,st=tt[et+2]>>2&3;if(rt!==1&&it!==0&&it!==15&&st!==3){const ot=tt[et+2]>>1&1,lt=tt[et+3]>>6,ut=rt===3?3-nt:nt===3?3:4,ct=BitratesMap[ut*14+it-1]*1e3,pt=SamplingRateMap[(rt===3?0:rt===2?1:2)*3+st],ft=lt===3?1:2,gt=SamplesCoefficients[rt][nt],_r=BytesInSlot[nt],Yr=gt*8*_r,mt=Math.floor(gt*ct/pt+ot)*_r;if(chromeVersion$1===null){const Zr=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);chromeVersion$1=Zr?parseInt(Zr[1]):0}return!!chromeVersion$1&&chromeVersion$1<=87&&nt===2&&ct>=224e3&&lt===0&&(tt[et+3]=tt[et+3]|128),{sampleRate:pt,channelCount:ft,frameLength:mt,samplesPerFrame:Yr}}}function isHeaderPattern(tt,et){return tt[et]===255&&(tt[et+1]&224)===224&&(tt[et+1]&6)!==0}function isHeader(tt,et){return et+1<tt.length&&isHeaderPattern(tt,et)}function canParse(tt,et){return isHeaderPattern(tt,et)&&4<=tt.length-et}function probe(tt,et){if(et+1<tt.length&&isHeaderPattern(tt,et)){const nt=parseHeader(tt,et);let it=4;nt!=null&&nt.frameLength&&(it=nt.frameLength);const st=et+it;return st===tt.length||isHeader(tt,st)}return!1}class AACDemuxer extends BaseAudioDemuxer{constructor(et,rt){super(),this.observer=void 0,this.config=void 0,this.observer=et,this.config=rt}resetInitSegment(et,rt,nt,it){super.resetInitSegment(et,rt,nt,it),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:rt,duration:it,inputTimeScale:9e4,dropped:0}}static probe(et){if(!et)return!1;const rt=getID3Data(et,0);let nt=(rt==null?void 0:rt.length)||0;if(probe(et,nt))return!1;for(let it=et.length;nt<it;nt++)if(probe$1(et,nt))return logger.log("ADTS sync word found !"),!0;return!1}canParse(et,rt){return canParse$1(et,rt)}appendFrame(et,rt,nt){initTrackConfig(et,this.observer,rt,nt,et.manifestCodec);const it=appendFrame$2(et,rt,nt,this.basePTS,this.frameIndex);if(it&&it.missing===0)return it}}const emsgSchemePattern=/\/emsg[-/]ID3/i;class MP4Demuxer{constructor(et,rt){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=rt}resetTimeStamp(){}resetInitSegment(et,rt,nt,it){const st=this.videoTrack=dummyTrack("video",1),ot=this.audioTrack=dummyTrack("audio",1),lt=this.txtTrack=dummyTrack("text",1);if(this.id3Track=dummyTrack("id3",1),this.timeOffset=0,!(et!=null&&et.byteLength))return;const ut=parseInitSegment(et);if(ut.video){const{id:ct,timescale:dt,codec:pt}=ut.video;st.id=ct,st.timescale=lt.timescale=dt,st.codec=pt}if(ut.audio){const{id:ct,timescale:dt,codec:pt}=ut.audio;ot.id=ct,ot.timescale=dt,ot.codec=pt}lt.id=RemuxerTrackIdConfig.text,st.sampleDuration=0,st.duration=ot.duration=it}resetContiguity(){this.remainderData=null}static probe(et){return hasMoofData(et)}demux(et,rt){this.timeOffset=rt;let nt=et;const it=this.videoTrack,st=this.txtTrack;if(this.config.progressive){this.remainderData&&(nt=appendUint8Array(this.remainderData,et));const lt=segmentValidRange(nt);this.remainderData=lt.remainder,it.samples=lt.valid||new Uint8Array}else it.samples=nt;const ot=this.extractID3Track(it,rt);return st.samples=parseSamples(rt,it),{videoTrack:it,audioTrack:this.audioTrack,id3Track:ot,textTrack:this.txtTrack}}flush(){const et=this.timeOffset,rt=this.videoTrack,nt=this.txtTrack;rt.samples=this.remainderData||new Uint8Array,this.remainderData=null;const it=this.extractID3Track(rt,this.timeOffset);return nt.samples=parseSamples(et,rt),{videoTrack:rt,audioTrack:dummyTrack(),id3Track:it,textTrack:dummyTrack()}}extractID3Track(et,rt){const nt=this.id3Track;if(et.samples.length){const it=findBox(et.samples,["emsg"]);it&&it.forEach(st=>{const ot=parseEmsg(st);if(emsgSchemePattern.test(ot.schemeIdUri)){const lt=isFiniteNumber(ot.presentationTime)?ot.presentationTime/ot.timeScale:rt+ot.presentationTimeDelta/ot.timeScale;let ut=ot.eventDuration===4294967295?Number.POSITIVE_INFINITY:ot.eventDuration/ot.timeScale;ut<=.001&&(ut=Number.POSITIVE_INFINITY);const ct=ot.payload;nt.samples.push({data:ct,len:ct.byteLength,dts:lt,pts:lt,type:MetadataSchema.emsg,duration:ut})}})}return nt}demuxSampleAes(et,rt,nt){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}}const getAudioBSID=(tt,et)=>{let rt=0,nt=5;et+=nt;const it=new Uint32Array(1),st=new Uint32Array(1),ot=new Uint8Array(1);for(;nt>0;){ot[0]=tt[et];const lt=Math.min(nt,8),ut=8-lt;st[0]=4278190080>>>24+ut<<ut,it[0]=(ot[0]&st[0])>>ut,rt=rt?rt<<lt|it[0]:it[0],et+=1,nt-=lt}return rt};class AC3Demuxer extends BaseAudioDemuxer{constructor(et){super(),this.observer=void 0,this.observer=et}resetInitSegment(et,rt,nt,it){super.resetInitSegment(et,rt,nt,it),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:rt,duration:it,inputTimeScale:9e4,dropped:0}}canParse(et,rt){return rt+64<et.length}appendFrame(et,rt,nt){const it=appendFrame(et,rt,nt,this.basePTS,this.frameIndex);if(it!==-1)return{sample:et.samples[et.samples.length-1],length:it,missing:0}}static probe(et){if(!et)return!1;const rt=getID3Data(et,0);if(!rt)return!1;const nt=rt.length;return et[nt]===11&&et[nt+1]===119&&getTimeStamp(rt)!==void 0&&getAudioBSID(et,nt)<16}}function appendFrame(tt,et,rt,nt,it){if(rt+8>et.length||et[rt]!==11||et[rt+1]!==119)return-1;const st=et[rt+4]>>6;if(st>=3)return-1;const lt=[48e3,44100,32e3][st],ut=et[rt+4]&63,dt=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][ut*3+st]*2;if(rt+dt>et.length)return-1;const pt=et[rt+6]>>5;let ft=0;pt===2?ft+=2:(pt&1&&pt!==1&&(ft+=2),pt&4&&(ft+=2));const gt=(et[rt+6]<<8|et[rt+7])>>12-ft&1,Yr=[2,1,2,3,3,4,4,5][pt]+gt,mt=et[rt+5]>>3,Kr=et[rt+5]&7,Xr=new Uint8Array([st<<6|mt<<1|Kr>>2,(Kr&3)<<6|pt<<3|gt<<2|ut>>4,ut<<4&224]),Zr=1536/lt*9e4,Qr=nt+it*Zr,_i=et.subarray(rt,rt+dt);return tt.config=Xr,tt.channelCount=Yr,tt.samplerate=lt,tt.samples.push({unit:_i,pts:Qr}),dt}class BaseVideoParser{constructor(){this.VideoSample=null}createVideoSample(et,rt,nt,it){return{key:et,frame:!1,pts:rt,dts:nt,units:[],debug:it,length:0}}getLastNalUnit(et){var rt;let nt=this.VideoSample,it;if((!nt||nt.units.length===0)&&(nt=et[et.length-1]),(rt=nt)!=null&&rt.units){const st=nt.units;it=st[st.length-1]}return it}pushAccessUnit(et,rt){if(et.units.length&&et.frame){if(et.pts===void 0){const nt=rt.samples,it=nt.length;if(it){const st=nt[it-1];et.pts=st.pts,et.dts=st.dts}else{rt.dropped++;return}}rt.samples.push(et)}et.debug.length&&logger.log(et.pts+"/"+et.dts+":"+et.debug)}}class ExpGolomb{constructor(et){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=et,this.bytesAvailable=et.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const et=this.data,rt=this.bytesAvailable,nt=et.byteLength-rt,it=new Uint8Array(4),st=Math.min(4,rt);if(st===0)throw new Error("no bytes available");it.set(et.subarray(nt,nt+st)),this.word=new DataView(it.buffer).getUint32(0),this.bitsAvailable=st*8,this.bytesAvailable-=st}skipBits(et){let rt;et=Math.min(et,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>et?(this.word<<=et,this.bitsAvailable-=et):(et-=this.bitsAvailable,rt=et>>3,et-=rt<<3,this.bytesAvailable-=rt,this.loadWord(),this.word<<=et,this.bitsAvailable-=et)}readBits(et){let rt=Math.min(this.bitsAvailable,et);const nt=this.word>>>32-rt;if(et>32&&logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=rt,this.bitsAvailable>0)this.word<<=rt;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return rt=et-rt,rt>0&&this.bitsAvailable?nt<<rt|this.readBits(rt):nt}skipLZ(){let et;for(et=0;et<this.bitsAvailable;++et)if(this.word&2147483648>>>et)return this.word<<=et,this.bitsAvailable-=et,et;return this.loadWord(),et+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const et=this.skipLZ();return this.readBits(et+1)-1}readEG(){const et=this.readUEG();return 1&et?1+et>>>1:-1*(et>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(et){let rt=8,nt=8,it;for(let st=0;st<et;st++)nt!==0&&(it=this.readEG(),nt=(rt+it+256)%256),rt=nt===0?rt:nt}readSPS(){let et=0,rt=0,nt=0,it=0,st,ot,lt;const ut=this.readUByte.bind(this),ct=this.readBits.bind(this),dt=this.readUEG.bind(this),pt=this.readBoolean.bind(this),ft=this.skipBits.bind(this),gt=this.skipEG.bind(this),_r=this.skipUEG.bind(this),Yr=this.skipScalingList.bind(this);ut();const mt=ut();if(ct(5),ft(3),ut(),_r(),mt===100||mt===110||mt===122||mt===244||mt===44||mt===83||mt===86||mt===118||mt===128){const ns=dt();if(ns===3&&ft(1),_r(),_r(),ft(1),pt())for(ot=ns!==3?8:12,lt=0;lt<ot;lt++)pt()&&(lt<6?Yr(16):Yr(64))}_r();const Kr=dt();if(Kr===0)dt();else if(Kr===1)for(ft(1),gt(),gt(),st=dt(),lt=0;lt<st;lt++)gt();_r(),ft(1);const Xr=dt(),Zr=dt(),Qr=ct(1);Qr===0&&ft(1),ft(1),pt()&&(et=dt(),rt=dt(),nt=dt(),it=dt());let _i=[1,1];if(pt()&&pt())switch(ut()){case 1:_i=[1,1];break;case 2:_i=[12,11];break;case 3:_i=[10,11];break;case 4:_i=[16,11];break;case 5:_i=[40,33];break;case 6:_i=[24,11];break;case 7:_i=[20,11];break;case 8:_i=[32,11];break;case 9:_i=[80,33];break;case 10:_i=[18,11];break;case 11:_i=[15,11];break;case 12:_i=[64,33];break;case 13:_i=[160,99];break;case 14:_i=[4,3];break;case 15:_i=[3,2];break;case 16:_i=[2,1];break;case 255:{_i=[ut()<<8|ut(),ut()<<8|ut()];break}}return{width:Math.ceil((Xr+1)*16-et*2-rt*2),height:(2-Qr)*(Zr+1)*16-(Qr?2:4)*(nt+it),pixelRatio:_i}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class AvcVideoParser extends BaseVideoParser{parseAVCPES(et,rt,nt,it,st){const ot=this.parseAVCNALu(et,nt.data);let lt=this.VideoSample,ut,ct=!1;nt.data=null,lt&&ot.length&&!et.audFound&&(this.pushAccessUnit(lt,et),lt=this.VideoSample=this.createVideoSample(!1,nt.pts,nt.dts,"")),ot.forEach(dt=>{var pt;switch(dt.type){case 1:{let Yr=!1;ut=!0;const mt=dt.data;if(ct&&mt.length>4){const Kr=new ExpGolomb(mt).readSliceType();(Kr===2||Kr===4||Kr===7||Kr===9)&&(Yr=!0)}if(Yr){var ft;(ft=lt)!=null&&ft.frame&&!lt.key&&(this.pushAccessUnit(lt,et),lt=this.VideoSample=null)}lt||(lt=this.VideoSample=this.createVideoSample(!0,nt.pts,nt.dts,"")),lt.frame=!0,lt.key=Yr;break}case 5:ut=!0,(pt=lt)!=null&&pt.frame&&!lt.key&&(this.pushAccessUnit(lt,et),lt=this.VideoSample=null),lt||(lt=this.VideoSample=this.createVideoSample(!0,nt.pts,nt.dts,"")),lt.key=!0,lt.frame=!0;break;case 6:{ut=!0,parseSEIMessageFromNALu(dt.data,1,nt.pts,rt.samples);break}case 7:{var gt,_r;ut=!0,ct=!0;const Yr=dt.data,Kr=new ExpGolomb(Yr).readSPS();if(!et.sps||et.width!==Kr.width||et.height!==Kr.height||((gt=et.pixelRatio)==null?void 0:gt[0])!==Kr.pixelRatio[0]||((_r=et.pixelRatio)==null?void 0:_r[1])!==Kr.pixelRatio[1]){et.width=Kr.width,et.height=Kr.height,et.pixelRatio=Kr.pixelRatio,et.sps=[Yr],et.duration=st;const Xr=Yr.subarray(1,4);let Zr="avc1.";for(let Qr=0;Qr<3;Qr++){let _i=Xr[Qr].toString(16);_i.length<2&&(_i="0"+_i),Zr+=_i}et.codec=Zr}break}case 8:ut=!0,et.pps=[dt.data];break;case 9:ut=!0,et.audFound=!0,lt&&this.pushAccessUnit(lt,et),lt=this.VideoSample=this.createVideoSample(!1,nt.pts,nt.dts,"");break;case 12:ut=!0;break;default:ut=!1,lt&&(lt.debug+="unknown NAL "+dt.type+" ");break}lt&&ut&&lt.units.push(dt)}),it&&lt&&(this.pushAccessUnit(lt,et),this.VideoSample=null)}parseAVCNALu(et,rt){const nt=rt.byteLength;let it=et.naluState||0;const st=it,ot=[];let lt=0,ut,ct,dt,pt=-1,ft=0;for(it===-1&&(pt=0,ft=rt[0]&31,it=0,lt=1);lt<nt;){if(ut=rt[lt++],!it){it=ut?0:1;continue}if(it===1){it=ut?0:2;continue}if(!ut)it=3;else if(ut===1){if(ct=lt-it-1,pt>=0){const gt={data:rt.subarray(pt,ct),type:ft};ot.push(gt)}else{const gt=this.getLastNalUnit(et.samples);gt&&(st&&lt<=4-st&&gt.state&&(gt.data=gt.data.subarray(0,gt.data.byteLength-st)),ct>0&&(gt.data=appendUint8Array(gt.data,rt.subarray(0,ct)),gt.state=0))}lt<nt?(dt=rt[lt]&31,pt=lt,ft=dt,it=0):it=-1}else it=0}if(pt>=0&&it>=0){const gt={data:rt.subarray(pt,nt),type:ft,state:it};ot.push(gt)}if(ot.length===0){const gt=this.getLastNalUnit(et.samples);gt&&(gt.data=appendUint8Array(gt.data,rt))}return et.naluState=it,ot}}class SampleAesDecrypter{constructor(et,rt,nt){this.keyData=void 0,this.decrypter=void 0,this.keyData=nt,this.decrypter=new Decrypter(rt,{removePKCS7Padding:!1})}decryptBuffer(et){return this.decrypter.decrypt(et,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(et,rt,nt){const it=et[rt].unit;if(it.length<=16)return;const st=it.subarray(16,it.length-it.length%16),ot=st.buffer.slice(st.byteOffset,st.byteOffset+st.length);this.decryptBuffer(ot).then(lt=>{const ut=new Uint8Array(lt);it.set(ut,16),this.decrypter.isSync()||this.decryptAacSamples(et,rt+1,nt)})}decryptAacSamples(et,rt,nt){for(;;rt++){if(rt>=et.length){nt();return}if(!(et[rt].unit.length<32)&&(this.decryptAacSample(et,rt,nt),!this.decrypter.isSync()))return}}getAvcEncryptedData(et){const rt=Math.floor((et.length-48)/160)*16+16,nt=new Int8Array(rt);let it=0;for(let st=32;st<et.length-16;st+=160,it+=16)nt.set(et.subarray(st,st+16),it);return nt}getAvcDecryptedUnit(et,rt){const nt=new Uint8Array(rt);let it=0;for(let st=32;st<et.length-16;st+=160,it+=16)et.set(nt.subarray(it,it+16),st);return et}decryptAvcSample(et,rt,nt,it,st){const ot=discardEPB(st.data),lt=this.getAvcEncryptedData(ot);this.decryptBuffer(lt.buffer).then(ut=>{st.data=this.getAvcDecryptedUnit(ot,ut),this.decrypter.isSync()||this.decryptAvcSamples(et,rt,nt+1,it)})}decryptAvcSamples(et,rt,nt,it){if(et instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;rt++,nt=0){if(rt>=et.length){it();return}const st=et[rt].units;for(;!(nt>=st.length);nt++){const ot=st[nt];if(!(ot.data.length<=48||ot.type!==1&&ot.type!==5)&&(this.decryptAvcSample(et,rt,nt,it,ot),!this.decrypter.isSync()))return}}}}const PACKET_LENGTH=188;class TSDemuxer{constructor(et,rt,nt){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=et,this.config=rt,this.typeSupported=nt,this.videoParser=new AvcVideoParser}static probe(et){const rt=TSDemuxer.syncOffset(et);return rt>0&&logger.warn(`MPEG2-TS detected but first sync word found @ offset ${rt}`),rt!==-1}static syncOffset(et){const rt=et.length;let nt=Math.min(PACKET_LENGTH*5,rt-PACKET_LENGTH)+1,it=0;for(;it<nt;){let st=!1,ot=-1,lt=0;for(let ut=it;ut<rt;ut+=PACKET_LENGTH)if(et[ut]===71&&(rt-ut===PACKET_LENGTH||et[ut+PACKET_LENGTH]===71)){if(lt++,ot===-1&&(ot=ut,ot!==0&&(nt=Math.min(ot+PACKET_LENGTH*99,et.length-PACKET_LENGTH)+1)),st||(st=parsePID(et,ut)===0),st&&lt>1&&(ot===0&&lt>2||ut+PACKET_LENGTH>nt))return ot}else{if(lt)return-1;break}it++}return-1}static createTrack(et,rt){return{container:et==="video"||et==="audio"?"video/mp2t":void 0,type:et,id:RemuxerTrackIdConfig[et],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:et==="audio"?rt:void 0}}resetInitSegment(et,rt,nt,it){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=TSDemuxer.createTrack("video"),this._audioTrack=TSDemuxer.createTrack("audio",it),this._id3Track=TSDemuxer.createTrack("id3"),this._txtTrack=TSDemuxer.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=rt,this.videoCodec=nt,this._duration=it}resetTimeStamp(){}resetContiguity(){const{_audioTrack:et,_videoTrack:rt,_id3Track:nt}=this;et&&(et.pesData=null),rt&&(rt.pesData=null),nt&&(nt.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(et,rt,nt=!1,it=!1){nt||(this.sampleAes=null);let st;const ot=this._videoTrack,lt=this._audioTrack,ut=this._id3Track,ct=this._txtTrack;let dt=ot.pid,pt=ot.pesData,ft=lt.pid,gt=ut.pid,_r=lt.pesData,Yr=ut.pesData,mt=null,Kr=this.pmtParsed,Xr=this._pmtId,Zr=et.length;if(this.remainderData&&(et=appendUint8Array(this.remainderData,et),Zr=et.length,this.remainderData=null),Zr<PACKET_LENGTH&&!it)return this.remainderData=et,{audioTrack:lt,videoTrack:ot,id3Track:ut,textTrack:ct};const Qr=Math.max(0,TSDemuxer.syncOffset(et));Zr-=(Zr-Qr)%PACKET_LENGTH,Zr<et.byteLength&&!it&&(this.remainderData=new Uint8Array(et.buffer,Zr,et.buffer.byteLength-Zr));let _i=0;for(let rs=Qr;rs<Zr;rs+=PACKET_LENGTH)if(et[rs]===71){const ss=!!(et[rs+1]&64),hs=parsePID(et,rs),os=(et[rs+3]&48)>>4;let is;if(os>1){if(is=rs+5+et[rs+4],is===rs+PACKET_LENGTH)continue}else is=rs+4;switch(hs){case dt:ss&&(pt&&(st=parsePES(pt))&&this.videoParser.parseAVCPES(ot,ct,st,!1,this._duration),pt={data:[],size:0}),pt&&(pt.data.push(et.subarray(is,rs+PACKET_LENGTH)),pt.size+=rs+PACKET_LENGTH-is);break;case ft:if(ss){if(_r&&(st=parsePES(_r)))switch(lt.segmentCodec){case"aac":this.parseAACPES(lt,st);break;case"mp3":this.parseMPEGPES(lt,st);break;case"ac3":this.parseAC3PES(lt,st);break}_r={data:[],size:0}}_r&&(_r.data.push(et.subarray(is,rs+PACKET_LENGTH)),_r.size+=rs+PACKET_LENGTH-is);break;case gt:ss&&(Yr&&(st=parsePES(Yr))&&this.parseID3PES(ut,st),Yr={data:[],size:0}),Yr&&(Yr.data.push(et.subarray(is,rs+PACKET_LENGTH)),Yr.size+=rs+PACKET_LENGTH-is);break;case 0:ss&&(is+=et[is]+1),Xr=this._pmtId=parsePAT(et,is);break;case Xr:{ss&&(is+=et[is]+1);const cs=parsePMT(et,is,this.typeSupported,nt);dt=cs.videoPid,dt>0&&(ot.pid=dt,ot.segmentCodec=cs.segmentVideoCodec),ft=cs.audioPid,ft>0&&(lt.pid=ft,lt.segmentCodec=cs.segmentAudioCodec),gt=cs.id3Pid,gt>0&&(ut.pid=gt),mt!==null&&!Kr&&(logger.warn(`MPEG-TS PMT found at ${rs} after unknown PID '${mt}'. Backtracking to sync byte @${Qr} to parse all TS packets.`),mt=null,rs=Qr-188),Kr=this.pmtParsed=!0;break}case 17:case 8191:break;default:mt=hs;break}}else _i++;if(_i>0){const rs=new Error(`Found ${_i} TS packet/s that do not start with 0x47`);this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:rs,reason:rs.message})}ot.pesData=pt,lt.pesData=_r,ut.pesData=Yr;const ns={audioTrack:lt,videoTrack:ot,id3Track:ut,textTrack:ct};return it&&this.extractRemainingSamples(ns),ns}flush(){const{remainderData:et}=this;this.remainderData=null;let rt;return et?rt=this.demux(et,-1,!1,!0):rt={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(rt),this.sampleAes?this.decrypt(rt,this.sampleAes):rt}extractRemainingSamples(et){const{audioTrack:rt,videoTrack:nt,id3Track:it,textTrack:st}=et,ot=nt.pesData,lt=rt.pesData,ut=it.pesData;let ct;if(ot&&(ct=parsePES(ot))?(this.videoParser.parseAVCPES(nt,st,ct,!0,this._duration),nt.pesData=null):nt.pesData=ot,lt&&(ct=parsePES(lt))){switch(rt.segmentCodec){case"aac":this.parseAACPES(rt,ct);break;case"mp3":this.parseMPEGPES(rt,ct);break;case"ac3":this.parseAC3PES(rt,ct);break}rt.pesData=null}else lt!=null&&lt.size&&logger.log("last AAC PES packet truncated,might overlap between fragments"),rt.pesData=lt;ut&&(ct=parsePES(ut))?(this.parseID3PES(it,ct),it.pesData=null):it.pesData=ut}demuxSampleAes(et,rt,nt){const it=this.demux(et,nt,!0,!this.config.progressive),st=this.sampleAes=new SampleAesDecrypter(this.observer,this.config,rt);return this.decrypt(it,st)}decrypt(et,rt){return new Promise(nt=>{const{audioTrack:it,videoTrack:st}=et;it.samples&&it.segmentCodec==="aac"?rt.decryptAacSamples(it.samples,0,()=>{st.samples?rt.decryptAvcSamples(st.samples,0,0,()=>{nt(et)}):nt(et)}):st.samples&&rt.decryptAvcSamples(st.samples,0,0,()=>{nt(et)})})}destroy(){this._duration=0}parseAACPES(et,rt){let nt=0;const it=this.aacOverFlow;let st=rt.data;if(it){this.aacOverFlow=null;const pt=it.missing,ft=it.sample.unit.byteLength;if(pt===-1)st=appendUint8Array(it.sample.unit,st);else{const gt=ft-pt;it.sample.unit.set(st.subarray(0,pt),gt),et.samples.push(it.sample),nt=it.missing}}let ot,lt;for(ot=nt,lt=st.length;ot<lt-1&&!isHeader$1(st,ot);ot++);if(ot!==nt){let pt;const ft=ot<lt-1;ft?pt=`AAC PES did not start with ADTS header,offset:${ot}`:pt="No ADTS header found in AAC PES";const gt=new Error(pt);if(logger.warn(`parsing error: ${pt}`),this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,levelRetry:ft,error:gt,reason:pt}),!ft)return}initTrackConfig(et,this.observer,st,ot,this.audioCodec);let ut;if(rt.pts!==void 0)ut=rt.pts;else if(it){const pt=getFrameDuration(et.samplerate);ut=it.sample.pts+pt}else{logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let ct=0,dt;for(;ot<lt;)if(dt=appendFrame$2(et,st,ot,ut,ct),ot+=dt.length,dt.missing){this.aacOverFlow=dt;break}else for(ct++;ot<lt-1&&!isHeader$1(st,ot);ot++);}parseMPEGPES(et,rt){const nt=rt.data,it=nt.length;let st=0,ot=0;const lt=rt.pts;if(lt===void 0){logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;ot<it;)if(isHeader(nt,ot)){const ut=appendFrame$1(et,nt,ot,lt,st);if(ut)ot+=ut.length,st++;else break}else ot++}parseAC3PES(et,rt){{const nt=rt.data,it=rt.pts;if(it===void 0){logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const st=nt.length;let ot=0,lt=0,ut;for(;lt<st&&(ut=appendFrame(et,nt,lt,it,ot++))>0;)lt+=ut}}parseID3PES(et,rt){if(rt.pts===void 0){logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const nt=_extends({},rt,{type:this._videoTrack?MetadataSchema.emsg:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});et.samples.push(nt)}}function parsePID(tt,et){return((tt[et+1]&31)<<8)+tt[et+2]}function parsePAT(tt,et){return(tt[et+10]&31)<<8|tt[et+11]}function parsePMT(tt,et,rt,nt){const it={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},st=(tt[et+1]&15)<<8|tt[et+2],ot=et+3+st-4,lt=(tt[et+10]&15)<<8|tt[et+11];for(et+=12+lt;et<ot;){const ut=parsePID(tt,et),ct=(tt[et+3]&15)<<8|tt[et+4];switch(tt[et]){case 207:if(!nt){logEncryptedSamplesFoundInUnencryptedStream("ADTS AAC");break}case 15:it.audioPid===-1&&(it.audioPid=ut);break;case 21:it.id3Pid===-1&&(it.id3Pid=ut);break;case 219:if(!nt){logEncryptedSamplesFoundInUnencryptedStream("H.264");break}case 27:it.videoPid===-1&&(it.videoPid=ut,it.segmentVideoCodec="avc");break;case 3:case 4:!rt.mpeg&&!rt.mp3?logger.log("MPEG audio found, not supported in this browser"):it.audioPid===-1&&(it.audioPid=ut,it.segmentAudioCodec="mp3");break;case 193:if(!nt){logEncryptedSamplesFoundInUnencryptedStream("AC-3");break}case 129:rt.ac3?it.audioPid===-1&&(it.audioPid=ut,it.segmentAudioCodec="ac3"):logger.log("AC-3 audio found, not supported in this browser");break;case 6:if(it.audioPid===-1&&ct>0){let dt=et+5,pt=ct;for(;pt>2;){switch(tt[dt]){case 106:rt.ac3!==!0?logger.log("AC-3 audio found, not supported in this browser for now"):(it.audioPid=ut,it.segmentAudioCodec="ac3");break}const gt=tt[dt+1]+2;dt+=gt,pt-=gt}}break;case 194:case 135:logger.warn("Unsupported EC-3 in M2TS found");break;case 36:logger.warn("Unsupported HEVC in M2TS found");break}et+=ct+5}return it}function logEncryptedSamplesFoundInUnencryptedStream(tt){logger.log(`${tt} with AES-128-CBC encryption found in unencrypted stream`)}function parsePES(tt){let et=0,rt,nt,it,st,ot;const lt=tt.data;if(!tt||tt.size===0)return null;for(;lt[0].length<19&&lt.length>1;)lt[0]=appendUint8Array(lt[0],lt[1]),lt.splice(1,1);if(rt=lt[0],(rt[0]<<16)+(rt[1]<<8)+rt[2]===1){if(nt=(rt[4]<<8)+rt[5],nt&&nt>tt.size-6)return null;const ct=rt[7];ct&192&&(st=(rt[9]&14)*536870912+(rt[10]&255)*4194304+(rt[11]&254)*16384+(rt[12]&255)*128+(rt[13]&254)/2,ct&64?(ot=(rt[14]&14)*536870912+(rt[15]&255)*4194304+(rt[16]&254)*16384+(rt[17]&255)*128+(rt[18]&254)/2,st-ot>60*9e4&&(logger.warn(`${Math.round((st-ot)/9e4)}s delta between PTS and DTS, align them`),st=ot)):ot=st),it=rt[8];let dt=it+9;if(tt.size<=dt)return null;tt.size-=dt;const pt=new Uint8Array(tt.size);for(let ft=0,gt=lt.length;ft<gt;ft++){rt=lt[ft];let _r=rt.byteLength;if(dt)if(dt>_r){dt-=_r;continue}else rt=rt.subarray(dt),_r-=dt,dt=0;pt.set(rt,et),et+=_r}return nt&&(nt-=it+3),{data:pt,pts:st,dts:ot,len:nt}}return null}class MP3Demuxer extends BaseAudioDemuxer{resetInitSegment(et,rt,nt,it){super.resetInitSegment(et,rt,nt,it),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:rt,duration:it,inputTimeScale:9e4,dropped:0}}static probe(et){if(!et)return!1;const rt=getID3Data(et,0);let nt=(rt==null?void 0:rt.length)||0;if(rt&&et[nt]===11&&et[nt+1]===119&&getTimeStamp(rt)!==void 0&&getAudioBSID(et,nt)<=16)return!1;for(let it=et.length;nt<it;nt++)if(probe(et,nt))return logger.log("MPEG Audio sync word found !"),!0;return!1}canParse(et,rt){return canParse(et,rt)}appendFrame(et,rt,nt){if(this.basePTS!==null)return appendFrame$1(et,rt,nt,this.basePTS,this.frameIndex)}}class AAC{static getSilentFrame(et,rt){switch(et){case"mp4a.40.2":if(rt===1)return new Uint8Array([0,200,0,128,35,128]);if(rt===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(rt===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(rt===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(rt===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(rt===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(rt===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(rt===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(rt===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const UINT32_MAX=Math.pow(2,32)-1;class MP4{static init(){MP4.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let et;for(et in MP4.types)MP4.types.hasOwnProperty(et)&&(MP4.types[et]=[et.charCodeAt(0),et.charCodeAt(1),et.charCodeAt(2),et.charCodeAt(3)]);const rt=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),nt=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);MP4.HDLR_TYPES={video:rt,audio:nt};const it=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),st=new Uint8Array([0,0,0,0,0,0,0,0]);MP4.STTS=MP4.STSC=MP4.STCO=st,MP4.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),MP4.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),MP4.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),MP4.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const ot=new Uint8Array([105,115,111,109]),lt=new Uint8Array([97,118,99,49]),ut=new Uint8Array([0,0,0,1]);MP4.FTYP=MP4.box(MP4.types.ftyp,ot,ut,ot,lt),MP4.DINF=MP4.box(MP4.types.dinf,MP4.box(MP4.types.dref,it))}static box(et,...rt){let nt=8,it=rt.length;const st=it;for(;it--;)nt+=rt[it].byteLength;const ot=new Uint8Array(nt);for(ot[0]=nt>>24&255,ot[1]=nt>>16&255,ot[2]=nt>>8&255,ot[3]=nt&255,ot.set(et,4),it=0,nt=8;it<st;it++)ot.set(rt[it],nt),nt+=rt[it].byteLength;return ot}static hdlr(et){return MP4.box(MP4.types.hdlr,MP4.HDLR_TYPES[et])}static mdat(et){return MP4.box(MP4.types.mdat,et)}static mdhd(et,rt){rt*=et;const nt=Math.floor(rt/(UINT32_MAX+1)),it=Math.floor(rt%(UINT32_MAX+1));return MP4.box(MP4.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,et>>24&255,et>>16&255,et>>8&255,et&255,nt>>24,nt>>16&255,nt>>8&255,nt&255,it>>24,it>>16&255,it>>8&255,it&255,85,196,0,0]))}static mdia(et){return MP4.box(MP4.types.mdia,MP4.mdhd(et.timescale,et.duration),MP4.hdlr(et.type),MP4.minf(et))}static mfhd(et){return MP4.box(MP4.types.mfhd,new Uint8Array([0,0,0,0,et>>24,et>>16&255,et>>8&255,et&255]))}static minf(et){return et.type==="audio"?MP4.box(MP4.types.minf,MP4.box(MP4.types.smhd,MP4.SMHD),MP4.DINF,MP4.stbl(et)):MP4.box(MP4.types.minf,MP4.box(MP4.types.vmhd,MP4.VMHD),MP4.DINF,MP4.stbl(et))}static moof(et,rt,nt){return MP4.box(MP4.types.moof,MP4.mfhd(et),MP4.traf(nt,rt))}static moov(et){let rt=et.length;const nt=[];for(;rt--;)nt[rt]=MP4.trak(et[rt]);return MP4.box.apply(null,[MP4.types.moov,MP4.mvhd(et[0].timescale,et[0].duration)].concat(nt).concat(MP4.mvex(et)))}static mvex(et){let rt=et.length;const nt=[];for(;rt--;)nt[rt]=MP4.trex(et[rt]);return MP4.box.apply(null,[MP4.types.mvex,...nt])}static mvhd(et,rt){rt*=et;const nt=Math.floor(rt/(UINT32_MAX+1)),it=Math.floor(rt%(UINT32_MAX+1)),st=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,et>>24&255,et>>16&255,et>>8&255,et&255,nt>>24,nt>>16&255,nt>>8&255,nt&255,it>>24,it>>16&255,it>>8&255,it&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return MP4.box(MP4.types.mvhd,st)}static sdtp(et){const rt=et.samples||[],nt=new Uint8Array(4+rt.length);let it,st;for(it=0;it<rt.length;it++)st=rt[it].flags,nt[it+4]=st.dependsOn<<4|st.isDependedOn<<2|st.hasRedundancy;return MP4.box(MP4.types.sdtp,nt)}static stbl(et){return MP4.box(MP4.types.stbl,MP4.stsd(et),MP4.box(MP4.types.stts,MP4.STTS),MP4.box(MP4.types.stsc,MP4.STSC),MP4.box(MP4.types.stsz,MP4.STSZ),MP4.box(MP4.types.stco,MP4.STCO))}static avc1(et){let rt=[],nt=[],it,st,ot;for(it=0;it<et.sps.length;it++)st=et.sps[it],ot=st.byteLength,rt.push(ot>>>8&255),rt.push(ot&255),rt=rt.concat(Array.prototype.slice.call(st));for(it=0;it<et.pps.length;it++)st=et.pps[it],ot=st.byteLength,nt.push(ot>>>8&255),nt.push(ot&255),nt=nt.concat(Array.prototype.slice.call(st));const lt=MP4.box(MP4.types.avcC,new Uint8Array([1,rt[3],rt[4],rt[5],255,224|et.sps.length].concat(rt).concat([et.pps.length]).concat(nt))),ut=et.width,ct=et.height,dt=et.pixelRatio[0],pt=et.pixelRatio[1];return MP4.box(MP4.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,ut>>8&255,ut&255,ct>>8&255,ct&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),lt,MP4.box(MP4.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),MP4.box(MP4.types.pasp,new Uint8Array([dt>>24,dt>>16&255,dt>>8&255,dt&255,pt>>24,pt>>16&255,pt>>8&255,pt&255])))}static esds(et){const rt=et.config.length;return new Uint8Array([0,0,0,0,3,23+rt,0,1,0,4,15+rt,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([rt]).concat(et.config).concat([6,1,2]))}static audioStsd(et){const rt=et.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,et.channelCount,0,16,0,0,0,0,rt>>8&255,rt&255,0,0])}static mp4a(et){return MP4.box(MP4.types.mp4a,MP4.audioStsd(et),MP4.box(MP4.types.esds,MP4.esds(et)))}static mp3(et){return MP4.box(MP4.types[".mp3"],MP4.audioStsd(et))}static ac3(et){return MP4.box(MP4.types["ac-3"],MP4.audioStsd(et),MP4.box(MP4.types.dac3,et.config))}static stsd(et){return et.type==="audio"?et.segmentCodec==="mp3"&&et.codec==="mp3"?MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp3(et)):et.segmentCodec==="ac3"?MP4.box(MP4.types.stsd,MP4.STSD,MP4.ac3(et)):MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp4a(et)):MP4.box(MP4.types.stsd,MP4.STSD,MP4.avc1(et))}static tkhd(et){const rt=et.id,nt=et.duration*et.timescale,it=et.width,st=et.height,ot=Math.floor(nt/(UINT32_MAX+1)),lt=Math.floor(nt%(UINT32_MAX+1));return MP4.box(MP4.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,rt>>24&255,rt>>16&255,rt>>8&255,rt&255,0,0,0,0,ot>>24,ot>>16&255,ot>>8&255,ot&255,lt>>24,lt>>16&255,lt>>8&255,lt&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,it>>8&255,it&255,0,0,st>>8&255,st&255,0,0]))}static traf(et,rt){const nt=MP4.sdtp(et),it=et.id,st=Math.floor(rt/(UINT32_MAX+1)),ot=Math.floor(rt%(UINT32_MAX+1));return MP4.box(MP4.types.traf,MP4.box(MP4.types.tfhd,new Uint8Array([0,0,0,0,it>>24,it>>16&255,it>>8&255,it&255])),MP4.box(MP4.types.tfdt,new Uint8Array([1,0,0,0,st>>24,st>>16&255,st>>8&255,st&255,ot>>24,ot>>16&255,ot>>8&255,ot&255])),MP4.trun(et,nt.length+16+20+8+16+8+8),nt)}static trak(et){return et.duration=et.duration||4294967295,MP4.box(MP4.types.trak,MP4.tkhd(et),MP4.mdia(et))}static trex(et){const rt=et.id;return MP4.box(MP4.types.trex,new Uint8Array([0,0,0,0,rt>>24,rt>>16&255,rt>>8&255,rt&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(et,rt){const nt=et.samples||[],it=nt.length,st=12+16*it,ot=new Uint8Array(st);let lt,ut,ct,dt,pt,ft;for(rt+=8+st,ot.set([et.type==="video"?1:0,0,15,1,it>>>24&255,it>>>16&255,it>>>8&255,it&255,rt>>>24&255,rt>>>16&255,rt>>>8&255,rt&255],0),lt=0;lt<it;lt++)ut=nt[lt],ct=ut.duration,dt=ut.size,pt=ut.flags,ft=ut.cts,ot.set([ct>>>24&255,ct>>>16&255,ct>>>8&255,ct&255,dt>>>24&255,dt>>>16&255,dt>>>8&255,dt&255,pt.isLeading<<2|pt.dependsOn,pt.isDependedOn<<6|pt.hasRedundancy<<4|pt.paddingValue<<1|pt.isNonSync,pt.degradPrio&61440,pt.degradPrio&15,ft>>>24&255,ft>>>16&255,ft>>>8&255,ft&255],12+16*lt);return MP4.box(MP4.types.trun,ot)}static initSegment(et){MP4.types||MP4.init();const rt=MP4.moov(et);return appendUint8Array(MP4.FTYP,rt)}}MP4.types=void 0;MP4.HDLR_TYPES=void 0;MP4.STTS=void 0;MP4.STSC=void 0;MP4.STCO=void 0;MP4.STSZ=void 0;MP4.VMHD=void 0;MP4.SMHD=void 0;MP4.STSD=void 0;MP4.FTYP=void 0;MP4.DINF=void 0;const MPEG_TS_CLOCK_FREQ_HZ=9e4;function toTimescaleFromBase(tt,et,rt=1,nt=!1){const it=tt*et*rt;return nt?Math.round(it):it}function toTimescaleFromScale(tt,et,rt=1,nt=!1){return toTimescaleFromBase(tt,et,1/rt,nt)}function toMsFromMpegTsClock(tt,et=!1){return toTimescaleFromBase(tt,1e3,1/MPEG_TS_CLOCK_FREQ_HZ,et)}function toMpegTsClockFromTimescale(tt,et=1){return toTimescaleFromBase(tt,MPEG_TS_CLOCK_FREQ_HZ,1/et)}const MAX_SILENT_FRAME_DURATION=10*1e3,AAC_SAMPLES_PER_FRAME=1024,MPEG_AUDIO_SAMPLE_PER_FRAME=1152,AC3_SAMPLES_PER_FRAME=1536;let chromeVersion=null,safariWebkitVersion=null;class MP4Remuxer{constructor(et,rt,nt,it=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=et,this.config=rt,this.typeSupported=nt,this.ISGenerated=!1,chromeVersion===null){const ot=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);chromeVersion=ot?parseInt(ot[1]):0}if(safariWebkitVersion===null){const st=navigator.userAgent.match(/Safari\/(\d+)/i);safariWebkitVersion=st?parseInt(st[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(et){logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=et}resetNextTimestamp(){logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(et){let rt=!1;const nt=et.reduce((it,st)=>{const ot=st.pts-it;return ot<-4294967296?(rt=!0,normalizePts(it,st.pts)):ot>0?it:st.pts},et[0].pts);return rt&&logger.debug("PTS rollover detected"),nt}remux(et,rt,nt,it,st,ot,lt,ut){let ct,dt,pt,ft,gt,_r,Yr=st,mt=st;const Kr=et.pid>-1,Xr=rt.pid>-1,Zr=rt.samples.length,Qr=et.samples.length>0,_i=lt&&Zr>0||Zr>1;if((!Kr||Qr)&&(!Xr||_i)||this.ISGenerated||lt){if(this.ISGenerated){var rs,ss,hs,os;const vs=this.videoTrackConfig;vs&&(rt.width!==vs.width||rt.height!==vs.height||((rs=rt.pixelRatio)==null?void 0:rs[0])!==((ss=vs.pixelRatio)==null?void 0:ss[0])||((hs=rt.pixelRatio)==null?void 0:hs[1])!==((os=vs.pixelRatio)==null?void 0:os[1]))&&this.resetInitSegment()}else pt=this.generateIS(et,rt,st,ot);const is=this.isVideoContiguous;let cs=-1,ps;if(_i&&(cs=findKeyframeIndex(rt.samples),!is&&this.config.forceKeyFrameOnDiscontinuity))if(_r=!0,cs>0){logger.warn(`[mp4-remuxer]: Dropped ${cs} out of ${Zr} video samples due to a missing keyframe`);const vs=this.getVideoStartPts(rt.samples);rt.samples=rt.samples.slice(cs),rt.dropped+=cs,mt+=(rt.samples[0].pts-vs)/rt.inputTimeScale,ps=mt}else cs===-1&&(logger.warn(`[mp4-remuxer]: No keyframe found out of ${Zr} video samples`),_r=!1);if(this.ISGenerated){if(Qr&&_i){const vs=this.getVideoStartPts(rt.samples),ms=(normalizePts(et.samples[0].pts,vs)-vs)/rt.inputTimeScale;Yr+=Math.max(0,ms),mt+=Math.max(0,-ms)}if(Qr){if(et.samplerate||(logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),pt=this.generateIS(et,rt,st,ot)),dt=this.remuxAudio(et,Yr,this.isAudioContiguous,ot,Xr||_i||ut===PlaylistLevelType.AUDIO?mt:void 0),_i){const vs=dt?dt.endPTS-dt.startPTS:0;rt.inputTimeScale||(logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),pt=this.generateIS(et,rt,st,ot)),ct=this.remuxVideo(rt,mt,is,vs)}}else _i&&(ct=this.remuxVideo(rt,mt,is,0));ct&&(ct.firstKeyFrame=cs,ct.independent=cs!==-1,ct.firstKeyFramePTS=ps)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(nt.samples.length&&(gt=flushTextTrackMetadataCueSamples(nt,st,this._initPTS,this._initDTS)),it.samples.length&&(ft=flushTextTrackUserdataCueSamples(it,st,this._initPTS))),{audio:dt,video:ct,initSegment:pt,independent:_r,text:ft,id3:gt}}generateIS(et,rt,nt,it){const st=et.samples,ot=rt.samples,lt=this.typeSupported,ut={},ct=this._initPTS;let dt=!ct||it,pt="audio/mp4",ft,gt,_r;if(dt&&(ft=gt=1/0),et.config&&st.length){switch(et.timescale=et.samplerate,et.segmentCodec){case"mp3":lt.mpeg?(pt="audio/mpeg",et.codec=""):lt.mp3&&(et.codec="mp3");break;case"ac3":et.codec="ac-3";break}ut.audio={id:"audio",container:pt,codec:et.codec,initSegment:et.segmentCodec==="mp3"&&lt.mpeg?new Uint8Array(0):MP4.initSegment([et]),metadata:{channelCount:et.channelCount}},dt&&(_r=et.inputTimeScale,!ct||_r!==ct.timescale?ft=gt=st[0].pts-Math.round(_r*nt):dt=!1)}if(rt.sps&&rt.pps&&ot.length){if(rt.timescale=rt.inputTimeScale,ut.video={id:"main",container:"video/mp4",codec:rt.codec,initSegment:MP4.initSegment([rt]),metadata:{width:rt.width,height:rt.height}},dt)if(_r=rt.inputTimeScale,!ct||_r!==ct.timescale){const Yr=this.getVideoStartPts(ot),mt=Math.round(_r*nt);gt=Math.min(gt,normalizePts(ot[0].dts,Yr)-mt),ft=Math.min(ft,Yr-mt)}else dt=!1;this.videoTrackConfig={width:rt.width,height:rt.height,pixelRatio:rt.pixelRatio}}if(Object.keys(ut).length)return this.ISGenerated=!0,dt?(this._initPTS={baseTime:ft,timescale:_r},this._initDTS={baseTime:gt,timescale:_r}):ft=_r=void 0,{tracks:ut,initPTS:ft,timescale:_r}}remuxVideo(et,rt,nt,it){const st=et.inputTimeScale,ot=et.samples,lt=[],ut=ot.length,ct=this._initPTS;let dt=this.nextAvcDts,pt=8,ft=this.videoSampleDuration,gt,_r,Yr=Number.POSITIVE_INFINITY,mt=Number.NEGATIVE_INFINITY,Kr=!1;if(!nt||dt===null){const ys=rt*st,Es=ot[0].pts-normalizePts(ot[0].dts,ot[0].pts);chromeVersion&&dt!==null&&Math.abs(ys-Es-dt)<15e3?nt=!0:dt=ys-Es}const Xr=ct.baseTime*st/ct.timescale;for(let ys=0;ys<ut;ys++){const Es=ot[ys];Es.pts=normalizePts(Es.pts-Xr,dt),Es.dts=normalizePts(Es.dts-Xr,dt),Es.dts<ot[ys>0?ys-1:ys].dts&&(Kr=!0)}Kr&&ot.sort(function(ys,Es){const Ss=ys.dts-Es.dts,Ts=ys.pts-Es.pts;return Ss||Ts}),gt=ot[0].dts,_r=ot[ot.length-1].dts;const Zr=_r-gt,Qr=Zr?Math.round(Zr/(ut-1)):ft||et.inputTimeScale/30;if(nt){const ys=gt-dt,Es=ys>Qr,Ss=ys<-1;if((Es||Ss)&&(Es?logger.warn(`AVC: ${toMsFromMpegTsClock(ys,!0)} ms (${ys}dts) hole between fragments detected at ${rt.toFixed(3)}`):logger.warn(`AVC: ${toMsFromMpegTsClock(-ys,!0)} ms (${ys}dts) overlapping between fragments detected at ${rt.toFixed(3)}`),!Ss||dt>=ot[0].pts||chromeVersion)){gt=dt;const Ts=ot[0].pts-ys;if(Es)ot[0].dts=gt,ot[0].pts=Ts;else for(let Ds=0;Ds<ot.length&&!(ot[Ds].dts>Ts);Ds++)ot[Ds].dts-=ys,ot[Ds].pts-=ys;logger.log(`Video: Initial PTS/DTS adjusted: ${toMsFromMpegTsClock(Ts,!0)}/${toMsFromMpegTsClock(gt,!0)}, delta: ${toMsFromMpegTsClock(ys,!0)} ms`)}}gt=Math.max(0,gt);let _i=0,ns=0,rs=gt;for(let ys=0;ys<ut;ys++){const Es=ot[ys],Ss=Es.units,Ts=Ss.length;let Ds=0;for(let Rs=0;Rs<Ts;Rs++)Ds+=Ss[Rs].data.length;ns+=Ds,_i+=Ts,Es.length=Ds,Es.dts<rs?(Es.dts=rs,rs+=Qr/4|0||1):rs=Es.dts,Yr=Math.min(Es.pts,Yr),mt=Math.max(Es.pts,mt)}_r=ot[ut-1].dts;const ss=ns+4*_i+8;let hs;try{hs=new Uint8Array(ss)}catch(ys){this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MUX_ERROR,details:ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,error:ys,bytes:ss,reason:`fail allocating video mdat ${ss}`});return}const os=new DataView(hs.buffer);os.setUint32(0,ss),hs.set(MP4.types.mdat,4);let is=!1,cs=Number.POSITIVE_INFINITY,ps=Number.POSITIVE_INFINITY,vs=Number.NEGATIVE_INFINITY,ls=Number.NEGATIVE_INFINITY;for(let ys=0;ys<ut;ys++){const Es=ot[ys],Ss=Es.units;let Ts=0;for(let Is=0,ks=Ss.length;Is<ks;Is++){const As=Ss[Is],Os=As.data,Ys=As.data.byteLength;os.setUint32(pt,Ys),pt+=4,hs.set(Os,pt),pt+=Ys,Ts+=4+Ys}let Ds;if(ys<ut-1)ft=ot[ys+1].dts-Es.dts,Ds=ot[ys+1].pts-Es.pts;else{const Is=this.config,ks=ys>0?Es.dts-ot[ys-1].dts:Qr;if(Ds=ys>0?Es.pts-ot[ys-1].pts:Qr,Is.stretchShortVideoTrack&&this.nextAudioPts!==null){const As=Math.floor(Is.maxBufferHole*st),Os=(it?Yr+it*st:this.nextAudioPts)-Es.pts;Os>As?(ft=Os-ks,ft<0?ft=ks:is=!0,logger.log(`[mp4-remuxer]: It is approximately ${Os/90} ms to the next segment; using duration ${ft/90} ms for the last video frame.`)):ft=ks}else ft=ks}const Rs=Math.round(Es.pts-Es.dts);cs=Math.min(cs,ft),vs=Math.max(vs,ft),ps=Math.min(ps,Ds),ls=Math.max(ls,Ds),lt.push(new Mp4Sample(Es.key,ft,Ts,Rs))}if(lt.length){if(chromeVersion){if(chromeVersion<70){const ys=lt[0].flags;ys.dependsOn=2,ys.isNonSync=0}}else if(safariWebkitVersion&&ls-ps<vs-cs&&Qr/vs<.025&&lt[0].cts===0){logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let ys=gt;for(let Es=0,Ss=lt.length;Es<Ss;Es++){const Ts=ys+lt[Es].duration,Ds=ys+lt[Es].cts;if(Es<Ss-1){const Rs=Ts+lt[Es+1].cts;lt[Es].duration=Rs-Ds}else lt[Es].duration=Es?lt[Es-1].duration:Qr;lt[Es].cts=0,ys=Ts}}}ft=is||!ft?Qr:ft,this.nextAvcDts=dt=_r+ft,this.videoSampleDuration=ft,this.isVideoContiguous=!0;const gs={data1:MP4.moof(et.sequenceNumber++,gt,_extends({},et,{samples:lt})),data2:hs,startPTS:Yr/st,endPTS:(mt+ft)/st,startDTS:gt/st,endDTS:dt/st,type:"video",hasAudio:!1,hasVideo:!0,nb:lt.length,dropped:et.dropped};return et.samples=[],et.dropped=0,gs}getSamplesPerFrame(et){switch(et.segmentCodec){case"mp3":return MPEG_AUDIO_SAMPLE_PER_FRAME;case"ac3":return AC3_SAMPLES_PER_FRAME;default:return AAC_SAMPLES_PER_FRAME}}remuxAudio(et,rt,nt,it,st){const ot=et.inputTimeScale,lt=et.samplerate?et.samplerate:ot,ut=ot/lt,ct=this.getSamplesPerFrame(et),dt=ct*ut,pt=this._initPTS,ft=et.segmentCodec==="mp3"&&this.typeSupported.mpeg,gt=[],_r=st!==void 0;let Yr=et.samples,mt=ft?0:8,Kr=this.nextAudioPts||-1;const Xr=rt*ot,Zr=pt.baseTime*ot/pt.timescale;if(this.isAudioContiguous=nt=nt||Yr.length&&Kr>0&&(it&&Math.abs(Xr-Kr)<9e3||Math.abs(normalizePts(Yr[0].pts-Zr,Xr)-Kr)<20*dt),Yr.forEach(function(ms){ms.pts=normalizePts(ms.pts-Zr,Xr)}),!nt||Kr<0){if(Yr=Yr.filter(ms=>ms.pts>=0),!Yr.length)return;st===0?Kr=0:it&&!_r?Kr=Math.max(0,Xr):Kr=Yr[0].pts}if(et.segmentCodec==="aac"){const ms=this.config.maxAudioFramesDrift;for(let us=0,gs=Kr;us<Yr.length;us++){const ys=Yr[us],Es=ys.pts,Ss=Es-gs,Ts=Math.abs(1e3*Ss/ot);if(Ss<=-ms*dt&&_r)us===0&&(logger.warn(`Audio frame @ ${(Es/ot).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*Ss/ot)} ms.`),this.nextAudioPts=Kr=gs=Es);else if(Ss>=ms*dt&&Ts<MAX_SILENT_FRAME_DURATION&&_r){let Ds=Math.round(Ss/dt);gs=Es-Ds*dt,gs<0&&(Ds--,gs+=dt),us===0&&(this.nextAudioPts=Kr=gs),logger.warn(`[mp4-remuxer]: Injecting ${Ds} audio frame @ ${(gs/ot).toFixed(3)}s due to ${Math.round(1e3*Ss/ot)} ms gap.`);for(let Rs=0;Rs<Ds;Rs++){const Is=Math.max(gs,0);let ks=AAC.getSilentFrame(et.manifestCodec||et.codec,et.channelCount);ks||(logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),ks=ys.unit.subarray()),Yr.splice(us,0,{unit:ks,pts:Is}),gs+=dt,us++}}ys.pts=gs,gs+=dt}}let Qr=null,_i=null,ns,rs=0,ss=Yr.length;for(;ss--;)rs+=Yr[ss].unit.byteLength;for(let ms=0,us=Yr.length;ms<us;ms++){const gs=Yr[ms],ys=gs.unit;let Es=gs.pts;if(_i!==null){const Ts=gt[ms-1];Ts.duration=Math.round((Es-_i)/ut)}else if(nt&&et.segmentCodec==="aac"&&(Es=Kr),Qr=Es,rs>0){rs+=mt;try{ns=new Uint8Array(rs)}catch(Ts){this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MUX_ERROR,details:ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,error:Ts,bytes:rs,reason:`fail allocating audio mdat ${rs}`});return}ft||(new DataView(ns.buffer).setUint32(0,rs),ns.set(MP4.types.mdat,4))}else return;ns.set(ys,mt);const Ss=ys.byteLength;mt+=Ss,gt.push(new Mp4Sample(!0,ct,Ss,0)),_i=Es}const hs=gt.length;if(!hs)return;const os=gt[gt.length-1];this.nextAudioPts=Kr=_i+ut*os.duration;const is=ft?new Uint8Array(0):MP4.moof(et.sequenceNumber++,Qr/ut,_extends({},et,{samples:gt}));et.samples=[];const cs=Qr/ot,ps=Kr/ot,ls={data1:is,data2:ns,startPTS:cs,endPTS:ps,startDTS:cs,endDTS:ps,type:"audio",hasAudio:!0,hasVideo:!1,nb:hs};return this.isAudioContiguous=!0,ls}remuxEmptyAudio(et,rt,nt,it){const st=et.inputTimeScale,ot=et.samplerate?et.samplerate:st,lt=st/ot,ut=this.nextAudioPts,ct=this._initDTS,dt=ct.baseTime*9e4/ct.timescale,pt=(ut!==null?ut:it.startDTS*st)+dt,ft=it.endDTS*st+dt,gt=lt*AAC_SAMPLES_PER_FRAME,_r=Math.ceil((ft-pt)/gt),Yr=AAC.getSilentFrame(et.manifestCodec||et.codec,et.channelCount);if(logger.warn("[mp4-remuxer]: remux empty Audio"),!Yr){logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}const mt=[];for(let Kr=0;Kr<_r;Kr++){const Xr=pt+Kr*gt;mt.push({unit:Yr,pts:Xr,dts:Xr})}return et.samples=mt,this.remuxAudio(et,rt,nt,!1)}}function normalizePts(tt,et){let rt;if(et===null)return tt;for(et<tt?rt=-8589934592:rt=8589934592;Math.abs(tt-et)>4294967296;)tt+=rt;return tt}function findKeyframeIndex(tt){for(let et=0;et<tt.length;et++)if(tt[et].key)return et;return-1}function flushTextTrackMetadataCueSamples(tt,et,rt,nt){const it=tt.samples.length;if(!it)return;const st=tt.inputTimeScale;for(let lt=0;lt<it;lt++){const ut=tt.samples[lt];ut.pts=normalizePts(ut.pts-rt.baseTime*st/rt.timescale,et*st)/st,ut.dts=normalizePts(ut.dts-nt.baseTime*st/nt.timescale,et*st)/st}const ot=tt.samples;return tt.samples=[],{samples:ot}}function flushTextTrackUserdataCueSamples(tt,et,rt){const nt=tt.samples.length;if(!nt)return;const it=tt.inputTimeScale;for(let ot=0;ot<nt;ot++){const lt=tt.samples[ot];lt.pts=normalizePts(lt.pts-rt.baseTime*it/rt.timescale,et*it)/it}tt.samples.sort((ot,lt)=>ot.pts-lt.pts);const st=tt.samples;return tt.samples=[],{samples:st}}class Mp4Sample{constructor(et,rt,nt,it){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=rt,this.size=nt,this.cts=it,this.flags={isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:et?2:1,isNonSync:et?0:1}}}class PassThroughRemuxer{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(et){this.initPTS=et,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(et,rt,nt,it){this.audioCodec=rt,this.videoCodec=nt,this.generateInitSegment(patchEncyptionData(et,it)),this.emitInitSegment=!0}generateInitSegment(et){let{audioCodec:rt,videoCodec:nt}=this;if(!(et!=null&&et.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const it=this.initData=parseInitSegment(et);it.audio&&(rt=getParsedTrackCodec(it.audio,ElementaryStreamTypes.AUDIO)),it.video&&(nt=getParsedTrackCodec(it.video,ElementaryStreamTypes.VIDEO));const st={};it.audio&&it.video?st.audiovideo={container:"video/mp4",codec:rt+","+nt,initSegment:et,id:"main"}:it.audio?st.audio={container:"audio/mp4",codec:rt,initSegment:et,id:"audio"}:it.video?st.video={container:"video/mp4",codec:nt,initSegment:et,id:"main"}:logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=st}remux(et,rt,nt,it,st,ot){var lt,ut;let{initPTS:ct,lastEndTime:dt}=this;const pt={audio:void 0,video:void 0,text:it,id3:nt,initSegment:void 0};isFiniteNumber(dt)||(dt=this.lastEndTime=st||0);const ft=rt.samples;if(!(ft!=null&&ft.length))return pt;const gt={initPTS:void 0,timescale:1};let _r=this.initData;if((lt=_r)!=null&&lt.length||(this.generateInitSegment(ft),_r=this.initData),!((ut=_r)!=null&&ut.length))return logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),pt;this.emitInitSegment&&(gt.tracks=this.initTracks,this.emitInitSegment=!1);const Yr=getDuration(ft,_r),mt=getStartDTS(_r,ft),Kr=mt===null?st:mt;(isInvalidInitPts(ct,Kr,st,Yr)||gt.timescale!==ct.timescale&&ot)&&(gt.initPTS=Kr-st,ct&&ct.timescale===1&&logger.warn(`Adjusting initPTS by ${gt.initPTS-ct.baseTime}`),this.initPTS=ct={baseTime:gt.initPTS,timescale:1});const Xr=et?Kr-ct.baseTime/ct.timescale:dt,Zr=Xr+Yr;offsetStartDTS(_r,ft,ct.baseTime/ct.timescale),Yr>0?this.lastEndTime=Zr:(logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const Qr=!!_r.audio,_i=!!_r.video;let ns="";Qr&&(ns+="audio"),_i&&(ns+="video");const rs={data1:ft,startPTS:Xr,startDTS:Xr,endPTS:Zr,endDTS:Zr,type:ns,hasAudio:Qr,hasVideo:_i,nb:1,dropped:0};return pt.audio=rs.type==="audio"?rs:void 0,pt.video=rs.type!=="audio"?rs:void 0,pt.initSegment=gt,pt.id3=flushTextTrackMetadataCueSamples(nt,st,ct,ct),it.samples.length&&(pt.text=flushTextTrackUserdataCueSamples(it,st,ct)),pt}}function isInvalidInitPts(tt,et,rt,nt){if(tt===null)return!0;const it=Math.max(nt,1),st=et-tt.baseTime/tt.timescale;return Math.abs(st-rt)>it}function getParsedTrackCodec(tt,et){const rt=tt==null?void 0:tt.codec;if(rt&&rt.length>4)return rt;if(et===ElementaryStreamTypes.AUDIO){if(rt==="ec-3"||rt==="ac-3"||rt==="alac")return rt;if(rt==="fLaC"||rt==="Opus")return getCodecCompatibleName(rt,!1);const nt="mp4a.40.5";return logger.info(`Parsed audio codec "${rt}" or audio object type not handled. Using "${nt}"`),nt}return logger.warn(`Unhandled video codec "${rt}"`),rt==="hvc1"||rt==="hev1"?"hvc1.1.6.L120.90":rt==="av01"?"av01.0.04M.08":"avc1.42e01e"}let now;try{now=self.performance.now.bind(self.performance)}catch{logger.debug("Unable to use Performance API on this environment"),now=optionalSelf==null?void 0:optionalSelf.Date.now}const muxConfig=[{demux:MP4Demuxer,remux:PassThroughRemuxer},{demux:TSDemuxer,remux:MP4Remuxer},{demux:AACDemuxer,remux:MP4Remuxer},{demux:MP3Demuxer,remux:MP4Remuxer}];muxConfig.splice(2,0,{demux:AC3Demuxer,remux:MP4Remuxer});class Transmuxer{constructor(et,rt,nt,it,st){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=et,this.typeSupported=rt,this.config=nt,this.vendor=it,this.id=st}configure(et){this.transmuxConfig=et,this.decrypter&&this.decrypter.reset()}push(et,rt,nt,it){const st=nt.transmuxing;st.executeStart=now();let ot=new Uint8Array(et);const{currentTransmuxState:lt,transmuxConfig:ut}=this;it&&(this.currentTransmuxState=it);const{contiguous:ct,discontinuity:dt,trackSwitch:pt,accurateTimeOffset:ft,timeOffset:gt,initSegmentChange:_r}=it||lt,{audioCodec:Yr,videoCodec:mt,defaultInitPts:Kr,duration:Xr,initSegmentData:Zr}=ut,Qr=getEncryptionType(ot,rt);if(Qr&&Qr.method==="AES-128"){const ss=this.getDecrypter();if(ss.isSync()){let hs=ss.softwareDecrypt(ot,Qr.key.buffer,Qr.iv.buffer);if(nt.part>-1&&(hs=ss.flush()),!hs)return st.executeEnd=now(),emptyResult(nt);ot=new Uint8Array(hs)}else return this.decryptionPromise=ss.webCryptoDecrypt(ot,Qr.key.buffer,Qr.iv.buffer).then(hs=>{const os=this.push(hs,null,nt);return this.decryptionPromise=null,os}),this.decryptionPromise}const _i=this.needsProbing(dt,pt);if(_i){const ss=this.configureTransmuxer(ot);if(ss)return logger.warn(`[transmuxer] ${ss.message}`),this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:ss,reason:ss.message}),st.executeEnd=now(),emptyResult(nt)}(dt||pt||_r||_i)&&this.resetInitSegment(Zr,Yr,mt,Xr,rt),(dt||_r||_i)&&this.resetInitialTimestamp(Kr),ct||this.resetContiguity();const ns=this.transmux(ot,Qr,gt,ft,nt),rs=this.currentTransmuxState;return rs.contiguous=!0,rs.discontinuity=!1,rs.trackSwitch=!1,st.executeEnd=now(),ns}flush(et){const rt=et.transmuxing;rt.executeStart=now();const{decrypter:nt,currentTransmuxState:it,decryptionPromise:st}=this;if(st)return st.then(()=>this.flush(et));const ot=[],{timeOffset:lt}=it;if(nt){const pt=nt.flush();pt&&ot.push(this.push(pt,null,et))}const{demuxer:ut,remuxer:ct}=this;if(!ut||!ct)return rt.executeEnd=now(),[emptyResult(et)];const dt=ut.flush(lt);return isPromise(dt)?dt.then(pt=>(this.flushRemux(ot,pt,et),ot)):(this.flushRemux(ot,dt,et),ot)}flushRemux(et,rt,nt){const{audioTrack:it,videoTrack:st,id3Track:ot,textTrack:lt}=rt,{accurateTimeOffset:ut,timeOffset:ct}=this.currentTransmuxState;logger.log(`[transmuxer.ts]: Flushed fragment ${nt.sn}${nt.part>-1?" p: "+nt.part:""} of level ${nt.level}`);const dt=this.remuxer.remux(it,st,ot,lt,ct,ut,!0,this.id);et.push({remuxResult:dt,chunkMeta:nt}),nt.transmuxing.executeEnd=now()}resetInitialTimestamp(et){const{demuxer:rt,remuxer:nt}=this;!rt||!nt||(rt.resetTimeStamp(et),nt.resetTimeStamp(et))}resetContiguity(){const{demuxer:et,remuxer:rt}=this;!et||!rt||(et.resetContiguity(),rt.resetNextTimestamp())}resetInitSegment(et,rt,nt,it,st){const{demuxer:ot,remuxer:lt}=this;!ot||!lt||(ot.resetInitSegment(et,rt,nt,it),lt.resetInitSegment(et,rt,nt,st))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(et,rt,nt,it,st){let ot;return rt&&rt.method==="SAMPLE-AES"?ot=this.transmuxSampleAes(et,rt,nt,it,st):ot=this.transmuxUnencrypted(et,nt,it,st),ot}transmuxUnencrypted(et,rt,nt,it){const{audioTrack:st,videoTrack:ot,id3Track:lt,textTrack:ut}=this.demuxer.demux(et,rt,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(st,ot,lt,ut,rt,nt,!1,this.id),chunkMeta:it}}transmuxSampleAes(et,rt,nt,it,st){return this.demuxer.demuxSampleAes(et,rt,nt).then(ot=>({remuxResult:this.remuxer.remux(ot.audioTrack,ot.videoTrack,ot.id3Track,ot.textTrack,nt,it,!1,this.id),chunkMeta:st}))}configureTransmuxer(et){const{config:rt,observer:nt,typeSupported:it,vendor:st}=this;let ot;for(let ft=0,gt=muxConfig.length;ft<gt;ft++){var lt;if((lt=muxConfig[ft].demux)!=null&&lt.probe(et)){ot=muxConfig[ft];break}}if(!ot)return new Error("Failed to find demuxer by probing fragment data");const ut=this.demuxer,ct=this.remuxer,dt=ot.remux,pt=ot.demux;(!ct||!(ct instanceof dt))&&(this.remuxer=new dt(nt,rt,it,st)),(!ut||!(ut instanceof pt))&&(this.demuxer=new pt(nt,rt,it),this.probe=pt.probe)}needsProbing(et,rt){return!this.demuxer||!this.remuxer||et||rt}getDecrypter(){let et=this.decrypter;return et||(et=this.decrypter=new Decrypter(this.config)),et}}function getEncryptionType(tt,et){let rt=null;return tt.byteLength>0&&(et==null?void 0:et.key)!=null&&et.iv!==null&&et.method!=null&&(rt=et),rt}const emptyResult=tt=>({remuxResult:{},chunkMeta:tt});function isPromise(tt){return"then"in tt&&tt.then instanceof Function}class TransmuxConfig{constructor(et,rt,nt,it,st){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=et,this.videoCodec=rt,this.initSegmentData=nt,this.duration=it,this.defaultInitPts=st||null}}class TransmuxState{constructor(et,rt,nt,it,st,ot){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=et,this.contiguous=rt,this.accurateTimeOffset=nt,this.trackSwitch=it,this.timeOffset=st,this.initSegmentChange=ot}}var eventemitter3={exports:{}};(function(tt){var et=Object.prototype.hasOwnProperty,rt="~";function nt(){}Object.create&&(nt.prototype=Object.create(null),new nt().__proto__||(rt=!1));function it(ut,ct,dt){this.fn=ut,this.context=ct,this.once=dt||!1}function st(ut,ct,dt,pt,ft){if(typeof dt!="function")throw new TypeError("The listener must be a function");var gt=new it(dt,pt||ut,ft),_r=rt?rt+ct:ct;return ut._events[_r]?ut._events[_r].fn?ut._events[_r]=[ut._events[_r],gt]:ut._events[_r].push(gt):(ut._events[_r]=gt,ut._eventsCount++),ut}function ot(ut,ct){--ut._eventsCount===0?ut._events=new nt:delete ut._events[ct]}function lt(){this._events=new nt,this._eventsCount=0}lt.prototype.eventNames=function(){var ct=[],dt,pt;if(this._eventsCount===0)return ct;for(pt in dt=this._events)et.call(dt,pt)&&ct.push(rt?pt.slice(1):pt);return Object.getOwnPropertySymbols?ct.concat(Object.getOwnPropertySymbols(dt)):ct},lt.prototype.listeners=function(ct){var dt=rt?rt+ct:ct,pt=this._events[dt];if(!pt)return[];if(pt.fn)return[pt.fn];for(var ft=0,gt=pt.length,_r=new Array(gt);ft<gt;ft++)_r[ft]=pt[ft].fn;return _r},lt.prototype.listenerCount=function(ct){var dt=rt?rt+ct:ct,pt=this._events[dt];return pt?pt.fn?1:pt.length:0},lt.prototype.emit=function(ct,dt,pt,ft,gt,_r){var Yr=rt?rt+ct:ct;if(!this._events[Yr])return!1;var mt=this._events[Yr],Kr=arguments.length,Xr,Zr;if(mt.fn){switch(mt.once&&this.removeListener(ct,mt.fn,void 0,!0),Kr){case 1:return mt.fn.call(mt.context),!0;case 2:return mt.fn.call(mt.context,dt),!0;case 3:return mt.fn.call(mt.context,dt,pt),!0;case 4:return mt.fn.call(mt.context,dt,pt,ft),!0;case 5:return mt.fn.call(mt.context,dt,pt,ft,gt),!0;case 6:return mt.fn.call(mt.context,dt,pt,ft,gt,_r),!0}for(Zr=1,Xr=new Array(Kr-1);Zr<Kr;Zr++)Xr[Zr-1]=arguments[Zr];mt.fn.apply(mt.context,Xr)}else{var Qr=mt.length,_i;for(Zr=0;Zr<Qr;Zr++)switch(mt[Zr].once&&this.removeListener(ct,mt[Zr].fn,void 0,!0),Kr){case 1:mt[Zr].fn.call(mt[Zr].context);break;case 2:mt[Zr].fn.call(mt[Zr].context,dt);break;case 3:mt[Zr].fn.call(mt[Zr].context,dt,pt);break;case 4:mt[Zr].fn.call(mt[Zr].context,dt,pt,ft);break;default:if(!Xr)for(_i=1,Xr=new Array(Kr-1);_i<Kr;_i++)Xr[_i-1]=arguments[_i];mt[Zr].fn.apply(mt[Zr].context,Xr)}}return!0},lt.prototype.on=function(ct,dt,pt){return st(this,ct,dt,pt,!1)},lt.prototype.once=function(ct,dt,pt){return st(this,ct,dt,pt,!0)},lt.prototype.removeListener=function(ct,dt,pt,ft){var gt=rt?rt+ct:ct;if(!this._events[gt])return this;if(!dt)return ot(this,gt),this;var _r=this._events[gt];if(_r.fn)_r.fn===dt&&(!ft||_r.once)&&(!pt||_r.context===pt)&&ot(this,gt);else{for(var Yr=0,mt=[],Kr=_r.length;Yr<Kr;Yr++)(_r[Yr].fn!==dt||ft&&!_r[Yr].once||pt&&_r[Yr].context!==pt)&&mt.push(_r[Yr]);mt.length?this._events[gt]=mt.length===1?mt[0]:mt:ot(this,gt)}return this},lt.prototype.removeAllListeners=function(ct){var dt;return ct?(dt=rt?rt+ct:ct,this._events[dt]&&ot(this,dt)):(this._events=new nt,this._eventsCount=0),this},lt.prototype.off=lt.prototype.removeListener,lt.prototype.addListener=lt.prototype.on,lt.prefixed=rt,lt.EventEmitter=lt,tt.exports=lt})(eventemitter3);var eventemitter3Exports=eventemitter3.exports,EventEmitter=getDefaultExportFromCjs(eventemitter3Exports);class TransmuxerInterface{constructor(et,rt,nt,it){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const st=et.config;this.hls=et,this.id=rt,this.useWorker=!!st.enableWorker,this.onTransmuxComplete=nt,this.onFlush=it;const ot=(dt,pt)=>{pt=pt||{},pt.frag=this.frag,pt.id=this.id,dt===Events.ERROR&&(this.error=pt.error),this.hls.trigger(dt,pt)};this.observer=new EventEmitter,this.observer.on(Events.FRAG_DECRYPTED,ot),this.observer.on(Events.ERROR,ot);const lt=getMediaSource(st.preferManagedMediaSource)||{isTypeSupported:()=>!1},ut={mpeg:lt.isTypeSupported("audio/mpeg"),mp3:lt.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:lt.isTypeSupported('audio/mp4; codecs="ac-3"')},ct=navigator.vendor;if(this.useWorker&&typeof Worker<"u"&&(st.workerPath||hasUMDWorker())){try{st.workerPath?(logger.log(`loading Web Worker ${st.workerPath} for "${rt}"`),this.workerContext=loadWorker(st.workerPath)):(logger.log(`injecting Web Worker for "${rt}"`),this.workerContext=injectWorker()),this.onwmsg=ft=>this.onWorkerMessage(ft);const{worker:pt}=this.workerContext;pt.addEventListener("message",this.onwmsg),pt.onerror=ft=>{const gt=new Error(`${ft.message}  (${ft.filename}:${ft.lineno})`);st.enableWorker=!1,logger.warn(`Error in "${rt}" Web Worker, fallback to inline`),this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:gt})},pt.postMessage({cmd:"init",typeSupported:ut,vendor:ct,id:rt,config:JSON.stringify(st)})}catch(pt){logger.warn(`Error setting up "${rt}" Web Worker, fallback to inline`,pt),this.resetWorker(),this.error=null,this.transmuxer=new Transmuxer(this.observer,ut,st,ct,rt)}return}this.transmuxer=new Transmuxer(this.observer,ut,st,ct,rt)}resetWorker(){if(this.workerContext){const{worker:et,objectURL:rt}=this.workerContext;rt&&self.URL.revokeObjectURL(rt),et.removeEventListener("message",this.onwmsg),et.onerror=null,et.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const rt=this.transmuxer;rt&&(rt.destroy(),this.transmuxer=null)}const et=this.observer;et&&et.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(et,rt,nt,it,st,ot,lt,ut,ct,dt){var pt,ft;ct.transmuxing.start=self.performance.now();const{transmuxer:gt}=this,_r=ot?ot.start:st.start,Yr=st.decryptdata,mt=this.frag,Kr=!(mt&&st.cc===mt.cc),Xr=!(mt&&ct.level===mt.level),Zr=mt?ct.sn-mt.sn:-1,Qr=this.part?ct.part-this.part.index:-1,_i=Zr===0&&ct.id>1&&ct.id===(mt==null?void 0:mt.stats.chunkCount),ns=!Xr&&(Zr===1||Zr===0&&(Qr===1||_i&&Qr<=0)),rs=self.performance.now();(Xr||Zr||st.stats.parsing.start===0)&&(st.stats.parsing.start=rs),ot&&(Qr||!ns)&&(ot.stats.parsing.start=rs);const ss=!(mt&&((pt=st.initSegment)==null?void 0:pt.url)===((ft=mt.initSegment)==null?void 0:ft.url)),hs=new TransmuxState(Kr,ns,ut,Xr,_r,ss);if(!ns||Kr||ss){logger.log(`[transmuxer-interface, ${st.type}]: Starting new transmux session for sn: ${ct.sn} p: ${ct.part} level: ${ct.level} id: ${ct.id}
        discontinuity: ${Kr}
        trackSwitch: ${Xr}
        contiguous: ${ns}
        accurateTimeOffset: ${ut}
        timeOffset: ${_r}
        initSegmentChange: ${ss}`);const os=new TransmuxConfig(nt,it,rt,lt,dt);this.configureTransmuxer(os)}if(this.frag=st,this.part=ot,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:et,decryptdata:Yr,chunkMeta:ct,state:hs},et instanceof ArrayBuffer?[et]:[]);else if(gt){const os=gt.push(et,Yr,ct,hs);isPromise(os)?(gt.async=!0,os.then(is=>{this.handleTransmuxComplete(is)}).catch(is=>{this.transmuxerError(is,ct,"transmuxer-interface push error")})):(gt.async=!1,this.handleTransmuxComplete(os))}}flush(et){et.transmuxing.start=self.performance.now();const{transmuxer:rt}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:et});else if(rt){let nt=rt.flush(et);isPromise(nt)||rt.async?(isPromise(nt)||(nt=Promise.resolve(nt)),nt.then(st=>{this.handleFlushResult(st,et)}).catch(st=>{this.transmuxerError(st,et,"transmuxer-interface flush error")})):this.handleFlushResult(nt,et)}}transmuxerError(et,rt,nt){this.hls&&(this.error=et,this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:rt,fatal:!1,error:et,err:et,reason:nt}))}handleFlushResult(et,rt){et.forEach(nt=>{this.handleTransmuxComplete(nt)}),this.onFlush(rt)}onWorkerMessage(et){const rt=et.data,nt=this.hls;switch(rt.event){case"init":{var it;const st=(it=this.workerContext)==null?void 0:it.objectURL;st&&self.URL.revokeObjectURL(st);break}case"transmuxComplete":{this.handleTransmuxComplete(rt.data);break}case"flush":{this.onFlush(rt.data);break}case"workerLog":logger[rt.data.logType]&&logger[rt.data.logType](rt.data.message);break;default:{rt.data=rt.data||{},rt.data.frag=this.frag,rt.data.id=this.id,nt.trigger(rt.event,rt.data);break}}}configureTransmuxer(et){const{transmuxer:rt}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:et}):rt&&rt.configure(et)}handleTransmuxComplete(et){et.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(et)}}function subtitleOptionsIdentical(tt,et){if(tt.length!==et.length)return!1;for(let rt=0;rt<tt.length;rt++)if(!mediaAttributesIdentical(tt[rt].attrs,et[rt].attrs))return!1;return!0}function mediaAttributesIdentical(tt,et,rt){const nt=tt["STABLE-RENDITION-ID"];return nt&&!rt?nt===et["STABLE-RENDITION-ID"]:!(rt||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(it=>tt[it]!==et[it])}function subtitleTrackMatchesTextTrack(tt,et){return et.label.toLowerCase()===tt.name.toLowerCase()&&(!et.language||et.language.toLowerCase()===(tt.lang||"").toLowerCase())}const TICK_INTERVAL$2=100;class AudioStreamController extends BaseStreamController{constructor(et,rt,nt){super(et,rt,nt,"[audio-stream-controller]",PlaylistLevelType.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:et}=this;et.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),et.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),et.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),et.on(Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),et.on(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),et.on(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),et.on(Events.ERROR,this.onError,this),et.on(Events.BUFFER_RESET,this.onBufferReset,this),et.on(Events.BUFFER_CREATED,this.onBufferCreated,this),et.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),et.on(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),et.on(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),et.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:et}=this;et.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),et.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),et.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),et.off(Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),et.off(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),et.off(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),et.off(Events.ERROR,this.onError,this),et.off(Events.BUFFER_RESET,this.onBufferReset,this),et.off(Events.BUFFER_CREATED,this.onBufferCreated,this),et.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),et.off(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),et.off(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),et.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(et,{frag:rt,id:nt,initPTS:it,timescale:st}){if(nt==="main"){const ot=rt.cc;this.initPTS[rt.cc]={baseTime:it,timescale:st},this.log(`InitPTS for cc: ${ot} found from main: ${it}`),this.videoTrackCC=ot,this.state===State.WAITING_INIT_PTS&&this.tick()}}startLoad(et){if(!this.levels){this.startPosition=et,this.state=State.STOPPED;return}const rt=this.lastCurrentTime;this.stopLoad(),this.setInterval(TICK_INTERVAL$2),rt>0&&et===-1?(this.log(`Override startPosition with lastCurrentTime @${rt.toFixed(3)}`),et=rt,this.state=State.IDLE):(this.loadedmetadata=!1,this.state=State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=et,this.tick()}doTick(){switch(this.state){case State.IDLE:this.doTickIdle();break;case State.WAITING_TRACK:{var et;const{levels:nt,trackId:it}=this,st=nt==null||(et=nt[it])==null?void 0:et.details;if(st){if(this.waitForCdnTuneIn(st))break;this.state=State.WAITING_INIT_PTS}break}case State.FRAG_LOADING_WAITING_RETRY:{var rt;const nt=performance.now(),it=this.retryDate;if(!it||nt>=it||(rt=this.media)!=null&&rt.seeking){const{levels:st,trackId:ot}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((st==null?void 0:st[ot])||null),this.state=State.IDLE}break}case State.WAITING_INIT_PTS:{const nt=this.waitingData;if(nt){const{frag:it,part:st,cache:ot,complete:lt}=nt;if(this.initPTS[it.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=State.FRAG_LOADING;const ut=ot.flush(),ct={frag:it,part:st,payload:ut,networkDetails:null};this._handleFragmentLoadProgress(ct),lt&&super._handleFragmentLoadComplete(ct)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${it.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const ut=this.getLoadPosition(),ct=BufferHelper.bufferInfo(this.mediaBuffer,ut,this.config.maxBufferHole);fragmentWithinToleranceTest(ct.end,this.config.maxFragLookUpTolerance,it)<0&&(this.log(`Waiting fragment cc (${it.cc}) @ ${it.start} cancelled because another fragment at ${ct.end} is needed`),this.clearWaitingFragment())}}else this.state=State.IDLE}}this.onTickEnd()}clearWaitingFragment(){const et=this.waitingData;et&&(this.fragmentTracker.removeFragment(et.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=State.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:et}=this;et!=null&&et.readyState&&(this.lastCurrentTime=et.currentTime)}doTickIdle(){const{hls:et,levels:rt,media:nt,trackId:it}=this,st=et.config;if(!nt&&(this.startFragRequested||!st.startFragPrefetch)||!(rt!=null&&rt[it]))return;const ot=rt[it],lt=ot.details;if(!lt||lt.live&&this.levelLastLoaded!==ot||this.waitForCdnTuneIn(lt)){this.state=State.WAITING_TRACK;return}const ut=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&ut&&(this.bufferFlushed=!1,this.afterBufferFlushed(ut,ElementaryStreamTypes.AUDIO,PlaylistLevelType.AUDIO));const ct=this.getFwdBufferInfo(ut,PlaylistLevelType.AUDIO);if(ct===null)return;const{bufferedTrack:dt,switchingTrack:pt}=this;if(!pt&&this._streamEnded(ct,lt)){et.trigger(Events.BUFFER_EOS,{type:"audio"}),this.state=State.ENDED;return}const ft=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,PlaylistLevelType.MAIN),gt=ct.len,_r=this.getMaxBufferLength(ft==null?void 0:ft.len),Yr=lt.fragments,mt=Yr[0].start;let Kr=this.flushing?this.getLoadPosition():ct.end;if(pt&&nt){const _i=this.getLoadPosition();dt&&!mediaAttributesIdentical(pt.attrs,dt.attrs)&&(Kr=_i),lt.PTSKnown&&_i<mt&&(ct.end>mt||ct.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),nt.currentTime=mt+.05)}if(gt>=_r&&!pt&&Kr<Yr[Yr.length-1].start)return;let Xr=this.getNextFragment(Kr,lt),Zr=!1;if(Xr&&this.isLoopLoading(Xr,Kr)&&(Zr=!!Xr.gap,Xr=this.getNextFragmentLoopLoading(Xr,lt,ct,PlaylistLevelType.MAIN,_r)),!Xr){this.bufferFlushed=!0;return}const Qr=ft&&Xr.start>ft.end+lt.targetduration;if(Qr||!(ft!=null&&ft.len)&&ct.len){const _i=this.getAppendedFrag(Xr.start,PlaylistLevelType.MAIN);if(_i===null||(Zr||(Zr=!!_i.gap||!!Qr&&ft.len===0),Qr&&!Zr||Zr&&ct.nextStart&&ct.nextStart<_i.end))return}this.loadFragment(Xr,ot,Kr)}getMaxBufferLength(et){const rt=super.getMaxBufferLength();return et?Math.min(Math.max(rt,et),this.config.maxMaxBufferLength):rt}onMediaDetaching(){this.videoBuffer=null,this.bufferFlushed=this.flushing=!1,super.onMediaDetaching()}onAudioTracksUpdated(et,{audioTracks:rt}){this.resetTransmuxer(),this.levels=rt.map(nt=>new Level(nt))}onAudioTrackSwitching(et,rt){const nt=!!rt.url;this.trackId=rt.id;const{fragCurrent:it}=this;it&&(it.abortRequests(),this.removeUnbufferedFrags(it.start)),this.resetLoadingState(),nt?this.setInterval(TICK_INTERVAL$2):this.resetTransmuxer(),nt?(this.switchingTrack=rt,this.state=State.IDLE,this.flushAudioIfNeeded(rt)):(this.switchingTrack=null,this.bufferedTrack=rt,this.state=State.STOPPED),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=this.flushing=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(et,rt){this.mainDetails=rt.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(et,rt){var nt;if(this.mainDetails==null){this.cachedTrackLoadedData=rt;return}const{levels:it}=this,{details:st,id:ot}=rt;if(!it){this.warn(`Audio tracks were reset while loading level ${ot}`);return}this.log(`Audio track ${ot} loaded [${st.startSN},${st.endSN}]${st.lastPartSn?`[part-${st.lastPartSn}-${st.lastPartIndex}]`:""},duration:${st.totalduration}`);const lt=it[ot];let ut=0;if(st.live||(nt=lt.details)!=null&&nt.live){this.checkLiveUpdate(st);const dt=this.mainDetails;if(st.deltaUpdateFailed||!dt)return;if(!lt.details&&st.hasProgramDateTime&&dt.hasProgramDateTime)alignMediaPlaylistByPDT(st,dt),ut=st.fragments[0].start;else{var ct;ut=this.alignPlaylists(st,lt.details,(ct=this.levelLastLoaded)==null?void 0:ct.details)}}lt.details=st,this.levelLastLoaded=lt,!this.startFragRequested&&(this.mainDetails||!st.live)&&this.setStartPosition(lt.details,ut),this.state===State.WAITING_TRACK&&!this.waitForCdnTuneIn(st)&&(this.state=State.IDLE),this.tick()}_handleFragmentLoadProgress(et){var rt;const{frag:nt,part:it,payload:st}=et,{config:ot,trackId:lt,levels:ut}=this;if(!ut){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${nt.sn} of level ${nt.level} will not be buffered`);return}const ct=ut[lt];if(!ct){this.warn("Audio track is undefined on fragment load progress");return}const dt=ct.details;if(!dt){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(nt.start);return}const pt=ot.defaultAudioCodec||ct.audioCodec||"mp4a.40.2";let ft=this.transmuxer;ft||(ft=this.transmuxer=new TransmuxerInterface(this.hls,PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const gt=this.initPTS[nt.cc],_r=(rt=nt.initSegment)==null?void 0:rt.data;if(gt!==void 0){const mt=it?it.index:-1,Kr=mt!==-1,Xr=new ChunkMetadata(nt.level,nt.sn,nt.stats.chunkCount,st.byteLength,mt,Kr);ft.push(st,_r,pt,"",nt,it,dt.totalduration,!1,Xr,gt)}else{this.log(`Unknown video PTS for cc ${nt.cc}, waiting for video PTS before demuxing audio frag ${nt.sn} of [${dt.startSN} ,${dt.endSN}],track ${lt}`);const{cache:Yr}=this.waitingData=this.waitingData||{frag:nt,part:it,cache:new ChunkCache,complete:!1};Yr.push(new Uint8Array(st)),this.waitingVideoCC=this.videoTrackCC,this.state=State.WAITING_INIT_PTS}}_handleFragmentLoadComplete(et){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(et)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(et,rt){const nt=rt.tracks.audio;nt&&(this.mediaBuffer=nt.buffer||null),rt.tracks.video&&(this.videoBuffer=rt.tracks.video.buffer||null)}onFragBuffered(et,rt){const{frag:nt,part:it}=rt;if(nt.type!==PlaylistLevelType.AUDIO){if(!this.loadedmetadata&&nt.type===PlaylistLevelType.MAIN){const st=this.videoBuffer||this.media;st&&BufferHelper.getBuffered(st).length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(nt)){this.warn(`Fragment ${nt.sn}${it?" p: "+it.index:""} of level ${nt.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(nt.sn!=="initSegment"){this.fragPrevious=nt;const st=this.switchingTrack;st&&(this.bufferedTrack=st,this.switchingTrack=null,this.hls.trigger(Events.AUDIO_TRACK_SWITCHED,_objectSpread2({},st)))}this.fragBufferedComplete(nt,it)}onError(et,rt){var nt;if(rt.fatal){this.state=State.ERROR;return}switch(rt.details){case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_PARSING_ERROR:case ErrorDetails.FRAG_DECRYPT_ERROR:case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(PlaylistLevelType.AUDIO,rt);break;case ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case ErrorDetails.LEVEL_PARSING_ERROR:!rt.levelRetry&&this.state===State.WAITING_TRACK&&((nt=rt.context)==null?void 0:nt.type)===PlaylistContextType.AUDIO_TRACK&&(this.state=State.IDLE);break;case ErrorDetails.BUFFER_APPEND_ERROR:case ErrorDetails.BUFFER_FULL_ERROR:if(!rt.parent||rt.parent!=="audio")return;if(rt.details===ErrorDetails.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(rt)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case ErrorDetails.INTERNAL_EXCEPTION:this.recoverWorkerError(rt);break}}onBufferFlushing(et,{type:rt}){rt!==ElementaryStreamTypes.VIDEO&&(this.flushing=!0)}onBufferFlushed(et,{type:rt}){if(rt!==ElementaryStreamTypes.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===State.ENDED&&(this.state=State.IDLE);const nt=this.mediaBuffer||this.media;nt&&(this.afterBufferFlushed(nt,rt,PlaylistLevelType.AUDIO),this.tick())}}_handleTransmuxComplete(et){var rt;const nt="audio",{hls:it}=this,{remuxResult:st,chunkMeta:ot}=et,lt=this.getCurrentContext(ot);if(!lt){this.resetWhenMissingContext(ot);return}const{frag:ut,part:ct,level:dt}=lt,{details:pt}=dt,{audio:ft,text:gt,id3:_r,initSegment:Yr}=st;if(this.fragContextChanged(ut)||!pt){this.fragmentTracker.removeFragment(ut);return}if(this.state=State.PARSING,this.switchingTrack&&ft&&this.completeAudioSwitch(this.switchingTrack),Yr!=null&&Yr.tracks){const mt=ut.initSegment||ut;this._bufferInitSegment(dt,Yr.tracks,mt,ot),it.trigger(Events.FRAG_PARSING_INIT_SEGMENT,{frag:mt,id:nt,tracks:Yr.tracks})}if(ft){const{startPTS:mt,endPTS:Kr,startDTS:Xr,endDTS:Zr}=ft;ct&&(ct.elementaryStreams[ElementaryStreamTypes.AUDIO]={startPTS:mt,endPTS:Kr,startDTS:Xr,endDTS:Zr}),ut.setElementaryStreamInfo(ElementaryStreamTypes.AUDIO,mt,Kr,Xr,Zr),this.bufferFragmentData(ft,ut,ct,ot)}if(_r!=null&&(rt=_r.samples)!=null&&rt.length){const mt=_extends({id:nt,frag:ut,details:pt},_r);it.trigger(Events.FRAG_PARSING_METADATA,mt)}if(gt){const mt=_extends({id:nt,frag:ut,details:pt},gt);it.trigger(Events.FRAG_PARSING_USERDATA,mt)}}_bufferInitSegment(et,rt,nt,it){if(this.state!==State.PARSING)return;rt.video&&delete rt.video;const st=rt.audio;if(!st)return;st.id="audio";const ot=et.audioCodec;this.log(`Init audio buffer, container:${st.container}, codecs[level/parsed]=[${ot}/${st.codec}]`),ot&&ot.split(",").length===1&&(st.levelCodec=ot),this.hls.trigger(Events.BUFFER_CODECS,rt);const lt=st.initSegment;if(lt!=null&&lt.byteLength){const ut={type:"audio",frag:nt,part:null,chunkMeta:it,parent:nt.type,data:lt};this.hls.trigger(Events.BUFFER_APPENDING,ut)}this.tickImmediate()}loadFragment(et,rt,nt){const it=this.fragmentTracker.getState(et);if(this.fragCurrent=et,this.switchingTrack||it===FragmentState.NOT_LOADED||it===FragmentState.PARTIAL){var st;if(et.sn==="initSegment")this._loadInitSegment(et,rt);else if((st=rt.details)!=null&&st.live&&!this.initPTS[et.cc]){this.log(`Waiting for video PTS in continuity counter ${et.cc} of live stream before loading audio fragment ${et.sn} of level ${this.trackId}`),this.state=State.WAITING_INIT_PTS;const ot=this.mainDetails;ot&&ot.fragments[0].start!==rt.details.fragments[0].start&&alignMediaPlaylistByPDT(rt.details,ot)}else this.startFragRequested=!0,super.loadFragment(et,rt,nt)}else this.clearTrackerIfNeeded(et)}flushAudioIfNeeded(et){const{media:rt,bufferedTrack:nt}=this,it=nt==null?void 0:nt.attrs,st=et.attrs;rt&&it&&(it.CHANNELS!==st.CHANNELS||nt.name!==et.name||nt.lang!==et.lang)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null)}completeAudioSwitch(et){const{hls:rt}=this;this.flushAudioIfNeeded(et),this.bufferedTrack=et,this.switchingTrack=null,rt.trigger(Events.AUDIO_TRACK_SWITCHED,_objectSpread2({},et))}}class AudioTrackController extends BasePlaylistController{constructor(et){super(et,"[audio-track-controller]"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:et}=this;et.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),et.on(Events.LEVEL_LOADING,this.onLevelLoading,this),et.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),et.on(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),et.on(Events.ERROR,this.onError,this)}unregisterListeners(){const{hls:et}=this;et.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),et.off(Events.LEVEL_LOADING,this.onLevelLoading,this),et.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),et.off(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),et.off(Events.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(et,rt){this.tracks=rt.audioTracks||[]}onAudioTrackLoaded(et,rt){const{id:nt,groupId:it,details:st}=rt,ot=this.tracksInGroup[nt];if(!ot||ot.groupId!==it){this.warn(`Audio track with id:${nt} and group:${it} not found in active group ${ot==null?void 0:ot.groupId}`);return}const lt=ot.details;ot.details=rt.details,this.log(`Audio track ${nt} "${ot.name}" lang:${ot.lang} group:${it} loaded [${st.startSN}-${st.endSN}]`),nt===this.trackId&&this.playlistLoaded(nt,rt,lt)}onLevelLoading(et,rt){this.switchLevel(rt.level)}onLevelSwitching(et,rt){this.switchLevel(rt.level)}switchLevel(et){const rt=this.hls.levels[et];if(!rt)return;const nt=rt.audioGroups||null,it=this.groupIds;let st=this.currentTrack;if(!nt||(it==null?void 0:it.length)!==(nt==null?void 0:nt.length)||nt!=null&&nt.some(lt=>(it==null?void 0:it.indexOf(lt))===-1)){this.groupIds=nt,this.trackId=-1,this.currentTrack=null;const lt=this.tracks.filter(ft=>!nt||nt.indexOf(ft.groupId)!==-1);if(lt.length)this.selectDefaultTrack&&!lt.some(ft=>ft.default)&&(this.selectDefaultTrack=!1),lt.forEach((ft,gt)=>{ft.id=gt});else if(!st&&!this.tracksInGroup.length)return;this.tracksInGroup=lt;const ut=this.hls.config.audioPreference;if(!st&&ut){const ft=findMatchingOption(ut,lt,audioMatchPredicate);if(ft>-1)st=lt[ft];else{const gt=findMatchingOption(ut,this.tracks);st=this.tracks[gt]}}let ct=this.findTrackId(st);ct===-1&&st&&(ct=this.findTrackId(null));const dt={audioTracks:lt};this.log(`Updating audio tracks, ${lt.length} track(s) found in group(s): ${nt==null?void 0:nt.join(",")}`),this.hls.trigger(Events.AUDIO_TRACKS_UPDATED,dt);const pt=this.trackId;if(ct!==-1&&pt===-1)this.setAudioTrack(ct);else if(lt.length&&pt===-1){var ot;const ft=new Error(`No audio track selected for current audio group-ID(s): ${(ot=this.groupIds)==null?void 0:ot.join(",")} track count: ${lt.length}`);this.warn(ft.message),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:ft})}}else this.shouldReloadPlaylist(st)&&this.setAudioTrack(this.trackId)}onError(et,rt){rt.fatal||!rt.context||rt.context.type===PlaylistContextType.AUDIO_TRACK&&rt.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(rt.context.groupId)!==-1)&&(this.requestScheduled=-1,this.checkRetry(rt))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(et){this.selectDefaultTrack=!1,this.setAudioTrack(et)}setAudioOption(et){const rt=this.hls;if(rt.config.audioPreference=et,et){const nt=this.allAudioTracks;if(this.selectDefaultTrack=!1,nt.length){const it=this.currentTrack;if(it&&matchesOption(et,it,audioMatchPredicate))return it;const st=findMatchingOption(et,this.tracksInGroup,audioMatchPredicate);if(st>-1){const ot=this.tracksInGroup[st];return this.setAudioTrack(st),ot}else if(it){let ot=rt.loadLevel;ot===-1&&(ot=rt.firstAutoLevel);const lt=findClosestLevelWithAudioGroup(et,rt.levels,nt,ot,audioMatchPredicate);if(lt===-1)return null;rt.nextLoadLevel=lt}if(et.channels||et.audioCodec){const ot=findMatchingOption(et,nt);if(ot>-1)return nt[ot]}}}return null}setAudioTrack(et){const rt=this.tracksInGroup;if(et<0||et>=rt.length){this.warn(`Invalid audio track id: ${et}`);return}this.clearTimer(),this.selectDefaultTrack=!1;const nt=this.currentTrack,it=rt[et],st=it.details&&!it.details.live;if(et===this.trackId&&it===nt&&st||(this.log(`Switching to audio-track ${et} "${it.name}" lang:${it.lang} group:${it.groupId} channels:${it.channels}`),this.trackId=et,this.currentTrack=it,this.hls.trigger(Events.AUDIO_TRACK_SWITCHING,_objectSpread2({},it)),st))return;const ot=this.switchParams(it.url,nt==null?void 0:nt.details);this.loadPlaylist(ot)}findTrackId(et){const rt=this.tracksInGroup;for(let nt=0;nt<rt.length;nt++){const it=rt[nt];if(!(this.selectDefaultTrack&&!it.default)&&(!et||matchesOption(et,it,audioMatchPredicate)))return nt}if(et){const{name:nt,lang:it,assocLang:st,characteristics:ot,audioCodec:lt,channels:ut}=et;for(let ct=0;ct<rt.length;ct++){const dt=rt[ct];if(matchesOption({name:nt,lang:it,assocLang:st,characteristics:ot,audioCodec:lt,channels:ut},dt,audioMatchPredicate))return ct}for(let ct=0;ct<rt.length;ct++){const dt=rt[ct];if(mediaAttributesIdentical(et.attrs,dt.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return ct}for(let ct=0;ct<rt.length;ct++){const dt=rt[ct];if(mediaAttributesIdentical(et.attrs,dt.attrs,["LANGUAGE"]))return ct}}return-1}loadPlaylist(et){const rt=this.currentTrack;if(this.shouldLoadPlaylist(rt)&&rt){super.loadPlaylist();const nt=rt.id,it=rt.groupId;let st=rt.url;if(et)try{st=et.addDirectives(st)}catch(ot){this.warn(`Could not construct new URL with HLS Delivery Directives: ${ot}`)}this.log(`loading audio-track playlist ${nt} "${rt.name}" lang:${rt.lang} group:${it}`),this.clearTimer(),this.hls.trigger(Events.AUDIO_TRACK_LOADING,{url:st,id:nt,groupId:it,deliveryDirectives:et||null})}}}const TICK_INTERVAL$1=500;class SubtitleStreamController extends BaseStreamController{constructor(et,rt,nt){super(et,rt,nt,"[subtitle-stream-controller]",PlaylistLevelType.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}_registerListeners(){const{hls:et}=this;et.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),et.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),et.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),et.on(Events.ERROR,this.onError,this),et.on(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),et.on(Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),et.on(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),et.on(Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),et.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),et.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:et}=this;et.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),et.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),et.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),et.off(Events.ERROR,this.onError,this),et.off(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),et.off(Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),et.off(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),et.off(Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),et.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),et.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(et){this.stopLoad(),this.state=State.IDLE,this.setInterval(TICK_INTERVAL$1),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=et,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(et,rt){this.mainDetails=rt.details}onSubtitleFragProcessed(et,rt){const{frag:nt,success:it}=rt;if(this.fragPrevious=nt,this.state=State.IDLE,!it)return;const st=this.tracksBuffered[this.currentTrackId];if(!st)return;let ot;const lt=nt.start;for(let ct=0;ct<st.length;ct++)if(lt>=st[ct].start&&lt<=st[ct].end){ot=st[ct];break}const ut=nt.start+nt.duration;ot?ot.end=ut:(ot={start:lt,end:ut},st.push(ot)),this.fragmentTracker.fragBuffered(nt),this.fragBufferedComplete(nt,null)}onBufferFlushing(et,rt){const{startOffset:nt,endOffset:it}=rt;if(nt===0&&it!==Number.POSITIVE_INFINITY){const st=it-1;if(st<=0)return;rt.endOffsetSubtitles=Math.max(0,st),this.tracksBuffered.forEach(ot=>{for(let lt=0;lt<ot.length;){if(ot[lt].end<=st){ot.shift();continue}else if(ot[lt].start<st)ot[lt].start=st;else break;lt++}}),this.fragmentTracker.removeFragmentsInRange(nt,st,PlaylistLevelType.SUBTITLE)}}onFragBuffered(et,rt){if(!this.loadedmetadata&&rt.frag.type===PlaylistLevelType.MAIN){var nt;(nt=this.media)!=null&&nt.buffered.length&&(this.loadedmetadata=!0)}}onError(et,rt){const nt=rt.frag;(nt==null?void 0:nt.type)===PlaylistLevelType.SUBTITLE&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==State.STOPPED&&(this.state=State.IDLE))}onSubtitleTracksUpdated(et,{subtitleTracks:rt}){if(!this.levels||subtitleOptionsIdentical(this.levels,rt)){this.levels=rt.map(nt=>new Level(nt));return}this.tracksBuffered=[],this.levels=rt.map(nt=>{const it=new Level(nt);return this.tracksBuffered[it.id]=[],it}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,PlaylistLevelType.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(et,rt){var nt;if(this.currentTrackId=rt.id,!((nt=this.levels)!=null&&nt.length)||this.currentTrackId===-1){this.clearInterval();return}const it=this.levels[this.currentTrackId];it!=null&&it.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,it&&this.setInterval(TICK_INTERVAL$1)}onSubtitleTrackLoaded(et,rt){var nt;const{currentTrackId:it,levels:st}=this,{details:ot,id:lt}=rt;if(!st){this.warn(`Subtitle tracks were reset while loading level ${lt}`);return}const ut=st[it];if(lt>=st.length||lt!==it||!ut)return;this.log(`Subtitle track ${lt} loaded [${ot.startSN},${ot.endSN}]${ot.lastPartSn?`[part-${ot.lastPartSn}-${ot.lastPartIndex}]`:""},duration:${ot.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let ct=0;if(ot.live||(nt=ut.details)!=null&&nt.live){const pt=this.mainDetails;if(ot.deltaUpdateFailed||!pt)return;const ft=pt.fragments[0];if(!ut.details)ot.hasProgramDateTime&&pt.hasProgramDateTime?(alignMediaPlaylistByPDT(ot,pt),ct=ot.fragments[0].start):ft&&(ct=ft.start,addSliding(ot,ct));else{var dt;ct=this.alignPlaylists(ot,ut.details,(dt=this.levelLastLoaded)==null?void 0:dt.details),ct===0&&ft&&(ct=ft.start,addSliding(ot,ct))}}ut.details=ot,this.levelLastLoaded=ut,!this.startFragRequested&&(this.mainDetails||!ot.live)&&this.setStartPosition(ut.details,ct),this.tick(),ot.live&&!this.fragCurrent&&this.media&&this.state===State.IDLE&&(findFragmentByPTS(null,ot.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),ut.details=void 0))}_handleFragmentLoadComplete(et){const{frag:rt,payload:nt}=et,it=rt.decryptdata,st=this.hls;if(!this.fragContextChanged(rt)&&nt&&nt.byteLength>0&&it!=null&&it.key&&it.iv&&it.method==="AES-128"){const ot=performance.now();this.decrypter.decrypt(new Uint8Array(nt),it.key.buffer,it.iv.buffer).catch(lt=>{throw st.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!1,error:lt,reason:lt.message,frag:rt}),lt}).then(lt=>{const ut=performance.now();st.trigger(Events.FRAG_DECRYPTED,{frag:rt,payload:lt,stats:{tstart:ot,tdecrypt:ut}})}).catch(lt=>{this.warn(`${lt.name}: ${lt.message}`),this.state=State.IDLE})}}doTick(){if(!this.media){this.state=State.IDLE;return}if(this.state===State.IDLE){const{currentTrackId:et,levels:rt}=this,nt=rt==null?void 0:rt[et];if(!nt||!rt.length||!nt.details)return;const{config:it}=this,st=this.getLoadPosition(),ot=BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],st,it.maxBufferHole),{end:lt,len:ut}=ot,ct=this.getFwdBufferInfo(this.media,PlaylistLevelType.MAIN),dt=nt.details,pt=this.getMaxBufferLength(ct==null?void 0:ct.len)+dt.levelTargetDuration;if(ut>pt)return;const ft=dt.fragments,gt=ft.length,_r=dt.edge;let Yr=null;const mt=this.fragPrevious;if(lt<_r){const Kr=it.maxFragLookUpTolerance,Xr=lt>_r-Kr?0:Kr;Yr=findFragmentByPTS(mt,ft,Math.max(ft[0].start,lt),Xr),!Yr&&mt&&mt.start<ft[0].start&&(Yr=ft[0])}else Yr=ft[gt-1];if(!Yr)return;if(Yr=this.mapToInitFragWhenRequired(Yr),Yr.sn!=="initSegment"){const Kr=Yr.sn-dt.startSN,Xr=ft[Kr-1];Xr&&Xr.cc===Yr.cc&&this.fragmentTracker.getState(Xr)===FragmentState.NOT_LOADED&&(Yr=Xr)}this.fragmentTracker.getState(Yr)===FragmentState.NOT_LOADED&&this.loadFragment(Yr,nt,lt)}}getMaxBufferLength(et){const rt=super.getMaxBufferLength();return et?Math.max(rt,et):rt}loadFragment(et,rt,nt){this.fragCurrent=et,et.sn==="initSegment"?this._loadInitSegment(et,rt):(this.startFragRequested=!0,super.loadFragment(et,rt,nt))}get mediaBufferTimeRanges(){return new BufferableInstance(this.tracksBuffered[this.currentTrackId]||[])}}class BufferableInstance{constructor(et){this.buffered=void 0;const rt=(nt,it,st)=>{if(it=it>>>0,it>st-1)throw new DOMException(`Failed to execute '${nt}' on 'TimeRanges': The index provided (${it}) is greater than the maximum bound (${st})`);return et[it][nt]};this.buffered={get length(){return et.length},end(nt){return rt("end",nt,et.length)},start(nt){return rt("start",nt,et.length)}}}}class SubtitleTrackController extends BasePlaylistController{constructor(et){super(et,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let rt=null;const nt=filterSubtitleTracks(this.media.textTracks);for(let st=0;st<nt.length;st++)if(nt[st].mode==="hidden")rt=nt[st];else if(nt[st].mode==="showing"){rt=nt[st];break}const it=this.findTrackForTextTrack(rt);this.subtitleTrack!==it&&this.setSubtitleTrack(it)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(et){this._subtitleDisplay=et,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:et}=this;et.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),et.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),et.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),et.on(Events.LEVEL_LOADING,this.onLevelLoading,this),et.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),et.on(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),et.on(Events.ERROR,this.onError,this)}unregisterListeners(){const{hls:et}=this;et.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),et.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),et.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),et.off(Events.LEVEL_LOADING,this.onLevelLoading,this),et.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),et.off(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),et.off(Events.ERROR,this.onError,this)}onMediaAttached(et,rt){this.media=rt.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(et){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,et)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),filterSubtitleTracks(this.media.textTracks).forEach(rt=>{clearCurrentCues(rt)}),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(et,rt){this.tracks=rt.subtitleTracks}onSubtitleTrackLoaded(et,rt){const{id:nt,groupId:it,details:st}=rt,ot=this.tracksInGroup[nt];if(!ot||ot.groupId!==it){this.warn(`Subtitle track with id:${nt} and group:${it} not found in active group ${ot==null?void 0:ot.groupId}`);return}const lt=ot.details;ot.details=rt.details,this.log(`Subtitle track ${nt} "${ot.name}" lang:${ot.lang} group:${it} loaded [${st.startSN}-${st.endSN}]`),nt===this.trackId&&this.playlistLoaded(nt,rt,lt)}onLevelLoading(et,rt){this.switchLevel(rt.level)}onLevelSwitching(et,rt){this.switchLevel(rt.level)}switchLevel(et){const rt=this.hls.levels[et];if(!rt)return;const nt=rt.subtitleGroups||null,it=this.groupIds;let st=this.currentTrack;if(!nt||(it==null?void 0:it.length)!==(nt==null?void 0:nt.length)||nt!=null&&nt.some(ot=>(it==null?void 0:it.indexOf(ot))===-1)){this.groupIds=nt,this.trackId=-1,this.currentTrack=null;const ot=this.tracks.filter(dt=>!nt||nt.indexOf(dt.groupId)!==-1);if(ot.length)this.selectDefaultTrack&&!ot.some(dt=>dt.default)&&(this.selectDefaultTrack=!1),ot.forEach((dt,pt)=>{dt.id=pt});else if(!st&&!this.tracksInGroup.length)return;this.tracksInGroup=ot;const lt=this.hls.config.subtitlePreference;if(!st&&lt){this.selectDefaultTrack=!1;const dt=findMatchingOption(lt,ot);if(dt>-1)st=ot[dt];else{const pt=findMatchingOption(lt,this.tracks);st=this.tracks[pt]}}let ut=this.findTrackId(st);ut===-1&&st&&(ut=this.findTrackId(null));const ct={subtitleTracks:ot};this.log(`Updating subtitle tracks, ${ot.length} track(s) found in "${nt==null?void 0:nt.join(",")}" group-id`),this.hls.trigger(Events.SUBTITLE_TRACKS_UPDATED,ct),ut!==-1&&this.trackId===-1&&this.setSubtitleTrack(ut)}else this.shouldReloadPlaylist(st)&&this.setSubtitleTrack(this.trackId)}findTrackId(et){const rt=this.tracksInGroup,nt=this.selectDefaultTrack;for(let it=0;it<rt.length;it++){const st=rt[it];if(!(nt&&!st.default||!nt&&!et)&&(!et||matchesOption(st,et)))return it}if(et){for(let it=0;it<rt.length;it++){const st=rt[it];if(mediaAttributesIdentical(et.attrs,st.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return it}for(let it=0;it<rt.length;it++){const st=rt[it];if(mediaAttributesIdentical(et.attrs,st.attrs,["LANGUAGE"]))return it}}return-1}findTrackForTextTrack(et){if(et){const rt=this.tracksInGroup;for(let nt=0;nt<rt.length;nt++){const it=rt[nt];if(subtitleTrackMatchesTextTrack(it,et))return nt}}return-1}onError(et,rt){rt.fatal||!rt.context||rt.context.type===PlaylistContextType.SUBTITLE_TRACK&&rt.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(rt.context.groupId)!==-1)&&this.checkRetry(rt)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(et){this.selectDefaultTrack=!1,this.setSubtitleTrack(et)}setSubtitleOption(et){if(this.hls.config.subtitlePreference=et,et){const rt=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,rt.length){const nt=this.currentTrack;if(nt&&matchesOption(et,nt))return nt;const it=findMatchingOption(et,this.tracksInGroup);if(it>-1){const st=this.tracksInGroup[it];return this.setSubtitleTrack(it),st}else{if(nt)return null;{const st=findMatchingOption(et,rt);if(st>-1)return rt[st]}}}}return null}loadPlaylist(et){super.loadPlaylist();const rt=this.currentTrack;if(this.shouldLoadPlaylist(rt)&&rt){const nt=rt.id,it=rt.groupId;let st=rt.url;if(et)try{st=et.addDirectives(st)}catch(ot){this.warn(`Could not construct new URL with HLS Delivery Directives: ${ot}`)}this.log(`Loading subtitle playlist for id ${nt}`),this.hls.trigger(Events.SUBTITLE_TRACK_LOADING,{url:st,id:nt,groupId:it,deliveryDirectives:et||null})}}toggleTrackModes(){const{media:et}=this;if(!et)return;const rt=filterSubtitleTracks(et.textTracks),nt=this.currentTrack;let it;if(nt&&(it=rt.filter(st=>subtitleTrackMatchesTextTrack(nt,st))[0],it||this.warn(`Unable to find subtitle TextTrack with name "${nt.name}" and language "${nt.lang}"`)),[].slice.call(rt).forEach(st=>{st.mode!=="disabled"&&st!==it&&(st.mode="disabled")}),it){const st=this.subtitleDisplay?"showing":"hidden";it.mode!==st&&(it.mode=st)}}setSubtitleTrack(et){const rt=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=et;return}if(et<-1||et>=rt.length||!isFiniteNumber(et)){this.warn(`Invalid subtitle track id: ${et}`);return}this.clearTimer(),this.selectDefaultTrack=!1;const nt=this.currentTrack,it=rt[et]||null;if(this.trackId=et,this.currentTrack=it,this.toggleTrackModes(),!it){this.hls.trigger(Events.SUBTITLE_TRACK_SWITCH,{id:et});return}const st=!!it.details&&!it.details.live;if(et===this.trackId&&it===nt&&st)return;this.log(`Switching to subtitle-track ${et}`+(it?` "${it.name}" lang:${it.lang} group:${it.groupId}`:""));const{id:ot,groupId:lt="",name:ut,type:ct,url:dt}=it;this.hls.trigger(Events.SUBTITLE_TRACK_SWITCH,{id:ot,groupId:lt,name:ut,type:ct,url:dt});const pt=this.switchParams(it.url,nt==null?void 0:nt.details);this.loadPlaylist(pt)}}class BufferOperationQueue{constructor(et){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=et}append(et,rt,nt){const it=this.queues[rt];it.push(et),it.length===1&&!nt&&this.executeNext(rt)}insertAbort(et,rt){this.queues[rt].unshift(et),this.executeNext(rt)}appendBlocker(et){let rt;const nt=new Promise(st=>{rt=st}),it={execute:rt,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(it,et),nt}executeNext(et){const rt=this.queues[et];if(rt.length){const nt=rt[0];try{nt.execute()}catch(it){logger.warn(`[buffer-operation-queue]: Exception executing "${et}" SourceBuffer operation: ${it}`),nt.onError(it);const st=this.buffers[et];st!=null&&st.updating||this.shiftAndExecuteNext(et)}}}shiftAndExecuteNext(et){this.queues[et].shift(),this.executeNext(et)}current(et){return this.queues[et][0]}}const VIDEO_CODEC_PROFILE_REPLACE=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/;class BufferController{constructor(et){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendSource=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this.log=void 0,this.warn=void 0,this.error=void 0,this._onEndStreaming=nt=>{this.hls&&this.hls.pauseBuffering()},this._onStartStreaming=nt=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=()=>{const{media:nt,mediaSource:it}=this;this.log("Media source opened"),nt&&(nt.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(Events.MEDIA_ATTACHED,{media:nt,mediaSource:it})),it&&it.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:nt,_objectUrl:it}=this;nt!==it&&logger.error(`Media element src was set while attaching MediaSource (${it} > ${nt})`)},this.hls=et;const rt="[buffer-controller]";this.appendSource=et.config.preferManagedMediaSource,this.log=logger.log.bind(logger,rt),this.warn=logger.warn.bind(logger,rt),this.error=logger.error.bind(logger,rt),this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null,this.hls=null}registerListeners(){const{hls:et}=this;et.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),et.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),et.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),et.on(Events.BUFFER_RESET,this.onBufferReset,this),et.on(Events.BUFFER_APPENDING,this.onBufferAppending,this),et.on(Events.BUFFER_CODECS,this.onBufferCodecs,this),et.on(Events.BUFFER_EOS,this.onBufferEos,this),et.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),et.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this),et.on(Events.FRAG_PARSED,this.onFragParsed,this),et.on(Events.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:et}=this;et.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),et.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),et.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),et.off(Events.BUFFER_RESET,this.onBufferReset,this),et.off(Events.BUFFER_APPENDING,this.onBufferAppending,this),et.off(Events.BUFFER_CODECS,this.onBufferCodecs,this),et.off(Events.BUFFER_EOS,this.onBufferEos,this),et.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),et.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this),et.off(Events.FRAG_PARSED,this.onFragParsed,this),et.off(Events.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new BufferOperationQueue(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.appendErrors={audio:0,video:0,audiovideo:0},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(et,rt){let nt=2;(rt.audio&&!rt.video||!rt.altAudio)&&(nt=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=nt,this.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(et,rt){const nt=this.media=rt.media,it=getMediaSource(this.appendSource);if(nt&&it){var st;const ot=this.mediaSource=new it;this.log(`created media source: ${(st=ot.constructor)==null?void 0:st.name}`),ot.addEventListener("sourceopen",this._onMediaSourceOpen),ot.addEventListener("sourceended",this._onMediaSourceEnded),ot.addEventListener("sourceclose",this._onMediaSourceClose),ot.addEventListener("startstreaming",this._onStartStreaming),ot.addEventListener("endstreaming",this._onEndStreaming);const lt=this._objectUrl=self.URL.createObjectURL(ot);if(this.appendSource)try{nt.removeAttribute("src");const ut=self.ManagedMediaSource;nt.disableRemotePlayback=nt.disableRemotePlayback||ut&&ot instanceof ut,removeSourceChildren(nt),addSource(nt,lt),nt.load()}catch{nt.src=lt}else nt.src=lt;nt.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:et,mediaSource:rt,_objectUrl:nt}=this;if(rt){if(this.log("media source detaching"),rt.readyState==="open")try{rt.endOfStream()}catch(it){this.warn(`onMediaDetaching: ${it.message} while calling endOfStream`)}this.onBufferReset(),rt.removeEventListener("sourceopen",this._onMediaSourceOpen),rt.removeEventListener("sourceended",this._onMediaSourceEnded),rt.removeEventListener("sourceclose",this._onMediaSourceClose),rt.removeEventListener("startstreaming",this._onStartStreaming),rt.removeEventListener("endstreaming",this._onEndStreaming),et&&(et.removeEventListener("emptied",this._onMediaEmptied),nt&&self.URL.revokeObjectURL(nt),this.mediaSrc===nt?(et.removeAttribute("src"),this.appendSource&&removeSourceChildren(et),et.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(Events.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(et=>{this.resetBuffer(et)}),this._initSourceBuffer()}resetBuffer(et){const rt=this.sourceBuffer[et];try{if(rt){var nt;this.removeBufferListeners(et),this.sourceBuffer[et]=void 0,(nt=this.mediaSource)!=null&&nt.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(rt)}}catch(it){this.warn(`onBufferReset ${et}`,it)}}onBufferCodecs(et,rt){const nt=this.getSourceBufferTypes().length,it=Object.keys(rt);if(it.forEach(ot=>{if(nt){const ut=this.tracks[ot];if(ut&&typeof ut.buffer.changeType=="function"){var lt;const{id:ct,codec:dt,levelCodec:pt,container:ft,metadata:gt}=rt[ot],_r=pickMostCompleteCodecName(ut.codec,ut.levelCodec),Yr=_r==null?void 0:_r.replace(VIDEO_CODEC_PROFILE_REPLACE,"$1");let mt=pickMostCompleteCodecName(dt,pt);const Kr=(lt=mt)==null?void 0:lt.replace(VIDEO_CODEC_PROFILE_REPLACE,"$1");if(mt&&Yr!==Kr){ot.slice(0,5)==="audio"&&(mt=getCodecCompatibleName(mt,this.hls.config.preferManagedMediaSource));const Xr=`${ft};codecs=${mt}`;this.appendChangeType(ot,Xr),this.log(`switching codec ${_r} to ${mt}`),this.tracks[ot]={buffer:ut.buffer,codec:dt,container:ft,levelCodec:pt,metadata:gt,id:ct}}}}else this.pendingTracks[ot]=rt[ot]}),nt)return;const st=Math.max(this.bufferCodecEventsExpected-1,0);this.bufferCodecEventsExpected!==st&&(this.log(`${st} bufferCodec event(s) expected ${it.join(",")}`),this.bufferCodecEventsExpected=st),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks()}appendChangeType(et,rt){const{operationQueue:nt}=this,it={execute:()=>{const st=this.sourceBuffer[et];st&&(this.log(`changing ${et} sourceBuffer type to ${rt}`),st.changeType(rt)),nt.shiftAndExecuteNext(et)},onStart:()=>{},onComplete:()=>{},onError:st=>{this.warn(`Failed to change ${et} SourceBuffer type`,st)}};nt.append(it,et,!!this.pendingTracks[et])}onBufferAppending(et,rt){const{hls:nt,operationQueue:it,tracks:st}=this,{data:ot,type:lt,frag:ut,part:ct,chunkMeta:dt}=rt,pt=dt.buffering[lt],ft=self.performance.now();pt.start=ft;const gt=ut.stats.buffering,_r=ct?ct.stats.buffering:null;gt.start===0&&(gt.start=ft),_r&&_r.start===0&&(_r.start=ft);const Yr=st.audio;let mt=!1;lt==="audio"&&(Yr==null?void 0:Yr.container)==="audio/mpeg"&&(mt=!this.lastMpegAudioChunk||dt.id===1||this.lastMpegAudioChunk.sn!==dt.sn,this.lastMpegAudioChunk=dt);const Kr=ut.start,Xr={execute:()=>{if(pt.executeStart=self.performance.now(),mt){const Zr=this.sourceBuffer[lt];if(Zr){const Qr=Kr-Zr.timestampOffset;Math.abs(Qr)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${Kr} (delta: ${Qr}) sn: ${ut.sn})`),Zr.timestampOffset=Kr)}}this.appendExecutor(ot,lt)},onStart:()=>{},onComplete:()=>{const Zr=self.performance.now();pt.executeEnd=pt.end=Zr,gt.first===0&&(gt.first=Zr),_r&&_r.first===0&&(_r.first=Zr);const{sourceBuffer:Qr}=this,_i={};for(const ns in Qr)_i[ns]=BufferHelper.getBuffered(Qr[ns]);this.appendErrors[lt]=0,lt==="audio"||lt==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(Events.BUFFER_APPENDED,{type:lt,frag:ut,part:ct,chunkMeta:dt,parent:ut.type,timeRanges:_i})},onError:Zr=>{const Qr={type:ErrorTypes.MEDIA_ERROR,parent:ut.type,details:ErrorDetails.BUFFER_APPEND_ERROR,sourceBufferName:lt,frag:ut,part:ct,chunkMeta:dt,error:Zr,err:Zr,fatal:!1};if(Zr.code===DOMException.QUOTA_EXCEEDED_ERR)Qr.details=ErrorDetails.BUFFER_FULL_ERROR;else{const _i=++this.appendErrors[lt];Qr.details=ErrorDetails.BUFFER_APPEND_ERROR,this.warn(`Failed ${_i}/${nt.config.appendErrorMaxRetry} times to append segment in "${lt}" sourceBuffer`),_i>=nt.config.appendErrorMaxRetry&&(Qr.fatal=!0)}nt.trigger(Events.ERROR,Qr)}};it.append(Xr,lt,!!this.pendingTracks[lt])}onBufferFlushing(et,rt){const{operationQueue:nt}=this,it=st=>({execute:this.removeExecutor.bind(this,st,rt.startOffset,rt.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(Events.BUFFER_FLUSHED,{type:st})},onError:ot=>{this.warn(`Failed to remove from ${st} SourceBuffer`,ot)}});rt.type?nt.append(it(rt.type),rt.type):this.getSourceBufferTypes().forEach(st=>{nt.append(it(st),st)})}onFragParsed(et,rt){const{frag:nt,part:it}=rt,st=[],ot=it?it.elementaryStreams:nt.elementaryStreams;ot[ElementaryStreamTypes.AUDIOVIDEO]?st.push("audiovideo"):(ot[ElementaryStreamTypes.AUDIO]&&st.push("audio"),ot[ElementaryStreamTypes.VIDEO]&&st.push("video"));const lt=()=>{const ut=self.performance.now();nt.stats.buffering.end=ut,it&&(it.stats.buffering.end=ut);const ct=it?it.stats:nt.stats;this.hls.trigger(Events.FRAG_BUFFERED,{frag:nt,part:it,stats:ct,id:nt.type})};st.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${nt.type} level: ${nt.level} sn: ${nt.sn}`),this.blockBuffers(lt,st)}onFragChanged(et,rt){this.trimBuffers()}onBufferEos(et,rt){this.getSourceBufferTypes().reduce((it,st)=>{const ot=this.sourceBuffer[st];return ot&&(!rt.type||rt.type===st)&&(ot.ending=!0,ot.ended||(ot.ended=!0,this.log(`${st} sourceBuffer now EOS`))),it&&!!(!ot||ot.ended)},!0)&&(this.log("Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(st=>{const ot=this.sourceBuffer[st];ot&&(ot.ending=!1)});const{mediaSource:it}=this;if(!it||it.readyState!=="open"){it&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${it.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),it.endOfStream()}))}onLevelUpdated(et,{details:rt}){rt.fragments.length&&(this.details=rt,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}trimBuffers(){const{hls:et,details:rt,media:nt}=this;if(!nt||rt===null||!this.getSourceBufferTypes().length)return;const st=et.config,ot=nt.currentTime,lt=rt.levelTargetDuration,ut=rt.live&&st.liveBackBufferLength!==null?st.liveBackBufferLength:st.backBufferLength;if(isFiniteNumber(ut)&&ut>0){const ct=Math.max(ut,lt),dt=Math.floor(ot/lt)*lt-ct;this.flushBackBuffer(ot,lt,dt)}if(isFiniteNumber(st.frontBufferFlushThreshold)&&st.frontBufferFlushThreshold>0){const ct=Math.max(st.maxBufferLength,st.frontBufferFlushThreshold),dt=Math.max(ct,lt),pt=Math.floor(ot/lt)*lt+dt;this.flushFrontBuffer(ot,lt,pt)}}flushBackBuffer(et,rt,nt){const{details:it,sourceBuffer:st}=this;this.getSourceBufferTypes().forEach(lt=>{const ut=st[lt];if(ut){const ct=BufferHelper.getBuffered(ut);if(ct.length>0&&nt>ct.start(0)){if(this.hls.trigger(Events.BACK_BUFFER_REACHED,{bufferEnd:nt}),it!=null&&it.live)this.hls.trigger(Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:nt});else if(ut.ended&&ct.end(ct.length-1)-et<rt*2){this.log(`Cannot flush ${lt} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(Events.BUFFER_FLUSHING,{startOffset:0,endOffset:nt,type:lt})}}})}flushFrontBuffer(et,rt,nt){const{sourceBuffer:it}=this;this.getSourceBufferTypes().forEach(ot=>{const lt=it[ot];if(lt){const ut=BufferHelper.getBuffered(lt),ct=ut.length;if(ct<2)return;const dt=ut.start(ct-1),pt=ut.end(ct-1);if(nt>dt||et>=dt&&et<=pt)return;if(lt.ended&&et-pt<2*rt){this.log(`Cannot flush ${ot} front buffer while SourceBuffer is in ended state`);return}this.hls.trigger(Events.BUFFER_FLUSHING,{startOffset:dt,endOffset:1/0,type:ot})}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")return;const{details:et,hls:rt,media:nt,mediaSource:it}=this,st=et.fragments[0].start+et.totalduration,ot=nt.duration,lt=isFiniteNumber(it.duration)?it.duration:0;et.live&&rt.config.liveDurationInfinity?(it.duration=1/0,this.updateSeekableRange(et)):(st>lt&&st>ot||!isFiniteNumber(ot))&&(this.log(`Updating Media Source duration to ${st.toFixed(3)}`),it.duration=st)}updateSeekableRange(et){const rt=this.mediaSource,nt=et.fragments;if(nt.length&&et.live&&rt!=null&&rt.setLiveSeekableRange){const st=Math.max(0,nt[0].start),ot=Math.max(st,st+et.totalduration);this.log(`Media Source duration is set to ${rt.duration}. Setting seekable range to ${st}-${ot}.`),rt.setLiveSeekableRange(st,ot)}}checkPendingTracks(){const{bufferCodecEventsExpected:et,operationQueue:rt,pendingTracks:nt}=this,it=Object.keys(nt).length;if(it&&(!et||it===2||"audiovideo"in nt)){this.createSourceBuffers(nt),this.pendingTracks={};const st=this.getSourceBufferTypes();if(st.length)this.hls.trigger(Events.BUFFER_CREATED,{tracks:this.tracks}),st.forEach(ot=>{rt.executeNext(ot)});else{const ot=new Error("could not create source buffer for media codec(s)");this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:ot,reason:ot.message})}}}createSourceBuffers(et){const{sourceBuffer:rt,mediaSource:nt}=this;if(!nt)throw Error("createSourceBuffers called when mediaSource was null");for(const it in et)if(!rt[it]){const st=et[it];if(!st)throw Error(`source buffer exists for track ${it}, however track does not`);let ot=st.levelCodec||st.codec;ot&&it.slice(0,5)==="audio"&&(ot=getCodecCompatibleName(ot,this.hls.config.preferManagedMediaSource));const lt=`${st.container};codecs=${ot}`;this.log(`creating sourceBuffer(${lt})`);try{const ut=rt[it]=nt.addSourceBuffer(lt),ct=it;this.addBufferListener(ct,"updatestart",this._onSBUpdateStart),this.addBufferListener(ct,"updateend",this._onSBUpdateEnd),this.addBufferListener(ct,"error",this._onSBUpdateError),this.addBufferListener(ct,"bufferedchange",(dt,pt)=>{const ft=pt.removedRanges;ft!=null&&ft.length&&this.hls.trigger(Events.BUFFER_FLUSHED,{type:it})}),this.tracks[it]={buffer:ut,codec:ot,container:st.container,levelCodec:st.levelCodec,metadata:st.metadata,id:st.id}}catch(ut){this.error(`error while trying to add sourceBuffer: ${ut.message}`),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:ut,sourceBufferName:it,mimeType:lt})}}}get mediaSrc(){var et;const rt=((et=this.media)==null?void 0:et.firstChild)||this.media;return rt==null?void 0:rt.src}_onSBUpdateStart(et){const{operationQueue:rt}=this;rt.current(et).onStart()}_onSBUpdateEnd(et){var rt;if(((rt=this.mediaSource)==null?void 0:rt.readyState)==="closed"){this.resetBuffer(et);return}const{operationQueue:nt}=this;nt.current(et).onComplete(),nt.shiftAndExecuteNext(et)}_onSBUpdateError(et,rt){var nt;const it=new Error(`${et} SourceBuffer error. MediaSource readyState: ${(nt=this.mediaSource)==null?void 0:nt.readyState}`);this.error(`${it}`,rt),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_APPENDING_ERROR,sourceBufferName:et,error:it,fatal:!1});const st=this.operationQueue.current(et);st&&st.onError(it)}removeExecutor(et,rt,nt){const{media:it,mediaSource:st,operationQueue:ot,sourceBuffer:lt}=this,ut=lt[et];if(!it||!st||!ut){this.warn(`Attempting to remove from the ${et} SourceBuffer, but it does not exist`),ot.shiftAndExecuteNext(et);return}const ct=isFiniteNumber(it.duration)?it.duration:1/0,dt=isFiniteNumber(st.duration)?st.duration:1/0,pt=Math.max(0,rt),ft=Math.min(nt,ct,dt);ft>pt&&(!ut.ending||ut.ended)?(ut.ended=!1,this.log(`Removing [${pt},${ft}] from the ${et} SourceBuffer`),ut.remove(pt,ft)):ot.shiftAndExecuteNext(et)}appendExecutor(et,rt){const nt=this.sourceBuffer[rt];if(!nt){if(!this.pendingTracks[rt])throw new Error(`Attempting to append to the ${rt} SourceBuffer, but it does not exist`);return}nt.ended=!1,nt.appendBuffer(et)}blockBuffers(et,rt=this.getSourceBufferTypes()){if(!rt.length){this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(et);return}const{operationQueue:nt}=this,it=rt.map(st=>nt.appendBlocker(st));Promise.all(it).then(()=>{et(),rt.forEach(st=>{const ot=this.sourceBuffer[st];ot!=null&&ot.updating||nt.shiftAndExecuteNext(st)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(et,rt,nt){const it=this.sourceBuffer[et];if(!it)return;const st=nt.bind(this,et);this.listeners[et].push({event:rt,listener:st}),it.addEventListener(rt,st)}removeBufferListeners(et){const rt=this.sourceBuffer[et];rt&&this.listeners[et].forEach(nt=>{rt.removeEventListener(nt.event,nt.listener)})}}function removeSourceChildren(tt){const et=tt.querySelectorAll("source");[].slice.call(et).forEach(rt=>{tt.removeChild(rt)})}function addSource(tt,et){const rt=self.document.createElement("source");rt.type="video/mp4",rt.src=et,tt.appendChild(rt)}const specialCea608CharsCodes={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},getCharForByte=function(et){let rt=et;return specialCea608CharsCodes.hasOwnProperty(et)&&(rt=specialCea608CharsCodes[et]),String.fromCharCode(rt)},NR_ROWS=15,NR_COLS=100,rowsLowCh1={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},rowsHighCh1={17:2,18:4,21:6,22:8,23:10,19:13,20:15},rowsLowCh2={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},rowsHighCh2={25:2,26:4,29:6,30:8,31:10,27:13,28:15},backgroundColors=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class CaptionsLogger{constructor(){this.time=null,this.verboseLevel=0}log(et,rt){if(this.verboseLevel>=et){const nt=typeof rt=="function"?rt():rt;logger.log(`${this.time} [${et}] ${nt}`)}}}const numArrayToHexArray=function(et){const rt=[];for(let nt=0;nt<et.length;nt++)rt.push(et[nt].toString(16));return rt};class PenState{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(et){const rt=["foreground","underline","italics","background","flash"];for(let nt=0;nt<rt.length;nt++){const it=rt[nt];et.hasOwnProperty(it)&&(this[it]=et[it])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(et){return this.foreground===et.foreground&&this.underline===et.underline&&this.italics===et.italics&&this.background===et.background&&this.flash===et.flash}copy(et){this.foreground=et.foreground,this.underline=et.underline,this.italics=et.italics,this.background=et.background,this.flash=et.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class StyledUnicodeChar{constructor(){this.uchar=" ",this.penState=new PenState}reset(){this.uchar=" ",this.penState.reset()}setChar(et,rt){this.uchar=et,this.penState.copy(rt)}setPenState(et){this.penState.copy(et)}equals(et){return this.uchar===et.uchar&&this.penState.equals(et.penState)}copy(et){this.uchar=et.uchar,this.penState.copy(et.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class Row{constructor(et){this.chars=[],this.pos=0,this.currPenState=new PenState,this.cueStartTime=null,this.logger=void 0;for(let rt=0;rt<NR_COLS;rt++)this.chars.push(new StyledUnicodeChar);this.logger=et}equals(et){for(let rt=0;rt<NR_COLS;rt++)if(!this.chars[rt].equals(et.chars[rt]))return!1;return!0}copy(et){for(let rt=0;rt<NR_COLS;rt++)this.chars[rt].copy(et.chars[rt])}isEmpty(){let et=!0;for(let rt=0;rt<NR_COLS;rt++)if(!this.chars[rt].isEmpty()){et=!1;break}return et}setCursor(et){this.pos!==et&&(this.pos=et),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>NR_COLS&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=NR_COLS)}moveCursor(et){const rt=this.pos+et;if(et>1)for(let nt=this.pos+1;nt<rt+1;nt++)this.chars[nt].setPenState(this.currPenState);this.setCursor(rt)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(et){et>=144&&this.backSpace();const rt=getCharForByte(et);if(this.pos>=NR_COLS){this.logger.log(0,()=>"Cannot insert "+et.toString(16)+" ("+rt+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(rt,this.currPenState),this.moveCursor(1)}clearFromPos(et){let rt;for(rt=et;rt<NR_COLS;rt++)this.chars[rt].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const et=[];let rt=!0;for(let nt=0;nt<NR_COLS;nt++){const it=this.chars[nt].uchar;it!==" "&&(rt=!1),et.push(it)}return rt?"":et.join("")}setPenStyles(et){this.currPenState.setStyles(et),this.chars[this.pos].setPenState(this.currPenState)}}class CaptionScreen{constructor(et){this.rows=[],this.currRow=NR_ROWS-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let rt=0;rt<NR_ROWS;rt++)this.rows.push(new Row(et));this.logger=et}reset(){for(let et=0;et<NR_ROWS;et++)this.rows[et].clear();this.currRow=NR_ROWS-1}equals(et){let rt=!0;for(let nt=0;nt<NR_ROWS;nt++)if(!this.rows[nt].equals(et.rows[nt])){rt=!1;break}return rt}copy(et){for(let rt=0;rt<NR_ROWS;rt++)this.rows[rt].copy(et.rows[rt])}isEmpty(){let et=!0;for(let rt=0;rt<NR_ROWS;rt++)if(!this.rows[rt].isEmpty()){et=!1;break}return et}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(et){this.rows[this.currRow].insertChar(et)}setPen(et){this.rows[this.currRow].setPenStyles(et)}moveCursor(et){this.rows[this.currRow].moveCursor(et)}setCursor(et){this.logger.log(2,"setCursor: "+et),this.rows[this.currRow].setCursor(et)}setPAC(et){this.logger.log(2,()=>"pacData = "+JSON.stringify(et));let rt=et.row-1;if(this.nrRollUpRows&&rt<this.nrRollUpRows-1&&(rt=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==rt){for(let lt=0;lt<NR_ROWS;lt++)this.rows[lt].clear();const st=this.currRow+1-this.nrRollUpRows,ot=this.lastOutputScreen;if(ot){const lt=ot.rows[st].cueStartTime,ut=this.logger.time;if(lt!==null&&ut!==null&&lt<ut)for(let ct=0;ct<this.nrRollUpRows;ct++)this.rows[rt-this.nrRollUpRows+ct+1].copy(ot.rows[st+ct])}}this.currRow=rt;const nt=this.rows[this.currRow];if(et.indent!==null){const st=et.indent,ot=Math.max(st-1,0);nt.setCursor(et.indent),et.color=nt.chars[ot].penState.foreground}const it={foreground:et.color,underline:et.underline,italics:et.italics,background:"black",flash:!1};this.setPen(it)}setBkgData(et){this.logger.log(2,()=>"bkgData = "+JSON.stringify(et)),this.backSpace(),this.setPen(et),this.insertChar(32)}setRollUpRows(et){this.nrRollUpRows=et}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const et=this.currRow+1-this.nrRollUpRows,rt=this.rows.splice(et,1)[0];rt.clear(),this.rows.splice(this.currRow,0,rt),this.logger.log(2,"Rolling up")}getDisplayText(et){et=et||!1;const rt=[];let nt="",it=-1;for(let st=0;st<NR_ROWS;st++){const ot=this.rows[st].getTextString();ot&&(it=st+1,et?rt.push("Row "+it+": '"+ot+"'"):rt.push(ot.trim()))}return rt.length>0&&(et?nt="["+rt.join(" | ")+"]":nt=rt.join(`
`)),nt}getTextAndFormat(){return this.rows}}class Cea608Channel{constructor(et,rt,nt){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=et,this.outputFilter=rt,this.mode=null,this.verbose=0,this.displayedMemory=new CaptionScreen(nt),this.nonDisplayedMemory=new CaptionScreen(nt),this.lastOutputScreen=new CaptionScreen(nt),this.currRollUpRow=this.displayedMemory.rows[NR_ROWS-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=nt}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[NR_ROWS-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(et){this.outputFilter=et}setPAC(et){this.writeScreen.setPAC(et)}setBkgData(et){this.writeScreen.setBkgData(et)}setMode(et){et!==this.mode&&(this.mode=et,this.logger.log(2,()=>"MODE="+et),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=et)}insertChars(et){for(let nt=0;nt<et.length;nt++)this.writeScreen.insertChar(et[nt]);const rt=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>rt+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(et){this.logger.log(2,"RU("+et+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(et)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const et=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=et,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(et){this.logger.log(2,"TO("+et+") - Tab Offset"),this.writeScreen.moveCursor(et)}ccMIDROW(et){const rt={flash:!1};if(rt.underline=et%2===1,rt.italics=et>=46,rt.italics)rt.foreground="white";else{const nt=Math.floor(et/2)-16,it=["white","green","blue","cyan","red","yellow","magenta"];rt.foreground=it[nt]}this.logger.log(2,"MIDROW: "+JSON.stringify(rt)),this.writeScreen.setPen(rt)}outputDataUpdate(et=!1){const rt=this.logger.time;rt!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=rt:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,rt,this.lastOutputScreen),et&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:rt),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(et){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,et,this.displayedMemory),this.cueStartTime=et))}}class Cea608Parser{constructor(et,rt,nt){this.channels=void 0,this.currentChannel=0,this.cmdHistory=createCmdHistory(),this.logger=void 0;const it=this.logger=new CaptionsLogger;this.channels=[null,new Cea608Channel(et,rt,it),new Cea608Channel(et+1,nt,it)]}getHandler(et){return this.channels[et].getHandler()}setHandler(et,rt){this.channels[et].setHandler(rt)}addData(et,rt){let nt,it,st,ot=!1;this.logger.time=et;for(let lt=0;lt<rt.length;lt+=2)if(it=rt[lt]&127,st=rt[lt+1]&127,!(it===0&&st===0)){if(this.logger.log(3,"["+numArrayToHexArray([rt[lt],rt[lt+1]])+"] -> ("+numArrayToHexArray([it,st])+")"),nt=this.parseCmd(it,st),nt||(nt=this.parseMidrow(it,st)),nt||(nt=this.parsePAC(it,st)),nt||(nt=this.parseBackgroundAttributes(it,st)),!nt&&(ot=this.parseChars(it,st),ot)){const ut=this.currentChannel;ut&&ut>0?this.channels[ut].insertChars(ot):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!nt&&!ot&&this.logger.log(2,"Couldn't parse cleaned data "+numArrayToHexArray([it,st])+" orig: "+numArrayToHexArray([rt[lt],rt[lt+1]]))}}parseCmd(et,rt){const{cmdHistory:nt}=this,it=(et===20||et===28||et===21||et===29)&&rt>=32&&rt<=47,st=(et===23||et===31)&&rt>=33&&rt<=35;if(!(it||st))return!1;if(hasCmdRepeated(et,rt,nt))return setLastCmd(null,null,nt),this.logger.log(3,"Repeated command ("+numArrayToHexArray([et,rt])+") is dropped"),!0;const ot=et===20||et===21||et===23?1:2,lt=this.channels[ot];return et===20||et===21||et===28||et===29?rt===32?lt.ccRCL():rt===33?lt.ccBS():rt===34?lt.ccAOF():rt===35?lt.ccAON():rt===36?lt.ccDER():rt===37?lt.ccRU(2):rt===38?lt.ccRU(3):rt===39?lt.ccRU(4):rt===40?lt.ccFON():rt===41?lt.ccRDC():rt===42?lt.ccTR():rt===43?lt.ccRTD():rt===44?lt.ccEDM():rt===45?lt.ccCR():rt===46?lt.ccENM():rt===47&&lt.ccEOC():lt.ccTO(rt-32),setLastCmd(et,rt,nt),this.currentChannel=ot,!0}parseMidrow(et,rt){let nt=0;if((et===17||et===25)&&rt>=32&&rt<=47){if(et===17?nt=1:nt=2,nt!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const it=this.channels[nt];return it?(it.ccMIDROW(rt),this.logger.log(3,"MIDROW ("+numArrayToHexArray([et,rt])+")"),!0):!1}return!1}parsePAC(et,rt){let nt;const it=this.cmdHistory,st=(et>=17&&et<=23||et>=25&&et<=31)&&rt>=64&&rt<=127,ot=(et===16||et===24)&&rt>=64&&rt<=95;if(!(st||ot))return!1;if(hasCmdRepeated(et,rt,it))return setLastCmd(null,null,it),!0;const lt=et<=23?1:2;rt>=64&&rt<=95?nt=lt===1?rowsLowCh1[et]:rowsLowCh2[et]:nt=lt===1?rowsHighCh1[et]:rowsHighCh2[et];const ut=this.channels[lt];return ut?(ut.setPAC(this.interpretPAC(nt,rt)),setLastCmd(et,rt,it),this.currentChannel=lt,!0):!1}interpretPAC(et,rt){let nt;const it={color:null,italics:!1,indent:null,underline:!1,row:et};return rt>95?nt=rt-96:nt=rt-64,it.underline=(nt&1)===1,nt<=13?it.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(nt/2)]:nt<=15?(it.italics=!0,it.color="white"):it.indent=Math.floor((nt-16)/2)*4,it}parseChars(et,rt){let nt,it=null,st=null;if(et>=25?(nt=2,st=et-8):(nt=1,st=et),st>=17&&st<=19){let ot;st===17?ot=rt+80:st===18?ot=rt+112:ot=rt+144,this.logger.log(2,"Special char '"+getCharForByte(ot)+"' in channel "+nt),it=[ot]}else et>=32&&et<=127&&(it=rt===0?[et]:[et,rt]);if(it){const ot=numArrayToHexArray(it);this.logger.log(3,"Char codes =  "+ot.join(",")),setLastCmd(et,rt,this.cmdHistory)}return it}parseBackgroundAttributes(et,rt){const nt=(et===16||et===24)&&rt>=32&&rt<=47,it=(et===23||et===31)&&rt>=45&&rt<=47;if(!(nt||it))return!1;let st;const ot={};et===16||et===24?(st=Math.floor((rt-32)/2),ot.background=backgroundColors[st],rt%2===1&&(ot.background=ot.background+"_semi")):rt===45?ot.background="transparent":(ot.foreground="black",rt===47&&(ot.underline=!0));const lt=et<=23?1:2;return this.channels[lt].setBkgData(ot),setLastCmd(et,rt,this.cmdHistory),!0}reset(){for(let et=0;et<Object.keys(this.channels).length;et++){const rt=this.channels[et];rt&&rt.reset()}this.cmdHistory=createCmdHistory()}cueSplitAtTime(et){for(let rt=0;rt<this.channels.length;rt++){const nt=this.channels[rt];nt&&nt.cueSplitAtTime(et)}}}function setLastCmd(tt,et,rt){rt.a=tt,rt.b=et}function hasCmdRepeated(tt,et,rt){return rt.a===tt&&rt.b===et}function createCmdHistory(){return{a:null,b:null}}class OutputFilter{constructor(et,rt){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=et,this.trackName=rt}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(et,rt,nt){(this.startTime===null||this.startTime>et)&&(this.startTime=et),this.endTime=rt,this.screen=nt,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var VTTCue=function(){if(optionalSelf!=null&&optionalSelf.VTTCue)return self.VTTCue;const tt=["","lr","rl"],et=["start","middle","end","left","right"];function rt(lt,ut){if(typeof ut!="string"||!Array.isArray(lt))return!1;const ct=ut.toLowerCase();return~lt.indexOf(ct)?ct:!1}function nt(lt){return rt(tt,lt)}function it(lt){return rt(et,lt)}function st(lt,...ut){let ct=1;for(;ct<arguments.length;ct++){const dt=arguments[ct];for(const pt in dt)lt[pt]=dt[pt]}return lt}function ot(lt,ut,ct){const dt=this,pt={enumerable:!0};dt.hasBeenReset=!1;let ft="",gt=!1,_r=lt,Yr=ut,mt=ct,Kr=null,Xr="",Zr=!0,Qr="auto",_i="start",ns=50,rs="middle",ss=50,hs="middle";Object.defineProperty(dt,"id",st({},pt,{get:function(){return ft},set:function(os){ft=""+os}})),Object.defineProperty(dt,"pauseOnExit",st({},pt,{get:function(){return gt},set:function(os){gt=!!os}})),Object.defineProperty(dt,"startTime",st({},pt,{get:function(){return _r},set:function(os){if(typeof os!="number")throw new TypeError("Start time must be set to a number.");_r=os,this.hasBeenReset=!0}})),Object.defineProperty(dt,"endTime",st({},pt,{get:function(){return Yr},set:function(os){if(typeof os!="number")throw new TypeError("End time must be set to a number.");Yr=os,this.hasBeenReset=!0}})),Object.defineProperty(dt,"text",st({},pt,{get:function(){return mt},set:function(os){mt=""+os,this.hasBeenReset=!0}})),Object.defineProperty(dt,"region",st({},pt,{get:function(){return Kr},set:function(os){Kr=os,this.hasBeenReset=!0}})),Object.defineProperty(dt,"vertical",st({},pt,{get:function(){return Xr},set:function(os){const is=nt(os);if(is===!1)throw new SyntaxError("An invalid or illegal string was specified.");Xr=is,this.hasBeenReset=!0}})),Object.defineProperty(dt,"snapToLines",st({},pt,{get:function(){return Zr},set:function(os){Zr=!!os,this.hasBeenReset=!0}})),Object.defineProperty(dt,"line",st({},pt,{get:function(){return Qr},set:function(os){if(typeof os!="number"&&os!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");Qr=os,this.hasBeenReset=!0}})),Object.defineProperty(dt,"lineAlign",st({},pt,{get:function(){return _i},set:function(os){const is=it(os);if(!is)throw new SyntaxError("An invalid or illegal string was specified.");_i=is,this.hasBeenReset=!0}})),Object.defineProperty(dt,"position",st({},pt,{get:function(){return ns},set:function(os){if(os<0||os>100)throw new Error("Position must be between 0 and 100.");ns=os,this.hasBeenReset=!0}})),Object.defineProperty(dt,"positionAlign",st({},pt,{get:function(){return rs},set:function(os){const is=it(os);if(!is)throw new SyntaxError("An invalid or illegal string was specified.");rs=is,this.hasBeenReset=!0}})),Object.defineProperty(dt,"size",st({},pt,{get:function(){return ss},set:function(os){if(os<0||os>100)throw new Error("Size must be between 0 and 100.");ss=os,this.hasBeenReset=!0}})),Object.defineProperty(dt,"align",st({},pt,{get:function(){return hs},set:function(os){const is=it(os);if(!is)throw new SyntaxError("An invalid or illegal string was specified.");hs=is,this.hasBeenReset=!0}})),dt.displayState=void 0}return ot.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},ot}();class StringDecoder{decode(et,rt){if(!et)return"";if(typeof et!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(et))}}function parseTimeStamp(tt){function et(nt,it,st,ot){return(nt|0)*3600+(it|0)*60+(st|0)+parseFloat(ot||0)}const rt=tt.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return rt?parseFloat(rt[2])>59?et(rt[2],rt[3],0,rt[4]):et(rt[1],rt[2],rt[3],rt[4]):null}class Settings{constructor(){this.values=Object.create(null)}set(et,rt){!this.get(et)&&rt!==""&&(this.values[et]=rt)}get(et,rt,nt){return nt?this.has(et)?this.values[et]:rt[nt]:this.has(et)?this.values[et]:rt}has(et){return et in this.values}alt(et,rt,nt){for(let it=0;it<nt.length;++it)if(rt===nt[it]){this.set(et,rt);break}}integer(et,rt){/^-?\d+$/.test(rt)&&this.set(et,parseInt(rt,10))}percent(et,rt){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(rt)){const nt=parseFloat(rt);if(nt>=0&&nt<=100)return this.set(et,nt),!0}return!1}}function parseOptions(tt,et,rt,nt){const it=nt?tt.split(nt):[tt];for(const st in it){if(typeof it[st]!="string")continue;const ot=it[st].split(rt);if(ot.length!==2)continue;const lt=ot[0],ut=ot[1];et(lt,ut)}}const defaults=new VTTCue(0,0,""),center=defaults.align==="middle"?"middle":"center";function parseCue$1(tt,et,rt){const nt=tt;function it(){const lt=parseTimeStamp(tt);if(lt===null)throw new Error("Malformed timestamp: "+nt);return tt=tt.replace(/^[^\sa-zA-Z-]+/,""),lt}function st(lt,ut){const ct=new Settings;parseOptions(lt,function(ft,gt){let _r;switch(ft){case"region":for(let Yr=rt.length-1;Yr>=0;Yr--)if(rt[Yr].id===gt){ct.set(ft,rt[Yr].region);break}break;case"vertical":ct.alt(ft,gt,["rl","lr"]);break;case"line":_r=gt.split(","),ct.integer(ft,_r[0]),ct.percent(ft,_r[0])&&ct.set("snapToLines",!1),ct.alt(ft,_r[0],["auto"]),_r.length===2&&ct.alt("lineAlign",_r[1],["start",center,"end"]);break;case"position":_r=gt.split(","),ct.percent(ft,_r[0]),_r.length===2&&ct.alt("positionAlign",_r[1],["start",center,"end","line-left","line-right","auto"]);break;case"size":ct.percent(ft,gt);break;case"align":ct.alt(ft,gt,["start",center,"end","left","right"]);break}},/:/,/\s/),ut.region=ct.get("region",null),ut.vertical=ct.get("vertical","");let dt=ct.get("line","auto");dt==="auto"&&defaults.line===-1&&(dt=-1),ut.line=dt,ut.lineAlign=ct.get("lineAlign","start"),ut.snapToLines=ct.get("snapToLines",!0),ut.size=ct.get("size",100),ut.align=ct.get("align",center);let pt=ct.get("position","auto");pt==="auto"&&defaults.position===50&&(pt=ut.align==="start"||ut.align==="left"?0:ut.align==="end"||ut.align==="right"?100:50),ut.position=pt}function ot(){tt=tt.replace(/^\s+/,"")}if(ot(),et.startTime=it(),ot(),tt.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+nt);tt=tt.slice(3),ot(),et.endTime=it(),ot(),st(tt,et)}function fixLineBreaks(tt){return tt.replace(/<br(?: \/)?>/gi,`
`)}class VTTParser{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new StringDecoder,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(et){const rt=this;et&&(rt.buffer+=rt.decoder.decode(et,{stream:!0}));function nt(){let st=rt.buffer,ot=0;for(st=fixLineBreaks(st);ot<st.length&&st[ot]!=="\r"&&st[ot]!==`
`;)++ot;const lt=st.slice(0,ot);return st[ot]==="\r"&&++ot,st[ot]===`
`&&++ot,rt.buffer=st.slice(ot),lt}function it(st){parseOptions(st,function(ot,lt){},/:/)}try{let st="";if(rt.state==="INITIAL"){if(!/\r\n|\n/.test(rt.buffer))return this;st=nt();const lt=st.match(/^()?WEBVTT([ \t].*)?$/);if(!(lt!=null&&lt[0]))throw new Error("Malformed WebVTT signature.");rt.state="HEADER"}let ot=!1;for(;rt.buffer;){if(!/\r\n|\n/.test(rt.buffer))return this;switch(ot?ot=!1:st=nt(),rt.state){case"HEADER":/:/.test(st)?it(st):st||(rt.state="ID");continue;case"NOTE":st||(rt.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(st)){rt.state="NOTE";break}if(!st)continue;if(rt.cue=new VTTCue(0,0,""),rt.state="CUE",st.indexOf("-->")===-1){rt.cue.id=st;continue}case"CUE":if(!rt.cue){rt.state="BADCUE";continue}try{parseCue$1(st,rt.cue,rt.regionList)}catch{rt.cue=null,rt.state="BADCUE";continue}rt.state="CUETEXT";continue;case"CUETEXT":{const lt=st.indexOf("-->")!==-1;if(!st||lt&&(ot=!0)){rt.oncue&&rt.cue&&rt.oncue(rt.cue),rt.cue=null,rt.state="ID";continue}if(rt.cue===null)continue;rt.cue.text&&(rt.cue.text+=`
`),rt.cue.text+=st}continue;case"BADCUE":st||(rt.state="ID")}}}catch{rt.state==="CUETEXT"&&rt.cue&&rt.oncue&&rt.oncue(rt.cue),rt.cue=null,rt.state=rt.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const et=this;try{if((et.cue||et.state==="HEADER")&&(et.buffer+=`

`,et.parse()),et.state==="INITIAL"||et.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(rt){et.onparsingerror&&et.onparsingerror(rt)}return et.onflush&&et.onflush(),this}}const LINEBREAKS=/\r\n|\n\r|\n|\r/g,startsWith=function(et,rt,nt=0){return et.slice(nt,nt+rt.length)===rt},cueString2millis=function(et){let rt=parseInt(et.slice(-3));const nt=parseInt(et.slice(-6,-4)),it=parseInt(et.slice(-9,-7)),st=et.length>9?parseInt(et.substring(0,et.indexOf(":"))):0;if(!isFiniteNumber(rt)||!isFiniteNumber(nt)||!isFiniteNumber(it)||!isFiniteNumber(st))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${et}`);return rt+=1e3*nt,rt+=60*1e3*it,rt+=60*60*1e3*st,rt},hash=function(et){let rt=5381,nt=et.length;for(;nt;)rt=rt*33^et.charCodeAt(--nt);return(rt>>>0).toString()};function generateCueId(tt,et,rt){return hash(tt.toString())+hash(et.toString())+hash(rt)}const calculateOffset=function(et,rt,nt){let it=et[rt],st=et[it.prevCC];if(!st||!st.new&&it.new){et.ccOffset=et.presentationOffset=it.start,it.new=!1;return}for(;(ot=st)!=null&&ot.new;){var ot;et.ccOffset+=it.start-st.start,it.new=!1,it=st,st=et[it.prevCC]}et.presentationOffset=nt};function parseWebVTT(tt,et,rt,nt,it,st,ot){const lt=new VTTParser,ut=utf8ArrayToStr(new Uint8Array(tt)).trim().replace(LINEBREAKS,`
`).split(`
`),ct=[],dt=et?toMpegTsClockFromTimescale(et.baseTime,et.timescale):0;let pt="00:00.000",ft=0,gt=0,_r,Yr=!0;lt.oncue=function(mt){const Kr=rt[nt];let Xr=rt.ccOffset;const Zr=(ft-dt)/9e4;if(Kr!=null&&Kr.new&&(gt!==void 0?Xr=rt.ccOffset=Kr.start:calculateOffset(rt,nt,Zr)),Zr){if(!et){_r=new Error("Missing initPTS for VTT MPEGTS");return}Xr=Zr-rt.presentationOffset}const Qr=mt.endTime-mt.startTime,_i=normalizePts((mt.startTime+Xr-gt)*9e4,it*9e4)/9e4;mt.startTime=Math.max(_i,0),mt.endTime=Math.max(_i+Qr,0);const ns=mt.text.trim();mt.text=decodeURIComponent(encodeURIComponent(ns)),mt.id||(mt.id=generateCueId(mt.startTime,mt.endTime,ns)),mt.endTime>0&&ct.push(mt)},lt.onparsingerror=function(mt){_r=mt},lt.onflush=function(){if(_r){ot(_r);return}st(ct)},ut.forEach(mt=>{if(Yr)if(startsWith(mt,"X-TIMESTAMP-MAP=")){Yr=!1,mt.slice(16).split(",").forEach(Kr=>{startsWith(Kr,"LOCAL:")?pt=Kr.slice(6):startsWith(Kr,"MPEGTS:")&&(ft=parseInt(Kr.slice(7)))});try{gt=cueString2millis(pt)/1e3}catch(Kr){_r=Kr}return}else mt===""&&(Yr=!1);lt.parse(mt+`
`)}),lt.flush()}const IMSC1_CODEC="stpp.ttml.im1t",HMSF_REGEX=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,TIME_UNIT_REGEX=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,textAlignToLineAlign={left:"start",center:"center",right:"end",start:"start",end:"end"};function parseIMSC1(tt,et,rt,nt){const it=findBox(new Uint8Array(tt),["mdat"]);if(it.length===0){nt(new Error("Could not parse IMSC1 mdat"));return}const st=it.map(lt=>utf8ArrayToStr(lt)),ot=toTimescaleFromScale(et.baseTime,1,et.timescale);try{st.forEach(lt=>rt(parseTTML(lt,ot)))}catch(lt){nt(lt)}}function parseTTML(tt,et){const it=new DOMParser().parseFromString(tt,"text/xml").getElementsByTagName("tt")[0];if(!it)throw new Error("Invalid ttml");const st={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},ot=Object.keys(st).reduce((pt,ft)=>(pt[ft]=it.getAttribute(`ttp:${ft}`)||st[ft],pt),{}),lt=it.getAttribute("xml:space")!=="preserve",ut=collectionToDictionary(getElementCollection(it,"styling","style")),ct=collectionToDictionary(getElementCollection(it,"layout","region")),dt=getElementCollection(it,"body","[begin]");return[].map.call(dt,pt=>{const ft=getTextContent(pt,lt);if(!ft||!pt.hasAttribute("begin"))return null;const gt=parseTtmlTime(pt.getAttribute("begin"),ot),_r=parseTtmlTime(pt.getAttribute("dur"),ot);let Yr=parseTtmlTime(pt.getAttribute("end"),ot);if(gt===null)throw timestampParsingError(pt);if(Yr===null){if(_r===null)throw timestampParsingError(pt);Yr=gt+_r}const mt=new VTTCue(gt-et,Yr-et,ft);mt.id=generateCueId(mt.startTime,mt.endTime,mt.text);const Kr=ct[pt.getAttribute("region")],Xr=ut[pt.getAttribute("style")],Zr=getTtmlStyles(Kr,Xr,ut),{textAlign:Qr}=Zr;if(Qr){const _i=textAlignToLineAlign[Qr];_i&&(mt.lineAlign=_i),mt.align=Qr}return _extends(mt,Zr),mt}).filter(pt=>pt!==null)}function getElementCollection(tt,et,rt){const nt=tt.getElementsByTagName(et)[0];return nt?[].slice.call(nt.querySelectorAll(rt)):[]}function collectionToDictionary(tt){return tt.reduce((et,rt)=>{const nt=rt.getAttribute("xml:id");return nt&&(et[nt]=rt),et},{})}function getTextContent(tt,et){return[].slice.call(tt.childNodes).reduce((rt,nt,it)=>{var st;return nt.nodeName==="br"&&it?rt+`
`:(st=nt.childNodes)!=null&&st.length?getTextContent(nt,et):et?rt+nt.textContent.trim().replace(/\s+/g," "):rt+nt.textContent},"")}function getTtmlStyles(tt,et,rt){const nt="http://www.w3.org/ns/ttml#styling";let it=null;const st=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],ot=tt!=null&&tt.hasAttribute("style")?tt.getAttribute("style"):null;return ot&&rt.hasOwnProperty(ot)&&(it=rt[ot]),st.reduce((lt,ut)=>{const ct=getAttributeNS(et,nt,ut)||getAttributeNS(tt,nt,ut)||getAttributeNS(it,nt,ut);return ct&&(lt[ut]=ct),lt},{})}function getAttributeNS(tt,et,rt){return tt&&tt.hasAttributeNS(et,rt)?tt.getAttributeNS(et,rt):null}function timestampParsingError(tt){return new Error(`Could not parse ttml timestamp ${tt}`)}function parseTtmlTime(tt,et){if(!tt)return null;let rt=parseTimeStamp(tt);return rt===null&&(HMSF_REGEX.test(tt)?rt=parseHoursMinutesSecondsFrames(tt,et):TIME_UNIT_REGEX.test(tt)&&(rt=parseTimeUnits(tt,et))),rt}function parseHoursMinutesSecondsFrames(tt,et){const rt=HMSF_REGEX.exec(tt),nt=(rt[4]|0)+(rt[5]|0)/et.subFrameRate;return(rt[1]|0)*3600+(rt[2]|0)*60+(rt[3]|0)+nt/et.frameRate}function parseTimeUnits(tt,et){const rt=TIME_UNIT_REGEX.exec(tt),nt=Number(rt[1]);switch(rt[2]){case"h":return nt*3600;case"m":return nt*60;case"ms":return nt*1e3;case"f":return nt/et.frameRate;case"t":return nt/et.tickRate}return nt}class TimelineController{constructor(et){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=newVTTCCs(),this.captionsProperties=void 0,this.hls=et,this.config=et.config,this.Cues=et.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},et.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),et.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),et.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),et.on(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),et.on(Events.FRAG_LOADING,this.onFragLoading,this),et.on(Events.FRAG_LOADED,this.onFragLoaded,this),et.on(Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),et.on(Events.FRAG_DECRYPTED,this.onFragDecrypted,this),et.on(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),et.on(Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),et.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:et}=this;et.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),et.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),et.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),et.off(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),et.off(Events.FRAG_LOADING,this.onFragLoading,this),et.off(Events.FRAG_LOADED,this.onFragLoaded,this),et.off(Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),et.off(Events.FRAG_DECRYPTED,this.onFragDecrypted,this),et.off(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),et.off(Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),et.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){if(this.config.enableCEA708Captions&&(!this.cea608Parser1||!this.cea608Parser2)){const et=new OutputFilter(this,"textTrack1"),rt=new OutputFilter(this,"textTrack2"),nt=new OutputFilter(this,"textTrack3"),it=new OutputFilter(this,"textTrack4");this.cea608Parser1=new Cea608Parser(1,et,rt),this.cea608Parser2=new Cea608Parser(3,nt,it)}}addCues(et,rt,nt,it,st){let ot=!1;for(let lt=st.length;lt--;){const ut=st[lt],ct=intersection(ut[0],ut[1],rt,nt);if(ct>=0&&(ut[0]=Math.min(ut[0],rt),ut[1]=Math.max(ut[1],nt),ot=!0,ct/(nt-rt)>.5))return}if(ot||st.push([rt,nt]),this.config.renderTextTracksNatively){const lt=this.captionsTracks[et];this.Cues.newCue(lt,rt,nt,it)}else{const lt=this.Cues.newCue(null,rt,nt,it);this.hls.trigger(Events.CUES_PARSED,{type:"captions",cues:lt,track:et})}}onInitPtsFound(et,{frag:rt,id:nt,initPTS:it,timescale:st}){const{unparsedVttFrags:ot}=this;nt==="main"&&(this.initPTS[rt.cc]={baseTime:it,timescale:st}),ot.length&&(this.unparsedVttFrags=[],ot.forEach(lt=>{this.onFragLoaded(Events.FRAG_LOADED,lt)}))}getExistingTrack(et,rt){const{media:nt}=this;if(nt)for(let it=0;it<nt.textTracks.length;it++){const st=nt.textTracks[it];if(canReuseVttTextTrack(st,{name:et,lang:rt,attrs:{}}))return st}return null}createCaptionsTrack(et){this.config.renderTextTracksNatively?this.createNativeTrack(et):this.createNonNativeTrack(et)}createNativeTrack(et){if(this.captionsTracks[et])return;const{captionsProperties:rt,captionsTracks:nt,media:it}=this,{label:st,languageCode:ot}=rt[et],lt=this.getExistingTrack(st,ot);if(lt)nt[et]=lt,clearCurrentCues(nt[et]),sendAddTrackEvent(nt[et],it);else{const ut=this.createTextTrack("captions",st,ot);ut&&(ut[et]=!0,nt[et]=ut)}}createNonNativeTrack(et){if(this.nonNativeCaptionsTracks[et])return;const rt=this.captionsProperties[et];if(!rt)return;const nt=rt.label,it={_id:et,label:nt,kind:"captions",default:rt.media?!!rt.media.default:!1,closedCaptions:rt.media};this.nonNativeCaptionsTracks[et]=it,this.hls.trigger(Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[it]})}createTextTrack(et,rt,nt){const it=this.media;if(it)return it.addTextTrack(et,rt,nt)}onMediaAttaching(et,rt){this.media=rt.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:et}=this;Object.keys(et).forEach(rt=>{clearCurrentCues(et[rt]),delete et[rt]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=newVTTCCs(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:et}=this;if(!et)return;const rt=et.textTracks;if(rt)for(let nt=0;nt<rt.length;nt++)clearCurrentCues(rt[nt])}onSubtitleTracksUpdated(et,rt){const nt=rt.subtitleTracks||[],it=nt.some(st=>st.textCodec===IMSC1_CODEC);if(this.config.enableWebVTT||it&&this.config.enableIMSC1){if(subtitleOptionsIdentical(this.tracks,nt)){this.tracks=nt;return}if(this.textTracks=[],this.tracks=nt,this.config.renderTextTracksNatively){const ot=this.media,lt=ot?filterSubtitleTracks(ot.textTracks):null;if(this.tracks.forEach((ut,ct)=>{let dt;if(lt){let pt=null;for(let ft=0;ft<lt.length;ft++)if(lt[ft]&&canReuseVttTextTrack(lt[ft],ut)){pt=lt[ft],lt[ft]=null;break}pt&&(dt=pt)}if(dt)clearCurrentCues(dt);else{const pt=captionsOrSubtitlesFromCharacteristics(ut);dt=this.createTextTrack(pt,ut.name,ut.lang),dt&&(dt.mode="disabled")}dt&&this.textTracks.push(dt)}),lt!=null&&lt.length){const ut=lt.filter(ct=>ct!==null).map(ct=>ct.label);ut.length&&logger.warn(`Media element contains unused subtitle tracks: ${ut.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const ot=this.tracks.map(lt=>({label:lt.name,kind:lt.type.toLowerCase(),default:lt.default,subtitleTrack:lt}));this.hls.trigger(Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:ot})}}}onManifestLoaded(et,rt){this.config.enableCEA708Captions&&rt.captions&&rt.captions.forEach(nt=>{const it=/(?:CC|SERVICE)([1-4])/.exec(nt.instreamId);if(!it)return;const st=`textTrack${it[1]}`,ot=this.captionsProperties[st];ot&&(ot.label=nt.name,nt.lang&&(ot.languageCode=nt.lang),ot.media=nt)})}closedCaptionsForLevel(et){const rt=this.hls.levels[et.level];return rt==null?void 0:rt.attrs["CLOSED-CAPTIONS"]}onFragLoading(et,rt){this.initCea608Parsers();const{cea608Parser1:nt,cea608Parser2:it,lastCc:st,lastSn:ot,lastPartIndex:lt}=this;if(!(!this.enabled||!nt||!it)&&rt.frag.type===PlaylistLevelType.MAIN){var ut,ct;const{cc:dt,sn:pt}=rt.frag,ft=(ut=rt==null||(ct=rt.part)==null?void 0:ct.index)!=null?ut:-1;pt===ot+1||pt===ot&&ft===lt+1||dt===st||(nt.reset(),it.reset()),this.lastCc=dt,this.lastSn=pt,this.lastPartIndex=ft}}onFragLoaded(et,rt){const{frag:nt,payload:it}=rt;if(nt.type===PlaylistLevelType.SUBTITLE)if(it.byteLength){const st=nt.decryptdata,ot="stats"in rt;if(st==null||!st.encrypted||ot){const lt=this.tracks[nt.level],ut=this.vttCCs;ut[nt.cc]||(ut[nt.cc]={start:nt.start,prevCC:this.prevCC,new:!0},this.prevCC=nt.cc),lt&&lt.textCodec===IMSC1_CODEC?this._parseIMSC1(nt,it):this._parseVTTs(rt)}}else this.hls.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:nt,error:new Error("Empty subtitle payload")})}_parseIMSC1(et,rt){const nt=this.hls;parseIMSC1(rt,this.initPTS[et.cc],it=>{this._appendCues(it,et.level),nt.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:et})},it=>{logger.log(`Failed to parse IMSC1: ${it}`),nt.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:et,error:it})})}_parseVTTs(et){var rt;const{frag:nt,payload:it}=et,{initPTS:st,unparsedVttFrags:ot}=this,lt=st.length-1;if(!st[nt.cc]&&lt===-1){ot.push(et);return}const ut=this.hls,ct=(rt=nt.initSegment)!=null&&rt.data?appendUint8Array(nt.initSegment.data,new Uint8Array(it)):it;parseWebVTT(ct,this.initPTS[nt.cc],this.vttCCs,nt.cc,nt.start,dt=>{this._appendCues(dt,nt.level),ut.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:nt})},dt=>{const pt=dt.message==="Missing initPTS for VTT MPEGTS";pt?ot.push(et):this._fallbackToIMSC1(nt,it),logger.log(`Failed to parse VTT cue: ${dt}`),!(pt&&lt>nt.cc)&&ut.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:nt,error:dt})})}_fallbackToIMSC1(et,rt){const nt=this.tracks[et.level];nt.textCodec||parseIMSC1(rt,this.initPTS[et.cc],()=>{nt.textCodec=IMSC1_CODEC,this._parseIMSC1(et,rt)},()=>{nt.textCodec="wvtt"})}_appendCues(et,rt){const nt=this.hls;if(this.config.renderTextTracksNatively){const it=this.textTracks[rt];if(!it||it.mode==="disabled")return;et.forEach(st=>addCueToTrack(it,st))}else{const it=this.tracks[rt];if(!it)return;const st=it.default?"default":"subtitles"+rt;nt.trigger(Events.CUES_PARSED,{type:"subtitles",cues:et,track:st})}}onFragDecrypted(et,rt){const{frag:nt}=rt;nt.type===PlaylistLevelType.SUBTITLE&&this.onFragLoaded(Events.FRAG_LOADED,rt)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(et,rt){this.initCea608Parsers();const{cea608Parser1:nt,cea608Parser2:it}=this;if(!this.enabled||!nt||!it)return;const{frag:st,samples:ot}=rt;if(!(st.type===PlaylistLevelType.MAIN&&this.closedCaptionsForLevel(st)==="NONE"))for(let lt=0;lt<ot.length;lt++){const ut=ot[lt].bytes;if(ut){const ct=this.extractCea608Data(ut);nt.addData(ot[lt].pts,ct[0]),it.addData(ot[lt].pts,ct[1])}}}onBufferFlushing(et,{startOffset:rt,endOffset:nt,endOffsetSubtitles:it,type:st}){const{media:ot}=this;if(!(!ot||ot.currentTime<nt)){if(!st||st==="video"){const{captionsTracks:lt}=this;Object.keys(lt).forEach(ut=>removeCuesInRange(lt[ut],rt,nt))}if(this.config.renderTextTracksNatively&&rt===0&&it!==void 0){const{textTracks:lt}=this;Object.keys(lt).forEach(ut=>removeCuesInRange(lt[ut],rt,it))}}}extractCea608Data(et){const rt=[[],[]],nt=et[0]&31;let it=2;for(let st=0;st<nt;st++){const ot=et[it++],lt=127&et[it++],ut=127&et[it++];if(lt===0&&ut===0)continue;if((4&ot)!==0){const dt=3&ot;(dt===0||dt===1)&&(rt[dt].push(lt),rt[dt].push(ut))}}return rt}}function captionsOrSubtitlesFromCharacteristics(tt){return tt.characteristics&&/transcribes-spoken-dialog/gi.test(tt.characteristics)&&/describes-music-and-sound/gi.test(tt.characteristics)?"captions":"subtitles"}function canReuseVttTextTrack(tt,et){return!!tt&&tt.kind===captionsOrSubtitlesFromCharacteristics(et)&&subtitleTrackMatchesTextTrack(et,tt)}function intersection(tt,et,rt,nt){return Math.min(et,nt)-Math.max(tt,rt)}function newVTTCCs(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}class CapLevelController{constructor(et){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=et,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(et){this.streamController=et}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:et}=this;et.on(Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),et.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),et.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),et.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),et.on(Events.BUFFER_CODECS,this.onBufferCodecs,this),et.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:et}=this;et.off(Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),et.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),et.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),et.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),et.off(Events.BUFFER_CODECS,this.onBufferCodecs,this),et.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(et,rt){const nt=this.hls.levels[rt.droppedLevel];this.isLevelAllowed(nt)&&this.restrictedLevels.push({bitrate:nt.bitrate,height:nt.height,width:nt.width})}onMediaAttaching(et,rt){this.media=rt.media instanceof HTMLVideoElement?rt.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(et,rt){const nt=this.hls;this.restrictedLevels=[],this.firstLevel=rt.firstLevel,nt.config.capLevelToPlayerSize&&rt.video&&this.startCapping()}onLevelsUpdated(et,rt){this.timer&&isFiniteNumber(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(et,rt){this.hls.config.capLevelToPlayerSize&&rt.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const et=this.hls.levels;if(et.length){const rt=this.hls,nt=this.getMaxLevel(et.length-1);nt!==this.autoLevelCapping&&logger.log(`Setting autoLevelCapping to ${nt}: ${et[nt].height}p@${et[nt].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),rt.autoLevelCapping=nt,rt.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=rt.autoLevelCapping}}}getMaxLevel(et){const rt=this.hls.levels;if(!rt.length)return-1;const nt=rt.filter((it,st)=>this.isLevelAllowed(it)&&st<=et);return this.clientRect=null,CapLevelController.getMaxLevelByMediaSize(nt,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const et=this.media,rt={width:0,height:0};if(et){const nt=et.getBoundingClientRect();rt.width=nt.width,rt.height=nt.height,!rt.width&&!rt.height&&(rt.width=nt.right-nt.left||et.width||0,rt.height=nt.bottom-nt.top||et.height||0)}return this.clientRect=rt,rt}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let et=1;if(!this.hls.config.ignoreDevicePixelRatio)try{et=self.devicePixelRatio}catch{}return et}isLevelAllowed(et){return!this.restrictedLevels.some(nt=>et.bitrate===nt.bitrate&&et.width===nt.width&&et.height===nt.height)}static getMaxLevelByMediaSize(et,rt,nt){if(!(et!=null&&et.length))return-1;const it=(lt,ut)=>ut?lt.width!==ut.width||lt.height!==ut.height:!0;let st=et.length-1;const ot=Math.max(rt,nt);for(let lt=0;lt<et.length;lt+=1){const ut=et[lt];if((ut.width>=ot||ut.height>=ot)&&it(ut,et[lt+1])){st=lt;break}}return st}}class FPSController{constructor(et){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=et,this.registerListeners()}setStreamController(et){this.streamController=et}registerListeners(){this.hls.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(et,rt){const nt=this.hls.config;if(nt.capLevelOnFPSDrop){const it=rt.media instanceof self.HTMLVideoElement?rt.media:null;this.media=it,it&&typeof it.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),nt.fpsDroppedMonitoringPeriod)}}checkFPS(et,rt,nt){const it=performance.now();if(rt){if(this.lastTime){const st=it-this.lastTime,ot=nt-this.lastDroppedFrames,lt=rt-this.lastDecodedFrames,ut=1e3*ot/st,ct=this.hls;if(ct.trigger(Events.FPS_DROP,{currentDropped:ot,currentDecoded:lt,totalDroppedFrames:nt}),ut>0&&ot>ct.config.fpsDroppedMonitoringThreshold*lt){let dt=ct.currentLevel;logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+dt),dt>0&&(ct.autoLevelCapping===-1||ct.autoLevelCapping>=dt)&&(dt=dt-1,ct.trigger(Events.FPS_DROP_LEVEL_CAPPING,{level:dt,droppedLevel:ct.currentLevel}),ct.autoLevelCapping=dt,this.streamController.nextLevelSwitch())}}this.lastTime=it,this.lastDroppedFrames=nt,this.lastDecodedFrames=rt}}checkFPSInterval(){const et=this.media;if(et)if(this.isVideoPlaybackQualityAvailable){const rt=et.getVideoPlaybackQuality();this.checkFPS(et,rt.totalVideoFrames,rt.droppedVideoFrames)}else this.checkFPS(et,et.webkitDecodedFrameCount,et.webkitDroppedFrameCount)}}const LOGGER_PREFIX="[eme]";class EMEController{constructor(et){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=EMEController.CDMCleanupPromise?[EMEController.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=logger.debug.bind(logger,LOGGER_PREFIX),this.log=logger.log.bind(logger,LOGGER_PREFIX),this.warn=logger.warn.bind(logger,LOGGER_PREFIX),this.error=logger.error.bind(logger,LOGGER_PREFIX),this.hls=et,this.config=et.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const et=this.config;et.requestMediaKeySystemAccessFunc=null,et.licenseXhrSetup=et.licenseResponseCallback=void 0,et.drmSystems=et.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(et){const{drmSystems:rt,widevineLicenseUrl:nt}=this.config,it=rt[et];if(it)return it.licenseUrl;if(et===KeySystems.WIDEVINE&&nt)return nt;throw new Error(`no license server URL configured for key-system "${et}"`)}getServerCertificateUrl(et){const{drmSystems:rt}=this.config,nt=rt[et];if(nt)return nt.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${et}"]`)}attemptKeySystemAccess(et){const rt=this.hls.levels,nt=(ot,lt,ut)=>!!ot&&ut.indexOf(ot)===lt,it=rt.map(ot=>ot.audioCodec).filter(nt),st=rt.map(ot=>ot.videoCodec).filter(nt);return it.length+st.length===0&&st.push("avc1.42e01e"),new Promise((ot,lt)=>{const ut=ct=>{const dt=ct.shift();this.getMediaKeysPromise(dt,it,st).then(pt=>ot({keySystem:dt,mediaKeys:pt})).catch(pt=>{ct.length?ut(ct):pt instanceof EMEKeyError?lt(pt):lt(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_ACCESS,error:pt,fatal:!0},pt.message))})};ut(et)})}requestMediaKeySystemAccess(et,rt){const{requestMediaKeySystemAccessFunc:nt}=this.config;if(typeof nt!="function"){let it=`Configured requestMediaKeySystemAccess is not a function ${nt}`;return requestMediaKeySystemAccess===null&&self.location.protocol==="http:"&&(it=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(it))}return nt(et,rt)}getMediaKeysPromise(et,rt,nt){const it=getSupportedMediaKeySystemConfigurations(et,rt,nt,this.config.drmSystemOptions),st=this.keySystemAccessPromises[et];let ot=st==null?void 0:st.keySystemAccess;if(!ot){this.log(`Requesting encrypted media "${et}" key-system access with config: ${JSON.stringify(it)}`),ot=this.requestMediaKeySystemAccess(et,it);const lt=this.keySystemAccessPromises[et]={keySystemAccess:ot};return ot.catch(ut=>{this.log(`Failed to obtain access to key-system "${et}": ${ut}`)}),ot.then(ut=>{this.log(`Access for key-system "${ut.keySystem}" obtained`);const ct=this.fetchServerCertificate(et);return this.log(`Create media-keys for "${et}"`),lt.mediaKeys=ut.createMediaKeys().then(dt=>(this.log(`Media-keys created for "${et}"`),ct.then(pt=>pt?this.setMediaKeysServerCertificate(dt,et,pt):dt))),lt.mediaKeys.catch(dt=>{this.error(`Failed to create media-keys for "${et}"}: ${dt}`)}),lt.mediaKeys})}return ot.then(()=>st.mediaKeys)}createMediaKeySessionContext({decryptdata:et,keySystem:rt,mediaKeys:nt}){this.log(`Creating key-system session "${rt}" keyId: ${Hex.hexDump(et.keyId||[])}`);const it=nt.createSession(),st={decryptdata:et,keySystem:rt,mediaKeys:nt,mediaKeysSession:it,keyStatus:"status-pending"};return this.mediaKeySessions.push(st),st}renewKeySession(et){const rt=et.decryptdata;if(rt.pssh){const nt=this.createMediaKeySessionContext(et),it=this.getKeyIdString(rt),st="cenc";this.keyIdToKeySessionPromise[it]=this.generateRequestWithPreferredKeySession(nt,st,rt.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(et)}getKeyIdString(et){if(!et)throw new Error("Could not read keyId of undefined decryptdata");if(et.keyId===null)throw new Error("keyId is null");return Hex.hexDump(et.keyId)}updateKeySession(et,rt){var nt;const it=et.mediaKeysSession;return this.log(`Updating key-session "${it.sessionId}" for keyID ${Hex.hexDump(((nt=et.decryptdata)==null?void 0:nt.keyId)||[])}
      } (data length: ${rt&&rt.byteLength})`),it.update(rt)}selectKeySystemFormat(et){const rt=Object.keys(et.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${et.sn} ${et.type}: ${et.level}) key formats ${rt.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(rt)),this.keyFormatPromise}getKeyFormatPromise(et){return new Promise((rt,nt)=>{const it=getKeySystemsForConfig(this.config),st=et.map(keySystemFormatToKeySystemDomain).filter(ot=>!!ot&&it.indexOf(ot)!==-1);return this.getKeySystemSelectionPromise(st).then(({keySystem:ot})=>{const lt=keySystemDomainToKeySystemFormat(ot);lt?rt(lt):nt(new Error(`Unable to find format for key-system "${ot}"`))}).catch(nt)})}loadKey(et){const rt=et.keyInfo.decryptdata,nt=this.getKeyIdString(rt),it=`(keyId: ${nt} format: "${rt.keyFormat}" method: ${rt.method} uri: ${rt.uri})`;this.log(`Starting session for key ${it}`);let st=this.keyIdToKeySessionPromise[nt];return st||(st=this.keyIdToKeySessionPromise[nt]=this.getKeySystemForKeyPromise(rt).then(({keySystem:ot,mediaKeys:lt})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${et.frag.sn} ${et.frag.type}: ${et.frag.level} using key ${it}`),this.attemptSetMediaKeys(ot,lt).then(()=>{this.throwIfDestroyed();const ut=this.createMediaKeySessionContext({keySystem:ot,mediaKeys:lt,decryptdata:rt});return this.generateRequestWithPreferredKeySession(ut,"cenc",rt.pssh,"playlist-key")}))),st.catch(ot=>this.handleError(ot))),st}throwIfDestroyed(et="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(et){this.hls&&(this.error(et.message),et instanceof EMEKeyError?this.hls.trigger(Events.ERROR,et.data):this.hls.trigger(Events.ERROR,{type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_KEYS,error:et,fatal:!0}))}getKeySystemForKeyPromise(et){const rt=this.getKeyIdString(et),nt=this.keyIdToKeySessionPromise[rt];if(!nt){const it=keySystemFormatToKeySystemDomain(et.keyFormat),st=it?[it]:getKeySystemsForConfig(this.config);return this.attemptKeySystemAccess(st)}return nt}getKeySystemSelectionPromise(et){if(et.length||(et=getKeySystemsForConfig(this.config)),et.length===0)throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(et)}_onMediaEncrypted(et){const{initDataType:rt,initData:nt}=et;if(this.debug(`"${et.type}" event: init data type: "${rt}"`),nt===null)return;let it,st;if(rt==="sinf"&&this.config.drmSystems[KeySystems.FAIRPLAY]){const dt=bin2str(new Uint8Array(nt));try{const pt=base64Decode(JSON.parse(dt).sinf),ft=parseSinf(new Uint8Array(pt));if(!ft)return;it=ft.subarray(8,24),st=KeySystems.FAIRPLAY}catch{this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{const dt=parsePssh(nt);if(dt===null)return;dt.version===0&&dt.systemId===KeySystemIds.WIDEVINE&&dt.data&&(it=dt.data.subarray(8,24)),st=keySystemIdToKeySystemDomain(dt.systemId)}if(!st||!it)return;const ot=Hex.hexDump(it),{keyIdToKeySessionPromise:lt,mediaKeySessions:ut}=this;let ct=lt[ot];for(let dt=0;dt<ut.length;dt++){const pt=ut[dt],ft=pt.decryptdata;if(ft.pssh||!ft.keyId)continue;const gt=Hex.hexDump(ft.keyId);if(ot===gt||ft.uri.replace(/-/g,"").indexOf(ot)!==-1){ct=lt[gt],delete lt[gt],ft.pssh=new Uint8Array(nt),ft.keyId=it,ct=lt[ot]=ct.then(()=>this.generateRequestWithPreferredKeySession(pt,rt,nt,"encrypted-event-key-match"));break}}ct||(ct=lt[ot]=this.getKeySystemSelectionPromise([st]).then(({keySystem:dt,mediaKeys:pt})=>{var ft;this.throwIfDestroyed();const gt=new LevelKey("ISO-23001-7",ot,(ft=keySystemDomainToKeySystemFormat(dt))!=null?ft:"");return gt.pssh=new Uint8Array(nt),gt.keyId=it,this.attemptSetMediaKeys(dt,pt).then(()=>{this.throwIfDestroyed();const _r=this.createMediaKeySessionContext({decryptdata:gt,keySystem:dt,mediaKeys:pt});return this.generateRequestWithPreferredKeySession(_r,rt,nt,"encrypted-event-no-match")})})),ct.catch(dt=>this.handleError(dt))}_onWaitingForKey(et){this.log(`"${et.type}" event`)}attemptSetMediaKeys(et,rt){const nt=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${et}"`);const it=Promise.all(nt).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(rt)});return this.setMediaKeysQueue.push(it),it.then(()=>{this.log(`Media-keys set for "${et}"`),nt.push(it),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(st=>nt.indexOf(st)===-1)})}generateRequestWithPreferredKeySession(et,rt,nt,it){var st,ot;const lt=(st=this.config.drmSystems)==null||(ot=st[et.keySystem])==null?void 0:ot.generateRequest;if(lt)try{const _r=lt.call(this.hls,rt,nt,et);if(!_r)throw new Error("Invalid response from configured generateRequest filter");rt=_r.initDataType,nt=et.decryptdata.pssh=_r.initData?new Uint8Array(_r.initData):null}catch(_r){var ut;if(this.warn(_r.message),(ut=this.hls)!=null&&ut.config.debug)throw _r}if(nt===null)return this.log(`Skipping key-session request for "${it}" (no initData)`),Promise.resolve(et);const ct=this.getKeyIdString(et.decryptdata);this.log(`Generating key-session request for "${it}": ${ct} (init data type: ${rt} length: ${nt?nt.byteLength:null})`);const dt=new EventEmitter,pt=et._onmessage=_r=>{const Yr=et.mediaKeysSession;if(!Yr){dt.emit("error",new Error("invalid state"));return}const{messageType:mt,message:Kr}=_r;this.log(`"${mt}" message event for session "${Yr.sessionId}" message size: ${Kr.byteLength}`),mt==="license-request"||mt==="license-renewal"?this.renewLicense(et,Kr).catch(Xr=>{this.handleError(Xr),dt.emit("error",Xr)}):mt==="license-release"?et.keySystem===KeySystems.FAIRPLAY&&(this.updateKeySession(et,strToUtf8array("acknowledged")),this.removeSession(et)):this.warn(`unhandled media key message type "${mt}"`)},ft=et._onkeystatuseschange=_r=>{if(!et.mediaKeysSession){dt.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(et);const mt=et.keyStatus;dt.emit("keyStatus",mt),mt==="expired"&&(this.warn(`${et.keySystem} expired for key ${ct}`),this.renewKeySession(et))};et.mediaKeysSession.addEventListener("message",pt),et.mediaKeysSession.addEventListener("keystatuseschange",ft);const gt=new Promise((_r,Yr)=>{dt.on("error",Yr),dt.on("keyStatus",mt=>{mt.startsWith("usable")?_r():mt==="output-restricted"?Yr(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):mt==="internal-error"?Yr(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${mt}"`)):mt==="expired"?Yr(new Error("key expired while generating request")):this.warn(`unhandled key status change "${mt}"`)})});return et.mediaKeysSession.generateRequest(rt,nt).then(()=>{var _r;this.log(`Request generated for key-session "${(_r=et.mediaKeysSession)==null?void 0:_r.sessionId}" keyId: ${ct}`)}).catch(_r=>{throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_SESSION,error:_r,fatal:!1},`Error generating key-session request: ${_r}`)}).then(()=>gt).catch(_r=>{throw dt.removeAllListeners(),this.removeSession(et),_r}).then(()=>(dt.removeAllListeners(),et))}onKeyStatusChange(et){et.mediaKeysSession.keyStatuses.forEach((rt,nt)=>{this.log(`key status change "${rt}" for keyStatuses keyId: ${Hex.hexDump("buffer"in nt?new Uint8Array(nt.buffer,nt.byteOffset,nt.byteLength):new Uint8Array(nt))} session keyId: ${Hex.hexDump(new Uint8Array(et.decryptdata.keyId||[]))} uri: ${et.decryptdata.uri}`),et.keyStatus=rt})}fetchServerCertificate(et){const rt=this.config,nt=rt.loader,it=new nt(rt),st=this.getServerCertificateUrl(et);return st?(this.log(`Fetching server certificate for "${et}"`),new Promise((ot,lt)=>{const ut={responseType:"arraybuffer",url:st},ct=rt.certLoadPolicy.default,dt={loadPolicy:ct,timeout:ct.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},pt={onSuccess:(ft,gt,_r,Yr)=>{ot(ft.data)},onError:(ft,gt,_r,Yr)=>{lt(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:_r,response:_objectSpread2({url:ut.url,data:void 0},ft)},`"${et}" certificate request failed (${st}). Status: ${ft.code} (${ft.text})`))},onTimeout:(ft,gt,_r)=>{lt(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:_r,response:{url:ut.url,data:void 0}},`"${et}" certificate request timed out (${st})`))},onAbort:(ft,gt,_r)=>{lt(new Error("aborted"))}};it.load(ut,dt,pt)})):Promise.resolve()}setMediaKeysServerCertificate(et,rt,nt){return new Promise((it,st)=>{et.setServerCertificate(nt).then(ot=>{this.log(`setServerCertificate ${ot?"success":"not supported by CDM"} (${nt==null?void 0:nt.byteLength}) on "${rt}"`),it(et)}).catch(ot=>{st(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:ot,fatal:!0},ot.message))})})}renewLicense(et,rt){return this.requestLicense(et,new Uint8Array(rt)).then(nt=>this.updateKeySession(et,new Uint8Array(nt)).catch(it=>{throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:it,fatal:!0},it.message)}))}unpackPlayReadyKeyMessage(et,rt){const nt=String.fromCharCode.apply(null,new Uint16Array(rt.buffer));if(!nt.includes("PlayReadyKeyMessage"))return et.setRequestHeader("Content-Type","text/xml; charset=utf-8"),rt;const it=new DOMParser().parseFromString(nt,"application/xml"),st=it.querySelectorAll("HttpHeader");if(st.length>0){let dt;for(let pt=0,ft=st.length;pt<ft;pt++){var ot,lt;dt=st[pt];const gt=(ot=dt.querySelector("name"))==null?void 0:ot.textContent,_r=(lt=dt.querySelector("value"))==null?void 0:lt.textContent;gt&&_r&&et.setRequestHeader(gt,_r)}}const ut=it.querySelector("Challenge"),ct=ut==null?void 0:ut.textContent;if(!ct)throw new Error("Cannot find <Challenge> in key message");return strToUtf8array(atob(ct))}setupLicenseXHR(et,rt,nt,it){const st=this.config.licenseXhrSetup;return st?Promise.resolve().then(()=>{if(!nt.decryptdata)throw new Error("Key removed");return st.call(this.hls,et,rt,nt,it)}).catch(ot=>{if(!nt.decryptdata)throw ot;return et.open("POST",rt,!0),st.call(this.hls,et,rt,nt,it)}).then(ot=>(et.readyState||et.open("POST",rt,!0),{xhr:et,licenseChallenge:ot||it})):(et.open("POST",rt,!0),Promise.resolve({xhr:et,licenseChallenge:it}))}requestLicense(et,rt){const nt=this.config.keyLoadPolicy.default;return new Promise((it,st)=>{const ot=this.getLicenseServerUrl(et.keySystem);this.log(`Sending license request to URL: ${ot}`);const lt=new XMLHttpRequest;lt.responseType="arraybuffer",lt.onreadystatechange=()=>{if(!this.hls||!et.mediaKeysSession)return st(new Error("invalid state"));if(lt.readyState===4)if(lt.status===200){this._requestLicenseFailureCount=0;let ut=lt.response;this.log(`License received ${ut instanceof ArrayBuffer?ut.byteLength:ut}`);const ct=this.config.licenseResponseCallback;if(ct)try{ut=ct.call(this.hls,lt,ot,et)}catch(dt){this.error(dt)}it(ut)}else{const ut=nt.errorRetry,ct=ut?ut.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>ct||lt.status>=400&&lt.status<500)st(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:lt,response:{url:ot,data:void 0,code:lt.status,text:lt.statusText}},`License Request XHR failed (${ot}). Status: ${lt.status} (${lt.statusText})`));else{const dt=ct-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${dt} attempts left`),this.requestLicense(et,rt).then(it,st)}}},et.licenseXhr&&et.licenseXhr.readyState!==XMLHttpRequest.DONE&&et.licenseXhr.abort(),et.licenseXhr=lt,this.setupLicenseXHR(lt,ot,et,rt).then(({xhr:ut,licenseChallenge:ct})=>{et.keySystem==KeySystems.PLAYREADY&&(ct=this.unpackPlayReadyKeyMessage(ut,ct)),ut.send(ct)})})}onMediaAttached(et,rt){if(!this.config.emeEnabled)return;const nt=rt.media;this.media=nt,nt.addEventListener("encrypted",this.onMediaEncrypted),nt.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const et=this.media,rt=this.mediaKeySessions;et&&(et.removeEventListener("encrypted",this.onMediaEncrypted),et.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},LevelKey.clearKeyUriToKeyIdMap();const nt=rt.length;EMEController.CDMCleanupPromise=Promise.all(rt.map(it=>this.removeSession(it)).concat(et==null?void 0:et.setMediaKeys(null).catch(it=>{this.log(`Could not clear media keys: ${it}`)}))).then(()=>{nt&&(this.log("finished closing key sessions and clearing media keys"),rt.length=0)}).catch(it=>{this.log(`Could not close sessions and clear media keys: ${it}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(et,{sessionKeys:rt}){if(!(!rt||!this.config.emeEnabled)&&!this.keyFormatPromise){const nt=rt.reduce((it,st)=>(it.indexOf(st.keyFormat)===-1&&it.push(st.keyFormat),it),[]);this.log(`Selecting key-system from session-keys ${nt.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(nt)}}removeSession(et){const{mediaKeysSession:rt,licenseXhr:nt}=et;if(rt){this.log(`Remove licenses and keys and close session ${rt.sessionId}`),et._onmessage&&(rt.removeEventListener("message",et._onmessage),et._onmessage=void 0),et._onkeystatuseschange&&(rt.removeEventListener("keystatuseschange",et._onkeystatuseschange),et._onkeystatuseschange=void 0),nt&&nt.readyState!==XMLHttpRequest.DONE&&nt.abort(),et.mediaKeysSession=et.decryptdata=et.licenseXhr=void 0;const it=this.mediaKeySessions.indexOf(et);return it>-1&&this.mediaKeySessions.splice(it,1),rt.remove().catch(st=>{this.log(`Could not remove session: ${st}`)}).then(()=>rt.close()).catch(st=>{this.log(`Could not close session: ${st}`)})}}}EMEController.CDMCleanupPromise=void 0;class EMEKeyError extends Error{constructor(et,rt){super(rt),this.data=void 0,et.error||(et.error=new Error(rt)),this.data=et,et.err=et.error}}var CmObjectType;(function(tt){tt.MANIFEST="m",tt.AUDIO="a",tt.VIDEO="v",tt.MUXED="av",tt.INIT="i",tt.CAPTION="c",tt.TIMED_TEXT="tt",tt.KEY="k",tt.OTHER="o"})(CmObjectType||(CmObjectType={}));var CmStreamingFormat;(function(tt){tt.DASH="d",tt.HLS="h",tt.SMOOTH="s",tt.OTHER="o"})(CmStreamingFormat||(CmStreamingFormat={}));var CmcdHeaderField;(function(tt){tt.OBJECT="CMCD-Object",tt.REQUEST="CMCD-Request",tt.SESSION="CMCD-Session",tt.STATUS="CMCD-Status"})(CmcdHeaderField||(CmcdHeaderField={}));const CmcdHeaderMap={[CmcdHeaderField.OBJECT]:["br","d","ot","tb"],[CmcdHeaderField.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[CmcdHeaderField.SESSION]:["cid","pr","sf","sid","st","v"],[CmcdHeaderField.STATUS]:["bs","rtp"]};class SfItem{constructor(et,rt){this.value=void 0,this.params=void 0,Array.isArray(et)&&(et=et.map(nt=>nt instanceof SfItem?nt:new SfItem(nt))),this.value=et,this.params=rt}}class SfToken{constructor(et){this.description=void 0,this.description=et}}const DICT="Dict";function format(tt){return Array.isArray(tt)?JSON.stringify(tt):tt instanceof Map?"Map{}":tt instanceof Set?"Set{}":typeof tt=="object"?JSON.stringify(tt):String(tt)}function throwError(tt,et,rt,nt){return new Error(`failed to ${tt} "${format(et)}" as ${rt}`,{cause:nt})}const BARE_ITEM="Bare Item",BOOLEAN="Boolean",BYTES="Byte Sequence",DECIMAL="Decimal",INTEGER="Integer";function isInvalidInt(tt){return tt<-999999999999999||999999999999999<tt}const STRING_REGEX=/[\x00-\x1f\x7f]+/,TOKEN="Token",KEY="Key";function serializeError(tt,et,rt){return throwError("serialize",tt,et,rt)}function serializeBoolean(tt){if(typeof tt!="boolean")throw serializeError(tt,BOOLEAN);return tt?"?1":"?0"}function base64encode(tt){return btoa(String.fromCharCode(...tt))}function serializeByteSequence(tt){if(ArrayBuffer.isView(tt)===!1)throw serializeError(tt,BYTES);return`:${base64encode(tt)}:`}function serializeInteger(tt){if(isInvalidInt(tt))throw serializeError(tt,INTEGER);return tt.toString()}function serializeDate(tt){return`@${serializeInteger(tt.getTime()/1e3)}`}function roundToEven(tt,et){if(tt<0)return-roundToEven(-tt,et);const rt=Math.pow(10,et);if(Math.abs(tt*rt%1-.5)<Number.EPSILON){const it=Math.floor(tt*rt);return(it%2===0?it:it+1)/rt}else return Math.round(tt*rt)/rt}function serializeDecimal(tt){const et=roundToEven(tt,3);if(Math.floor(Math.abs(et)).toString().length>12)throw serializeError(tt,DECIMAL);const rt=et.toString();return rt.includes(".")?rt:`${rt}.0`}const STRING="String";function serializeString(tt){if(STRING_REGEX.test(tt))throw serializeError(tt,STRING);return`"${tt.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function symbolToStr(tt){return tt.description||tt.toString().slice(7,-1)}function serializeToken(tt){const et=symbolToStr(tt);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(et)===!1)throw serializeError(et,TOKEN);return et}function serializeBareItem(tt){switch(typeof tt){case"number":if(!isFiniteNumber(tt))throw serializeError(tt,BARE_ITEM);return Number.isInteger(tt)?serializeInteger(tt):serializeDecimal(tt);case"string":return serializeString(tt);case"symbol":return serializeToken(tt);case"boolean":return serializeBoolean(tt);case"object":if(tt instanceof Date)return serializeDate(tt);if(tt instanceof Uint8Array)return serializeByteSequence(tt);if(tt instanceof SfToken)return serializeToken(tt);default:throw serializeError(tt,BARE_ITEM)}}function serializeKey(tt){if(/^[a-z*][a-z0-9\-_.*]*$/.test(tt)===!1)throw serializeError(tt,KEY);return tt}function serializeParams(tt){return tt==null?"":Object.entries(tt).map(([et,rt])=>rt===!0?`;${serializeKey(et)}`:`;${serializeKey(et)}=${serializeBareItem(rt)}`).join("")}function serializeItem(tt){return tt instanceof SfItem?`${serializeBareItem(tt.value)}${serializeParams(tt.params)}`:serializeBareItem(tt)}function serializeInnerList(tt){return`(${tt.value.map(serializeItem).join(" ")})${serializeParams(tt.params)}`}function serializeDict(tt,et={whitespace:!0}){if(typeof tt!="object")throw serializeError(tt,DICT);const rt=tt instanceof Map?tt.entries():Object.entries(tt),nt=et!=null&&et.whitespace?" ":"";return Array.from(rt).map(([it,st])=>{st instanceof SfItem||(st=new SfItem(st));let ot=serializeKey(it);return st.value===!0?ot+=serializeParams(st.params):(ot+="=",Array.isArray(st.value)?ot+=serializeInnerList(st):ot+=serializeItem(st)),ot}).join(`,${nt}`)}function encodeSfDict(tt,et){return serializeDict(tt,et)}const isTokenField=tt=>tt==="ot"||tt==="sf"||tt==="st",isValid=tt=>typeof tt=="number"?isFiniteNumber(tt):tt!=null&&tt!==""&&tt!==!1;function urlToRelativePath(tt,et){const rt=new URL(tt),nt=new URL(et);if(rt.origin!==nt.origin)return tt;const it=rt.pathname.split("/").slice(1),st=nt.pathname.split("/").slice(1,-1);for(;it[0]===st[0];)it.shift(),st.shift();for(;st.length;)st.shift(),it.unshift("..");return it.join("/")}function uuid(){try{return crypto.randomUUID()}catch{try{const et=URL.createObjectURL(new Blob),rt=et.toString();return URL.revokeObjectURL(et),rt.slice(rt.lastIndexOf("/")+1)}catch{let rt=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,it=>{const st=(rt+Math.random()*16)%16|0;return rt=Math.floor(rt/16),(it=="x"?st:st&3|8).toString(16)})}}}const toRounded=tt=>Math.round(tt),toUrlSafe=(tt,et)=>(et!=null&&et.baseUrl&&(tt=urlToRelativePath(tt,et.baseUrl)),encodeURIComponent(tt)),toHundred=tt=>toRounded(tt/100)*100,CmcdFormatters={br:toRounded,d:toRounded,bl:toHundred,dl:toHundred,mtp:toHundred,nor:toUrlSafe,rtp:toHundred,tb:toRounded};function processCmcd(tt,et){const rt={};if(tt==null||typeof tt!="object")return rt;const nt=Object.keys(tt).sort(),it=_extends({},CmcdFormatters,et==null?void 0:et.formatters),st=et==null?void 0:et.filter;return nt.forEach(ot=>{if(st!=null&&st(ot))return;let lt=tt[ot];const ut=it[ot];ut&&(lt=ut(lt,et)),!(ot==="v"&&lt===1)&&(ot=="pr"&&lt===1||isValid(lt)&&(isTokenField(ot)&&typeof lt=="string"&&(lt=new SfToken(lt)),rt[ot]=lt))}),rt}function encodeCmcd(tt,et={}){return tt?encodeSfDict(processCmcd(tt,et),_extends({whitespace:!1},et)):""}function toCmcdHeaders(tt,et={}){if(!tt)return{};const rt=Object.entries(tt),nt=Object.entries(CmcdHeaderMap).concat(Object.entries((et==null?void 0:et.customHeaderMap)||{})),it=rt.reduce((st,ot)=>{var lt,ut;const[ct,dt]=ot,pt=((lt=nt.find(ft=>ft[1].includes(ct)))==null?void 0:lt[0])||CmcdHeaderField.REQUEST;return(ut=st[pt])!=null||(st[pt]={}),st[pt][ct]=dt,st},{});return Object.entries(it).reduce((st,[ot,lt])=>(st[ot]=encodeCmcd(lt,et),st),{})}function appendCmcdHeaders(tt,et,rt){return _extends(tt,toCmcdHeaders(et,rt))}const CMCD_PARAM="CMCD";function toCmcdQuery(tt,et={}){if(!tt)return"";const rt=encodeCmcd(tt,et);return`${CMCD_PARAM}=${encodeURIComponent(rt)}`}const REGEX=/CMCD=[^&#]+/;function appendCmcdQuery(tt,et,rt){const nt=toCmcdQuery(et,rt);if(!nt)return tt;if(REGEX.test(tt))return tt.replace(REGEX,nt);const it=tt.includes("?")?"&":"?";return`${tt}${it}${nt}`}class CMCDController{constructor(et){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=it=>{try{this.apply(it,{ot:CmObjectType.MANIFEST,su:!this.initialized})}catch(st){logger.warn("Could not generate manifest CMCD data.",st)}},this.applyFragmentData=it=>{try{const st=it.frag,ot=this.hls.levels[st.level],lt=this.getObjectType(st),ut={d:st.duration*1e3,ot:lt};(lt===CmObjectType.VIDEO||lt===CmObjectType.AUDIO||lt==CmObjectType.MUXED)&&(ut.br=ot.bitrate/1e3,ut.tb=this.getTopBandwidth(lt)/1e3,ut.bl=this.getBufferLength(lt)),this.apply(it,ut)}catch(st){logger.warn("Could not generate segment CMCD data.",st)}},this.hls=et;const rt=this.config=et.config,{cmcd:nt}=rt;nt!=null&&(rt.pLoader=this.createPlaylistLoader(),rt.fLoader=this.createFragmentLoader(),this.sid=nt.sessionId||uuid(),this.cid=nt.contentId,this.useHeaders=nt.useHeaders===!0,this.includeKeys=nt.includeKeys,this.registerListeners())}registerListeners(){const et=this.hls;et.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),et.on(Events.MEDIA_DETACHED,this.onMediaDetached,this),et.on(Events.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const et=this.hls;et.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),et.off(Events.MEDIA_DETACHED,this.onMediaDetached,this),et.off(Events.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=null}onMediaAttached(et,rt){this.media=rt.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(et,rt){var nt,it;this.audioBuffer=(nt=rt.tracks.audio)==null?void 0:nt.buffer,this.videoBuffer=(it=rt.tracks.video)==null?void 0:it.buffer}createData(){var et;return{v:1,sf:CmStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(et=this.media)==null?void 0:et.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(et,rt={}){_extends(rt,this.createData());const nt=rt.ot===CmObjectType.INIT||rt.ot===CmObjectType.VIDEO||rt.ot===CmObjectType.MUXED;this.starved&&nt&&(rt.bs=!0,rt.su=!0,this.starved=!1),rt.su==null&&(rt.su=this.buffering);const{includeKeys:it}=this;it&&(rt=Object.keys(rt).reduce((st,ot)=>(it.includes(ot)&&(st[ot]=rt[ot]),st),{})),this.useHeaders?(et.headers||(et.headers={}),appendCmcdHeaders(et.headers,rt)):et.url=appendCmcdQuery(et.url,rt)}getObjectType(et){const{type:rt}=et;if(rt==="subtitle")return CmObjectType.TIMED_TEXT;if(et.sn==="initSegment")return CmObjectType.INIT;if(rt==="audio")return CmObjectType.AUDIO;if(rt==="main")return this.hls.audioTracks.length?CmObjectType.VIDEO:CmObjectType.MUXED}getTopBandwidth(et){let rt=0,nt;const it=this.hls;if(et===CmObjectType.AUDIO)nt=it.audioTracks;else{const st=it.maxAutoLevel,ot=st>-1?st+1:it.levels.length;nt=it.levels.slice(0,ot)}for(const st of nt)st.bitrate>rt&&(rt=st.bitrate);return rt>0?rt:NaN}getBufferLength(et){const rt=this.hls.media,nt=et===CmObjectType.AUDIO?this.audioBuffer:this.videoBuffer;return!nt||!rt?NaN:BufferHelper.bufferInfo(nt,rt.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:et}=this.config,rt=this.applyPlaylistData,nt=et||this.config.loader;return class{constructor(st){this.loader=void 0,this.loader=new nt(st)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(st,ot,lt){rt(st),this.loader.load(st,ot,lt)}}}createFragmentLoader(){const{fLoader:et}=this.config,rt=this.applyFragmentData,nt=et||this.config.loader;return class{constructor(st){this.loader=void 0,this.loader=new nt(st)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(st,ot,lt){rt(st),this.loader.load(st,ot,lt)}}}}const PATHWAY_PENALTY_DURATION_MS=3e5;class ContentSteeringController{constructor(et){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=et,this.log=logger.log.bind(logger,"[content-steering]:"),this.registerListeners()}registerListeners(){const et=this.hls;et.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),et.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),et.on(Events.ERROR,this.onError,this)}unregisterListeners(){const et=this.hls;et&&(et.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),et.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),et.off(Events.ERROR,this.onError,this))}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const et=this.timeToLoad*1e3-(performance.now()-this.updated);if(et>0){this.scheduleRefresh(this.uri,et);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(et){const rt=this.levels;rt&&(this.levels=rt.filter(nt=>nt!==et))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(et,rt){const{contentSteering:nt}=rt;nt!==null&&(this.pathwayId=nt.pathwayId,this.uri=nt.uri,this.started&&this.startLoad())}onManifestParsed(et,rt){this.audioTracks=rt.audioTracks,this.subtitleTracks=rt.subtitleTracks}onError(et,rt){const{errorAction:nt}=rt;if((nt==null?void 0:nt.action)===NetworkErrorAction.SendAlternateToPenaltyBox&&nt.flags===ErrorActionFlags.MoveAllAlternatesMatchingHost){const it=this.levels;let st=this.pathwayPriority,ot=this.pathwayId;if(rt.context){const{groupId:lt,pathwayId:ut,type:ct}=rt.context;lt&&it?ot=this.getPathwayForGroupId(lt,ct,ot):ut&&(ot=ut)}ot in this.penalizedPathways||(this.penalizedPathways[ot]=performance.now()),!st&&it&&(st=it.reduce((lt,ut)=>(lt.indexOf(ut.pathwayId)===-1&&lt.push(ut.pathwayId),lt),[])),st&&st.length>1&&(this.updatePathwayPriority(st),nt.resolved=this.pathwayId!==ot),nt.resolved||logger.warn(`Could not resolve ${rt.details} ("${rt.error.message}") with content-steering for Pathway: ${ot} levels: ${it&&it.length} priorities: ${JSON.stringify(st)} penalized: ${JSON.stringify(this.penalizedPathways)}`)}}filterParsedLevels(et){this.levels=et;let rt=this.getLevelsForPathway(this.pathwayId);if(rt.length===0){const nt=et[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${nt}"`),rt=this.getLevelsForPathway(nt),this.pathwayId=nt}return rt.length!==et.length?(this.log(`Found ${rt.length}/${et.length} levels in Pathway "${this.pathwayId}"`),rt):et}getLevelsForPathway(et){return this.levels===null?[]:this.levels.filter(rt=>et===rt.pathwayId)}updatePathwayPriority(et){this.pathwayPriority=et;let rt;const nt=this.penalizedPathways,it=performance.now();Object.keys(nt).forEach(st=>{it-nt[st]>PATHWAY_PENALTY_DURATION_MS&&delete nt[st]});for(let st=0;st<et.length;st++){const ot=et[st];if(ot in nt)continue;if(ot===this.pathwayId)return;const lt=this.hls.nextLoadLevel,ut=this.hls.levels[lt];if(rt=this.getLevelsForPathway(ot),rt.length>0){this.log(`Setting Pathway to "${ot}"`),this.pathwayId=ot,reassignFragmentLevelIndexes(rt),this.hls.trigger(Events.LEVELS_UPDATED,{levels:rt});const ct=this.hls.levels[lt];ut&&ct&&this.levels&&(ct.attrs["STABLE-VARIANT-ID"]!==ut.attrs["STABLE-VARIANT-ID"]&&ct.bitrate!==ut.bitrate&&this.log(`Unstable Pathways change from bitrate ${ut.bitrate} to ${ct.bitrate}`),this.hls.nextLoadLevel=lt);break}}}getPathwayForGroupId(et,rt,nt){const it=this.getLevelsForPathway(nt).concat(this.levels||[]);for(let st=0;st<it.length;st++)if(rt===PlaylistContextType.AUDIO_TRACK&&it[st].hasAudioGroup(et)||rt===PlaylistContextType.SUBTITLE_TRACK&&it[st].hasSubtitleGroup(et))return it[st].pathwayId;return nt}clonePathways(et){const rt=this.levels;if(!rt)return;const nt={},it={};et.forEach(st=>{const{ID:ot,"BASE-ID":lt,"URI-REPLACEMENT":ut}=st;if(rt.some(dt=>dt.pathwayId===ot))return;const ct=this.getLevelsForPathway(lt).map(dt=>{const pt=new AttrList(dt.attrs);pt["PATHWAY-ID"]=ot;const ft=pt.AUDIO&&`${pt.AUDIO}_clone_${ot}`,gt=pt.SUBTITLES&&`${pt.SUBTITLES}_clone_${ot}`;ft&&(nt[pt.AUDIO]=ft,pt.AUDIO=ft),gt&&(it[pt.SUBTITLES]=gt,pt.SUBTITLES=gt);const _r=performUriReplacement(dt.uri,pt["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",ut),Yr=new Level({attrs:pt,audioCodec:dt.audioCodec,bitrate:dt.bitrate,height:dt.height,name:dt.name,url:_r,videoCodec:dt.videoCodec,width:dt.width});if(dt.audioGroups)for(let mt=1;mt<dt.audioGroups.length;mt++)Yr.addGroupId("audio",`${dt.audioGroups[mt]}_clone_${ot}`);if(dt.subtitleGroups)for(let mt=1;mt<dt.subtitleGroups.length;mt++)Yr.addGroupId("text",`${dt.subtitleGroups[mt]}_clone_${ot}`);return Yr});rt.push(...ct),cloneRenditionGroups(this.audioTracks,nt,ut,ot),cloneRenditionGroups(this.subtitleTracks,it,ut,ot)})}loadSteeringManifest(et){const rt=this.hls.config,nt=rt.loader;this.loader&&this.loader.destroy(),this.loader=new nt(rt);let it;try{it=new self.URL(et)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${et}`);return}if(it.protocol!=="data:"){const dt=(this.hls.bandwidthEstimate||rt.abrEwmaDefaultEstimate)|0;it.searchParams.set("_HLS_pathway",this.pathwayId),it.searchParams.set("_HLS_throughput",""+dt)}const st={responseType:"json",url:it.href},ot=rt.steeringManifestLoadPolicy.default,lt=ot.errorRetry||ot.timeoutRetry||{},ut={loadPolicy:ot,timeout:ot.maxLoadTimeMs,maxRetry:lt.maxNumRetry||0,retryDelay:lt.retryDelayMs||0,maxRetryDelay:lt.maxRetryDelayMs||0},ct={onSuccess:(dt,pt,ft,gt)=>{this.log(`Loaded steering manifest: "${it}"`);const _r=dt.data;if(_r.VERSION!==1){this.log(`Steering VERSION ${_r.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=_r.TTL;const{"RELOAD-URI":Yr,"PATHWAY-CLONES":mt,"PATHWAY-PRIORITY":Kr}=_r;if(Yr)try{this.uri=new self.URL(Yr,it).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${Yr}`);return}this.scheduleRefresh(this.uri||ft.url),mt&&this.clonePathways(mt);const Xr={steeringManifest:_r,url:it.toString()};this.hls.trigger(Events.STEERING_MANIFEST_LOADED,Xr),Kr&&this.updatePathwayPriority(Kr)},onError:(dt,pt,ft,gt)=>{if(this.log(`Error loading steering manifest: ${dt.code} ${dt.text} (${pt.url})`),this.stopLoad(),dt.code===410){this.enabled=!1,this.log(`Steering manifest ${pt.url} no longer available`);return}let _r=this.timeToLoad*1e3;if(dt.code===429){const Yr=this.loader;if(typeof(Yr==null?void 0:Yr.getResponseHeader)=="function"){const mt=Yr.getResponseHeader("Retry-After");mt&&(_r=parseFloat(mt)*1e3)}this.log(`Steering manifest ${pt.url} rate limited`);return}this.scheduleRefresh(this.uri||pt.url,_r)},onTimeout:(dt,pt,ft)=>{this.log(`Timeout loading steering manifest (${pt.url})`),this.scheduleRefresh(this.uri||pt.url)}};this.log(`Requesting steering manifest: ${it}`),this.loader.load(st,ut,ct)}scheduleRefresh(et,rt=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var nt;const it=(nt=this.hls)==null?void 0:nt.media;if(it&&!it.ended){this.loadSteeringManifest(et);return}this.scheduleRefresh(et,this.timeToLoad*1e3)},rt)}}function cloneRenditionGroups(tt,et,rt,nt){tt&&Object.keys(et).forEach(it=>{const st=tt.filter(ot=>ot.groupId===it).map(ot=>{const lt=_extends({},ot);return lt.details=void 0,lt.attrs=new AttrList(lt.attrs),lt.url=lt.attrs.URI=performUriReplacement(ot.url,ot.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",rt),lt.groupId=lt.attrs["GROUP-ID"]=et[it],lt.attrs["PATHWAY-ID"]=nt,lt});tt.push(...st)})}function performUriReplacement(tt,et,rt,nt){const{HOST:it,PARAMS:st,[rt]:ot}=nt;let lt;et&&(lt=ot==null?void 0:ot[et],lt&&(tt=lt));const ut=new self.URL(tt);return it&&!lt&&(ut.host=it),st&&Object.keys(st).sort().forEach(ct=>{ct&&ut.searchParams.set(ct,st[ct])}),ut.href}const AGE_HEADER_LINE_REGEX=/^age:\s*[\d.]+\s*$/im;class XhrLoader{constructor(et){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=et&&et.xhrSetup||null,this.stats=new LoadStats,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null,this.stats=null}abortInternal(){const et=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),et&&(et.onreadystatechange=null,et.onprogress=null,et.readyState!==4&&(this.stats.aborted=!0,et.abort()))}abort(){var et;this.abortInternal(),(et=this.callbacks)!=null&&et.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(et,rt,nt){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=et,this.config=rt,this.callbacks=nt,this.loadInternal()}loadInternal(){const{config:et,context:rt}=this;if(!et||!rt)return;const nt=this.loader=new self.XMLHttpRequest,it=this.stats;it.loading.first=0,it.loaded=0,it.aborted=!1;const st=this.xhrSetup;st?Promise.resolve().then(()=>{if(!this.stats.aborted)return st(nt,rt.url)}).catch(ot=>(nt.open("GET",rt.url,!0),st(nt,rt.url))).then(()=>{this.stats.aborted||this.openAndSendXhr(nt,rt,et)}).catch(ot=>{this.callbacks.onError({code:nt.status,text:ot.message},rt,nt,it)}):this.openAndSendXhr(nt,rt,et)}openAndSendXhr(et,rt,nt){et.readyState||et.open("GET",rt.url,!0);const it=rt.headers,{maxTimeToFirstByteMs:st,maxLoadTimeMs:ot}=nt.loadPolicy;if(it)for(const lt in it)et.setRequestHeader(lt,it[lt]);rt.rangeEnd&&et.setRequestHeader("Range","bytes="+rt.rangeStart+"-"+(rt.rangeEnd-1)),et.onreadystatechange=this.readystatechange.bind(this),et.onprogress=this.loadprogress.bind(this),et.responseType=rt.responseType,self.clearTimeout(this.requestTimeout),nt.timeout=st&&isFiniteNumber(st)?st:ot,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),nt.timeout),et.send()}readystatechange(){const{context:et,loader:rt,stats:nt}=this;if(!et||!rt)return;const it=rt.readyState,st=this.config;if(!nt.aborted&&it>=2&&(nt.loading.first===0&&(nt.loading.first=Math.max(self.performance.now(),nt.loading.start),st.timeout!==st.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),st.timeout=st.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),st.loadPolicy.maxLoadTimeMs-(nt.loading.first-nt.loading.start)))),it===4)){self.clearTimeout(this.requestTimeout),rt.onreadystatechange=null,rt.onprogress=null;const ot=rt.status,lt=rt.responseType!=="text";if(ot>=200&&ot<300&&(lt&&rt.response||rt.responseText!==null)){nt.loading.end=Math.max(self.performance.now(),nt.loading.first);const ut=lt?rt.response:rt.responseText,ct=rt.responseType==="arraybuffer"?ut.byteLength:ut.length;if(nt.loaded=nt.total=ct,nt.bwEstimate=nt.total*8e3/(nt.loading.end-nt.loading.first),!this.callbacks)return;const dt=this.callbacks.onProgress;if(dt&&dt(nt,et,ut,rt),!this.callbacks)return;const pt={url:rt.responseURL,data:ut,code:ot};this.callbacks.onSuccess(pt,nt,et,rt)}else{const ut=st.loadPolicy.errorRetry,ct=nt.retry,dt={url:et.url,data:void 0,code:ot};shouldRetry(ut,ct,!1,dt)?this.retry(ut):(logger.error(`${ot} while loading ${et.url}`),this.callbacks.onError({code:ot,text:rt.statusText},et,rt,nt))}}}loadtimeout(){var et;const rt=(et=this.config)==null?void 0:et.loadPolicy.timeoutRetry,nt=this.stats.retry;if(shouldRetry(rt,nt,!0))this.retry(rt);else{var it;logger.warn(`timeout while loading ${(it=this.context)==null?void 0:it.url}`);const st=this.callbacks;st&&(this.abortInternal(),st.onTimeout(this.stats,this.context,this.loader))}}retry(et){const{context:rt,stats:nt}=this;this.retryDelay=getRetryDelay(et,nt.retry),nt.retry++,logger.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${rt==null?void 0:rt.url}, retrying ${nt.retry}/${et.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(et){const rt=this.stats;rt.loaded=et.loaded,et.lengthComputable&&(rt.total=et.total)}getCacheAge(){let et=null;if(this.loader&&AGE_HEADER_LINE_REGEX.test(this.loader.getAllResponseHeaders())){const rt=this.loader.getResponseHeader("age");et=rt?parseFloat(rt):null}return et}getResponseHeader(et){return this.loader&&new RegExp(`^${et}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(et):null}}function fetchSupported(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const BYTERANGE=/(\d+)-(\d+)\/(\d+)/;class FetchLoader{constructor(et){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=et.fetchSetup||getRequest,this.controller=new self.AbortController,this.stats=new LoadStats}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var et;this.abortInternal(),(et=this.callbacks)!=null&&et.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(et,rt,nt){const it=this.stats;if(it.loading.start)throw new Error("Loader can only be used once.");it.loading.start=self.performance.now();const st=getRequestParameters(et,this.controller.signal),ot=nt.onProgress,lt=et.responseType==="arraybuffer",ut=lt?"byteLength":"length",{maxTimeToFirstByteMs:ct,maxLoadTimeMs:dt}=rt.loadPolicy;this.context=et,this.config=rt,this.callbacks=nt,this.request=this.fetchSetup(et,st),self.clearTimeout(this.requestTimeout),rt.timeout=ct&&isFiniteNumber(ct)?ct:dt,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),nt.onTimeout(it,et,this.response)},rt.timeout),self.fetch(this.request).then(pt=>{this.response=this.loader=pt;const ft=Math.max(self.performance.now(),it.loading.start);if(self.clearTimeout(this.requestTimeout),rt.timeout=dt,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),nt.onTimeout(it,et,this.response)},dt-(ft-it.loading.start)),!pt.ok){const{status:gt,statusText:_r}=pt;throw new FetchError(_r||"fetch, bad network response",gt,pt)}return it.loading.first=ft,it.total=getContentLength(pt.headers)||it.total,ot&&isFiniteNumber(rt.highWaterMark)?this.loadProgressively(pt,it,et,rt.highWaterMark,ot):lt?pt.arrayBuffer():et.responseType==="json"?pt.json():pt.text()}).then(pt=>{const ft=this.response;if(!ft)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),it.loading.end=Math.max(self.performance.now(),it.loading.first);const gt=pt[ut];gt&&(it.loaded=it.total=gt);const _r={url:ft.url,data:pt,code:ft.status};ot&&!isFiniteNumber(rt.highWaterMark)&&ot(it,et,pt,ft),nt.onSuccess(_r,it,et,ft)}).catch(pt=>{if(self.clearTimeout(this.requestTimeout),it.aborted)return;const ft=pt&&pt.code||0,gt=pt?pt.message:null;nt.onError({code:ft,text:gt},et,pt?pt.details:null,it)})}getCacheAge(){let et=null;if(this.response){const rt=this.response.headers.get("age");et=rt?parseFloat(rt):null}return et}getResponseHeader(et){return this.response?this.response.headers.get(et):null}loadProgressively(et,rt,nt,it=0,st){const ot=new ChunkCache,lt=et.body.getReader(),ut=()=>lt.read().then(ct=>{if(ct.done)return ot.dataLength&&st(rt,nt,ot.flush(),et),Promise.resolve(new ArrayBuffer(0));const dt=ct.value,pt=dt.length;return rt.loaded+=pt,pt<it||ot.dataLength?(ot.push(dt),ot.dataLength>=it&&st(rt,nt,ot.flush(),et)):st(rt,nt,dt,et),ut()}).catch(()=>Promise.reject());return ut()}}function getRequestParameters(tt,et){const rt={method:"GET",mode:"cors",credentials:"same-origin",signal:et,headers:new self.Headers(_extends({},tt.headers))};return tt.rangeEnd&&rt.headers.set("Range","bytes="+tt.rangeStart+"-"+String(tt.rangeEnd-1)),rt}function getByteRangeLength(tt){const et=BYTERANGE.exec(tt);if(et)return parseInt(et[2])-parseInt(et[1])+1}function getContentLength(tt){const et=tt.get("Content-Range");if(et){const nt=getByteRangeLength(et);if(isFiniteNumber(nt))return nt}const rt=tt.get("Content-Length");if(rt)return parseInt(rt)}function getRequest(tt,et){return new self.Request(tt.url,et)}class FetchError extends Error{constructor(et,rt,nt){super(et),this.code=void 0,this.details=void 0,this.code=rt,this.details=nt}}const WHITESPACE_CHAR=/\s/,Cues={newCue(tt,et,rt,nt){const it=[];let st,ot,lt,ut,ct;const dt=self.VTTCue||self.TextTrackCue;for(let ft=0;ft<nt.rows.length;ft++)if(st=nt.rows[ft],lt=!0,ut=0,ct="",!st.isEmpty()){var pt;for(let Yr=0;Yr<st.chars.length;Yr++)WHITESPACE_CHAR.test(st.chars[Yr].uchar)&&lt?ut++:(ct+=st.chars[Yr].uchar,lt=!1);st.cueStartTime=et,et===rt&&(rt+=1e-4),ut>=16?ut--:ut++;const gt=fixLineBreaks(ct.trim()),_r=generateCueId(et,rt,gt);tt!=null&&(pt=tt.cues)!=null&&pt.getCueById(_r)||(ot=new dt(et,rt,gt),ot.id=_r,ot.line=ft+1,ot.align="left",ot.position=10+Math.min(80,Math.floor(ut*8/32)*10),it.push(ot))}return tt&&it.length&&(it.sort((ft,gt)=>ft.line==="auto"||gt.line==="auto"?0:ft.line>8&&gt.line>8?gt.line-ft.line:ft.line-gt.line),it.forEach(ft=>addCueToTrack(tt,ft))),it}},defaultLoadPolicy={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},hlsDefaultConfig=_objectSpread2(_objectSpread2({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:XhrLoader,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:AbrController,bufferController:BufferController,capLevelController:CapLevelController,errorController:ErrorController,fpsController:FPSController,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,useMediaCapabilities:!0,certLoadPolicy:{default:defaultLoadPolicy},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},timelineConfig()),{},{subtitleStreamController:SubtitleStreamController,subtitleTrackController:SubtitleTrackController,timelineController:TimelineController,audioStreamController:AudioStreamController,audioTrackController:AudioTrackController,emeController:EMEController,cmcdController:CMCDController,contentSteeringController:ContentSteeringController});function timelineConfig(){return{cueHandler:Cues,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function mergeConfig(tt,et){if((et.liveSyncDurationCount||et.liveMaxLatencyDurationCount)&&(et.liveSyncDuration||et.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(et.liveMaxLatencyDurationCount!==void 0&&(et.liveSyncDurationCount===void 0||et.liveMaxLatencyDurationCount<=et.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(et.liveMaxLatencyDuration!==void 0&&(et.liveSyncDuration===void 0||et.liveMaxLatencyDuration<=et.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const rt=deepCpy(tt),nt=["manifest","level","frag"],it=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return nt.forEach(st=>{const ot=`${st==="level"?"playlist":st}LoadPolicy`,lt=et[ot]===void 0,ut=[];it.forEach(ct=>{const dt=`${st}Loading${ct}`,pt=et[dt];if(pt!==void 0&&lt){ut.push(dt);const ft=rt[ot].default;switch(et[ot]={default:ft},ct){case"TimeOut":ft.maxLoadTimeMs=pt,ft.maxTimeToFirstByteMs=pt;break;case"MaxRetry":ft.errorRetry.maxNumRetry=pt,ft.timeoutRetry.maxNumRetry=pt;break;case"RetryDelay":ft.errorRetry.retryDelayMs=pt,ft.timeoutRetry.retryDelayMs=pt;break;case"MaxRetryTimeout":ft.errorRetry.maxRetryDelayMs=pt,ft.timeoutRetry.maxRetryDelayMs=pt;break}}}),ut.length&&logger.warn(`hls.js config: "${ut.join('", "')}" setting(s) are deprecated, use "${ot}": ${JSON.stringify(et[ot])}`)}),_objectSpread2(_objectSpread2({},rt),et)}function deepCpy(tt){return tt&&typeof tt=="object"?Array.isArray(tt)?tt.map(deepCpy):Object.keys(tt).reduce((et,rt)=>(et[rt]=deepCpy(tt[rt]),et),{}):tt}function enableStreamingMode(tt){const et=tt.loader;et!==FetchLoader&&et!==XhrLoader?(logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),tt.progressive=!1):fetchSupported()&&(tt.loader=FetchLoader,tt.progressive=!0,tt.enableSoftwareAES=!0,logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}let chromeOrFirefox;class LevelController extends BasePlaylistController{constructor(et,rt){super(et,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=rt,this._registerListeners()}_registerListeners(){const{hls:et}=this;et.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),et.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),et.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),et.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),et.on(Events.ERROR,this.onError,this)}_unregisterListeners(){const{hls:et}=this;et.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),et.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),et.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),et.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),et.off(Events.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(rt=>{rt.loadError=0,rt.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(et,rt){this.resetLevels()}onManifestLoaded(et,rt){const nt=this.hls.config.preferManagedMediaSource,it=[],st={},ot={};let lt=!1,ut=!1,ct=!1;rt.levels.forEach(dt=>{var pt,ft;const gt=dt.attrs;let{audioCodec:_r,videoCodec:Yr}=dt;((pt=_r)==null?void 0:pt.indexOf("mp4a.40.34"))!==-1&&(chromeOrFirefox||(chromeOrFirefox=/chrome|firefox/i.test(navigator.userAgent)),chromeOrFirefox&&(dt.audioCodec=_r=void 0)),_r&&(dt.audioCodec=_r=getCodecCompatibleName(_r,nt)),((ft=Yr)==null?void 0:ft.indexOf("avc1"))===0&&(Yr=dt.videoCodec=convertAVC1ToAVCOTI(Yr));const{width:mt,height:Kr,unknownCodecs:Xr}=dt;if(lt||(lt=!!(mt&&Kr)),ut||(ut=!!Yr),ct||(ct=!!_r),Xr!=null&&Xr.length||_r&&!areCodecsMediaSourceSupported(_r,"audio",nt)||Yr&&!areCodecsMediaSourceSupported(Yr,"video",nt))return;const{CODECS:Zr,"FRAME-RATE":Qr,"HDCP-LEVEL":_i,"PATHWAY-ID":ns,RESOLUTION:rs,"VIDEO-RANGE":ss}=gt,os=`${`${ns||"."}-`}${dt.bitrate}-${rs}-${Qr}-${Zr}-${ss}-${_i}`;if(st[os])if(st[os].uri!==dt.url&&!dt.attrs["PATHWAY-ID"]){const is=ot[os]+=1;dt.attrs["PATHWAY-ID"]=new Array(is+1).join(".");const cs=new Level(dt);st[os]=cs,it.push(cs)}else st[os].addGroupId("audio",gt.AUDIO),st[os].addGroupId("text",gt.SUBTITLES);else{const is=new Level(dt);st[os]=is,ot[os]=1,it.push(is)}}),this.filterAndSortMediaOptions(it,rt,lt,ut,ct)}filterAndSortMediaOptions(et,rt,nt,it,st){let ot=[],lt=[],ut=et;if((nt||it)&&st&&(ut=ut.filter(({videoCodec:_r,videoRange:Yr,width:mt,height:Kr})=>(!!_r||!!(mt&&Kr))&&isVideoRange(Yr))),ut.length===0){Promise.resolve().then(()=>{if(this.hls){rt.levels.length&&this.warn(`One or more CODECS in variant not supported: ${JSON.stringify(rt.levels[0].attrs)}`);const _r=new Error("no level with compatible codecs found in manifest");this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:rt.url,error:_r,reason:_r.message})}});return}if(rt.audioTracks){const{preferManagedMediaSource:_r}=this.hls.config;ot=rt.audioTracks.filter(Yr=>!Yr.audioCodec||areCodecsMediaSourceSupported(Yr.audioCodec,"audio",_r)),assignTrackIdsByGroup(ot)}rt.subtitles&&(lt=rt.subtitles,assignTrackIdsByGroup(lt));const ct=ut.slice(0);ut.sort((_r,Yr)=>{if(_r.attrs["HDCP-LEVEL"]!==Yr.attrs["HDCP-LEVEL"])return(_r.attrs["HDCP-LEVEL"]||"")>(Yr.attrs["HDCP-LEVEL"]||"")?1:-1;if(nt&&_r.height!==Yr.height)return _r.height-Yr.height;if(_r.frameRate!==Yr.frameRate)return _r.frameRate-Yr.frameRate;if(_r.videoRange!==Yr.videoRange)return VideoRangeValues.indexOf(_r.videoRange)-VideoRangeValues.indexOf(Yr.videoRange);if(_r.videoCodec!==Yr.videoCodec){const mt=videoCodecPreferenceValue(_r.videoCodec),Kr=videoCodecPreferenceValue(Yr.videoCodec);if(mt!==Kr)return Kr-mt}if(_r.uri===Yr.uri&&_r.codecSet!==Yr.codecSet){const mt=codecsSetSelectionPreferenceValue(_r.codecSet),Kr=codecsSetSelectionPreferenceValue(Yr.codecSet);if(mt!==Kr)return Kr-mt}return _r.averageBitrate!==Yr.averageBitrate?_r.averageBitrate-Yr.averageBitrate:0});let dt=ct[0];if(this.steering&&(ut=this.steering.filterParsedLevels(ut),ut.length!==ct.length)){for(let _r=0;_r<ct.length;_r++)if(ct[_r].pathwayId===ut[0].pathwayId){dt=ct[_r];break}}this._levels=ut;for(let _r=0;_r<ut.length;_r++)if(ut[_r]===dt){var pt;this._firstLevel=_r;const Yr=dt.bitrate,mt=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${ut.length} level(s) found, first bitrate: ${Yr}`),((pt=this.hls.userConfig)==null?void 0:pt.abrEwmaDefaultEstimate)===void 0){const Kr=Math.min(Yr,this.hls.config.abrEwmaDefaultEstimateMax);Kr>mt&&mt===hlsDefaultConfig.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=Kr)}break}const ft=st&&!it,gt={levels:ut,audioTracks:ot,subtitleTracks:lt,sessionData:rt.sessionData,sessionKeys:rt.sessionKeys,firstLevel:this._firstLevel,stats:rt.stats,audio:st,video:it,altAudio:!ft&&ot.some(_r=>!!_r.url)};this.hls.trigger(Events.MANIFEST_PARSED,gt),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return this._levels.length===0?null:this._levels}get level(){return this.currentLevelIndex}set level(et){const rt=this._levels;if(rt.length===0)return;if(et<0||et>=rt.length){const dt=new Error("invalid level idx"),pt=et<0;if(this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.LEVEL_SWITCH_ERROR,level:et,fatal:pt,error:dt,reason:dt.message}),pt)return;et=Math.min(et,rt.length-1)}const nt=this.currentLevelIndex,it=this.currentLevel,st=it?it.attrs["PATHWAY-ID"]:void 0,ot=rt[et],lt=ot.attrs["PATHWAY-ID"];if(this.currentLevelIndex=et,this.currentLevel=ot,nt===et&&ot.details&&it&&st===lt)return;this.log(`Switching to level ${et} (${ot.height?ot.height+"p ":""}${ot.videoRange?ot.videoRange+" ":""}${ot.codecSet?ot.codecSet+" ":""}@${ot.bitrate})${lt?" with Pathway "+lt:""} from level ${nt}${st?" with Pathway "+st:""}`);const ut={level:et,attrs:ot.attrs,details:ot.details,bitrate:ot.bitrate,averageBitrate:ot.averageBitrate,maxBitrate:ot.maxBitrate,realBitrate:ot.realBitrate,width:ot.width,height:ot.height,codecSet:ot.codecSet,audioCodec:ot.audioCodec,videoCodec:ot.videoCodec,audioGroups:ot.audioGroups,subtitleGroups:ot.subtitleGroups,loaded:ot.loaded,loadError:ot.loadError,fragmentError:ot.fragmentError,name:ot.name,id:ot.id,uri:ot.uri,url:ot.url,urlId:0,audioGroupIds:ot.audioGroupIds,textGroupIds:ot.textGroupIds};this.hls.trigger(Events.LEVEL_SWITCHING,ut);const ct=ot.details;if(!ct||ct.live){const dt=this.switchParams(ot.uri,it==null?void 0:it.details);this.loadPlaylist(dt)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(et){this.manualLevelIndex=et,this._startLevel===void 0&&(this._startLevel=et),et!==-1&&(this.level=et)}get firstLevel(){return this._firstLevel}set firstLevel(et){this._firstLevel=et}get startLevel(){if(this._startLevel===void 0){const et=this.hls.config.startLevel;return et!==void 0?et:this.hls.firstAutoLevel}return this._startLevel}set startLevel(et){this._startLevel=et}onError(et,rt){rt.fatal||!rt.context||rt.context.type===PlaylistContextType.LEVEL&&rt.context.level===this.level&&this.checkRetry(rt)}onFragBuffered(et,{frag:rt}){if(rt!==void 0&&rt.type===PlaylistLevelType.MAIN){const nt=rt.elementaryStreams;if(!Object.keys(nt).some(st=>!!nt[st]))return;const it=this._levels[rt.level];it!=null&&it.loadError&&(this.log(`Resetting level error count of ${it.loadError} on frag buffered`),it.loadError=0)}}onLevelLoaded(et,rt){var nt;const{level:it,details:st}=rt,ot=this._levels[it];if(!ot){var lt;this.warn(`Invalid level index ${it}`),(lt=rt.deliveryDirectives)!=null&&lt.skip&&(st.deltaUpdateFailed=!0);return}it===this.currentLevelIndex?(ot.fragmentError===0&&(ot.loadError=0),this.playlistLoaded(it,rt,ot.details)):(nt=rt.deliveryDirectives)!=null&&nt.skip&&(st.deltaUpdateFailed=!0)}loadPlaylist(et){super.loadPlaylist();const rt=this.currentLevelIndex,nt=this.currentLevel;if(nt&&this.shouldLoadPlaylist(nt)){let it=nt.uri;if(et)try{it=et.addDirectives(it)}catch(ot){this.warn(`Could not construct new URL with HLS Delivery Directives: ${ot}`)}const st=nt.attrs["PATHWAY-ID"];this.log(`Loading level index ${rt}${(et==null?void 0:et.msn)!==void 0?" at sn "+et.msn+" part "+et.part:""} with${st?" Pathway "+st:""} ${it}`),this.clearTimer(),this.hls.trigger(Events.LEVEL_LOADING,{url:it,level:rt,pathwayId:nt.attrs["PATHWAY-ID"],id:0,deliveryDirectives:et||null})}}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(et){this.level=et,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=et)}removeLevel(et){var rt;const nt=this._levels.filter((it,st)=>st!==et?!0:(this.steering&&this.steering.removeLevel(it),it===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,it.details&&it.details.fragments.forEach(ot=>ot.level=-1)),!1));reassignFragmentLevelIndexes(nt),this._levels=nt,this.currentLevelIndex>-1&&(rt=this.currentLevel)!=null&&rt.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.hls.trigger(Events.LEVELS_UPDATED,{levels:nt})}onLevelsUpdated(et,{levels:rt}){this._levels=rt}checkMaxAutoUpdated(){const{autoLevelCapping:et,maxAutoLevel:rt,maxHdcpLevel:nt}=this.hls;this._maxAutoLevel!==rt&&(this._maxAutoLevel=rt,this.hls.trigger(Events.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:et,levels:this.levels,maxAutoLevel:rt,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:nt}))}}function assignTrackIdsByGroup(tt){const et={};tt.forEach(rt=>{const nt=rt.groupId||"";rt.id=et[nt]=et[nt]||0,et[nt]++})}class KeyLoader{constructor(et){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=et}abort(et){for(const nt in this.keyUriToKeyInfo){const it=this.keyUriToKeyInfo[nt].loader;if(it){var rt;if(et&&et!==((rt=it.context)==null?void 0:rt.frag.type))return;it.abort()}}}detach(){for(const et in this.keyUriToKeyInfo){const rt=this.keyUriToKeyInfo[et];(rt.mediaKeySessionContext||rt.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[et]}}destroy(){this.detach();for(const et in this.keyUriToKeyInfo){const rt=this.keyUriToKeyInfo[et].loader;rt&&rt.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(et,rt=ErrorDetails.KEY_LOAD_ERROR,nt,it,st){return new LoadError({type:ErrorTypes.NETWORK_ERROR,details:rt,fatal:!1,frag:et,response:st,error:nt,networkDetails:it})}loadClear(et,rt){if(this.emeController&&this.config.emeEnabled){const{sn:nt,cc:it}=et;for(let st=0;st<rt.length;st++){const ot=rt[st];if(it<=ot.cc&&(nt==="initSegment"||ot.sn==="initSegment"||nt<ot.sn)){this.emeController.selectKeySystemFormat(ot).then(lt=>{ot.setKeyFormat(lt)});break}}}}load(et){return!et.decryptdata&&et.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(et).then(rt=>this.loadInternal(et,rt)):this.loadInternal(et)}loadInternal(et,rt){var nt,it;rt&&et.setKeyFormat(rt);const st=et.decryptdata;if(!st){const ct=new Error(rt?`Expected frag.decryptdata to be defined after setting format ${rt}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(et,ErrorDetails.KEY_LOAD_ERROR,ct))}const ot=st.uri;if(!ot)return Promise.reject(this.createKeyLoadError(et,ErrorDetails.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${ot}"`)));let lt=this.keyUriToKeyInfo[ot];if((nt=lt)!=null&&nt.decryptdata.key)return st.key=lt.decryptdata.key,Promise.resolve({frag:et,keyInfo:lt});if((it=lt)!=null&&it.keyLoadPromise){var ut;switch((ut=lt.mediaKeySessionContext)==null?void 0:ut.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return lt.keyLoadPromise.then(ct=>(st.key=ct.keyInfo.decryptdata.key,{frag:et,keyInfo:lt}))}}switch(lt=this.keyUriToKeyInfo[ot]={decryptdata:st,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},st.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return st.keyFormat==="identity"?this.loadKeyHTTP(lt,et):this.loadKeyEME(lt,et);case"AES-128":return this.loadKeyHTTP(lt,et);default:return Promise.reject(this.createKeyLoadError(et,ErrorDetails.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${st.method}"`)))}}loadKeyEME(et,rt){const nt={frag:rt,keyInfo:et};if(this.emeController&&this.config.emeEnabled){const it=this.emeController.loadKey(nt);if(it)return(et.keyLoadPromise=it.then(st=>(et.mediaKeySessionContext=st,nt))).catch(st=>{throw et.keyLoadPromise=null,st})}return Promise.resolve(nt)}loadKeyHTTP(et,rt){const nt=this.config,it=nt.loader,st=new it(nt);return rt.keyLoader=et.loader=st,et.keyLoadPromise=new Promise((ot,lt)=>{const ut={keyInfo:et,frag:rt,responseType:"arraybuffer",url:et.decryptdata.uri},ct=nt.keyLoadPolicy.default,dt={loadPolicy:ct,timeout:ct.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},pt={onSuccess:(ft,gt,_r,Yr)=>{const{frag:mt,keyInfo:Kr,url:Xr}=_r;if(!mt.decryptdata||Kr!==this.keyUriToKeyInfo[Xr])return lt(this.createKeyLoadError(mt,ErrorDetails.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),Yr));Kr.decryptdata.key=mt.decryptdata.key=new Uint8Array(ft.data),mt.keyLoader=null,Kr.loader=null,ot({frag:mt,keyInfo:Kr})},onError:(ft,gt,_r,Yr)=>{this.resetLoader(gt),lt(this.createKeyLoadError(rt,ErrorDetails.KEY_LOAD_ERROR,new Error(`HTTP Error ${ft.code} loading key ${ft.text}`),_r,_objectSpread2({url:ut.url,data:void 0},ft)))},onTimeout:(ft,gt,_r)=>{this.resetLoader(gt),lt(this.createKeyLoadError(rt,ErrorDetails.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),_r))},onAbort:(ft,gt,_r)=>{this.resetLoader(gt),lt(this.createKeyLoadError(rt,ErrorDetails.INTERNAL_ABORTED,new Error("key loading aborted"),_r))}};st.load(ut,dt,pt)})}resetLoader(et){const{frag:rt,keyInfo:nt,url:it}=et,st=nt.loader;rt.keyLoader===st&&(rt.keyLoader=null,nt.loader=null),delete this.keyUriToKeyInfo[it],st&&st.destroy()}}function getSourceBuffer(){return self.SourceBuffer||self.WebKitSourceBuffer}function isMSESupported(){if(!getMediaSource())return!1;const et=getSourceBuffer();return!et||et.prototype&&typeof et.prototype.appendBuffer=="function"&&typeof et.prototype.remove=="function"}function isSupported(){if(!isMSESupported())return!1;const tt=getMediaSource();return typeof(tt==null?void 0:tt.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(et=>tt.isTypeSupported(mimeTypeForCodec(et,"video")))||["mp4a.40.2","fLaC"].some(et=>tt.isTypeSupported(mimeTypeForCodec(et,"audio"))))}function changeTypeSupported(){var tt;const et=getSourceBuffer();return typeof(et==null||(tt=et.prototype)==null?void 0:tt.changeType)=="function"}const STALL_MINIMUM_DURATION_MS=250,MAX_START_GAP_JUMP=2,SKIP_BUFFER_HOLE_STEP_SECONDS=.1,SKIP_BUFFER_RANGE_START=.05;class GapController{constructor(et,rt,nt,it){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=et,this.media=rt,this.fragmentTracker=nt,this.hls=it}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(et,rt){const{config:nt,media:it,stalled:st}=this;if(it===null)return;const{currentTime:ot,seeking:lt}=it,ut=this.seeking&&!lt,ct=!this.seeking&&lt;if(this.seeking=lt,ot!==et){if(this.moved=!0,lt||(this.nudgeRetry=0),st!==null){if(this.stallReported){const mt=self.performance.now()-st;logger.warn(`playback not stuck anymore @${ot}, after ${Math.round(mt)}ms`),this.stallReported=!1}this.stalled=null}return}if(ct||ut){this.stalled=null;return}if(it.paused&&!lt||it.ended||it.playbackRate===0||!BufferHelper.getBuffered(it).length){this.nudgeRetry=0;return}const dt=BufferHelper.bufferInfo(it,ot,0),pt=dt.nextStart||0;if(lt){const mt=dt.len>MAX_START_GAP_JUMP,Kr=!pt||rt&&rt.start<=ot||pt-ot>MAX_START_GAP_JUMP&&!this.fragmentTracker.getPartialFragment(ot);if(mt||Kr)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var ft;if(!(dt.len>0)&&!pt)return;const Kr=Math.max(pt,dt.start||0)-ot,Xr=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,Qr=(Xr==null||(ft=Xr.details)==null?void 0:ft.live)?Xr.details.targetduration*2:MAX_START_GAP_JUMP,_i=this.fragmentTracker.getPartialFragment(ot);if(Kr>0&&(Kr<=Qr||_i)){it.paused||this._trySkipBufferHole(_i);return}}const gt=self.performance.now();if(st===null){this.stalled=gt;return}const _r=gt-st;if(!lt&&_r>=STALL_MINIMUM_DURATION_MS&&(this._reportStall(dt),!this.media))return;const Yr=BufferHelper.bufferInfo(it,ot,nt.maxBufferHole);this._tryFixBufferStall(Yr,_r)}_tryFixBufferStall(et,rt){const{config:nt,fragmentTracker:it,media:st}=this;if(st===null)return;const ot=st.currentTime,lt=it.getPartialFragment(ot);lt&&(this._trySkipBufferHole(lt)||!this.media)||(et.len>nt.maxBufferHole||et.nextStart&&et.nextStart-ot<nt.maxBufferHole)&&rt>nt.highBufferWatchdogPeriod*1e3&&(logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(et){const{hls:rt,media:nt,stallReported:it}=this;if(!it&&nt){this.stallReported=!0;const st=new Error(`Playback stalling at @${nt.currentTime} due to low buffer (${JSON.stringify(et)})`);logger.warn(st.message),rt.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,error:st,buffer:et.len})}}_trySkipBufferHole(et){const{config:rt,hls:nt,media:it}=this;if(it===null)return 0;const st=it.currentTime,ot=BufferHelper.bufferInfo(it,st,0),lt=st<ot.start?ot.start:ot.nextStart;if(lt){const ut=ot.len<=rt.maxBufferHole,ct=ot.len>0&&ot.len<1&&it.readyState<3,dt=lt-st;if(dt>0&&(ut||ct)){if(dt>rt.maxBufferHole){const{fragmentTracker:ft}=this;let gt=!1;if(st===0){const _r=ft.getAppendedFrag(0,PlaylistLevelType.MAIN);_r&&lt<_r.end&&(gt=!0)}if(!gt){const _r=et||ft.getAppendedFrag(st,PlaylistLevelType.MAIN);if(_r){let Yr=!1,mt=_r.end;for(;mt<lt;){const Kr=ft.getPartialFragment(mt);if(Kr)mt+=Kr.duration;else{Yr=!0;break}}if(Yr)return 0}}}const pt=Math.max(lt+SKIP_BUFFER_RANGE_START,st+SKIP_BUFFER_HOLE_STEP_SECONDS);if(logger.warn(`skipping hole, adjusting currentTime from ${st} to ${pt}`),this.moved=!0,this.stalled=null,it.currentTime=pt,et&&!et.gap){const ft=new Error(`fragment loaded with buffer holes, seeking from ${st} to ${pt}`);nt.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:ft,reason:ft.message,frag:et})}return pt}}return 0}_tryNudgeBuffer(){const{config:et,hls:rt,media:nt,nudgeRetry:it}=this;if(nt===null)return;const st=nt.currentTime;if(this.nudgeRetry++,it<et.nudgeMaxRetry){const ot=st+(it+1)*et.nudgeOffset,lt=new Error(`Nudging 'currentTime' from ${st} to ${ot}`);logger.warn(lt.message),nt.currentTime=ot,rt.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_NUDGE_ON_STALL,error:lt,fatal:!1})}else{const ot=new Error(`Playhead still not moving while enough data buffered @${st} after ${et.nudgeMaxRetry} nudges`);logger.error(ot.message),rt.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_STALLED_ERROR,error:ot,fatal:!0})}}}const TICK_INTERVAL=100;class StreamController extends BaseStreamController{constructor(et,rt,nt){super(et,rt,nt,"[stream-controller]",PlaylistLevelType.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:et}=this;et.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),et.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),et.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),et.on(Events.LEVEL_LOADING,this.onLevelLoading,this),et.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),et.on(Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),et.on(Events.ERROR,this.onError,this),et.on(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),et.on(Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),et.on(Events.BUFFER_CREATED,this.onBufferCreated,this),et.on(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),et.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),et.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:et}=this;et.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),et.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),et.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),et.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),et.off(Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),et.off(Events.ERROR,this.onError,this),et.off(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),et.off(Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),et.off(Events.BUFFER_CREATED,this.onBufferCreated,this),et.off(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),et.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),et.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying()}startLoad(et){if(this.levels){const{lastCurrentTime:rt,hls:nt}=this;if(this.stopLoad(),this.setInterval(TICK_INTERVAL),this.level=-1,!this.startFragRequested){let it=nt.startLevel;it===-1&&(nt.config.testBandwidth&&this.levels.length>1?(it=0,this.bitrateTest=!0):it=nt.firstAutoLevel),this.level=nt.nextLoadLevel=it,this.loadedmetadata=!1}rt>0&&et===-1&&(this.log(`Override startPosition with lastCurrentTime @${rt.toFixed(3)}`),et=rt),this.state=State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=et,this.tick()}else this._forceStartLoad=!0,this.state=State.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case State.WAITING_LEVEL:{const{levels:rt,level:nt}=this,it=rt==null?void 0:rt[nt],st=it==null?void 0:it.details;if(st&&(!st.live||this.levelLastLoaded===it)){if(this.waitForCdnTuneIn(st))break;this.state=State.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=State.IDLE;break}break}case State.FRAG_LOADING_WAITING_RETRY:{var et;const rt=self.performance.now(),nt=this.retryDate;if(!nt||rt>=nt||(et=this.media)!=null&&et.seeking){const{levels:it,level:st}=this,ot=it==null?void 0:it[st];this.resetStartWhenNotLoaded(ot||null),this.state=State.IDLE}}break}this.state===State.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:et,levelLastLoaded:rt,levels:nt,media:it}=this,{config:st,nextLoadLevel:ot}=et;if(rt===null||!it&&(this.startFragRequested||!st.startFragPrefetch)||this.altAudio&&this.audioOnly||!(nt!=null&&nt[ot]))return;const lt=nt[ot],ut=this.getMainFwdBufferInfo();if(ut===null)return;const ct=this.getLevelDetails();if(ct&&this._streamEnded(ut,ct)){const mt={};this.altAudio&&(mt.type="video"),this.hls.trigger(Events.BUFFER_EOS,mt),this.state=State.ENDED;return}et.loadLevel!==ot&&et.manualLevel===-1&&this.log(`Adapting to level ${ot} from level ${this.level}`),this.level=et.nextLoadLevel=ot;const dt=lt.details;if(!dt||this.state===State.WAITING_LEVEL||dt.live&&this.levelLastLoaded!==lt){this.level=ot,this.state=State.WAITING_LEVEL;return}const pt=ut.len,ft=this.getMaxBufferLength(lt.maxBitrate);if(pt>=ft)return;this.backtrackFragment&&this.backtrackFragment.start>ut.end&&(this.backtrackFragment=null);const gt=this.backtrackFragment?this.backtrackFragment.start:ut.end;let _r=this.getNextFragment(gt,dt);if(this.couldBacktrack&&!this.fragPrevious&&_r&&_r.sn!=="initSegment"&&this.fragmentTracker.getState(_r)!==FragmentState.OK){var Yr;const Kr=((Yr=this.backtrackFragment)!=null?Yr:_r).sn-dt.startSN,Xr=dt.fragments[Kr-1];Xr&&_r.cc===Xr.cc&&(_r=Xr,this.fragmentTracker.removeFragment(Xr))}else this.backtrackFragment&&ut.len&&(this.backtrackFragment=null);if(_r&&this.isLoopLoading(_r,gt)){if(!_r.gap){const Kr=this.audioOnly&&!this.altAudio?ElementaryStreamTypes.AUDIO:ElementaryStreamTypes.VIDEO,Xr=(Kr===ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;Xr&&this.afterBufferFlushed(Xr,Kr,PlaylistLevelType.MAIN)}_r=this.getNextFragmentLoopLoading(_r,dt,ut,PlaylistLevelType.MAIN,ft)}_r&&(_r.initSegment&&!_r.initSegment.data&&!this.bitrateTest&&(_r=_r.initSegment),this.loadFragment(_r,lt,gt))}loadFragment(et,rt,nt){const it=this.fragmentTracker.getState(et);this.fragCurrent=et,it===FragmentState.NOT_LOADED||it===FragmentState.PARTIAL?et.sn==="initSegment"?this._loadInitSegment(et,rt):this.bitrateTest?(this.log(`Fragment ${et.sn} of level ${et.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(et,rt)):(this.startFragRequested=!0,super.loadFragment(et,rt,nt)):this.clearTrackerIfNeeded(et)}getBufferedFrag(et){return this.fragmentTracker.getBufferedFrag(et,PlaylistLevelType.MAIN)}followingBufferedFrag(et){return et?this.getBufferedFrag(et.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:et,media:rt}=this;if(rt!=null&&rt.readyState){let nt;const it=this.getAppendedFrag(rt.currentTime);it&&it.start>1&&this.flushMainBuffer(0,it.start-1);const st=this.getLevelDetails();if(st!=null&&st.live){const lt=this.getMainFwdBufferInfo();if(!lt||lt.len<st.targetduration*2)return}if(!rt.paused&&et){const lt=this.hls.nextLoadLevel,ut=et[lt],ct=this.fragLastKbps;ct&&this.fragCurrent?nt=this.fragCurrent.duration*ut.maxBitrate/(1e3*ct)+1:nt=0}else nt=0;const ot=this.getBufferedFrag(rt.currentTime+nt);if(ot){const lt=this.followingBufferedFrag(ot);if(lt){this.abortCurrentFrag();const ut=lt.maxStartPTS?lt.maxStartPTS:lt.start,ct=lt.duration,dt=Math.max(ot.end,ut+Math.min(Math.max(ct-this.config.maxFragLookUpTolerance,ct*(this.couldBacktrack?.5:.125)),ct*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(dt,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const et=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,et&&(et.abortRequests(),this.fragmentTracker.removeFragment(et)),this.state){case State.KEY_LOADING:case State.FRAG_LOADING:case State.FRAG_LOADING_WAITING_RETRY:case State.PARSING:case State.PARSED:this.state=State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(et,rt){super.flushMainBuffer(et,rt,this.altAudio?"video":null)}onMediaAttached(et,rt){super.onMediaAttached(et,rt);const nt=rt.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),nt.addEventListener("playing",this.onvplaying),nt.addEventListener("seeked",this.onvseeked),this.gapController=new GapController(this.config,nt,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:et}=this;et&&this.onvplaying&&this.onvseeked&&(et.removeEventListener("playing",this.onvplaying),et.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const et=this.media,rt=et?et.currentTime:null;isFiniteNumber(rt)&&this.log(`Media seeked to ${rt.toFixed(3)}`);const nt=this.getMainFwdBufferInfo();if(nt===null||nt.len===0){this.warn(`Main forward buffer length on "seeked" event ${nt?nt.len:"empty"})`);return}this.tick()}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=this.fragLastKbps=0,this.levels=this.fragPlaying=this.backtrackFragment=this.levelLastLoaded=null,this.altAudio=this.audioOnly=this.startFragRequested=!1}onManifestParsed(et,rt){let nt=!1,it=!1;rt.levels.forEach(st=>{const ot=st.audioCodec;ot&&(nt=nt||ot.indexOf("mp4a.40.2")!==-1,it=it||ot.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=nt&&it&&!changeTypeSupported(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=rt.levels,this.startFragRequested=!1}onLevelLoading(et,rt){const{levels:nt}=this;if(!nt||this.state!==State.IDLE)return;const it=nt[rt.level];(!it.details||it.details.live&&this.levelLastLoaded!==it||this.waitForCdnTuneIn(it.details))&&(this.state=State.WAITING_LEVEL)}onLevelLoaded(et,rt){var nt;const{levels:it}=this,st=rt.level,ot=rt.details,lt=ot.totalduration;if(!it){this.warn(`Levels were reset while loading level ${st}`);return}this.log(`Level ${st} loaded [${ot.startSN},${ot.endSN}]${ot.lastPartSn?`[part-${ot.lastPartSn}-${ot.lastPartIndex}]`:""}, cc [${ot.startCC}, ${ot.endCC}] duration:${lt}`);const ut=it[st],ct=this.fragCurrent;ct&&(this.state===State.FRAG_LOADING||this.state===State.FRAG_LOADING_WAITING_RETRY)&&ct.level!==rt.level&&ct.loader&&this.abortCurrentFrag();let dt=0;if(ot.live||(nt=ut.details)!=null&&nt.live){var pt;if(this.checkLiveUpdate(ot),ot.deltaUpdateFailed)return;dt=this.alignPlaylists(ot,ut.details,(pt=this.levelLastLoaded)==null?void 0:pt.details)}if(ut.details=ot,this.levelLastLoaded=ut,this.hls.trigger(Events.LEVEL_UPDATED,{details:ot,level:st}),this.state===State.WAITING_LEVEL){if(this.waitForCdnTuneIn(ot))return;this.state=State.IDLE}this.startFragRequested?ot.live&&this.synchronizeToLiveEdge(ot):this.setStartPosition(ot,dt),this.tick()}_handleFragmentLoadProgress(et){var rt;const{frag:nt,part:it,payload:st}=et,{levels:ot}=this;if(!ot){this.warn(`Levels were reset while fragment load was in progress. Fragment ${nt.sn} of level ${nt.level} will not be buffered`);return}const lt=ot[nt.level],ut=lt.details;if(!ut){this.warn(`Dropping fragment ${nt.sn} of level ${nt.level} after level details were reset`),this.fragmentTracker.removeFragment(nt);return}const ct=lt.videoCodec,dt=ut.PTSKnown||!ut.live,pt=(rt=nt.initSegment)==null?void 0:rt.data,ft=this._getAudioCodec(lt),gt=this.transmuxer=this.transmuxer||new TransmuxerInterface(this.hls,PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),_r=it?it.index:-1,Yr=_r!==-1,mt=new ChunkMetadata(nt.level,nt.sn,nt.stats.chunkCount,st.byteLength,_r,Yr),Kr=this.initPTS[nt.cc];gt.push(st,pt,ft,ct,nt,it,ut.totalduration,dt,mt,Kr)}onAudioTrackSwitching(et,rt){const nt=this.altAudio;if(!!!rt.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const ot=this.fragCurrent;ot&&(this.log("Switching to main audio track, cancel main fragment load"),ot.abortRequests(),this.fragmentTracker.removeFragment(ot)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const st=this.hls;nt&&(st.trigger(Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),st.trigger(Events.AUDIO_TRACK_SWITCHED,rt)}}onAudioTrackSwitched(et,rt){const nt=rt.id,it=!!this.hls.audioTracks[nt].url;if(it){const st=this.videoBuffer;st&&this.mediaBuffer!==st&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=st)}this.altAudio=it,this.tick()}onBufferCreated(et,rt){const nt=rt.tracks;let it,st,ot=!1;for(const lt in nt){const ut=nt[lt];if(ut.id==="main"){if(st=lt,it=ut,lt==="video"){const ct=nt[lt];ct&&(this.videoBuffer=ct.buffer)}}else ot=!0}ot&&it?(this.log(`Alternate track found, use ${st}.buffered to schedule main fragment loading`),this.mediaBuffer=it.buffer):this.mediaBuffer=this.media}onFragBuffered(et,rt){const{frag:nt,part:it}=rt;if(nt&&nt.type!==PlaylistLevelType.MAIN)return;if(this.fragContextChanged(nt)){this.warn(`Fragment ${nt.sn}${it?" p: "+it.index:""} of level ${nt.level} finished buffering, but was aborted. state: ${this.state}`),this.state===State.PARSED&&(this.state=State.IDLE);return}const st=it?it.stats:nt.stats;this.fragLastKbps=Math.round(8*st.total/(st.buffering.end-st.loading.first)),nt.sn!=="initSegment"&&(this.fragPrevious=nt),this.fragBufferedComplete(nt,it)}onError(et,rt){var nt;if(rt.fatal){this.state=State.ERROR;return}switch(rt.details){case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_PARSING_ERROR:case ErrorDetails.FRAG_DECRYPT_ERROR:case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(PlaylistLevelType.MAIN,rt);break;case ErrorDetails.LEVEL_LOAD_ERROR:case ErrorDetails.LEVEL_LOAD_TIMEOUT:case ErrorDetails.LEVEL_PARSING_ERROR:!rt.levelRetry&&this.state===State.WAITING_LEVEL&&((nt=rt.context)==null?void 0:nt.type)===PlaylistContextType.LEVEL&&(this.state=State.IDLE);break;case ErrorDetails.BUFFER_APPEND_ERROR:case ErrorDetails.BUFFER_FULL_ERROR:if(!rt.parent||rt.parent!=="main")return;if(rt.details===ErrorDetails.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(rt)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case ErrorDetails.INTERNAL_EXCEPTION:this.recoverWorkerError(rt);break}}checkBuffer(){const{media:et,gapController:rt}=this;if(!(!et||!rt||!et.readyState)){if(this.loadedmetadata||!BufferHelper.getBuffered(et).length){const nt=this.state!==State.IDLE?this.fragCurrent:null;rt.poll(this.lastCurrentTime,nt)}this.lastCurrentTime=et.currentTime}}onFragLoadEmergencyAborted(){this.state=State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(et,{type:rt}){if(rt!==ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){const nt=(rt===ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(nt,rt,PlaylistLevelType.MAIN),this.tick()}}onLevelsUpdated(et,rt){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level),this.levels=rt.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:et}=this;if(!et)return;const rt=et.currentTime;let nt=this.startPosition;if(nt>=0&&rt<nt){if(et.seeking){this.log(`could not seek to ${nt}, already seeking at ${rt}`);return}const it=BufferHelper.getBuffered(et),ot=(it.length?it.start(0):0)-nt;ot>0&&(ot<this.config.maxBufferHole||ot<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${ot} to match buffer start`),nt+=ot,this.startPosition=nt),this.log(`seek to target start position ${nt} from current time ${rt}`),et.currentTime=nt}}_getAudioCodec(et){let rt=this.config.defaultAudioCodec||et.audioCodec;return this.audioCodecSwap&&rt&&(this.log("Swapping audio codec"),rt.indexOf("mp4a.40.5")!==-1?rt="mp4a.40.2":rt="mp4a.40.5"),rt}_loadBitrateTestFrag(et,rt){et.bitrateTest=!0,this._doFragLoad(et,rt).then(nt=>{const{hls:it}=this;if(!nt||this.fragContextChanged(et))return;rt.fragmentError=0,this.state=State.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const st=et.stats;st.parsing.start=st.parsing.end=st.buffering.start=st.buffering.end=self.performance.now(),it.trigger(Events.FRAG_LOADED,nt),et.bitrateTest=!1})}_handleTransmuxComplete(et){var rt;const nt="main",{hls:it}=this,{remuxResult:st,chunkMeta:ot}=et,lt=this.getCurrentContext(ot);if(!lt){this.resetWhenMissingContext(ot);return}const{frag:ut,part:ct,level:dt}=lt,{video:pt,text:ft,id3:gt,initSegment:_r}=st,{details:Yr}=dt,mt=this.altAudio?void 0:st.audio;if(this.fragContextChanged(ut)){this.fragmentTracker.removeFragment(ut);return}if(this.state=State.PARSING,_r){if(_r!=null&&_r.tracks){const Zr=ut.initSegment||ut;this._bufferInitSegment(dt,_r.tracks,Zr,ot),it.trigger(Events.FRAG_PARSING_INIT_SEGMENT,{frag:Zr,id:nt,tracks:_r.tracks})}const Kr=_r.initPTS,Xr=_r.timescale;isFiniteNumber(Kr)&&(this.initPTS[ut.cc]={baseTime:Kr,timescale:Xr},it.trigger(Events.INIT_PTS_FOUND,{frag:ut,id:nt,initPTS:Kr,timescale:Xr}))}if(pt&&Yr&&ut.sn!=="initSegment"){const Kr=Yr.fragments[ut.sn-1-Yr.startSN],Xr=ut.sn===Yr.startSN,Zr=!Kr||ut.cc>Kr.cc;if(st.independent!==!1){const{startPTS:Qr,endPTS:_i,startDTS:ns,endDTS:rs}=pt;if(ct)ct.elementaryStreams[pt.type]={startPTS:Qr,endPTS:_i,startDTS:ns,endDTS:rs};else if(pt.firstKeyFrame&&pt.independent&&ot.id===1&&!Zr&&(this.couldBacktrack=!0),pt.dropped&&pt.independent){const ss=this.getMainFwdBufferInfo(),hs=(ss?ss.end:this.getLoadPosition())+this.config.maxBufferHole,os=pt.firstKeyFramePTS?pt.firstKeyFramePTS:Qr;if(!Xr&&hs<os-this.config.maxBufferHole&&!Zr){this.backtrack(ut);return}else Zr&&(ut.gap=!0);ut.setElementaryStreamInfo(pt.type,ut.start,_i,ut.start,rs,!0)}else Xr&&Qr>MAX_START_GAP_JUMP&&(ut.gap=!0);ut.setElementaryStreamInfo(pt.type,Qr,_i,ns,rs),this.backtrackFragment&&(this.backtrackFragment=ut),this.bufferFragmentData(pt,ut,ct,ot,Xr||Zr)}else if(Xr||Zr)ut.gap=!0;else{this.backtrack(ut);return}}if(mt){const{startPTS:Kr,endPTS:Xr,startDTS:Zr,endDTS:Qr}=mt;ct&&(ct.elementaryStreams[ElementaryStreamTypes.AUDIO]={startPTS:Kr,endPTS:Xr,startDTS:Zr,endDTS:Qr}),ut.setElementaryStreamInfo(ElementaryStreamTypes.AUDIO,Kr,Xr,Zr,Qr),this.bufferFragmentData(mt,ut,ct,ot)}if(Yr&&gt!=null&&(rt=gt.samples)!=null&&rt.length){const Kr={id:nt,frag:ut,details:Yr,samples:gt.samples};it.trigger(Events.FRAG_PARSING_METADATA,Kr)}if(Yr&&ft){const Kr={id:nt,frag:ut,details:Yr,samples:ft.samples};it.trigger(Events.FRAG_PARSING_USERDATA,Kr)}}_bufferInitSegment(et,rt,nt,it){if(this.state!==State.PARSING)return;this.audioOnly=!!rt.audio&&!rt.video,this.altAudio&&!this.audioOnly&&delete rt.audio;const{audio:st,video:ot,audiovideo:lt}=rt;if(st){let ut=et.audioCodec;const ct=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(ut&&(ut.indexOf("mp4a.40.5")!==-1?ut="mp4a.40.2":ut="mp4a.40.5"),st.metadata.channelCount!==1&&ct.indexOf("firefox")===-1&&(ut="mp4a.40.5")),ut&&ut.indexOf("mp4a.40.5")!==-1&&ct.indexOf("android")!==-1&&st.container!=="audio/mpeg"&&(ut="mp4a.40.2",this.log(`Android: force audio codec to ${ut}`)),et.audioCodec&&et.audioCodec!==ut&&this.log(`Swapping manifest audio codec "${et.audioCodec}" for "${ut}"`),st.levelCodec=ut,st.id="main",this.log(`Init audio buffer, container:${st.container}, codecs[selected/level/parsed]=[${ut||""}/${et.audioCodec||""}/${st.codec}]`)}ot&&(ot.levelCodec=et.videoCodec,ot.id="main",this.log(`Init video buffer, container:${ot.container}, codecs[level/parsed]=[${et.videoCodec||""}/${ot.codec}]`)),lt&&this.log(`Init audiovideo buffer, container:${lt.container}, codecs[level/parsed]=[${et.codecs}/${lt.codec}]`),this.hls.trigger(Events.BUFFER_CODECS,rt),Object.keys(rt).forEach(ut=>{const dt=rt[ut].initSegment;dt!=null&&dt.byteLength&&this.hls.trigger(Events.BUFFER_APPENDING,{type:ut,data:dt,frag:nt,part:null,chunkMeta:it,parent:nt.type})}),this.tickImmediate()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,PlaylistLevelType.MAIN)}backtrack(et){this.couldBacktrack=!0,this.backtrackFragment=et,this.resetTransmuxer(),this.flushBufferGap(et),this.fragmentTracker.removeFragment(et),this.fragPrevious=null,this.nextLoadPosition=et.start,this.state=State.IDLE}checkFragmentChanged(){const et=this.media;let rt=null;if(et&&et.readyState>1&&et.seeking===!1){const nt=et.currentTime;if(BufferHelper.isBuffered(et,nt)?rt=this.getAppendedFrag(nt):BufferHelper.isBuffered(et,nt+.1)&&(rt=this.getAppendedFrag(nt+.1)),rt){this.backtrackFragment=null;const it=this.fragPlaying,st=rt.level;(!it||rt.sn!==it.sn||it.level!==st)&&(this.fragPlaying=rt,this.hls.trigger(Events.FRAG_CHANGED,{frag:rt}),(!it||it.level!==st)&&this.hls.trigger(Events.LEVEL_SWITCHED,{level:st}))}}}get nextLevel(){const et=this.nextBufferedFrag;return et?et.level:-1}get currentFrag(){const et=this.media;return et?this.fragPlaying||this.getAppendedFrag(et.currentTime):null}get currentProgramDateTime(){const et=this.media;if(et){const rt=et.currentTime,nt=this.currentFrag;if(nt&&isFiniteNumber(rt)&&isFiniteNumber(nt.programDateTime)){const it=nt.programDateTime+(rt-nt.start)*1e3;return new Date(it)}}return null}get currentLevel(){const et=this.currentFrag;return et?et.level:-1}get nextBufferedFrag(){const et=this.currentFrag;return et?this.followingBufferedFrag(et):null}get forceStartLoad(){return this._forceStartLoad}}class Hls{static get version(){return"1.5.3"}static isMSESupported(){return isMSESupported()}static isSupported(){return isSupported()}static getMediaSource(){return getMediaSource()}static get Events(){return Events}static get ErrorTypes(){return ErrorTypes}static get ErrorDetails(){return ErrorDetails}static get DefaultConfig(){return Hls.defaultConfig?Hls.defaultConfig:hlsDefaultConfig}static set DefaultConfig(et){Hls.defaultConfig=et}constructor(et={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this.started=!1,this._emitter=new EventEmitter,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,this.triggeringException=void 0,enableLogs(et.debug||!1,"Hls instance");const rt=this.config=mergeConfig(Hls.DefaultConfig,et);this.userConfig=et,rt.progressive&&enableStreamingMode(rt);const{abrController:nt,bufferController:it,capLevelController:st,errorController:ot,fpsController:lt}=rt,ut=new ot(this),ct=this.abrController=new nt(this),dt=this.bufferController=new it(this),pt=this.capLevelController=new st(this),ft=new lt(this),gt=new PlaylistLoader(this),_r=new ID3TrackController(this),Yr=rt.contentSteeringController,mt=Yr?new Yr(this):null,Kr=this.levelController=new LevelController(this,mt),Xr=new FragmentTracker(this),Zr=new KeyLoader(this.config),Qr=this.streamController=new StreamController(this,Xr,Zr);pt.setStreamController(Qr),ft.setStreamController(Qr);const _i=[gt,Kr,Qr];mt&&_i.splice(1,0,mt),this.networkControllers=_i;const ns=[ct,dt,pt,ft,_r,Xr];this.audioTrackController=this.createController(rt.audioTrackController,_i);const rs=rt.audioStreamController;rs&&_i.push(new rs(this,Xr,Zr)),this.subtitleTrackController=this.createController(rt.subtitleTrackController,_i);const ss=rt.subtitleStreamController;ss&&_i.push(new ss(this,Xr,Zr)),this.createController(rt.timelineController,ns),Zr.emeController=this.emeController=this.createController(rt.emeController,ns),this.cmcdController=this.createController(rt.cmcdController,ns),this.latencyController=this.createController(LatencyController,ns),this.coreComponents=ns,_i.push(ut);const hs=ut.onErrorOut;typeof hs=="function"&&this.on(Events.ERROR,hs,ut)}createController(et,rt){if(et){const nt=new et(this);return rt&&rt.push(nt),nt}return null}on(et,rt,nt=this){this._emitter.on(et,rt,nt)}once(et,rt,nt=this){this._emitter.once(et,rt,nt)}removeAllListeners(et){this._emitter.removeAllListeners(et)}off(et,rt,nt=this,it){this._emitter.off(et,rt,nt,it)}listeners(et){return this._emitter.listeners(et)}emit(et,rt,nt){return this._emitter.emit(et,rt,nt)}trigger(et,rt){if(this.config.debug)return this.emit(et,et,rt);try{return this.emit(et,et,rt)}catch(nt){if(logger.error("An internal error happened while handling event "+et+'. Error message: "'+nt.message+'". Here is a stacktrace:',nt),!this.triggeringException){this.triggeringException=!0;const it=et===Events.ERROR;this.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,fatal:it,event:et,error:nt}),this.triggeringException=!1}}return!1}listenerCount(et){return this._emitter.listenerCount(et)}destroy(){logger.log("destroy"),this.trigger(Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(rt=>rt.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(rt=>rt.destroy()),this.coreComponents.length=0;const et=this.config;et.xhrSetup=et.fetchSetup=void 0,this.userConfig=null}attachMedia(et){logger.log("attachMedia"),this._media=et,this.trigger(Events.MEDIA_ATTACHING,{media:et})}detachMedia(){logger.log("detachMedia"),this.trigger(Events.MEDIA_DETACHING,void 0),this._media=null}loadSource(et){this.stopLoad();const rt=this.media,nt=this.url,it=this.url=urlToolkitExports.buildAbsoluteURL(self.location.href,et,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,logger.log(`loadSource:${it}`),rt&&nt&&(nt!==it||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(rt)),this.trigger(Events.MANIFEST_LOADING,{url:et})}startLoad(et=-1){logger.log(`startLoad(${et})`),this.started=!0,this.networkControllers.forEach(rt=>{rt.startLoad(et)})}stopLoad(){logger.log("stopLoad"),this.started=!1,this.networkControllers.forEach(et=>{et.stopLoad()})}resumeBuffering(){this.started&&this.networkControllers.forEach(et=>{"fragmentLoader"in et&&et.startLoad(-1)})}pauseBuffering(){this.networkControllers.forEach(et=>{"fragmentLoader"in et&&et.stopLoad()})}swapAudioCodec(){logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){logger.log("recoverMediaError");const et=this._media;this.detachMedia(),et&&this.attachMedia(et)}removeLevel(et){this.levelController.removeLevel(et)}get levels(){const et=this.levelController.levels;return et||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(et){logger.log(`set currentLevel:${et}`),this.levelController.manualLevel=et,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(et){logger.log(`set nextLevel:${et}`),this.levelController.manualLevel=et,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(et){logger.log(`set loadLevel:${et}`),this.levelController.manualLevel=et}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(et){this.levelController.nextLoadLevel=et}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(et){logger.log(`set firstLevel:${et}`),this.levelController.firstLevel=et}get startLevel(){const et=this.levelController.startLevel;return et===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:et}set startLevel(et){logger.log(`set startLevel:${et}`),et!==-1&&(et=Math.max(et,this.minAutoLevel)),this.levelController.startLevel=et}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(et){const rt=!!et;rt!==this.config.capLevelToPlayerSize&&(rt?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=rt)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:et}=this.abrController;return et?et.getEstimate():NaN}set bandwidthEstimate(et){this.abrController.resetEstimator(et)}get ttfbEstimate(){const{bwEstimator:et}=this.abrController;return et?et.getEstimateTTFB():NaN}set autoLevelCapping(et){this._autoLevelCapping!==et&&(logger.log(`set autoLevelCapping:${et}`),this._autoLevelCapping=et,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(et){isHdcpLevel(et)&&this._maxHdcpLevel!==et&&(this._maxHdcpLevel=et,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:et,config:{minAutoBitrate:rt}}=this;if(!et)return 0;const nt=et.length;for(let it=0;it<nt;it++)if(et[it].maxBitrate>=rt)return it;return 0}get maxAutoLevel(){const{levels:et,autoLevelCapping:rt,maxHdcpLevel:nt}=this;let it;if(rt===-1&&et!=null&&et.length?it=et.length-1:it=rt,nt)for(let st=it;st--;){const ot=et[st].attrs["HDCP-LEVEL"];if(ot&&ot<=nt)return st}return it}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(et){this.abrController.nextAutoLevel=et}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}setAudioOption(et){var rt;return(rt=this.audioTrackController)==null?void 0:rt.setAudioOption(et)}setSubtitleOption(et){var rt;return(rt=this.subtitleTrackController)==null||rt.setSubtitleOption(et),null}get allAudioTracks(){const et=this.audioTrackController;return et?et.allAudioTracks:[]}get audioTracks(){const et=this.audioTrackController;return et?et.audioTracks:[]}get audioTrack(){const et=this.audioTrackController;return et?et.audioTrack:-1}set audioTrack(et){const rt=this.audioTrackController;rt&&(rt.audioTrack=et)}get allSubtitleTracks(){const et=this.subtitleTrackController;return et?et.allSubtitleTracks:[]}get subtitleTracks(){const et=this.subtitleTrackController;return et?et.subtitleTracks:[]}get subtitleTrack(){const et=this.subtitleTrackController;return et?et.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(et){const rt=this.subtitleTrackController;rt&&(rt.subtitleTrack=et)}get subtitleDisplay(){const et=this.subtitleTrackController;return et?et.subtitleDisplay:!1}set subtitleDisplay(et){const rt=this.subtitleTrackController;rt&&(rt.subtitleDisplay=et)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(et){this.config.lowLatencyMode=et}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}Hls.defaultConfig=void 0;let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}const byteToHex=[];for(let tt=0;tt<256;++tt)byteToHex.push((tt+256).toString(16).slice(1));function unsafeStringify(tt,et=0){return byteToHex[tt[et+0]]+byteToHex[tt[et+1]]+byteToHex[tt[et+2]]+byteToHex[tt[et+3]]+"-"+byteToHex[tt[et+4]]+byteToHex[tt[et+5]]+"-"+byteToHex[tt[et+6]]+byteToHex[tt[et+7]]+"-"+byteToHex[tt[et+8]]+byteToHex[tt[et+9]]+"-"+byteToHex[tt[et+10]]+byteToHex[tt[et+11]]+byteToHex[tt[et+12]]+byteToHex[tt[et+13]]+byteToHex[tt[et+14]]+byteToHex[tt[et+15]]}const randomUUID=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),native={randomUUID};function v4(tt,et,rt){if(native.randomUUID&&!et&&!tt)return native.randomUUID();tt=tt||{};const nt=tt.random||(tt.rng||rng)();if(nt[6]=nt[6]&15|64,nt[8]=nt[8]&63|128,et){rt=rt||0;for(let it=0;it<16;++it)et[rt+it]=nt[it];return et}return unsafeStringify(nt)}function $db6c3485150b8e66$export$1ab7ae714698c4b8(tt){const[et,rt]=reactExports.useState(void 0);return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{if(tt){rt({width:tt.offsetWidth,height:tt.offsetHeight});const nt=new ResizeObserver(it=>{if(!Array.isArray(it)||!it.length)return;const st=it[0];let ot,lt;if("borderBoxSize"in st){const ut=st.borderBoxSize,ct=Array.isArray(ut)?ut[0]:ut;ot=ct.inlineSize,lt=ct.blockSize}else ot=tt.offsetWidth,lt=tt.offsetHeight;rt({width:ot,height:lt})});return nt.observe(tt,{box:"border-box"}),()=>nt.unobserve(tt)}else rt(void 0)},[tt]),et}function $010c2913dbd2fe3d$export$5cae361ad82dce8b(tt){const et=reactExports.useRef({value:tt,previous:tt});return reactExports.useMemo(()=>(et.current.value!==tt&&(et.current.previous=et.current.value,et.current.value=tt),et.current.previous),[tt])}const $ce77a8961b41be9e$var$RADIO_NAME="Radio",[$ce77a8961b41be9e$var$createRadioContext,$ce77a8961b41be9e$export$67d2296460f1b002]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($ce77a8961b41be9e$var$RADIO_NAME),[$ce77a8961b41be9e$var$RadioProvider,$ce77a8961b41be9e$var$useRadioContext]=$ce77a8961b41be9e$var$createRadioContext($ce77a8961b41be9e$var$RADIO_NAME),$ce77a8961b41be9e$export$d7b12c4107be0d61=reactExports.forwardRef((tt,et)=>{const{__scopeRadio:rt,name:nt,checked:it=!1,required:st,disabled:ot,value:lt="on",onCheck:ut,...ct}=tt,[dt,pt]=reactExports.useState(null),ft=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,Yr=>pt(Yr)),gt=reactExports.useRef(!1),_r=dt?!!dt.closest("form"):!0;return reactExports.createElement($ce77a8961b41be9e$var$RadioProvider,{scope:rt,checked:it,disabled:ot},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button",role:"radio","aria-checked":it,"data-state":$ce77a8961b41be9e$var$getState(it),"data-disabled":ot?"":void 0,disabled:ot,value:lt},ct,{ref:ft,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onClick,Yr=>{it||ut==null||ut(),_r&&(gt.current=Yr.isPropagationStopped(),gt.current||Yr.stopPropagation())})})),_r&&reactExports.createElement($ce77a8961b41be9e$var$BubbleInput,{control:dt,bubbles:!gt.current,name:nt,value:lt,checked:it,required:st,disabled:ot,style:{transform:"translateX(-100%)"}}))}),$ce77a8961b41be9e$var$BubbleInput=tt=>{const{control:et,checked:rt,bubbles:nt=!0,...it}=tt,st=reactExports.useRef(null),ot=$010c2913dbd2fe3d$export$5cae361ad82dce8b(rt),lt=$db6c3485150b8e66$export$1ab7ae714698c4b8(et);return reactExports.useEffect(()=>{const ut=st.current,ct=window.HTMLInputElement.prototype,pt=Object.getOwnPropertyDescriptor(ct,"checked").set;if(ot!==rt&&pt){const ft=new Event("click",{bubbles:nt});pt.call(ut,rt),ut.dispatchEvent(ft)}},[ot,rt,nt]),reactExports.createElement("input",_extends$1({type:"radio","aria-hidden":!0,defaultChecked:rt},it,{tabIndex:-1,ref:st,style:{...tt.style,...lt,position:"absolute",pointerEvents:"none",opacity:0,margin:0}}))};function $ce77a8961b41be9e$var$getState(tt){return tt?"checked":"unchecked"}const $f99a8c78507165f7$var$ARROW_KEYS=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],$f99a8c78507165f7$var$RADIO_GROUP_NAME="RadioGroup",[$f99a8c78507165f7$var$createRadioGroupContext,$f99a8c78507165f7$export$c547093f11b76da2]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($f99a8c78507165f7$var$RADIO_GROUP_NAME,[$d7bdfb9eb0fdf311$export$c7109489551a4f4,$ce77a8961b41be9e$export$67d2296460f1b002]),$f99a8c78507165f7$var$useRovingFocusGroupScope=$d7bdfb9eb0fdf311$export$c7109489551a4f4(),$f99a8c78507165f7$var$useRadioScope=$ce77a8961b41be9e$export$67d2296460f1b002(),[$f99a8c78507165f7$var$RadioGroupProvider,$f99a8c78507165f7$var$useRadioGroupContext]=$f99a8c78507165f7$var$createRadioGroupContext($f99a8c78507165f7$var$RADIO_GROUP_NAME),$f99a8c78507165f7$export$a98f0dcb43a68a25=reactExports.forwardRef((tt,et)=>{const{__scopeRadioGroup:rt,name:nt,defaultValue:it,value:st,required:ot=!1,disabled:lt=!1,orientation:ut,dir:ct,loop:dt=!0,onValueChange:pt,...ft}=tt,gt=$f99a8c78507165f7$var$useRovingFocusGroupScope(rt),_r=$f631663db3294ace$export$b39126d51d94e6f3(ct),[Yr,mt]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:st,defaultProp:it,onChange:pt});return reactExports.createElement($f99a8c78507165f7$var$RadioGroupProvider,{scope:rt,name:nt,required:ot,disabled:lt,value:Yr,onValueChange:mt},reactExports.createElement($d7bdfb9eb0fdf311$export$be92b6f5f03c0fe9,_extends$1({asChild:!0},gt,{orientation:ut,dir:_r,loop:dt}),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({role:"radiogroup","aria-required":ot,"aria-orientation":ut,"data-disabled":lt?"":void 0,dir:_r},ft,{ref:et}))))}),$f99a8c78507165f7$var$ITEM_NAME="RadioGroupItem",$f99a8c78507165f7$export$9f866c100ef519e4=reactExports.forwardRef((tt,et)=>{const{__scopeRadioGroup:rt,disabled:nt,...it}=tt,st=$f99a8c78507165f7$var$useRadioGroupContext($f99a8c78507165f7$var$ITEM_NAME,rt),ot=st.disabled||nt,lt=$f99a8c78507165f7$var$useRovingFocusGroupScope(rt),ut=$f99a8c78507165f7$var$useRadioScope(rt),ct=reactExports.useRef(null),dt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,ct),pt=st.value===it.value,ft=reactExports.useRef(!1);return reactExports.useEffect(()=>{const gt=Yr=>{$f99a8c78507165f7$var$ARROW_KEYS.includes(Yr.key)&&(ft.current=!0)},_r=()=>ft.current=!1;return document.addEventListener("keydown",gt),document.addEventListener("keyup",_r),()=>{document.removeEventListener("keydown",gt),document.removeEventListener("keyup",_r)}},[]),reactExports.createElement($d7bdfb9eb0fdf311$export$6d08773d2e66f8f2,_extends$1({asChild:!0},lt,{focusable:!ot,active:pt}),reactExports.createElement($ce77a8961b41be9e$export$d7b12c4107be0d61,_extends$1({disabled:ot,required:st.required,checked:pt},ut,it,{name:st.name,ref:dt,onCheck:()=>st.onValueChange(it.value),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(gt=>{gt.key==="Enter"&&gt.preventDefault()}),onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(it.onFocus,()=>{var gt;ft.current&&((gt=ct.current)===null||gt===void 0||gt.click())})})))}),$f99a8c78507165f7$export$be92b6f5f03c0fe9=$f99a8c78507165f7$export$a98f0dcb43a68a25,$f99a8c78507165f7$export$6d08773d2e66f8f2=$f99a8c78507165f7$export$9f866c100ef519e4;function ParserError(tt,et){this.message=tt,this.error=et}ParserError.prototype=Object.create(Error.prototype);const TIMESTAMP_REGEXP=/([0-9]+)?:?([0-9]{2}):([0-9]{2}\.[0-9]{2,3})/;function parse$3(tt,et){et||(et={});const{meta:rt=!1,strict:nt=!0}=et;if(typeof tt!="string")throw new ParserError("Input must be a string");tt=tt.trim(),tt=tt.replace(/\r\n/g,`
`),tt=tt.replace(/\r/g,`
`);const it=tt.split(`

`),st=it.shift();if(!st.startsWith("WEBVTT"))throw new ParserError('Must start with "WEBVTT"');const ot=st.split(`
`),lt=ot[0].replace("WEBVTT","");if(lt.length>0&&lt[0]!==" "&&lt[0]!=="	")throw new ParserError("Header comment must start with space or tab");if(it.length===0&&ot.length===1)return{valid:!0,strict:nt,cues:[],errors:[]};if(!rt&&ot.length>1&&ot[1]!=="")throw new ParserError("Missing blank line after signature");const{cues:ut,errors:ct}=parseCues(it,nt);if(nt&&ct.length>0)throw ct[0];const dt=rt?parseMeta(ot):null,pt={valid:ct.length===0,strict:nt,cues:ut,errors:ct};return rt&&(pt.meta=dt),pt}function parseMeta(tt){const et={};return tt.slice(1).forEach(rt=>{const nt=rt.indexOf(":"),it=rt.slice(0,nt).trim(),st=rt.slice(nt+1).trim();et[it]=st}),Object.keys(et).length>0?et:null}function parseCues(tt,et){const rt=[];return{cues:tt.map((it,st)=>{try{return parseCue(it,st,et)}catch(ot){return rt.push(ot),null}}).filter(Boolean),errors:rt}}function parseCue(tt,et,rt){let nt="",it=0,st=.01,ot="",lt="";const ut=tt.split(`
`).filter(Boolean);if(ut.length>0&&ut[0].trim().startsWith("NOTE"))return null;if(ut.length===1&&!ut[0].includes("-->"))throw new ParserError(`Cue identifier cannot be standalone (cue #${et})`);if(ut.length>1&&!(ut[0].includes("-->")||ut[1].includes("-->"))){const dt=`Cue identifier needs to be followed by timestamp (cue #${et})`;throw new ParserError(dt)}ut.length>1&&ut[1].includes("-->")&&(nt=ut.shift());const ct=typeof ut[0]=="string"&&ut[0].split(" --> ");if(ct.length!==2||!validTimestamp(ct[0])||!validTimestamp(ct[1]))throw new ParserError(`Invalid cue timestamp (cue #${et})`);if(it=parseTimestamp(ct[0]),st=parseTimestamp(ct[1]),rt){if(it>st)throw new ParserError(`Start timestamp greater than end (cue #${et})`);if(st<=it)throw new ParserError(`End must be greater than start (cue #${et})`)}if(!rt&&st<it)throw new ParserError(`End must be greater or equal to start when not strict (cue #${et})`);return lt=ct[1].replace(TIMESTAMP_REGEXP,"").trim(),ut.shift(),ot=ut.join(`
`),ot?{identifier:nt,start:it,end:st,text:ot,styles:lt}:!1}function validTimestamp(tt){return TIMESTAMP_REGEXP.test(tt)}function parseTimestamp(tt){const et=tt.match(TIMESTAMP_REGEXP);let rt=parseFloat(et[1]||0)*60*60;return rt+=parseFloat(et[2])*60,rt+=parseFloat(et[3]),rt}var parser={ParserError,parse:parse$3};function CompilerError(tt,et){this.message=tt,this.error=et}CompilerError.prototype=Object.create(Error.prototype);function compile$1(tt){if(!tt)throw new CompilerError("Input must be non-null");if(typeof tt!="object")throw new CompilerError("Input must be an object");if(Array.isArray(tt))throw new CompilerError("Input cannot be array");if(!tt.valid)throw new CompilerError("Input must be valid");let et=`WEBVTT
`;if(tt.meta){if(typeof tt.meta!="object"||Array.isArray(tt.meta))throw new CompilerError("Metadata must be an object");Object.entries(tt.meta).forEach(nt=>{if(typeof nt[1]!="string")throw new CompilerError(`Metadata value for "${nt[0]}" must be string`);et+=`${nt[0]}: ${nt[1]}
`})}let rt=null;return tt.cues.forEach((nt,it)=>{if(rt&&rt>nt.start)throw new CompilerError(`Cue number ${it} is not in chronological order`);rt=nt.start,et+=`
`,et+=compileCue(nt),et+=`
`}),et}function compileCue(tt){if(typeof tt!="object")throw new CompilerError("Cue malformed: not of type object");if(typeof tt.identifier!="string"&&typeof tt.identifier!="number"&&tt.identifier!==null)throw new CompilerError(`Cue malformed: identifier value is not a string.
    ${JSON.stringify(tt)}`);if(isNaN(tt.start))throw new CompilerError(`Cue malformed: null start value.
    ${JSON.stringify(tt)}`);if(isNaN(tt.end))throw new CompilerError(`Cue malformed: null end value.
    ${JSON.stringify(tt)}`);if(tt.start>=tt.end)throw new CompilerError(`Cue malformed: start timestamp greater than end
    ${JSON.stringify(tt)}`);if(typeof tt.text!="string")throw new CompilerError(`Cue malformed: null text value.
    ${JSON.stringify(tt)}`);if(typeof tt.styles!="string")throw new CompilerError(`Cue malformed: null styles value.
    ${JSON.stringify(tt)}`);let et="";tt.identifier.length>0&&(et+=`${tt.identifier}
`);const rt=convertTimestamp(tt.start),nt=convertTimestamp(tt.end);return et+=`${rt} --> ${nt}`,et+=tt.styles?` ${tt.styles}`:"",et+=`
${tt.text}`,et}function convertTimestamp(tt){const et=pad$1(calculateHours(tt),2),rt=pad$1(calculateMinutes(tt),2),nt=pad$1(calculateSeconds(tt),2),it=pad$1(calculateMs(tt),3);return`${et}:${rt}:${nt}.${it}`}function pad$1(tt,et){let rt=`${tt}`;for(;rt.length<et;)rt=`0${rt}`;return rt}function calculateHours(tt){return Math.floor(tt/60/60)}function calculateMinutes(tt){return Math.floor(tt/60)%60}function calculateSeconds(tt){return Math.floor(tt%60)}function calculateMs(tt){return Math.floor((tt%1).toFixed(4)*1e3)}var compiler={CompilerError,compile:compile$1};const parse$2=parser.parse;function segment$2(tt,et){et=et||10;const rt=parse$2(tt),nt=[];let it=[],st=null,ot=0,lt=0;return rt.cues.forEach((ut,ct)=>{const dt=ct===0,pt=ct===rt.cues.length-1,ft=ut.start,gt=ut.end,_r=pt?1/0:rt.cues[ct+1].start,Yr=dt?gt:gt-ft,mt=dt?0:ft-rt.cues[ct-1].end;ot=ot+Yr+mt,`${ct}`,nt.length+1,st&&(it.push(st),ot+=st.end-lt,st=null),it.push(ut);let Kr=_r-gt<et&&mt<et&&ot>et;if(shouldSegment(lt,et,_r,mt)){const Xr=segmentDuration(pt,gt,et,ot,lt);nt.push({duration:Xr,cues:it}),lt+=Xr,ot=0,it=[]}else Kr=!1;Kr&&(st=ut)}),nt}function shouldSegment(tt,et,rt,nt){const it=alignToSegmentLength(nt,et);return(nt<=et||it+tt<rt)&&rt-tt>=et}function segmentDuration(tt,et,rt,nt,it){let st=rt;return nt>rt&&(st=alignToSegmentLength(nt-rt,rt)),tt?st=parseFloat((et-it).toFixed(2)):st=Math.round(st),st}function alignToSegmentLength(tt,et){return tt+=et-tt%et,tt}function debug(tt){}var segmenter={segment:segment$2};const segment$1=segmenter.segment;function hlsSegment(tt,et,rt){typeof rt>"u"&&(rt="900000");const nt=segment$1(tt,et),it=[];return nt.forEach((st,ot)=>{const lt=`WEBVTT
X-TIMESTAMP-MAP=MPEGTS:${rt},LOCAL:00:00:00.000

${printableCues(st.cues)}
`,ut=generateSegmentFilename(ot);it.push({filename:ut,content:lt})}),it}function hlsSegmentPlaylist(tt,et){const rt=segment$1(tt,et),nt=printableSegments(rt);return`#EXTM3U
#EXT-X-TARGETDURATION:${Math.round(findLongestSegment(rt))}
#EXT-X-VERSION:3
#EXT-X-MEDIA-SEQUENCE:0
#EXT-X-PLAYLIST-TYPE:VOD
${nt}
#EXT-X-ENDLIST
`}function pad(tt,et){return`${"0".repeat(Math.max(0,et-tt.toString().length))}${tt}`}function generateSegmentFilename(tt){return`${tt}.vtt`}function printableSegments(tt){const et=[];return tt.forEach((rt,nt)=>{et.push(`#EXTINF:${rt.duration.toFixed(5)},
${generateSegmentFilename(nt)}`)}),et.join(`
`)}function findLongestSegment(tt){let et=0;return tt.forEach(rt=>{rt.duration>et&&(et=rt.duration)}),et}function printableCues(tt){const et=[];return tt.forEach(rt=>{et.push(printableCue(rt))}),et.join(`

`)}function printableCue(tt){const et=[];tt.identifier&&et.push(tt.identifier);const rt=printableTimestamp(tt.start),nt=printableTimestamp(tt.end),it=tt.styles?`${tt.styles}`:"";return et.push(`${rt} --> ${nt} ${it}`),et.push(tt.text),et.join(`
`)}function printableTimestamp(tt){const et=(tt%1).toFixed(3);tt=Math.round(tt-et);const rt=Math.floor(tt/3600),nt=Math.floor((tt-rt*3600)/60),it=tt-rt*3600-nt*60;return`${`${pad(rt,2)}:`}${pad(nt,2)}:${pad(it,2)}.${pad(et*1e3,3)}`}var hls$1={hlsSegment,hlsSegmentPlaylist};const parse$1=parser.parse,compile=compiler.compile,segment=segmenter.segment,hls=hls$1;var nodeWebvtt={parse:parse$1,compile,segment,hls};function $addc16e1bbe58fd0$export$3a72a57244d6e765(tt,et=globalThis==null?void 0:globalThis.document){const rt=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(tt);reactExports.useEffect(()=>{const nt=it=>{it.key==="Escape"&&rt(it)};return et.addEventListener("keydown",nt),()=>et.removeEventListener("keydown",nt)},[rt,et])}const $5cb92bef7577960e$var$CONTEXT_UPDATE="dismissableLayer.update",$5cb92bef7577960e$var$POINTER_DOWN_OUTSIDE="dismissableLayer.pointerDownOutside",$5cb92bef7577960e$var$FOCUS_OUTSIDE="dismissableLayer.focusOutside";let $5cb92bef7577960e$var$originalBodyPointerEvents;const $5cb92bef7577960e$var$DismissableLayerContext=reactExports.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),$5cb92bef7577960e$export$177fb62ff3ec1f22=reactExports.forwardRef((tt,et)=>{var rt;const{disableOutsidePointerEvents:nt=!1,onEscapeKeyDown:it,onPointerDownOutside:st,onFocusOutside:ot,onInteractOutside:lt,onDismiss:ut,...ct}=tt,dt=reactExports.useContext($5cb92bef7577960e$var$DismissableLayerContext),[pt,ft]=reactExports.useState(null),gt=(rt=pt==null?void 0:pt.ownerDocument)!==null&&rt!==void 0?rt:globalThis==null?void 0:globalThis.document,[,_r]=reactExports.useState({}),Yr=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,ss=>ft(ss)),mt=Array.from(dt.layers),[Kr]=[...dt.layersWithOutsidePointerEventsDisabled].slice(-1),Xr=mt.indexOf(Kr),Zr=pt?mt.indexOf(pt):-1,Qr=dt.layersWithOutsidePointerEventsDisabled.size>0,_i=Zr>=Xr,ns=$5cb92bef7577960e$var$usePointerDownOutside(ss=>{const hs=ss.target,os=[...dt.branches].some(is=>is.contains(hs));!_i||os||(st==null||st(ss),lt==null||lt(ss),ss.defaultPrevented||ut==null||ut())},gt),rs=$5cb92bef7577960e$var$useFocusOutside(ss=>{const hs=ss.target;[...dt.branches].some(is=>is.contains(hs))||(ot==null||ot(ss),lt==null||lt(ss),ss.defaultPrevented||ut==null||ut())},gt);return $addc16e1bbe58fd0$export$3a72a57244d6e765(ss=>{Zr===dt.layers.size-1&&(it==null||it(ss),!ss.defaultPrevented&&ut&&(ss.preventDefault(),ut()))},gt),reactExports.useEffect(()=>{if(pt)return nt&&(dt.layersWithOutsidePointerEventsDisabled.size===0&&($5cb92bef7577960e$var$originalBodyPointerEvents=gt.body.style.pointerEvents,gt.body.style.pointerEvents="none"),dt.layersWithOutsidePointerEventsDisabled.add(pt)),dt.layers.add(pt),$5cb92bef7577960e$var$dispatchUpdate(),()=>{nt&&dt.layersWithOutsidePointerEventsDisabled.size===1&&(gt.body.style.pointerEvents=$5cb92bef7577960e$var$originalBodyPointerEvents)}},[pt,gt,nt,dt]),reactExports.useEffect(()=>()=>{pt&&(dt.layers.delete(pt),dt.layersWithOutsidePointerEventsDisabled.delete(pt),$5cb92bef7577960e$var$dispatchUpdate())},[pt,dt]),reactExports.useEffect(()=>{const ss=()=>_r({});return document.addEventListener($5cb92bef7577960e$var$CONTEXT_UPDATE,ss),()=>document.removeEventListener($5cb92bef7577960e$var$CONTEXT_UPDATE,ss)},[]),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({},ct,{ref:Yr,style:{pointerEvents:Qr?_i?"auto":"none":void 0,...tt.style},onFocusCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onFocusCapture,rs.onFocusCapture),onBlurCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onBlurCapture,rs.onBlurCapture),onPointerDownCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onPointerDownCapture,ns.onPointerDownCapture)}))});function $5cb92bef7577960e$var$usePointerDownOutside(tt,et=globalThis==null?void 0:globalThis.document){const rt=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(tt),nt=reactExports.useRef(!1),it=reactExports.useRef(()=>{});return reactExports.useEffect(()=>{const st=lt=>{if(lt.target&&!nt.current){let ct=function(){$5cb92bef7577960e$var$handleAndDispatchCustomEvent($5cb92bef7577960e$var$POINTER_DOWN_OUTSIDE,rt,ut,{discrete:!0})};const ut={originalEvent:lt};lt.pointerType==="touch"?(et.removeEventListener("click",it.current),it.current=ct,et.addEventListener("click",it.current,{once:!0})):ct()}else et.removeEventListener("click",it.current);nt.current=!1},ot=window.setTimeout(()=>{et.addEventListener("pointerdown",st)},0);return()=>{window.clearTimeout(ot),et.removeEventListener("pointerdown",st),et.removeEventListener("click",it.current)}},[et,rt]),{onPointerDownCapture:()=>nt.current=!0}}function $5cb92bef7577960e$var$useFocusOutside(tt,et=globalThis==null?void 0:globalThis.document){const rt=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(tt),nt=reactExports.useRef(!1);return reactExports.useEffect(()=>{const it=st=>{st.target&&!nt.current&&$5cb92bef7577960e$var$handleAndDispatchCustomEvent($5cb92bef7577960e$var$FOCUS_OUTSIDE,rt,{originalEvent:st},{discrete:!1})};return et.addEventListener("focusin",it),()=>et.removeEventListener("focusin",it)},[et,rt]),{onFocusCapture:()=>nt.current=!0,onBlurCapture:()=>nt.current=!1}}function $5cb92bef7577960e$var$dispatchUpdate(){const tt=new CustomEvent($5cb92bef7577960e$var$CONTEXT_UPDATE);document.dispatchEvent(tt)}function $5cb92bef7577960e$var$handleAndDispatchCustomEvent(tt,et,rt,{discrete:nt}){const it=rt.originalEvent.target,st=new CustomEvent(tt,{bubbles:!1,cancelable:!0,detail:rt});et&&it.addEventListener(tt,et,{once:!0}),nt?$8927f6f2acc4f386$export$6d1a0317bde7de7f(it,st):it.dispatchEvent(st)}let $3db38b7d1fb3fe6a$var$count=0;function $3db38b7d1fb3fe6a$export$b7ece24a22aeda8c(){reactExports.useEffect(()=>{var tt,et;const rt=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",(tt=rt[0])!==null&&tt!==void 0?tt:$3db38b7d1fb3fe6a$var$createFocusGuard()),document.body.insertAdjacentElement("beforeend",(et=rt[1])!==null&&et!==void 0?et:$3db38b7d1fb3fe6a$var$createFocusGuard()),$3db38b7d1fb3fe6a$var$count++,()=>{$3db38b7d1fb3fe6a$var$count===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(nt=>nt.remove()),$3db38b7d1fb3fe6a$var$count--}},[])}function $3db38b7d1fb3fe6a$var$createFocusGuard(){const tt=document.createElement("span");return tt.setAttribute("data-radix-focus-guard",""),tt.tabIndex=0,tt.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",tt}const $d3863c46a17e8a28$var$AUTOFOCUS_ON_MOUNT="focusScope.autoFocusOnMount",$d3863c46a17e8a28$var$AUTOFOCUS_ON_UNMOUNT="focusScope.autoFocusOnUnmount",$d3863c46a17e8a28$var$EVENT_OPTIONS={bubbles:!1,cancelable:!0},$d3863c46a17e8a28$export$20e40289641fbbb6=reactExports.forwardRef((tt,et)=>{const{loop:rt=!1,trapped:nt=!1,onMountAutoFocus:it,onUnmountAutoFocus:st,...ot}=tt,[lt,ut]=reactExports.useState(null),ct=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(it),dt=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(st),pt=reactExports.useRef(null),ft=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,Yr=>ut(Yr)),gt=reactExports.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;reactExports.useEffect(()=>{if(nt){let Yr=function(Zr){if(gt.paused||!lt)return;const Qr=Zr.target;lt.contains(Qr)?pt.current=Qr:$d3863c46a17e8a28$var$focus(pt.current,{select:!0})},mt=function(Zr){if(gt.paused||!lt)return;const Qr=Zr.relatedTarget;Qr!==null&&(lt.contains(Qr)||$d3863c46a17e8a28$var$focus(pt.current,{select:!0}))},Kr=function(Zr){if(document.activeElement===document.body)for(const _i of Zr)_i.removedNodes.length>0&&$d3863c46a17e8a28$var$focus(lt)};document.addEventListener("focusin",Yr),document.addEventListener("focusout",mt);const Xr=new MutationObserver(Kr);return lt&&Xr.observe(lt,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",Yr),document.removeEventListener("focusout",mt),Xr.disconnect()}}},[nt,lt,gt.paused]),reactExports.useEffect(()=>{if(lt){$d3863c46a17e8a28$var$focusScopesStack.add(gt);const Yr=document.activeElement;if(!lt.contains(Yr)){const Kr=new CustomEvent($d3863c46a17e8a28$var$AUTOFOCUS_ON_MOUNT,$d3863c46a17e8a28$var$EVENT_OPTIONS);lt.addEventListener($d3863c46a17e8a28$var$AUTOFOCUS_ON_MOUNT,ct),lt.dispatchEvent(Kr),Kr.defaultPrevented||($d3863c46a17e8a28$var$focusFirst($d3863c46a17e8a28$var$removeLinks($d3863c46a17e8a28$var$getTabbableCandidates(lt)),{select:!0}),document.activeElement===Yr&&$d3863c46a17e8a28$var$focus(lt))}return()=>{lt.removeEventListener($d3863c46a17e8a28$var$AUTOFOCUS_ON_MOUNT,ct),setTimeout(()=>{const Kr=new CustomEvent($d3863c46a17e8a28$var$AUTOFOCUS_ON_UNMOUNT,$d3863c46a17e8a28$var$EVENT_OPTIONS);lt.addEventListener($d3863c46a17e8a28$var$AUTOFOCUS_ON_UNMOUNT,dt),lt.dispatchEvent(Kr),Kr.defaultPrevented||$d3863c46a17e8a28$var$focus(Yr??document.body,{select:!0}),lt.removeEventListener($d3863c46a17e8a28$var$AUTOFOCUS_ON_UNMOUNT,dt),$d3863c46a17e8a28$var$focusScopesStack.remove(gt)},0)}}},[lt,ct,dt,gt]);const _r=reactExports.useCallback(Yr=>{if(!rt&&!nt||gt.paused)return;const mt=Yr.key==="Tab"&&!Yr.altKey&&!Yr.ctrlKey&&!Yr.metaKey,Kr=document.activeElement;if(mt&&Kr){const Xr=Yr.currentTarget,[Zr,Qr]=$d3863c46a17e8a28$var$getTabbableEdges(Xr);Zr&&Qr?!Yr.shiftKey&&Kr===Qr?(Yr.preventDefault(),rt&&$d3863c46a17e8a28$var$focus(Zr,{select:!0})):Yr.shiftKey&&Kr===Zr&&(Yr.preventDefault(),rt&&$d3863c46a17e8a28$var$focus(Qr,{select:!0})):Kr===Xr&&Yr.preventDefault()}},[rt,nt,gt.paused]);return reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({tabIndex:-1},ot,{ref:ft,onKeyDown:_r}))});function $d3863c46a17e8a28$var$focusFirst(tt,{select:et=!1}={}){const rt=document.activeElement;for(const nt of tt)if($d3863c46a17e8a28$var$focus(nt,{select:et}),document.activeElement!==rt)return}function $d3863c46a17e8a28$var$getTabbableEdges(tt){const et=$d3863c46a17e8a28$var$getTabbableCandidates(tt),rt=$d3863c46a17e8a28$var$findVisible(et,tt),nt=$d3863c46a17e8a28$var$findVisible(et.reverse(),tt);return[rt,nt]}function $d3863c46a17e8a28$var$getTabbableCandidates(tt){const et=[],rt=document.createTreeWalker(tt,NodeFilter.SHOW_ELEMENT,{acceptNode:nt=>{const it=nt.tagName==="INPUT"&&nt.type==="hidden";return nt.disabled||nt.hidden||it?NodeFilter.FILTER_SKIP:nt.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;rt.nextNode();)et.push(rt.currentNode);return et}function $d3863c46a17e8a28$var$findVisible(tt,et){for(const rt of tt)if(!$d3863c46a17e8a28$var$isHidden(rt,{upTo:et}))return rt}function $d3863c46a17e8a28$var$isHidden(tt,{upTo:et}){if(getComputedStyle(tt).visibility==="hidden")return!0;for(;tt;){if(et!==void 0&&tt===et)return!1;if(getComputedStyle(tt).display==="none")return!0;tt=tt.parentElement}return!1}function $d3863c46a17e8a28$var$isSelectableInput(tt){return tt instanceof HTMLInputElement&&"select"in tt}function $d3863c46a17e8a28$var$focus(tt,{select:et=!1}={}){if(tt&&tt.focus){const rt=document.activeElement;tt.focus({preventScroll:!0}),tt!==rt&&$d3863c46a17e8a28$var$isSelectableInput(tt)&&et&&tt.select()}}const $d3863c46a17e8a28$var$focusScopesStack=$d3863c46a17e8a28$var$createFocusScopesStack();function $d3863c46a17e8a28$var$createFocusScopesStack(){let tt=[];return{add(et){const rt=tt[0];et!==rt&&(rt==null||rt.pause()),tt=$d3863c46a17e8a28$var$arrayRemove(tt,et),tt.unshift(et)},remove(et){var rt;tt=$d3863c46a17e8a28$var$arrayRemove(tt,et),(rt=tt[0])===null||rt===void 0||rt.resume()}}}function $d3863c46a17e8a28$var$arrayRemove(tt,et){const rt=[...tt],nt=rt.indexOf(et);return nt!==-1&&rt.splice(nt,1),rt}function $d3863c46a17e8a28$var$removeLinks(tt){return tt.filter(et=>et.tagName!=="A")}const sides=["top","right","bottom","left"],min=Math.min,max=Math.max,round=Math.round,floor=Math.floor,createCoords=tt=>({x:tt,y:tt}),oppositeSideMap={left:"right",right:"left",bottom:"top",top:"bottom"},oppositeAlignmentMap={start:"end",end:"start"};function clamp(tt,et,rt){return max(tt,min(et,rt))}function evaluate(tt,et){return typeof tt=="function"?tt(et):tt}function getSide(tt){return tt.split("-")[0]}function getAlignment(tt){return tt.split("-")[1]}function getOppositeAxis(tt){return tt==="x"?"y":"x"}function getAxisLength(tt){return tt==="y"?"height":"width"}function getSideAxis(tt){return["top","bottom"].includes(getSide(tt))?"y":"x"}function getAlignmentAxis(tt){return getOppositeAxis(getSideAxis(tt))}function getAlignmentSides(tt,et,rt){rt===void 0&&(rt=!1);const nt=getAlignment(tt),it=getAlignmentAxis(tt),st=getAxisLength(it);let ot=it==="x"?nt===(rt?"end":"start")?"right":"left":nt==="start"?"bottom":"top";return et.reference[st]>et.floating[st]&&(ot=getOppositePlacement(ot)),[ot,getOppositePlacement(ot)]}function getExpandedPlacements(tt){const et=getOppositePlacement(tt);return[getOppositeAlignmentPlacement(tt),et,getOppositeAlignmentPlacement(et)]}function getOppositeAlignmentPlacement(tt){return tt.replace(/start|end/g,et=>oppositeAlignmentMap[et])}function getSideList(tt,et,rt){const nt=["left","right"],it=["right","left"],st=["top","bottom"],ot=["bottom","top"];switch(tt){case"top":case"bottom":return rt?et?it:nt:et?nt:it;case"left":case"right":return et?st:ot;default:return[]}}function getOppositeAxisPlacements(tt,et,rt,nt){const it=getAlignment(tt);let st=getSideList(getSide(tt),rt==="start",nt);return it&&(st=st.map(ot=>ot+"-"+it),et&&(st=st.concat(st.map(getOppositeAlignmentPlacement)))),st}function getOppositePlacement(tt){return tt.replace(/left|right|bottom|top/g,et=>oppositeSideMap[et])}function expandPaddingObject(tt){return{top:0,right:0,bottom:0,left:0,...tt}}function getPaddingObject(tt){return typeof tt!="number"?expandPaddingObject(tt):{top:tt,right:tt,bottom:tt,left:tt}}function rectToClientRect(tt){return{...tt,top:tt.y,left:tt.x,right:tt.x+tt.width,bottom:tt.y+tt.height}}function computeCoordsFromPlacement(tt,et,rt){let{reference:nt,floating:it}=tt;const st=getSideAxis(et),ot=getAlignmentAxis(et),lt=getAxisLength(ot),ut=getSide(et),ct=st==="y",dt=nt.x+nt.width/2-it.width/2,pt=nt.y+nt.height/2-it.height/2,ft=nt[lt]/2-it[lt]/2;let gt;switch(ut){case"top":gt={x:dt,y:nt.y-it.height};break;case"bottom":gt={x:dt,y:nt.y+nt.height};break;case"right":gt={x:nt.x+nt.width,y:pt};break;case"left":gt={x:nt.x-it.width,y:pt};break;default:gt={x:nt.x,y:nt.y}}switch(getAlignment(et)){case"start":gt[ot]-=ft*(rt&&ct?-1:1);break;case"end":gt[ot]+=ft*(rt&&ct?-1:1);break}return gt}const computePosition$1=async(tt,et,rt)=>{const{placement:nt="bottom",strategy:it="absolute",middleware:st=[],platform:ot}=rt,lt=st.filter(Boolean),ut=await(ot.isRTL==null?void 0:ot.isRTL(et));let ct=await ot.getElementRects({reference:tt,floating:et,strategy:it}),{x:dt,y:pt}=computeCoordsFromPlacement(ct,nt,ut),ft=nt,gt={},_r=0;for(let Yr=0;Yr<lt.length;Yr++){const{name:mt,fn:Kr}=lt[Yr],{x:Xr,y:Zr,data:Qr,reset:_i}=await Kr({x:dt,y:pt,initialPlacement:nt,placement:ft,strategy:it,middlewareData:gt,rects:ct,platform:ot,elements:{reference:tt,floating:et}});dt=Xr??dt,pt=Zr??pt,gt={...gt,[mt]:{...gt[mt],...Qr}},_i&&_r<=50&&(_r++,typeof _i=="object"&&(_i.placement&&(ft=_i.placement),_i.rects&&(ct=_i.rects===!0?await ot.getElementRects({reference:tt,floating:et,strategy:it}):_i.rects),{x:dt,y:pt}=computeCoordsFromPlacement(ct,ft,ut)),Yr=-1)}return{x:dt,y:pt,placement:ft,strategy:it,middlewareData:gt}};async function detectOverflow(tt,et){var rt;et===void 0&&(et={});const{x:nt,y:it,platform:st,rects:ot,elements:lt,strategy:ut}=tt,{boundary:ct="clippingAncestors",rootBoundary:dt="viewport",elementContext:pt="floating",altBoundary:ft=!1,padding:gt=0}=evaluate(et,tt),_r=getPaddingObject(gt),mt=lt[ft?pt==="floating"?"reference":"floating":pt],Kr=rectToClientRect(await st.getClippingRect({element:(rt=await(st.isElement==null?void 0:st.isElement(mt)))==null||rt?mt:mt.contextElement||await(st.getDocumentElement==null?void 0:st.getDocumentElement(lt.floating)),boundary:ct,rootBoundary:dt,strategy:ut})),Xr=pt==="floating"?{...ot.floating,x:nt,y:it}:ot.reference,Zr=await(st.getOffsetParent==null?void 0:st.getOffsetParent(lt.floating)),Qr=await(st.isElement==null?void 0:st.isElement(Zr))?await(st.getScale==null?void 0:st.getScale(Zr))||{x:1,y:1}:{x:1,y:1},_i=rectToClientRect(st.convertOffsetParentRelativeRectToViewportRelativeRect?await st.convertOffsetParentRelativeRectToViewportRelativeRect({elements:lt,rect:Xr,offsetParent:Zr,strategy:ut}):Xr);return{top:(Kr.top-_i.top+_r.top)/Qr.y,bottom:(_i.bottom-Kr.bottom+_r.bottom)/Qr.y,left:(Kr.left-_i.left+_r.left)/Qr.x,right:(_i.right-Kr.right+_r.right)/Qr.x}}const arrow$2=tt=>({name:"arrow",options:tt,async fn(et){const{x:rt,y:nt,placement:it,rects:st,platform:ot,elements:lt,middlewareData:ut}=et,{element:ct,padding:dt=0}=evaluate(tt,et)||{};if(ct==null)return{};const pt=getPaddingObject(dt),ft={x:rt,y:nt},gt=getAlignmentAxis(it),_r=getAxisLength(gt),Yr=await ot.getDimensions(ct),mt=gt==="y",Kr=mt?"top":"left",Xr=mt?"bottom":"right",Zr=mt?"clientHeight":"clientWidth",Qr=st.reference[_r]+st.reference[gt]-ft[gt]-st.floating[_r],_i=ft[gt]-st.reference[gt],ns=await(ot.getOffsetParent==null?void 0:ot.getOffsetParent(ct));let rs=ns?ns[Zr]:0;(!rs||!await(ot.isElement==null?void 0:ot.isElement(ns)))&&(rs=lt.floating[Zr]||st.floating[_r]);const ss=Qr/2-_i/2,hs=rs/2-Yr[_r]/2-1,os=min(pt[Kr],hs),is=min(pt[Xr],hs),cs=os,ps=rs-Yr[_r]-is,vs=rs/2-Yr[_r]/2+ss,ls=clamp(cs,vs,ps),ms=!ut.arrow&&getAlignment(it)!=null&&vs!==ls&&st.reference[_r]/2-(vs<cs?os:is)-Yr[_r]/2<0,us=ms?vs<cs?vs-cs:vs-ps:0;return{[gt]:ft[gt]+us,data:{[gt]:ls,centerOffset:vs-ls-us,...ms&&{alignmentOffset:us}},reset:ms}}}),flip$1=function(tt){return tt===void 0&&(tt={}),{name:"flip",options:tt,async fn(et){var rt,nt;const{placement:it,middlewareData:st,rects:ot,initialPlacement:lt,platform:ut,elements:ct}=et,{mainAxis:dt=!0,crossAxis:pt=!0,fallbackPlacements:ft,fallbackStrategy:gt="bestFit",fallbackAxisSideDirection:_r="none",flipAlignment:Yr=!0,...mt}=evaluate(tt,et);if((rt=st.arrow)!=null&&rt.alignmentOffset)return{};const Kr=getSide(it),Xr=getSide(lt)===lt,Zr=await(ut.isRTL==null?void 0:ut.isRTL(ct.floating)),Qr=ft||(Xr||!Yr?[getOppositePlacement(lt)]:getExpandedPlacements(lt));!ft&&_r!=="none"&&Qr.push(...getOppositeAxisPlacements(lt,Yr,_r,Zr));const _i=[lt,...Qr],ns=await detectOverflow(et,mt),rs=[];let ss=((nt=st.flip)==null?void 0:nt.overflows)||[];if(dt&&rs.push(ns[Kr]),pt){const cs=getAlignmentSides(it,ot,Zr);rs.push(ns[cs[0]],ns[cs[1]])}if(ss=[...ss,{placement:it,overflows:rs}],!rs.every(cs=>cs<=0)){var hs,os;const cs=(((hs=st.flip)==null?void 0:hs.index)||0)+1,ps=_i[cs];if(ps)return{data:{index:cs,overflows:ss},reset:{placement:ps}};let vs=(os=ss.filter(ls=>ls.overflows[0]<=0).sort((ls,ms)=>ls.overflows[1]-ms.overflows[1])[0])==null?void 0:os.placement;if(!vs)switch(gt){case"bestFit":{var is;const ls=(is=ss.map(ms=>[ms.placement,ms.overflows.filter(us=>us>0).reduce((us,gs)=>us+gs,0)]).sort((ms,us)=>ms[1]-us[1])[0])==null?void 0:is[0];ls&&(vs=ls);break}case"initialPlacement":vs=lt;break}if(it!==vs)return{reset:{placement:vs}}}return{}}}};function getSideOffsets(tt,et){return{top:tt.top-et.height,right:tt.right-et.width,bottom:tt.bottom-et.height,left:tt.left-et.width}}function isAnySideFullyClipped(tt){return sides.some(et=>tt[et]>=0)}const hide$1=function(tt){return tt===void 0&&(tt={}),{name:"hide",options:tt,async fn(et){const{rects:rt}=et,{strategy:nt="referenceHidden",...it}=evaluate(tt,et);switch(nt){case"referenceHidden":{const st=await detectOverflow(et,{...it,elementContext:"reference"}),ot=getSideOffsets(st,rt.reference);return{data:{referenceHiddenOffsets:ot,referenceHidden:isAnySideFullyClipped(ot)}}}case"escaped":{const st=await detectOverflow(et,{...it,altBoundary:!0}),ot=getSideOffsets(st,rt.floating);return{data:{escapedOffsets:ot,escaped:isAnySideFullyClipped(ot)}}}default:return{}}}}};async function convertValueToCoords(tt,et){const{placement:rt,platform:nt,elements:it}=tt,st=await(nt.isRTL==null?void 0:nt.isRTL(it.floating)),ot=getSide(rt),lt=getAlignment(rt),ut=getSideAxis(rt)==="y",ct=["left","top"].includes(ot)?-1:1,dt=st&&ut?-1:1,pt=evaluate(et,tt);let{mainAxis:ft,crossAxis:gt,alignmentAxis:_r}=typeof pt=="number"?{mainAxis:pt,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...pt};return lt&&typeof _r=="number"&&(gt=lt==="end"?_r*-1:_r),ut?{x:gt*dt,y:ft*ct}:{x:ft*ct,y:gt*dt}}const offset=function(tt){return tt===void 0&&(tt=0),{name:"offset",options:tt,async fn(et){var rt,nt;const{x:it,y:st,placement:ot,middlewareData:lt}=et,ut=await convertValueToCoords(et,tt);return ot===((rt=lt.offset)==null?void 0:rt.placement)&&(nt=lt.arrow)!=null&&nt.alignmentOffset?{}:{x:it+ut.x,y:st+ut.y,data:{...ut,placement:ot}}}}},shift$1=function(tt){return tt===void 0&&(tt={}),{name:"shift",options:tt,async fn(et){const{x:rt,y:nt,placement:it}=et,{mainAxis:st=!0,crossAxis:ot=!1,limiter:lt={fn:mt=>{let{x:Kr,y:Xr}=mt;return{x:Kr,y:Xr}}},...ut}=evaluate(tt,et),ct={x:rt,y:nt},dt=await detectOverflow(et,ut),pt=getSideAxis(getSide(it)),ft=getOppositeAxis(pt);let gt=ct[ft],_r=ct[pt];if(st){const mt=ft==="y"?"top":"left",Kr=ft==="y"?"bottom":"right",Xr=gt+dt[mt],Zr=gt-dt[Kr];gt=clamp(Xr,gt,Zr)}if(ot){const mt=pt==="y"?"top":"left",Kr=pt==="y"?"bottom":"right",Xr=_r+dt[mt],Zr=_r-dt[Kr];_r=clamp(Xr,_r,Zr)}const Yr=lt.fn({...et,[ft]:gt,[pt]:_r});return{...Yr,data:{x:Yr.x-rt,y:Yr.y-nt}}}}},limitShift$1=function(tt){return tt===void 0&&(tt={}),{options:tt,fn(et){const{x:rt,y:nt,placement:it,rects:st,middlewareData:ot}=et,{offset:lt=0,mainAxis:ut=!0,crossAxis:ct=!0}=evaluate(tt,et),dt={x:rt,y:nt},pt=getSideAxis(it),ft=getOppositeAxis(pt);let gt=dt[ft],_r=dt[pt];const Yr=evaluate(lt,et),mt=typeof Yr=="number"?{mainAxis:Yr,crossAxis:0}:{mainAxis:0,crossAxis:0,...Yr};if(ut){const Zr=ft==="y"?"height":"width",Qr=st.reference[ft]-st.floating[Zr]+mt.mainAxis,_i=st.reference[ft]+st.reference[Zr]-mt.mainAxis;gt<Qr?gt=Qr:gt>_i&&(gt=_i)}if(ct){var Kr,Xr;const Zr=ft==="y"?"width":"height",Qr=["top","left"].includes(getSide(it)),_i=st.reference[pt]-st.floating[Zr]+(Qr&&((Kr=ot.offset)==null?void 0:Kr[pt])||0)+(Qr?0:mt.crossAxis),ns=st.reference[pt]+st.reference[Zr]+(Qr?0:((Xr=ot.offset)==null?void 0:Xr[pt])||0)-(Qr?mt.crossAxis:0);_r<_i?_r=_i:_r>ns&&(_r=ns)}return{[ft]:gt,[pt]:_r}}}},size$1=function(tt){return tt===void 0&&(tt={}),{name:"size",options:tt,async fn(et){const{placement:rt,rects:nt,platform:it,elements:st}=et,{apply:ot=()=>{},...lt}=evaluate(tt,et),ut=await detectOverflow(et,lt),ct=getSide(rt),dt=getAlignment(rt),pt=getSideAxis(rt)==="y",{width:ft,height:gt}=nt.floating;let _r,Yr;ct==="top"||ct==="bottom"?(_r=ct,Yr=dt===(await(it.isRTL==null?void 0:it.isRTL(st.floating))?"start":"end")?"left":"right"):(Yr=ct,_r=dt==="end"?"top":"bottom");const mt=gt-ut[_r],Kr=ft-ut[Yr],Xr=!et.middlewareData.shift;let Zr=mt,Qr=Kr;if(pt){const ns=ft-ut.left-ut.right;Qr=dt||Xr?min(Kr,ns):ns}else{const ns=gt-ut.top-ut.bottom;Zr=dt||Xr?min(mt,ns):ns}if(Xr&&!dt){const ns=max(ut.left,0),rs=max(ut.right,0),ss=max(ut.top,0),hs=max(ut.bottom,0);pt?Qr=ft-2*(ns!==0||rs!==0?ns+rs:max(ut.left,ut.right)):Zr=gt-2*(ss!==0||hs!==0?ss+hs:max(ut.top,ut.bottom))}await ot({...et,availableWidth:Qr,availableHeight:Zr});const _i=await it.getDimensions(st.floating);return ft!==_i.width||gt!==_i.height?{reset:{rects:!0}}:{}}}};function getNodeName(tt){return isNode(tt)?(tt.nodeName||"").toLowerCase():"#document"}function getWindow(tt){var et;return(tt==null||(et=tt.ownerDocument)==null?void 0:et.defaultView)||window}function getDocumentElement(tt){var et;return(et=(isNode(tt)?tt.ownerDocument:tt.document)||window.document)==null?void 0:et.documentElement}function isNode(tt){return tt instanceof Node||tt instanceof getWindow(tt).Node}function isElement(tt){return tt instanceof Element||tt instanceof getWindow(tt).Element}function isHTMLElement(tt){return tt instanceof HTMLElement||tt instanceof getWindow(tt).HTMLElement}function isShadowRoot(tt){return typeof ShadowRoot>"u"?!1:tt instanceof ShadowRoot||tt instanceof getWindow(tt).ShadowRoot}function isOverflowElement(tt){const{overflow:et,overflowX:rt,overflowY:nt,display:it}=getComputedStyle$1(tt);return/auto|scroll|overlay|hidden|clip/.test(et+nt+rt)&&!["inline","contents"].includes(it)}function isTableElement(tt){return["table","td","th"].includes(getNodeName(tt))}function isContainingBlock(tt){const et=isWebKit(),rt=getComputedStyle$1(tt);return rt.transform!=="none"||rt.perspective!=="none"||(rt.containerType?rt.containerType!=="normal":!1)||!et&&(rt.backdropFilter?rt.backdropFilter!=="none":!1)||!et&&(rt.filter?rt.filter!=="none":!1)||["transform","perspective","filter"].some(nt=>(rt.willChange||"").includes(nt))||["paint","layout","strict","content"].some(nt=>(rt.contain||"").includes(nt))}function getContainingBlock(tt){let et=getParentNode(tt);for(;isHTMLElement(et)&&!isLastTraversableNode(et);){if(isContainingBlock(et))return et;et=getParentNode(et)}return null}function isWebKit(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function isLastTraversableNode(tt){return["html","body","#document"].includes(getNodeName(tt))}function getComputedStyle$1(tt){return getWindow(tt).getComputedStyle(tt)}function getNodeScroll(tt){return isElement(tt)?{scrollLeft:tt.scrollLeft,scrollTop:tt.scrollTop}:{scrollLeft:tt.pageXOffset,scrollTop:tt.pageYOffset}}function getParentNode(tt){if(getNodeName(tt)==="html")return tt;const et=tt.assignedSlot||tt.parentNode||isShadowRoot(tt)&&tt.host||getDocumentElement(tt);return isShadowRoot(et)?et.host:et}function getNearestOverflowAncestor(tt){const et=getParentNode(tt);return isLastTraversableNode(et)?tt.ownerDocument?tt.ownerDocument.body:tt.body:isHTMLElement(et)&&isOverflowElement(et)?et:getNearestOverflowAncestor(et)}function getOverflowAncestors(tt,et,rt){var nt;et===void 0&&(et=[]),rt===void 0&&(rt=!0);const it=getNearestOverflowAncestor(tt),st=it===((nt=tt.ownerDocument)==null?void 0:nt.body),ot=getWindow(it);return st?et.concat(ot,ot.visualViewport||[],isOverflowElement(it)?it:[],ot.frameElement&&rt?getOverflowAncestors(ot.frameElement):[]):et.concat(it,getOverflowAncestors(it,[],rt))}function getCssDimensions(tt){const et=getComputedStyle$1(tt);let rt=parseFloat(et.width)||0,nt=parseFloat(et.height)||0;const it=isHTMLElement(tt),st=it?tt.offsetWidth:rt,ot=it?tt.offsetHeight:nt,lt=round(rt)!==st||round(nt)!==ot;return lt&&(rt=st,nt=ot),{width:rt,height:nt,$:lt}}function unwrapElement(tt){return isElement(tt)?tt:tt.contextElement}function getScale(tt){const et=unwrapElement(tt);if(!isHTMLElement(et))return createCoords(1);const rt=et.getBoundingClientRect(),{width:nt,height:it,$:st}=getCssDimensions(et);let ot=(st?round(rt.width):rt.width)/nt,lt=(st?round(rt.height):rt.height)/it;return(!ot||!Number.isFinite(ot))&&(ot=1),(!lt||!Number.isFinite(lt))&&(lt=1),{x:ot,y:lt}}const noOffsets=createCoords(0);function getVisualOffsets(tt){const et=getWindow(tt);return!isWebKit()||!et.visualViewport?noOffsets:{x:et.visualViewport.offsetLeft,y:et.visualViewport.offsetTop}}function shouldAddVisualOffsets(tt,et,rt){return et===void 0&&(et=!1),!rt||et&&rt!==getWindow(tt)?!1:et}function getBoundingClientRect(tt,et,rt,nt){et===void 0&&(et=!1),rt===void 0&&(rt=!1);const it=tt.getBoundingClientRect(),st=unwrapElement(tt);let ot=createCoords(1);et&&(nt?isElement(nt)&&(ot=getScale(nt)):ot=getScale(tt));const lt=shouldAddVisualOffsets(st,rt,nt)?getVisualOffsets(st):createCoords(0);let ut=(it.left+lt.x)/ot.x,ct=(it.top+lt.y)/ot.y,dt=it.width/ot.x,pt=it.height/ot.y;if(st){const ft=getWindow(st),gt=nt&&isElement(nt)?getWindow(nt):nt;let _r=ft.frameElement;for(;_r&&nt&&gt!==ft;){const Yr=getScale(_r),mt=_r.getBoundingClientRect(),Kr=getComputedStyle$1(_r),Xr=mt.left+(_r.clientLeft+parseFloat(Kr.paddingLeft))*Yr.x,Zr=mt.top+(_r.clientTop+parseFloat(Kr.paddingTop))*Yr.y;ut*=Yr.x,ct*=Yr.y,dt*=Yr.x,pt*=Yr.y,ut+=Xr,ct+=Zr,_r=getWindow(_r).frameElement}}return rectToClientRect({width:dt,height:pt,x:ut,y:ct})}const topLayerSelectors=[":popover-open",":modal"];function topLayer(tt){let et=!1,rt=0,nt=0;function it(st){try{et=et||tt.matches(st)}catch{}}if(topLayerSelectors.forEach(st=>{it(st)}),et){const st=getContainingBlock(tt);if(st){const ot=st.getBoundingClientRect();rt=ot.x,nt=ot.y}}return[et,rt,nt]}function convertOffsetParentRelativeRectToViewportRelativeRect(tt){let{elements:et,rect:rt,offsetParent:nt,strategy:it}=tt;const st=getDocumentElement(nt),[ot]=et?topLayer(et.floating):[!1];if(nt===st||ot)return rt;let lt={scrollLeft:0,scrollTop:0},ut=createCoords(1);const ct=createCoords(0),dt=isHTMLElement(nt);if((dt||!dt&&it!=="fixed")&&((getNodeName(nt)!=="body"||isOverflowElement(st))&&(lt=getNodeScroll(nt)),isHTMLElement(nt))){const pt=getBoundingClientRect(nt);ut=getScale(nt),ct.x=pt.x+nt.clientLeft,ct.y=pt.y+nt.clientTop}return{width:rt.width*ut.x,height:rt.height*ut.y,x:rt.x*ut.x-lt.scrollLeft*ut.x+ct.x,y:rt.y*ut.y-lt.scrollTop*ut.y+ct.y}}function getClientRects(tt){return Array.from(tt.getClientRects())}function getWindowScrollBarX(tt){return getBoundingClientRect(getDocumentElement(tt)).left+getNodeScroll(tt).scrollLeft}function getDocumentRect(tt){const et=getDocumentElement(tt),rt=getNodeScroll(tt),nt=tt.ownerDocument.body,it=max(et.scrollWidth,et.clientWidth,nt.scrollWidth,nt.clientWidth),st=max(et.scrollHeight,et.clientHeight,nt.scrollHeight,nt.clientHeight);let ot=-rt.scrollLeft+getWindowScrollBarX(tt);const lt=-rt.scrollTop;return getComputedStyle$1(nt).direction==="rtl"&&(ot+=max(et.clientWidth,nt.clientWidth)-it),{width:it,height:st,x:ot,y:lt}}function getViewportRect(tt,et){const rt=getWindow(tt),nt=getDocumentElement(tt),it=rt.visualViewport;let st=nt.clientWidth,ot=nt.clientHeight,lt=0,ut=0;if(it){st=it.width,ot=it.height;const ct=isWebKit();(!ct||ct&&et==="fixed")&&(lt=it.offsetLeft,ut=it.offsetTop)}return{width:st,height:ot,x:lt,y:ut}}function getInnerBoundingClientRect(tt,et){const rt=getBoundingClientRect(tt,!0,et==="fixed"),nt=rt.top+tt.clientTop,it=rt.left+tt.clientLeft,st=isHTMLElement(tt)?getScale(tt):createCoords(1),ot=tt.clientWidth*st.x,lt=tt.clientHeight*st.y,ut=it*st.x,ct=nt*st.y;return{width:ot,height:lt,x:ut,y:ct}}function getClientRectFromClippingAncestor(tt,et,rt){let nt;if(et==="viewport")nt=getViewportRect(tt,rt);else if(et==="document")nt=getDocumentRect(getDocumentElement(tt));else if(isElement(et))nt=getInnerBoundingClientRect(et,rt);else{const it=getVisualOffsets(tt);nt={...et,x:et.x-it.x,y:et.y-it.y}}return rectToClientRect(nt)}function hasFixedPositionAncestor(tt,et){const rt=getParentNode(tt);return rt===et||!isElement(rt)||isLastTraversableNode(rt)?!1:getComputedStyle$1(rt).position==="fixed"||hasFixedPositionAncestor(rt,et)}function getClippingElementAncestors(tt,et){const rt=et.get(tt);if(rt)return rt;let nt=getOverflowAncestors(tt,[],!1).filter(lt=>isElement(lt)&&getNodeName(lt)!=="body"),it=null;const st=getComputedStyle$1(tt).position==="fixed";let ot=st?getParentNode(tt):tt;for(;isElement(ot)&&!isLastTraversableNode(ot);){const lt=getComputedStyle$1(ot),ut=isContainingBlock(ot);!ut&&lt.position==="fixed"&&(it=null),(st?!ut&&!it:!ut&&lt.position==="static"&&!!it&&["absolute","fixed"].includes(it.position)||isOverflowElement(ot)&&!ut&&hasFixedPositionAncestor(tt,ot))?nt=nt.filter(dt=>dt!==ot):it=lt,ot=getParentNode(ot)}return et.set(tt,nt),nt}function getClippingRect(tt){let{element:et,boundary:rt,rootBoundary:nt,strategy:it}=tt;const ot=[...rt==="clippingAncestors"?getClippingElementAncestors(et,this._c):[].concat(rt),nt],lt=ot[0],ut=ot.reduce((ct,dt)=>{const pt=getClientRectFromClippingAncestor(et,dt,it);return ct.top=max(pt.top,ct.top),ct.right=min(pt.right,ct.right),ct.bottom=min(pt.bottom,ct.bottom),ct.left=max(pt.left,ct.left),ct},getClientRectFromClippingAncestor(et,lt,it));return{width:ut.right-ut.left,height:ut.bottom-ut.top,x:ut.left,y:ut.top}}function getDimensions(tt){const{width:et,height:rt}=getCssDimensions(tt);return{width:et,height:rt}}function getRectRelativeToOffsetParent(tt,et,rt,nt){const it=isHTMLElement(et),st=getDocumentElement(et),ot=rt==="fixed",lt=getBoundingClientRect(tt,!0,ot,et);let ut={scrollLeft:0,scrollTop:0};const ct=createCoords(0);if(it||!it&&!ot)if((getNodeName(et)!=="body"||isOverflowElement(st))&&(ut=getNodeScroll(et)),it){const Yr=getBoundingClientRect(et,!0,ot,et);ct.x=Yr.x+et.clientLeft,ct.y=Yr.y+et.clientTop}else st&&(ct.x=getWindowScrollBarX(st));let dt=lt.left+ut.scrollLeft-ct.x,pt=lt.top+ut.scrollTop-ct.y;const[ft,gt,_r]=topLayer(nt);return ft&&(dt+=gt,pt+=_r,it&&(dt+=et.clientLeft,pt+=et.clientTop)),{x:dt,y:pt,width:lt.width,height:lt.height}}function getTrueOffsetParent(tt,et){return!isHTMLElement(tt)||getComputedStyle$1(tt).position==="fixed"?null:et?et(tt):tt.offsetParent}function getOffsetParent(tt,et){const rt=getWindow(tt);if(!isHTMLElement(tt))return rt;let nt=getTrueOffsetParent(tt,et);for(;nt&&isTableElement(nt)&&getComputedStyle$1(nt).position==="static";)nt=getTrueOffsetParent(nt,et);return nt&&(getNodeName(nt)==="html"||getNodeName(nt)==="body"&&getComputedStyle$1(nt).position==="static"&&!isContainingBlock(nt))?rt:nt||getContainingBlock(tt)||rt}const getElementRects=async function(tt){const et=this.getOffsetParent||getOffsetParent,rt=this.getDimensions;return{reference:getRectRelativeToOffsetParent(tt.reference,await et(tt.floating),tt.strategy,tt.floating),floating:{x:0,y:0,...await rt(tt.floating)}}};function isRTL(tt){return getComputedStyle$1(tt).direction==="rtl"}const platform={convertOffsetParentRelativeRectToViewportRelativeRect,getDocumentElement,getClippingRect,getOffsetParent,getElementRects,getClientRects,getDimensions,getScale,isElement,isRTL};function observeMove(tt,et){let rt=null,nt;const it=getDocumentElement(tt);function st(){var lt;clearTimeout(nt),(lt=rt)==null||lt.disconnect(),rt=null}function ot(lt,ut){lt===void 0&&(lt=!1),ut===void 0&&(ut=1),st();const{left:ct,top:dt,width:pt,height:ft}=tt.getBoundingClientRect();if(lt||et(),!pt||!ft)return;const gt=floor(dt),_r=floor(it.clientWidth-(ct+pt)),Yr=floor(it.clientHeight-(dt+ft)),mt=floor(ct),Xr={rootMargin:-gt+"px "+-_r+"px "+-Yr+"px "+-mt+"px",threshold:max(0,min(1,ut))||1};let Zr=!0;function Qr(_i){const ns=_i[0].intersectionRatio;if(ns!==ut){if(!Zr)return ot();ns?ot(!1,ns):nt=setTimeout(()=>{ot(!1,1e-7)},100)}Zr=!1}try{rt=new IntersectionObserver(Qr,{...Xr,root:it.ownerDocument})}catch{rt=new IntersectionObserver(Qr,Xr)}rt.observe(tt)}return ot(!0),st}function autoUpdate(tt,et,rt,nt){nt===void 0&&(nt={});const{ancestorScroll:it=!0,ancestorResize:st=!0,elementResize:ot=typeof ResizeObserver=="function",layoutShift:lt=typeof IntersectionObserver=="function",animationFrame:ut=!1}=nt,ct=unwrapElement(tt),dt=it||st?[...ct?getOverflowAncestors(ct):[],...getOverflowAncestors(et)]:[];dt.forEach(Kr=>{it&&Kr.addEventListener("scroll",rt,{passive:!0}),st&&Kr.addEventListener("resize",rt)});const pt=ct&&lt?observeMove(ct,rt):null;let ft=-1,gt=null;ot&&(gt=new ResizeObserver(Kr=>{let[Xr]=Kr;Xr&&Xr.target===ct&&gt&&(gt.unobserve(et),cancelAnimationFrame(ft),ft=requestAnimationFrame(()=>{var Zr;(Zr=gt)==null||Zr.observe(et)})),rt()}),ct&&!ut&&gt.observe(ct),gt.observe(et));let _r,Yr=ut?getBoundingClientRect(tt):null;ut&&mt();function mt(){const Kr=getBoundingClientRect(tt);Yr&&(Kr.x!==Yr.x||Kr.y!==Yr.y||Kr.width!==Yr.width||Kr.height!==Yr.height)&&rt(),Yr=Kr,_r=requestAnimationFrame(mt)}return rt(),()=>{var Kr;dt.forEach(Xr=>{it&&Xr.removeEventListener("scroll",rt),st&&Xr.removeEventListener("resize",rt)}),pt==null||pt(),(Kr=gt)==null||Kr.disconnect(),gt=null,ut&&cancelAnimationFrame(_r)}}const shift=shift$1,flip=flip$1,size=size$1,hide=hide$1,arrow$1=arrow$2,limitShift=limitShift$1,computePosition=(tt,et,rt)=>{const nt=new Map,it={platform,...rt},st={...it.platform,_c:nt};return computePosition$1(tt,et,{...it,platform:st})},arrow=tt=>{function et(rt){return{}.hasOwnProperty.call(rt,"current")}return{name:"arrow",options:tt,fn(rt){const{element:nt,padding:it}=typeof tt=="function"?tt(rt):tt;return nt&&et(nt)?nt.current!=null?arrow$1({element:nt.current,padding:it}).fn(rt):{}:nt?arrow$1({element:nt,padding:it}).fn(rt):{}}}};var index=typeof document<"u"?reactExports.useLayoutEffect:reactExports.useEffect;function deepEqual(tt,et){if(tt===et)return!0;if(typeof tt!=typeof et)return!1;if(typeof tt=="function"&&tt.toString()===et.toString())return!0;let rt,nt,it;if(tt&&et&&typeof tt=="object"){if(Array.isArray(tt)){if(rt=tt.length,rt!==et.length)return!1;for(nt=rt;nt--!==0;)if(!deepEqual(tt[nt],et[nt]))return!1;return!0}if(it=Object.keys(tt),rt=it.length,rt!==Object.keys(et).length)return!1;for(nt=rt;nt--!==0;)if(!{}.hasOwnProperty.call(et,it[nt]))return!1;for(nt=rt;nt--!==0;){const st=it[nt];if(!(st==="_owner"&&tt.$$typeof)&&!deepEqual(tt[st],et[st]))return!1}return!0}return tt!==tt&&et!==et}function getDPR(tt){return typeof window>"u"?1:(tt.ownerDocument.defaultView||window).devicePixelRatio||1}function roundByDPR(tt,et){const rt=getDPR(tt);return Math.round(et*rt)/rt}function useLatestRef(tt){const et=reactExports.useRef(tt);return index(()=>{et.current=tt}),et}function useFloating(tt){tt===void 0&&(tt={});const{placement:et="bottom",strategy:rt="absolute",middleware:nt=[],platform:it,elements:{reference:st,floating:ot}={},transform:lt=!0,whileElementsMounted:ut,open:ct}=tt,[dt,pt]=reactExports.useState({x:0,y:0,strategy:rt,placement:et,middlewareData:{},isPositioned:!1}),[ft,gt]=reactExports.useState(nt);deepEqual(ft,nt)||gt(nt);const[_r,Yr]=reactExports.useState(null),[mt,Kr]=reactExports.useState(null),Xr=reactExports.useCallback(us=>{us!==ns.current&&(ns.current=us,Yr(us))},[]),Zr=reactExports.useCallback(us=>{us!==rs.current&&(rs.current=us,Kr(us))},[]),Qr=st||_r,_i=ot||mt,ns=reactExports.useRef(null),rs=reactExports.useRef(null),ss=reactExports.useRef(dt),hs=ut!=null,os=useLatestRef(ut),is=useLatestRef(it),cs=reactExports.useCallback(()=>{if(!ns.current||!rs.current)return;const us={placement:et,strategy:rt,middleware:ft};is.current&&(us.platform=is.current),computePosition(ns.current,rs.current,us).then(gs=>{const ys={...gs,isPositioned:!0};ps.current&&!deepEqual(ss.current,ys)&&(ss.current=ys,reactDomExports.flushSync(()=>{pt(ys)}))})},[ft,et,rt,is]);index(()=>{ct===!1&&ss.current.isPositioned&&(ss.current.isPositioned=!1,pt(us=>({...us,isPositioned:!1})))},[ct]);const ps=reactExports.useRef(!1);index(()=>(ps.current=!0,()=>{ps.current=!1}),[]),index(()=>{if(Qr&&(ns.current=Qr),_i&&(rs.current=_i),Qr&&_i){if(os.current)return os.current(Qr,_i,cs);cs()}},[Qr,_i,cs,os,hs]);const vs=reactExports.useMemo(()=>({reference:ns,floating:rs,setReference:Xr,setFloating:Zr}),[Xr,Zr]),ls=reactExports.useMemo(()=>({reference:Qr,floating:_i}),[Qr,_i]),ms=reactExports.useMemo(()=>{const us={position:rt,left:0,top:0};if(!ls.floating)return us;const gs=roundByDPR(ls.floating,dt.x),ys=roundByDPR(ls.floating,dt.y);return lt?{...us,transform:"translate("+gs+"px, "+ys+"px)",...getDPR(ls.floating)>=1.5&&{willChange:"transform"}}:{position:rt,left:gs,top:ys}},[rt,lt,ls.floating,dt.x,dt.y]);return reactExports.useMemo(()=>({...dt,update:cs,refs:vs,elements:ls,floatingStyles:ms}),[dt,cs,vs,ls,ms])}const $7e8f5cd07187803e$export$21b07c8f274aebd5=reactExports.forwardRef((tt,et)=>{const{children:rt,width:nt=10,height:it=5,...st}=tt;return reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.svg,_extends$1({},st,{ref:et,width:nt,height:it,viewBox:"0 0 30 10",preserveAspectRatio:"none"}),tt.asChild?rt:reactExports.createElement("polygon",{points:"0,0 30,0 15,10"}))}),$7e8f5cd07187803e$export$be92b6f5f03c0fe9=$7e8f5cd07187803e$export$21b07c8f274aebd5,$cf1ac5d9fe0e8206$var$POPPER_NAME="Popper",[$cf1ac5d9fe0e8206$var$createPopperContext,$cf1ac5d9fe0e8206$export$722aac194ae923]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($cf1ac5d9fe0e8206$var$POPPER_NAME),[$cf1ac5d9fe0e8206$var$PopperProvider,$cf1ac5d9fe0e8206$var$usePopperContext]=$cf1ac5d9fe0e8206$var$createPopperContext($cf1ac5d9fe0e8206$var$POPPER_NAME),$cf1ac5d9fe0e8206$export$badac9ada3a0bdf9=tt=>{const{__scopePopper:et,children:rt}=tt,[nt,it]=reactExports.useState(null);return reactExports.createElement($cf1ac5d9fe0e8206$var$PopperProvider,{scope:et,anchor:nt,onAnchorChange:it},rt)},$cf1ac5d9fe0e8206$var$ANCHOR_NAME="PopperAnchor",$cf1ac5d9fe0e8206$export$ecd4e1ccab6ed6d=reactExports.forwardRef((tt,et)=>{const{__scopePopper:rt,virtualRef:nt,...it}=tt,st=$cf1ac5d9fe0e8206$var$usePopperContext($cf1ac5d9fe0e8206$var$ANCHOR_NAME,rt),ot=reactExports.useRef(null),lt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,ot);return reactExports.useEffect(()=>{st.onAnchorChange((nt==null?void 0:nt.current)||ot.current)}),nt?null:reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({},it,{ref:lt}))}),$cf1ac5d9fe0e8206$var$CONTENT_NAME="PopperContent",[$cf1ac5d9fe0e8206$var$PopperContentProvider,$cf1ac5d9fe0e8206$var$useContentContext]=$cf1ac5d9fe0e8206$var$createPopperContext($cf1ac5d9fe0e8206$var$CONTENT_NAME),$cf1ac5d9fe0e8206$export$bc4ae5855d3c4fc=reactExports.forwardRef((tt,et)=>{var rt,nt,it,st,ot,lt,ut,ct;const{__scopePopper:dt,side:pt="bottom",sideOffset:ft=0,align:gt="center",alignOffset:_r=0,arrowPadding:Yr=0,avoidCollisions:mt=!0,collisionBoundary:Kr=[],collisionPadding:Xr=0,sticky:Zr="partial",hideWhenDetached:Qr=!1,updatePositionStrategy:_i="optimized",onPlaced:ns,...rs}=tt,ss=$cf1ac5d9fe0e8206$var$usePopperContext($cf1ac5d9fe0e8206$var$CONTENT_NAME,dt),[hs,os]=reactExports.useState(null),is=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,xs=>os(xs)),[cs,ps]=reactExports.useState(null),vs=$db6c3485150b8e66$export$1ab7ae714698c4b8(cs),ls=(rt=vs==null?void 0:vs.width)!==null&&rt!==void 0?rt:0,ms=(nt=vs==null?void 0:vs.height)!==null&&nt!==void 0?nt:0,us=pt+(gt!=="center"?"-"+gt:""),gs=typeof Xr=="number"?Xr:{top:0,right:0,bottom:0,left:0,...Xr},ys=Array.isArray(Kr)?Kr:[Kr],Es=ys.length>0,Ss={padding:gs,boundary:ys.filter($cf1ac5d9fe0e8206$var$isNotNull),altBoundary:Es},{refs:Ts,floatingStyles:Ds,placement:Rs,isPositioned:Is,middlewareData:ks}=useFloating({strategy:"fixed",placement:us,whileElementsMounted:(...xs)=>autoUpdate(...xs,{animationFrame:_i==="always"}),elements:{reference:ss.anchor},middleware:[offset({mainAxis:ft+ms,alignmentAxis:_r}),mt&&shift({mainAxis:!0,crossAxis:!1,limiter:Zr==="partial"?limitShift():void 0,...Ss}),mt&&flip({...Ss}),size({...Ss,apply:({elements:xs,rects:bs,availableWidth:ws,availableHeight:Bs})=>{const{width:Ps,height:qs}=bs.reference,Ks=xs.floating.style;Ks.setProperty("--radix-popper-available-width",`${ws}px`),Ks.setProperty("--radix-popper-available-height",`${Bs}px`),Ks.setProperty("--radix-popper-anchor-width",`${Ps}px`),Ks.setProperty("--radix-popper-anchor-height",`${qs}px`)}}),cs&&arrow({element:cs,padding:Yr}),$cf1ac5d9fe0e8206$var$transformOrigin({arrowWidth:ls,arrowHeight:ms}),Qr&&hide({strategy:"referenceHidden",...Ss})]}),[As,Os]=$cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(Rs),Ys=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(ns);$9f79659886946c16$export$e5c5a5f917a5871c(()=>{Is&&(Ys==null||Ys())},[Is,Ys]);const Vs=(it=ks.arrow)===null||it===void 0?void 0:it.x,js=(st=ks.arrow)===null||st===void 0?void 0:st.y,Ws=((ot=ks.arrow)===null||ot===void 0?void 0:ot.centerOffset)!==0,[Jr,as]=reactExports.useState();return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{hs&&as(window.getComputedStyle(hs).zIndex)},[hs]),reactExports.createElement("div",{ref:Ts.setFloating,"data-radix-popper-content-wrapper":"",style:{...Ds,transform:Is?Ds.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Jr,"--radix-popper-transform-origin":[(lt=ks.transformOrigin)===null||lt===void 0?void 0:lt.x,(ut=ks.transformOrigin)===null||ut===void 0?void 0:ut.y].join(" ")},dir:tt.dir},reactExports.createElement($cf1ac5d9fe0e8206$var$PopperContentProvider,{scope:dt,placedSide:As,onArrowChange:ps,arrowX:Vs,arrowY:js,shouldHideArrow:Ws},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"data-side":As,"data-align":Os},rs,{ref:is,style:{...rs.style,animation:Is?void 0:"none",opacity:(ct=ks.hide)!==null&&ct!==void 0&&ct.referenceHidden?0:void 0}}))))}),$cf1ac5d9fe0e8206$var$ARROW_NAME="PopperArrow",$cf1ac5d9fe0e8206$var$OPPOSITE_SIDE={top:"bottom",right:"left",bottom:"top",left:"right"},$cf1ac5d9fe0e8206$export$79d62cd4e10a3fd0=reactExports.forwardRef(function(et,rt){const{__scopePopper:nt,...it}=et,st=$cf1ac5d9fe0e8206$var$useContentContext($cf1ac5d9fe0e8206$var$ARROW_NAME,nt),ot=$cf1ac5d9fe0e8206$var$OPPOSITE_SIDE[st.placedSide];return reactExports.createElement("span",{ref:st.onArrowChange,style:{position:"absolute",left:st.arrowX,top:st.arrowY,[ot]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[st.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[st.placedSide],visibility:st.shouldHideArrow?"hidden":void 0}},reactExports.createElement($7e8f5cd07187803e$export$be92b6f5f03c0fe9,_extends$1({},it,{ref:rt,style:{...it.style,display:"block"}})))});function $cf1ac5d9fe0e8206$var$isNotNull(tt){return tt!==null}const $cf1ac5d9fe0e8206$var$transformOrigin=tt=>({name:"transformOrigin",options:tt,fn(et){var rt,nt,it,st,ot;const{placement:lt,rects:ut,middlewareData:ct}=et,pt=((rt=ct.arrow)===null||rt===void 0?void 0:rt.centerOffset)!==0,ft=pt?0:tt.arrowWidth,gt=pt?0:tt.arrowHeight,[_r,Yr]=$cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(lt),mt={start:"0%",center:"50%",end:"100%"}[Yr],Kr=((nt=(it=ct.arrow)===null||it===void 0?void 0:it.x)!==null&&nt!==void 0?nt:0)+ft/2,Xr=((st=(ot=ct.arrow)===null||ot===void 0?void 0:ot.y)!==null&&st!==void 0?st:0)+gt/2;let Zr="",Qr="";return _r==="bottom"?(Zr=pt?mt:`${Kr}px`,Qr=`${-gt}px`):_r==="top"?(Zr=pt?mt:`${Kr}px`,Qr=`${ut.floating.height+gt}px`):_r==="right"?(Zr=`${-gt}px`,Qr=pt?mt:`${Xr}px`):_r==="left"&&(Zr=`${ut.floating.width+gt}px`,Qr=pt?mt:`${Xr}px`),{data:{x:Zr,y:Qr}}}});function $cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(tt){const[et,rt="center"]=tt.split("-");return[et,rt]}const $cf1ac5d9fe0e8206$export$be92b6f5f03c0fe9=$cf1ac5d9fe0e8206$export$badac9ada3a0bdf9,$cf1ac5d9fe0e8206$export$b688253958b8dfe7=$cf1ac5d9fe0e8206$export$ecd4e1ccab6ed6d,$cf1ac5d9fe0e8206$export$7c6e2c02157bb7d2=$cf1ac5d9fe0e8206$export$bc4ae5855d3c4fc,$cf1ac5d9fe0e8206$export$21b07c8f274aebd5=$cf1ac5d9fe0e8206$export$79d62cd4e10a3fd0,$f1701beae083dbae$export$602eac185826482c=reactExports.forwardRef((tt,et)=>{var rt;const{container:nt=globalThis==null||(rt=globalThis.document)===null||rt===void 0?void 0:rt.body,...it}=tt;return nt?$7SXl2$reactdom.createPortal(reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({},it,{ref:et})),nt):null});var getDefaultParent=function(tt){if(typeof document>"u")return null;var et=Array.isArray(tt)?tt[0]:tt;return et.ownerDocument.body},counterMap=new WeakMap,uncontrolledNodes=new WeakMap,markerMap={},lockCount=0,unwrapHost=function(tt){return tt&&(tt.host||unwrapHost(tt.parentNode))},correctTargets=function(tt,et){return et.map(function(rt){if(tt.contains(rt))return rt;var nt=unwrapHost(rt);return nt&&tt.contains(nt)?nt:(console.error("aria-hidden",rt,"in not contained inside",tt,". Doing nothing"),null)}).filter(function(rt){return!!rt})},applyAttributeToOthers=function(tt,et,rt,nt){var it=correctTargets(et,Array.isArray(tt)?tt:[tt]);markerMap[rt]||(markerMap[rt]=new WeakMap);var st=markerMap[rt],ot=[],lt=new Set,ut=new Set(it),ct=function(pt){!pt||lt.has(pt)||(lt.add(pt),ct(pt.parentNode))};it.forEach(ct);var dt=function(pt){!pt||ut.has(pt)||Array.prototype.forEach.call(pt.children,function(ft){if(lt.has(ft))dt(ft);else{var gt=ft.getAttribute(nt),_r=gt!==null&&gt!=="false",Yr=(counterMap.get(ft)||0)+1,mt=(st.get(ft)||0)+1;counterMap.set(ft,Yr),st.set(ft,mt),ot.push(ft),Yr===1&&_r&&uncontrolledNodes.set(ft,!0),mt===1&&ft.setAttribute(rt,"true"),_r||ft.setAttribute(nt,"true")}})};return dt(et),lt.clear(),lockCount++,function(){ot.forEach(function(pt){var ft=counterMap.get(pt)-1,gt=st.get(pt)-1;counterMap.set(pt,ft),st.set(pt,gt),ft||(uncontrolledNodes.has(pt)||pt.removeAttribute(nt),uncontrolledNodes.delete(pt)),gt||pt.removeAttribute(rt)}),lockCount--,lockCount||(counterMap=new WeakMap,counterMap=new WeakMap,uncontrolledNodes=new WeakMap,markerMap={})}},hideOthers=function(tt,et,rt){rt===void 0&&(rt="data-aria-hidden");var nt=Array.from(Array.isArray(tt)?tt:[tt]),it=et||getDefaultParent(tt);return it?(nt.push.apply(nt,Array.from(it.querySelectorAll("[aria-live]"))),applyAttributeToOthers(nt,it,rt,"aria-hidden")):function(){return null}},__assign=function(){return __assign=Object.assign||function(et){for(var rt,nt=1,it=arguments.length;nt<it;nt++){rt=arguments[nt];for(var st in rt)Object.prototype.hasOwnProperty.call(rt,st)&&(et[st]=rt[st])}return et},__assign.apply(this,arguments)};function __rest(tt,et){var rt={};for(var nt in tt)Object.prototype.hasOwnProperty.call(tt,nt)&&et.indexOf(nt)<0&&(rt[nt]=tt[nt]);if(tt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var it=0,nt=Object.getOwnPropertySymbols(tt);it<nt.length;it++)et.indexOf(nt[it])<0&&Object.prototype.propertyIsEnumerable.call(tt,nt[it])&&(rt[nt[it]]=tt[nt[it]]);return rt}function __spreadArray(tt,et,rt){if(rt||arguments.length===2)for(var nt=0,it=et.length,st;nt<it;nt++)(st||!(nt in et))&&(st||(st=Array.prototype.slice.call(et,0,nt)),st[nt]=et[nt]);return tt.concat(st||Array.prototype.slice.call(et))}typeof SuppressedError=="function"&&SuppressedError;var zeroRightClassName="right-scroll-bar-position",fullWidthClassName="width-before-scroll-bar",noScrollbarsClassName="with-scroll-bars-hidden",removedBarSizeVariable="--removed-body-scroll-bar-size";function assignRef(tt,et){return typeof tt=="function"?tt(et):tt&&(tt.current=et),tt}function useCallbackRef(tt,et){var rt=reactExports.useState(function(){return{value:tt,callback:et,facade:{get current(){return rt.value},set current(nt){var it=rt.value;it!==nt&&(rt.value=nt,rt.callback(nt,it))}}}})[0];return rt.callback=et,rt.facade}var currentValues=new WeakMap;function useMergeRefs(tt,et){var rt=useCallbackRef(et||null,function(nt){return tt.forEach(function(it){return assignRef(it,nt)})});return reactExports.useLayoutEffect(function(){var nt=currentValues.get(rt);if(nt){var it=new Set(nt),st=new Set(tt),ot=rt.current;it.forEach(function(lt){st.has(lt)||assignRef(lt,null)}),st.forEach(function(lt){it.has(lt)||assignRef(lt,ot)})}currentValues.set(rt,tt)},[tt]),rt}function ItoI(tt){return tt}function innerCreateMedium(tt,et){et===void 0&&(et=ItoI);var rt=[],nt=!1,it={read:function(){if(nt)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return rt.length?rt[rt.length-1]:tt},useMedium:function(st){var ot=et(st,nt);return rt.push(ot),function(){rt=rt.filter(function(lt){return lt!==ot})}},assignSyncMedium:function(st){for(nt=!0;rt.length;){var ot=rt;rt=[],ot.forEach(st)}rt={push:function(lt){return st(lt)},filter:function(){return rt}}},assignMedium:function(st){nt=!0;var ot=[];if(rt.length){var lt=rt;rt=[],lt.forEach(st),ot=rt}var ut=function(){var dt=ot;ot=[],dt.forEach(st)},ct=function(){return Promise.resolve().then(ut)};ct(),rt={push:function(dt){ot.push(dt),ct()},filter:function(dt){return ot=ot.filter(dt),rt}}}};return it}function createSidecarMedium(tt){tt===void 0&&(tt={});var et=innerCreateMedium(null);return et.options=__assign({async:!0,ssr:!1},tt),et}var SideCar$1=function(tt){var et=tt.sideCar,rt=__rest(tt,["sideCar"]);if(!et)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var nt=et.read();if(!nt)throw new Error("Sidecar medium not found");return reactExports.createElement(nt,__assign({},rt))};SideCar$1.isSideCarExport=!0;function exportSidecar(tt,et){return tt.useMedium(et),SideCar$1}var effectCar=createSidecarMedium(),nothing=function(){},RemoveScroll=reactExports.forwardRef(function(tt,et){var rt=reactExports.useRef(null),nt=reactExports.useState({onScrollCapture:nothing,onWheelCapture:nothing,onTouchMoveCapture:nothing}),it=nt[0],st=nt[1],ot=tt.forwardProps,lt=tt.children,ut=tt.className,ct=tt.removeScrollBar,dt=tt.enabled,pt=tt.shards,ft=tt.sideCar,gt=tt.noIsolation,_r=tt.inert,Yr=tt.allowPinchZoom,mt=tt.as,Kr=mt===void 0?"div":mt,Xr=__rest(tt,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as"]),Zr=ft,Qr=useMergeRefs([rt,et]),_i=__assign(__assign({},Xr),it);return reactExports.createElement(reactExports.Fragment,null,dt&&reactExports.createElement(Zr,{sideCar:effectCar,removeScrollBar:ct,shards:pt,noIsolation:gt,inert:_r,setCallbacks:st,allowPinchZoom:!!Yr,lockRef:rt}),ot?reactExports.cloneElement(reactExports.Children.only(lt),__assign(__assign({},_i),{ref:Qr})):reactExports.createElement(Kr,__assign({},_i,{className:ut,ref:Qr}),lt))});RemoveScroll.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};RemoveScroll.classNames={fullWidth:fullWidthClassName,zeroRight:zeroRightClassName};var getNonce=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function makeStyleTag(){if(!document)return null;var tt=document.createElement("style");tt.type="text/css";var et=getNonce();return et&&tt.setAttribute("nonce",et),tt}function injectStyles(tt,et){tt.styleSheet?tt.styleSheet.cssText=et:tt.appendChild(document.createTextNode(et))}function insertStyleTag(tt){var et=document.head||document.getElementsByTagName("head")[0];et.appendChild(tt)}var stylesheetSingleton=function(){var tt=0,et=null;return{add:function(rt){tt==0&&(et=makeStyleTag())&&(injectStyles(et,rt),insertStyleTag(et)),tt++},remove:function(){tt--,!tt&&et&&(et.parentNode&&et.parentNode.removeChild(et),et=null)}}},styleHookSingleton=function(){var tt=stylesheetSingleton();return function(et,rt){reactExports.useEffect(function(){return tt.add(et),function(){tt.remove()}},[et&&rt])}},styleSingleton=function(){var tt=styleHookSingleton(),et=function(rt){var nt=rt.styles,it=rt.dynamic;return tt(nt,it),null};return et},zeroGap={left:0,top:0,right:0,gap:0},parse=function(tt){return parseInt(tt||"",10)||0},getOffset=function(tt){var et=window.getComputedStyle(document.body),rt=et[tt==="padding"?"paddingLeft":"marginLeft"],nt=et[tt==="padding"?"paddingTop":"marginTop"],it=et[tt==="padding"?"paddingRight":"marginRight"];return[parse(rt),parse(nt),parse(it)]},getGapWidth=function(tt){if(tt===void 0&&(tt="margin"),typeof window>"u")return zeroGap;var et=getOffset(tt),rt=document.documentElement.clientWidth,nt=window.innerWidth;return{left:et[0],top:et[1],right:et[2],gap:Math.max(0,nt-rt+et[2]-et[0])}},Style=styleSingleton(),getStyles=function(tt,et,rt,nt){var it=tt.left,st=tt.top,ot=tt.right,lt=tt.gap;return rt===void 0&&(rt="margin"),`
  .`.concat(noScrollbarsClassName,` {
   overflow: hidden `).concat(nt,`;
   padding-right: `).concat(lt,"px ").concat(nt,`;
  }
  body {
    overflow: hidden `).concat(nt,`;
    overscroll-behavior: contain;
    `).concat([et&&"position: relative ".concat(nt,";"),rt==="margin"&&`
    padding-left: `.concat(it,`px;
    padding-top: `).concat(st,`px;
    padding-right: `).concat(ot,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(lt,"px ").concat(nt,`;
    `),rt==="padding"&&"padding-right: ".concat(lt,"px ").concat(nt,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(zeroRightClassName,` {
    right: `).concat(lt,"px ").concat(nt,`;
  }
  
  .`).concat(fullWidthClassName,` {
    margin-right: `).concat(lt,"px ").concat(nt,`;
  }
  
  .`).concat(zeroRightClassName," .").concat(zeroRightClassName,` {
    right: 0 `).concat(nt,`;
  }
  
  .`).concat(fullWidthClassName," .").concat(fullWidthClassName,` {
    margin-right: 0 `).concat(nt,`;
  }
  
  body {
    `).concat(removedBarSizeVariable,": ").concat(lt,`px;
  }
`)},RemoveScrollBar=function(tt){var et=tt.noRelative,rt=tt.noImportant,nt=tt.gapMode,it=nt===void 0?"margin":nt,st=reactExports.useMemo(function(){return getGapWidth(it)},[it]);return reactExports.createElement(Style,{styles:getStyles(st,!et,it,rt?"":"!important")})},passiveSupported=!1;if(typeof window<"u")try{var options=Object.defineProperty({},"passive",{get:function(){return passiveSupported=!0,!0}});window.addEventListener("test",options,options),window.removeEventListener("test",options,options)}catch{passiveSupported=!1}var nonPassive=passiveSupported?{passive:!1}:!1,alwaysContainsScroll=function(tt){return tt.tagName==="TEXTAREA"},elementCanBeScrolled=function(tt,et){var rt=window.getComputedStyle(tt);return rt[et]!=="hidden"&&!(rt.overflowY===rt.overflowX&&!alwaysContainsScroll(tt)&&rt[et]==="visible")},elementCouldBeVScrolled=function(tt){return elementCanBeScrolled(tt,"overflowY")},elementCouldBeHScrolled=function(tt){return elementCanBeScrolled(tt,"overflowX")},locationCouldBeScrolled=function(tt,et){var rt=et;do{typeof ShadowRoot<"u"&&rt instanceof ShadowRoot&&(rt=rt.host);var nt=elementCouldBeScrolled(tt,rt);if(nt){var it=getScrollVariables(tt,rt),st=it[1],ot=it[2];if(st>ot)return!0}rt=rt.parentNode}while(rt&&rt!==document.body);return!1},getVScrollVariables=function(tt){var et=tt.scrollTop,rt=tt.scrollHeight,nt=tt.clientHeight;return[et,rt,nt]},getHScrollVariables=function(tt){var et=tt.scrollLeft,rt=tt.scrollWidth,nt=tt.clientWidth;return[et,rt,nt]},elementCouldBeScrolled=function(tt,et){return tt==="v"?elementCouldBeVScrolled(et):elementCouldBeHScrolled(et)},getScrollVariables=function(tt,et){return tt==="v"?getVScrollVariables(et):getHScrollVariables(et)},getDirectionFactor=function(tt,et){return tt==="h"&&et==="rtl"?-1:1},handleScroll=function(tt,et,rt,nt,it){var st=getDirectionFactor(tt,window.getComputedStyle(et).direction),ot=st*nt,lt=rt.target,ut=et.contains(lt),ct=!1,dt=ot>0,pt=0,ft=0;do{var gt=getScrollVariables(tt,lt),_r=gt[0],Yr=gt[1],mt=gt[2],Kr=Yr-mt-st*_r;(_r||Kr)&&elementCouldBeScrolled(tt,lt)&&(pt+=Kr,ft+=_r),lt=lt.parentNode}while(!ut&&lt!==document.body||ut&&(et.contains(lt)||et===lt));return(dt&&(it&&pt===0||!it&&ot>pt)||!dt&&(it&&ft===0||!it&&-ot>ft))&&(ct=!0),ct},getTouchXY=function(tt){return"changedTouches"in tt?[tt.changedTouches[0].clientX,tt.changedTouches[0].clientY]:[0,0]},getDeltaXY=function(tt){return[tt.deltaX,tt.deltaY]},extractRef=function(tt){return tt&&"current"in tt?tt.current:tt},deltaCompare=function(tt,et){return tt[0]===et[0]&&tt[1]===et[1]},generateStyle=function(tt){return`
  .block-interactivity-`.concat(tt,` {pointer-events: none;}
  .allow-interactivity-`).concat(tt,` {pointer-events: all;}
`)},idCounter=0,lockStack=[];function RemoveScrollSideCar(tt){var et=reactExports.useRef([]),rt=reactExports.useRef([0,0]),nt=reactExports.useRef(),it=reactExports.useState(idCounter++)[0],st=reactExports.useState(function(){return styleSingleton()})[0],ot=reactExports.useRef(tt);reactExports.useEffect(function(){ot.current=tt},[tt]),reactExports.useEffect(function(){if(tt.inert){document.body.classList.add("block-interactivity-".concat(it));var Yr=__spreadArray([tt.lockRef.current],(tt.shards||[]).map(extractRef),!0).filter(Boolean);return Yr.forEach(function(mt){return mt.classList.add("allow-interactivity-".concat(it))}),function(){document.body.classList.remove("block-interactivity-".concat(it)),Yr.forEach(function(mt){return mt.classList.remove("allow-interactivity-".concat(it))})}}},[tt.inert,tt.lockRef.current,tt.shards]);var lt=reactExports.useCallback(function(Yr,mt){if("touches"in Yr&&Yr.touches.length===2)return!ot.current.allowPinchZoom;var Kr=getTouchXY(Yr),Xr=rt.current,Zr="deltaX"in Yr?Yr.deltaX:Xr[0]-Kr[0],Qr="deltaY"in Yr?Yr.deltaY:Xr[1]-Kr[1],_i,ns=Yr.target,rs=Math.abs(Zr)>Math.abs(Qr)?"h":"v";if("touches"in Yr&&rs==="h"&&ns.type==="range")return!1;var ss=locationCouldBeScrolled(rs,ns);if(!ss)return!0;if(ss?_i=rs:(_i=rs==="v"?"h":"v",ss=locationCouldBeScrolled(rs,ns)),!ss)return!1;if(!nt.current&&"changedTouches"in Yr&&(Zr||Qr)&&(nt.current=_i),!_i)return!0;var hs=nt.current||_i;return handleScroll(hs,mt,Yr,hs==="h"?Zr:Qr,!0)},[]),ut=reactExports.useCallback(function(Yr){var mt=Yr;if(!(!lockStack.length||lockStack[lockStack.length-1]!==st)){var Kr="deltaY"in mt?getDeltaXY(mt):getTouchXY(mt),Xr=et.current.filter(function(_i){return _i.name===mt.type&&_i.target===mt.target&&deltaCompare(_i.delta,Kr)})[0];if(Xr&&Xr.should){mt.cancelable&&mt.preventDefault();return}if(!Xr){var Zr=(ot.current.shards||[]).map(extractRef).filter(Boolean).filter(function(_i){return _i.contains(mt.target)}),Qr=Zr.length>0?lt(mt,Zr[0]):!ot.current.noIsolation;Qr&&mt.cancelable&&mt.preventDefault()}}},[]),ct=reactExports.useCallback(function(Yr,mt,Kr,Xr){var Zr={name:Yr,delta:mt,target:Kr,should:Xr};et.current.push(Zr),setTimeout(function(){et.current=et.current.filter(function(Qr){return Qr!==Zr})},1)},[]),dt=reactExports.useCallback(function(Yr){rt.current=getTouchXY(Yr),nt.current=void 0},[]),pt=reactExports.useCallback(function(Yr){ct(Yr.type,getDeltaXY(Yr),Yr.target,lt(Yr,tt.lockRef.current))},[]),ft=reactExports.useCallback(function(Yr){ct(Yr.type,getTouchXY(Yr),Yr.target,lt(Yr,tt.lockRef.current))},[]);reactExports.useEffect(function(){return lockStack.push(st),tt.setCallbacks({onScrollCapture:pt,onWheelCapture:pt,onTouchMoveCapture:ft}),document.addEventListener("wheel",ut,nonPassive),document.addEventListener("touchmove",ut,nonPassive),document.addEventListener("touchstart",dt,nonPassive),function(){lockStack=lockStack.filter(function(Yr){return Yr!==st}),document.removeEventListener("wheel",ut,nonPassive),document.removeEventListener("touchmove",ut,nonPassive),document.removeEventListener("touchstart",dt,nonPassive)}},[]);var gt=tt.removeScrollBar,_r=tt.inert;return reactExports.createElement(reactExports.Fragment,null,_r?reactExports.createElement(st,{styles:generateStyle(it)}):null,gt?reactExports.createElement(RemoveScrollBar,{gapMode:"margin"}):null)}const SideCar=exportSidecar(effectCar,RemoveScrollSideCar);var ReactRemoveScroll=reactExports.forwardRef(function(tt,et){return reactExports.createElement(RemoveScroll,__assign({},tt,{ref:et,sideCar:SideCar}))});ReactRemoveScroll.classNames=RemoveScroll.classNames;const $01b9c$RemoveScroll=ReactRemoveScroll,$cb5cc270b50c6fcd$var$POPOVER_NAME="Popover",[$cb5cc270b50c6fcd$var$createPopoverContext,$cb5cc270b50c6fcd$export$c8393c9e73286932]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($cb5cc270b50c6fcd$var$POPOVER_NAME,[$cf1ac5d9fe0e8206$export$722aac194ae923]),$cb5cc270b50c6fcd$var$usePopperScope=$cf1ac5d9fe0e8206$export$722aac194ae923(),[$cb5cc270b50c6fcd$var$PopoverProvider,$cb5cc270b50c6fcd$var$usePopoverContext]=$cb5cc270b50c6fcd$var$createPopoverContext($cb5cc270b50c6fcd$var$POPOVER_NAME),$cb5cc270b50c6fcd$export$5b6b19405a83ff9d=tt=>{const{__scopePopover:et,children:rt,open:nt,defaultOpen:it,onOpenChange:st,modal:ot=!1}=tt,lt=$cb5cc270b50c6fcd$var$usePopperScope(et),ut=reactExports.useRef(null),[ct,dt]=reactExports.useState(!1),[pt=!1,ft]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:nt,defaultProp:it,onChange:st});return reactExports.createElement($cf1ac5d9fe0e8206$export$be92b6f5f03c0fe9,lt,reactExports.createElement($cb5cc270b50c6fcd$var$PopoverProvider,{scope:et,contentId:$1746a345f3d73bb7$export$f680877a34711e37(),triggerRef:ut,open:pt,onOpenChange:ft,onOpenToggle:reactExports.useCallback(()=>ft(gt=>!gt),[ft]),hasCustomAnchor:ct,onCustomAnchorAdd:reactExports.useCallback(()=>dt(!0),[]),onCustomAnchorRemove:reactExports.useCallback(()=>dt(!1),[]),modal:ot},rt))},$cb5cc270b50c6fcd$var$TRIGGER_NAME="PopoverTrigger",$cb5cc270b50c6fcd$export$7dacb05d26466c3=reactExports.forwardRef((tt,et)=>{const{__scopePopover:rt,...nt}=tt,it=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$TRIGGER_NAME,rt),st=$cb5cc270b50c6fcd$var$usePopperScope(rt),ot=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,it.triggerRef),lt=reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button","aria-haspopup":"dialog","aria-expanded":it.open,"aria-controls":it.contentId,"data-state":$cb5cc270b50c6fcd$var$getState(it.open)},nt,{ref:ot,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onClick,it.onOpenToggle)}));return it.hasCustomAnchor?lt:reactExports.createElement($cf1ac5d9fe0e8206$export$b688253958b8dfe7,_extends$1({asChild:!0},st),lt)}),$cb5cc270b50c6fcd$var$PORTAL_NAME="PopoverPortal",[$cb5cc270b50c6fcd$var$PortalProvider,$cb5cc270b50c6fcd$var$usePortalContext]=$cb5cc270b50c6fcd$var$createPopoverContext($cb5cc270b50c6fcd$var$PORTAL_NAME,{forceMount:void 0}),$cb5cc270b50c6fcd$var$CONTENT_NAME="PopoverContent",$cb5cc270b50c6fcd$export$d7e1f420b25549ff=reactExports.forwardRef((tt,et)=>{const rt=$cb5cc270b50c6fcd$var$usePortalContext($cb5cc270b50c6fcd$var$CONTENT_NAME,tt.__scopePopover),{forceMount:nt=rt.forceMount,...it}=tt,st=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$CONTENT_NAME,tt.__scopePopover);return reactExports.createElement($921a889cee6df7e8$export$99c2b779aa4e8b8b,{present:nt||st.open},st.modal?reactExports.createElement($cb5cc270b50c6fcd$var$PopoverContentModal,_extends$1({},it,{ref:et})):reactExports.createElement($cb5cc270b50c6fcd$var$PopoverContentNonModal,_extends$1({},it,{ref:et})))}),$cb5cc270b50c6fcd$var$PopoverContentModal=reactExports.forwardRef((tt,et)=>{const rt=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$CONTENT_NAME,tt.__scopePopover),nt=reactExports.useRef(null),it=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,nt),st=reactExports.useRef(!1);return reactExports.useEffect(()=>{const ot=nt.current;if(ot)return hideOthers(ot)},[]),reactExports.createElement($01b9c$RemoveScroll,{as:$5e63c961fc1ce211$export$8c6ed5c666ac1360,allowPinchZoom:!0},reactExports.createElement($cb5cc270b50c6fcd$var$PopoverContentImpl,_extends$1({},tt,{ref:it,trapFocus:rt.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onCloseAutoFocus,ot=>{var lt;ot.preventDefault(),st.current||(lt=rt.triggerRef.current)===null||lt===void 0||lt.focus()}),onPointerDownOutside:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onPointerDownOutside,ot=>{const lt=ot.detail.originalEvent,ut=lt.button===0&&lt.ctrlKey===!0,ct=lt.button===2||ut;st.current=ct},{checkForDefaultPrevented:!1}),onFocusOutside:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onFocusOutside,ot=>ot.preventDefault(),{checkForDefaultPrevented:!1})})))}),$cb5cc270b50c6fcd$var$PopoverContentNonModal=reactExports.forwardRef((tt,et)=>{const rt=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$CONTENT_NAME,tt.__scopePopover),nt=reactExports.useRef(!1),it=reactExports.useRef(!1);return reactExports.createElement($cb5cc270b50c6fcd$var$PopoverContentImpl,_extends$1({},tt,{ref:et,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:st=>{var ot;if((ot=tt.onCloseAutoFocus)===null||ot===void 0||ot.call(tt,st),!st.defaultPrevented){var lt;nt.current||(lt=rt.triggerRef.current)===null||lt===void 0||lt.focus(),st.preventDefault()}nt.current=!1,it.current=!1},onInteractOutside:st=>{var ot,lt;(ot=tt.onInteractOutside)===null||ot===void 0||ot.call(tt,st),st.defaultPrevented||(nt.current=!0,st.detail.originalEvent.type==="pointerdown"&&(it.current=!0));const ut=st.target;((lt=rt.triggerRef.current)===null||lt===void 0?void 0:lt.contains(ut))&&st.preventDefault(),st.detail.originalEvent.type==="focusin"&&it.current&&st.preventDefault()}}))}),$cb5cc270b50c6fcd$var$PopoverContentImpl=reactExports.forwardRef((tt,et)=>{const{__scopePopover:rt,trapFocus:nt,onOpenAutoFocus:it,onCloseAutoFocus:st,disableOutsidePointerEvents:ot,onEscapeKeyDown:lt,onPointerDownOutside:ut,onFocusOutside:ct,onInteractOutside:dt,...pt}=tt,ft=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$CONTENT_NAME,rt),gt=$cb5cc270b50c6fcd$var$usePopperScope(rt);return $3db38b7d1fb3fe6a$export$b7ece24a22aeda8c(),reactExports.createElement($d3863c46a17e8a28$export$20e40289641fbbb6,{asChild:!0,loop:!0,trapped:nt,onMountAutoFocus:it,onUnmountAutoFocus:st},reactExports.createElement($5cb92bef7577960e$export$177fb62ff3ec1f22,{asChild:!0,disableOutsidePointerEvents:ot,onInteractOutside:dt,onEscapeKeyDown:lt,onPointerDownOutside:ut,onFocusOutside:ct,onDismiss:()=>ft.onOpenChange(!1)},reactExports.createElement($cf1ac5d9fe0e8206$export$7c6e2c02157bb7d2,_extends$1({"data-state":$cb5cc270b50c6fcd$var$getState(ft.open),role:"dialog",id:ft.contentId},gt,pt,{ref:et,style:{...pt.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}}))))}),$cb5cc270b50c6fcd$var$CLOSE_NAME="PopoverClose",$cb5cc270b50c6fcd$export$d6ac43ebaa40d53e=reactExports.forwardRef((tt,et)=>{const{__scopePopover:rt,...nt}=tt,it=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$CLOSE_NAME,rt);return reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button"},nt,{ref:et,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onClick,()=>it.onOpenChange(!1))}))}),$cb5cc270b50c6fcd$export$3152841115e061b2=reactExports.forwardRef((tt,et)=>{const{__scopePopover:rt,...nt}=tt,it=$cb5cc270b50c6fcd$var$usePopperScope(rt);return reactExports.createElement($cf1ac5d9fe0e8206$export$21b07c8f274aebd5,_extends$1({},it,nt,{ref:et}))});function $cb5cc270b50c6fcd$var$getState(tt){return tt?"open":"closed"}const $cb5cc270b50c6fcd$export$be92b6f5f03c0fe9=$cb5cc270b50c6fcd$export$5b6b19405a83ff9d,$cb5cc270b50c6fcd$export$41fb9f06171c75f4=$cb5cc270b50c6fcd$export$7dacb05d26466c3,$cb5cc270b50c6fcd$export$7c6e2c02157bb7d2=$cb5cc270b50c6fcd$export$d7e1f420b25549ff,$cb5cc270b50c6fcd$export$f39c2d165cd861fe=$cb5cc270b50c6fcd$export$d6ac43ebaa40d53e,$cb5cc270b50c6fcd$export$21b07c8f274aebd5=$cb5cc270b50c6fcd$export$3152841115e061b2;function $ae6933e535247d3d$export$7d15b64cf5a3a4c4(tt,[et,rt]){return Math.min(rt,Math.max(et,tt))}const $ea1ef594cf570d83$export$439d29a4e110a164=reactExports.forwardRef((tt,et)=>reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({},tt,{ref:et,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...tt.style}}))),$cc7e05a45900e73f$var$OPEN_KEYS=[" ","Enter","ArrowUp","ArrowDown"],$cc7e05a45900e73f$var$SELECTION_KEYS=[" ","Enter"],$cc7e05a45900e73f$var$SELECT_NAME="Select",[$cc7e05a45900e73f$var$Collection,$cc7e05a45900e73f$var$useCollection,$cc7e05a45900e73f$var$createCollectionScope]=$e02a7d9cb1dc128c$export$c74125a8e3af6bb2($cc7e05a45900e73f$var$SELECT_NAME),[$cc7e05a45900e73f$var$createSelectContext,$cc7e05a45900e73f$export$286727a75dc039bd]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($cc7e05a45900e73f$var$SELECT_NAME,[$cc7e05a45900e73f$var$createCollectionScope,$cf1ac5d9fe0e8206$export$722aac194ae923]),$cc7e05a45900e73f$var$usePopperScope=$cf1ac5d9fe0e8206$export$722aac194ae923(),[$cc7e05a45900e73f$var$SelectProvider,$cc7e05a45900e73f$var$useSelectContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$SELECT_NAME),[$cc7e05a45900e73f$var$SelectNativeOptionsProvider,$cc7e05a45900e73f$var$useSelectNativeOptionsContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$SELECT_NAME),$cc7e05a45900e73f$export$ef9b1a59e592288f=tt=>{const{__scopeSelect:et,children:rt,open:nt,defaultOpen:it,onOpenChange:st,value:ot,defaultValue:lt,onValueChange:ut,dir:ct,name:dt,autoComplete:pt,disabled:ft,required:gt}=tt,_r=$cc7e05a45900e73f$var$usePopperScope(et),[Yr,mt]=reactExports.useState(null),[Kr,Xr]=reactExports.useState(null),[Zr,Qr]=reactExports.useState(!1),_i=$f631663db3294ace$export$b39126d51d94e6f3(ct),[ns=!1,rs]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:nt,defaultProp:it,onChange:st}),[ss,hs]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:ot,defaultProp:lt,onChange:ut}),os=reactExports.useRef(null),is=Yr?!!Yr.closest("form"):!0,[cs,ps]=reactExports.useState(new Set),vs=Array.from(cs).map(ls=>ls.props.value).join(";");return reactExports.createElement($cf1ac5d9fe0e8206$export$be92b6f5f03c0fe9,_r,reactExports.createElement($cc7e05a45900e73f$var$SelectProvider,{required:gt,scope:et,trigger:Yr,onTriggerChange:mt,valueNode:Kr,onValueNodeChange:Xr,valueNodeHasChildren:Zr,onValueNodeHasChildrenChange:Qr,contentId:$1746a345f3d73bb7$export$f680877a34711e37(),value:ss,onValueChange:hs,open:ns,onOpenChange:rs,dir:_i,triggerPointerDownPosRef:os,disabled:ft},reactExports.createElement($cc7e05a45900e73f$var$Collection.Provider,{scope:et},reactExports.createElement($cc7e05a45900e73f$var$SelectNativeOptionsProvider,{scope:tt.__scopeSelect,onNativeOptionAdd:reactExports.useCallback(ls=>{ps(ms=>new Set(ms).add(ls))},[]),onNativeOptionRemove:reactExports.useCallback(ls=>{ps(ms=>{const us=new Set(ms);return us.delete(ls),us})},[])},rt)),is?reactExports.createElement($cc7e05a45900e73f$var$BubbleSelect,{key:vs,"aria-hidden":!0,required:gt,tabIndex:-1,name:dt,autoComplete:pt,value:ss,onChange:ls=>hs(ls.target.value),disabled:ft},ss===void 0?reactExports.createElement("option",{value:""}):null,Array.from(cs)):null))},$cc7e05a45900e73f$var$TRIGGER_NAME="SelectTrigger",$cc7e05a45900e73f$export$3ac1e88a1c0b9f1=reactExports.forwardRef((tt,et)=>{const{__scopeSelect:rt,disabled:nt=!1,...it}=tt,st=$cc7e05a45900e73f$var$usePopperScope(rt),ot=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$TRIGGER_NAME,rt),lt=ot.disabled||nt,ut=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,ot.onTriggerChange),ct=$cc7e05a45900e73f$var$useCollection(rt),[dt,pt,ft]=$cc7e05a45900e73f$var$useTypeaheadSearch(_r=>{const Yr=ct().filter(Xr=>!Xr.disabled),mt=Yr.find(Xr=>Xr.value===ot.value),Kr=$cc7e05a45900e73f$var$findNextItem(Yr,_r,mt);Kr!==void 0&&ot.onValueChange(Kr.value)}),gt=()=>{lt||(ot.onOpenChange(!0),ft())};return reactExports.createElement($cf1ac5d9fe0e8206$export$b688253958b8dfe7,_extends$1({asChild:!0},st),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button",role:"combobox","aria-controls":ot.contentId,"aria-expanded":ot.open,"aria-required":ot.required,"aria-autocomplete":"none",dir:ot.dir,"data-state":ot.open?"open":"closed",disabled:lt,"data-disabled":lt?"":void 0,"data-placeholder":$cc7e05a45900e73f$var$shouldShowPlaceholder(ot.value)?"":void 0},it,{ref:ut,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(it.onClick,_r=>{_r.currentTarget.focus()}),onPointerDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(it.onPointerDown,_r=>{const Yr=_r.target;Yr.hasPointerCapture(_r.pointerId)&&Yr.releasePointerCapture(_r.pointerId),_r.button===0&&_r.ctrlKey===!1&&(gt(),ot.triggerPointerDownPosRef.current={x:Math.round(_r.pageX),y:Math.round(_r.pageY)},_r.preventDefault())}),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(it.onKeyDown,_r=>{const Yr=dt.current!=="";!(_r.ctrlKey||_r.altKey||_r.metaKey)&&_r.key.length===1&&pt(_r.key),!(Yr&&_r.key===" ")&&$cc7e05a45900e73f$var$OPEN_KEYS.includes(_r.key)&&(gt(),_r.preventDefault())})})))}),$cc7e05a45900e73f$var$VALUE_NAME="SelectValue",$cc7e05a45900e73f$export$e288731fd71264f0=reactExports.forwardRef((tt,et)=>{const{__scopeSelect:rt,className:nt,style:it,children:st,placeholder:ot="",...lt}=tt,ut=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$VALUE_NAME,rt),{onValueNodeHasChildrenChange:ct}=ut,dt=st!==void 0,pt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,ut.onValueNodeChange);return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{ct(dt)},[ct,dt]),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({},lt,{ref:pt,style:{pointerEvents:"none"}}),$cc7e05a45900e73f$var$shouldShowPlaceholder(ut.value)?reactExports.createElement(reactExports.Fragment,null,ot):st)}),$cc7e05a45900e73f$export$99b400cabb58c515=reactExports.forwardRef((tt,et)=>{const{__scopeSelect:rt,children:nt,...it}=tt;return reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({"aria-hidden":!0},it,{ref:et}),nt||"")}),$cc7e05a45900e73f$export$b2af6c9944296213=tt=>reactExports.createElement($f1701beae083dbae$export$602eac185826482c,_extends$1({asChild:!0},tt)),$cc7e05a45900e73f$var$CONTENT_NAME="SelectContent",$cc7e05a45900e73f$export$c973a4b3cb86a03d=reactExports.forwardRef((tt,et)=>{const rt=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$CONTENT_NAME,tt.__scopeSelect),[nt,it]=reactExports.useState();if($9f79659886946c16$export$e5c5a5f917a5871c(()=>{it(new DocumentFragment)},[]),!rt.open){const st=nt;return st?reactDomExports.createPortal(reactExports.createElement($cc7e05a45900e73f$var$SelectContentProvider,{scope:tt.__scopeSelect},reactExports.createElement($cc7e05a45900e73f$var$Collection.Slot,{scope:tt.__scopeSelect},reactExports.createElement("div",null,tt.children))),st):null}return reactExports.createElement($cc7e05a45900e73f$var$SelectContentImpl,_extends$1({},tt,{ref:et}))}),$cc7e05a45900e73f$var$CONTENT_MARGIN=10,[$cc7e05a45900e73f$var$SelectContentProvider,$cc7e05a45900e73f$var$useSelectContentContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$CONTENT_NAME),$cc7e05a45900e73f$var$SelectContentImpl=reactExports.forwardRef((tt,et)=>{const{__scopeSelect:rt,position:nt="item-aligned",onCloseAutoFocus:it,onEscapeKeyDown:st,onPointerDownOutside:ot,side:lt,sideOffset:ut,align:ct,alignOffset:dt,arrowPadding:pt,collisionBoundary:ft,collisionPadding:gt,sticky:_r,hideWhenDetached:Yr,avoidCollisions:mt,...Kr}=tt,Xr=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$CONTENT_NAME,rt),[Zr,Qr]=reactExports.useState(null),[_i,ns]=reactExports.useState(null),rs=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,As=>Qr(As)),[ss,hs]=reactExports.useState(null),[os,is]=reactExports.useState(null),cs=$cc7e05a45900e73f$var$useCollection(rt),[ps,vs]=reactExports.useState(!1),ls=reactExports.useRef(!1);reactExports.useEffect(()=>{if(Zr)return hideOthers(Zr)},[Zr]),$3db38b7d1fb3fe6a$export$b7ece24a22aeda8c();const ms=reactExports.useCallback(As=>{const[Os,...Ys]=cs().map(Ws=>Ws.ref.current),[Vs]=Ys.slice(-1),js=document.activeElement;for(const Ws of As)if(Ws===js||(Ws==null||Ws.scrollIntoView({block:"nearest"}),Ws===Os&&_i&&(_i.scrollTop=0),Ws===Vs&&_i&&(_i.scrollTop=_i.scrollHeight),Ws==null||Ws.focus(),document.activeElement!==js))return},[cs,_i]),us=reactExports.useCallback(()=>ms([ss,Zr]),[ms,ss,Zr]);reactExports.useEffect(()=>{ps&&us()},[ps,us]);const{onOpenChange:gs,triggerPointerDownPosRef:ys}=Xr;reactExports.useEffect(()=>{if(Zr){let As={x:0,y:0};const Os=Vs=>{var js,Ws,Jr,as;As={x:Math.abs(Math.round(Vs.pageX)-((js=(Ws=ys.current)===null||Ws===void 0?void 0:Ws.x)!==null&&js!==void 0?js:0)),y:Math.abs(Math.round(Vs.pageY)-((Jr=(as=ys.current)===null||as===void 0?void 0:as.y)!==null&&Jr!==void 0?Jr:0))}},Ys=Vs=>{As.x<=10&&As.y<=10?Vs.preventDefault():Zr.contains(Vs.target)||gs(!1),document.removeEventListener("pointermove",Os),ys.current=null};return ys.current!==null&&(document.addEventListener("pointermove",Os),document.addEventListener("pointerup",Ys,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Os),document.removeEventListener("pointerup",Ys,{capture:!0})}}},[Zr,gs,ys]),reactExports.useEffect(()=>{const As=()=>gs(!1);return window.addEventListener("blur",As),window.addEventListener("resize",As),()=>{window.removeEventListener("blur",As),window.removeEventListener("resize",As)}},[gs]);const[Es,Ss]=$cc7e05a45900e73f$var$useTypeaheadSearch(As=>{const Os=cs().filter(js=>!js.disabled),Ys=Os.find(js=>js.ref.current===document.activeElement),Vs=$cc7e05a45900e73f$var$findNextItem(Os,As,Ys);Vs&&setTimeout(()=>Vs.ref.current.focus())}),Ts=reactExports.useCallback((As,Os,Ys)=>{const Vs=!ls.current&&!Ys;(Xr.value!==void 0&&Xr.value===Os||Vs)&&(hs(As),Vs&&(ls.current=!0))},[Xr.value]),Ds=reactExports.useCallback(()=>Zr==null?void 0:Zr.focus(),[Zr]),Rs=reactExports.useCallback((As,Os,Ys)=>{const Vs=!ls.current&&!Ys;(Xr.value!==void 0&&Xr.value===Os||Vs)&&is(As)},[Xr.value]),Is=nt==="popper"?$cc7e05a45900e73f$var$SelectPopperPosition:$cc7e05a45900e73f$var$SelectItemAlignedPosition,ks=Is===$cc7e05a45900e73f$var$SelectPopperPosition?{side:lt,sideOffset:ut,align:ct,alignOffset:dt,arrowPadding:pt,collisionBoundary:ft,collisionPadding:gt,sticky:_r,hideWhenDetached:Yr,avoidCollisions:mt}:{};return reactExports.createElement($cc7e05a45900e73f$var$SelectContentProvider,{scope:rt,content:Zr,viewport:_i,onViewportChange:ns,itemRefCallback:Ts,selectedItem:ss,onItemLeave:Ds,itemTextRefCallback:Rs,focusSelectedItem:us,selectedItemText:os,position:nt,isPositioned:ps,searchRef:Es},reactExports.createElement($01b9c$RemoveScroll,{as:$5e63c961fc1ce211$export$8c6ed5c666ac1360,allowPinchZoom:!0},reactExports.createElement($d3863c46a17e8a28$export$20e40289641fbbb6,{asChild:!0,trapped:Xr.open,onMountAutoFocus:As=>{As.preventDefault()},onUnmountAutoFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(it,As=>{var Os;(Os=Xr.trigger)===null||Os===void 0||Os.focus({preventScroll:!0}),As.preventDefault()})},reactExports.createElement($5cb92bef7577960e$export$177fb62ff3ec1f22,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:st,onPointerDownOutside:ot,onFocusOutside:As=>As.preventDefault(),onDismiss:()=>Xr.onOpenChange(!1)},reactExports.createElement(Is,_extends$1({role:"listbox",id:Xr.contentId,"data-state":Xr.open?"open":"closed",dir:Xr.dir,onContextMenu:As=>As.preventDefault()},Kr,ks,{onPlaced:()=>vs(!0),ref:rs,style:{display:"flex",flexDirection:"column",outline:"none",...Kr.style},onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(Kr.onKeyDown,As=>{const Os=As.ctrlKey||As.altKey||As.metaKey;if(As.key==="Tab"&&As.preventDefault(),!Os&&As.key.length===1&&Ss(As.key),["ArrowUp","ArrowDown","Home","End"].includes(As.key)){let Vs=cs().filter(js=>!js.disabled).map(js=>js.ref.current);if(["ArrowUp","End"].includes(As.key)&&(Vs=Vs.slice().reverse()),["ArrowUp","ArrowDown"].includes(As.key)){const js=As.target,Ws=Vs.indexOf(js);Vs=Vs.slice(Ws+1)}setTimeout(()=>ms(Vs)),As.preventDefault()}})}))))))}),$cc7e05a45900e73f$var$SelectItemAlignedPosition=reactExports.forwardRef((tt,et)=>{const{__scopeSelect:rt,onPlaced:nt,...it}=tt,st=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$CONTENT_NAME,rt),ot=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$CONTENT_NAME,rt),[lt,ut]=reactExports.useState(null),[ct,dt]=reactExports.useState(null),pt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,rs=>dt(rs)),ft=$cc7e05a45900e73f$var$useCollection(rt),gt=reactExports.useRef(!1),_r=reactExports.useRef(!0),{viewport:Yr,selectedItem:mt,selectedItemText:Kr,focusSelectedItem:Xr}=ot,Zr=reactExports.useCallback(()=>{if(st.trigger&&st.valueNode&&lt&&ct&&Yr&&mt&&Kr){const rs=st.trigger.getBoundingClientRect(),ss=ct.getBoundingClientRect(),hs=st.valueNode.getBoundingClientRect(),os=Kr.getBoundingClientRect();if(st.dir!=="rtl"){const js=os.left-ss.left,Ws=hs.left-js,Jr=rs.left-Ws,as=rs.width+Jr,xs=Math.max(as,ss.width),bs=window.innerWidth-$cc7e05a45900e73f$var$CONTENT_MARGIN,ws=$ae6933e535247d3d$export$7d15b64cf5a3a4c4(Ws,[$cc7e05a45900e73f$var$CONTENT_MARGIN,bs-xs]);lt.style.minWidth=as+"px",lt.style.left=ws+"px"}else{const js=ss.right-os.right,Ws=window.innerWidth-hs.right-js,Jr=window.innerWidth-rs.right-Ws,as=rs.width+Jr,xs=Math.max(as,ss.width),bs=window.innerWidth-$cc7e05a45900e73f$var$CONTENT_MARGIN,ws=$ae6933e535247d3d$export$7d15b64cf5a3a4c4(Ws,[$cc7e05a45900e73f$var$CONTENT_MARGIN,bs-xs]);lt.style.minWidth=as+"px",lt.style.right=ws+"px"}const is=ft(),cs=window.innerHeight-$cc7e05a45900e73f$var$CONTENT_MARGIN*2,ps=Yr.scrollHeight,vs=window.getComputedStyle(ct),ls=parseInt(vs.borderTopWidth,10),ms=parseInt(vs.paddingTop,10),us=parseInt(vs.borderBottomWidth,10),gs=parseInt(vs.paddingBottom,10),ys=ls+ms+ps+gs+us,Es=Math.min(mt.offsetHeight*5,ys),Ss=window.getComputedStyle(Yr),Ts=parseInt(Ss.paddingTop,10),Ds=parseInt(Ss.paddingBottom,10),Rs=rs.top+rs.height/2-$cc7e05a45900e73f$var$CONTENT_MARGIN,Is=cs-Rs,ks=mt.offsetHeight/2,As=mt.offsetTop+ks,Os=ls+ms+As,Ys=ys-Os;if(Os<=Rs){const js=mt===is[is.length-1].ref.current;lt.style.bottom="0px";const Ws=ct.clientHeight-Yr.offsetTop-Yr.offsetHeight,Jr=Math.max(Is,ks+(js?Ds:0)+Ws+us),as=Os+Jr;lt.style.height=as+"px"}else{const js=mt===is[0].ref.current;lt.style.top="0px";const Jr=Math.max(Rs,ls+Yr.offsetTop+(js?Ts:0)+ks)+Ys;lt.style.height=Jr+"px",Yr.scrollTop=Os-Rs+Yr.offsetTop}lt.style.margin=`${$cc7e05a45900e73f$var$CONTENT_MARGIN}px 0`,lt.style.minHeight=Es+"px",lt.style.maxHeight=cs+"px",nt==null||nt(),requestAnimationFrame(()=>gt.current=!0)}},[ft,st.trigger,st.valueNode,lt,ct,Yr,mt,Kr,st.dir,nt]);$9f79659886946c16$export$e5c5a5f917a5871c(()=>Zr(),[Zr]);const[Qr,_i]=reactExports.useState();$9f79659886946c16$export$e5c5a5f917a5871c(()=>{ct&&_i(window.getComputedStyle(ct).zIndex)},[ct]);const ns=reactExports.useCallback(rs=>{rs&&_r.current===!0&&(Zr(),Xr==null||Xr(),_r.current=!1)},[Zr,Xr]);return reactExports.createElement($cc7e05a45900e73f$var$SelectViewportProvider,{scope:rt,contentWrapper:lt,shouldExpandOnScrollRef:gt,onScrollButtonChange:ns},reactExports.createElement("div",{ref:ut,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:Qr}},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({},it,{ref:pt,style:{boxSizing:"border-box",maxHeight:"100%",...it.style}}))))}),$cc7e05a45900e73f$var$SelectPopperPosition=reactExports.forwardRef((tt,et)=>{const{__scopeSelect:rt,align:nt="start",collisionPadding:it=$cc7e05a45900e73f$var$CONTENT_MARGIN,...st}=tt,ot=$cc7e05a45900e73f$var$usePopperScope(rt);return reactExports.createElement($cf1ac5d9fe0e8206$export$7c6e2c02157bb7d2,_extends$1({},ot,st,{ref:et,align:nt,collisionPadding:it,style:{boxSizing:"border-box",...st.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}}))}),[$cc7e05a45900e73f$var$SelectViewportProvider,$cc7e05a45900e73f$var$useSelectViewportContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$CONTENT_NAME,{}),$cc7e05a45900e73f$var$VIEWPORT_NAME="SelectViewport",$cc7e05a45900e73f$export$9ed6e7b40248d36d=reactExports.forwardRef((tt,et)=>{const{__scopeSelect:rt,...nt}=tt,it=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$VIEWPORT_NAME,rt),st=$cc7e05a45900e73f$var$useSelectViewportContext($cc7e05a45900e73f$var$VIEWPORT_NAME,rt),ot=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,it.onViewportChange),lt=reactExports.useRef(0);return reactExports.createElement(reactExports.Fragment,null,reactExports.createElement("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"}}),reactExports.createElement($cc7e05a45900e73f$var$Collection.Slot,{scope:rt},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"data-radix-select-viewport":"",role:"presentation"},nt,{ref:ot,style:{position:"relative",flex:1,overflow:"auto",...nt.style},onScroll:$e42e1063c40fb3ef$export$b9ecd428b558ff10(nt.onScroll,ut=>{const ct=ut.currentTarget,{contentWrapper:dt,shouldExpandOnScrollRef:pt}=st;if(pt!=null&&pt.current&&dt){const ft=Math.abs(lt.current-ct.scrollTop);if(ft>0){const gt=window.innerHeight-$cc7e05a45900e73f$var$CONTENT_MARGIN*2,_r=parseFloat(dt.style.minHeight),Yr=parseFloat(dt.style.height),mt=Math.max(_r,Yr);if(mt<gt){const Kr=mt+ft,Xr=Math.min(gt,Kr),Zr=Kr-Xr;dt.style.height=Xr+"px",dt.style.bottom==="0px"&&(ct.scrollTop=Zr>0?Zr:0,dt.style.justifyContent="flex-end")}}}lt.current=ct.scrollTop})}))))}),$cc7e05a45900e73f$var$GROUP_NAME="SelectGroup",[$cc7e05a45900e73f$var$SelectGroupContextProvider,$cc7e05a45900e73f$var$useSelectGroupContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$GROUP_NAME),$cc7e05a45900e73f$export$ee25a334c55de1f4=reactExports.forwardRef((tt,et)=>{const{__scopeSelect:rt,...nt}=tt,it=$1746a345f3d73bb7$export$f680877a34711e37();return reactExports.createElement($cc7e05a45900e73f$var$SelectGroupContextProvider,{scope:rt,id:it},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({role:"group","aria-labelledby":it},nt,{ref:et})))}),$cc7e05a45900e73f$var$LABEL_NAME="SelectLabel",$cc7e05a45900e73f$export$f67338d29bd972f8=reactExports.forwardRef((tt,et)=>{const{__scopeSelect:rt,...nt}=tt,it=$cc7e05a45900e73f$var$useSelectGroupContext($cc7e05a45900e73f$var$LABEL_NAME,rt);return reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({id:it.id},nt,{ref:et}))}),$cc7e05a45900e73f$var$ITEM_NAME="SelectItem",[$cc7e05a45900e73f$var$SelectItemContextProvider,$cc7e05a45900e73f$var$useSelectItemContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$ITEM_NAME),$cc7e05a45900e73f$export$13ef48a934230896=reactExports.forwardRef((tt,et)=>{const{__scopeSelect:rt,value:nt,disabled:it=!1,textValue:st,...ot}=tt,lt=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$ITEM_NAME,rt),ut=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$ITEM_NAME,rt),ct=lt.value===nt,[dt,pt]=reactExports.useState(st??""),[ft,gt]=reactExports.useState(!1),_r=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,Kr=>{var Xr;return(Xr=ut.itemRefCallback)===null||Xr===void 0?void 0:Xr.call(ut,Kr,nt,it)}),Yr=$1746a345f3d73bb7$export$f680877a34711e37(),mt=()=>{it||(lt.onValueChange(nt),lt.onOpenChange(!1))};if(nt==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return reactExports.createElement($cc7e05a45900e73f$var$SelectItemContextProvider,{scope:rt,value:nt,disabled:it,textId:Yr,isSelected:ct,onItemTextChange:reactExports.useCallback(Kr=>{pt(Xr=>{var Zr;return Xr||((Zr=Kr==null?void 0:Kr.textContent)!==null&&Zr!==void 0?Zr:"").trim()})},[])},reactExports.createElement($cc7e05a45900e73f$var$Collection.ItemSlot,{scope:rt,value:nt,disabled:it,textValue:dt},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({role:"option","aria-labelledby":Yr,"data-highlighted":ft?"":void 0,"aria-selected":ct&&ft,"data-state":ct?"checked":"unchecked","aria-disabled":it||void 0,"data-disabled":it?"":void 0,tabIndex:it?void 0:-1},ot,{ref:_r,onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ot.onFocus,()=>gt(!0)),onBlur:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ot.onBlur,()=>gt(!1)),onPointerUp:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ot.onPointerUp,mt),onPointerMove:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ot.onPointerMove,Kr=>{if(it){var Xr;(Xr=ut.onItemLeave)===null||Xr===void 0||Xr.call(ut)}else Kr.currentTarget.focus({preventScroll:!0})}),onPointerLeave:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ot.onPointerLeave,Kr=>{if(Kr.currentTarget===document.activeElement){var Xr;(Xr=ut.onItemLeave)===null||Xr===void 0||Xr.call(ut)}}),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ot.onKeyDown,Kr=>{var Xr;((Xr=ut.searchRef)===null||Xr===void 0?void 0:Xr.current)!==""&&Kr.key===" "||($cc7e05a45900e73f$var$SELECTION_KEYS.includes(Kr.key)&&mt(),Kr.key===" "&&Kr.preventDefault())})}))))}),$cc7e05a45900e73f$var$ITEM_TEXT_NAME="SelectItemText",$cc7e05a45900e73f$export$3572fb0fb821ff49=reactExports.forwardRef((tt,et)=>{const{__scopeSelect:rt,className:nt,style:it,...st}=tt,ot=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$ITEM_TEXT_NAME,rt),lt=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$ITEM_TEXT_NAME,rt),ut=$cc7e05a45900e73f$var$useSelectItemContext($cc7e05a45900e73f$var$ITEM_TEXT_NAME,rt),ct=$cc7e05a45900e73f$var$useSelectNativeOptionsContext($cc7e05a45900e73f$var$ITEM_TEXT_NAME,rt),[dt,pt]=reactExports.useState(null),ft=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,Kr=>pt(Kr),ut.onItemTextChange,Kr=>{var Xr;return(Xr=lt.itemTextRefCallback)===null||Xr===void 0?void 0:Xr.call(lt,Kr,ut.value,ut.disabled)}),gt=dt==null?void 0:dt.textContent,_r=reactExports.useMemo(()=>reactExports.createElement("option",{key:ut.value,value:ut.value,disabled:ut.disabled},gt),[ut.disabled,ut.value,gt]),{onNativeOptionAdd:Yr,onNativeOptionRemove:mt}=ct;return $9f79659886946c16$export$e5c5a5f917a5871c(()=>(Yr(_r),()=>mt(_r)),[Yr,mt,_r]),reactExports.createElement(reactExports.Fragment,null,reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({id:ut.textId},st,{ref:ft})),ut.isSelected&&ot.valueNode&&!ot.valueNodeHasChildren?reactDomExports.createPortal(st.children,ot.valueNode):null)}),$cc7e05a45900e73f$var$ITEM_INDICATOR_NAME="SelectItemIndicator",$cc7e05a45900e73f$export$6b9198de19accfe6=reactExports.forwardRef((tt,et)=>{const{__scopeSelect:rt,...nt}=tt;return $cc7e05a45900e73f$var$useSelectItemContext($cc7e05a45900e73f$var$ITEM_INDICATOR_NAME,rt).isSelected?reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({"aria-hidden":!0},nt,{ref:et})):null}),$cc7e05a45900e73f$var$SCROLL_UP_BUTTON_NAME="SelectScrollUpButton",$cc7e05a45900e73f$export$d8117927658af6d7=reactExports.forwardRef((tt,et)=>{const rt=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$SCROLL_UP_BUTTON_NAME,tt.__scopeSelect),nt=$cc7e05a45900e73f$var$useSelectViewportContext($cc7e05a45900e73f$var$SCROLL_UP_BUTTON_NAME,tt.__scopeSelect),[it,st]=reactExports.useState(!1),ot=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,nt.onScrollButtonChange);return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{if(rt.viewport&&rt.isPositioned){let ut=function(){const ct=lt.scrollTop>0;st(ct)};const lt=rt.viewport;return ut(),lt.addEventListener("scroll",ut),()=>lt.removeEventListener("scroll",ut)}},[rt.viewport,rt.isPositioned]),it?reactExports.createElement($cc7e05a45900e73f$var$SelectScrollButtonImpl,_extends$1({},tt,{ref:ot,onAutoScroll:()=>{const{viewport:lt,selectedItem:ut}=rt;lt&&ut&&(lt.scrollTop=lt.scrollTop-ut.offsetHeight)}})):null}),$cc7e05a45900e73f$var$SCROLL_DOWN_BUTTON_NAME="SelectScrollDownButton",$cc7e05a45900e73f$export$ff951e476c12189=reactExports.forwardRef((tt,et)=>{const rt=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$SCROLL_DOWN_BUTTON_NAME,tt.__scopeSelect),nt=$cc7e05a45900e73f$var$useSelectViewportContext($cc7e05a45900e73f$var$SCROLL_DOWN_BUTTON_NAME,tt.__scopeSelect),[it,st]=reactExports.useState(!1),ot=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,nt.onScrollButtonChange);return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{if(rt.viewport&&rt.isPositioned){let ut=function(){const ct=lt.scrollHeight-lt.clientHeight,dt=Math.ceil(lt.scrollTop)<ct;st(dt)};const lt=rt.viewport;return ut(),lt.addEventListener("scroll",ut),()=>lt.removeEventListener("scroll",ut)}},[rt.viewport,rt.isPositioned]),it?reactExports.createElement($cc7e05a45900e73f$var$SelectScrollButtonImpl,_extends$1({},tt,{ref:ot,onAutoScroll:()=>{const{viewport:lt,selectedItem:ut}=rt;lt&&ut&&(lt.scrollTop=lt.scrollTop+ut.offsetHeight)}})):null}),$cc7e05a45900e73f$var$SelectScrollButtonImpl=reactExports.forwardRef((tt,et)=>{const{__scopeSelect:rt,onAutoScroll:nt,...it}=tt,st=$cc7e05a45900e73f$var$useSelectContentContext("SelectScrollButton",rt),ot=reactExports.useRef(null),lt=$cc7e05a45900e73f$var$useCollection(rt),ut=reactExports.useCallback(()=>{ot.current!==null&&(window.clearInterval(ot.current),ot.current=null)},[]);return reactExports.useEffect(()=>()=>ut(),[ut]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{var ct;const dt=lt().find(pt=>pt.ref.current===document.activeElement);dt==null||(ct=dt.ref.current)===null||ct===void 0||ct.scrollIntoView({block:"nearest"})},[lt]),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"aria-hidden":!0},it,{ref:et,style:{flexShrink:0,...it.style},onPointerDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(it.onPointerDown,()=>{ot.current===null&&(ot.current=window.setInterval(nt,50))}),onPointerMove:$e42e1063c40fb3ef$export$b9ecd428b558ff10(it.onPointerMove,()=>{var ct;(ct=st.onItemLeave)===null||ct===void 0||ct.call(st),ot.current===null&&(ot.current=window.setInterval(nt,50))}),onPointerLeave:$e42e1063c40fb3ef$export$b9ecd428b558ff10(it.onPointerLeave,()=>{ut()})}))});function $cc7e05a45900e73f$var$shouldShowPlaceholder(tt){return tt===""||tt===void 0}const $cc7e05a45900e73f$var$BubbleSelect=reactExports.forwardRef((tt,et)=>{const{value:rt,...nt}=tt,it=reactExports.useRef(null),st=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,it),ot=$010c2913dbd2fe3d$export$5cae361ad82dce8b(rt);return reactExports.useEffect(()=>{const lt=it.current,ut=window.HTMLSelectElement.prototype,dt=Object.getOwnPropertyDescriptor(ut,"value").set;if(ot!==rt&&dt){const pt=new Event("change",{bubbles:!0});dt.call(lt,rt),lt.dispatchEvent(pt)}},[ot,rt]),reactExports.createElement($ea1ef594cf570d83$export$439d29a4e110a164,{asChild:!0},reactExports.createElement("select",_extends$1({},nt,{ref:st,defaultValue:rt})))});$cc7e05a45900e73f$var$BubbleSelect.displayName="BubbleSelect";function $cc7e05a45900e73f$var$useTypeaheadSearch(tt){const et=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(tt),rt=reactExports.useRef(""),nt=reactExports.useRef(0),it=reactExports.useCallback(ot=>{const lt=rt.current+ot;et(lt),function ut(ct){rt.current=ct,window.clearTimeout(nt.current),ct!==""&&(nt.current=window.setTimeout(()=>ut(""),1e3))}(lt)},[et]),st=reactExports.useCallback(()=>{rt.current="",window.clearTimeout(nt.current)},[]);return reactExports.useEffect(()=>()=>window.clearTimeout(nt.current),[]),[rt,it,st]}function $cc7e05a45900e73f$var$findNextItem(tt,et,rt){const it=et.length>1&&Array.from(et).every(ct=>ct===et[0])?et[0]:et,st=rt?tt.indexOf(rt):-1;let ot=$cc7e05a45900e73f$var$wrapArray(tt,Math.max(st,0));it.length===1&&(ot=ot.filter(ct=>ct!==rt));const ut=ot.find(ct=>ct.textValue.toLowerCase().startsWith(it.toLowerCase()));return ut!==rt?ut:void 0}function $cc7e05a45900e73f$var$wrapArray(tt,et){return tt.map((rt,nt)=>tt[(et+nt)%tt.length])}const $cc7e05a45900e73f$export$be92b6f5f03c0fe9=$cc7e05a45900e73f$export$ef9b1a59e592288f,$cc7e05a45900e73f$export$41fb9f06171c75f4=$cc7e05a45900e73f$export$3ac1e88a1c0b9f1,$cc7e05a45900e73f$export$7c6e2c02157bb7d2=$cc7e05a45900e73f$export$c973a4b3cb86a03d,$cc7e05a45900e73f$export$b04be29aa201d4f5=$cc7e05a45900e73f$export$f67338d29bd972f8,$cc7e05a45900e73f$export$6d08773d2e66f8f2=$cc7e05a45900e73f$export$13ef48a934230896;var openseadragon={exports:{}};(function(module){//! openseadragon 2.4.2
//! Built on 2020-03-05
//! Git commit: v2.4.2-0-c450749
//! http://openseadragon.github.io
//! License: http://openseadragon.github.io/license/
function OpenSeadragon(tt){return new OpenSeadragon.Viewer(tt)}(function(tt){tt.version={versionStr:"2.4.2",major:parseInt("2",10),minor:parseInt("4",10),revision:parseInt("2",10)};var et={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},rt=Object.prototype.toString,nt=Object.prototype.hasOwnProperty;tt.isFunction=function(it){return tt.type(it)==="function"},tt.isArray=Array.isArray||function(it){return tt.type(it)==="array"},tt.isWindow=function(it){return it&&typeof it=="object"&&"setInterval"in it},tt.type=function(it){return it==null?String(it):et[rt.call(it)]||"object"},tt.isPlainObject=function(it){if(!it||OpenSeadragon.type(it)!=="object"||it.nodeType||tt.isWindow(it)||it.constructor&&!nt.call(it,"constructor")&&!nt.call(it.constructor.prototype,"isPrototypeOf"))return!1;var st;for(var ot in it)st=ot;return st===void 0||nt.call(it,st)},tt.isEmptyObject=function(it){for(var st in it)return!1;return!0},tt.freezeObject=function(it){return Object.freeze?tt.freezeObject=Object.freeze:tt.freezeObject=function(st){return st},tt.freezeObject(it)},tt.supportsCanvas=function(){var it=document.createElement("canvas");return!!(tt.isFunction(it.getContext)&&it.getContext("2d"))}(),tt.isCanvasTainted=function(it){var st=!1;try{it.getContext("2d").getImageData(0,0,1,1)}catch{st=!0}return st},tt.pixelDensityRatio=function(){if(tt.supportsCanvas){var it=document.createElement("canvas").getContext("2d"),st=window.devicePixelRatio||1,ot=it.webkitBackingStorePixelRatio||it.mozBackingStorePixelRatio||it.msBackingStorePixelRatio||it.oBackingStorePixelRatio||it.backingStorePixelRatio||1;return Math.max(st,1)/ot}else return 1}()})(OpenSeadragon),function($){$.extend=function(){var tt,et,rt,nt,it,st,ot=arguments[0]||{},lt=arguments.length,ut=!1,ct=1;for(typeof ot=="boolean"&&(ut=ot,ot=arguments[1]||{},ct=2),typeof ot!="object"&&!OpenSeadragon.isFunction(ot)&&(ot={}),lt===ct&&(ot=this,--ct);ct<lt;ct++)if(tt=arguments[ct],tt!==null||tt!==void 0)for(et in tt)rt=ot[et],nt=tt[et],ot!==nt&&(ut&&nt&&(OpenSeadragon.isPlainObject(nt)||(it=OpenSeadragon.isArray(nt)))?(it?(it=!1,st=rt&&OpenSeadragon.isArray(rt)?rt:[]):st=rt&&OpenSeadragon.isPlainObject(rt)?rt:{},ot[et]=OpenSeadragon.extend(ut,st,nt)):nt!==void 0&&(ot[et]=nt));return ot};var isIOSDevice=function(){if(typeof navigator!="object")return!1;var tt=navigator.userAgent;return typeof tt!="string"?!1:tt.indexOf("iPhone")!==-1||tt.indexOf("iPad")!==-1||tt.indexOf("iPod")!==-1};$.extend($,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:isIOSDevice(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"]},SIGNAL:"----seadragon----",delegate:function(tt,et){return function(){var rt=arguments;return rt===void 0&&(rt=[]),et.apply(tt,rt)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(tt){return typeof tt=="string"&&(tt=document.getElementById(tt)),tt},getElementPosition:function(tt){var et=new $.Point,rt,nt;for(tt=$.getElement(tt),rt=$.getElementStyle(tt).position=="fixed",nt=getOffsetParent(tt,rt);nt;)et.x+=tt.offsetLeft,et.y+=tt.offsetTop,rt&&(et=et.plus($.getPageScroll())),tt=nt,rt=$.getElementStyle(tt).position=="fixed",nt=getOffsetParent(tt,rt);return et},getElementOffset:function(tt){tt=$.getElement(tt);var et=tt&&tt.ownerDocument,rt,nt,it={top:0,left:0};return et?(rt=et.documentElement,typeof tt.getBoundingClientRect<"u"&&(it=tt.getBoundingClientRect()),nt=et==et.window?et:et.nodeType===9?et.defaultView||et.parentWindow:!1,new $.Point(it.left+(nt.pageXOffset||rt.scrollLeft)-(rt.clientLeft||0),it.top+(nt.pageYOffset||rt.scrollTop)-(rt.clientTop||0))):new $.Point},getElementSize:function(tt){return tt=$.getElement(tt),new $.Point(tt.clientWidth,tt.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(tt){return tt=$.getElement(tt),tt.currentStyle}:function(tt){return tt=$.getElement(tt),window.getComputedStyle(tt,"")},getCssPropertyWithVendorPrefix:function(tt){var et={};return $.getCssPropertyWithVendorPrefix=function(rt){if(et[rt]!==void 0)return et[rt];var nt=document.createElement("div").style,it=null;if(nt[rt]!==void 0)it=rt;else for(var st=["Webkit","Moz","MS","O","webkit","moz","ms","o"],ot=$.capitalizeFirstLetter(rt),lt=0;lt<st.length;lt++){var ut=st[lt]+ot;if(nt[ut]!==void 0){it=ut;break}}return et[rt]=it,it},$.getCssPropertyWithVendorPrefix(tt)},capitalizeFirstLetter:function(tt){return tt.charAt(0).toUpperCase()+tt.slice(1)},positiveModulo:function(tt,et){var rt=tt%et;return rt<0&&(rt+=et),rt},pointInElement:function(tt,et){tt=$.getElement(tt);var rt=$.getElementOffset(tt),nt=$.getElementSize(tt);return et.x>=rt.x&&et.x<rt.x+nt.x&&et.y<rt.y+nt.y&&et.y>=rt.y},getEvent:function(tt){return tt?$.getEvent=function(et){return et}:$.getEvent=function(){return window.event},$.getEvent(tt)},getMousePosition:function(tt){if(typeof tt.pageX=="number")$.getMousePosition=function(et){var rt=new $.Point;return et=$.getEvent(et),rt.x=et.pageX,rt.y=et.pageY,rt};else if(typeof tt.clientX=="number")$.getMousePosition=function(et){var rt=new $.Point;return et=$.getEvent(et),rt.x=et.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,rt.y=et.clientY+document.body.scrollTop+document.documentElement.scrollTop,rt};else throw new Error("Unknown event mouse position, no known technique.");return $.getMousePosition(tt)},getPageScroll:function(){var tt=document.documentElement||{},et=document.body||{};if(typeof window.pageXOffset=="number")$.getPageScroll=function(){return new $.Point(window.pageXOffset,window.pageYOffset)};else if(et.scrollLeft||et.scrollTop)$.getPageScroll=function(){return new $.Point(document.body.scrollLeft,document.body.scrollTop)};else if(tt.scrollLeft||tt.scrollTop)$.getPageScroll=function(){return new $.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)};else return new $.Point(0,0);return $.getPageScroll()},setPageScroll:function(tt){if(typeof window.scrollTo<"u")$.setPageScroll=function(nt){window.scrollTo(nt.x,nt.y)};else{var et=$.getPageScroll();if(et.x===tt.x&&et.y===tt.y)return;document.body.scrollLeft=tt.x,document.body.scrollTop=tt.y;var rt=$.getPageScroll();if(rt.x!==et.x&&rt.y!==et.y){$.setPageScroll=function(nt){document.body.scrollLeft=nt.x,document.body.scrollTop=nt.y};return}if(document.documentElement.scrollLeft=tt.x,document.documentElement.scrollTop=tt.y,rt=$.getPageScroll(),rt.x!==et.x&&rt.y!==et.y){$.setPageScroll=function(nt){document.documentElement.scrollLeft=nt.x,document.documentElement.scrollTop=nt.y};return}$.setPageScroll=function(nt){}}return $.setPageScroll(tt)},getWindowSize:function(){var tt=document.documentElement||{},et=document.body||{};if(typeof window.innerWidth=="number")$.getWindowSize=function(){return new $.Point(window.innerWidth,window.innerHeight)};else if(tt.clientWidth||tt.clientHeight)$.getWindowSize=function(){return new $.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else if(et.clientWidth||et.clientHeight)$.getWindowSize=function(){return new $.Point(document.body.clientWidth,document.body.clientHeight)};else throw new Error("Unknown window size, no known technique.");return $.getWindowSize()},makeCenteredNode:function(tt){tt=$.getElement(tt);var et=[$.makeNeutralElement("div"),$.makeNeutralElement("div"),$.makeNeutralElement("div")];return $.extend(et[0].style,{display:"table",height:"100%",width:"100%"}),$.extend(et[1].style,{display:"table-row"}),$.extend(et[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),et[0].appendChild(et[1]),et[1].appendChild(et[2]),et[2].appendChild(tt),et[0]},makeNeutralElement:function(tt){var et=document.createElement(tt),rt=et.style;return rt.background="transparent none",rt.border="none",rt.margin="0px",rt.padding="0px",rt.position="static",et},now:function(){return Date.now?$.now=Date.now:$.now=function(){return new Date().getTime()},$.now()},makeTransparentImage:function(tt){return $.makeTransparentImage=function(et){var rt=$.makeNeutralElement("img");return rt.src=et,rt},$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<7&&($.makeTransparentImage=function(et){var rt=$.makeNeutralElement("img"),nt=null;return nt=$.makeNeutralElement("span"),nt.style.display="inline-block",rt.onload=function(){nt.style.width=nt.style.width||rt.width+"px",nt.style.height=nt.style.height||rt.height+"px",rt.onload=null,rt=null},rt.src=et,nt.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+et+"', sizingMethod='scale')",nt}),$.makeTransparentImage(tt)},setElementOpacity:function(tt,et,rt){var nt,it;tt=$.getElement(tt),rt&&!$.Browser.alpha&&(et=Math.round(et)),$.Browser.opacity?tt.style.opacity=et<1?et:"":et<1?(nt=Math.round(100*et),it="alpha(opacity="+nt+")",tt.style.filter=it):tt.style.filter=""},setElementTouchActionNone:function(tt){tt=$.getElement(tt),typeof tt.style.touchAction<"u"?tt.style.touchAction="none":typeof tt.style.msTouchAction<"u"&&(tt.style.msTouchAction="none")},addClass:function(tt,et){tt=$.getElement(tt),tt.className?(" "+tt.className+" ").indexOf(" "+et+" ")===-1&&(tt.className+=" "+et):tt.className=et},indexOf:function(tt,et,rt){return Array.prototype.indexOf?this.indexOf=function(nt,it,st){return nt.indexOf(it,st)}:this.indexOf=function(nt,it,st){var ot,lt=st||0,ut;if(!nt)throw new TypeError;if(ut=nt.length,ut===0||lt>=ut)return-1;for(lt<0&&(lt=ut-Math.abs(lt)),ot=lt;ot<ut;ot++)if(nt[ot]===it)return ot;return-1},this.indexOf(tt,et,rt)},removeClass:function(tt,et){var rt,nt=[],it;for(tt=$.getElement(tt),rt=tt.className.split(/\s+/),it=0;it<rt.length;it++)rt[it]&&rt[it]!==et&&nt.push(rt[it]);tt.className=nt.join(" ")},addEvent:function(){if(window.addEventListener)return function(tt,et,rt,nt){tt=$.getElement(tt),tt.addEventListener(et,rt,nt)};if(window.attachEvent)return function(tt,et,rt,nt){tt=$.getElement(tt),tt.attachEvent("on"+et,rt)};throw new Error("No known event model.")}(),removeEvent:function(){if(window.removeEventListener)return function(tt,et,rt,nt){tt=$.getElement(tt),tt.removeEventListener(et,rt,nt)};if(window.detachEvent)return function(tt,et,rt,nt){tt=$.getElement(tt),tt.detachEvent("on"+et,rt)};throw new Error("No known event model.")}(),cancelEvent:function(tt){tt=$.getEvent(tt),tt.preventDefault?$.cancelEvent=function(et){et.preventDefault()}:$.cancelEvent=function(et){et=$.getEvent(et),et.cancel=!0,et.returnValue=!1},$.cancelEvent(tt)},stopEvent:function(tt){tt=$.getEvent(tt),tt.stopPropagation?$.stopEvent=function(et){et.stopPropagation()}:$.stopEvent=function(et){et=$.getEvent(et),et.cancelBubble=!0},$.stopEvent(tt)},createCallback:function(tt,et){var rt=[],nt;for(nt=2;nt<arguments.length;nt++)rt.push(arguments[nt]);return function(){var it=rt.concat([]),st;for(st=0;st<arguments.length;st++)it.push(arguments[st]);return et.apply(tt,it)}},getUrlParameter:function(tt){var et=URLPARAMS[tt];return et||null},getUrlProtocol:function(tt){var et=tt.match(/^([a-z]+:)\/\//i);return et===null?window.location.protocol:et[1].toLowerCase()},createAjaxRequest:function(tt){var et;try{et=!!new ActiveXObject("Microsoft.XMLHTTP")}catch{et=!1}if(et)window.XMLHttpRequest?$.createAjaxRequest=function(rt){return rt?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:$.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else if(window.XMLHttpRequest)$.createAjaxRequest=function(){return new XMLHttpRequest};else throw new Error("Browser doesn't support XMLHttpRequest.");return $.createAjaxRequest(tt)},makeAjaxRequest:function(tt,et,rt){var nt,it,st;$.isPlainObject(tt)&&(et=tt.success,rt=tt.error,nt=tt.withCredentials,it=tt.headers,st=tt.responseType||null,tt=tt.url);var ot=$.getUrlProtocol(tt),lt=$.createAjaxRequest(ot==="file:");if(!$.isFunction(et))throw new Error("makeAjaxRequest requires a success callback");lt.onreadystatechange=function(){lt.readyState==4&&(lt.onreadystatechange=function(){},lt.status>=200&&lt.status<300||lt.status===0&&ot!=="http:"&&ot!=="https:"?et(lt):($.console.log("AJAX request returned %d: %s",lt.status,tt),$.isFunction(rt)&&rt(lt)))};try{if(lt.open("GET",tt,!0),st&&(lt.responseType=st),it)for(var ut in it)Object.prototype.hasOwnProperty.call(it,ut)&&it[ut]&&lt.setRequestHeader(ut,it[ut]);nt&&(lt.withCredentials=!0),lt.send(null)}catch(ft){var ct=ft.message,dt=$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<10;if(dt&&typeof ft.number<"u"&&ft.number==-2147024891&&(ct+=`
See http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain`),$.console.log("%s while making AJAX request: %s",ft.name,ct),lt.onreadystatechange=function(){},window.XDomainRequest){var pt=new window.XDomainRequest;if(pt){pt.onload=function(gt){$.isFunction(et)&&et({responseText:pt.responseText,status:200,statusText:"OK"})},pt.onerror=function(gt){$.isFunction(rt)&&rt({responseText:pt.responseText,status:444,statusText:"An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."})};try{pt.open("GET",tt),pt.send()}catch{$.isFunction(rt)&&rt(lt,ft)}}}else $.isFunction(rt)&&rt(lt,ft)}return lt},jsonp:function(tt){var et,rt=tt.url,nt=document.head||document.getElementsByTagName("head")[0]||document.documentElement,it=tt.callbackName||"openseadragon"+$.now(),st=window[it],ot="$1"+it+"$2",lt=tt.param||"callback",ut=tt.callback;rt=rt.replace(/(\=)\?(&|$)|\?\?/i,ot),rt+=(/\?/.test(rt)?"&":"?")+lt+"="+it,window[it]=function(ct){if(st)window[it]=st;else try{delete window[it]}catch{}ut&&$.isFunction(ut)&&ut(ct)},et=document.createElement("script"),(tt.async!==void 0||tt.async!==!1)&&(et.async="async"),tt.scriptCharset&&(et.charset=tt.scriptCharset),et.src=rt,et.onload=et.onreadystatechange=function(ct,dt){(dt||!et.readyState||/loaded|complete/.test(et.readyState))&&(et.onload=et.onreadystatechange=null,nt&&et.parentNode&&nt.removeChild(et),et=void 0)},nt.insertBefore(et,nt.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(tt){if(window.DOMParser)$.parseXml=function(et){var rt=null,nt;return nt=new DOMParser,rt=nt.parseFromString(et,"text/xml"),rt};else if(window.ActiveXObject)$.parseXml=function(et){var rt=null;return rt=new ActiveXObject("Microsoft.XMLDOM"),rt.async=!1,rt.loadXML(et),rt};else throw new Error("Browser doesn't support XML DOM.");return $.parseXml(tt)},parseJSON:function(string){return window.JSON&&window.JSON.parse?$.parseJSON=window.JSON.parse:$.parseJSON=function(string){return eval("("+string+")")},$.parseJSON(string)},imageFormatSupported:function(tt){return tt=tt||"",!!FILEFORMATS[tt.toLowerCase()]}});var nullfunction=function(tt){};$.console=window.console||{log:nullfunction,debug:nullfunction,info:nullfunction,warn:nullfunction,error:nullfunction,assert:nullfunction},$.Browser={vendor:$.BROWSERS.UNKNOWN,version:0,alpha:!0};var FILEFORMATS={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},URLPARAMS={};(function(){var tt=navigator.appVersion,et=navigator.userAgent,rt;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(et.substring(et.indexOf("MSIE")+5,et.indexOf(";",et.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(et.indexOf("Firefox")>=0?($.Browser.vendor=$.BROWSERS.FIREFOX,$.Browser.version=parseFloat(et.substring(et.indexOf("Firefox")+8))):et.indexOf("Safari")>=0?($.Browser.vendor=et.indexOf("Chrome")>=0?$.BROWSERS.CHROME:$.BROWSERS.SAFARI,$.Browser.version=parseFloat(et.substring(et.substring(0,et.indexOf("Safari")).lastIndexOf("/")+1,et.indexOf("Safari")))):(rt=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),rt.exec(et)!==null&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(RegExp.$1))));break;case"Opera":$.Browser.vendor=$.BROWSERS.OPERA,$.Browser.version=parseFloat(tt);break}var nt=window.location.search.substring(1),it=nt.split("&"),st,ot,lt;for(lt=0;lt<it.length;lt++)if(st=it[lt],ot=st.indexOf("="),ot>0){var ut=st.substring(0,ot),ct=st.substring(ot+1);try{URLPARAMS[ut]=decodeURIComponent(ct)}catch{$.console.error("Ignoring malformed URL parameter: %s=%s",ut,ct)}}$.Browser.alpha=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9||$.Browser.vendor==$.BROWSERS.CHROME&&$.Browser.version<2),$.Browser.opacity=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9)})(),function(tt){var et=tt.requestAnimationFrame||tt.mozRequestAnimationFrame||tt.webkitRequestAnimationFrame||tt.msRequestAnimationFrame,rt=tt.cancelAnimationFrame||tt.mozCancelAnimationFrame||tt.webkitCancelAnimationFrame||tt.msCancelAnimationFrame;if(et&&rt)$.requestAnimationFrame=function(){return et.apply(tt,arguments)},$.cancelAnimationFrame=function(){return rt.apply(tt,arguments)};else{var nt=[],it=[],st=0,ot;$.requestAnimationFrame=function(lt){return nt.push([++st,lt]),ot||(ot=setInterval(function(){if(nt.length){var ut=$.now(),ct=it;for(it=nt,nt=ct;it.length;)it.shift()[1](ut)}else clearInterval(ot),ot=void 0},1e3/50)),st},$.cancelAnimationFrame=function(lt){var ut,ct;for(ut=0,ct=nt.length;ut<ct;ut+=1)if(nt[ut][0]===lt){nt.splice(ut,1);return}for(ut=0,ct=it.length;ut<ct;ut+=1)if(it[ut][0]===lt){it.splice(ut,1);return}}}}(window);function getOffsetParent(tt,et){return et&&tt!=document.body?document.body:tt.offsetParent}}(OpenSeadragon),function(tt,et){module.exports?module.exports=et():tt.OpenSeadragon=et()}(commonjsGlobal,function(){return OpenSeadragon}),function(tt){var et={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(et.supportsFullScreen=!0,et.getFullScreenElement=function(){return document.fullscreenElement},et.requestFullScreen=function(rt){return rt.requestFullscreen()},et.exitFullScreen=function(){document.exitFullscreen()},et.fullScreenEventName="fullscreenchange",et.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(et.supportsFullScreen=!0,et.getFullScreenElement=function(){return document.msFullscreenElement},et.requestFullScreen=function(rt){return rt.msRequestFullscreen()},et.exitFullScreen=function(){document.msExitFullscreen()},et.fullScreenEventName="MSFullscreenChange",et.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(et.supportsFullScreen=!0,et.getFullScreenElement=function(){return document.webkitFullscreenElement},et.requestFullScreen=function(rt){return rt.webkitRequestFullscreen()},et.exitFullScreen=function(){document.webkitExitFullscreen()},et.fullScreenEventName="webkitfullscreenchange",et.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(et.supportsFullScreen=!0,et.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},et.requestFullScreen=function(rt){return rt.webkitRequestFullScreen()},et.exitFullScreen=function(){document.webkitCancelFullScreen()},et.fullScreenEventName="webkitfullscreenchange",et.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(et.supportsFullScreen=!0,et.getFullScreenElement=function(){return document.mozFullScreenElement},et.requestFullScreen=function(rt){return rt.mozRequestFullScreen()},et.exitFullScreen=function(){document.mozCancelFullScreen()},et.fullScreenEventName="mozfullscreenchange",et.fullScreenErrorEventName="mozfullscreenerror"),et.isFullScreen=function(){return et.getFullScreenElement()!==null},et.cancelFullScreen=function(){tt.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),et.exitFullScreen()},tt.extend(tt,et)}(OpenSeadragon),function(tt){tt.EventSource=function(){this.events={}},tt.EventSource.prototype={addOnceHandler:function(et,rt,nt,it){var st=this;it=it||1;var ot=0,lt=function(ut){ot++,ot===it&&st.removeHandler(et,lt),rt(ut)};this.addHandler(et,lt,nt)},addHandler:function(et,rt,nt){var it=this.events[et];it||(this.events[et]=it=[]),rt&&tt.isFunction(rt)&&(it[it.length]={handler:rt,userData:nt||null})},removeHandler:function(et,rt){var nt=this.events[et],it=[],st;if(nt&&tt.isArray(nt)){for(st=0;st<nt.length;st++)nt[st].handler!==rt&&it.push(nt[st]);this.events[et]=it}},removeAllHandlers:function(et){if(et)this.events[et]=[];else for(var rt in this.events)this.events[rt]=[]},getHandler:function(et){var rt=this.events[et];return!rt||!rt.length?null:(rt=rt.length===1?[rt[0]]:Array.apply(null,rt),function(nt,it){var st,ot=rt.length;for(st=0;st<ot;st++)rt[st]&&(it.eventSource=nt,it.userData=rt[st].userData,rt[st].handler(it))})},raiseEvent:function(et,rt){var nt=this.getHandler(et);nt&&(rt||(rt={}),nt(this,rt))}}}(OpenSeadragon),function(tt){var et=[],rt={};tt.MouseTracker=function(ts){et.push(this);var es=arguments;tt.isPlainObject(ts)||(ts={element:es[0],clickTimeThreshold:es[1],clickDistThreshold:es[2]}),this.hash=Math.random(),this.element=tt.getElement(ts.element),this.clickTimeThreshold=ts.clickTimeThreshold||tt.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=ts.clickDistThreshold||tt.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=ts.dblClickTimeThreshold||tt.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=ts.dblClickDistThreshold||tt.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=ts.userData||null,this.stopDelay=ts.stopDelay||50,this.enterHandler=ts.enterHandler||null,this.exitHandler=ts.exitHandler||null,this.pressHandler=ts.pressHandler||null,this.nonPrimaryPressHandler=ts.nonPrimaryPressHandler||null,this.releaseHandler=ts.releaseHandler||null,this.nonPrimaryReleaseHandler=ts.nonPrimaryReleaseHandler||null,this.moveHandler=ts.moveHandler||null,this.scrollHandler=ts.scrollHandler||null,this.clickHandler=ts.clickHandler||null,this.dblClickHandler=ts.dblClickHandler||null,this.dragHandler=ts.dragHandler||null,this.dragEndHandler=ts.dragEndHandler||null,this.pinchHandler=ts.pinchHandler||null,this.stopHandler=ts.stopHandler||null,this.keyDownHandler=ts.keyDownHandler||null,this.keyUpHandler=ts.keyUpHandler||null,this.keyHandler=ts.keyHandler||null,this.focusHandler=ts.focusHandler||null,this.blurHandler=ts.blurHandler||null;var ds=this;rt[this.hash]={click:function(fs){_r(ds,fs)},dblclick:function(fs){Yr(ds,fs)},keydown:function(fs){mt(ds,fs)},keyup:function(fs){Kr(ds,fs)},keypress:function(fs){Xr(ds,fs)},focus:function(fs){Zr(ds,fs)},blur:function(fs){Qr(ds,fs)},wheel:function(fs){_i(ds,fs)},mousewheel:function(fs){ns(ds,fs)},DOMMouseScroll:function(fs){ns(ds,fs)},MozMousePixelScroll:function(fs){ns(ds,fs)},mouseenter:function(fs){hs(ds,fs)},mouseleave:function(fs){cs(ds,fs)},mouseover:function(fs){os(ds,fs)},mouseout:function(fs){ps(ds,fs)},mousedown:function(fs){ms(ds,fs)},mouseup:function(fs){us(ds,fs)},mouseupcaptured:function(fs){gs(ds,fs)},mousemove:function(fs){Es(ds,fs)},mousemovecaptured:function(fs){Ss(ds,fs)},touchstart:function(fs){Rs(ds,fs)},touchend:function(fs){Is(ds,fs)},touchendcaptured:function(fs){ks(ds,fs)},touchmove:function(fs){Os(ds,fs)},touchmovecaptured:function(fs){Ys(ds,fs)},touchcancel:function(fs){js(ds,fs)},gesturestart:function(fs){Ws(ds,fs)},gesturechange:function(fs){Jr(ds,fs)},pointerover:function(fs){as(ds,fs)},MSPointerOver:function(fs){as(ds,fs)},pointerout:function(fs){xs(ds,fs)},MSPointerOut:function(fs){xs(ds,fs)},pointerdown:function(fs){bs(ds,fs)},MSPointerDown:function(fs){bs(ds,fs)},pointerup:function(fs){ws(ds,fs)},MSPointerUp:function(fs){ws(ds,fs)},pointermove:function(fs){qs(ds,fs)},MSPointerMove:function(fs){qs(ds,fs)},pointercancel:function(fs){Ns(ds,fs)},MSPointerCancel:function(fs){Ns(ds,fs)},pointerupcaptured:function(fs){Bs(ds,fs)},pointermovecaptured:function(fs){Ks(ds,fs)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null},ts.startDisabled||this.setTracking(!0)},tt.MouseTracker.prototype={destroy:function(){var ts;for(st(this),this.element=null,ts=0;ts<et.length;ts++)if(et[ts]===this){et.splice(ts,1);break}rt[this.hash]=null,delete rt[this.hash]},isTracking:function(){return rt[this.hash].tracking},setTracking:function(ts){return ts?it(this):st(this),this},getActivePointersListsExceptType:function(ts){for(var es=rt[this.hash],ds=[],fs=0;fs<es.activePointersLists.length;++fs)es.activePointersLists[fs].type!==ts&&ds.push(es.activePointersLists[fs]);return ds},getActivePointersListByType:function(ts){var es=rt[this.hash],ds,fs=es.activePointersLists.length,Cs;for(ds=0;ds<fs;ds++)if(es.activePointersLists[ds].type===ts)return es.activePointersLists[ds];return Cs=new tt.MouseTracker.GesturePointList(ts),es.activePointersLists.push(Cs),Cs},getActivePointerCount:function(){var ts=rt[this.hash],es,ds=ts.activePointersLists.length,fs=0;for(es=0;es<ds;es++)fs+=ts.activePointersLists[es].getLength();return fs},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},tt.MouseTracker.resetAllMouseTrackers=function(){for(var ts=0;ts<et.length;ts++)et[ts].isTracking()&&(et[ts].setTracking(!1),et[ts].setTracking(!0))},tt.MouseTracker.gesturePointVelocityTracker=function(){var ts=[],es=0,ds=0,fs=function($s,Ms){return $s.hash.toString()+Ms.type+Ms.id.toString()},Cs=function(){var $s,Ms=ts.length,Us,Hs,Xs=tt.now(),Fs,no,io;for(Fs=Xs-ds,ds=Xs,$s=0;$s<Ms;$s++)Us=ts[$s],Hs=Us.gPoint,Hs.direction=Math.atan2(Hs.currentPos.y-Us.lastPos.y,Hs.currentPos.x-Us.lastPos.x),no=Us.lastPos.distanceTo(Hs.currentPos),Us.lastPos=Hs.currentPos,io=1e3*no/(Fs+1),Hs.speed=.75*io+.25*Hs.speed},Ls=function($s,Ms){var Us=fs($s,Ms);ts.push({guid:Us,gPoint:Ms,lastPos:Ms.currentPos}),ts.length===1&&(ds=tt.now(),es=window.setInterval(Cs,50))},_s=function($s,Ms){var Us=fs($s,Ms),Hs,Xs=ts.length;for(Hs=0;Hs<Xs;Hs++)if(ts[Hs].guid===Us){ts.splice(Hs,1),Xs--,Xs===0&&window.clearInterval(es);break}};return{addPoint:Ls,removePoint:_s}}(),tt.MouseTracker.captureElement=document,tt.MouseTracker.wheelEventName=tt.Browser.vendor==tt.BROWSERS.IE&&tt.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll",tt.MouseTracker.supportsMouseCapture=function(){var ts=document.createElement("div");return tt.isFunction(ts.setCapture)&&tt.isFunction(ts.releaseCapture)}(),tt.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",tt.MouseTracker.wheelEventName],tt.MouseTracker.wheelEventName=="DOMMouseScroll"&&tt.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent&&(window.navigator.pointerEnabled||tt.Browser.vendor!==tt.BROWSERS.IE)?(tt.MouseTracker.havePointerEvents=!0,tt.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),tt.MouseTracker.unprefixedPointerEvents=!0,navigator.maxTouchPoints?tt.MouseTracker.maxTouchPoints=navigator.maxTouchPoints:tt.MouseTracker.maxTouchPoints=0,tt.MouseTracker.haveMouseEnter=!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?(tt.MouseTracker.havePointerEvents=!0,tt.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"),tt.MouseTracker.unprefixedPointerEvents=!1,navigator.msMaxTouchPoints?tt.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints:tt.MouseTracker.maxTouchPoints=0,tt.MouseTracker.haveMouseEnter=!1):(tt.MouseTracker.havePointerEvents=!1,tt.Browser.vendor===tt.BROWSERS.IE&&tt.Browser.version<9?(tt.MouseTracker.subscribeEvents.push("mouseenter","mouseleave"),tt.MouseTracker.haveMouseEnter=!0):(tt.MouseTracker.subscribeEvents.push("mouseover","mouseout"),tt.MouseTracker.haveMouseEnter=!1),tt.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove"),"ontouchstart"in window&&tt.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&tt.MouseTracker.subscribeEvents.push("gesturestart","gesturechange"),tt.MouseTracker.mousePointerId="legacy-mouse",tt.MouseTracker.maxTouchPoints=10),tt.MouseTracker.GesturePointList=function(ts){this._gPoints=[],this.type=ts,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},tt.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(ts){return this._gPoints.push(ts)},removeById:function(ts){var es,ds=this._gPoints.length;for(es=0;es<ds;es++)if(this._gPoints[es].id===ts){this._gPoints.splice(es,1);break}return this._gPoints.length},getByIndex:function(ts){return ts<this._gPoints.length?this._gPoints[ts]:null},getById:function(ts){var es,ds=this._gPoints.length;for(es=0;es<ds;es++)if(this._gPoints[es].id===ts)return this._gPoints[es];return null},getPrimary:function(ts){var es,ds=this._gPoints.length;for(es=0;es<ds;es++)if(this._gPoints[es].isPrimary)return this._gPoints[es];return null},addContact:function(){++this.contacts,this.contacts>1&&(this.type==="mouse"||this.type==="pen")&&(this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};function nt(ts){var es=rt[ts.hash],ds,fs=es.activePointersLists.length;for(ds=0;ds<fs;ds++)es.activePointersLists[ds].captureCount>0&&(tt.removeEvent(tt.MouseTracker.captureElement,"mousemove",es.mousemovecaptured,!0),tt.removeEvent(tt.MouseTracker.captureElement,"mouseup",es.mouseupcaptured,!0),tt.removeEvent(tt.MouseTracker.captureElement,tt.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",es.pointermovecaptured,!0),tt.removeEvent(tt.MouseTracker.captureElement,tt.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",es.pointerupcaptured,!0),tt.removeEvent(tt.MouseTracker.captureElement,"touchmove",es.touchmovecaptured,!0),tt.removeEvent(tt.MouseTracker.captureElement,"touchend",es.touchendcaptured,!0),es.activePointersLists[ds].captureCount=0);for(ds=0;ds<fs;ds++)es.activePointersLists.pop()}function it(ts){var es=rt[ts.hash],ds,fs;if(!es.tracking){for(fs=0;fs<tt.MouseTracker.subscribeEvents.length;fs++)ds=tt.MouseTracker.subscribeEvents[fs],tt.addEvent(ts.element,ds,es[ds],!1);nt(ts),es.tracking=!0}}function st(ts){var es=rt[ts.hash],ds,fs;if(es.tracking){for(fs=0;fs<tt.MouseTracker.subscribeEvents.length;fs++)ds=tt.MouseTracker.subscribeEvents[fs],tt.removeEvent(ts.element,ds,es[ds],!1);nt(ts),es.tracking=!1}}function ot(ts,es){var ds=rt[ts.hash];if(es==="pointerevent")return{upName:tt.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:ds.pointerupcaptured,moveName:tt.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:ds.pointermovecaptured};if(es==="mouse")return{upName:"mouseup",upHandler:ds.mouseupcaptured,moveName:"mousemove",moveHandler:ds.mousemovecaptured};if(es==="touch")return{upName:"touchend",upHandler:ds.touchendcaptured,moveName:"touchmove",moveHandler:ds.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function lt(ts,es,ds){var fs=ts.getActivePointersListByType(es),Cs;fs.captureCount+=ds||1,fs.captureCount===1&&(tt.Browser.vendor===tt.BROWSERS.IE&&tt.Browser.version<9?ts.element.setCapture(!0):(Cs=ot(ts,tt.MouseTracker.havePointerEvents?"pointerevent":es),co&&fo(window.top)&&tt.addEvent(window.top,Cs.upName,Cs.upHandler,!0),tt.addEvent(tt.MouseTracker.captureElement,Cs.upName,Cs.upHandler,!0),tt.addEvent(tt.MouseTracker.captureElement,Cs.moveName,Cs.moveHandler,!0)))}function ut(ts,es,ds){var fs=ts.getActivePointersListByType(es),Cs;fs.captureCount-=ds||1,fs.captureCount===0&&(tt.Browser.vendor===tt.BROWSERS.IE&&tt.Browser.version<9?ts.element.releaseCapture():(Cs=ot(ts,tt.MouseTracker.havePointerEvents?"pointerevent":es),co&&fo(window.top)&&tt.removeEvent(window.top,Cs.upName,Cs.upHandler,!0),tt.removeEvent(tt.MouseTracker.captureElement,Cs.moveName,Cs.moveHandler,!0),tt.removeEvent(tt.MouseTracker.captureElement,Cs.upName,Cs.upHandler,!0)))}function ct(ts){var es;if(tt.MouseTracker.unprefixedPointerEvents)es=ts.pointerType;else switch(ts.pointerType){case 2:es="touch";break;case 3:es="pen";break;case 4:es="mouse";break;default:es=""}return es}function dt(ts){return tt.getMousePosition(ts)}function pt(ts,es){return ft(dt(ts),es)}function ft(ts,es){var ds=tt.getElementOffset(es);return ts.minus(ds)}function gt(ts,es){return new tt.Point((ts.x+es.x)/2,(ts.y+es.y)/2)}function _r(ts,es){ts.clickHandler&&tt.cancelEvent(es)}function Yr(ts,es){ts.dblClickHandler&&tt.cancelEvent(es)}function mt(ts,es){var ds;ts.keyDownHandler&&(es=tt.getEvent(es),ds=ts.keyDownHandler({eventSource:ts,keyCode:es.keyCode?es.keyCode:es.charCode,ctrl:es.ctrlKey,shift:es.shiftKey,alt:es.altKey,meta:es.metaKey,originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),ds||tt.cancelEvent(es))}function Kr(ts,es){var ds;ts.keyUpHandler&&(es=tt.getEvent(es),ds=ts.keyUpHandler({eventSource:ts,keyCode:es.keyCode?es.keyCode:es.charCode,ctrl:es.ctrlKey,shift:es.shiftKey,alt:es.altKey,meta:es.metaKey,originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),ds||tt.cancelEvent(es))}function Xr(ts,es){var ds;ts.keyHandler&&(es=tt.getEvent(es),ds=ts.keyHandler({eventSource:ts,keyCode:es.keyCode?es.keyCode:es.charCode,ctrl:es.ctrlKey,shift:es.shiftKey,alt:es.altKey,meta:es.metaKey,originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),ds||tt.cancelEvent(es))}function Zr(ts,es){var ds;ts.focusHandler&&(es=tt.getEvent(es),ds=ts.focusHandler({eventSource:ts,originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),ds===!1&&tt.cancelEvent(es))}function Qr(ts,es){var ds;ts.blurHandler&&(es=tt.getEvent(es),ds=ts.blurHandler({eventSource:ts,originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),ds===!1&&tt.cancelEvent(es))}function _i(ts,es){rs(ts,es,es)}function ns(ts,es){es=tt.getEvent(es);var ds={target:es.target||es.srcElement,type:"wheel",shiftKey:es.shiftKey||!1,clientX:es.clientX,clientY:es.clientY,pageX:es.pageX?es.pageX:es.clientX,pageY:es.pageY?es.pageY:es.clientY,deltaMode:es.type=="MozMousePixelScroll"?0:1,deltaX:0,deltaZ:0};tt.MouseTracker.wheelEventName=="mousewheel"?ds.deltaY=-es.wheelDelta/tt.DEFAULT_SETTINGS.pixelsPerWheelLine:ds.deltaY=es.detail,rs(ts,ds,es)}function rs(ts,es,ds){var fs=0,Cs;fs=es.deltaY<0?1:-1,ts.scrollHandler&&(Cs=ts.scrollHandler({eventSource:ts,pointerType:"mouse",position:pt(es,ts.element),scroll:fs,shift:es.shiftKey,isTouchEvent:!1,originalEvent:ds,preventDefaultAction:!1,userData:ts.userData}),Cs===!1&&tt.cancelEvent(ds))}function ss(ts,es){if(ts===es)return!1;for(;es&&es!==ts;)es=es.parentNode;return es===ts}function hs(ts,es){es=tt.getEvent(es),is(ts,es)}function os(ts,es){es=tt.getEvent(es),!(es.currentTarget===es.relatedTarget||ss(es.currentTarget,es.relatedTarget))&&is(ts,es)}function is(ts,es){var ds={id:tt.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:dt(es),currentTime:tt.now()};Qs(ts,es,[ds])}function cs(ts,es){es=tt.getEvent(es),vs(ts,es)}function ps(ts,es){es=tt.getEvent(es),!(es.currentTarget===es.relatedTarget||ss(es.currentTarget,es.relatedTarget))&&vs(ts,es)}function vs(ts,es){var ds={id:tt.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:dt(es),currentTime:tt.now()};Js(ts,es,[ds])}function ls(ts){return tt.Browser.vendor===tt.BROWSERS.IE&&tt.Browser.version<9?ts===1?0:ts===2?2:ts===4?1:-1:ts}function ms(ts,es){var ds;es=tt.getEvent(es),ds={id:tt.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:dt(es),currentTime:tt.now()},so(ts,es,[ds],ls(es.button))&&(tt.stopEvent(es),lt(ts,"mouse")),(ts.clickHandler||ts.dblClickHandler||ts.pressHandler||ts.dragHandler||ts.dragEndHandler)&&tt.cancelEvent(es)}function us(ts,es){ys(ts,es)}function gs(ts,es){ys(ts,es),tt.stopEvent(es)}function ys(ts,es){var ds;es=tt.getEvent(es),ds={id:tt.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:dt(es),currentTime:tt.now()},to(ts,es,[ds],ls(es.button))&&ut(ts,"mouse")}function Es(ts,es){Ts(ts,es)}function Ss(ts,es){Ts(ts,es),tt.stopEvent(es)}function Ts(ts,es){var ds;es=tt.getEvent(es),ds={id:tt.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:dt(es),currentTime:tt.now()},lo(ts,es,[ds])}function Ds(ts,es,ds){var fs,Cs=ds.getLength(),Ls=[];if(ds.type==="touch"||ds.contacts>0){for(fs=0;fs<Cs;fs++)Ls.push(ds.getByIndex(fs));Ls.length>0&&(to(ts,es,Ls,0),ds.captureCount=1,ut(ts,ds.type),Js(ts,es,Ls))}}function Rs(ts,es){var ds,fs,Cs,Ls=es.changedTouches.length,_s=[],$s,Ms=ts.getActivePointersListByType("touch");for(ds=tt.now(),Ms.getLength()>es.touches.length-Ls&&(tt.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers."),Ds(ts,es,Ms)),fs=0;fs<Ls;fs++)_s.push({id:es.changedTouches[fs].identifier,type:"touch",currentPos:dt(es.changedTouches[fs]),currentTime:ds});for(Qs(ts,es,_s),fs=0;fs<et.length;fs++)if(et[fs]!==ts&&et[fs].isTracking()&&ss(et[fs].element,ts.element)){for($s=[],Cs=0;Cs<Ls;Cs++)$s.push({id:es.changedTouches[Cs].identifier,type:"touch",currentPos:dt(es.changedTouches[Cs]),currentTime:ds});Qs(et[fs],es,$s)}so(ts,es,_s,0)&&(tt.stopEvent(es),lt(ts,"touch",Ls)),tt.cancelEvent(es)}function Is(ts,es){As(ts,es)}function ks(ts,es){As(ts,es),tt.stopEvent(es)}function As(ts,es){var ds,fs,Cs,Ls=es.changedTouches.length,_s=[],$s;for(ds=tt.now(),fs=0;fs<Ls;fs++)_s.push({id:es.changedTouches[fs].identifier,type:"touch",currentPos:dt(es.changedTouches[fs]),currentTime:ds});for(to(ts,es,_s,0)&&ut(ts,"touch",Ls),Js(ts,es,_s),fs=0;fs<et.length;fs++)if(et[fs]!==ts&&et[fs].isTracking()&&ss(et[fs].element,ts.element)){for($s=[],Cs=0;Cs<Ls;Cs++)$s.push({id:es.changedTouches[Cs].identifier,type:"touch",currentPos:dt(es.changedTouches[Cs]),currentTime:ds});Js(et[fs],es,$s)}tt.cancelEvent(es)}function Os(ts,es){Vs(ts,es)}function Ys(ts,es){Vs(ts,es),tt.stopEvent(es)}function Vs(ts,es){var ds,fs=es.changedTouches.length,Cs=[];for(ds=0;ds<fs;ds++)Cs.push({id:es.changedTouches[ds].identifier,type:"touch",currentPos:dt(es.changedTouches[ds]),currentTime:tt.now()});lo(ts,es,Cs),tt.cancelEvent(es)}function js(ts,es){var ds=ts.getActivePointersListByType("touch");Ds(ts,es,ds)}function Ws(ts,es){return es.stopPropagation(),es.preventDefault(),!1}function Jr(ts,es){return es.stopPropagation(),es.preventDefault(),!1}function as(ts,es){var ds;es.currentTarget===es.relatedTarget||ss(es.currentTarget,es.relatedTarget)||(ds={id:es.pointerId,type:ct(es),isPrimary:es.isPrimary,currentPos:dt(es),currentTime:tt.now()},Qs(ts,es,[ds]))}function xs(ts,es){var ds;es.currentTarget===es.relatedTarget||ss(es.currentTarget,es.relatedTarget)||(ds={id:es.pointerId,type:ct(es),isPrimary:es.isPrimary,currentPos:dt(es),currentTime:tt.now()},Js(ts,es,[ds]))}function bs(ts,es){var ds;ds={id:es.pointerId,type:ct(es),isPrimary:es.isPrimary,currentPos:dt(es),currentTime:tt.now()},so(ts,es,[ds],es.button)&&(tt.stopEvent(es),lt(ts,ds.type)),(ts.clickHandler||ts.dblClickHandler||ts.pressHandler||ts.dragHandler||ts.dragEndHandler||ts.pinchHandler)&&tt.cancelEvent(es)}function ws(ts,es){Ps(ts,es)}function Bs(ts,es){var ds=ts.getActivePointersListByType(ct(es));ds.getById(es.pointerId)&&Ps(ts,es),tt.stopEvent(es)}function Ps(ts,es){var ds;ds={id:es.pointerId,type:ct(es),isPrimary:es.isPrimary,currentPos:dt(es),currentTime:tt.now()},to(ts,es,[ds],es.button)&&ut(ts,ds.type)}function qs(ts,es){zs(ts,es)}function Ks(ts,es){var ds=ts.getActivePointersListByType(ct(es));ds.getById(es.pointerId)&&zs(ts,es),tt.stopEvent(es)}function zs(ts,es){var ds;ds={id:es.pointerId,type:ct(es),isPrimary:es.isPrimary,currentPos:dt(es),currentTime:tt.now()},lo(ts,es,[ds])}function Ns(ts,es){var ds;ds={id:es.pointerId,type:ct(es)},go(ts,es,[ds])}function Zs(ts,es){return Object.prototype.hasOwnProperty.call(es,"isPrimary")||(ts.getLength()===0?es.isPrimary=!0:es.isPrimary=!1),es.speed=0,es.direction=0,es.contactPos=es.currentPos,es.contactTime=es.currentTime,es.lastPos=es.currentPos,es.lastTime=es.currentTime,ts.add(es)}function Gs(ts,es){var ds,fs;return ts.getById(es.id)?(ds=ts.removeById(es.id),Object.prototype.hasOwnProperty.call(es,"isPrimary")||(fs=ts.getPrimary(),fs||(fs=ts.getByIndex(0),fs&&(fs.isPrimary=!0)))):ds=ts.getLength(),ds}function Qs(ts,es,ds){var fs=ts.getActivePointersListByType(ds[0].type),Cs,Ls=ds.length,_s,$s,Ms;for(Cs=0;Cs<Ls;Cs++)_s=ds[Cs],$s=fs.getById(_s.id),$s?($s.insideElement=!0,$s.lastPos=$s.currentPos,$s.lastTime=$s.currentTime,$s.currentPos=_s.currentPos,$s.currentTime=_s.currentTime,_s=$s):(_s.captured=!1,_s.insideElementPressed=!1,_s.insideElement=!0,Zs(fs,_s)),ts.enterHandler&&(Ms=ts.enterHandler({eventSource:ts,pointerType:_s.type,position:ft(_s.currentPos,ts.element),buttons:fs.buttons,pointers:ts.getActivePointerCount(),insideElementPressed:_s.insideElementPressed,buttonDownAny:fs.buttons!==0,isTouchEvent:_s.type==="touch",originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),Ms===!1&&tt.cancelEvent(es))}function Js(ts,es,ds){var fs=ts.getActivePointersListByType(ds[0].type),Cs,Ls=ds.length,_s,$s,Ms;for(Cs=0;Cs<Ls;Cs++)_s=ds[Cs],$s=fs.getById(_s.id),$s&&($s.captured?($s.insideElement=!1,$s.lastPos=$s.currentPos,$s.lastTime=$s.currentTime,$s.currentPos=_s.currentPos,$s.currentTime=_s.currentTime):Gs(fs,$s),_s=$s),ts.exitHandler&&(Ms=ts.exitHandler({eventSource:ts,pointerType:_s.type,position:_s.currentPos&&ft(_s.currentPos,ts.element),buttons:fs.buttons,pointers:ts.getActivePointerCount(),insideElementPressed:$s?$s.insideElementPressed:!1,buttonDownAny:fs.buttons!==0,isTouchEvent:_s.type==="touch",originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),Ms===!1&&tt.cancelEvent(es))}function so(ts,es,ds,fs){var Cs=rt[ts.hash],Ls,_s=ts.getActivePointersListByType(ds[0].type),$s,Ms=ds.length,Us,Hs;typeof es.buttons<"u"?_s.buttons=es.buttons:tt.Browser.vendor===tt.BROWSERS.IE&&tt.Browser.version<9?fs===0?_s.buttons+=1:fs===1?_s.buttons+=4:fs===2?_s.buttons+=2:fs===3?_s.buttons+=8:fs===4?_s.buttons+=16:fs===5&&(_s.buttons+=32):fs===0?_s.buttons|=1:fs===1?_s.buttons|=4:fs===2?_s.buttons|=2:fs===3?_s.buttons|=8:fs===4?_s.buttons|=16:fs===5&&(_s.buttons|=32);var Xs=ts.getActivePointersListsExceptType(ds[0].type);for($s=0;$s<Xs.length;$s++)Ds(ts,es,Xs[$s]);if(fs!==0)return ts.nonPrimaryPressHandler&&(Ls=ts.nonPrimaryPressHandler({eventSource:ts,pointerType:ds[0].type,position:ft(ds[0].currentPos,ts.element),button:fs,buttons:_s.buttons,isTouchEvent:ds[0].type==="touch",originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),Ls===!1&&tt.cancelEvent(es)),!1;for($s=0;$s<Ms;$s++)Us=ds[$s],Hs=_s.getById(Us.id),Hs?(Hs.captured=!0,Hs.insideElementPressed=!0,Hs.insideElement=!0,Hs.contactPos=Us.currentPos,Hs.contactTime=Us.currentTime,Hs.lastPos=Hs.currentPos,Hs.lastTime=Hs.currentTime,Hs.currentPos=Us.currentPos,Hs.currentTime=Us.currentTime,Us=Hs):(Us.captured=!0,Us.insideElementPressed=!0,Us.insideElement=!0,Zs(_s,Us)),_s.addContact(),(ts.dragHandler||ts.dragEndHandler||ts.pinchHandler)&&tt.MouseTracker.gesturePointVelocityTracker.addPoint(ts,Us),_s.contacts===1?ts.pressHandler&&(Ls=ts.pressHandler({eventSource:ts,pointerType:Us.type,position:ft(Us.contactPos,ts.element),buttons:_s.buttons,isTouchEvent:Us.type==="touch",originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),Ls===!1&&tt.cancelEvent(es)):_s.contacts===2&&ts.pinchHandler&&Us.type==="touch"&&(Cs.pinchGPoints=_s.asArray(),Cs.lastPinchDist=Cs.currentPinchDist=Cs.pinchGPoints[0].currentPos.distanceTo(Cs.pinchGPoints[1].currentPos),Cs.lastPinchCenter=Cs.currentPinchCenter=gt(Cs.pinchGPoints[0].currentPos,Cs.pinchGPoints[1].currentPos));return!0}function to(ts,es,ds,fs){var Cs=rt[ts.hash],Ls=ts.getActivePointersListByType(ds[0].type),_s,$s,Ms,Us,Hs=ds.length,Xs,Fs,no=!1,io=!1,uo;if(typeof es.buttons<"u"?Ls.buttons=es.buttons:tt.Browser.vendor===tt.BROWSERS.IE&&tt.Browser.version<9?fs===0?Ls.buttons-=1:fs===1?Ls.buttons-=4:fs===2?Ls.buttons-=2:fs===3?Ls.buttons-=8:fs===4?Ls.buttons-=16:fs===5&&(Ls.buttons-=32):fs===0?Ls.buttons^=-2:fs===1?Ls.buttons^=-5:fs===2?Ls.buttons^=-3:fs===3?Ls.buttons^=-9:fs===4?Ls.buttons^=-17:fs===5&&(Ls.buttons^=-33),fs!==0){ts.nonPrimaryReleaseHandler&&(_s=ts.nonPrimaryReleaseHandler({eventSource:ts,pointerType:ds[0].type,position:ft(ds[0].currentPos,ts.element),button:fs,buttons:Ls.buttons,isTouchEvent:ds[0].type==="touch",originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),_s===!1&&tt.cancelEvent(es));var yo=ts.getActivePointersListByType("mouse");return Ds(ts,es,yo),!1}if(typeof ds[0].currentPos>"u")return Ds(ts,es,Ls),!1;for(Us=0;Us<Hs;Us++)Xs=ds[Us],Fs=Ls.getById(Xs.id),Fs&&(Fs.captured&&(Fs.captured=!1,no=!0,io=!0),Fs.lastPos=Fs.currentPos,Fs.lastTime=Fs.currentTime,Fs.currentPos=Xs.currentPos,Fs.currentTime=Xs.currentTime,Fs.insideElement||Gs(Ls,Fs),$s=Fs.currentPos,Ms=Fs.currentTime,io?(Ls.removeContact(),(ts.dragHandler||ts.dragEndHandler||ts.pinchHandler)&&tt.MouseTracker.gesturePointVelocityTracker.removePoint(ts,Fs),Ls.contacts===0?(ts.releaseHandler&&(_s=ts.releaseHandler({eventSource:ts,pointerType:Fs.type,position:ft($s,ts.element),buttons:Ls.buttons,insideElementPressed:Fs.insideElementPressed,insideElementReleased:Fs.insideElement,isTouchEvent:Fs.type==="touch",originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),_s===!1&&tt.cancelEvent(es)),ts.dragEndHandler&&!Fs.currentPos.equals(Fs.contactPos)&&(_s=ts.dragEndHandler({eventSource:ts,pointerType:Fs.type,position:ft(Fs.currentPos,ts.element),speed:Fs.speed,direction:Fs.direction,shift:es.shiftKey,isTouchEvent:Fs.type==="touch",originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),_s===!1&&tt.cancelEvent(es)),(ts.clickHandler||ts.dblClickHandler)&&Fs.insideElement&&(uo=Ms-Fs.contactTime<=ts.clickTimeThreshold&&Fs.contactPos.distanceTo($s)<=ts.clickDistThreshold,ts.clickHandler&&(_s=ts.clickHandler({eventSource:ts,pointerType:Fs.type,position:ft(Fs.currentPos,ts.element),quick:uo,shift:es.shiftKey,isTouchEvent:Fs.type==="touch",originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),_s===!1&&tt.cancelEvent(es)),ts.dblClickHandler&&uo&&(Ls.clicks++,Ls.clicks===1?(Cs.lastClickPos=$s,Cs.dblClickTimeOut=setTimeout(function(){Ls.clicks=0},ts.dblClickTimeThreshold)):Ls.clicks===2&&(clearTimeout(Cs.dblClickTimeOut),Ls.clicks=0,Cs.lastClickPos.distanceTo($s)<=ts.dblClickDistThreshold&&(_s=ts.dblClickHandler({eventSource:ts,pointerType:Fs.type,position:ft(Fs.currentPos,ts.element),shift:es.shiftKey,isTouchEvent:Fs.type==="touch",originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),_s===!1&&tt.cancelEvent(es)),Cs.lastClickPos=null)))):Ls.contacts===2&&ts.pinchHandler&&Fs.type==="touch"&&(Cs.pinchGPoints=Ls.asArray(),Cs.lastPinchDist=Cs.currentPinchDist=Cs.pinchGPoints[0].currentPos.distanceTo(Cs.pinchGPoints[1].currentPos),Cs.lastPinchCenter=Cs.currentPinchCenter=gt(Cs.pinchGPoints[0].currentPos,Cs.pinchGPoints[1].currentPos))):ts.releaseHandler&&(_s=ts.releaseHandler({eventSource:ts,pointerType:Fs.type,position:ft($s,ts.element),buttons:Ls.buttons,insideElementPressed:Fs.insideElementPressed,insideElementReleased:Fs.insideElement,isTouchEvent:Fs.type==="touch",originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),_s===!1&&tt.cancelEvent(es)));return no}function lo(ts,es,ds){var fs=rt[ts.hash],Cs=ts.getActivePointersListByType(ds[0].type),Ls,_s=ds.length,$s,Ms,Us,Hs,Xs;for(typeof es.buttons<"u"&&(Cs.buttons=es.buttons),Ls=0;Ls<_s;Ls++)$s=ds[Ls],Ms=Cs.getById($s.id),Ms?(Object.prototype.hasOwnProperty.call($s,"isPrimary")&&(Ms.isPrimary=$s.isPrimary),Ms.lastPos=Ms.currentPos,Ms.lastTime=Ms.currentTime,Ms.currentPos=$s.currentPos,Ms.currentTime=$s.currentTime):($s.captured=!1,$s.insideElementPressed=!1,$s.insideElement=!0,Zs(Cs,$s));ts.stopHandler&&ds[0].type==="mouse"&&(clearTimeout(ts.stopTimeOut),ts.stopTimeOut=setTimeout(function(){vo(ts,es,ds[0].type)},ts.stopDelay)),Cs.contacts===0?ts.moveHandler&&(Xs=ts.moveHandler({eventSource:ts,pointerType:ds[0].type,position:ft(ds[0].currentPos,ts.element),buttons:Cs.buttons,isTouchEvent:ds[0].type==="touch",originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),Xs===!1&&tt.cancelEvent(es)):Cs.contacts===1?(ts.moveHandler&&(Ms=Cs.asArray()[0],Xs=ts.moveHandler({eventSource:ts,pointerType:Ms.type,position:ft(Ms.currentPos,ts.element),buttons:Cs.buttons,isTouchEvent:Ms.type==="touch",originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),Xs===!1&&tt.cancelEvent(es)),ts.dragHandler&&(Ms=Cs.asArray()[0],Hs=Ms.currentPos.minus(Ms.lastPos),Xs=ts.dragHandler({eventSource:ts,pointerType:Ms.type,position:ft(Ms.currentPos,ts.element),buttons:Cs.buttons,delta:Hs,speed:Ms.speed,direction:Ms.direction,shift:es.shiftKey,isTouchEvent:Ms.type==="touch",originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),Xs===!1&&tt.cancelEvent(es))):Cs.contacts===2&&(ts.moveHandler&&(Us=Cs.asArray(),Xs=ts.moveHandler({eventSource:ts,pointerType:Us[0].type,position:ft(gt(Us[0].currentPos,Us[1].currentPos),ts.element),buttons:Cs.buttons,isTouchEvent:Us[0].type==="touch",originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),Xs===!1&&tt.cancelEvent(es)),ts.pinchHandler&&ds[0].type==="touch"&&(Hs=fs.pinchGPoints[0].currentPos.distanceTo(fs.pinchGPoints[1].currentPos),Hs!=fs.currentPinchDist&&(fs.lastPinchDist=fs.currentPinchDist,fs.currentPinchDist=Hs,fs.lastPinchCenter=fs.currentPinchCenter,fs.currentPinchCenter=gt(fs.pinchGPoints[0].currentPos,fs.pinchGPoints[1].currentPos),Xs=ts.pinchHandler({eventSource:ts,pointerType:"touch",gesturePoints:fs.pinchGPoints,lastCenter:ft(fs.lastPinchCenter,ts.element),center:ft(fs.currentPinchCenter,ts.element),lastDistance:fs.lastPinchDist,distance:fs.currentPinchDist,shift:es.shiftKey,originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),Xs===!1&&tt.cancelEvent(es))))}function go(ts,es,ds){to(ts,es,ds,0),Js(ts,es,ds)}function vo(ts,es,ds){ts.stopHandler&&ts.stopHandler({eventSource:ts,pointerType:ds,position:pt(es,ts.element),buttons:ts.getActivePointersListByType(ds).buttons,isTouchEvent:ds==="touch",originalEvent:es,preventDefaultAction:!1,userData:ts.userData})}var co=function(){try{return window.self!==window.top}catch{return!0}}();function fo(ts){try{return ts.addEventListener&&ts.removeEventListener}catch{return!1}}}(OpenSeadragon),function(tt){tt.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},tt.Control=function(et,rt,nt){var it=et.parentNode;typeof rt=="number"&&(tt.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),rt={anchor:rt}),rt.attachToViewer=typeof rt.attachToViewer>"u"?!0:rt.attachToViewer,this.autoFade=typeof rt.autoFade>"u"?!0:rt.autoFade,this.element=et,this.anchor=rt.anchor,this.container=nt,this.anchor==tt.ControlAnchor.ABSOLUTE?(this.wrapper=tt.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top=typeof rt.top=="number"?rt.top+"px":rt.top,this.wrapper.style.left=typeof rt.left=="number"?rt.left+"px":rt.left,this.wrapper.style.height=typeof rt.height=="number"?rt.height+"px":rt.height,this.wrapper.style.width=typeof rt.width=="number"?rt.width+"px":rt.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=tt.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor==tt.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),rt.attachToViewer?this.anchor==tt.ControlAnchor.TOP_RIGHT||this.anchor==tt.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):it.appendChild(this.wrapper)},tt.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return this.wrapper.style.display!="none"},setVisible:function(et){this.wrapper.style.display=et?this.anchor==tt.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(et){this.element[tt.SIGNAL]&&tt.Browser.vendor==tt.BROWSERS.IE?tt.setElementOpacity(this.element,et,!0):tt.setElementOpacity(this.wrapper,et,!0)}}}(OpenSeadragon),function(tt){tt.ControlDock=function(rt){var nt=["topleft","topright","bottomright","bottomleft"],it,st;for(tt.extend(!0,this,{id:"controldock-"+tt.now()+"-"+Math.floor(Math.random()*1e6),container:tt.makeNeutralElement("div"),controls:[]},rt),this.container.onsubmit=function(){return!1},this.element&&(this.element=tt.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),st=0;st<nt.length;st++)it=nt[st],this.controls[it]=tt.makeNeutralElement("div"),this.controls[it].style.position="absolute",it.match("left")&&(this.controls[it].style.left="0px"),it.match("right")&&(this.controls[it].style.right="0px"),it.match("top")&&(this.controls[it].style.top="0px"),it.match("bottom")&&(this.controls[it].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},tt.ControlDock.prototype={addControl:function(rt,nt){rt=tt.getElement(rt);var it=null;if(!(et(this,rt)>=0)){switch(nt.anchor){case tt.ControlAnchor.TOP_RIGHT:it=this.controls.topright,rt.style.position="relative",rt.style.paddingRight="0px",rt.style.paddingTop="0px";break;case tt.ControlAnchor.BOTTOM_RIGHT:it=this.controls.bottomright,rt.style.position="relative",rt.style.paddingRight="0px",rt.style.paddingBottom="0px";break;case tt.ControlAnchor.BOTTOM_LEFT:it=this.controls.bottomleft,rt.style.position="relative",rt.style.paddingLeft="0px",rt.style.paddingBottom="0px";break;case tt.ControlAnchor.TOP_LEFT:it=this.controls.topleft,rt.style.position="relative",rt.style.paddingLeft="0px",rt.style.paddingTop="0px";break;case tt.ControlAnchor.ABSOLUTE:it=this.container,rt.style.margin="0px",rt.style.padding="0px";break;default:case tt.ControlAnchor.NONE:it=this.container,rt.style.margin="0px",rt.style.padding="0px";break}this.controls.push(new tt.Control(rt,nt,it)),rt.style.display="inline-block"}},removeControl:function(rt){rt=tt.getElement(rt);var nt=et(this,rt);return nt>=0&&(this.controls[nt].destroy(),this.controls.splice(nt,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var rt;for(rt=this.controls.length-1;rt>=0;rt--)if(this.controls[rt].isVisible())return!0;return!1},setControlsEnabled:function(rt){var nt;for(nt=this.controls.length-1;nt>=0;nt--)this.controls[nt].setVisible(rt);return this}};function et(rt,nt){var it=rt.controls,st;for(st=it.length-1;st>=0;st--)if(it[st].element==nt)return st;return-1}}(OpenSeadragon),function(tt){tt.Placement=tt.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(OpenSeadragon),function(tt){var et={},rt=1;tt.Viewer=function(Jr){var as=arguments,xs=this,bs;if(tt.isPlainObject(Jr)||(Jr={id:as[0],xmlPath:as.length>1?as[1]:void 0,prefixUrl:as.length>2?as[2]:void 0,controls:as.length>3?as[3]:void 0,overlays:as.length>4?as[4]:void 0}),Jr.config&&(tt.extend(!0,Jr,Jr.config),delete Jr.config),tt.extend(!0,this,{id:Jr.id,hash:Jr.hash||rt++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},tt.DEFAULT_SETTINGS,Jr),typeof this.hash>"u")throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(typeof et[this.hash]<"u"&&tt.console.warn("Hash "+this.hash+" has already been used."),et[this.hash]={fsBoundsDelta:new tt.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._lastScrollTime=tt.now(),tt.EventSource.call(this),this.addHandler("open-failed",function(ws){var Bs=tt.getString("Errors.OpenFailed",ws.eventSource,ws.message);xs._showMessage(Bs)}),tt.ControlDock.call(this,Jr),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=tt.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",function(ws){ws.width="100%",ws.height="100%",ws.overflow="hidden",ws.position="absolute",ws.top="0px",ws.left="0px"}(this.canvas.style),tt.setElementTouchActionNone(this.canvas),Jr.tabIndex!==""&&(this.canvas.tabIndex=Jr.tabIndex===void 0?0:Jr.tabIndex),this.container.className="openseadragon-container",function(ws){ws.width="100%",ws.height="100%",ws.position="relative",ws.overflow="hidden",ws.left="0px",ws.top="0px",ws.textAlign="left"}(this.container.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new tt.MouseTracker({element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:tt.delegate(this,_r),keyHandler:tt.delegate(this,Yr),clickHandler:tt.delegate(this,mt),dblClickHandler:tt.delegate(this,Kr),dragHandler:tt.delegate(this,Xr),dragEndHandler:tt.delegate(this,Zr),enterHandler:tt.delegate(this,Qr),exitHandler:tt.delegate(this,_i),pressHandler:tt.delegate(this,ns),releaseHandler:tt.delegate(this,rs),nonPrimaryPressHandler:tt.delegate(this,ss),nonPrimaryReleaseHandler:tt.delegate(this,hs),scrollHandler:tt.delegate(this,is),pinchHandler:tt.delegate(this,os)}),this.outerTracker=new tt.MouseTracker({element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:tt.delegate(this,cs),exitHandler:tt.delegate(this,ps)}),this.toolbar&&(this.toolbar=new tt.ControlDock({element:this.toolbar})),this.bindStandardControls(),et[this.hash].prevContainerSize=nt(this.container),this.world=new tt.World({viewer:this}),this.world.addHandler("add-item",function(ws){xs.source=xs.world.getItemAt(0).source,et[xs.hash].forceRedraw=!0,xs._updateRequestId||(xs._updateRequestId=lt(xs,vs))}),this.world.addHandler("remove-item",function(ws){xs.world.getItemCount()?xs.source=xs.world.getItemAt(0).source:xs.source=null,et[xs.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(ws){xs.viewport&&xs.viewport._setContentBounds(xs.world.getHomeBounds(),xs.world.getContentFactor())}),this.world.addHandler("item-index-change",function(ws){xs.source=xs.world.getItemAt(0).source}),this.viewport=new tt.Viewport({containerSize:et[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new tt.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:Jr.timeout}),this.tileCache=new tt.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new tt.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=tt.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(bs=this.buttons.buttons.indexOf(this.rotateLeft),this.buttons.buttons.splice(bs,1),this.buttons.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(bs=this.buttons.buttons.indexOf(this.rotateRight),this.buttons.buttons.splice(bs,1),this.buttons.element.removeChild(this.rotateRight.element))),this.showNavigator&&(this.navigator=new tt.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),bs=0;bs<this.customControls.length;bs++)this.addControl(this.customControls[bs].id,{anchor:this.customControls[bs].anchor});tt.requestAnimationFrame(function(){ct(xs)}),this.imageSmoothingEnabled!==void 0&&!this.imageSmoothingEnabled&&this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled)},tt.extend(tt.Viewer.prototype,tt.EventSource.prototype,tt.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(Jr){return tt.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(Jr)},openTileSource:function(Jr){return tt.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(Jr)},open:function(Jr,as){var xs=this;if(this.close(),!!Jr){if(this.sequenceMode&&tt.isArray(Jr)){this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),typeof as<"u"&&!isNaN(as)&&(this.initialPage=as),this.tileSources=Jr,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex);return}if(tt.isArray(Jr)||(Jr=[Jr]),!!Jr.length){this._opening=!0;for(var bs=Jr.length,ws=0,Bs=0,Ps,qs=function(){if(ws+Bs===bs)if(ws){(xs._firstOpen||!xs.preserveViewport)&&(xs.viewport.goHome(!0),xs.viewport.update()),xs._firstOpen=!1;var Ns=Jr[0];if(Ns.tileSource&&(Ns=Ns.tileSource),xs.overlays&&!xs.preserveOverlays)for(var Zs=0;Zs<xs.overlays.length;Zs++)xs.currentOverlays[Zs]=st(xs,xs.overlays[Zs]);xs._drawOverlays(),xs._opening=!1,xs.raiseEvent("open",{source:Ns})}else xs._opening=!1,xs.raiseEvent("open-failed",Ps)},Ks=function(Ns){(!tt.isPlainObject(Ns)||!Ns.tileSource)&&(Ns={tileSource:Ns}),Ns.index!==void 0&&(tt.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete Ns.index),Ns.collectionImmediately===void 0&&(Ns.collectionImmediately=!0);var Zs=Ns.success;Ns.success=function(Qs){if(ws++,Ns.tileSource.overlays)for(var Js=0;Js<Ns.tileSource.overlays.length;Js++)xs.addOverlay(Ns.tileSource.overlays[Js]);Zs&&Zs(Qs),qs()};var Gs=Ns.error;Ns.error=function(Qs){Bs++,Ps||(Ps=Qs),Gs&&Gs(Qs),qs()},xs.addTiledImage(Ns)},zs=0;zs<Jr.length;zs++)Ks(Jr[zs]);return this}}},close:function(){return et[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),et[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(et[this.hash]){if(this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),this._updateRequestId!==null&&(tt.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.removeAllHandlers(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),et[this.hash]=null,delete et[this.hash],this.canvas=null,this.container=null,this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(Jr){return this.innerTracker.setTracking(Jr),this.outerTracker.setTracking(Jr),this.raiseEvent("mouse-enabled",{enabled:Jr}),this},areControlsEnabled:function(){var Jr=this.controls.length,as;for(as=0;as<this.controls.length;as++)Jr=Jr&&this.controls[as].isVisible();return Jr},setControlsEnabled:function(Jr){return Jr?pt(this):ct(this),this.raiseEvent("controls-enabled",{enabled:Jr}),this},setDebugMode:function(Jr){for(var as=0;as<this.world.getItemCount();as++)this.world.getItemAt(as).debugMode=Jr;this.debugMode=Jr,this.forceRedraw()},isFullPage:function(){return et[this.hash].fullPage},setFullPage:function(Jr){var as=document.body,xs=as.style,bs=document.documentElement.style,ws=this,Bs,Ps;if(Jr==this.isFullPage())return this;var qs={fullPage:Jr,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",qs),qs.preventDefaultAction)return this;if(Jr){for(this.elementSize=tt.getElementSize(this.element),this.pageScroll=tt.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=xs.margin,this.docMargin=bs.margin,xs.margin="0",bs.margin="0",this.bodyPadding=xs.padding,this.docPadding=bs.padding,xs.padding="0",bs.padding="0",this.bodyWidth=xs.width,this.docWidth=bs.width,xs.width="100%",bs.width="100%",this.bodyHeight=xs.height,this.docHeight=bs.height,xs.height="100%",bs.height="100%",this.previousBody=[],et[this.hash].prevElementParent=this.element.parentNode,et[this.hash].prevNextSibling=this.element.nextSibling,et[this.hash].prevElementWidth=this.element.style.width,et[this.hash].prevElementHeight=this.element.style.height,Bs=as.childNodes.length,Ps=0;Ps<Bs;Ps++)this.previousBody.push(as.childNodes[0]),as.removeChild(as.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,as.appendChild(this.toolbar.element),tt.addClass(this.toolbar.element,"fullpage")),tt.addClass(this.element,"fullpage"),as.appendChild(this.element),this.element.style.height=tt.getWindowSize().y+"px",this.element.style.width=tt.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=tt.getElementSize(this.element).y-tt.getElementSize(this.toolbar.element).y+"px"),et[this.hash].fullPage=!0,tt.delegate(this,cs)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,xs.margin=this.bodyMargin,bs.margin=this.docMargin,xs.padding=this.bodyPadding,bs.padding=this.docPadding,xs.width=this.bodyWidth,bs.width=this.docWidth,xs.height=this.bodyHeight,bs.height=this.docHeight,as.removeChild(this.element),Bs=this.previousBody.length,Ps=0;Ps<Bs;Ps++)as.appendChild(this.previousBody.shift());tt.removeClass(this.element,"fullpage"),et[this.hash].prevElementParent.insertBefore(this.element,et[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(as.removeChild(this.toolbar.element),tt.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=et[this.hash].prevElementWidth,this.element.style.height=et[this.hash].prevElementHeight;var Ks=0,zs=function(){tt.setPageScroll(ws.pageScroll);var Ns=tt.getPageScroll();Ks++,Ks<10&&(Ns.x!==ws.pageScroll.x||Ns.y!==ws.pageScroll.y)&&tt.requestAnimationFrame(zs)};tt.requestAnimationFrame(zs),et[this.hash].fullPage=!1,tt.delegate(this,ps)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:Jr}),this},setFullScreen:function(Jr){var as=this;if(!tt.supportsFullScreen)return this.setFullPage(Jr);if(tt.isFullScreen()===Jr)return this;var xs={fullScreen:Jr,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",xs),xs.preventDefaultAction)return this;if(Jr){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var bs=function(){var ws=tt.isFullScreen();ws||(tt.removeEvent(document,tt.fullScreenEventName,bs),tt.removeEvent(document,tt.fullScreenErrorEventName,bs),as.setFullPage(!1),as.isFullPage()&&(as.element.style.width=as.fullPageStyleWidth,as.element.style.height=as.fullPageStyleHeight)),as.navigator&&as.viewport&&setTimeout(function(){as.navigator.update(as.viewport)}),as.raiseEvent("full-screen",{fullScreen:ws})};tt.addEvent(document,tt.fullScreenEventName,bs),tt.addEvent(document,tt.fullScreenErrorEventName,bs),tt.requestFullScreen(document.body)}else tt.exitFullScreen();return this},isVisible:function(){return this.container.style.visibility!="hidden"},setVisible:function(Jr){return this.container.style.visibility=Jr?"":"hidden",this.raiseEvent("visible",{visible:Jr}),this},addTiledImage:function(Jr){tt.console.assert(Jr,"[Viewer.addTiledImage] options is required"),tt.console.assert(Jr.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),tt.console.assert(!Jr.replace||Jr.index>-1&&Jr.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var as=this;Jr.replace&&(Jr.replaceItem=as.world.getItemAt(Jr.index)),this._hideMessage(),Jr.placeholderFillStyle===void 0&&(Jr.placeholderFillStyle=this.placeholderFillStyle),Jr.opacity===void 0&&(Jr.opacity=this.opacity),Jr.preload===void 0&&(Jr.preload=this.preload),Jr.compositeOperation===void 0&&(Jr.compositeOperation=this.compositeOperation),Jr.crossOriginPolicy===void 0&&(Jr.crossOriginPolicy=Jr.tileSource.crossOriginPolicy!==void 0?Jr.tileSource.crossOriginPolicy:this.crossOriginPolicy),Jr.ajaxWithCredentials===void 0&&(Jr.ajaxWithCredentials=this.ajaxWithCredentials),Jr.loadTilesWithAjax===void 0&&(Jr.loadTilesWithAjax=this.loadTilesWithAjax),Jr.ajaxHeaders===void 0||Jr.ajaxHeaders===null?Jr.ajaxHeaders=this.ajaxHeaders:tt.isPlainObject(Jr.ajaxHeaders)&&tt.isPlainObject(this.ajaxHeaders)&&(Jr.ajaxHeaders=tt.extend({},this.ajaxHeaders,Jr.ajaxHeaders));var xs={options:Jr};function bs(Ps){for(var qs=0;qs<as._loadQueue.length;qs++)if(as._loadQueue[qs]===xs){as._loadQueue.splice(qs,1);break}as._loadQueue.length===0&&ws(xs),as.raiseEvent("add-item-failed",Ps),Jr.error&&Jr.error(Ps)}function ws(Ps){as.collectionMode&&(as.world.arrange({immediately:Ps.options.collectionImmediately,rows:as.collectionRows,columns:as.collectionColumns,layout:as.collectionLayout,tileSize:as.collectionTileSize,tileMargin:as.collectionTileMargin}),as.world.setAutoRefigureSizes(!0))}if(tt.isArray(Jr.tileSource)){setTimeout(function(){bs({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:Jr.tileSource,options:Jr})});return}this._loadQueue.push(xs);function Bs(){for(var Ps,qs,Ks;as._loadQueue.length&&(Ps=as._loadQueue[0],!!Ps.tileSource);){if(as._loadQueue.splice(0,1),Ps.options.replace){var zs=as.world.getIndexOfItem(Ps.options.replaceItem);zs!=-1&&(Ps.options.index=zs),as.world.removeItem(Ps.options.replaceItem)}qs=new tt.TiledImage({viewer:as,source:Ps.tileSource,viewport:as.viewport,drawer:as.drawer,tileCache:as.tileCache,imageLoader:as.imageLoader,x:Ps.options.x,y:Ps.options.y,width:Ps.options.width,height:Ps.options.height,fitBounds:Ps.options.fitBounds,fitBoundsPlacement:Ps.options.fitBoundsPlacement,clip:Ps.options.clip,placeholderFillStyle:Ps.options.placeholderFillStyle,opacity:Ps.options.opacity,preload:Ps.options.preload,degrees:Ps.options.degrees,compositeOperation:Ps.options.compositeOperation,springStiffness:as.springStiffness,animationTime:as.animationTime,minZoomImageRatio:as.minZoomImageRatio,wrapHorizontal:as.wrapHorizontal,wrapVertical:as.wrapVertical,immediateRender:as.immediateRender,blendTime:as.blendTime,alwaysBlend:as.alwaysBlend,minPixelRatio:as.minPixelRatio,smoothTileEdgesMinZoom:as.smoothTileEdgesMinZoom,iOSDevice:as.iOSDevice,crossOriginPolicy:Ps.options.crossOriginPolicy,ajaxWithCredentials:Ps.options.ajaxWithCredentials,loadTilesWithAjax:Ps.options.loadTilesWithAjax,ajaxHeaders:Ps.options.ajaxHeaders,debugMode:as.debugMode}),as.collectionMode&&as.world.setAutoRefigureSizes(!1),as.world.addItem(qs,{index:Ps.options.index}),as._loadQueue.length===0&&ws(Ps),as.world.getItemCount()===1&&!as.preserveViewport&&as.viewport.goHome(!0),as.navigator&&(Ks=tt.extend({},Ps.options,{replace:!1,originalTiledImage:qs,tileSource:Ps.tileSource}),as.navigator.addTiledImage(Ks)),Ps.options.success&&Ps.options.success({item:qs})}}it(this,Jr.tileSource,Jr,function(Ps){xs.tileSource=Ps,Bs()},function(Ps){Ps.options=Jr,bs(Ps),Bs()})},addSimpleImage:function(Jr){tt.console.assert(Jr,"[Viewer.addSimpleImage] options is required"),tt.console.assert(Jr.url,"[Viewer.addSimpleImage] options.url is required");var as=tt.extend({},Jr,{tileSource:{type:"image",url:Jr.url}});delete as.url,this.addTiledImage(as)},addLayer:function(Jr){var as=this;tt.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var xs=tt.extend({},Jr,{success:function(bs){as.raiseEvent("add-layer",{options:Jr,drawer:bs.item})},error:function(bs){as.raiseEvent("add-layer-failed",bs)}});return this.addTiledImage(xs),this},getLayerAtLevel:function(Jr){return tt.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(Jr)},getLevelOfLayer:function(Jr){return tt.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(Jr)},getLayersCount:function(){return tt.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(Jr,as){return tt.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(Jr,as)},removeLayer:function(Jr){return tt.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(Jr)},forceRedraw:function(){return et[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var Jr=tt.delegate(this,ft),as=tt.delegate(this,gt),xs=tt.delegate(this,Ws),bs=tt.delegate(this,js),ws=this.navImages,Bs=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(Bs=!1),this.previousButton=new tt.Button({element:this.previousButton?tt.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:tt.getString("Tooltips.PreviousPage"),srcRest:us(this.prefixUrl,ws.previous.REST),srcGroup:us(this.prefixUrl,ws.previous.GROUP),srcHover:us(this.prefixUrl,ws.previous.HOVER),srcDown:us(this.prefixUrl,ws.previous.DOWN),onRelease:bs,onFocus:Jr,onBlur:as}),this.nextButton=new tt.Button({element:this.nextButton?tt.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:tt.getString("Tooltips.NextPage"),srcRest:us(this.prefixUrl,ws.next.REST),srcGroup:us(this.prefixUrl,ws.next.GROUP),srcHover:us(this.prefixUrl,ws.next.HOVER),srcDown:us(this.prefixUrl,ws.next.DOWN),onRelease:xs,onFocus:Jr,onBlur:as}),this.navPrevNextWrap||this.previousButton.disable(),(!this.tileSources||!this.tileSources.length)&&this.nextButton.disable(),Bs&&(this.paging=new tt.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:tt.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||tt.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var Jr=tt.delegate(this,gs),as=tt.delegate(this,Es),xs=tt.delegate(this,Ds),bs=tt.delegate(this,ys),ws=tt.delegate(this,Rs),Bs=tt.delegate(this,ks),Ps=tt.delegate(this,As),qs=tt.delegate(this,Os),Ks=tt.delegate(this,Ys),zs=tt.delegate(this,Vs),Ns=tt.delegate(this,ft),Zs=tt.delegate(this,gt),Gs=this.navImages,Qs=[],Js=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(Js=!1),this.showZoomControl&&(Qs.push(this.zoomInButton=new tt.Button({element:this.zoomInButton?tt.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:tt.getString("Tooltips.ZoomIn"),srcRest:us(this.prefixUrl,Gs.zoomIn.REST),srcGroup:us(this.prefixUrl,Gs.zoomIn.GROUP),srcHover:us(this.prefixUrl,Gs.zoomIn.HOVER),srcDown:us(this.prefixUrl,Gs.zoomIn.DOWN),onPress:Jr,onRelease:as,onClick:xs,onEnter:Jr,onExit:as,onFocus:Ns,onBlur:Zs})),Qs.push(this.zoomOutButton=new tt.Button({element:this.zoomOutButton?tt.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:tt.getString("Tooltips.ZoomOut"),srcRest:us(this.prefixUrl,Gs.zoomOut.REST),srcGroup:us(this.prefixUrl,Gs.zoomOut.GROUP),srcHover:us(this.prefixUrl,Gs.zoomOut.HOVER),srcDown:us(this.prefixUrl,Gs.zoomOut.DOWN),onPress:bs,onRelease:as,onClick:ws,onEnter:bs,onExit:as,onFocus:Ns,onBlur:Zs}))),this.showHomeControl&&Qs.push(this.homeButton=new tt.Button({element:this.homeButton?tt.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:tt.getString("Tooltips.Home"),srcRest:us(this.prefixUrl,Gs.home.REST),srcGroup:us(this.prefixUrl,Gs.home.GROUP),srcHover:us(this.prefixUrl,Gs.home.HOVER),srcDown:us(this.prefixUrl,Gs.home.DOWN),onRelease:Bs,onFocus:Ns,onBlur:Zs})),this.showFullPageControl&&Qs.push(this.fullPageButton=new tt.Button({element:this.fullPageButton?tt.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:tt.getString("Tooltips.FullPage"),srcRest:us(this.prefixUrl,Gs.fullpage.REST),srcGroup:us(this.prefixUrl,Gs.fullpage.GROUP),srcHover:us(this.prefixUrl,Gs.fullpage.HOVER),srcDown:us(this.prefixUrl,Gs.fullpage.DOWN),onRelease:Ps,onFocus:Ns,onBlur:Zs})),this.showRotationControl&&(Qs.push(this.rotateLeftButton=new tt.Button({element:this.rotateLeftButton?tt.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:tt.getString("Tooltips.RotateLeft"),srcRest:us(this.prefixUrl,Gs.rotateleft.REST),srcGroup:us(this.prefixUrl,Gs.rotateleft.GROUP),srcHover:us(this.prefixUrl,Gs.rotateleft.HOVER),srcDown:us(this.prefixUrl,Gs.rotateleft.DOWN),onRelease:qs,onFocus:Ns,onBlur:Zs})),Qs.push(this.rotateRightButton=new tt.Button({element:this.rotateRightButton?tt.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:tt.getString("Tooltips.RotateRight"),srcRest:us(this.prefixUrl,Gs.rotateright.REST),srcGroup:us(this.prefixUrl,Gs.rotateright.GROUP),srcHover:us(this.prefixUrl,Gs.rotateright.HOVER),srcDown:us(this.prefixUrl,Gs.rotateright.DOWN),onRelease:Ks,onFocus:Ns,onBlur:Zs}))),this.showFlipControl&&Qs.push(this.flipButton=new tt.Button({element:this.flipButton?tt.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:tt.getString("Tooltips.Flip"),srcRest:us(this.prefixUrl,Gs.flip.REST),srcGroup:us(this.prefixUrl,Gs.flip.GROUP),srcHover:us(this.prefixUrl,Gs.flip.HOVER),srcDown:us(this.prefixUrl,Gs.flip.DOWN),onRelease:zs,onFocus:Ns,onBlur:Zs})),Js&&(this.buttons=new tt.ButtonGroup({buttons:Qs,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",tt.delegate(this,Is)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||tt.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||tt.ControlAnchor.TOP_LEFT}))),this},currentPage:function(){return this._sequenceIndex},goToPage:function(Jr){return this.tileSources&&Jr>=0&&Jr<this.tileSources.length&&(this._sequenceIndex=Jr,this._updateSequenceButtons(Jr),this.open(this.tileSources[Jr]),this.referenceStrip&&this.referenceStrip.setFocus(Jr),this.raiseEvent("page",{page:Jr})),this},addOverlay:function(Jr,as,xs,bs){var ws;if(tt.isPlainObject(Jr)?ws=Jr:ws={element:Jr,location:as,placement:xs,onDraw:bs},Jr=tt.getElement(ws.element),ot(this.currentOverlays,Jr)>=0)return this;var Bs=st(this,ws);return this.currentOverlays.push(Bs),Bs.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:Jr,location:ws.location,placement:ws.placement}),this},updateOverlay:function(Jr,as,xs){var bs;return Jr=tt.getElement(Jr),bs=ot(this.currentOverlays,Jr),bs>=0&&(this.currentOverlays[bs].update(as,xs),et[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:Jr,location:as,placement:xs})),this},removeOverlay:function(Jr){var as;return Jr=tt.getElement(Jr),as=ot(this.currentOverlays,Jr),as>=0&&(this.currentOverlays[as].destroy(),this.currentOverlays.splice(as,1),et[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:Jr})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return et[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(Jr){var as;return Jr=tt.getElement(Jr),as=ot(this.currentOverlays,Jr),as>=0?this.currentOverlays[as]:null},_updateSequenceButtons:function(Jr){this.nextButton&&(!this.tileSources||this.tileSources.length-1===Jr?this.navPrevNextWrap||this.nextButton.disable():this.nextButton.enable()),this.previousButton&&(Jr>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(Jr){this._hideMessage();var as=tt.makeNeutralElement("div");as.appendChild(document.createTextNode(Jr)),this.messageDiv=tt.makeCenteredNode(as),tt.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var Jr=this.messageDiv;Jr&&(Jr.parentNode.removeChild(Jr),delete this.messageDiv)},gestureSettingsByDeviceType:function(Jr){switch(Jr){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var Jr,as=this.currentOverlays.length;for(Jr=0;Jr<as;Jr++)this.currentOverlays[Jr].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new tt.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else tt.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')}});function nt(Jr){return Jr=tt.getElement(Jr),new tt.Point(Jr.clientWidth===0?1:Jr.clientWidth,Jr.clientHeight===0?1:Jr.clientHeight)}function it(Jr,as,xs,bs,ws){var Bs=Jr;if(tt.type(as)=="string"){if(as.match(/^\s*<.*>\s*$/))as=tt.parseXml(as);else if(as.match(/^\s*[\{\[].*[\}\]]\s*$/))try{var Ps=tt.parseJSON(as);as=Ps}catch{}}function qs(Ks,zs){Ks.ready?bs(Ks):(Ks.addHandler("ready",function(){bs(Ks)}),Ks.addHandler("open-failed",function(Ns){ws({message:Ns.message,source:zs})}))}setTimeout(function(){if(tt.type(as)=="string")as=new tt.TileSource({url:as,crossOriginPolicy:xs.crossOriginPolicy!==void 0?xs.crossOriginPolicy:Jr.crossOriginPolicy,ajaxWithCredentials:Jr.ajaxWithCredentials,ajaxHeaders:Jr.ajaxHeaders,useCanvas:Jr.useCanvas,success:function(Zs){bs(Zs.tileSource)}}),as.addHandler("open-failed",function(Zs){ws(Zs)});else if(tt.isPlainObject(as)||as.nodeType)if(as.crossOriginPolicy===void 0&&(xs.crossOriginPolicy!==void 0||Jr.crossOriginPolicy!==void 0)&&(as.crossOriginPolicy=xs.crossOriginPolicy!==void 0?xs.crossOriginPolicy:Jr.crossOriginPolicy),as.ajaxWithCredentials===void 0&&(as.ajaxWithCredentials=Jr.ajaxWithCredentials),as.useCanvas===void 0&&(as.useCanvas=Jr.useCanvas),tt.isFunction(as.getTileUrl)){var Ks=new tt.TileSource(as);Ks.getTileUrl=as.getTileUrl,bs(Ks)}else{var zs=tt.TileSource.determineType(Bs,as);if(!zs){ws({message:"Unable to load TileSource",source:as});return}var Ns=zs.prototype.configure.apply(Bs,[as]);qs(new zs(Ns),as)}else qs(as,as)})}function st(Jr,as){if(as instanceof tt.Overlay)return as;var xs=null;if(as.element)xs=tt.getElement(as.element);else{var bs=as.id?as.id:"openseadragon-overlay-"+Math.floor(Math.random()*1e7);xs=tt.getElement(as.id),xs||(xs=document.createElement("a"),xs.href="#/overlay/"+bs),xs.id=bs,tt.addClass(xs,as.className?as.className:"openseadragon-overlay")}var ws=as.location,Bs=as.width,Ps=as.height;if(!ws){var qs=as.x,Ks=as.y;if(as.px!==void 0){var zs=Jr.viewport.imageToViewportRectangle(new tt.Rect(as.px,as.py,Bs||0,Ps||0));qs=zs.x,Ks=zs.y,Bs=Bs!==void 0?zs.width:void 0,Ps=Ps!==void 0?zs.height:void 0}ws=new tt.Point(qs,Ks)}var Ns=as.placement;return Ns&&tt.type(Ns)==="string"&&(Ns=tt.Placement[as.placement.toUpperCase()]),new tt.Overlay({element:xs,location:ws,placement:Ns,onDraw:as.onDraw,checkResize:as.checkResize,width:Bs,height:Ps,rotationMode:as.rotationMode})}function ot(Jr,as){var xs;for(xs=Jr.length-1;xs>=0;xs--)if(Jr[xs].element===as)return xs;return-1}function lt(Jr,as){return tt.requestAnimationFrame(function(){as(Jr)})}function ut(Jr){tt.requestAnimationFrame(function(){dt(Jr)})}function ct(Jr){Jr.autoHideControls&&(Jr.controlsShouldFade=!0,Jr.controlsFadeBeginTime=tt.now()+Jr.controlsFadeDelay,window.setTimeout(function(){ut(Jr)},Jr.controlsFadeDelay))}function dt(Jr){var as,xs,bs,ws;if(Jr.controlsShouldFade){for(as=tt.now(),xs=as-Jr.controlsFadeBeginTime,bs=1-xs/Jr.controlsFadeLength,bs=Math.min(1,bs),bs=Math.max(0,bs),ws=Jr.controls.length-1;ws>=0;ws--)Jr.controls[ws].autoFade&&Jr.controls[ws].setOpacity(bs);bs>0&&ut(Jr)}}function pt(Jr){var as;for(Jr.controlsShouldFade=!1,as=Jr.controls.length-1;as>=0;as--)Jr.controls[as].setOpacity(1)}function ft(){pt(this)}function gt(){ct(this)}function _r(Jr){var as={originalEvent:Jr.originalEvent,preventDefaultAction:Jr.preventDefaultAction,preventVerticalPan:Jr.preventVerticalPan,preventHorizontalPan:Jr.preventHorizontalPan};if(this.raiseEvent("canvas-key",as),!as.preventDefaultAction&&!Jr.ctrl&&!Jr.alt&&!Jr.meta)switch(Jr.keyCode){case 38:return as.preventVerticalPan||(Jr.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new tt.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 40:return as.preventVerticalPan||(Jr.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new tt.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 37:return as.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new tt.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;case 39:return as.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new tt.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;default:return!0}else return!0}function Yr(Jr){var as={originalEvent:Jr.originalEvent,preventDefaultAction:Jr.preventDefaultAction,preventVerticalPan:Jr.preventVerticalPan,preventHorizontalPan:Jr.preventHorizontalPan};if(this.raiseEvent("canvas-key",as),!as.preventDefaultAction&&!Jr.ctrl&&!Jr.alt&&!Jr.meta)switch(Jr.keyCode){case 43:case 61:return this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),!1;case 45:return this.viewport.zoomBy(.9),this.viewport.applyConstraints(),!1;case 48:return this.viewport.goHome(),this.viewport.applyConstraints(),!1;case 119:case 87:return as.preventVerticalPan||(Jr.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new tt.Point(0,-40))),this.viewport.applyConstraints()),!1;case 115:case 83:return as.preventVerticalPan||(Jr.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new tt.Point(0,40))),this.viewport.applyConstraints()),!1;case 97:return as.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new tt.Point(-40,0))),this.viewport.applyConstraints()),!1;case 100:return as.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new tt.Point(40,0))),this.viewport.applyConstraints()),!1;case 114:return this.viewport.flipped?this.viewport.setRotation(tt.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)):this.viewport.setRotation(tt.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 82:return this.viewport.flipped?this.viewport.setRotation(tt.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)):this.viewport.setRotation(tt.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 102:return this.viewport.toggleFlip(),!1;default:return!0}else return!0}function mt(Jr){var as,xs=document.activeElement==this.canvas;xs||this.canvas.focus(),this.viewport.flipped&&(Jr.position.x=this.viewport.getContainerSize().x-Jr.position.x);var bs={tracker:Jr.eventSource,position:Jr.position,quick:Jr.quick,shift:Jr.shift,originalEvent:Jr.originalEvent,preventDefaultAction:Jr.preventDefaultAction};this.raiseEvent("canvas-click",bs),!bs.preventDefaultAction&&this.viewport&&Jr.quick&&(as=this.gestureSettingsByDeviceType(Jr.pointerType),as.clickToZoom&&(this.viewport.zoomBy(Jr.shift?1/this.zoomPerClick:this.zoomPerClick,as.zoomToRefPoint?this.viewport.pointFromPixel(Jr.position,!0):null),this.viewport.applyConstraints()))}function Kr(Jr){var as,xs={tracker:Jr.eventSource,position:Jr.position,shift:Jr.shift,originalEvent:Jr.originalEvent,preventDefaultAction:Jr.preventDefaultAction};this.raiseEvent("canvas-double-click",xs),!xs.preventDefaultAction&&this.viewport&&(as=this.gestureSettingsByDeviceType(Jr.pointerType),as.dblClickToZoom&&(this.viewport.zoomBy(Jr.shift?1/this.zoomPerClick:this.zoomPerClick,as.zoomToRefPoint?this.viewport.pointFromPixel(Jr.position,!0):null),this.viewport.applyConstraints()))}function Xr(Jr){var as,xs={tracker:Jr.eventSource,position:Jr.position,delta:Jr.delta,speed:Jr.speed,direction:Jr.direction,shift:Jr.shift,originalEvent:Jr.originalEvent,preventDefaultAction:Jr.preventDefaultAction};if(this.raiseEvent("canvas-drag",xs),!xs.preventDefaultAction&&this.viewport){if(as=this.gestureSettingsByDeviceType(Jr.pointerType),this.panHorizontal||(Jr.delta.x=0),this.panVertical||(Jr.delta.y=0),this.viewport.flipped&&(Jr.delta.x=-Jr.delta.x),this.constrainDuringPan){var bs=this.viewport.deltaPointsFromPixels(Jr.delta.negate());this.viewport.centerSpringX.target.value+=bs.x,this.viewport.centerSpringY.target.value+=bs.y;var ws=this.viewport.getBounds(),Bs=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=bs.x,this.viewport.centerSpringY.target.value-=bs.y,ws.x!=Bs.x&&(Jr.delta.x=0),ws.y!=Bs.y&&(Jr.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(Jr.delta.negate()),as.flickEnabled&&!this.constrainDuringPan)}}function Zr(Jr){if(!Jr.preventDefaultAction&&this.viewport){var as=this.gestureSettingsByDeviceType(Jr.pointerType);if(as.flickEnabled&&Jr.speed>=as.flickMinSpeed){var xs=0;this.panHorizontal&&(xs=as.flickMomentum*Jr.speed*Math.cos(Jr.direction));var bs=0;this.panVertical&&(bs=as.flickMomentum*Jr.speed*Math.sin(Jr.direction));var ws=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),Bs=this.viewport.pointFromPixel(new tt.Point(ws.x-xs,ws.y-bs));this.viewport.panTo(Bs,!1)}this.viewport.applyConstraints()}this.raiseEvent("canvas-drag-end",{tracker:Jr.eventSource,position:Jr.position,speed:Jr.speed,direction:Jr.direction,shift:Jr.shift,originalEvent:Jr.originalEvent})}function Qr(Jr){this.raiseEvent("canvas-enter",{tracker:Jr.eventSource,pointerType:Jr.pointerType,position:Jr.position,buttons:Jr.buttons,pointers:Jr.pointers,insideElementPressed:Jr.insideElementPressed,buttonDownAny:Jr.buttonDownAny,originalEvent:Jr.originalEvent})}function _i(Jr){window.location!=window.parent.location&&tt.MouseTracker.resetAllMouseTrackers(),this.raiseEvent("canvas-exit",{tracker:Jr.eventSource,pointerType:Jr.pointerType,position:Jr.position,buttons:Jr.buttons,pointers:Jr.pointers,insideElementPressed:Jr.insideElementPressed,buttonDownAny:Jr.buttonDownAny,originalEvent:Jr.originalEvent})}function ns(Jr){this.raiseEvent("canvas-press",{tracker:Jr.eventSource,pointerType:Jr.pointerType,position:Jr.position,insideElementPressed:Jr.insideElementPressed,insideElementReleased:Jr.insideElementReleased,originalEvent:Jr.originalEvent})}function rs(Jr){this.raiseEvent("canvas-release",{tracker:Jr.eventSource,pointerType:Jr.pointerType,position:Jr.position,insideElementPressed:Jr.insideElementPressed,insideElementReleased:Jr.insideElementReleased,originalEvent:Jr.originalEvent})}function ss(Jr){this.raiseEvent("canvas-nonprimary-press",{tracker:Jr.eventSource,position:Jr.position,pointerType:Jr.pointerType,button:Jr.button,buttons:Jr.buttons,originalEvent:Jr.originalEvent})}function hs(Jr){this.raiseEvent("canvas-nonprimary-release",{tracker:Jr.eventSource,position:Jr.position,pointerType:Jr.pointerType,button:Jr.button,buttons:Jr.buttons,originalEvent:Jr.originalEvent})}function os(Jr){var as,xs,bs,ws;if(!Jr.preventDefaultAction&&this.viewport&&(as=this.gestureSettingsByDeviceType(Jr.pointerType),as.pinchToZoom&&(xs=this.viewport.pointFromPixel(Jr.center,!0),bs=this.viewport.pointFromPixel(Jr.lastCenter,!0),ws=bs.minus(xs),this.panHorizontal||(ws.x=0),this.panVertical||(ws.y=0),this.viewport.zoomBy(Jr.distance/Jr.lastDistance,xs,!0),as.zoomToRefPoint&&this.viewport.panBy(ws,!0),this.viewport.applyConstraints()),as.pinchRotate)){var Bs=Math.atan2(Jr.gesturePoints[0].currentPos.y-Jr.gesturePoints[1].currentPos.y,Jr.gesturePoints[0].currentPos.x-Jr.gesturePoints[1].currentPos.x),Ps=Math.atan2(Jr.gesturePoints[0].lastPos.y-Jr.gesturePoints[1].lastPos.y,Jr.gesturePoints[0].lastPos.x-Jr.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(Bs-Ps)*(180/Math.PI))}return this.raiseEvent("canvas-pinch",{tracker:Jr.eventSource,gesturePoints:Jr.gesturePoints,lastCenter:Jr.lastCenter,center:Jr.center,lastDistance:Jr.lastDistance,distance:Jr.distance,shift:Jr.shift,originalEvent:Jr.originalEvent}),!1}function is(Jr){var as,xs,bs,ws;if(bs=tt.now(),ws=bs-this._lastScrollTime,ws>this.minScrollDeltaTime){if(this._lastScrollTime=bs,this.viewport.flipped&&(Jr.position.x=this.viewport.getContainerSize().x-Jr.position.x),!Jr.preventDefaultAction&&this.viewport&&(as=this.gestureSettingsByDeviceType(Jr.pointerType),as.scrollToZoom&&(xs=Math.pow(this.zoomPerScroll,Jr.scroll),this.viewport.zoomBy(xs,as.zoomToRefPoint?this.viewport.pointFromPixel(Jr.position,!0):null),this.viewport.applyConstraints())),this.raiseEvent("canvas-scroll",{tracker:Jr.eventSource,position:Jr.position,scroll:Jr.scroll,shift:Jr.shift,originalEvent:Jr.originalEvent}),as&&as.scrollToZoom)return!1}else if(as=this.gestureSettingsByDeviceType(Jr.pointerType),as&&as.scrollToZoom)return!1}function cs(Jr){et[this.hash].mouseInside=!0,pt(this),this.raiseEvent("container-enter",{tracker:Jr.eventSource,position:Jr.position,buttons:Jr.buttons,pointers:Jr.pointers,insideElementPressed:Jr.insideElementPressed,buttonDownAny:Jr.buttonDownAny,originalEvent:Jr.originalEvent})}function ps(Jr){Jr.pointers<1&&(et[this.hash].mouseInside=!1,et[this.hash].animating||ct(this)),this.raiseEvent("container-exit",{tracker:Jr.eventSource,position:Jr.position,buttons:Jr.buttons,pointers:Jr.pointers,insideElementPressed:Jr.insideElementPressed,buttonDownAny:Jr.buttonDownAny,originalEvent:Jr.originalEvent})}function vs(Jr){ls(Jr),Jr.isOpen()?Jr._updateRequestId=lt(Jr,vs):Jr._updateRequestId=!1}function ls(Jr){if(!Jr._opening){if(Jr.autoResize){var as=nt(Jr.container),xs=et[Jr.hash].prevContainerSize;if(!as.equals(xs)){var bs=Jr.viewport;if(Jr.preserveImageSizeOnResize){var ws=xs.x/as.x,Bs=bs.getZoom()*ws,Ps=bs.getCenter();bs.resize(as,!1),bs.zoomTo(Bs,null,!0),bs.panTo(Ps,!0)}else{var qs=bs.getBounds();bs.resize(as,!0),bs.fitBoundsWithConstraints(qs,!0)}et[Jr.hash].prevContainerSize=as,et[Jr.hash].forceRedraw=!0}}var Ks=Jr.viewport.update(),zs=Jr.world.update()||Ks;Ks&&Jr.raiseEvent("viewport-change"),Jr.referenceStrip&&(zs=Jr.referenceStrip.update(Jr.viewport)||zs),!et[Jr.hash].animating&&zs&&(Jr.raiseEvent("animation-start"),pt(Jr)),(zs||et[Jr.hash].forceRedraw||Jr.world.needsDraw())&&(ms(Jr),Jr._drawOverlays(),Jr.navigator&&Jr.navigator.update(Jr.viewport),et[Jr.hash].forceRedraw=!1,zs&&Jr.raiseEvent("animation")),et[Jr.hash].animating&&!zs&&(Jr.raiseEvent("animation-finish"),et[Jr.hash].mouseInside||ct(Jr)),et[Jr.hash].animating=zs}}function ms(Jr){Jr.imageLoader.clear(),Jr.drawer.clear(),Jr.world.draw(),Jr.raiseEvent("update-viewport",{})}function us(Jr,as){return Jr?Jr+as:as}function gs(){et[this.hash].lastZoomTime=tt.now(),et[this.hash].zoomFactor=this.zoomPerSecond,et[this.hash].zooming=!0,Ss(this)}function ys(){et[this.hash].lastZoomTime=tt.now(),et[this.hash].zoomFactor=1/this.zoomPerSecond,et[this.hash].zooming=!0,Ss(this)}function Es(){et[this.hash].zooming=!1}function Ss(Jr){tt.requestAnimationFrame(tt.delegate(Jr,Ts))}function Ts(){var Jr,as,xs;et[this.hash].zooming&&this.viewport&&(Jr=tt.now(),as=Jr-et[this.hash].lastZoomTime,xs=Math.pow(et[this.hash].zoomFactor,as/1e3),this.viewport.zoomBy(xs),this.viewport.applyConstraints(),et[this.hash].lastZoomTime=Jr,Ss(this))}function Ds(){this.viewport&&(et[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function Rs(){this.viewport&&(et[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function Is(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function ks(){this.viewport&&this.viewport.goHome()}function As(){this.isFullPage()&&!tt.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function Os(){if(this.viewport){var Jr=this.viewport.getRotation();this.viewport.flipped?Jr=tt.positiveModulo(Jr+this.rotationIncrement,360):Jr=tt.positiveModulo(Jr-this.rotationIncrement,360),this.viewport.setRotation(Jr)}}function Ys(){if(this.viewport){var Jr=this.viewport.getRotation();this.viewport.flipped?Jr=tt.positiveModulo(Jr-this.rotationIncrement,360):Jr=tt.positiveModulo(Jr+this.rotationIncrement,360),this.viewport.setRotation(Jr)}}function Vs(){this.viewport.toggleFlip()}function js(){var Jr=this._sequenceIndex-1;this.navPrevNextWrap&&Jr<0&&(Jr+=this.tileSources.length),this.goToPage(Jr)}function Ws(){var Jr=this._sequenceIndex+1;this.navPrevNextWrap&&Jr>=this.tileSources.length&&(Jr=0),this.goToPage(Jr)}}(OpenSeadragon),function(tt){tt.Navigator=function(lt){var ut=lt.viewer,ct=this,dt,pt;lt.id?(this.element=document.getElementById(lt.id),lt.controlOptions={anchor:tt.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(lt.id="navigator-"+tt.now(),this.element=tt.makeNeutralElement("div"),lt.controlOptions={anchor:tt.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:lt.autoFade},lt.position&&(lt.position=="BOTTOM_RIGHT"?lt.controlOptions.anchor=tt.ControlAnchor.BOTTOM_RIGHT:lt.position=="BOTTOM_LEFT"?lt.controlOptions.anchor=tt.ControlAnchor.BOTTOM_LEFT:lt.position=="TOP_RIGHT"?lt.controlOptions.anchor=tt.ControlAnchor.TOP_RIGHT:lt.position=="TOP_LEFT"?lt.controlOptions.anchor=tt.ControlAnchor.TOP_LEFT:lt.position=="ABSOLUTE"&&(lt.controlOptions.anchor=tt.ControlAnchor.ABSOLUTE,lt.controlOptions.top=lt.top,lt.controlOptions.left=lt.left,lt.controlOptions.height=lt.height,lt.controlOptions.width=lt.width))),this.element.id=lt.id,this.element.className+=" navigator",lt=tt.extend(!0,{sizeRatio:tt.DEFAULT_SETTINGS.navigatorSizeRatio},lt,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:lt.autoResize,minZoomImageRatio:1,background:lt.background,opacity:lt.opacity,borderColor:lt.borderColor,displayRegionColor:lt.displayRegionColor}),lt.minPixelRatio=this.minPixelRatio=ut.minPixelRatio,tt.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new tt.Point(1,1),this.totalBorderWidths=new tt.Point(this.borderWidth*2,this.borderWidth*2).minus(this.fudge),lt.controlOptions.anchor!=tt.ControlAnchor.NONE&&function(_r,Yr){_r.margin="0px",_r.border=Yr+"px solid "+lt.borderColor,_r.padding="0px",_r.background=lt.background,_r.opacity=lt.opacity,_r.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=tt.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(_r,Yr){_r.position="relative",_r.top="0px",_r.left="0px",_r.fontSize="0px",_r.overflow="hidden",_r.border=Yr+"px solid "+lt.displayRegionColor,_r.margin="0px",_r.padding="0px",_r.background="transparent",_r.float="left",_r.cssFloat="left",_r.styleFloat="left",_r.zIndex=999999999,_r.cursor="default"}(this.displayRegion.style,this.borderWidth),this.displayRegionContainer=tt.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",ut.addControl(this.element,lt.controlOptions),this._resizeWithViewer=lt.controlOptions.anchor!=tt.ControlAnchor.ABSOLUTE&&lt.controlOptions.anchor!=tt.ControlAnchor.NONE,lt.width&&lt.height?(this.setWidth(lt.width),this.setHeight(lt.height)):this._resizeWithViewer&&(dt=tt.getElementSize(ut.element),this.element.style.height=Math.round(dt.y*lt.sizeRatio)+"px",this.element.style.width=Math.round(dt.x*lt.sizeRatio)+"px",this.oldViewerSize=dt,pt=tt.getElementSize(this.element),this.elementArea=pt.x*pt.y),this.oldContainerSize=new tt.Point(0,0),tt.Viewer.apply(this,[lt]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer);function ft(_r){st(ct.displayRegionContainer,_r),st(ct.displayRegion,-_r),ct.viewport.setRotation(_r)}if(lt.navigatorRotate){var gt=lt.viewer.viewport?lt.viewer.viewport.getRotation():lt.viewer.degrees||0;ft(gt),lt.viewer.addHandler("rotate",function(_r){ft(_r.degrees)})}this.innerTracker.destroy(),this.innerTracker=new tt.MouseTracker({element:this.element,dragHandler:tt.delegate(this,rt),clickHandler:tt.delegate(this,et),releaseHandler:tt.delegate(this,nt),scrollHandler:tt.delegate(this,it)}),this.addHandler("reset-size",function(){ct.viewport&&ct.viewport.goHome(!0)}),ut.world.addHandler("item-index-change",function(_r){window.setTimeout(function(){var Yr=ct.world.getItemAt(_r.previousIndex);ct.world.setItemIndex(Yr,_r.newIndex)},1)}),ut.world.addHandler("remove-item",function(_r){var Yr=_r.item,mt=ct._getMatchingItem(Yr);mt&&ct.world.removeItem(mt)}),this.update(ut.viewport)},tt.extend(tt.Navigator.prototype,tt.EventSource.prototype,tt.Viewer.prototype,{updateSize:function(){if(this.viewport){var lt=new tt.Point(this.container.clientWidth===0?1:this.container.clientWidth,this.container.clientHeight===0?1:this.container.clientHeight);lt.equals(this.oldContainerSize)||(this.viewport.resize(lt,!0),this.viewport.goHome(!0),this.oldContainerSize=lt,this.drawer.clear(),this.world.draw())}},setWidth:function(lt){this.width=lt,this.element.style.width=typeof lt=="number"?lt+"px":lt,this._resizeWithViewer=!1},setHeight:function(lt){this.height=lt,this.element.style.height=typeof lt=="number"?lt+"px":lt,this._resizeWithViewer=!1},setFlip:function(lt){return this.viewport.setFlip(lt),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(lt){ot(this.displayRegion,lt),ot(this.canvas,lt),ot(this.element,lt)},update:function(lt){var ut,ct,dt,pt,ft,gt;if(ut=tt.getElementSize(this.viewer.element),this._resizeWithViewer&&ut.x&&ut.y&&!ut.equals(this.oldViewerSize)&&(this.oldViewerSize=ut,this.maintainSizeRatio||!this.elementArea?(ct=ut.x*this.sizeRatio,dt=ut.y*this.sizeRatio):(ct=Math.sqrt(this.elementArea*(ut.x/ut.y)),dt=this.elementArea/ct),this.element.style.width=Math.round(ct)+"px",this.element.style.height=Math.round(dt)+"px",this.elementArea||(this.elementArea=ct*dt),this.updateSize()),lt&&this.viewport){pt=lt.getBoundsNoRotate(!0),ft=this.viewport.pixelFromPointNoRotate(pt.getTopLeft(),!1),gt=this.viewport.pixelFromPointNoRotate(pt.getBottomRight(),!1).minus(this.totalBorderWidths);var _r=this.displayRegion.style;_r.display=this.world.getItemCount()?"block":"none",_r.top=Math.round(ft.y)+"px",_r.left=Math.round(ft.x)+"px";var Yr=Math.abs(ft.x-gt.x),mt=Math.abs(ft.y-gt.y);_r.width=Math.round(Math.max(Yr,0))+"px",_r.height=Math.round(Math.max(mt,0))+"px"}},addTiledImage:function(lt){var ut=this,ct=lt.originalTiledImage;delete lt.original;var dt=tt.extend({},lt,{success:function(pt){var ft=pt.item;ft._originalForNavigator=ct,ut._matchBounds(ft,ct,!0);function gt(){ut._matchBounds(ft,ct)}function _r(){ut._matchOpacity(ft,ct)}function Yr(){ut._matchCompositeOperation(ft,ct)}ct.addHandler("bounds-change",gt),ct.addHandler("clip-change",gt),ct.addHandler("opacity-change",_r),ct.addHandler("composite-operation-change",Yr)}});return tt.Viewer.prototype.addTiledImage.apply(this,[dt])},_getMatchingItem:function(lt){for(var ut=this.world.getItemCount(),ct,dt=0;dt<ut;dt++)if(ct=this.world.getItemAt(dt),ct._originalForNavigator===lt)return ct;return null},_matchBounds:function(lt,ut,ct){var dt=ut.getBoundsNoRotate();lt.setPosition(dt.getTopLeft(),ct),lt.setWidth(dt.width,ct),lt.setRotation(ut.getRotation(),ct),lt.setClip(ut.getClip())},_matchOpacity:function(lt,ut){lt.setOpacity(ut.opacity)},_matchCompositeOperation:function(lt,ut){lt.setCompositeOperation(ut.compositeOperation)}});function et(lt){var ut={tracker:lt.eventSource,position:lt.position,quick:lt.quick,shift:lt.shift,originalEvent:lt.originalEvent,preventDefaultAction:lt.preventDefaultAction};if(this.viewer.raiseEvent("navigator-click",ut),!ut.preventDefaultAction&&lt.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(lt.position.x=this.viewport.getContainerSize().x-lt.position.x);var ct=this.viewport.pointFromPixel(lt.position);this.panVertical?this.panHorizontal||(ct.x=this.viewer.viewport.getCenter(!0).x):ct.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(ct),this.viewer.viewport.applyConstraints()}}function rt(lt){var ut={tracker:lt.eventSource,position:lt.position,delta:lt.delta,speed:lt.speed,direction:lt.direction,shift:lt.shift,originalEvent:lt.originalEvent,preventDefaultAction:lt.preventDefaultAction};this.viewer.raiseEvent("navigator-drag",ut),!ut.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(lt.delta.x=0),this.panVertical||(lt.delta.y=0),this.viewer.viewport.flipped&&(lt.delta.x=-lt.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(lt.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function nt(lt){lt.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function it(lt){return this.viewer.raiseEvent("navigator-scroll",{tracker:lt.eventSource,position:lt.position,scroll:lt.scroll,shift:lt.shift,originalEvent:lt.originalEvent}),!1}function st(lt,ut){ot(lt,"rotate("+ut+"deg)")}function ot(lt,ut){lt.style.webkitTransform=ut,lt.style.mozTransform=ut,lt.style.msTransform=ut,lt.style.oTransform=ut,lt.style.transform=ut}}(OpenSeadragon),function(tt){var et={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};tt.extend(tt,{getString:function(rt){var nt=rt.split("."),it=null,st=arguments,ot=et,lt;for(lt=0;lt<nt.length-1;lt++)ot=ot[nt[lt]]||{};return it=ot[nt[lt]],typeof it!="string"&&(tt.console.log("Untranslated source string:",rt),it=""),it.replace(/\{\d+\}/g,function(ut){var ct=parseInt(ut.match(/\d+/),10)+1;return ct<st.length?st[ct]:""})},setString:function(rt,nt){var it=rt.split("."),st=et,ot;for(ot=0;ot<it.length-1;ot++)st[it[ot]]||(st[it[ot]]={}),st=st[it[ot]];st[it[ot]]=nt}})}(OpenSeadragon),function(tt){tt.Point=function(et,rt){this.x=typeof et=="number"?et:0,this.y=typeof rt=="number"?rt:0},tt.Point.prototype={clone:function(){return new tt.Point(this.x,this.y)},plus:function(et){return new tt.Point(this.x+et.x,this.y+et.y)},minus:function(et){return new tt.Point(this.x-et.x,this.y-et.y)},times:function(et){return new tt.Point(this.x*et,this.y*et)},divide:function(et){return new tt.Point(this.x/et,this.y/et)},negate:function(){return new tt.Point(-this.x,-this.y)},distanceTo:function(et){return Math.sqrt(Math.pow(this.x-et.x,2)+Math.pow(this.y-et.y,2))},squaredDistanceTo:function(et){return Math.pow(this.x-et.x,2)+Math.pow(this.y-et.y,2)},apply:function(et){return new tt.Point(et(this.x),et(this.y))},equals:function(et){return et instanceof tt.Point&&this.x===et.x&&this.y===et.y},rotate:function(et,rt){rt=rt||new tt.Point(0,0);var nt,it;if(et%90===0){var st=tt.positiveModulo(et,360);switch(st){case 0:nt=1,it=0;break;case 90:nt=0,it=1;break;case 180:nt=-1,it=0;break;case 270:nt=0,it=-1;break}}else{var ot=et*Math.PI/180;nt=Math.cos(ot),it=Math.sin(ot)}var lt=nt*(this.x-rt.x)-it*(this.y-rt.y)+rt.x,ut=it*(this.x-rt.x)+nt*(this.y-rt.y)+rt.y;return new tt.Point(lt,ut)},toString:function(){return"("+Math.round(this.x*100)/100+","+Math.round(this.y*100)/100+")"}}}(OpenSeadragon),function(tt){tt.TileSource=function(rt,nt,it,st,ot,lt){var ut=this,ct=arguments,dt,pt;if(tt.isPlainObject(rt)?dt=rt:dt={width:ct[0],height:ct[1],tileSize:ct[2],tileOverlap:ct[3],minLevel:ct[4],maxLevel:ct[5]},tt.EventSource.call(this),tt.extend(!0,this,dt),!this.success){for(pt=0;pt<arguments.length;pt++)if(tt.isFunction(arguments[pt])){this.success=arguments[pt];break}}this.success&&this.addHandler("ready",function(ft){ut.success(ft)}),tt.type(arguments[0])=="string"&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new tt.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=dt.width&&dt.height?dt.width/dt.height:1,this.dimensions=new tt.Point(dt.width,dt.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=dt.tileOverlap?dt.tileOverlap:0,this.minLevel=dt.minLevel?dt.minLevel:0,this.maxLevel=dt.maxLevel!==void 0&&dt.maxLevel!==null?dt.maxLevel:dt.width&&dt.height?Math.ceil(Math.log(Math.max(dt.width,dt.height))/Math.log(2)):0,this.success&&tt.isFunction(this.success)&&this.success(this))},tt.TileSource.prototype={getTileSize:function(rt){return tt.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(rt){return this._tileWidth?this._tileWidth:this.getTileSize(rt)},getTileHeight:function(rt){return this._tileHeight?this._tileHeight:this.getTileSize(rt)},getLevelScale:function(rt){var nt={},it;for(it=0;it<=this.maxLevel;it++)nt[it]=1/Math.pow(2,this.maxLevel-it);return this.getLevelScale=function(st){return nt[st]},this.getLevelScale(rt)},getNumTiles:function(rt){var nt=this.getLevelScale(rt),it=Math.ceil(nt*this.dimensions.x/this.getTileWidth(rt)),st=Math.ceil(nt*this.dimensions.y/this.getTileHeight(rt));return new tt.Point(it,st)},getPixelRatio:function(rt){var nt=this.dimensions.times(this.getLevelScale(rt)),it=1/nt.x,st=1/nt.y;return new tt.Point(it,st)},getClosestLevel:function(){var rt,nt;for(rt=this.minLevel+1;rt<=this.maxLevel&&(nt=this.getNumTiles(rt),!(nt.x>1||nt.y>1));rt++);return rt-1},getTileAtPoint:function(rt,nt){var it=nt.x>=0&&nt.x<=1&&nt.y>=0&&nt.y<=1/this.aspectRatio;tt.console.assert(it,"[TileSource.getTileAtPoint] must be called with a valid point.");var st=this.dimensions.x*this.getLevelScale(rt),ot=nt.x*st,lt=nt.y*st,ut=Math.floor(ot/this.getTileWidth(rt)),ct=Math.floor(lt/this.getTileHeight(rt));nt.x>=1&&(ut=this.getNumTiles(rt).x-1);var dt=1e-15;return nt.y>=1/this.aspectRatio-dt&&(ct=this.getNumTiles(rt).y-1),new tt.Point(ut,ct)},getTileBounds:function(rt,nt,it,st){var ot=this.dimensions.times(this.getLevelScale(rt)),lt=this.getTileWidth(rt),ut=this.getTileHeight(rt),ct=nt===0?0:lt*nt-this.tileOverlap,dt=it===0?0:ut*it-this.tileOverlap,pt=lt+(nt===0?1:2)*this.tileOverlap,ft=ut+(it===0?1:2)*this.tileOverlap,gt=1/ot.x;return pt=Math.min(pt,ot.x-ct),ft=Math.min(ft,ot.y-dt),st?new tt.Rect(0,0,pt,ft):new tt.Rect(ct*gt,dt*gt,pt*gt,ft*gt)},getImageInfo:function(rt){var nt=this,it,st,ot,lt,ut,ct,dt;rt&&(ut=rt.split("/"),ct=ut[ut.length-1],dt=ct.lastIndexOf("."),dt>-1&&(ut[ut.length-1]=ct.slice(0,dt))),st=function(pt){typeof pt=="string"&&(pt=tt.parseXml(pt));var ft=tt.TileSource.determineType(nt,pt,rt);if(!ft){nt.raiseEvent("open-failed",{message:"Unable to load TileSource",source:rt});return}lt=ft.prototype.configure.apply(nt,[pt,rt]),lt.ajaxWithCredentials===void 0&&(lt.ajaxWithCredentials=nt.ajaxWithCredentials),ot=new ft(lt),nt.ready=!0,nt.raiseEvent("ready",{tileSource:ot})},rt.match(/\.js$/)?(it=rt.split("/").pop().replace(".js",""),tt.jsonp({url:rt,async:!1,callbackName:it,callback:st})):tt.makeAjaxRequest({url:rt,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(pt){var ft=et(pt);st(ft)},error:function(pt,ft){var gt;try{gt="HTTP "+pt.status+" attempting to load TileSource"}catch{var _r;typeof ft>"u"||!ft.toString?_r="Unknown error":_r=ft.toString(),gt=_r+" attempting to load TileSource"}nt.raiseEvent("open-failed",{message:gt,source:rt})}})},supports:function(rt,nt){return!1},configure:function(rt,nt){throw new Error("Method not implemented.")},getTileUrl:function(rt,nt,it){throw new Error("Method not implemented.")},getTileAjaxHeaders:function(rt,nt,it){return{}},tileExists:function(rt,nt,it){var st=this.getNumTiles(rt);return rt>=this.minLevel&&rt<=this.maxLevel&&nt>=0&&it>=0&&nt<st.x&&it<st.y}},tt.extend(!0,tt.TileSource.prototype,tt.EventSource.prototype);function et(rt){var nt=rt.responseText,it=rt.status,st,ot;if(rt){if(rt.status!==200&&rt.status!==0)throw it=rt.status,st=it==404?"Not Found":rt.statusText,new Error(tt.getString("Errors.Status",it,st))}else throw new Error(tt.getString("Errors.Security"));if(nt.match(/\s*<.*/))try{ot=rt.responseXML&&rt.responseXML.documentElement?rt.responseXML:tt.parseXml(nt)}catch{ot=rt.responseText}else if(nt.match(/\s*[\{\[].*/))try{ot=tt.parseJSON(nt)}catch{ot=nt}else ot=nt;return ot}tt.TileSource.determineType=function(rt,nt,it){var st;for(st in OpenSeadragon)if(st.match(/.+TileSource$/)&&tt.isFunction(OpenSeadragon[st])&&tt.isFunction(OpenSeadragon[st].prototype.supports)&&OpenSeadragon[st].prototype.supports.call(rt,nt,it))return OpenSeadragon[st];tt.console.error("No TileSource was able to open %s %s",it,nt)}}(OpenSeadragon),function(tt){tt.DziTileSource=function(nt,it,st,ot,lt,ut,ct,dt,pt){var ft,gt,_r,Yr;if(tt.isPlainObject(nt)?Yr=nt:Yr={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=Yr.tilesUrl,this.fileFormat=Yr.fileFormat,this.displayRects=Yr.displayRects,this.displayRects)for(ft=this.displayRects.length-1;ft>=0;ft--)for(gt=this.displayRects[ft],_r=gt.minLevel;_r<=gt.maxLevel;_r++)this._levelRects[_r]||(this._levelRects[_r]=[]),this._levelRects[_r].push(gt);tt.TileSource.apply(this,[Yr])},tt.extend(tt.DziTileSource.prototype,tt.TileSource.prototype,{supports:function(nt,it){var st;return nt.Image?st=nt.Image.xmlns:nt.documentElement&&(nt.documentElement.localName=="Image"||nt.documentElement.tagName=="Image")&&(st=nt.documentElement.namespaceURI),st=(st||"").toLowerCase(),st.indexOf("schemas.microsoft.com/deepzoom/2008")!==-1||st.indexOf("schemas.microsoft.com/deepzoom/2009")!==-1},configure:function(nt,it){var st;return tt.isPlainObject(nt)?st=rt(this,nt):st=et(this,nt),it&&!st.tilesUrl&&(st.tilesUrl=it.replace(/([^\/]+?)(\.(dzi|xml|js)?(\?[^\/]*)?)?\/?$/,"$1_files/"),it.search(/\.(dzi|xml|js)\?/)!=-1?st.queryParams=it.match(/\?.*/):st.queryParams=""),st},getTileUrl:function(nt,it,st){return[this.tilesUrl,nt,"/",it,"_",st,".",this.fileFormat,this.queryParams].join("")},tileExists:function(nt,it,st){var ot=this._levelRects[nt],lt,ut,ct,dt,pt,ft,gt;if(this.minLevel&&nt<this.minLevel||this.maxLevel&&nt>this.maxLevel)return!1;if(!ot||!ot.length)return!0;for(gt=ot.length-1;gt>=0;gt--)if(lt=ot[gt],!(nt<lt.minLevel||nt>lt.maxLevel)&&(ut=this.getLevelScale(nt),ct=lt.x*ut,dt=lt.y*ut,pt=ct+lt.width*ut,ft=dt+lt.height*ut,ct=Math.floor(ct/this._tileWidth),dt=Math.floor(dt/this._tileWidth),pt=Math.ceil(pt/this._tileWidth),ft=Math.ceil(ft/this._tileWidth),ct<=it&&it<pt&&dt<=st&&st<ft))return!0;return!1}});function et(nt,it){if(!it||!it.documentElement)throw new Error(tt.getString("Errors.Xml"));var st=it.documentElement,ot=st.localName||st.tagName,lt=it.documentElement.namespaceURI,ut=null,ct=[],dt,pt,ft,gt,_r;if(ot=="Image")try{if(gt=st.getElementsByTagName("Size")[0],gt===void 0&&(gt=st.getElementsByTagNameNS(lt,"Size")[0]),ut={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:st.getAttribute("Url"),Format:st.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(st.getAttribute("Overlap"),10),TileSize:parseInt(st.getAttribute("TileSize"),10),Size:{Height:parseInt(gt.getAttribute("Height"),10),Width:parseInt(gt.getAttribute("Width"),10)}}},!tt.imageFormatSupported(ut.Image.Format))throw new Error(tt.getString("Errors.ImageFormat",ut.Image.Format.toUpperCase()));for(dt=st.getElementsByTagName("DisplayRect"),dt===void 0&&(dt=st.getElementsByTagNameNS(lt,"DisplayRect")[0]),_r=0;_r<dt.length;_r++)pt=dt[_r],ft=pt.getElementsByTagName("Rect")[0],ft===void 0&&(ft=pt.getElementsByTagNameNS(lt,"Rect")[0]),ct.push({Rect:{X:parseInt(ft.getAttribute("X"),10),Y:parseInt(ft.getAttribute("Y"),10),Width:parseInt(ft.getAttribute("Width"),10),Height:parseInt(ft.getAttribute("Height"),10),MinLevel:parseInt(pt.getAttribute("MinLevel"),10),MaxLevel:parseInt(pt.getAttribute("MaxLevel"),10)}});return ct.length&&(ut.Image.DisplayRect=ct),rt(nt,ut)}catch(Kr){throw Kr instanceof Error?Kr:new Error(tt.getString("Errors.Dzi"))}else{if(ot=="Collection")throw new Error(tt.getString("Errors.Dzc"));if(ot=="Error"){var Yr=st.getElementsByTagName("Message")[0],mt=Yr.firstChild.nodeValue;throw new Error(mt)}}throw new Error(tt.getString("Errors.Dzi"))}function rt(nt,it){var st=it.Image,ot=st.Url,lt=st.Format,ut=st.Size,ct=st.DisplayRect||[],dt=parseInt(ut.Width,10),pt=parseInt(ut.Height,10),ft=parseInt(st.TileSize,10),gt=parseInt(st.Overlap,10),_r=[],Yr,mt;for(mt=0;mt<ct.length;mt++)Yr=ct[mt].Rect,_r.push(new tt.DisplayRect(parseInt(Yr.X,10),parseInt(Yr.Y,10),parseInt(Yr.Width,10),parseInt(Yr.Height,10),parseInt(Yr.MinLevel,10),parseInt(Yr.MaxLevel,10)));return tt.extend(!0,{width:dt,height:pt,tileSize:ft,tileOverlap:gt,minLevel:null,maxLevel:null,tilesUrl:ot,fileFormat:lt,displayRects:_r},it)}}(OpenSeadragon),function(tt){tt.IIIFTileSource=function(st){if(tt.extend(!0,this,st),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(st.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=st.version,this.tile_width&&this.tile_height)st.tileWidth=this.tile_width,st.tileHeight=this.tile_height;else if(this.tile_width)st.tileSize=this.tile_width;else if(this.tile_height)st.tileSize=this.tile_height;else if(this.tiles)if(this.tiles.length==1)st.tileWidth=this.tiles[0].width,st.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var ot=0;ot<this.tiles.length;ot++)for(var lt=0;lt<this.tiles[ot].scaleFactors.length;lt++){var ut=this.tiles[ot].scaleFactors[lt];this.scale_factors.push(ut),st.tileSizePerScaleFactor[ut]={width:this.tiles[ot].width,height:this.tiles[ot].height||this.tiles[ot].width}}}else if(et(st)){for(var ct=Math.min(this.height,this.width),dt=[256,512,1024],pt=[],ft=0;ft<dt.length;ft++)dt[ft]<=ct&&pt.push(dt[ft]);pt.length>0?st.tileSize=Math.max.apply(null,pt):st.tileSize=ct}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,st.levels=rt(this),tt.extend(!0,st,{width:st.levels[st.levels.length-1].width,height:st.levels[st.levels.length-1].height,tileSize:Math.max(st.height,st.width),tileOverlap:0,minLevel:0,maxLevel:st.levels.length-1}),this.levels=st.levels):tt.console.error("Nothing in the info.json to construct image pyramids from");if(!st.maxLevel&&!this.emulateLegacyImagePyramid)if(!this.scale_factors)st.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)));else{var gt=Math.max.apply(null,this.scale_factors);st.maxLevel=Math.round(Math.log(gt)*Math.LOG2E)}tt.TileSource.apply(this,[st])},tt.extend(tt.IIIFTileSource.prototype,tt.TileSource.prototype,{supports:function(st,ot){return st.protocol&&st.protocol=="http://iiif.io/api/image"||st["@context"]&&(st["@context"]=="http://library.stanford.edu/iiif/image-api/1.1/context.json"||st["@context"]=="http://iiif.io/api/image/1/context.json")||st.profile&&st.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")===0||st.identifier&&st.width&&st.height?!0:!!(st.documentElement&&st.documentElement.tagName=="info"&&st.documentElement.namespaceURI=="http://library.stanford.edu/iiif/image-api/ns/")},configure:function(st,ot){if(tt.isPlainObject(st)){if(!st["@context"])st["@context"]="http://iiif.io/api/image/1.0/context.json",st["@id"]=ot.replace("/info.json",""),st.version=1;else{var ut=st["@context"];if(Array.isArray(ut)){for(var ct=0;ct<ut.length;ct++)if(typeof ut[ct]=="string"&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(ut[ct])||ut[ct]==="http://library.stanford.edu/iiif/image-api/1.1/context.json")){ut=ut[ct];break}}switch(ut){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":st.version=1;break;case"http://iiif.io/api/image/2/context.json":st.version=2;break;case"http://iiif.io/api/image/3/context.json":st.version=3;break;default:tt.console.error("Data has a @context property which contains no known IIIF context URI.")}}if(!st["@id"]&&st.id&&(st["@id"]=st.id),st.preferredFormats){for(var dt=0;dt<st.preferredFormats.length;dt++)if(OpenSeadragon.imageFormatSupported(st.preferredFormats[dt])){st.tileFormat=st.preferredFormats[dt];break}}return st}else{var lt=nt(st);return lt["@context"]="http://iiif.io/api/image/1.0/context.json",lt["@id"]=ot.replace("/info.xml",""),lt.version=1,lt}},getTileWidth:function(st){if(this.emulateLegacyImagePyramid)return tt.TileSource.prototype.getTileWidth.call(this,st);var ot=Math.pow(2,this.maxLevel-st);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[ot]?this.tileSizePerScaleFactor[ot].width:this._tileWidth},getTileHeight:function(st){if(this.emulateLegacyImagePyramid)return tt.TileSource.prototype.getTileHeight.call(this,st);var ot=Math.pow(2,this.maxLevel-st);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[ot]?this.tileSizePerScaleFactor[ot].height:this._tileHeight},getLevelScale:function(st){if(this.emulateLegacyImagePyramid){var ot=NaN;return this.levels.length>0&&st>=this.minLevel&&st<=this.maxLevel&&(ot=this.levels[st].width/this.levels[this.maxLevel].width),ot}return tt.TileSource.prototype.getLevelScale.call(this,st)},getNumTiles:function(st){if(this.emulateLegacyImagePyramid){var ot=this.getLevelScale(st);return ot?new tt.Point(1,1):new tt.Point(0,0)}return tt.TileSource.prototype.getNumTiles.call(this,st)},getTileAtPoint:function(st,ot){return this.emulateLegacyImagePyramid?new tt.Point(0,0):tt.TileSource.prototype.getTileAtPoint.call(this,st,ot)},getTileUrl:function(st,ot,lt){if(this.emulateLegacyImagePyramid){var ut=null;return this.levels.length>0&&st>=this.minLevel&&st<=this.maxLevel&&(ut=this.levels[st].url),ut}var ct="0",dt=Math.pow(.5,this.maxLevel-st),pt=Math.ceil(this.width*dt),ft=Math.ceil(this.height*dt),gt,_r,Yr,mt,Kr,Xr,Zr,Qr,_i,ns,rs,ss,hs,os;return gt=this.getTileWidth(st),_r=this.getTileHeight(st),Yr=Math.ceil(gt/dt),mt=Math.ceil(_r/dt),this.version===1?hs="native."+this.tileFormat:hs="default."+this.tileFormat,pt<gt&&ft<_r?(this.version===2&&pt===this.width||this.version===3&&pt===this.width&&ft===this.height?ns="max":this.version===3?ns=pt+","+ft:ns=pt+",",Kr="full"):(Xr=ot*Yr,Zr=lt*mt,Qr=Math.min(Yr,this.width-Xr),_i=Math.min(mt,this.height-Zr),ot===0&&lt===0&&Qr===this.width&&_i===this.height?Kr="full":Kr=[Xr,Zr,Qr,_i].join(","),rs=Math.ceil(Qr*dt),ss=Math.ceil(_i*dt),this.version===2&&rs===this.width||this.version===3&&rs===this.width&&ss===this.height?ns="max":this.version===3?ns=rs+","+ss:ns=rs+","),os=[this["@id"],Kr,ns,ct,hs].join("/"),os},__testonly__:{canBeTiled:et,constructLevels:rt}});function et(st){var ot=["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"],lt=Array.isArray(st.profile)?st.profile[0]:st.profile,ut=ot.indexOf(lt)!==-1,ct=!1;return st.version===2&&st.profile.length>1&&st.profile[1].supports&&(ct=st.profile[1].supports.indexOf("sizeByW")!==-1),st.version===3&&st.extraFeatures&&(ct=st.extraFeatures.indexOf("sizeByWh")!==-1),!ut||ct}function rt(st){for(var ot=[],lt=0;lt<st.sizes.length;lt++)ot.push({url:st["@id"]+"/full/"+st.sizes[lt].width+","+(st.version===3?st.sizes[lt].height:"")+"/0/default."+st.tileFormat,width:st.sizes[lt].width,height:st.sizes[lt].height});return ot.sort(function(ut,ct){return ut.width-ct.width})}function nt(st){if(!st||!st.documentElement)throw new Error(tt.getString("Errors.Xml"));var ot=st.documentElement,lt=ot.tagName,ut=null;if(lt=="info")try{return ut={},it(ot,ut),ut}catch(ct){throw ct instanceof Error?ct:new Error(tt.getString("Errors.IIIF"))}throw new Error(tt.getString("Errors.IIIF"))}function it(st,ot,lt){var ut,ct;if(st.nodeType==3&&lt)ct=st.nodeValue.trim(),ct.match(/^\d*$/)&&(ct=Number(ct)),ot[lt]?(tt.isArray(ot[lt])||(ot[lt]=[ot[lt]]),ot[lt].push(ct)):ot[lt]=ct;else if(st.nodeType==1)for(ut=0;ut<st.childNodes.length;ut++)it(st.childNodes[ut],ot,st.nodeName)}}(OpenSeadragon),function(tt){tt.OsmTileSource=function(et,rt,nt,it,st){var ot;tt.isPlainObject(et)?ot=et:ot={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},(!ot.width||!ot.height)&&(ot.width=65572864,ot.height=65572864),ot.tileSize||(ot.tileSize=256,ot.tileOverlap=0),ot.tilesUrl||(ot.tilesUrl="http://tile.openstreetmap.org/"),ot.minLevel=8,tt.TileSource.apply(this,[ot])},tt.extend(tt.OsmTileSource.prototype,tt.TileSource.prototype,{supports:function(et,rt){return et.type&&et.type=="openstreetmaps"},configure:function(et,rt){return et},getTileUrl:function(et,rt,nt){return this.tilesUrl+(et-8)+"/"+rt+"/"+nt+".png"}})}(OpenSeadragon),function(tt){tt.TmsTileSource=function(et,rt,nt,it,st){var ot;tt.isPlainObject(et)?ot=et:ot={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var lt=Math.ceil(ot.width/256)*256,ut=Math.ceil(ot.height/256)*256,ct;lt>ut?ct=lt/256:ct=ut/256,ot.maxLevel=Math.ceil(Math.log(ct)/Math.log(2))-1,ot.tileSize=256,ot.width=lt,ot.height=ut,tt.TileSource.apply(this,[ot])},tt.extend(tt.TmsTileSource.prototype,tt.TileSource.prototype,{supports:function(et,rt){return et.type&&et.type=="tiledmapservice"},configure:function(et,rt){return et},getTileUrl:function(et,rt,nt){var it=this.getNumTiles(et).y-1;return this.tilesUrl+et+"/"+rt+"/"+(it-nt)+".png"}})}(OpenSeadragon),function(tt){tt.ZoomifyTileSource=function(et){et.tileSize=256;var rt={x:et.width,y:et.height};for(et.imageSizes=[{x:et.width,y:et.height}],et.gridSize=[this._getGridSize(et.width,et.height,et.tileSize)];parseInt(rt.x,10)>et.tileSize||parseInt(rt.y,10)>et.tileSize;)rt.x=Math.floor(rt.x/2),rt.y=Math.floor(rt.y/2),et.imageSizes.push({x:rt.x,y:rt.y}),et.gridSize.push(this._getGridSize(rt.x,rt.y,et.tileSize));et.imageSizes.reverse(),et.gridSize.reverse(),et.minLevel=0,et.maxLevel=et.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[et])},tt.extend(tt.ZoomifyTileSource.prototype,tt.TileSource.prototype,{_getGridSize:function(et,rt,nt){return{x:Math.ceil(et/nt),y:Math.ceil(rt/nt)}},_calculateAbsoluteTileNumber:function(et,rt,nt){for(var it=0,st={},ot=0;ot<et;ot++)st=this.gridSize[ot],it+=st.x*st.y;return st=this.gridSize[et],it+=st.x*nt+rt,it},supports:function(et,rt){return et.type&&et.type=="zoomifytileservice"},configure:function(et,rt){return et},getTileUrl:function(et,rt,nt){var it=0,st=this._calculateAbsoluteTileNumber(et,rt,nt);return it=Math.floor(st/256),this.tilesUrl+"TileGroup"+it+"/"+et+"-"+rt+"-"+nt+".jpg"}})}(OpenSeadragon),function(tt){tt.LegacyTileSource=function(it){var st,ot,lt;tt.isArray(it)&&(st={type:"legacy-image-pyramid",levels:it}),st.levels=et(st.levels),st.levels.length>0?(ot=st.levels[st.levels.length-1].width,lt=st.levels[st.levels.length-1].height):(ot=0,lt=0,tt.console.error("No supported image formats found")),tt.extend(!0,st,{width:ot,height:lt,tileSize:Math.max(lt,ot),tileOverlap:0,minLevel:0,maxLevel:st.levels.length>0?st.levels.length-1:0}),tt.TileSource.apply(this,[st]),this.levels=st.levels},tt.extend(tt.LegacyTileSource.prototype,tt.TileSource.prototype,{supports:function(it,st){return it.type&&it.type=="legacy-image-pyramid"||it.documentElement&&it.documentElement.getAttribute("type")=="legacy-image-pyramid"},configure:function(it,st){var ot;return tt.isPlainObject(it)?ot=nt(this,it):ot=rt(this,it),ot},getLevelScale:function(it){var st=NaN;return this.levels.length>0&&it>=this.minLevel&&it<=this.maxLevel&&(st=this.levels[it].width/this.levels[this.maxLevel].width),st},getNumTiles:function(it){var st=this.getLevelScale(it);return st?new tt.Point(1,1):new tt.Point(0,0)},getTileUrl:function(it,st,ot){var lt=null;return this.levels.length>0&&it>=this.minLevel&&it<=this.maxLevel&&(lt=this.levels[it].url),lt}});function et(it){var st=[],ot,lt;for(lt=0;lt<it.length;lt++)ot=it[lt],ot.height&&ot.width&&ot.url?st.push({url:ot.url,width:Number(ot.width),height:Number(ot.height)}):tt.console.error("Unsupported image format: %s",ot.url?ot.url:"<no URL>");return st.sort(function(ut,ct){return ut.height-ct.height})}function rt(it,st){if(!st||!st.documentElement)throw new Error(tt.getString("Errors.Xml"));var ot=st.documentElement,lt=ot.tagName,ut=null,ct=[],dt,pt;if(lt=="image")try{for(ut={type:ot.getAttribute("type"),levels:[]},ct=ot.getElementsByTagName("level"),pt=0;pt<ct.length;pt++)dt=ct[pt],ut.levels.push({url:dt.getAttribute("url"),width:parseInt(dt.getAttribute("width"),10),height:parseInt(dt.getAttribute("height"),10)});return nt(it,ut)}catch(ft){throw ft instanceof Error?ft:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if(lt=="collection")throw new Error("Legacy Image Pyramid Collections not yet supported.");if(lt=="error")throw new Error("Error: "+st)}throw new Error("Unknown element "+lt)}function nt(it,st){return st.levels}}(OpenSeadragon),function(tt){tt.ImageTileSource=function(et){et=tt.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},et),tt.TileSource.apply(this,[et])},tt.extend(tt.ImageTileSource.prototype,tt.TileSource.prototype,{supports:function(et,rt){return et.type&&et.type==="image"},configure:function(et,rt){return et},getImageInfo:function(et){var rt=this._image=new Image,nt=this;this.crossOriginPolicy&&(rt.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(rt.useCredentials=this.ajaxWithCredentials),tt.addEvent(rt,"load",function(){nt.width=Object.prototype.hasOwnProperty.call(rt,"naturalWidth")?rt.naturalWidth:rt.width,nt.height=Object.prototype.hasOwnProperty.call(rt,"naturalHeight")?rt.naturalHeight:rt.height,nt.aspectRatio=nt.width/nt.height,nt.dimensions=new tt.Point(nt.width,nt.height),nt._tileWidth=nt.width,nt._tileHeight=nt.height,nt.tileOverlap=0,nt.minLevel=0,nt.levels=nt._buildLevels(),nt.maxLevel=nt.levels.length-1,nt.ready=!0,nt.raiseEvent("ready",{tileSource:nt})}),tt.addEvent(rt,"error",function(){nt.raiseEvent("open-failed",{message:"Error loading image at "+et,source:et})}),rt.src=et},getLevelScale:function(et){var rt=NaN;return et>=this.minLevel&&et<=this.maxLevel&&(rt=this.levels[et].width/this.levels[this.maxLevel].width),rt},getNumTiles:function(et){var rt=this.getLevelScale(et);return rt?new tt.Point(1,1):new tt.Point(0,0)},getTileUrl:function(et,rt,nt){var it=null;return et>=this.minLevel&&et<=this.maxLevel&&(it=this.levels[et].url),it},getContext2D:function(et,rt,nt){var it=null;return et>=this.minLevel&&et<=this.maxLevel&&(it=this.levels[et].context2D),it},_buildLevels:function(){var et=[{url:this._image.src,width:Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,height:Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height}];if(!this.buildPyramid||!tt.supportsCanvas||!this.useCanvas)return delete this._image,et;var rt=Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,nt=Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height,it=document.createElement("canvas"),st=it.getContext("2d");if(it.width=rt,it.height=nt,st.drawImage(this._image,0,0,rt,nt),et[0].context2D=st,delete this._image,tt.isCanvasTainted(it))return et;for(;rt>=2&&nt>=2;){rt=Math.floor(rt/2),nt=Math.floor(nt/2);var ot=document.createElement("canvas"),lt=ot.getContext("2d");ot.width=rt,ot.height=nt,lt.drawImage(it,0,0,rt,nt),et.splice(0,0,{context2D:lt,width:rt,height:nt}),it=ot,st=lt}return et}})}(OpenSeadragon),function(tt){tt.TileSourceCollection=function(et,rt,nt,it){tt.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon),function(tt){tt.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},tt.Button=function(lt){var ut=this;tt.EventSource.call(this),tt.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:tt.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:tt.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},lt),this.element=lt.element||tt.makeNeutralElement("div"),lt.element||(this.imgRest=tt.makeTransparentImage(this.srcRest),this.imgGroup=tt.makeTransparentImage(this.srcGroup),this.imgHover=tt.makeTransparentImage(this.srcHover),this.imgDown=tt.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,this.element.style.position="relative",tt.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",tt.Browser.vendor==tt.BROWSERS.FIREFOX&&tt.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=tt.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new tt.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(ct){ct.insideElementPressed?(st(ut,tt.ButtonState.DOWN),ut.raiseEvent("enter",{originalEvent:ct.originalEvent})):ct.buttonDownAny||st(ut,tt.ButtonState.HOVER)},focusHandler:function(ct){this.enterHandler(ct),ut.raiseEvent("focus",{originalEvent:ct.originalEvent})},exitHandler:function(ct){ot(ut,tt.ButtonState.GROUP),ct.insideElementPressed&&ut.raiseEvent("exit",{originalEvent:ct.originalEvent})},blurHandler:function(ct){this.exitHandler(ct),ut.raiseEvent("blur",{originalEvent:ct.originalEvent})},pressHandler:function(ct){st(ut,tt.ButtonState.DOWN),ut.raiseEvent("press",{originalEvent:ct.originalEvent})},releaseHandler:function(ct){ct.insideElementPressed&&ct.insideElementReleased?(ot(ut,tt.ButtonState.HOVER),ut.raiseEvent("release",{originalEvent:ct.originalEvent})):ct.insideElementPressed?ot(ut,tt.ButtonState.GROUP):st(ut,tt.ButtonState.HOVER)},clickHandler:function(ct){ct.quick&&ut.raiseEvent("click",{originalEvent:ct.originalEvent})},keyHandler:function(ct){return ct.keyCode===13?(ut.raiseEvent("click",{originalEvent:ct.originalEvent}),ut.raiseEvent("release",{originalEvent:ct.originalEvent}),!1):!0}}),ot(this,tt.ButtonState.REST)},tt.extend(tt.Button.prototype,tt.EventSource.prototype,{notifyGroupEnter:function(){st(this,tt.ButtonState.GROUP)},notifyGroupExit:function(){ot(this,tt.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,tt.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,tt.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}});function et(lt){tt.requestAnimationFrame(function(){rt(lt)})}function rt(lt){var ut,ct,dt;lt.shouldFade&&(ut=tt.now(),ct=ut-lt.fadeBeginTime,dt=1-ct/lt.fadeLength,dt=Math.min(1,dt),dt=Math.max(0,dt),lt.imgGroup&&tt.setElementOpacity(lt.imgGroup,dt,!0),dt>0&&et(lt))}function nt(lt){lt.shouldFade=!0,lt.fadeBeginTime=tt.now()+lt.fadeDelay,window.setTimeout(function(){et(lt)},lt.fadeDelay)}function it(lt){lt.shouldFade=!1,lt.imgGroup&&tt.setElementOpacity(lt.imgGroup,1,!0)}function st(lt,ut){lt.element.disabled||(ut>=tt.ButtonState.GROUP&&lt.currentState==tt.ButtonState.REST&&(it(lt),lt.currentState=tt.ButtonState.GROUP),ut>=tt.ButtonState.HOVER&&lt.currentState==tt.ButtonState.GROUP&&(lt.imgHover&&(lt.imgHover.style.visibility=""),lt.currentState=tt.ButtonState.HOVER),ut>=tt.ButtonState.DOWN&&lt.currentState==tt.ButtonState.HOVER&&(lt.imgDown&&(lt.imgDown.style.visibility=""),lt.currentState=tt.ButtonState.DOWN))}function ot(lt,ut){lt.element.disabled||(ut<=tt.ButtonState.HOVER&&lt.currentState==tt.ButtonState.DOWN&&(lt.imgDown&&(lt.imgDown.style.visibility="hidden"),lt.currentState=tt.ButtonState.HOVER),ut<=tt.ButtonState.GROUP&&lt.currentState==tt.ButtonState.HOVER&&(lt.imgHover&&(lt.imgHover.style.visibility="hidden"),lt.currentState=tt.ButtonState.GROUP),ut<=tt.ButtonState.REST&&lt.currentState==tt.ButtonState.GROUP&&(nt(lt),lt.currentState=tt.ButtonState.REST))}}(OpenSeadragon),function(tt){tt.ButtonGroup=function(et){tt.extend(!0,this,{buttons:[],clickTimeThreshold:tt.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:tt.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},et);var rt=this.buttons.concat([]),nt=this,it;if(this.element=et.element||tt.makeNeutralElement("div"),!et.group)for(this.element.style.display="inline-block",it=0;it<rt.length;it++)this.element.appendChild(rt[it].element);tt.setElementTouchActionNone(this.element),this.tracker=new tt.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(st){var ot;for(ot=0;ot<nt.buttons.length;ot++)nt.buttons[ot].notifyGroupEnter()},exitHandler:function(st){var ot;if(!st.insideElementPressed)for(ot=0;ot<nt.buttons.length;ot++)nt.buttons[ot].notifyGroupExit()}})},tt.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}}(OpenSeadragon),function(tt){tt.Rect=function(et,rt,nt,it,st){this.x=typeof et=="number"?et:0,this.y=typeof rt=="number"?rt:0,this.width=typeof nt=="number"?nt:0,this.height=typeof it=="number"?it:0,this.degrees=typeof st=="number"?st:0,this.degrees=tt.positiveModulo(this.degrees,360);var ot,lt;this.degrees>=270?(ot=this.getTopRight(),this.x=ot.x,this.y=ot.y,lt=this.height,this.height=this.width,this.width=lt,this.degrees-=270):this.degrees>=180?(ot=this.getBottomRight(),this.x=ot.x,this.y=ot.y,this.degrees-=180):this.degrees>=90&&(ot=this.getBottomLeft(),this.x=ot.x,this.y=ot.y,lt=this.height,this.height=this.width,this.width=lt,this.degrees-=90)},tt.Rect.fromSummits=function(et,rt,nt){var it=et.distanceTo(rt),st=et.distanceTo(nt),ot=rt.minus(et),lt=Math.atan(ot.y/ot.x);return ot.x<0?lt+=Math.PI:ot.y<0&&(lt+=2*Math.PI),new tt.Rect(et.x,et.y,it,st,lt/Math.PI*180)},tt.Rect.prototype={clone:function(){return new tt.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new tt.Point(this.x,this.y)},getBottomRight:function(){return new tt.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new tt.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new tt.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new tt.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new tt.Point(this.width,this.height)},equals:function(et){return et instanceof tt.Rect&&this.x===et.x&&this.y===et.y&&this.width===et.width&&this.height===et.height&&this.degrees===et.degrees},times:function(et){return new tt.Rect(this.x*et,this.y*et,this.width*et,this.height*et,this.degrees)},translate:function(et){return new tt.Rect(this.x+et.x,this.y+et.y,this.width,this.height,this.degrees)},union:function(et){var rt=this.getBoundingBox(),nt=et.getBoundingBox(),it=Math.min(rt.x,nt.x),st=Math.min(rt.y,nt.y),ot=Math.max(rt.x+rt.width,nt.x+nt.width),lt=Math.max(rt.y+rt.height,nt.y+nt.height);return new tt.Rect(it,st,ot-it,lt-st)},intersection:function(et){var rt=1e-10,nt=[],it=this.getTopLeft();et.containsPoint(it,rt)&&nt.push(it);var st=this.getTopRight();et.containsPoint(st,rt)&&nt.push(st);var ot=this.getBottomLeft();et.containsPoint(ot,rt)&&nt.push(ot);var lt=this.getBottomRight();et.containsPoint(lt,rt)&&nt.push(lt);var ut=et.getTopLeft();this.containsPoint(ut,rt)&&nt.push(ut);var ct=et.getTopRight();this.containsPoint(ct,rt)&&nt.push(ct);var dt=et.getBottomLeft();this.containsPoint(dt,rt)&&nt.push(dt);var pt=et.getBottomRight();this.containsPoint(pt,rt)&&nt.push(pt);for(var ft=this._getSegments(),gt=et._getSegments(),_r=0;_r<ft.length;_r++)for(var Yr=ft[_r],mt=0;mt<gt.length;mt++){var Kr=gt[mt],Xr=Zr(Yr[0],Yr[1],Kr[0],Kr[1]);Xr&&nt.push(Xr)}function Zr(os,is,cs,ps){var vs=is.minus(os),ls=ps.minus(cs),ms=-ls.x*vs.y+vs.x*ls.y;if(ms===0)return null;var us=(vs.x*(os.y-cs.y)-vs.y*(os.x-cs.x))/ms,gs=(ls.x*(os.y-cs.y)-ls.y*(os.x-cs.x))/ms;return-rt<=us&&us<=1-rt&&-rt<=gs&&gs<=1-rt?new tt.Point(os.x+gs*vs.x,os.y+gs*vs.y):null}if(nt.length===0)return null;for(var Qr=nt[0].x,_i=nt[0].x,ns=nt[0].y,rs=nt[0].y,ss=1;ss<nt.length;ss++){var hs=nt[ss];hs.x<Qr&&(Qr=hs.x),hs.x>_i&&(_i=hs.x),hs.y<ns&&(ns=hs.y),hs.y>rs&&(rs=hs.y)}return new tt.Rect(Qr,ns,_i-Qr,rs-ns)},_getSegments:function(){var et=this.getTopLeft(),rt=this.getTopRight(),nt=this.getBottomLeft(),it=this.getBottomRight();return[[et,rt],[rt,it],[it,nt],[nt,et]]},rotate:function(et,rt){if(et=tt.positiveModulo(et,360),et===0)return this.clone();rt=rt||this.getCenter();var nt=this.getTopLeft().rotate(et,rt),it=this.getTopRight().rotate(et,rt),st=it.minus(nt);st=st.apply(function(lt){var ut=1e-15;return Math.abs(lt)<ut?0:lt});var ot=Math.atan(st.y/st.x);return st.x<0?ot+=Math.PI:st.y<0&&(ot+=2*Math.PI),new tt.Rect(nt.x,nt.y,this.width,this.height,ot/Math.PI*180)},getBoundingBox:function(){if(this.degrees===0)return this.clone();var et=this.getTopLeft(),rt=this.getTopRight(),nt=this.getBottomLeft(),it=this.getBottomRight(),st=Math.min(et.x,rt.x,nt.x,it.x),ot=Math.max(et.x,rt.x,nt.x,it.x),lt=Math.min(et.y,rt.y,nt.y,it.y),ut=Math.max(et.y,rt.y,nt.y,it.y);return new tt.Rect(st,lt,ot-st,ut-lt)},getIntegerBoundingBox:function(){var et=this.getBoundingBox(),rt=Math.floor(et.x),nt=Math.floor(et.y),it=Math.ceil(et.width+et.x-rt),st=Math.ceil(et.height+et.y-nt);return new tt.Rect(rt,nt,it,st)},containsPoint:function(et,rt){rt=rt||0;var nt=this.getTopLeft(),it=this.getTopRight(),st=this.getBottomLeft(),ot=it.minus(nt),lt=st.minus(nt);return(et.x-nt.x)*ot.x+(et.y-nt.y)*ot.y>=-rt&&(et.x-it.x)*ot.x+(et.y-it.y)*ot.y<=rt&&(et.x-nt.x)*lt.x+(et.y-nt.y)*lt.y>=-rt&&(et.x-st.x)*lt.x+(et.y-st.y)*lt.y<=rt},toString:function(){return"["+Math.round(this.x*100)/100+", "+Math.round(this.y*100)/100+", "+Math.round(this.width*100)/100+"x"+Math.round(this.height*100)/100+", "+Math.round(this.degrees*100)/100+"deg]"}}}(OpenSeadragon),function(tt){var et={};tt.ReferenceStrip=function(ct){var dt=this,pt=ct.viewer,ft=tt.getElementSize(pt.element),gt,_r,Yr;for(ct.id||(ct.id="referencestrip-"+tt.now(),this.element=tt.makeNeutralElement("div"),this.element.id=ct.id,this.element.className="referencestrip"),ct=tt.extend(!0,{sizeRatio:tt.DEFAULT_SETTINGS.referenceStripSizeRatio,position:tt.DEFAULT_SETTINGS.referenceStripPosition,scroll:tt.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:tt.DEFAULT_SETTINGS.clickTimeThreshold},ct,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),tt.extend(this,ct),et[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,_r=this.element.style,_r.marginTop="0px",_r.marginRight="0px",_r.marginBottom="0px",_r.marginLeft="0px",_r.left="0px",_r.bottom="0px",_r.border="0px",_r.background="#000",_r.position="relative",tt.setElementTouchActionNone(this.element),tt.setElementOpacity(this.element,.8),this.viewer=pt,this.innerTracker=new tt.MouseTracker({element:this.element,dragHandler:tt.delegate(this,rt),scrollHandler:tt.delegate(this,nt),enterHandler:tt.delegate(this,st),exitHandler:tt.delegate(this,ot),keyDownHandler:tt.delegate(this,lt),keyHandler:tt.delegate(this,ut)}),ct.width&&ct.height?(this.element.style.width=ct.width+"px",this.element.style.height=ct.height+"px",pt.addControl(this.element,{anchor:tt.ControlAnchor.BOTTOM_LEFT})):ct.scroll=="horizontal"?(this.element.style.width=ft.x*ct.sizeRatio*pt.tileSources.length+12*pt.tileSources.length+"px",this.element.style.height=ft.y*ct.sizeRatio+"px",pt.addControl(this.element,{anchor:tt.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=ft.y*ct.sizeRatio*pt.tileSources.length+12*pt.tileSources.length+"px",this.element.style.width=ft.x*ct.sizeRatio+"px",pt.addControl(this.element,{anchor:tt.ControlAnchor.TOP_LEFT})),this.panelWidth=ft.x*this.sizeRatio+8,this.panelHeight=ft.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},Yr=0;Yr<pt.tileSources.length;Yr++)gt=tt.makeNeutralElement("div"),gt.id=this.element.id+"-"+Yr,gt.style.width=dt.panelWidth+"px",gt.style.height=dt.panelHeight+"px",gt.style.display="inline",gt.style.float="left",gt.style.cssFloat="left",gt.style.styleFloat="left",gt.style.padding="2px",tt.setElementTouchActionNone(gt),gt.innerTracker=new tt.MouseTracker({element:gt,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(mt){mt.eventSource.dragging=tt.now()},releaseHandler:function(mt){var Kr=mt.eventSource,Xr=Kr.element.id,Zr=Number(Xr.split("-")[2]),Qr=tt.now();mt.insideElementPressed&&mt.insideElementReleased&&Kr.dragging&&Qr-Kr.dragging<Kr.clickTimeThreshold&&(Kr.dragging=null,pt.goToPage(Zr))}}),this.element.appendChild(gt),gt.activePanel=!1,this.panels.push(gt);it(this,this.scroll=="vertical"?ft.y:ft.x,0),this.setFocus(0)},tt.extend(tt.ReferenceStrip.prototype,tt.EventSource.prototype,tt.Viewer.prototype,{setFocus:function(ct){var dt=this.element.querySelector("#"+this.element.id+"-"+ct),pt=tt.getElementSize(this.viewer.canvas),ft=Number(this.element.style.width.replace("px","")),gt=Number(this.element.style.height.replace("px","")),_r=-Number(this.element.style.marginLeft.replace("px","")),Yr=-Number(this.element.style.marginTop.replace("px","")),mt;this.currentSelected!==dt&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=dt,this.currentSelected.style.background="#999",this.scroll=="horizontal"?(mt=Number(ct)*(this.panelWidth+3),mt>_r+pt.x-this.panelWidth?(mt=Math.min(mt,ft-pt.x),this.element.style.marginLeft=-mt+"px",it(this,pt.x,-mt)):mt<_r&&(mt=Math.max(0,mt-pt.x/2),this.element.style.marginLeft=-mt+"px",it(this,pt.x,-mt))):(mt=Number(ct)*(this.panelHeight+3),mt>Yr+pt.y-this.panelHeight?(mt=Math.min(mt,gt-pt.y),this.element.style.marginTop=-mt+"px",it(this,pt.y,-mt)):mt<Yr&&(mt=Math.max(0,mt-pt.y/2),this.element.style.marginTop=-mt+"px",it(this,pt.y,-mt))),this.currentPage=ct,st.call(this,{eventSource:this.innerTracker}))},update:function(){return et[this.id].animating?(tt.console.log("image reference strip update"),!0):!1},destroy:function(){if(this.miniViewers)for(var ct in this.miniViewers)this.miniViewers[ct].destroy();this.element&&this.element.parentNode.removeChild(this.element)}});function rt(ct){var dt=Number(this.element.style.marginLeft.replace("px","")),pt=Number(this.element.style.marginTop.replace("px","")),ft=Number(this.element.style.width.replace("px","")),gt=Number(this.element.style.height.replace("px","")),_r=tt.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&(this.scroll=="horizontal"?-ct.delta.x>0?dt>-(ft-_r.x)&&(this.element.style.marginLeft=dt+ct.delta.x*2+"px",it(this,_r.x,dt+ct.delta.x*2)):-ct.delta.x<0&&dt<0&&(this.element.style.marginLeft=dt+ct.delta.x*2+"px",it(this,_r.x,dt+ct.delta.x*2)):-ct.delta.y>0?pt>-(gt-_r.y)&&(this.element.style.marginTop=pt+ct.delta.y*2+"px",it(this,_r.y,pt+ct.delta.y*2)):-ct.delta.y<0&&pt<0&&(this.element.style.marginTop=pt+ct.delta.y*2+"px",it(this,_r.y,pt+ct.delta.y*2))),!1}function nt(ct){var dt=Number(this.element.style.marginLeft.replace("px","")),pt=Number(this.element.style.marginTop.replace("px","")),ft=Number(this.element.style.width.replace("px","")),gt=Number(this.element.style.height.replace("px","")),_r=tt.getElementSize(this.viewer.canvas);return this.element&&(this.scroll=="horizontal"?ct.scroll>0?dt>-(ft-_r.x)&&(this.element.style.marginLeft=dt-ct.scroll*60+"px",it(this,_r.x,dt-ct.scroll*60)):ct.scroll<0&&dt<0&&(this.element.style.marginLeft=dt-ct.scroll*60+"px",it(this,_r.x,dt-ct.scroll*60)):ct.scroll<0?pt>_r.y-gt&&(this.element.style.marginTop=pt+ct.scroll*60+"px",it(this,_r.y,pt+ct.scroll*60)):ct.scroll>0&&pt<0&&(this.element.style.marginTop=pt+ct.scroll*60+"px",it(this,_r.y,pt+ct.scroll*60))),!1}function it(ct,dt,pt){var ft,gt,_r,Yr,mt,Kr,Xr;for(ct.scroll=="horizontal"?ft=ct.panelWidth:ft=ct.panelHeight,gt=Math.ceil(dt/ft)+5,_r=Math.ceil((Math.abs(pt)+dt)/ft)+1,gt=_r-gt,gt=gt<0?0:gt,Kr=gt;Kr<_r&&Kr<ct.panels.length;Kr++)if(Xr=ct.panels[Kr],!Xr.activePanel){var Zr,Qr=ct.viewer.tileSources[Kr];Qr.referenceStripThumbnailUrl?Zr={type:"image",url:Qr.referenceStripThumbnailUrl}:Zr=Qr,Yr=new tt.Viewer({id:Xr.id,tileSources:[Zr],element:Xr,navigatorSizeRatio:ct.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:ct.viewer.loadTilesWithAjax,ajaxHeaders:ct.viewer.ajaxHeaders,useCanvas:ct.useCanvas}),Yr.displayRegion=tt.makeNeutralElement("div"),Yr.displayRegion.id=Xr.id+"-displayregion",Yr.displayRegion.className="displayregion",mt=Yr.displayRegion.style,mt.position="relative",mt.top="0px",mt.left="0px",mt.fontSize="0px",mt.overflow="hidden",mt.float="left",mt.cssFloat="left",mt.styleFloat="left",mt.zIndex=999999999,mt.cursor="default",mt.width=ct.panelWidth-4+"px",mt.height=ct.panelHeight-4+"px",Yr.displayRegion.innerTracker=new tt.MouseTracker({element:Yr.displayRegion,startDisabled:!0}),Xr.getElementsByTagName("div")[0].appendChild(Yr.displayRegion),ct.miniViewers[Xr.id]=Yr,Xr.activePanel=!0}}function st(ct){var dt=ct.eventSource.element;return this.scroll=="horizontal"?dt.style.marginBottom="0px":dt.style.marginLeft="0px",!1}function ot(ct){var dt=ct.eventSource.element;return this.scroll=="horizontal"?dt.style.marginBottom="-"+tt.getElementSize(dt).y/2+"px":dt.style.marginLeft="-"+tt.getElementSize(dt).x/2+"px",!1}function lt(ct){if(!ct.preventDefaultAction&&!ct.ctrl&&!ct.alt&&!ct.meta)switch(ct.keyCode){case 38:return nt.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 40:return nt.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 37:return nt.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 39:return nt.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}else return!0}function ut(ct){if(!ct.preventDefaultAction&&!ct.ctrl&&!ct.alt&&!ct.meta)switch(ct.keyCode){case 61:return nt.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 45:return nt.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 48:case 119:case 87:return nt.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 115:case 83:return nt.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 97:return nt.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 100:return nt.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}else return!0}}(OpenSeadragon),function(tt){tt.DisplayRect=function(et,rt,nt,it,st,ot){tt.Rect.apply(this,[et,rt,nt,it]),this.minLevel=st,this.maxLevel=ot},tt.extend(tt.DisplayRect.prototype,tt.Rect.prototype)}(OpenSeadragon),function(tt){tt.Spring=function(rt){var nt=arguments;typeof rt!="object"&&(rt={initial:nt.length&&typeof nt[0]=="number"?nt[0]:void 0,springStiffness:nt.length>1?nt[1].springStiffness:5,animationTime:nt.length>1?nt[1].animationTime:1.5}),tt.console.assert(typeof rt.springStiffness=="number"&&rt.springStiffness!==0,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),tt.console.assert(typeof rt.animationTime=="number"&&rt.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),rt.exponential&&(this._exponential=!0,delete rt.exponential),tt.extend(!0,this,rt),this.current={value:typeof this.initial=="number"?this.initial:this._exponential?0:1,time:tt.now()},tt.console.assert(!this._exponential||this.current.value!==0,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},tt.Spring.prototype={resetTo:function(rt){tt.console.assert(!this._exponential||rt!==0,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=rt,this.start.time=this.target.time=this.current.time=tt.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(rt){tt.console.assert(!this._exponential||rt!==0,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=rt,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(rt){this.start.value+=rt,this.target.value+=rt,this._exponential&&(tt.console.assert(this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(rt){this._exponential=rt,this._exponential&&(tt.console.assert(this.current.value!==0&&this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=tt.now();var rt,nt;this._exponential?(rt=this.start._logValue,nt=this.target._logValue):(rt=this.start.value,nt=this.target.value);var it=this.current.time>=this.target.time?nt:rt+(nt-rt)*et(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time)),st=this.current.value;return this._exponential?this.current.value=Math.exp(it):this.current.value=it,st!=this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}};function et(rt,nt){return(1-Math.exp(rt*-nt))/(1-Math.exp(-rt))}}(OpenSeadragon),function(tt){function et(nt){tt.extend(!0,this,{timeout:tt.DEFAULT_SETTINGS.timeout,jobId:null},nt),this.image=null}et.prototype={errorMsg:null,start:function(){var nt=this,it=this.abort;this.image=new Image,this.image.onload=function(){nt.finish(!0)},this.image.onabort=this.image.onerror=function(){nt.errorMsg="Image load aborted",nt.finish(!1)},this.jobId=window.setTimeout(function(){nt.errorMsg="Image load exceeded timeout ("+nt.timeout+" ms)",nt.finish(!1)},this.timeout),this.loadWithAjax?(this.request=tt.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(st){var ot;try{ot=new window.Blob([st.response])}catch(dt){var lt=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(dt.name==="TypeError"&&lt){var ut=new lt;ut.append(st.response),ot=ut.getBlob()}}ot.size===0&&(nt.errorMsg="Empty image response.",nt.finish(!1));var ct=(window.URL||window.webkitURL).createObjectURL(ot);nt.image.src=ct},error:function(st){nt.errorMsg="Image load aborted - XHR error",nt.finish(!1)}}),this.abort=function(){nt.request.abort(),typeof it=="function"&&it()}):(this.crossOriginPolicy!==!1&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(nt){this.image.onload=this.image.onerror=this.image.onabort=null,nt||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},tt.ImageLoader=function(nt){tt.extend(!0,this,{jobLimit:tt.DEFAULT_SETTINGS.imageLoaderLimit,timeout:tt.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},nt)},tt.ImageLoader.prototype={addJob:function(nt){var it=this,st=function(ut){rt(it,ut,nt.callback)},ot={src:nt.src,loadWithAjax:nt.loadWithAjax,ajaxHeaders:nt.loadWithAjax?nt.ajaxHeaders:null,crossOriginPolicy:nt.crossOriginPolicy,ajaxWithCredentials:nt.ajaxWithCredentials,callback:st,abort:nt.abort,timeout:this.timeout},lt=new et(ot);!this.jobLimit||this.jobsInProgress<this.jobLimit?(lt.start(),this.jobsInProgress++):this.jobQueue.push(lt)},clear:function(){for(var nt=0;nt<this.jobQueue.length;nt++){var it=this.jobQueue[nt];typeof it.abort=="function"&&it.abort()}this.jobQueue=[]}};function rt(nt,it,st){var ot;nt.jobsInProgress--,(!nt.jobLimit||nt.jobsInProgress<nt.jobLimit)&&nt.jobQueue.length>0&&(ot=nt.jobQueue.shift(),ot.start(),nt.jobsInProgress++),st(it.image,it.errorMsg,it.request)}}(OpenSeadragon),function(tt){tt.Tile=function(et,rt,nt,it,st,ot,lt,ut,ct,dt){this.level=et,this.x=rt,this.y=nt,this.bounds=it,this.sourceBounds=dt,this.exists=st,this.url=ot,this.context2D=lt,this.loadWithAjax=ut,this.ajaxHeaders=ct,this.ajaxHeaders?this.cacheKey=this.url+"+"+JSON.stringify(this.ajaxHeaders):this.cacheKey=this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},tt.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(et){if(!this.cacheImageRecord){tt.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString());return}if(!this.loaded){tt.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}this.element||(this.element=tt.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=et&&et.appendChild(this.element),this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",tt.setElementOpacity(this.element,this.opacity)},drawCanvas:function(et,rt,nt,it){var st=this.position.times(tt.pixelDensityRatio),ot=this.size.times(tt.pixelDensityRatio),lt;if(!this.context2D&&!this.cacheImageRecord){tt.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString());return}if(lt=this.context2D||this.cacheImageRecord.getRenderedContext(),!this.loaded||!lt){tt.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}et.save(),et.globalAlpha=this.opacity,typeof nt=="number"&&nt!==1&&(st=st.times(nt),ot=ot.times(nt)),it instanceof tt.Point&&(st=st.plus(it)),et.globalAlpha===1&&this._hasTransparencyChannel()&&et.clearRect(st.x,st.y,ot.x,ot.y),rt({context:et,tile:this,rendered:lt});var ut,ct;this.sourceBounds?(ut=Math.min(this.sourceBounds.width,lt.canvas.width),ct=Math.min(this.sourceBounds.height,lt.canvas.height)):(ut=lt.canvas.width,ct=lt.canvas.height),et.drawImage(lt.canvas,0,0,ut,ct,st.x,st.y,ot.x,ot.y),et.restore()},getScaleForEdgeSmoothing:function(){var et;if(this.cacheImageRecord)et=this.cacheImageRecord.getRenderedContext();else if(this.context2D)et=this.context2D;else return tt.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;return et.canvas.width/(this.size.x*tt.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(et,rt,nt){var it=Math.max(1,Math.ceil((nt.x-rt.x)/2)),st=Math.max(1,Math.ceil((nt.y-rt.y)/2));return new tt.Point(it,st).minus(this.position.times(tt.pixelDensityRatio).times(et||1).apply(function(ot){return ot%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function(tt){tt.OverlayPlacement=tt.Placement,tt.OverlayRotationMode=tt.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),tt.Overlay=function(et,rt,nt){var it;tt.isPlainObject(et)?it=et:it={element:et,location:rt,placement:nt},this.element=it.element,this.style=it.element.style,this._init(it)},tt.Overlay.prototype={_init:function(et){this.location=et.location,this.placement=et.placement===void 0?tt.Placement.TOP_LEFT:et.placement,this.onDraw=et.onDraw,this.checkResize=et.checkResize===void 0?!0:et.checkResize,this.width=et.width===void 0?null:et.width,this.height=et.height===void 0?null:et.height,this.rotationMode=et.rotationMode||tt.OverlayRotationMode.EXACT,this.location instanceof tt.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=tt.Placement.TOP_LEFT),this.scales=this.width!==null&&this.height!==null,this.bounds=new tt.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(et,rt){var nt=tt.Placement.properties[this.placement];nt&&(nt.isHorizontallyCentered?et.x-=rt.x/2:nt.isRight&&(et.x-=rt.x),nt.isVerticallyCentered?et.y-=rt.y/2:nt.isBottom&&(et.y-=rt.y))},destroy:function(){var et=this.element,rt=this.style;et.parentNode&&(et.parentNode.removeChild(et),et.prevElementParent&&(rt.display="none",document.body.appendChild(et))),this.onDraw=null,rt.top="",rt.left="",rt.position="",this.width!==null&&(rt.width=""),this.height!==null&&(rt.height="");var nt=tt.getCssPropertyWithVendorPrefix("transformOrigin"),it=tt.getCssPropertyWithVendorPrefix("transform");nt&&it&&(rt[nt]="",rt[it]="")},drawHTML:function(et,rt){var nt=this.element;nt.parentNode!==et&&(nt.prevElementParent=nt.parentNode,nt.prevNextSibling=nt.nextSibling,et.appendChild(nt),this.style.position="absolute",this.size=tt.getElementSize(nt));var it=this._getOverlayPositionAndSize(rt),st=it.position,ot=this.size=it.size,lt=it.rotate;if(this.onDraw)this.onDraw(st,ot,this.element);else{var ut=this.style;ut.left=st.x+"px",ut.top=st.y+"px",this.width!==null&&(ut.width=ot.x+"px"),this.height!==null&&(ut.height=ot.y+"px");var ct=tt.getCssPropertyWithVendorPrefix("transformOrigin"),dt=tt.getCssPropertyWithVendorPrefix("transform");ct&&dt&&(lt?(ut[ct]=this._getTransformOrigin(),ut[dt]="rotate("+lt+"deg)"):(ut[ct]="",ut[dt]="")),ut.display!=="none"&&(ut.display="block")}},_getOverlayPositionAndSize:function(et){var rt=et.pixelFromPoint(this.location,!0),nt=this._getSizeInPixels(et);this.adjust(rt,nt);var it=0;if(et.degrees&&this.rotationMode!==tt.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===tt.OverlayRotationMode.BOUNDING_BOX&&this.width!==null&&this.height!==null){var st=new tt.Rect(rt.x,rt.y,nt.x,nt.y),ot=this._getBoundingBox(st,et.degrees);rt=ot.getTopLeft(),nt=ot.getSize()}else it=et.degrees;return{position:rt,size:nt,rotate:it}},_getSizeInPixels:function(et){var rt=this.size.x,nt=this.size.y;if(this.width!==null||this.height!==null){var it=et.deltaPixelsFromPointsNoRotate(new tt.Point(this.width||0,this.height||0),!0);this.width!==null&&(rt=it.x),this.height!==null&&(nt=it.y)}if(this.checkResize&&(this.width===null||this.height===null)){var st=this.size=tt.getElementSize(this.element);this.width===null&&(rt=st.x),this.height===null&&(nt=st.y)}return new tt.Point(rt,nt)},_getBoundingBox:function(et,rt){var nt=this._getPlacementPoint(et);return et.rotate(rt,nt).getBoundingBox()},_getPlacementPoint:function(et){var rt=new tt.Point(et.x,et.y),nt=tt.Placement.properties[this.placement];return nt&&(nt.isHorizontallyCentered?rt.x+=et.width/2:nt.isRight&&(rt.x+=et.width),nt.isVerticallyCentered?rt.y+=et.height/2:nt.isBottom&&(rt.y+=et.height)),rt},_getTransformOrigin:function(){var et="",rt=tt.Placement.properties[this.placement];return rt&&(rt.isLeft?et="left":rt.isRight&&(et="right"),rt.isTop?et+=" top":rt.isBottom&&(et+=" bottom")),et},update:function(et,rt){var nt=tt.isPlainObject(et)?et:{location:et,placement:rt};this._init({location:nt.location||this.location,placement:nt.placement!==void 0?nt.placement:this.placement,onDraw:nt.onDraw||this.onDraw,checkResize:nt.checkResize||this.checkResize,width:nt.width!==void 0?nt.width:this.width,height:nt.height!==void 0?nt.height:this.height,rotationMode:nt.rotationMode||this.rotationMode})},getBounds:function(et){tt.console.assert(et,"A viewport must now be passed to Overlay.getBounds.");var rt=this.width,nt=this.height;if(rt===null||nt===null){var it=et.deltaPointsFromPixelsNoRotate(this.size,!0);rt===null&&(rt=it.x),nt===null&&(nt=it.y)}var st=this.location.clone();return this.adjust(st,new tt.Point(rt,nt)),this._adjustBoundsForRotation(et,new tt.Rect(st.x,st.y,rt,nt))},_adjustBoundsForRotation:function(et,rt){if(!et||et.degrees===0||this.rotationMode===tt.OverlayRotationMode.EXACT)return rt;if(this.rotationMode===tt.OverlayRotationMode.BOUNDING_BOX){if(this.width===null||this.height===null)return rt;var nt=this._getOverlayPositionAndSize(et);return et.viewerElementToViewportRectangle(new tt.Rect(nt.position.x,nt.position.y,nt.size.x,nt.size.y))}return rt.rotate(-et.degrees,this._getPlacementPoint(rt))}}}(OpenSeadragon),function(tt){tt.Drawer=function(et){tt.console.assert(et.viewer,"[Drawer] options.viewer is required");var rt=arguments;if(tt.isPlainObject(et)||(et={source:rt[0],viewport:rt[1],element:rt[2]}),tt.console.assert(et.viewport,"[Drawer] options.viewport is required"),tt.console.assert(et.element,"[Drawer] options.element is required"),et.source&&tt.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=et.viewer,this.viewport=et.viewport,this.debugGridColor=typeof et.debugGridColor=="string"?[et.debugGridColor]:et.debugGridColor||tt.DEFAULT_SETTINGS.debugGridColor,et.opacity&&tt.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=tt.supportsCanvas&&(this.viewer?this.viewer.useCanvas:!0),this.container=tt.getElement(et.element),this.canvas=tt.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var nt=this._calculateCanvasSize();this.canvas.width=nt.x,this.canvas.height=nt.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",tt.setElementOpacity(this.canvas,this.opacity,!0),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},tt.Drawer.prototype={addOverlay:function(et,rt,nt,it){return tt.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(et,rt,nt,it),this},updateOverlay:function(et,rt,nt){return tt.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(et,rt,nt),this},removeOverlay:function(et){return tt.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(et),this},clearOverlays:function(){return tt.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(et){var rt=this.viewport.pixelFromPointNoRotate(et,!0);return new tt.Point(rt.x*tt.pixelDensityRatio,rt.y*tt.pixelDensityRatio)},clipWithPolygons:function(et,rt){if(this.useCanvas){var nt=this._getContext(rt);nt.beginPath(),et.forEach(function(it){it.forEach(function(st,ot){nt[ot===0?"moveTo":"lineTo"](st.x,st.y)})}),nt.clip()}},setOpacity:function(et){tt.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var rt=this.viewer.world,nt=0;nt<rt.getItemCount();nt++)rt.getItemAt(nt).setOpacity(et);return this},getOpacity:function(){tt.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var et=this.viewer.world,rt=0,nt=0;nt<et.getItemCount();nt++){var it=et.getItemAt(nt).getOpacity();it>rt&&(rt=it)}return rt},needsUpdate:function(){return tt.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return tt.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return tt.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return tt.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var et=this._calculateCanvasSize();if((this.canvas.width!=et.x||this.canvas.height!=et.y)&&(this.canvas.width=et.x,this.canvas.height=et.y,this._updateImageSmoothingEnabled(this.context),this.sketchCanvas!==null)){var rt=this._calculateSketchCanvasSize();this.sketchCanvas.width=rt.x,this.sketchCanvas.height=rt.y,this._updateImageSmoothingEnabled(this.sketchContext)}this._clear()}},_clear:function(et,rt){if(this.useCanvas){var nt=this._getContext(et);if(rt)nt.clearRect(rt.x,rt.y,rt.width,rt.height);else{var it=nt.canvas;nt.clearRect(0,0,it.width,it.height)}}},viewportToDrawerRectangle:function(et){var rt=this.viewport.pixelFromPointNoRotate(et.getTopLeft(),!0),nt=this.viewport.deltaPixelsFromPointsNoRotate(et.getSize(),!0);return new tt.Rect(rt.x*tt.pixelDensityRatio,rt.y*tt.pixelDensityRatio,nt.x*tt.pixelDensityRatio,nt.y*tt.pixelDensityRatio)},drawTile:function(et,rt,nt,it,st){if(tt.console.assert(et,"[Drawer.drawTile] tile is required"),tt.console.assert(rt,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var ot=this._getContext(nt);it=it||1,et.drawCanvas(ot,rt,it,st)}else et.drawHTML(this.canvas)},_getContext:function(et){var rt=this.context;if(et){if(this.sketchCanvas===null){this.sketchCanvas=document.createElement("canvas");var nt=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=nt.x,this.sketchCanvas.height=nt.y,this.sketchContext=this.sketchCanvas.getContext("2d"),this.viewport.getRotation()===0){var it=this;this.viewer.addHandler("rotate",function st(){if(it.viewport.getRotation()!==0){it.viewer.removeHandler("rotate",st);var ot=it._calculateSketchCanvasSize();it.sketchCanvas.width=ot.x,it.sketchCanvas.height=ot.y}})}this._updateImageSmoothingEnabled(this.sketchContext)}rt=this.sketchContext}return rt},saveContext:function(et){this.useCanvas&&this._getContext(et).save()},restoreContext:function(et){this.useCanvas&&this._getContext(et).restore()},setClip:function(et,rt){if(this.useCanvas){var nt=this._getContext(rt);nt.beginPath(),nt.rect(et.x,et.y,et.width,et.height),nt.clip()}},drawRectangle:function(et,rt,nt){if(this.useCanvas){var it=this._getContext(nt);it.save(),it.fillStyle=rt,it.fillRect(et.x,et.y,et.width,et.height),it.restore()}},blendSketch:function(et,rt,nt,it){var st=et;if(tt.isPlainObject(st)||(st={opacity:et,scale:rt,translate:nt,compositeOperation:it}),!(!this.useCanvas||!this.sketchCanvas)){et=st.opacity,it=st.compositeOperation;var ot=st.bounds;if(this.context.save(),this.context.globalAlpha=et,it&&(this.context.globalCompositeOperation=it),ot)ot.x<0&&(ot.width+=ot.x,ot.x=0),ot.x+ot.width>this.canvas.width&&(ot.width=this.canvas.width-ot.x),ot.y<0&&(ot.height+=ot.y,ot.y=0),ot.y+ot.height>this.canvas.height&&(ot.height=this.canvas.height-ot.y),this.context.drawImage(this.sketchCanvas,ot.x,ot.y,ot.width,ot.height,ot.x,ot.y,ot.width,ot.height);else{rt=st.scale||1,nt=st.translate;var lt=nt instanceof tt.Point?nt:new tt.Point(0,0),ut=0,ct=0;if(nt){var dt=this.sketchCanvas.width-this.canvas.width,pt=this.sketchCanvas.height-this.canvas.height;ut=Math.round(dt/2),ct=Math.round(pt/2)}this.context.drawImage(this.sketchCanvas,lt.x-ut*rt,lt.y-ct*rt,(this.canvas.width+2*ut)*rt,(this.canvas.height+2*ct)*rt,-ut,-ct,this.canvas.width+2*ut,this.canvas.height+2*ct)}this.context.restore()}},drawDebugInfo:function(et,rt,nt,it){if(this.useCanvas){var st=this.viewer.world.getIndexOfItem(it)%this.debugGridColor.length,ot=this.context;ot.save(),ot.lineWidth=2*tt.pixelDensityRatio,ot.font="small-caps bold "+13*tt.pixelDensityRatio+"px arial",ot.strokeStyle=this.debugGridColor[st],ot.fillStyle=this.debugGridColor[st],this.viewport.degrees!==0&&this._offsetForRotation({degrees:this.viewport.degrees}),it.getRotation(!0)%360!==0&&this._offsetForRotation({degrees:it.getRotation(!0),point:it.viewport.pixelFromPointNoRotate(it._getRotationPoint(!0),!0)}),it.viewport.degrees===0&&it.getRotation(!0)%360===0&&it._drawer.viewer.viewport.getFlip()&&it._drawer._flip(),ot.strokeRect(et.position.x*tt.pixelDensityRatio,et.position.y*tt.pixelDensityRatio,et.size.x*tt.pixelDensityRatio,et.size.y*tt.pixelDensityRatio);var lt=(et.position.x+et.size.x/2)*tt.pixelDensityRatio,ut=(et.position.y+et.size.y/2)*tt.pixelDensityRatio;ot.translate(lt,ut),ot.rotate(Math.PI/180*-this.viewport.degrees),ot.translate(-lt,-ut),et.x===0&&et.y===0&&(ot.fillText("Zoom: "+this.viewport.getZoom(),et.position.x*tt.pixelDensityRatio,(et.position.y-30)*tt.pixelDensityRatio),ot.fillText("Pan: "+this.viewport.getBounds().toString(),et.position.x*tt.pixelDensityRatio,(et.position.y-20)*tt.pixelDensityRatio)),ot.fillText("Level: "+et.level,(et.position.x+10)*tt.pixelDensityRatio,(et.position.y+20)*tt.pixelDensityRatio),ot.fillText("Column: "+et.x,(et.position.x+10)*tt.pixelDensityRatio,(et.position.y+30)*tt.pixelDensityRatio),ot.fillText("Row: "+et.y,(et.position.x+10)*tt.pixelDensityRatio,(et.position.y+40)*tt.pixelDensityRatio),ot.fillText("Order: "+nt+" of "+rt,(et.position.x+10)*tt.pixelDensityRatio,(et.position.y+50)*tt.pixelDensityRatio),ot.fillText("Size: "+et.size.toString(),(et.position.x+10)*tt.pixelDensityRatio,(et.position.y+60)*tt.pixelDensityRatio),ot.fillText("Position: "+et.position.toString(),(et.position.x+10)*tt.pixelDensityRatio,(et.position.y+70)*tt.pixelDensityRatio),this.viewport.degrees!==0&&this._restoreRotationChanges(),it.getRotation(!0)%360!==0&&this._restoreRotationChanges(),it.viewport.degrees===0&&it.getRotation(!0)%360===0&&it._drawer.viewer.viewport.getFlip()&&it._drawer._flip(),ot.restore()}},debugRect:function(et){if(this.useCanvas){var rt=this.context;rt.save(),rt.lineWidth=2*tt.pixelDensityRatio,rt.strokeStyle=this.debugGridColor[0],rt.fillStyle=this.debugGridColor[0],rt.strokeRect(et.x*tt.pixelDensityRatio,et.y*tt.pixelDensityRatio,et.width*tt.pixelDensityRatio,et.height*tt.pixelDensityRatio),rt.restore()}},setImageSmoothingEnabled:function(et){this.useCanvas&&(this._imageSmoothingEnabled=et,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(et){et.msImageSmoothingEnabled=this._imageSmoothingEnabled,et.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(et){var rt=this._getContext(et).canvas;return new tt.Point(rt.width,rt.height)},getCanvasCenter:function(){return new tt.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(et){var rt=et.point?et.point.times(tt.pixelDensityRatio):this.getCanvasCenter(),nt=this._getContext(et.useSketch);nt.save(),nt.translate(rt.x,rt.y),this.viewer.viewport.flipped?(nt.rotate(Math.PI/180*-et.degrees),nt.scale(-1,1)):nt.rotate(Math.PI/180*et.degrees),nt.translate(-rt.x,-rt.y)},_flip:function(et){et=et||{};var rt=et.point?et.point.times(tt.pixelDensityRatio):this.getCanvasCenter(),nt=this._getContext(et.useSketch);nt.translate(rt.x,0),nt.scale(-1,1),nt.translate(-rt.x,0)},_restoreRotationChanges:function(et){var rt=this._getContext(et);rt.restore()},_calculateCanvasSize:function(){var et=tt.pixelDensityRatio,rt=this.viewport.getContainerSize();return{x:Math.round(rt.x*et),y:Math.round(rt.y*et)}},_calculateSketchCanvasSize:function(){var et=this._calculateCanvasSize();if(this.viewport.getRotation()===0)return et;var rt=Math.ceil(Math.sqrt(et.x*et.x+et.y*et.y));return{x:rt,y:rt}}}}(OpenSeadragon),function(tt){tt.Viewport=function(et){var rt=arguments;rt.length&&rt[0]instanceof tt.Point&&(et={containerSize:rt[0],contentSize:rt[1],config:rt[2]}),et.config&&(tt.extend(!0,et,et.config),delete et.config),this._margins=tt.extend({left:0,top:0,right:0,bottom:0},et.margins||{}),delete et.margins,tt.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:tt.DEFAULT_SETTINGS.springStiffness,animationTime:tt.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:tt.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:tt.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:tt.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:tt.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:tt.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:tt.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:tt.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:tt.DEFAULT_SETTINGS.maxZoomLevel,degrees:tt.DEFAULT_SETTINGS.degrees,flipped:tt.DEFAULT_SETTINGS.flipped,homeFillsViewer:tt.DEFAULT_SETTINGS.homeFillsViewer},et),this._updateContainerInnerSize(),this.centerSpringX=new tt.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new tt.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new tt.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new tt.Rect(0,0,1,1),1),this.goHome(!0),this.update()},tt.Viewport.prototype={resetContentSize:function(et){return tt.console.assert(et,"[Viewport.resetContentSize] contentSize is required"),tt.console.assert(et instanceof tt.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),tt.console.assert(et.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),tt.console.assert(et.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new tt.Rect(0,0,1,et.y/et.x),et.x),this},setHomeBounds:function(et,rt){tt.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(et,rt)},_setContentBounds:function(et,rt){tt.console.assert(et,"[Viewport._setContentBounds] bounds is required"),tt.console.assert(et instanceof tt.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),tt.console.assert(et.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),tt.console.assert(et.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=et.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(rt),this._contentBounds=et.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(rt),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:rt,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var et=this._contentAspectRatio/this.getAspectRatio(),rt;return this.homeFillsViewer?rt=et>=1?et:1:rt=et>=1?1:et,rt/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var et=this._contentBounds.getCenter(),rt=1/this.getHomeZoom(),nt=rt/this.getAspectRatio();return new tt.Rect(et.x-rt/2,et.y-nt/2,rt,nt)},goHome:function(et){return this.viewer&&this.viewer.raiseEvent("home",{immediately:et}),this.fitBounds(this.getHomeBounds(),et)},getMinZoom:function(){var et=this.getHomeZoom(),rt=this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*et;return rt},getMaxZoom:function(){var et=this.maxZoomLevel;return et||(et=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,et/=this._contentBounds.width),Math.max(et,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new tt.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return tt.extend({},this._margins)},setMargins:function(et){tt.console.assert(tt.type(et)==="object","[Viewport.setMargins] margins must be an object"),this._margins=tt.extend({left:0,top:0,right:0,bottom:0},et),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(et){return this.getBoundsNoRotate(et).rotate(-this.getRotation())},getBoundsNoRotate:function(et){var rt=this.getCenter(et),nt=1/this.getZoom(et),it=nt/this.getAspectRatio();return new tt.Rect(rt.x-nt/2,rt.y-it/2,nt,it)},getBoundsWithMargins:function(et){return this.getBoundsNoRotateWithMargins(et).rotate(-this.getRotation(),this.getCenter(et))},getBoundsNoRotateWithMargins:function(et){var rt=this.getBoundsNoRotate(et),nt=this._containerInnerSize.x*this.getZoom(et);return rt.x-=this._margins.left/nt,rt.y-=this._margins.top/nt,rt.width+=(this._margins.left+this._margins.right)/nt,rt.height+=(this._margins.top+this._margins.bottom)/nt,rt},getCenter:function(et){var rt=new tt.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),nt=new tt.Point(this.centerSpringX.target.value,this.centerSpringY.target.value),it,st,ot,lt,ut,ct,dt,pt;return et?rt:this.zoomPoint?(it=this.pixelFromPoint(this.zoomPoint,!0),st=this.getZoom(),ot=1/st,lt=ot/this.getAspectRatio(),ut=new tt.Rect(rt.x-ot/2,rt.y-lt/2,ot,lt),ct=this._pixelFromPoint(this.zoomPoint,ut),dt=ct.minus(it),pt=dt.divide(this._containerInnerSize.x*st),nt.plus(pt)):nt},getZoom:function(et){return et?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(et){return Math.max(Math.min(et,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(et){var rt=new tt.Rect(et.x,et.y,et.width,et.height);if(!this.wrapHorizontal){var nt=this.visibilityRatio*rt.width,it=rt.x+rt.width,st=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,ot=this._contentBoundsNoRotate.x-it+nt,lt=st-rt.x-nt;nt>this._contentBoundsNoRotate.width?rt.x+=(ot+lt)/2:lt<0?rt.x+=lt:ot>0&&(rt.x+=ot)}if(!this.wrapVertical){var ut=this.visibilityRatio*rt.height,ct=rt.y+rt.height,dt=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,pt=this._contentBoundsNoRotate.y-ct+ut,ft=dt-rt.y-ut;ut>this._contentBoundsNoRotate.height?rt.y+=(pt+ft)/2:ft<0?rt.y+=ft:pt>0&&(rt.y+=pt)}return rt},_raiseConstraintsEvent:function(et){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:et})},applyConstraints:function(et){var rt=this.getZoom(),nt=this._applyZoomConstraints(rt);rt!==nt&&this.zoomTo(nt,this.zoomPoint,et);var it=this.getBoundsNoRotate(),st=this._applyBoundaryConstraints(it);return this._raiseConstraintsEvent(et),(it.x!==st.x||it.y!==st.y||et)&&this.fitBounds(st.rotate(-this.getRotation()),et),this},ensureVisible:function(et){return this.applyConstraints(et)},_fitBounds:function(et,rt){rt=rt||{};var nt=rt.immediately||!1,it=rt.constraints||!1,st=this.getAspectRatio(),ot=et.getCenter(),lt=new tt.Rect(et.x,et.y,et.width,et.height,et.degrees+this.getRotation()).getBoundingBox();lt.getAspectRatio()>=st?lt.height=lt.width/st:lt.width=lt.height*st,lt.x=ot.x-lt.width/2,lt.y=ot.y-lt.height/2;var ut=1/lt.width;if(it){var ct=lt.getAspectRatio(),dt=this._applyZoomConstraints(ut);ut!==dt&&(ut=dt,lt.width=1/ut,lt.x=ot.x-lt.width/2,lt.height=lt.width/ct,lt.y=ot.y-lt.height/2),lt=this._applyBoundaryConstraints(lt),ot=lt.getCenter(),this._raiseConstraintsEvent(nt)}if(nt)return this.panTo(ot,!0),this.zoomTo(ut,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var pt=this.getBounds(),ft=this.getZoom();if(ft===0||Math.abs(ut/ft-1)<1e-8)return this.zoomTo(ut,!0),this.panTo(ot,nt);lt=lt.rotate(-this.getRotation());var gt=lt.getTopLeft().times(ut).minus(pt.getTopLeft().times(ft)).divide(ut-ft);return this.zoomTo(ut,gt,nt)},fitBounds:function(et,rt){return this._fitBounds(et,{immediately:rt,constraints:!1})},fitBoundsWithConstraints:function(et,rt){return this._fitBounds(et,{immediately:rt,constraints:!0})},fitVertically:function(et){var rt=new tt.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(rt,et)},fitHorizontally:function(et){var rt=new tt.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(rt,et)},getConstrainedBounds:function(et){var rt,nt;return rt=this.getBounds(et),nt=this._applyBoundaryConstraints(rt),nt},panBy:function(et,rt){var nt=new tt.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(nt.plus(et),rt)},panTo:function(et,rt){return rt?(this.centerSpringX.resetTo(et.x),this.centerSpringY.resetTo(et.y)):(this.centerSpringX.springTo(et.x),this.centerSpringY.springTo(et.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:et,immediately:rt}),this},zoomBy:function(et,rt,nt){return this.zoomTo(this.zoomSpring.target.value*et,rt,nt)},zoomTo:function(et,rt,nt){var it=this;return this.zoomPoint=rt instanceof tt.Point&&!isNaN(rt.x)&&!isNaN(rt.y)?rt:null,nt?this._adjustCenterSpringsForZoomPoint(function(){it.zoomSpring.resetTo(et)}):this.zoomSpring.springTo(et),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:et,refPoint:rt,immediately:nt}),this},setRotation:function(et){return!this.viewer||!this.viewer.drawer.canRotate()?this:(this.degrees=tt.positiveModulo(et,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:et}),this)},getRotation:function(){return this.degrees},resize:function(et,rt){var nt=this.getBoundsNoRotate(),it=nt,st;return this.containerSize.x=et.x,this.containerSize.y=et.y,this._updateContainerInnerSize(),rt&&(st=et.x/this.containerSize.x,it.width=nt.width*st,it.height=it.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:et,maintain:rt}),this.fitBounds(it,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new tt.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var et=this;this._adjustCenterSpringsForZoomPoint(function(){et.zoomSpring.update()}),this.centerSpringX.update(),this.centerSpringY.update();var rt=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,rt},_adjustCenterSpringsForZoomPoint:function(et){if(this.zoomPoint){var rt=this.pixelFromPoint(this.zoomPoint,!0);et();var nt=this.pixelFromPoint(this.zoomPoint,!0),it=nt.minus(rt),st=this.deltaPointsFromPixels(it,!0);this.centerSpringX.shiftBy(st.x),this.centerSpringY.shiftBy(st.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else et()},deltaPixelsFromPointsNoRotate:function(et,rt){return et.times(this._containerInnerSize.x*this.getZoom(rt))},deltaPixelsFromPoints:function(et,rt){return this.deltaPixelsFromPointsNoRotate(et.rotate(this.getRotation()),rt)},deltaPointsFromPixelsNoRotate:function(et,rt){return et.divide(this._containerInnerSize.x*this.getZoom(rt))},deltaPointsFromPixels:function(et,rt){return this.deltaPointsFromPixelsNoRotate(et,rt).rotate(-this.getRotation())},pixelFromPointNoRotate:function(et,rt){return this._pixelFromPointNoRotate(et,this.getBoundsNoRotate(rt))},pixelFromPoint:function(et,rt){return this._pixelFromPoint(et,this.getBoundsNoRotate(rt))},_pixelFromPointNoRotate:function(et,rt){return et.minus(rt.getTopLeft()).times(this._containerInnerSize.x/rt.width).plus(new tt.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(et,rt){return this._pixelFromPointNoRotate(et.rotate(this.getRotation(),this.getCenter(!0)),rt)},pointFromPixelNoRotate:function(et,rt){var nt=this.getBoundsNoRotate(rt);return et.minus(new tt.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/nt.width).plus(nt.getTopLeft())},pointFromPixel:function(et,rt){return this.pointFromPixelNoRotate(et,rt).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(et,rt){var nt=this._contentBoundsNoRotate.width;return new tt.Point(et*this._contentSizeNoRotate.x/nt,rt*this._contentSizeNoRotate.x/nt)},viewportToImageCoordinates:function(et,rt){if(et instanceof tt.Point)return this.viewportToImageCoordinates(et.x,et.y);if(this.viewer){var nt=this.viewer.world.getItemCount();if(nt>1)tt.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(nt===1){var it=this.viewer.world.getItemAt(0);return it.viewportToImageCoordinates(et,rt,!0)}}return this._viewportToImageDelta(et-this._contentBoundsNoRotate.x,rt-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(et,rt){var nt=this._contentBoundsNoRotate.width;return new tt.Point(et/this._contentSizeNoRotate.x*nt,rt/this._contentSizeNoRotate.x*nt)},imageToViewportCoordinates:function(et,rt){if(et instanceof tt.Point)return this.imageToViewportCoordinates(et.x,et.y);if(this.viewer){var nt=this.viewer.world.getItemCount();if(nt>1)tt.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(nt===1){var it=this.viewer.world.getItemAt(0);return it.imageToViewportCoordinates(et,rt,!0)}}var st=this._imageToViewportDelta(et,rt);return st.x+=this._contentBoundsNoRotate.x,st.y+=this._contentBoundsNoRotate.y,st},imageToViewportRectangle:function(et,rt,nt,it){var st=et;if(st instanceof tt.Rect||(st=new tt.Rect(et,rt,nt,it)),this.viewer){var ot=this.viewer.world.getItemCount();if(ot>1)tt.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(ot===1){var lt=this.viewer.world.getItemAt(0);return lt.imageToViewportRectangle(et,rt,nt,it,!0)}}var ut=this.imageToViewportCoordinates(st.x,st.y),ct=this._imageToViewportDelta(st.width,st.height);return new tt.Rect(ut.x,ut.y,ct.x,ct.y,st.degrees)},viewportToImageRectangle:function(et,rt,nt,it){var st=et;if(st instanceof tt.Rect||(st=new tt.Rect(et,rt,nt,it)),this.viewer){var ot=this.viewer.world.getItemCount();if(ot>1)tt.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(ot===1){var lt=this.viewer.world.getItemAt(0);return lt.viewportToImageRectangle(et,rt,nt,it,!0)}}var ut=this.viewportToImageCoordinates(st.x,st.y),ct=this._viewportToImageDelta(st.width,st.height);return new tt.Rect(ut.x,ut.y,ct.x,ct.y,st.degrees)},viewerElementToImageCoordinates:function(et){var rt=this.pointFromPixel(et,!0);return this.viewportToImageCoordinates(rt)},imageToViewerElementCoordinates:function(et){var rt=this.imageToViewportCoordinates(et);return this.pixelFromPoint(rt,!0)},windowToImageCoordinates:function(et){tt.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var rt=et.minus(tt.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(rt)},imageToWindowCoordinates:function(et){tt.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer.");var rt=this.imageToViewerElementCoordinates(et);return rt.plus(tt.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(et){return this.pointFromPixel(et,!0)},viewportToViewerElementCoordinates:function(et){return this.pixelFromPoint(et,!0)},viewerElementToViewportRectangle:function(et){return tt.Rect.fromSummits(this.pointFromPixel(et.getTopLeft(),!0),this.pointFromPixel(et.getTopRight(),!0),this.pointFromPixel(et.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(et){return tt.Rect.fromSummits(this.pixelFromPoint(et.getTopLeft(),!0),this.pixelFromPoint(et.getTopRight(),!0),this.pixelFromPoint(et.getBottomLeft(),!0))},windowToViewportCoordinates:function(et){tt.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var rt=et.minus(tt.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(rt)},viewportToWindowCoordinates:function(et){tt.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer.");var rt=this.viewportToViewerElementCoordinates(et);return rt.plus(tt.getElementPosition(this.viewer.element))},viewportToImageZoom:function(et){if(this.viewer){var rt=this.viewer.world.getItemCount();if(rt>1)tt.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(rt===1){var nt=this.viewer.world.getItemAt(0);return nt.viewportToImageZoom(et)}}var it=this._contentSizeNoRotate.x,st=this._containerInnerSize.x,ot=this._contentBoundsNoRotate.width,lt=st/it*ot;return et*lt},imageToViewportZoom:function(et){if(this.viewer){var rt=this.viewer.world.getItemCount();if(rt>1)tt.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(rt===1){var nt=this.viewer.world.getItemAt(0);return nt.imageToViewportZoom(et)}}var it=this._contentSizeNoRotate.x,st=this._containerInnerSize.x,ot=this._contentBoundsNoRotate.width,lt=it/st/ot;return et*lt},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(et){return this.flipped===et?this:(this.flipped=et,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:et}),this)}}}(OpenSeadragon),function(tt){tt.TiledImage=function(mt){var Kr=this;tt.console.assert(mt.tileCache,"[TiledImage] options.tileCache is required"),tt.console.assert(mt.drawer,"[TiledImage] options.drawer is required"),tt.console.assert(mt.viewer,"[TiledImage] options.viewer is required"),tt.console.assert(mt.imageLoader,"[TiledImage] options.imageLoader is required"),tt.console.assert(mt.source,"[TiledImage] options.source is required"),tt.console.assert(!mt.clip||mt.clip instanceof tt.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),tt.EventSource.call(this),this._tileCache=mt.tileCache,delete mt.tileCache,this._drawer=mt.drawer,delete mt.drawer,this._imageLoader=mt.imageLoader,delete mt.imageLoader,mt.clip instanceof tt.Rect&&(this._clip=mt.clip.clone()),delete mt.clip;var Xr=mt.x||0;delete mt.x;var Zr=mt.y||0;delete mt.y,this.normHeight=mt.source.dimensions.y/mt.source.dimensions.x,this.contentAspectX=mt.source.dimensions.x/mt.source.dimensions.y;var Qr=1;mt.width?(Qr=mt.width,delete mt.width,mt.height&&(tt.console.error("specifying both width and height to a tiledImage is not supported"),delete mt.height)):mt.height&&(Qr=mt.height/this.normHeight,delete mt.height);var _i=mt.fitBounds;delete mt.fitBounds;var ns=mt.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete mt.fitBoundsPlacement;var rs=mt.degrees||0;delete mt.degrees,tt.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:tt.DEFAULT_SETTINGS.springStiffness,animationTime:tt.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:tt.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:tt.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:tt.DEFAULT_SETTINGS.wrapVertical,immediateRender:tt.DEFAULT_SETTINGS.immediateRender,blendTime:tt.DEFAULT_SETTINGS.blendTime,alwaysBlend:tt.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:tt.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:tt.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:tt.DEFAULT_SETTINGS.iOSDevice,debugMode:tt.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:tt.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:tt.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:tt.DEFAULT_SETTINGS.placeholderFillStyle,opacity:tt.DEFAULT_SETTINGS.opacity,preload:tt.DEFAULT_SETTINGS.preload,compositeOperation:tt.DEFAULT_SETTINGS.compositeOperation},mt),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new tt.Spring({initial:Xr,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new tt.Spring({initial:Zr,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new tt.Spring({initial:Qr,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new tt.Spring({initial:rs,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),_i&&this.fitBounds(_i,ns,!0),this._drawingHandler=function(ss){Kr.viewer.raiseEvent("tile-drawing",tt.extend({tiledImage:Kr},ss))}},tt.extend(tt.TiledImage.prototype,tt.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(mt){mt!==this._fullyLoaded&&(this._fullyLoaded=mt,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=tt.now(),this._needsDraw=!0},update:function(){var mt=this._xSpring.update(),Kr=this._ySpring.update(),Xr=this._scaleSpring.update(),Zr=this._degreesSpring.update();return mt||Kr||Xr||Zr?(this._updateForScale(),this._needsDraw=!0,!0):!1},draw:function(){this.opacity!==0||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset()},getBounds:function(mt){return this.getBoundsNoRotate(mt).rotate(this.getRotation(mt),this._getRotationPoint(mt))},getBoundsNoRotate:function(mt){return mt?new tt.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new tt.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return tt.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(mt){var Kr=this.getBoundsNoRotate(mt);if(this._clip){var Xr=mt?this._worldWidthCurrent:this._worldWidthTarget,Zr=Xr/this.source.dimensions.x,Qr=this._clip.times(Zr);Kr=new tt.Rect(Kr.x+Qr.x,Kr.y+Qr.y,Qr.width,Qr.height)}return Kr.rotate(this.getRotation(mt),this._getRotationPoint(mt))},getContentSize:function(){return new tt.Point(this.source.dimensions.x,this.source.dimensions.y)},_viewportToImageDelta:function(mt,Kr,Xr){var Zr=Xr?this._scaleSpring.current.value:this._scaleSpring.target.value;return new tt.Point(mt*(this.source.dimensions.x/Zr),Kr*(this.source.dimensions.y*this.contentAspectX/Zr))},viewportToImageCoordinates:function(mt,Kr,Xr){var Zr;return mt instanceof tt.Point?(Xr=Kr,Zr=mt):Zr=new tt.Point(mt,Kr),Zr=Zr.rotate(-this.getRotation(Xr),this._getRotationPoint(Xr)),Xr?this._viewportToImageDelta(Zr.x-this._xSpring.current.value,Zr.y-this._ySpring.current.value):this._viewportToImageDelta(Zr.x-this._xSpring.target.value,Zr.y-this._ySpring.target.value)},_imageToViewportDelta:function(mt,Kr,Xr){var Zr=Xr?this._scaleSpring.current.value:this._scaleSpring.target.value;return new tt.Point(mt/this.source.dimensions.x*Zr,Kr/this.source.dimensions.y/this.contentAspectX*Zr)},imageToViewportCoordinates:function(mt,Kr,Xr){mt instanceof tt.Point&&(Xr=Kr,Kr=mt.y,mt=mt.x);var Zr=this._imageToViewportDelta(mt,Kr);return Xr?(Zr.x+=this._xSpring.current.value,Zr.y+=this._ySpring.current.value):(Zr.x+=this._xSpring.target.value,Zr.y+=this._ySpring.target.value),Zr.rotate(this.getRotation(Xr),this._getRotationPoint(Xr))},imageToViewportRectangle:function(mt,Kr,Xr,Zr,Qr){var _i=mt;_i instanceof tt.Rect?Qr=Kr:_i=new tt.Rect(mt,Kr,Xr,Zr);var ns=this.imageToViewportCoordinates(_i.getTopLeft(),Qr),rs=this._imageToViewportDelta(_i.width,_i.height,Qr);return new tt.Rect(ns.x,ns.y,rs.x,rs.y,_i.degrees+this.getRotation(Qr))},viewportToImageRectangle:function(mt,Kr,Xr,Zr,Qr){var _i=mt;mt instanceof tt.Rect?Qr=Kr:_i=new tt.Rect(mt,Kr,Xr,Zr);var ns=this.viewportToImageCoordinates(_i.getTopLeft(),Qr),rs=this._viewportToImageDelta(_i.width,_i.height,Qr);return new tt.Rect(ns.x,ns.y,rs.x,rs.y,_i.degrees-this.getRotation(Qr))},viewerElementToImageCoordinates:function(mt){var Kr=this.viewport.pointFromPixel(mt,!0);return this.viewportToImageCoordinates(Kr)},imageToViewerElementCoordinates:function(mt){var Kr=this.imageToViewportCoordinates(mt);return this.viewport.pixelFromPoint(Kr,!0)},windowToImageCoordinates:function(mt){var Kr=mt.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(Kr)},imageToWindowCoordinates:function(mt){var Kr=this.imageToViewerElementCoordinates(mt);return Kr.plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(mt){var Kr=this._scaleSpring.current.value;return mt=mt.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new tt.Rect((mt.x-this._xSpring.current.value)/Kr,(mt.y-this._ySpring.current.value)/Kr,mt.width/Kr,mt.height/Kr,mt.degrees)},viewportToImageZoom:function(mt){var Kr=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return Kr*mt},imageToViewportZoom:function(mt){var Kr=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return mt/Kr},setPosition:function(mt,Kr){var Xr=this._xSpring.target.value===mt.x&&this._ySpring.target.value===mt.y;if(Kr){if(Xr&&this._xSpring.current.value===mt.x&&this._ySpring.current.value===mt.y)return;this._xSpring.resetTo(mt.x),this._ySpring.resetTo(mt.y),this._needsDraw=!0}else{if(Xr)return;this._xSpring.springTo(mt.x),this._ySpring.springTo(mt.y),this._needsDraw=!0}Xr||this._raiseBoundsChange()},setWidth:function(mt,Kr){this._setScale(mt,Kr)},setHeight:function(mt,Kr){this._setScale(mt/this.normHeight,Kr)},setCroppingPolygons:function(mt){var Kr=function(Zr){return Zr instanceof tt.Point||typeof Zr.x=="number"&&typeof Zr.y=="number"},Xr=function(Zr){return Zr.map(function(Qr){try{if(Kr(Qr))return{x:Qr.x,y:Qr.y};throw new Error}catch{throw new Error("A Provided cropping polygon point is not supported")}})};try{if(!tt.isArray(mt))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=mt.map(function(Zr){return Xr(Zr)})}catch(Zr){tt.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),tt.console.error(Zr),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(mt,Kr,Xr){Kr=Kr||tt.Placement.CENTER;var Zr=tt.Placement.properties[Kr],Qr=this.contentAspectX,_i=0,ns=0,rs=1,ss=1;if(this._clip&&(Qr=this._clip.getAspectRatio(),rs=this._clip.width/this.source.dimensions.x,ss=this._clip.height/this.source.dimensions.y,mt.getAspectRatio()>Qr?(_i=this._clip.x/this._clip.height*mt.height,ns=this._clip.y/this._clip.height*mt.height):(_i=this._clip.x/this._clip.width*mt.width,ns=this._clip.y/this._clip.width*mt.width)),mt.getAspectRatio()>Qr){var hs=mt.height/ss,os=0;Zr.isHorizontallyCentered?os=(mt.width-mt.height*Qr)/2:Zr.isRight&&(os=mt.width-mt.height*Qr),this.setPosition(new tt.Point(mt.x-_i+os,mt.y-ns),Xr),this.setHeight(hs,Xr)}else{var is=mt.width/rs,cs=0;Zr.isVerticallyCentered?cs=(mt.height-mt.width/Qr)/2:Zr.isBottom&&(cs=mt.height-mt.width/Qr),this.setPosition(new tt.Point(mt.x-_i,mt.y-ns+cs),Xr),this.setWidth(is,Xr)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(mt){tt.console.assert(!mt||mt instanceof tt.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),mt instanceof tt.Rect?this._clip=mt.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getOpacity:function(){return this.opacity},setOpacity:function(mt){mt!==this.opacity&&(this.opacity=mt,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(mt){this._preload=!!mt,this._needsDraw=!0},getRotation:function(mt){return mt?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(mt,Kr){this._degreesSpring.target.value===mt&&this._degreesSpring.isAtTargetValue()||(Kr?this._degreesSpring.resetTo(mt):this._degreesSpring.springTo(mt),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(mt){return this.getBoundsNoRotate(mt).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(mt){mt!==this.compositeOperation&&(this.compositeOperation=mt,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(mt,Kr){var Xr=this._scaleSpring.target.value===mt;if(Kr){if(Xr&&this._scaleSpring.current.value===mt)return;this._scaleSpring.resetTo(mt),this._updateForScale(),this._needsDraw=!0}else{if(Xr)return;this._scaleSpring.springTo(mt),this._updateForScale(),this._needsDraw=!0}Xr||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var mt=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),Kr=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,Xr=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(Kr/this.minPixelRatio)/Math.log(2))));return Xr=Math.max(Xr,this.source.minLevel||0),mt=Math.min(mt,Xr),{lowestLevel:mt,highestLevel:Xr}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;){var mt=this.lastDrawn.pop();mt.beingDrawn=!1}var Kr=this.viewport,Xr=this._viewportToTiledImageRectangle(Kr.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var Zr=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(Xr=Xr.intersection(Zr),Xr===null)return}for(var Qr=this._getLevelsInterval(),_i=Qr.lowestLevel,ns=Qr.highestLevel,rs=null,ss=!1,hs=tt.now(),os=ns;os>=_i;os--){var is=!1,cs=Kr.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(os),!0).x*this._scaleSpring.current.value;if(os===_i||!ss&&cs>=this.minPixelRatio)is=!0,ss=!0;else if(!ss)continue;var ps=Kr.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(os),!1).x*this._scaleSpring.current.value,vs=Kr.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,ls=this.immediateRender?1:vs,ms=Math.min(1,(cs-.5)/.5),us=ls/Math.abs(ls-ps);if(rs=et(this,ss,is,os,ms,us,Xr,hs,rs),ct(this.coverage,os))break}_r(this,this.lastDrawn),rs&&!rs.context2D?(it(this,rs,hs),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(this._tilesLoading===0)},_getCornerTiles:function(mt,Kr,Xr){var Zr,Qr;this.wrapHorizontal?(Zr=tt.positiveModulo(Kr.x,1),Qr=tt.positiveModulo(Xr.x,1)):(Zr=Math.max(0,Kr.x),Qr=Math.min(1,Xr.x));var _i,ns,rs=1/this.source.aspectRatio;this.wrapVertical?(_i=tt.positiveModulo(Kr.y,rs),ns=tt.positiveModulo(Xr.y,rs)):(_i=Math.max(0,Kr.y),ns=Math.min(rs,Xr.y));var ss=this.source.getTileAtPoint(mt,new tt.Point(Zr,_i)),hs=this.source.getTileAtPoint(mt,new tt.Point(Qr,ns)),os=this.source.getNumTiles(mt);return this.wrapHorizontal&&(ss.x+=os.x*Math.floor(Kr.x),hs.x+=os.x*Math.floor(Xr.x)),this.wrapVertical&&(ss.y+=os.y*Math.floor(Kr.y/rs),hs.y+=os.y*Math.floor(Xr.y/rs)),{topLeft:ss,bottomRight:hs}}});function et(mt,Kr,Xr,Zr,Qr,_i,ns,rs,ss){var hs=ns.getBoundingBox().getTopLeft(),os=ns.getBoundingBox().getBottomRight();mt.viewer&&mt.viewer.raiseEvent("update-level",{tiledImage:mt,havedrawn:Kr,level:Zr,opacity:Qr,visibility:_i,drawArea:ns,topleft:hs,bottomright:os,currenttime:rs,best:ss}),ft(mt.coverage,Zr),ft(mt.loadingCoverage,Zr);for(var is=mt._getCornerTiles(Zr,hs,os),cs=is.topLeft,ps=is.bottomRight,vs=mt.source.getNumTiles(Zr),ls=mt.viewport.pixelFromPoint(mt.viewport.getCenter()),ms=cs.x;ms<=ps.x;ms++)for(var us=cs.y;us<=ps.y;us++){if(!mt.wrapHorizontal&&!mt.wrapVertical){var gs=mt.source.getTileBounds(Zr,ms,us);if(ns.intersection(gs)===null)continue}ss=rt(mt,Xr,Kr,ms,us,Zr,Qr,_i,ls,vs,rs,ss)}return ss}function rt(mt,Kr,Xr,Zr,Qr,_i,ns,rs,ss,hs,os,is){var cs=nt(Zr,Qr,_i,mt,mt.source,mt.tilesMatrix,os,hs,mt._worldWidthCurrent,mt._worldHeightCurrent),ps=Xr;mt.viewer&&mt.viewer.raiseEvent("update-tile",{tiledImage:mt,tile:cs}),pt(mt.coverage,_i,Zr,Qr,!1);var vs=cs.loaded||cs.loading||dt(mt.loadingCoverage,_i,Zr,Qr);if(pt(mt.loadingCoverage,_i,Zr,Qr,vs),!cs.exists||(Kr&&!ps&&(dt(mt.coverage,_i,Zr,Qr)?pt(mt.coverage,_i,Zr,Qr,!0):ps=!0),!ps))return is;if(lt(cs,mt.source.tileOverlap,mt.viewport,ss,rs,mt),!cs.loaded)if(cs.context2D)ot(mt,cs);else{var ls=mt._tileCache.getImageRecord(cs.cacheKey);if(ls){var ms=ls.getImage();ot(mt,cs,ms)}}if(cs.loaded){var us=ut(mt,cs,Zr,Qr,_i,ns,os);us&&(mt._needsDraw=!0)}else cs.loading?mt._tilesLoading++:vs||(is=gt(is,cs));return is}function nt(mt,Kr,Xr,Zr,Qr,_i,ns,rs,ss,hs){var os,is,cs,ps,vs,ls,ms,us,gs;return _i[Xr]||(_i[Xr]={}),_i[Xr][mt]||(_i[Xr][mt]={}),_i[Xr][mt][Kr]||(os=(rs.x+mt%rs.x)%rs.x,is=(rs.y+Kr%rs.y)%rs.y,cs=Qr.getTileBounds(Xr,os,is),ps=Qr.getTileBounds(Xr,os,is,!0),vs=Qr.tileExists(Xr,os,is),ls=Qr.getTileUrl(Xr,os,is),Zr.loadTilesWithAjax?(ms=Qr.getTileAjaxHeaders(Xr,os,is),tt.isPlainObject(Zr.ajaxHeaders)&&(ms=tt.extend({},Zr.ajaxHeaders,ms))):ms=null,us=Qr.getContext2D?Qr.getContext2D(Xr,os,is):void 0,cs.x+=(mt-os)/rs.x,cs.y+=hs/ss*((Kr-is)/rs.y),gs=new tt.Tile(Xr,mt,Kr,cs,vs,ls,us,Zr.loadTilesWithAjax,ms,ps),os===rs.x-1&&(gs.isRightMost=!0),is===rs.y-1&&(gs.isBottomMost=!0),_i[Xr][mt][Kr]=gs),gs=_i[Xr][mt][Kr],gs.lastTouchTime=ns,gs}function it(mt,Kr,Xr){Kr.loading=!0,mt._imageLoader.addJob({src:Kr.url,loadWithAjax:Kr.loadWithAjax,ajaxHeaders:Kr.ajaxHeaders,crossOriginPolicy:mt.crossOriginPolicy,ajaxWithCredentials:mt.ajaxWithCredentials,callback:function(Zr,Qr,_i){st(mt,Kr,Xr,Zr,Qr,_i)},abort:function(){Kr.loading=!1}})}function st(mt,Kr,Xr,Zr,Qr,_i){if(!Zr){tt.console.log("Tile %s failed to load: %s - error: %s",Kr,Kr.url,Qr),mt.viewer.raiseEvent("tile-load-failed",{tile:Kr,tiledImage:mt,time:Xr,message:Qr,tileRequest:_i}),Kr.loading=!1,Kr.exists=!1;return}if(Xr<mt.lastResetTime){tt.console.log("Ignoring tile %s loaded before reset: %s",Kr,Kr.url),Kr.loading=!1;return}var ns=function(){var rs=mt.source.getClosestLevel();ot(mt,Kr,Zr,rs,_i)};mt._midDraw?window.setTimeout(ns,1):ns()}function ot(mt,Kr,Xr,Zr,Qr){var _i=0;function ns(){return _i++,rs}function rs(){_i--,_i===0&&(Kr.loading=!1,Kr.loaded=!0,Kr.context2D||mt._tileCache.cacheTile({image:Xr,tile:Kr,cutoff:Zr,tiledImage:mt}),mt._needsDraw=!0)}mt.viewer.raiseEvent("tile-loaded",{tile:Kr,tiledImage:mt,tileRequest:Qr,image:Xr,getCompletionCallback:ns}),ns()()}function lt(mt,Kr,Xr,Zr,Qr,_i){var ns=mt.bounds.getTopLeft();ns.x*=_i._scaleSpring.current.value,ns.y*=_i._scaleSpring.current.value,ns.x+=_i._xSpring.current.value,ns.y+=_i._ySpring.current.value;var rs=mt.bounds.getSize();rs.x*=_i._scaleSpring.current.value,rs.y*=_i._scaleSpring.current.value;var ss=Xr.pixelFromPointNoRotate(ns,!0),hs=Xr.pixelFromPointNoRotate(ns,!1),os=Xr.deltaPixelsFromPointsNoRotate(rs,!0),is=Xr.deltaPixelsFromPointsNoRotate(rs,!1),cs=hs.plus(is.divide(2)),ps=Zr.squaredDistanceTo(cs);Kr||(os=os.plus(new tt.Point(1,1))),mt.isRightMost&&_i.wrapHorizontal&&(os.x+=.75),mt.isBottomMost&&_i.wrapVertical&&(os.y+=.75),mt.position=ss,mt.size=os,mt.squaredDistance=ps,mt.visibility=Qr}function ut(mt,Kr,Xr,Zr,Qr,_i,ns){var rs=1e3*mt.blendTime,ss,hs;if(Kr.blendStart||(Kr.blendStart=ns),ss=ns-Kr.blendStart,hs=rs?Math.min(1,ss/rs):1,mt.alwaysBlend&&(hs*=_i),Kr.opacity=hs,mt.lastDrawn.push(Kr),hs===1)pt(mt.coverage,Qr,Xr,Zr,!0),mt._hasOpaqueTile=!0;else if(ss<rs)return!0;return!1}function ct(mt,Kr,Xr,Zr){var Qr,_i,ns,rs;if(!mt[Kr])return!1;if(Xr===void 0||Zr===void 0){Qr=mt[Kr];for(ns in Qr)if(Object.prototype.hasOwnProperty.call(Qr,ns)){_i=Qr[ns];for(rs in _i)if(Object.prototype.hasOwnProperty.call(_i,rs)&&!_i[rs])return!1}return!0}return mt[Kr][Xr]===void 0||mt[Kr][Xr][Zr]===void 0||mt[Kr][Xr][Zr]===!0}function dt(mt,Kr,Xr,Zr){return Xr===void 0||Zr===void 0?ct(mt,Kr+1):ct(mt,Kr+1,2*Xr,2*Zr)&&ct(mt,Kr+1,2*Xr,2*Zr+1)&&ct(mt,Kr+1,2*Xr+1,2*Zr)&&ct(mt,Kr+1,2*Xr+1,2*Zr+1)}function pt(mt,Kr,Xr,Zr,Qr){if(!mt[Kr]){tt.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",Kr);return}mt[Kr][Xr]||(mt[Kr][Xr]={}),mt[Kr][Xr][Zr]=Qr}function ft(mt,Kr){mt[Kr]={}}function gt(mt,Kr){return!mt||Kr.visibility>mt.visibility||Kr.visibility==mt.visibility&&Kr.squaredDistance<mt.squaredDistance?Kr:mt}function _r(mt,Kr){if(!(mt.opacity===0||Kr.length===0&&!mt.placeholderFillStyle)){var Xr=Kr[0],Zr;Xr&&(Zr=mt.opacity<1||mt.compositeOperation&&mt.compositeOperation!=="source-over"||!mt._isBottomItem()&&Xr._hasTransparencyChannel());var Qr,_i,ns=mt.viewport.getZoom(!0),rs=mt.viewportToImageZoom(ns);Kr.length>1&&rs>mt.smoothTileEdgesMinZoom&&!mt.iOSDevice&&mt.getRotation(!0)%360===0&&tt.supportsCanvas&&(Zr=!0,Qr=Xr.getScaleForEdgeSmoothing(),_i=Xr.getTranslationForEdgeSmoothing(Qr,mt._drawer.getCanvasSize(!1),mt._drawer.getCanvasSize(!0)));var ss;Zr&&(Qr||(ss=mt.viewport.viewportToViewerElementRectangle(mt.getClippedBounds(!0)).getIntegerBoundingBox(),mt._drawer.viewer.viewport.getFlip()&&(mt.viewport.degrees!==0||mt.getRotation(!0)%360!==0)&&(ss.x=mt._drawer.viewer.container.clientWidth-(ss.x+ss.width)),ss=ss.times(tt.pixelDensityRatio)),mt._drawer._clear(!0,ss)),Qr||(mt.viewport.degrees!==0&&mt._drawer._offsetForRotation({degrees:mt.viewport.degrees,useSketch:Zr}),mt.getRotation(!0)%360!==0&&mt._drawer._offsetForRotation({degrees:mt.getRotation(!0),point:mt.viewport.pixelFromPointNoRotate(mt._getRotationPoint(!0),!0),useSketch:Zr}),mt.viewport.degrees===0&&mt.getRotation(!0)%360===0&&mt._drawer.viewer.viewport.getFlip()&&mt._drawer._flip());var hs=!1;if(mt._clip){mt._drawer.saveContext(Zr);var os=mt.imageToViewportRectangle(mt._clip,!0);os=os.rotate(-mt.getRotation(!0),mt._getRotationPoint(!0));var is=mt._drawer.viewportToDrawerRectangle(os);Qr&&(is=is.times(Qr)),_i&&(is=is.translate(_i)),mt._drawer.setClip(is,Zr),hs=!0}if(mt._croppingPolygons){mt._drawer.saveContext(Zr);try{var cs=mt._croppingPolygons.map(function(ms){return ms.map(function(us){var gs=mt.imageToViewportCoordinates(us.x,us.y,!0).rotate(-mt.getRotation(!0),mt._getRotationPoint(!0)),ys=mt._drawer.viewportCoordToDrawerCoord(gs);return Qr&&(ys=ys.times(Qr)),ys})});mt._drawer.clipWithPolygons(cs,Zr)}catch(ms){tt.console.error(ms)}hs=!0}if(mt.placeholderFillStyle&&mt._hasOpaqueTile===!1){var ps=mt._drawer.viewportToDrawerRectangle(mt.getBounds(!0));Qr&&(ps=ps.times(Qr)),_i&&(ps=ps.translate(_i));var vs=null;typeof mt.placeholderFillStyle=="function"?vs=mt.placeholderFillStyle(mt,mt._drawer.context):vs=mt.placeholderFillStyle,mt._drawer.drawRectangle(ps,vs,Zr)}for(var ls=Kr.length-1;ls>=0;ls--)Xr=Kr[ls],mt._drawer.drawTile(Xr,mt._drawingHandler,Zr,Qr,_i),Xr.beingDrawn=!0,mt.viewer&&mt.viewer.raiseEvent("tile-drawn",{tiledImage:mt,tile:Xr});hs&&mt._drawer.restoreContext(Zr),Qr||(mt.getRotation(!0)%360!==0&&mt._drawer._restoreRotationChanges(Zr),mt.viewport.degrees!==0&&mt._drawer._restoreRotationChanges(Zr)),Zr&&(Qr&&(mt.viewport.degrees!==0&&mt._drawer._offsetForRotation({degrees:mt.viewport.degrees,useSketch:!1}),mt.getRotation(!0)%360!==0&&mt._drawer._offsetForRotation({degrees:mt.getRotation(!0),point:mt.viewport.pixelFromPointNoRotate(mt._getRotationPoint(!0),!0),useSketch:!1})),mt._drawer.blendSketch({opacity:mt.opacity,scale:Qr,translate:_i,compositeOperation:mt.compositeOperation,bounds:ss}),Qr&&(mt.getRotation(!0)%360!==0&&mt._drawer._restoreRotationChanges(!1),mt.viewport.degrees!==0&&mt._drawer._restoreRotationChanges(!1))),Qr||mt.viewport.degrees===0&&mt.getRotation(!0)%360===0&&mt._drawer.viewer.viewport.getFlip()&&mt._drawer._flip(),Yr(mt,Kr)}}function Yr(mt,Kr){if(mt.debugMode)for(var Xr=Kr.length-1;Xr>=0;Xr--){var Zr=Kr[Xr];try{mt._drawer.drawDebugInfo(Zr,Kr.length,Xr,mt)}catch(Qr){tt.console.error(Qr)}}}}(OpenSeadragon),function(tt){var et=function(nt){tt.console.assert(nt,"[TileCache.cacheTile] options is required"),tt.console.assert(nt.tile,"[TileCache.cacheTile] options.tile is required"),tt.console.assert(nt.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=nt.tile,this.tiledImage=nt.tiledImage},rt=function(nt){tt.console.assert(nt,"[ImageRecord] options is required"),tt.console.assert(nt.image,"[ImageRecord] options.image is required"),this._image=nt.image,this._tiles=[]};rt.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var nt=document.createElement("canvas");nt.width=this._image.width,nt.height=this._image.height,this._renderedContext=nt.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(nt){tt.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=nt},addTile:function(nt){tt.console.assert(nt,"[ImageRecord.addTile] tile is required"),this._tiles.push(nt)},removeTile:function(nt){for(var it=0;it<this._tiles.length;it++)if(this._tiles[it]===nt){this._tiles.splice(it,1);return}tt.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",nt)},getTileCount:function(){return this._tiles.length}},tt.TileCache=function(nt){nt=nt||{},this._maxImageCacheCount=nt.maxImageCacheCount||tt.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},tt.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(nt){tt.console.assert(nt,"[TileCache.cacheTile] options is required"),tt.console.assert(nt.tile,"[TileCache.cacheTile] options.tile is required"),tt.console.assert(nt.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),tt.console.assert(nt.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var it=nt.cutoff||0,st=this._tilesLoaded.length,ot=this._imagesLoaded[nt.tile.cacheKey];if(ot||(tt.console.assert(nt.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),ot=this._imagesLoaded[nt.tile.cacheKey]=new rt({image:nt.image}),this._imagesLoadedCount++),ot.addTile(nt.tile),nt.tile.cacheImageRecord=ot,this._imagesLoadedCount>this._maxImageCacheCount){for(var lt=null,ut=-1,ct=null,dt,pt,ft,gt,_r,Yr,mt=this._tilesLoaded.length-1;mt>=0;mt--)if(Yr=this._tilesLoaded[mt],dt=Yr.tile,!(dt.level<=it||dt.beingDrawn)){if(!lt){lt=dt,ut=mt,ct=Yr;continue}gt=dt.lastTouchTime,pt=lt.lastTouchTime,_r=dt.level,ft=lt.level,(gt<pt||gt==pt&&_r>ft)&&(lt=dt,ut=mt,ct=Yr)}lt&&ut>=0&&(this._unloadTile(ct),st=ut)}this._tilesLoaded[st]=new et({tile:nt.tile,tiledImage:nt.tiledImage})},clearTilesFor:function(nt){tt.console.assert(nt,"[TileCache.clearTilesFor] tiledImage is required");for(var it,st=0;st<this._tilesLoaded.length;++st)it=this._tilesLoaded[st],it.tiledImage===nt&&(this._unloadTile(it),this._tilesLoaded.splice(st,1),st--)},getImageRecord:function(nt){return tt.console.assert(nt,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[nt]},_unloadTile:function(nt){tt.console.assert(nt,"[TileCache._unloadTile] tileRecord is required");var it=nt.tile,st=nt.tiledImage;it.unload(),it.cacheImageRecord=null;var ot=this._imagesLoaded[it.cacheKey];ot.removeTile(it),ot.getTileCount()||(ot.destroy(),delete this._imagesLoaded[it.cacheKey],this._imagesLoadedCount--),st.viewer.raiseEvent("tile-unloaded",{tile:it,tiledImage:st})}}}(OpenSeadragon),function(tt){tt.World=function(et){var rt=this;tt.console.assert(et.viewer,"[World] options.viewer is required"),tt.EventSource.call(this),this.viewer=et.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(nt){rt._autoRefigureSizes?rt._figureSizes():rt._needsSizesFigured=!0},this._figureSizes()},tt.extend(tt.World.prototype,tt.EventSource.prototype,{addItem:function(et,rt){if(tt.console.assert(et,"[World.addItem] item is required"),tt.console.assert(et instanceof tt.TiledImage,"[World.addItem] only TiledImages supported at this time"),rt=rt||{},rt.index!==void 0){var nt=Math.max(0,Math.min(this._items.length,rt.index));this._items.splice(nt,0,et)}else this._items.push(et);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,et.addHandler("bounds-change",this._delegatedFigureSizes),et.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:et})},getItemAt:function(et){return tt.console.assert(et!==void 0,"[World.getItemAt] index is required"),this._items[et]},getIndexOfItem:function(et){return tt.console.assert(et,"[World.getIndexOfItem] item is required"),tt.indexOf(this._items,et)},getItemCount:function(){return this._items.length},setItemIndex:function(et,rt){tt.console.assert(et,"[World.setItemIndex] item is required"),tt.console.assert(rt!==void 0,"[World.setItemIndex] index is required");var nt=this.getIndexOfItem(et);if(rt>=this._items.length)throw new Error("Index bigger than number of layers.");rt===nt||nt===-1||(this._items.splice(nt,1),this._items.splice(rt,0,et),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:et,previousIndex:nt,newIndex:rt}))},removeItem:function(et){tt.console.assert(et,"[World.removeItem] item is required");var rt=tt.indexOf(this._items,et);rt!==-1&&(et.removeHandler("bounds-change",this._delegatedFigureSizes),et.removeHandler("clip-change",this._delegatedFigureSizes),et.destroy(),this._items.splice(rt,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(et))},removeAll:function(){this.viewer._cancelPendingImages();var et,rt;for(rt=0;rt<this._items.length;rt++)et=this._items[rt],et.removeHandler("bounds-change",this._delegatedFigureSizes),et.removeHandler("clip-change",this._delegatedFigureSizes),et.destroy();var nt=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,rt=0;rt<nt.length;rt++)et=nt[rt],this._raiseRemoveItem(et)},resetItems:function(){for(var et=0;et<this._items.length;et++)this._items[et].reset()},update:function(){for(var et=!1,rt=0;rt<this._items.length;rt++)et=this._items[rt].update()||et;return et},draw:function(){for(var et=0;et<this._items.length;et++)this._items[et].draw();this._needsDraw=!1},needsDraw:function(){for(var et=0;et<this._items.length;et++)if(this._items[et].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(et){this._autoRefigureSizes=et,et&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(et){et=et||{};var rt=et.immediately||!1,nt=et.layout||tt.DEFAULT_SETTINGS.collectionLayout,it=et.rows||tt.DEFAULT_SETTINGS.collectionRows,st=et.columns||tt.DEFAULT_SETTINGS.collectionColumns,ot=et.tileSize||tt.DEFAULT_SETTINGS.collectionTileSize,lt=et.tileMargin||tt.DEFAULT_SETTINGS.collectionTileMargin,ut=ot+lt,ct;!et.rows&&st?ct=st:ct=Math.ceil(this._items.length/it);var dt=0,pt=0,ft,gt,_r,Yr,mt;this.setAutoRefigureSizes(!1);for(var Kr=0;Kr<this._items.length;Kr++)Kr&&Kr%ct===0&&(nt==="horizontal"?(pt+=ut,dt=0):(dt+=ut,pt=0)),ft=this._items[Kr],gt=ft.getBounds(),gt.width>gt.height?_r=ot:_r=ot*(gt.width/gt.height),Yr=_r*(gt.height/gt.width),mt=new tt.Point(dt+(ot-_r)/2,pt+(ot-Yr)/2),ft.setPosition(mt,rt),ft.setWidth(_r,rt),nt==="horizontal"?dt+=ut:pt+=ut;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var et=this._homeBounds?this._homeBounds.clone():null,rt=this._contentSize?this._contentSize.clone():null,nt=this._contentFactor||0;if(!this._items.length)this._homeBounds=new tt.Rect(0,0,1,1),this._contentSize=new tt.Point(1,1),this._contentFactor=1;else{var it=this._items[0],st=it.getBounds();this._contentFactor=it.getContentSize().x/st.width;for(var ot=it.getClippedBounds().getBoundingBox(),lt=ot.x,ut=ot.y,ct=ot.x+ot.width,dt=ot.y+ot.height,pt=1;pt<this._items.length;pt++)it=this._items[pt],st=it.getBounds(),this._contentFactor=Math.max(this._contentFactor,it.getContentSize().x/st.width),ot=it.getClippedBounds().getBoundingBox(),lt=Math.min(lt,ot.x),ut=Math.min(ut,ot.y),ct=Math.max(ct,ot.x+ot.width),dt=Math.max(dt,ot.y+ot.height);this._homeBounds=new tt.Rect(lt,ut,ct-lt,dt-ut),this._contentSize=new tt.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}(this._contentFactor!==nt||!this._homeBounds.equals(et)||!this._contentSize.equals(rt))&&this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(et){this.raiseEvent("remove-item",{item:et})}})}(OpenSeadragon)})(openseadragon);var openseadragonExports=openseadragon.exports;const le=getDefaultExportFromCjs$1(openseadragonExports),$6be4966fd9bbc698$var$SWITCH_NAME="Switch",[$6be4966fd9bbc698$var$createSwitchContext,$6be4966fd9bbc698$export$cf7f5f17f69cbd43]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($6be4966fd9bbc698$var$SWITCH_NAME),[$6be4966fd9bbc698$var$SwitchProvider,$6be4966fd9bbc698$var$useSwitchContext]=$6be4966fd9bbc698$var$createSwitchContext($6be4966fd9bbc698$var$SWITCH_NAME),$6be4966fd9bbc698$export$b5d5cf8927ab7262=reactExports.forwardRef((tt,et)=>{const{__scopeSwitch:rt,name:nt,checked:it,defaultChecked:st,required:ot,disabled:lt,value:ut="on",onCheckedChange:ct,...dt}=tt,[pt,ft]=reactExports.useState(null),gt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,Xr=>ft(Xr)),_r=reactExports.useRef(!1),Yr=pt?!!pt.closest("form"):!0,[mt=!1,Kr]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:it,defaultProp:st,onChange:ct});return reactExports.createElement($6be4966fd9bbc698$var$SwitchProvider,{scope:rt,checked:mt,disabled:lt},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button",role:"switch","aria-checked":mt,"aria-required":ot,"data-state":$6be4966fd9bbc698$var$getState(mt),"data-disabled":lt?"":void 0,disabled:lt,value:ut},dt,{ref:gt,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onClick,Xr=>{Kr(Zr=>!Zr),Yr&&(_r.current=Xr.isPropagationStopped(),_r.current||Xr.stopPropagation())})})),Yr&&reactExports.createElement($6be4966fd9bbc698$var$BubbleInput,{control:pt,bubbles:!_r.current,name:nt,value:ut,checked:mt,required:ot,disabled:lt,style:{transform:"translateX(-100%)"}}))}),$6be4966fd9bbc698$var$THUMB_NAME="SwitchThumb",$6be4966fd9bbc698$export$4d07bf653ea69106=reactExports.forwardRef((tt,et)=>{const{__scopeSwitch:rt,...nt}=tt,it=$6be4966fd9bbc698$var$useSwitchContext($6be4966fd9bbc698$var$THUMB_NAME,rt);return reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({"data-state":$6be4966fd9bbc698$var$getState(it.checked),"data-disabled":it.disabled?"":void 0},nt,{ref:et}))}),$6be4966fd9bbc698$var$BubbleInput=tt=>{const{control:et,checked:rt,bubbles:nt=!0,...it}=tt,st=reactExports.useRef(null),ot=$010c2913dbd2fe3d$export$5cae361ad82dce8b(rt),lt=$db6c3485150b8e66$export$1ab7ae714698c4b8(et);return reactExports.useEffect(()=>{const ut=st.current,ct=window.HTMLInputElement.prototype,pt=Object.getOwnPropertyDescriptor(ct,"checked").set;if(ot!==rt&&pt){const ft=new Event("click",{bubbles:nt});pt.call(ut,rt),ut.dispatchEvent(ft)}},[ot,rt,nt]),reactExports.createElement("input",_extends$1({type:"checkbox","aria-hidden":!0,defaultChecked:rt},it,{tabIndex:-1,ref:st,style:{...tt.style,...lt,position:"absolute",pointerEvents:"none",opacity:0,margin:0}}))};function $6be4966fd9bbc698$var$getState(tt){return tt?"checked":"unchecked"}const $6be4966fd9bbc698$export$be92b6f5f03c0fe9=$6be4966fd9bbc698$export$b5d5cf8927ab7262,$6be4966fd9bbc698$export$6521433ed15a34db=$6be4966fd9bbc698$export$4d07bf653ea69106,ht=tt=>{const et=tt.toString().split(":"),rt=Math.ceil(parseInt(et[0])),nt=Math.ceil(parseInt(et[1])),it=xt(Math.ceil(parseInt(et[2])),2);let st=`${rt!==0&&nt<10?(nt+"").padStart(2,"0"):nt}:${it}`;return rt!==0&&(st=`${rt}:${st}`),st},Ee=tt=>{const et=new Date(tt*1e3).toISOString().substr(11,8);return ht(et)},we=(tt,et)=>{if(typeof tt!="object"||tt===null)return et;for(const rt in et)typeof et[rt]=="object"&&et[rt]!==null&&!Array.isArray(et[rt])?(tt[rt]||(tt[rt]={}),tt[rt]=we(tt[rt],et[rt])):tt[rt]=et[rt];return tt},Ce=(tt,et)=>Object.hasOwn(tt,et)?tt[et].toString():void 0,xt=(tt,et)=>String(tt).padStart(et,"0"),j={background:"transparent",canvasBackgroundColor:"#6662",canvasHeight:"61.8vh",ignoreCaptionLabels:[],informationPanel:{open:!0,renderAbout:!0,renderSupplementing:!0,renderToggle:!0},openSeadragon:{},requestHeaders:{"Content-Type":"application/json"},showIIIFBadge:!0,showTitle:!0,withCredentials:!1};var xe;const _={activeCanvas:"",activeManifest:"",collection:{},configOptions:j,customDisplays:[],informationOpen:(xe=j==null?void 0:j.informationPanel)==null?void 0:xe.open,isLoaded:!1,vault:new Vault},Se=e$1.createContext(_),ke=e$1.createContext(_);function vt(tt,et){switch(et.type){case"updateActiveCanvas":return et.canvasId||(et.canvasId=""),{...tt,activeCanvas:et.canvasId};case"updateActiveManifest":return{...tt,activeManifest:et.manifestId};case"updateCollection":return{...tt,collection:et.collection};case"updateConfigOptions":return{...tt,configOptions:we(tt.configOptions,et.configOptions)};case"updateInformationOpen":return{...tt,informationOpen:et.informationOpen};case"updateIsLoaded":return{...tt,isLoaded:et.isLoaded};default:throw new Error(`Unhandled action type: ${et.type}`)}}const bt=({initialState:tt=_,children:et})=>{const[rt,nt]=reactExports.useReducer(vt,tt);return e$1.createElement(Se.Provider,{value:rt},e$1.createElement(ke.Provider,{value:nt},et))};function k(){const tt=e$1.useContext(Se);if(tt===void 0)throw new Error("useViewerState must be used within a ViewerProvider");return tt}function O(){const tt=e$1.useContext(ke);if(tt===void 0)throw new Error("useViewerDispatch must be used within a ViewerProvider");return tt}const Ie=(tt,et,rt,nt)=>{var it,st;const ot={canvas:void 0,accompanyingCanvas:void 0,annotationPage:void 0,annotations:[]},lt=ut=>{if(ut){if(!ut.body||!ut.motivation){console.error("Invalid annotation after Hyperion parsing: missing either 'body' or 'motivation'",ut);return}let ct=ut.body;Array.isArray(ct)&&(ct=ct[0]);const dt=tt.get(ct.id);if(!dt)return;switch(rt){case"painting":return ut.target===et.id&&ut.motivation&&ut.motivation[0]==="painting"&&nt.includes(dt.type)&&(ut.body=dt),!!ut;case"supplementing":return;default:throw new Error("Invalid annotation motivation.")}}};if(ot.canvas=tt.get(et),ot.canvas&&(ot.annotationPage=tt.get(ot.canvas.items[0]),ot.accompanyingCanvas=(it=ot.canvas)!=null&&it.accompanyingCanvas?tt.get((st=ot.canvas)==null?void 0:st.accompanyingCanvas):void 0),ot.annotationPage){const ut=tt.get(ot.annotationPage.items).map(dt=>({body:tt.get(dt.body[0].id),motivation:dt.motivation,type:"Annotation"})),ct=[];ut.forEach(dt=>{dt.body.type==="Choice"?dt.body.items.forEach(pt=>ct.push({...dt,id:pt.id,body:tt.get(pt.id)})):ct.push(dt)}),ot.annotations=ct.filter(lt)}return ot},D=(tt,et="en")=>{if(!tt)return"";if(!tt[et]){const rt=Object.getOwnPropertyNames(tt);if(rt.length>0)return tt[rt[0]]}return tt[et]},N=(tt,et)=>{const rt=Ie(tt,{id:et,type:"Canvas"},"painting",["Image","Sound","Video"]);if(rt.annotations.length!==0&&rt.annotations&&rt.annotations)return rt.annotations.map(nt=>nt==null?void 0:nt.body)},yt=(tt,et,rt)=>{const nt=tt.get({id:et,type:"Canvas"});if(!(nt!=null&&nt.annotations)||!nt.annotations[0])return[];const it=tt.get(nt.annotations[0]),st=tt.get(it.items);return Array.isArray(st)?st.filter(ot=>{var lt;if(ot.body&&(lt=ot.motivation)!=null&&lt.includes("supplementing")){let ut=ot.body;Array.isArray(ut)&&(ut=ut[0]);const ct=tt.get(ut.id);if(ct.format===rt)return ot.body=ct,ot}}).map(ot=>ot.body):[]},Et=(tt,et,rt,nt)=>{const it=[];if(et.canvas&&et.canvas.thumbnail.length>0){const st=tt.get(et.canvas.thumbnail[0]);it.push(st)}if(et.annotations[0]){if(et.annotations[0].thumbnail&&et.annotations[0].thumbnail.length>0){const ot=tt.get(et.annotations[0].thumbnail[0]);it.push(ot)}if(!et.annotations[0].body)return;const st=et.annotations[0].body;st.type==="Image"&&it.push(st)}return it.length===0?void 0:{id:it[0].id,format:it[0].format,type:it[0].type,width:rt,height:nt}},X=209,wt={colors:{primary:"#1a1d1e",primaryMuted:"#26292b",primaryAlt:"#151718",accent:`hsl(${X} 100% 38.2%)`,accentMuted:`hsl(${X} 80% 61.8%)`,accentAlt:`hsl(${X} 80% 30%)`,secondary:"#FFFFFF",secondaryMuted:"#e6e8eb",secondaryAlt:"#c1c8cd"},fontSizes:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},lineHeights:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},sizes:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},space:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},radii:{1:"4px",2:"6px",3:"8px",4:"12px",round:"50%",pill:"9999px"},transitions:{all:"all 300ms cubic-bezier(0.16, 1, 0.3, 1)"},zIndices:{1:"100",2:"200",3:"300",4:"400",max:"999"}},te={xxs:"(max-width: 349px)",xs:"(max-width: 575px)",sm:"(max-width: 767px)",md:"(max-width: 991px)",lg:"(max-width: 90rem)",xl:"(min-width: calc(90rem + 1px))"},{styled:m,css:ro,keyframes:ne,createTheme:oo}=q({theme:wt,media:te}),Ct=m("div",{display:"flex",flexDirection:"column",alignItems:"center"}),St=m("p",{fontWeight:"bold",fontSize:"x-large"}),kt=m("span",{fontSize:"medium"}),It=({error:tt})=>{const{message:et}=tt;return e$1.createElement(Ct,{role:"alert"},e$1.createElement(St,{"data-testid":"headline"},"Something went wrong"),et&&e$1.createElement(kt,null,`Error message: ${et}`," "))},$e=m("div",{position:"relative",zIndex:"0"}),Ae=m("div",{display:"flex",flexDirection:"row",overflow:"hidden","@sm":{flexDirection:"column"}}),Te=m("div",{display:"flex",flexDirection:"column",flexGrow:"1",flexShrink:"1",width:"61.8%","@sm":{width:"100%"}}),Me=m($409067139f391064$export$41fb9f06171c75f4,{display:"none",border:"none",padding:"0",transition:"$all",opacity:"1",background:"#6663",margin:"1rem 0",borderRadius:"6px","&[data-information-panel='false']":{opacity:"0",marginTop:"-59px"},"@sm":{display:"flex","> span":{display:"flex",flexGrow:"1",fontSize:"0.8333em",justifyContent:"center",padding:"0.5rem",fontFamily:"inherit"}}}),Re=m($409067139f391064$export$7c6e2c02157bb7d2,{width:"100%",display:"flex"}),$t=m("aside",{display:"flex",flexGrow:"1",flexShrink:"0",width:"38.2%",maxHeight:"100%","@sm":{width:"100%"}}),At=m("div",{display:"flex",flexDirection:"column",fontSmooth:"auto",webkitFontSmoothing:"antialiased","> div":{display:"flex",flexDirection:"column",flexGrow:"1",justifyContent:"flex-start","@sm":{[`& ${Ae}`]:{flexGrow:"1"},[`& ${Te}`]:{flexGrow:"0"}}},"@sm":{padding:"0"},"&[data-information-panel-open='true']":{"@sm":{position:"fixed",height:"100%",width:"100%",top:"0",left:"0",zIndex:"2500000000",[`& ${$e}`]:{display:"none"},[`& ${Me}`]:{margin:"1rem"},[`& ${Re}`]:{height:"100%"}}}}),Tt=m($69cb30bb0017df05$export$be92b6f5f03c0fe9,{display:"flex",flexDirection:"column",width:"100%",height:"100%",flexGrow:"1",flexShrink:"0",position:"relative",zIndex:"1",maskImage:"linear-gradient(180deg, rgba(0, 0, 0, 1) calc(100% - 2rem), transparent 100%)","@sm":{marginTop:"0.5rem",boxShadow:"none"}}),Mt=m($69cb30bb0017df05$export$54c2e3dc7acea9f5,{display:"flex",flexGrow:"0",margin:"0 1.618rem",borderBottom:"4px solid #6663","@sm":{margin:"0 1rem"}}),se=m($69cb30bb0017df05$export$41fb9f06171c75f4,{display:"flex",position:"relative",padding:"0.5rem 1rem",background:"none",backgroundColor:"transparent",fontFamily:"inherit",border:"none",opacity:"0.7",fontSize:"1rem",marginRight:"1rem",lineHeight:"1rem",whiteSpace:"nowrap",cursor:"pointer",fontWeight:400,transition:"$all","&::after":{width:"0",height:"4px",content:"",position:"absolute",bottom:"-4px",left:"0",transition:"$all"},"&[data-state='active']":{opacity:"1",fontWeight:700,"&::after":{width:"100%",backgroundColor:"$accent"}}}),ce=m($69cb30bb0017df05$export$7c6e2c02157bb7d2,{display:"flex",flexGrow:"1",flexShrink:"0",position:"absolute",top:"0",left:"0","&[data-state='active']":{width:"100%",height:"calc(100% - 2rem)",padding:"1.618rem 0"}}),Rt=m("div",{position:"relative",height:"100%",width:"100%",overflowY:"scroll"}),zt=m("div",{padding:" 0 1.618rem 2rem",display:"flex",flexDirection:"column",overflow:"scroll",position:"absolute",fontWeight:"400",fontSize:"1rem",zIndex:"0",img:{maxWidth:"100px",maxHeight:"100px",objectFit:"contain",color:"transparent",margin:"0 0 1rem",borderRadius:"3px",backgroundColor:"$secondaryMuted"},video:{display:"none"},"a, a:visited":{color:"$accent"},p:{fontSize:"1rem",lineHeight:"1.45em",margin:"0"},dl:{margin:"0",dt:{fontWeight:"700",margin:"1rem 0 0.25rem"},dd:{margin:"0"}},".manifest-property-title":{fontWeight:"700",margin:"1rem 0 0.25rem"},"ul, ol":{padding:"0",margin:"0",li:{fontSize:"1rem",lineHeight:"1.45em",listStyle:"none",margin:"0.25rem 0 0.25rem"}}}),Lt=m("div",{position:"relative",width:"100%",height:"100%",zIndex:"0"}),ze=(tt,et="none")=>{if(!tt)return null;if(typeof tt=="string")return[tt];if(!tt[et]){const rt=Object.getOwnPropertyNames(tt);if(rt.length>0)return tt[rt[0]]}return!tt[et]||!Array.isArray(tt[et])?null:tt[et]},R=(tt,et="none",rt=", ")=>{const nt=ze(tt,et);return Array.isArray(nt)?nt.join(`${rt}`):nt};function Ft(tt){return{__html:Pt(tt)}}function T(tt,et){const rt=Object.keys(tt).filter(it=>et.includes(it)?null:it),nt=new Object;return rt.forEach(it=>{nt[it]=tt[it]}),nt}function Pt(tt){return at(tt,{allowedAttributes:{a:["href"],img:["alt","src","height","width"]},allowedSchemes:["http","https","mailto"],allowedTags:["a","b","br","i","img","p","small","span","sub","sup"]})}const Vt=m("span",{}),L=tt=>{const{as:et,label:rt}=tt,nt=T(tt,["as","label"]);return e$1.createElement(Vt,{as:et,...nt},R(rt,nt.lang))},Bt=(tt,et="200,",rt="full")=>{Array.isArray(tt)&&(tt=tt[0]);const{id:nt,service:it}=tt;let st;if(!it)return nt;if(Array.isArray(tt.service)&&tt.service.length>0&&(st=it[0]),st){if(st["@id"])return`${st["@id"]}/${rt}/${et}/0/default.jpg`;if(st.id)return`${st.id}/${rt}/${et}/0/default.jpg`}},de=m("img",{objectFit:"cover"}),Ht=tt=>{const et=reactExports.useRef(null),{contentResource:rt,altAsLabel:nt,region:it="full"}=tt;let st;nt&&(st=R(nt));const ot=T(tt,["contentResource","altAsLabel"]),{type:lt,id:ut,width:ct=200,height:dt=200,duration:pt}=rt;reactExports.useEffect(()=>{if(!ut&&!et.current||["Image"].includes(lt)||!ut.includes("m3u8"))return;const _r=new Hls;return et.current&&(_r.attachMedia(et.current),_r.on(Hls.Events.MEDIA_ATTACHED,function(){_r.loadSource(ut)})),_r.on(Hls.Events.ERROR,function(Yr,mt){if(mt.fatal)switch(mt.type){case Hls.ErrorTypes.NETWORK_ERROR:console.error(`fatal ${Yr} network error encountered, try to recover`),_r.startLoad();break;case Hls.ErrorTypes.MEDIA_ERROR:console.error(`fatal ${Yr} media error encountered, try to recover`),_r.recoverMediaError();break;default:_r.destroy();break}}),()=>{_r&&(_r.detachMedia(),_r.destroy())}},[ut,lt]);const ft=reactExports.useCallback(()=>{if(!et.current)return;let _r=0,Yr=30;if(pt&&(Yr=pt),!ut.split("#t=")&&pt&&(_r=pt*.1),ut.split("#t=").pop()){const Kr=ut.split("#t=").pop();Kr&&(_r=parseInt(Kr.split(",")[0]))}const mt=et.current;mt.autoplay=!0,mt.currentTime=_r,setTimeout(()=>ft(),Yr*1e3)},[pt,ut]);reactExports.useEffect(()=>ft(),[ft]);const gt=Bt(rt,`${ct},${dt}`,it);switch(lt){case"Image":return e$1.createElement(de,{as:"img",alt:st,css:{width:ct,height:dt},key:ut,src:gt,...ot});case"Video":return e$1.createElement(de,{as:"video",css:{width:ct,height:dt},disablePictureInPicture:!0,key:ut,loop:!0,muted:!0,onPause:ft,ref:et,src:ut});default:return console.warn(`Resource type: ${lt} is not valid or not yet supported in Primitives.`),e$1.createElement(e$1.Fragment,null)}},Ot=m("a",{}),Dt=tt=>{const{children:et,homepage:rt}=tt,nt=T(tt,["children","homepage"]);return e$1.createElement(e$1.Fragment,null,rt&&rt.map(it=>{const st=R(it.label,nt.lang);return e$1.createElement(Ot,{"aria-label":et?st:void 0,href:it.id,key:it.id,...nt},et||st)}))},Wt={delimiter:", "},re=reactExports.createContext(void 0),Le=()=>{const tt=reactExports.useContext(re);if(tt===void 0)throw new Error("usePrimitivesContext must be used with a PrimitivesProvider");return tt},oe=({children:tt,initialState:et=Wt})=>{const rt=jt(et,"delimiter");return e$1.createElement(re.Provider,{value:{delimiter:rt}},tt)},jt=(tt,et)=>Object.hasOwn(tt,et)?tt[et].toString():void 0,Nt=m("span",{}),me=tt=>{const{as:et,markup:rt}=tt,{delimiter:nt}=Le();if(!rt)return e$1.createElement(e$1.Fragment,null);const it=T(tt,["as","markup"]),st=Ft(R(rt,it.lang,nt));return e$1.createElement(Nt,{as:et,...it,dangerouslySetInnerHTML:st})},Fe=tt=>e$1.useContext(re)?e$1.createElement(me,{...tt}):e$1.createElement(oe,null,e$1.createElement(me,{...tt})),Gt=({as:tt="dd",lang:et,value:rt})=>e$1.createElement(Fe,{markup:rt,as:tt,lang:et}),qt=m("span",{}),Ut=({as:tt="dd",customValueContent:et,lang:rt,value:nt})=>{var it;const{delimiter:st}=Le(),ot=(it=ze(nt,rt))==null?void 0:it.map(lt=>reactExports.cloneElement(et,{value:lt}));return e$1.createElement(qt,{as:tt,lang:rt},ot==null?void 0:ot.map((lt,ut)=>[ut>0&&`${st}`,e$1.createElement(reactExports.Fragment,{key:ut},lt)]))},Pe=tt=>{var et;const{item:rt,lang:nt,customValueContent:it}=tt,{label:st,value:ot}=rt,lt=(et=R(st))==null?void 0:et.replace(" ","-").toLowerCase();return e$1.createElement("div",{role:"group","data-label":lt},e$1.createElement(L,{as:"dt",label:st,lang:nt}),it?e$1.createElement(Ut,{as:"dd",customValueContent:it,value:ot,lang:nt}):e$1.createElement(Gt,{as:"dd",value:ot,lang:nt}))};function _t(tt,et){const rt=et.filter(nt=>{const{matchingLabel:it}=nt,st=Object.keys(nt.matchingLabel)[0],ot=R(it,st);if(R(tt,st)===ot)return!0}).map(nt=>nt.Content);if(Array.isArray(rt))return rt[0]}const Zt=m("dl",{}),Xt=tt=>{const{as:et,customValueContent:rt,metadata:nt}=tt;if(!Array.isArray(nt))return e$1.createElement(e$1.Fragment,null);const it=Ce(tt,"customValueDelimiter"),st=T(tt,["as","customValueContent","customValueDelimiter","metadata"]);return e$1.createElement(oe,{...typeof it=="string"?{initialState:{delimiter:it}}:void 0},nt.length>0&&e$1.createElement(Zt,{as:et,...st},nt.map((ot,lt)=>{const ut=rt?_t(ot.label,rt):void 0;return e$1.createElement(Pe,{customValueContent:ut,item:ot,key:lt,lang:st==null?void 0:st.lang})})))};m("li",{});m("ul",{});const Yt=m("dl",{}),Kt=tt=>{const{as:et,requiredStatement:rt}=tt;if(!rt)return e$1.createElement(e$1.Fragment,null);const nt=Ce(tt,"customValueDelimiter"),it=T(tt,["as","customValueDelimiter","requiredStatement"]);return e$1.createElement(oe,{...typeof nt=="string"?{initialState:{delimiter:nt}}:void 0},e$1.createElement(Yt,{as:et,...it},e$1.createElement(Pe,{item:rt,lang:it.lang})))},Jt=m("li",{}),Qt=m("ul",{}),en=tt=>{const{as:et,seeAlso:rt}=tt,nt=T(tt,["as","seeAlso"]);return e$1.createElement(Qt,{as:et},rt&&rt.map(it=>{const st=R(it.label,nt.lang);return e$1.createElement(Jt,{key:it.id},e$1.createElement("a",{href:it.id,...nt},st||it.id))}))},tn=tt=>{const{as:et,summary:rt}=tt,nt=T(tt,["as","customValueDelimiter","summary"]);return e$1.createElement(Fe,{as:et,markup:rt,...nt})},Ve=tt=>{const{thumbnail:et,region:rt}=tt,nt=T(tt,["thumbnail"]);return e$1.createElement(e$1.Fragment,null,et&&et.map(it=>e$1.createElement(Ht,{contentResource:it,key:it.id,region:rt,...nt})))},nn=({homepage:tt})=>(tt==null?void 0:tt.length)===0?e$1.createElement(e$1.Fragment,null):e$1.createElement(e$1.Fragment,null,e$1.createElement("span",{className:"manifest-property-title"},"Homepage"),e$1.createElement(Dt,{homepage:tt})),rn=({id:tt,htmlLabel:et,parent:rt="manifest"})=>e$1.createElement(e$1.Fragment,null,e$1.createElement("span",{className:"manifest-property-title"},et),e$1.createElement("a",{href:tt,target:"_blank",id:`iiif-${rt}-id`},tt)),on=({metadata:tt,parent:et="manifest"})=>tt?e$1.createElement(e$1.Fragment,null,e$1.createElement(Xt,{metadata:tt,id:`iiif-${et}-metadata`})):e$1.createElement(e$1.Fragment,null),an=({requiredStatement:tt,parent:et="manifest"})=>tt?e$1.createElement(e$1.Fragment,null,e$1.createElement(Kt,{requiredStatement:tt,id:`iiif-${et}-required-statement`})):e$1.createElement(e$1.Fragment,null),ln=({rights:tt})=>tt?e$1.createElement(e$1.Fragment,null,e$1.createElement("span",{className:"manifest-property-title"},"Rights"),e$1.createElement("a",{href:tt,target:"_blank"},tt)):e$1.createElement(e$1.Fragment,null),sn=({seeAlso:tt})=>(tt==null?void 0:tt.length)===0?e$1.createElement(e$1.Fragment,null):e$1.createElement(e$1.Fragment,null,e$1.createElement("span",{className:"manifest-property-title"},"See Also"),e$1.createElement(en,{seeAlso:tt})),cn=({summary:tt,parent:et="manifest"})=>tt?e$1.createElement(e$1.Fragment,null,e$1.createElement(tn,{summary:tt,as:"p",id:`iiif-${et}-summary`})):e$1.createElement(e$1.Fragment,null),dn=({label:tt,thumbnail:et})=>(et==null?void 0:et.length)===0?e$1.createElement(e$1.Fragment,null):e$1.createElement(e$1.Fragment,null,e$1.createElement(Ve,{altAsLabel:tt||{none:["resource"]},thumbnail:et,style:{backgroundColor:"#6663",objectFit:"cover"}})),mn=()=>{const tt=k(),{activeManifest:et,vault:rt}=tt,[nt,it]=reactExports.useState(),[st,ot]=reactExports.useState([]),[lt,ut]=reactExports.useState([]),[ct,dt]=reactExports.useState([]);return reactExports.useEffect(()=>{var pt,ft,gt;const _r=rt.get(et);it(_r),((pt=_r.homepage)==null?void 0:pt.length)>0&&ot(rt.get(_r.homepage)),((ft=_r.seeAlso)==null?void 0:ft.length)>0&&ut(rt.get(_r.seeAlso)),((gt=_r.thumbnail)==null?void 0:gt.length)>0&&dt(rt.get(_r.thumbnail))},[et,rt]),nt?e$1.createElement(Lt,null,e$1.createElement(zt,null,e$1.createElement(dn,{thumbnail:ct,label:nt.label}),e$1.createElement(cn,{summary:nt.summary}),e$1.createElement(on,{metadata:nt.metadata}),e$1.createElement(an,{requiredStatement:nt.requiredStatement}),e$1.createElement(ln,{rights:nt.rights}),e$1.createElement(nn,{homepage:st}),e$1.createElement(sn,{seeAlso:lt}),e$1.createElement(rn,{id:nt.id,htmlLabel:"IIIF Manifest"}))):e$1.createElement(e$1.Fragment,null)},un=()=>{function tt(it){return it.map(st=>{const ot=st.identifier||v4();return{...st,identifier:ot}})}function et(it){var st;const ot=[],lt=[],ut=tt(it);for(const ct of ut){for(;lt.length>0&&lt[lt.length-1].end<=ct.start;)lt.pop();lt.length>0?(lt[lt.length-1].children||(lt[lt.length-1].children=[]),(st=lt[lt.length-1].children)==null||st.push(ct),lt.push(ct)):(ot.push(ct),lt.push(ct))}return ot}function rt(it,st=[]){return st.some(ot=>it.start>=ot.start&&it.end<=ot.end)}function nt(it=[]){return it.sort((st,ot)=>st.start-ot.start)}return{addIdentifiersToParsedCues:tt,createNestedCues:et,isChild:rt,orderCuesByTime:nt}},ue=ne({from:{transform:"rotate(360deg)"},to:{transform:"rotate(0deg)"}}),pn=m($f99a8c78507165f7$export$be92b6f5f03c0fe9,{display:"flex",flexDirection:"column",width:"100%"}),Be=m($f99a8c78507165f7$export$6d08773d2e66f8f2,{position:"relative",cursor:"pointer",display:"flex",width:"100%",justifyContent:"space-between",textAlign:"left",margin:"0",padding:"0.5rem 1.618rem",fontFamily:"inherit",lineHeight:"1.25em",fontSize:"1rem",color:"inherit",border:"none",background:"none","@sm":{padding:"0.5rem 1rem",fontSize:"0.8333rem"},"&::before":{content:"",width:"12px",height:"12px",borderRadius:"12px",position:"absolute",backgroundColor:"$primaryMuted",opacity:"0",left:"8px",marginTop:"3px",boxSizing:"content-box","@sm":{content:"unset"}},"&::after":{content:"",width:"4px",height:"6px",position:"absolute",backgroundColor:"$secondary",opacity:"0",clipPath:"polygon(100% 50%, 0 100%, 0 0)",left:"13px",marginTop:"6px",boxSizing:"content-box","@sm":{content:"unset"}},strong:{marginLeft:"1rem"},"&:hover":{color:"$accent","&::before":{backgroundColor:"$accent",opacity:"1"},"&::after":{content:"",width:"4px",height:"6px",position:"absolute",backgroundColor:"$secondary",clipPath:"polygon(100% 50%, 0 100%, 0 0)",opacity:"1"}},"&[aria-checked='true']":{backgroundColor:"#6663","&::before":{content:"",width:"6px",height:"6px",position:"absolute",backgroundColor:"transparent",border:"3px solid $accentMuted",borderRadius:"12px",left:"8px",marginTop:"4px",opacity:"1",animation:"1s linear infinite",animationName:ue,boxSizing:"content-box","@sm":{content:"unset"}},"&::after":{content:"",width:"6px",height:"6px",position:"absolute",backgroundColor:"transparent",border:"3px solid $accent",clipPath:"polygon(100% 0, 100% 100%, 0 0)",borderRadius:"12px",left:"8px",marginTop:"4px",opacity:"1",animation:"1.5s linear infinite",animationName:ue,boxSizing:"content-box","@sm":{content:"unset"}}}}),fn=({label:tt,start:et,end:rt})=>{const[nt,it]=reactExports.useState(!1),st=document.getElementById("clover-iiif-video");reactExports.useEffect(()=>(st==null||st.addEventListener("timeupdate",()=>{const{currentTime:lt}=st;it(et<=lt&&lt<rt)}),()=>document.removeEventListener("timeupdate",()=>{})),[rt,et,st]);const ot=()=>{st&&(st.pause(),st.currentTime=et,st.play())};return e$1.createElement(Be,{"aria-checked":nt,"data-testid":"information-panel-cue",onClick:ot,value:tt},tt,e$1.createElement("strong",null,Ee(et)))},gn=m("ul",{listStyle:"none",paddingLeft:"1rem",position:"relative","&&:first-child":{paddingLeft:"0"},"& li ul":{[`& ${Be}`]:{backgroundColor:"unset","&::before":{content:"none"},"&::after":{content:"none"}}},"&:first-child":{margin:"0 0 1.618rem"}}),He=({items:tt})=>e$1.createElement(gn,null,tt.map(et=>{const{text:rt,start:nt,end:it,children:st,identifier:ot}=et;return e$1.createElement("li",{key:ot},e$1.createElement(fn,{label:rt,start:nt,end:it}),st&&e$1.createElement(He,{items:st}))})),hn=({resource:tt})=>{const[et,rt]=e$1.useState([]),{id:nt,label:it}=tt,{createNestedCues:st,orderCuesByTime:ot}=un();return reactExports.useEffect(()=>{nt&&fetch(nt,{headers:{"Content-Type":"text/plain",Accept:"application/json"}}).then(lt=>lt.text()).then(lt=>{const ut=nodeWebvtt.parse(lt).cues,ct=ot(ut),dt=st(ct);rt(dt)}).catch(lt=>console.error(nt,lt.toString()))},[nt]),e$1.createElement(pn,{"aria-label":`navigate ${D(it,"en")}`},e$1.createElement(He,{items:et}))},xn=({activeCanvas:tt,resources:et})=>{var rt;const nt=k(),{configOptions:it}=nt,{informationPanel:st}=it,[ot,lt]=reactExports.useState(),ut=(st==null?void 0:st.renderAbout)||((rt=it==null?void 0:it.informationPanel)==null?void 0:rt.renderAbout),ct=st==null?void 0:st.renderSupplementing;reactExports.useEffect(()=>{ut?lt("manifest-about"):et&&(et==null?void 0:et.length)>0&&!ut&&lt(et[0].id)},[tt,ut,et]);const dt=pt=>{lt(pt)};return et?e$1.createElement(Tt,{"data-testid":"information-panel",defaultValue:ot,onValueChange:dt,orientation:"horizontal",value:ot,className:"clover-viewer-information-panel"},e$1.createElement(Mt,{"aria-label":"select chapter","data-testid":"information-panel-list"},ut&&e$1.createElement(se,{value:"manifest-about"},"About"),ct&&et&&et.map(({id:pt,label:ft})=>e$1.createElement(se,{key:pt,value:pt},e$1.createElement(L,{label:ft})))),e$1.createElement(Rt,null,ut&&e$1.createElement(ce,{value:"manifest-about"},e$1.createElement(mn,null)),ct&&et&&et.map(pt=>e$1.createElement(ce,{key:pt.id,value:pt.id},e$1.createElement(hn,{resource:pt}))))):e$1.createElement(e$1.Fragment,null)},Oe=m("div",{position:"absolute",right:"1rem",top:"1rem",display:"flex",justifyContent:"flex-end",zIndex:"1"}),vn=m("input",{flexGrow:"1",border:"none",backgroundColor:"$secondaryMuted",color:"$primary",marginRight:"1rem",height:"2rem",padding:"0 1rem",borderRadius:"2rem",fontFamily:"inherit",fontSize:"1rem",lineHeight:"1rem",boxShadow:"inset 1px 1px 2px #0003","&::placeholder":{color:"$primaryMuted"}}),Y=m("button",{display:"flex",background:"none",border:"none",width:"2rem !important",height:"2rem !important",padding:"0",margin:"0",fontWeight:"700",borderRadius:"2rem",backgroundColor:"$accent",color:"$secondary",cursor:"pointer",boxSizing:"content-box !important",transition:"$all",svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",opacity:"1",filter:"drop-shadow(5px 5px 5px #000D)",boxSizing:"inherit",transition:"$all"},"&:disabled":{backgroundColor:"transparent",boxShadow:"none",svg:{opacity:"0.25"}}}),bn=m("div",{display:"flex",marginRight:"0.618rem",backgroundColor:"$accentAlt",borderRadius:"2rem",boxShadow:"5px 5px 5px #0003",color:"$secondary",alignItems:"center","> span":{display:"flex",margin:"0 0.5rem",fontSize:"0.7222rem"}}),yn=m("div",{display:"flex",position:"relative",zIndex:"1",width:"100%",padding:"0",transition:"$all",variants:{isToggle:{true:{paddingTop:"2.618rem",[`& ${Oe}`]:{width:"calc(100% - 2rem)","@sm":{width:"calc(100% - 2rem)"}}}}}}),En=(tt,et)=>{reactExports.useEffect(()=>{function rt(nt){nt.key===tt&&et()}return window.addEventListener("keyup",rt),()=>window.removeEventListener("keyup",rt)},[])},wn=()=>e$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},e$1.createElement("title",null,"Arrow Back"),e$1.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M244 400L100 256l144-144M120 256h292"})),Cn=()=>e$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},e$1.createElement("title",null,"Arrow Forward"),e$1.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M268 112l144 144-144 144M392 256H100"})),Sn=()=>e$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},e$1.createElement("title",null,"Close"),e$1.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})),kn=()=>e$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},e$1.createElement("title",null,"Search"),e$1.createElement("path",{d:"M456.69 421.39L362.6 327.3a173.81 173.81 0 0034.84-104.58C397.44 126.38 319.06 48 222.72 48S48 126.38 48 222.72s78.38 174.72 174.72 174.72A173.81 173.81 0 00327.3 362.6l94.09 94.09a25 25 0 0035.3-35.3zM97.92 222.72a124.8 124.8 0 11124.8 124.8 124.95 124.95 0 01-124.8-124.8z"})),In=({handleCanvasToggle:tt,handleFilter:et,activeIndex:rt,canvasLength:nt})=>{const[it,st]=reactExports.useState(!1),[ot,lt]=reactExports.useState(!1),[ut,ct]=reactExports.useState(!1);reactExports.useEffect(()=>{ct(rt===0),rt===nt-1?lt(!0):lt(!1)},[rt,nt]),En("Escape",()=>{st(!1),et("")});const dt=()=>{st(ft=>!ft),et("")},pt=ft=>et(ft.target.value);return e$1.createElement(yn,{isToggle:it},e$1.createElement(Oe,null,it&&e$1.createElement(vn,{autoFocus:!0,onChange:pt,placeholder:"Search"}),!it&&e$1.createElement(bn,null,e$1.createElement(Y,{onClick:()=>tt(-1),disabled:ut,type:"button"},e$1.createElement(wn,null)),e$1.createElement("span",null,rt+1," of ",nt),e$1.createElement(Y,{onClick:()=>tt(1),disabled:ot,type:"button"},e$1.createElement(Cn,null))),e$1.createElement(Y,{onClick:dt,type:"button"},it?e$1.createElement(Sn,null):e$1.createElement(kn,null))))},$n=m($f99a8c78507165f7$export$be92b6f5f03c0fe9,{display:"flex",flexDirection:"row",flexGrow:"1",padding:"1.618rem",overflowX:"scroll",position:"relative",zIndex:"0"}),An=()=>e$1.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M256 112v288M400 256H112"}),Tn=()=>e$1.createElement(e$1.Fragment,null,e$1.createElement("path",{d:"M232 416a23.88 23.88 0 01-14.2-4.68 8.27 8.27 0 01-.66-.51L125.76 336H56a24 24 0 01-24-24V200a24 24 0 0124-24h69.75l91.37-74.81a8.27 8.27 0 01.66-.51A24 24 0 01256 120v272a24 24 0 01-24 24zm-106.18-80zm-.27-159.86zM320 336a16 16 0 01-14.29-23.19c9.49-18.87 14.3-38 14.3-56.81 0-19.38-4.66-37.94-14.25-56.73a16 16 0 0128.5-14.54C346.19 208.12 352 231.44 352 256c0 23.86-6 47.81-17.7 71.19A16 16 0 01320 336z"}),e$1.createElement("path",{d:"M368 384a16 16 0 01-13.86-24C373.05 327.09 384 299.51 384 256c0-44.17-10.93-71.56-29.82-103.94a16 16 0 0127.64-16.12C402.92 172.11 416 204.81 416 256c0 50.43-13.06 83.29-34.13 120a16 16 0 01-13.87 8z"}),e$1.createElement("path",{d:"M416 432a16 16 0 01-13.39-24.74C429.85 365.47 448 323.76 448 256c0-66.5-18.18-108.62-45.49-151.39a16 16 0 1127-17.22C459.81 134.89 480 181.74 480 256c0 64.75-14.66 113.63-50.6 168.74A16 16 0 01416 432z"})),Mn=()=>e$1.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"}),Rn=()=>e$1.createElement("path",{d:"M416 64H96a64.07 64.07 0 00-64 64v256a64.07 64.07 0 0064 64h320a64.07 64.07 0 0064-64V128a64.07 64.07 0 00-64-64zm-80 64a48 48 0 11-48 48 48.05 48.05 0 0148-48zM96 416a32 32 0 01-32-32v-67.63l94.84-84.3a48.06 48.06 0 0165.8 1.9l64.95 64.81L172.37 416zm352-32a32 32 0 01-32 32H217.63l121.42-121.42a47.72 47.72 0 0161.64-.16L448 333.84z"}),zn=()=>e$1.createElement("path",{d:"M464 384.39a32 32 0 01-13-2.77 15.77 15.77 0 01-2.71-1.54l-82.71-58.22A32 32 0 01352 295.7v-79.4a32 32 0 0113.58-26.16l82.71-58.22a15.77 15.77 0 012.71-1.54 32 32 0 0145 29.24v192.76a32 32 0 01-32 32zM268 400H84a68.07 68.07 0 01-68-68V180a68.07 68.07 0 0168-68h184.48A67.6 67.6 0 01336 179.52V332a68.07 68.07 0 01-68 68z"}),De=m("svg",{display:"inline-flex",variants:{isLarge:{true:{height:"4rem",width:"4rem"}},isMedium:{true:{height:"2rem",width:"2rem"}},isSmall:{true:{height:"1rem",width:"1rem"}}}}),Ln=({children:tt})=>e$1.createElement("title",null,tt),S=tt=>e$1.createElement(De,{...tt,"data-testid":"icon-svg",role:"img",viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg"},tt.children);S.Title=Ln;S.Add=An;S.Audio=Tn;S.Close=Mn;S.Image=Rn;S.Video=zn;const Fn=ne({"0%":{opacity:0,transform:"translateY(1rem)"},"100%":{opacity:1,transform:"translateY(0)"}}),Pn=ne({"0%":{opacity:0,transform:"translateY(1rem)"},"100%":{opacity:1,transform:"translateY(0)"}}),We=m($cb5cc270b50c6fcd$export$21b07c8f274aebd5,{fill:"$secondaryAlt"}),Vn=m($cb5cc270b50c6fcd$export$f39c2d165cd861fe,{position:"absolute",right:"0",top:"0",padding:"0.5rem",margin:"0",cursor:"pointer",border:"none",background:"none",fill:"inherit","&:hover":{opacity:"0.75"}}),Bn=m($cb5cc270b50c6fcd$export$7c6e2c02157bb7d2,{border:"none",backgroundColor:"white",fill:"inhrerit",padding:"1rem 2rem 1rem 1rem",width:"auto",minWidth:"200px",maxWidth:"350px",borderRadius:"3px",boxShadow:"5px 5px 13px #0002",animationDuration:"0.3s",animationTimingFunction:"cubic-bezier(0.16, 1, 0.3, 1)",'&[data-side="top"]':{animationName:Pn},'&[data-side="bottom"]':{animationName:Fn},'&[data-align="end"]':{[`& ${We}`]:{margin:"0 0.7rem"}}}),Hn=m($cb5cc270b50c6fcd$export$41fb9f06171c75f4,{display:"inline-flex",padding:"0.5rem 0",margin:"0 0.5rem 0 0",cursor:"pointer",border:"none",background:"none","> button, > span":{margin:"0"}}),On=m($cb5cc270b50c6fcd$export$be92b6f5f03c0fe9,{boxSizing:"content-box"}),Dn=tt=>e$1.createElement(Hn,{...tt},tt.children),Wn=tt=>e$1.createElement(Bn,{...tt},e$1.createElement(We,null),e$1.createElement(Vn,null,e$1.createElement(S,{isSmall:!0},e$1.createElement(S.Close,null))),tt.children),W=({children:tt})=>e$1.createElement(On,null,tt);W.Trigger=Dn;W.Content=Wn;const J=m("div",{boxSizing:"border-box",display:"inline-flex",alignItems:"center",borderRadius:"5px",padding:"$1",marginBottom:"$2",marginRight:"$2",backgroundColor:"$lightGrey",color:"$richBlack50",textTransform:"uppercase",fontSize:"$2",objectFit:"contain",lineHeight:"1em !important","&:last-child":{marginRight:"0"},[`${De}`]:{position:"absolute",left:"$1",height:"$3",width:"$3"},variants:{isIcon:{true:{position:"relative",paddingLeft:"$5"}}}}),Q=m("span",{display:"flex"}),jn=m("span",{display:"flex",width:"1.2111rem",height:"0.7222rem"}),Nn=m("span",{display:"inline-flex",marginLeft:"5px",marginBottom:"-1px"}),Gn=m($f99a8c78507165f7$export$6d08773d2e66f8f2,{display:"flex",flexShrink:"0",margin:"0 1.618rem 0 0",padding:"0",cursor:"pointer",background:"none",border:"none",fontFamily:"inherit",lineHeight:"1.25em",fontSize:"1rem",textAlign:"left","&:last-child":{marginRight:"1rem"},figure:{margin:"0",width:"161.8px","> div":{position:"relative",display:"flex",backgroundColor:"$secondaryAlt",width:"inherit",height:"100px",overflow:"hidden",borderRadius:"3px",transition:"$all",img:{width:"100%",height:"100%",objectFit:"cover",filter:"blur(0)",transform:"scale3d(1, 1, 1)",transition:"$all",color:"transparent"},[`& ${Q}`]:{position:"absolute",right:"0",bottom:"0",[`& ${J}`]:{margin:"0",paddingLeft:"0",fontSize:"0.7222rem",backgroundColor:"#000d",color:"$secondary",fill:"$secondary",borderBottomLeftRadius:"0",borderTopRightRadius:"0"}}},figcaption:{marginTop:"0.5rem",fontWeight:"400",fontSize:"0.8333rem",display:"-webkit-box",overflow:"hidden",MozBoxOrient:"vertical",WebkitBoxOrient:"vertical",WebkitLineClamp:"5","@sm":{fontSize:"0.8333rem"}}},"&[aria-checked='true']":{figure:{"> div":{backgroundColor:"$primaryAlt","&::before":{position:"absolute",zIndex:"1",color:"$secondaryMuted",content:"Active Item",textTransform:"uppercase",fontWeight:"700",fontSize:"0.6111rem",letterSpacing:"0.03rem",display:"flex",width:"100%",height:"100%",flexDirection:"column",justifyContent:"center",textAlign:"center",textShadow:"5px 5px 5px #0003"},img:{opacity:"0.3",transform:"scale3d(1.1, 1.1, 1.1)",filter:"blur(2px)"},[`& ${Q}`]:{[`& ${J}`]:{backgroundColor:"$accent"}}}},figcaption:{fontWeight:"700"}}}),qn=({type:tt})=>{switch(tt){case"Sound":return e$1.createElement(S.Audio,null);case"Image":return e$1.createElement(S.Image,null);case"Video":return e$1.createElement(S.Video,null);default:return e$1.createElement(S.Image,null)}},Un=({canvas:tt,canvasIndex:et,isActive:rt,thumbnail:nt,type:it,handleChange:st})=>e$1.createElement(Gn,{"aria-checked":rt,"data-testid":"media-thumbnail","data-canvas":et,onClick:()=>st(tt.id),value:tt.id},e$1.createElement("figure",null,e$1.createElement("div",null,(nt==null?void 0:nt.id)&&e$1.createElement("img",{src:nt.id,alt:tt!=null&&tt.label?D(tt.label):""}),e$1.createElement(Q,null,e$1.createElement(J,{isIcon:!0,"data-testid":"thumbnail-tag"},e$1.createElement(jn,null),e$1.createElement(S,{"aria-label":it},e$1.createElement(qn,{type:it})),["Video","Sound"].includes(it)&&e$1.createElement(Nn,null,Ee(tt.duration))))),(tt==null?void 0:tt.label)&&e$1.createElement("figcaption",{"data-testid":"fig-caption"},e$1.createElement(L,{label:tt.label})))),_n=tt=>tt.body?tt.body.type:"Image",Zn=({items:tt})=>{const et=O(),rt=k(),{activeCanvas:nt,vault:it}=rt,[st,ot]=reactExports.useState(""),[lt,ut]=reactExports.useState([]),[ct,dt]=reactExports.useState(0),pt=e$1.useRef(null),ft="painting",gt=mt=>{nt!==mt&&et({type:"updateActiveCanvas",canvasId:mt})};reactExports.useEffect(()=>{if(!lt.length){const mt=["Image","Sound","Video"],Kr=tt.map(Xr=>Ie(it,Xr,ft,mt)).filter(Xr=>Xr.annotations.length>0);ut(Kr)}},[tt,lt.length,it]),reactExports.useEffect(()=>{lt.forEach((mt,Kr)=>{mt!=null&&mt.canvas&&mt.canvas.id===nt&&dt(Kr)})},[nt,lt]),reactExports.useEffect(()=>{const mt=document.querySelector(`[data-canvas="${ct}"]`);if(mt instanceof HTMLElement&&pt.current){const Kr=mt.offsetLeft-pt.current.offsetWidth/2+mt.offsetWidth/2;pt.current.scrollTo({left:Kr,behavior:"smooth"})}},[ct]);const _r=mt=>ot(mt),Yr=mt=>{const Kr=lt[ct+mt];Kr!=null&&Kr.canvas&&gt(Kr.canvas.id)};return e$1.createElement(e$1.Fragment,null,e$1.createElement(In,{handleFilter:_r,handleCanvasToggle:Yr,activeIndex:ct,canvasLength:lt.length}),e$1.createElement($n,{"aria-label":"select item","data-testid":"media",ref:pt},lt.filter(mt=>{var Kr;if((Kr=mt.canvas)!=null&&Kr.label){const Xr=D(mt.canvas.label);if(Array.isArray(Xr))return Xr[0].toLowerCase().includes(st.toLowerCase())}}).map((mt,Kr)=>{var Xr,Zr;return e$1.createElement(Un,{canvas:mt.canvas,canvasIndex:Kr,handleChange:gt,isActive:nt===((Xr=mt==null?void 0:mt.canvas)==null?void 0:Xr.id),key:(Zr=mt==null?void 0:mt.canvas)==null?void 0:Zr.id,thumbnail:Et(it,mt,200,200),type:_n(mt.annotations[0])})})))},je=m("button",{background:"none",border:"none",cursor:"zoom-in",width:"100%",height:"100%",margin:"0",padding:"0",transition:"$all","& img":{width:"100%",height:"100%",objectFit:"contain",color:"transparent",transition:"$all"},variants:{isMedia:{true:{cursor:"pointer"}}}}),Ne=m("button",{display:"flex",height:"2rem",width:"2rem",borderRadius:"2rem",padding:"0",margin:"0",fontFamily:"inherit",background:"none",border:"none",color:"white",cursor:"pointer",marginLeft:"0.618rem",backgroundColor:"$primary",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"content-box !important","&:first-child":{marginLeft:"0"},"@xs":{marginBottom:"0.618rem",marginLeft:"0","&:last-child":{marginBottom:"0"}},svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"inherit"},"&:hover, &:focus":{backgroundColor:"$accent"},"&#rotateRight":{"&:hover, &:focus":{svg:{rotate:"45deg"}}},"&#rotateLeft":{transform:"scaleX(-1)","&:hover, &:focus":{svg:{rotate:"45deg"}}},"&#reset":{"&:hover, &:focus":{svg:{rotate:"-15deg"}}}}),Ge=m(Ne,{position:"absolute",width:"2rem",top:"1rem",right:"1rem",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",transition:"$all",borderRadius:"50%",backgroundColor:"$accent",cursor:"pointer","&:hover, &:focus":{backgroundColor:"$accent !important"},variants:{isInteractive:{true:{"&:hover":{opacity:"1"}},false:{}},isMedia:{true:{cursor:"pointer !important"}}},compoundVariants:[{isInteractive:!1,isMedia:!0,css:{top:"50%",right:"50%",width:"4rem",height:"4rem",transform:"translate(50%,-50%)"}}]}),Xn=m("div",{position:"relative",zIndex:"0",display:"flex",flexDirection:"column",gap:"1rem","&:hover":{[`${Ge}`]:{backgroundColor:"$accent"},[`${je}`]:{backgroundColor:"#6662",img:{filter:"brightness(0.85)"}}}}),Yn=m("div",{}),Kn=m("svg",{height:"19px",color:"$accent",fill:"$accent",stroke:"$accent",display:"flex",margin:"0.25rem 0.85rem"}),Jn=m($cc7e05a45900e73f$export$41fb9f06171c75f4,{fontSize:"1.25rem",fontWeight:"400",fontFamily:"inherit",alignSelf:"flex-start",flexGrow:"1",cursor:"pointer",transition:"$all",border:"1px solid #6663",boxShadow:"2px 2px 5px #0001",borderRadius:"3px",display:"flex",alignItems:"center",paddingLeft:"0.5rem",width:"100%","@sm":{fontSize:"1rem"}}),Qn=m($cc7e05a45900e73f$export$7c6e2c02157bb7d2,{borderRadius:"3px",boxShadow:"3px 3px 8px #0003",backgroundColor:"$secondary",marginTop:"2.25rem",marginLeft:"6px",paddingBottom:"0.25rem",maxHeight:"calc(61.8vh - 2.5rem) !important",borderTopLeftRadius:"0",border:"1px solid $secondaryMuted",maxWidth:"90vw"}),er=m($cc7e05a45900e73f$export$6d08773d2e66f8f2,{display:"flex",alignItems:"center",fontFamily:"inherit",padding:"0.25rem 0.5rem",color:"$primary",fontWeight:"400",fontSize:"0.8333rem",cursor:"pointer",backgroundColor:"$secondary",width:"calc(100% - 1rem)","> span":{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},'&[data-state="checked"]':{fontWeight:"700",color:"$primary !important"},"&:hover":{color:"$accent"},img:{width:"31px",height:"31px",marginRight:"0.5rem",borderRadius:"3px"}}),tr=m($cc7e05a45900e73f$export$b04be29aa201d4f5,{color:"$primaryMuted",fontFamily:"inherit",fontSize:"0.85rem",padding:"0.5rem 1rem 0.5rem 0.5rem",display:"flex",alignItems:"center",marginBottom:"0.25rem",borderRadius:"3px",borderTopLeftRadius:"0",borderBottomLeftRadius:"0",borderBottomRightRadius:"0",backgroundColor:"$secondaryMuted"}),qe=m($cc7e05a45900e73f$export$be92b6f5f03c0fe9,{position:"relative",zIndex:"5",width:"100%"}),K=({direction:tt,title:et})=>{const rt=()=>e$1.createElement("path",{d:"M414 321.94L274.22 158.82a24 24 0 00-36.44 0L98 321.94c-13.34 15.57-2.28 39.62 18.22 39.62h279.6c20.5 0 31.56-24.05 18.18-39.62z"}),nt=()=>e$1.createElement("path",{d:"M98 190.06l139.78 163.12a24 24 0 0036.44 0L414 190.06c13.34-15.57 2.28-39.62-18.22-39.62h-279.6c-20.5 0-31.56 24.05-18.18 39.62z"});return e$1.createElement(Kn,{xmlns:"http://www.w3.org/2000/svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},e$1.createElement("title",null,et),tt==="up"&&e$1.createElement(rt,null),tt==="down"&&e$1.createElement(nt,null))},Ue=({children:tt,label:et,maxHeight:rt,onValueChange:nt,value:it})=>e$1.createElement(qe,{onValueChange:nt,value:it},e$1.createElement(Jn,{"data-testid":"select-button"},e$1.createElement($cc7e05a45900e73f$export$e288731fd71264f0,{"data-testid":"select-button-value"}),e$1.createElement($cc7e05a45900e73f$export$99b400cabb58c515,null,e$1.createElement(K,{direction:"down",title:"select"}))),e$1.createElement($cc7e05a45900e73f$export$b2af6c9944296213,null,e$1.createElement(Qn,{css:{maxHeight:`${rt} !important`},"data-testid":"select-content"},e$1.createElement($cc7e05a45900e73f$export$d8117927658af6d7,null,e$1.createElement(K,{direction:"up",title:"scroll up for more"})),e$1.createElement($cc7e05a45900e73f$export$9ed6e7b40248d36d,null,e$1.createElement($cc7e05a45900e73f$export$ee25a334c55de1f4,null,et&&e$1.createElement(tr,null,e$1.createElement(L,{"data-testid":"select-label",label:et})),tt)),e$1.createElement($cc7e05a45900e73f$export$ff951e476c12189,null,e$1.createElement(K,{direction:"down",title:"scroll down for more"}))))),_e=tt=>e$1.createElement(er,{...tt},tt.thumbnail&&e$1.createElement(Ve,{thumbnail:tt.thumbnail}),e$1.createElement($cc7e05a45900e73f$export$3572fb0fb821ff49,null,e$1.createElement(L,{label:tt.label})),e$1.createElement($cc7e05a45900e73f$export$6b9198de19accfe6,null)),nr=m("div",{position:"absolute !important",zIndex:"1",top:"1rem",left:"1rem",width:"161.8px",height:"100px",backgroundColor:"#000D",boxShadow:"5px 5px 5px #0002",borderRadius:"3px",".displayregion":{border:" 3px solid $accent !important",boxShadow:"0 0 3px #0006"},"@sm":{width:"123px",height:"76px"},"@xs":{width:"100px",height:"61.8px"}}),rr=m("div",{position:"relative",width:"100%",height:"100%",zIndex:"0"}),or=m("div",{width:"100%",height:"61.8vh",maxHeight:"100vh",background:"black",backgroundSize:"contain",color:"white",position:"relative",zIndex:"1",overflow:"hidden"}),z=({id:tt,label:et,children:rt})=>e$1.createElement(Ne,{id:tt,"data-testid":"openseadragon-button"},e$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":`${tt}-svg-title`,"data-testid":"openseadragon-button-svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},e$1.createElement("title",{id:`${tt}-svg-title`},et),rt)),ar=m("div",{position:"absolute",zIndex:"1",top:"1rem",display:"flex","@xs":{flexDirection:"column",zIndex:"2"},variants:{hasPlaceholder:{true:{right:"3.618rem","@xs":{top:"3.618rem",right:"1rem"}},false:{right:"1rem","@xs":{top:"1rem",right:"1rem"}}}}}),ir=()=>e$1.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M256 112v288M400 256H112"}),lr=()=>e$1.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 256H112"}),sr=()=>e$1.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M432 320v112H320M421.8 421.77L304 304M80 192V80h112M90.2 90.23L208 208M320 80h112v112M421.77 90.2L304 208M192 432H80V320M90.23 421.8L208 304"}),cr=()=>e$1.createElement("path",{d:"M448 440a16 16 0 01-12.61-6.15c-22.86-29.27-44.07-51.86-73.32-67C335 352.88 301 345.59 256 344.23V424a16 16 0 01-27 11.57l-176-168a16 16 0 010-23.14l176-168A16 16 0 01256 88v80.36c74.14 3.41 129.38 30.91 164.35 81.87C449.32 292.44 464 350.9 464 424a16 16 0 01-16 16z"}),pe=()=>e$1.createElement(e$1.Fragment,null,e$1.createElement("path",{fill:"none",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 148l-21.12-24.57A191.43 191.43 0 00240 64C134 64 48 150 48 256s86 192 192 192a192.09 192.09 0 00181.07-128"}),e$1.createElement("path",{d:"M464 97.42V208a16 16 0 01-16 16H337.42c-14.26 0-21.4-17.23-11.32-27.31L436.69 86.1C446.77 76 464 83.16 464 97.42z"})),dr=({hasPlaceholder:tt,options:et})=>e$1.createElement(ar,{"data-testid":"openseadragon-controls",hasPlaceholder:tt,id:"openseadragon-controls"},et.showZoomControl&&e$1.createElement(e$1.Fragment,null,e$1.createElement(z,{id:"zoomIn",label:"zoom in"},e$1.createElement(ir,null)),e$1.createElement(z,{id:"zoomOut",label:"zoom out"},e$1.createElement(lr,null))),et.showFullPageControl&&e$1.createElement(z,{id:"fullPage",label:"full page"},e$1.createElement(sr,null)),et.showRotationControl&&e$1.createElement(e$1.Fragment,null,e$1.createElement(z,{id:"rotateRight",label:"rotate right"},e$1.createElement(pe,null)),e$1.createElement(z,{id:"rotateLeft",label:"rotate left"},e$1.createElement(pe,null))),et.showHomeControl&&e$1.createElement(z,{id:"reset",label:"reset"},e$1.createElement(cr,null))),mr=tt=>fetch(`${tt.replace(/\/$/,"")}/info.json`).then(et=>et.json()).then(et=>et).catch(et=>{console.error(`The IIIF tilesource ${tt.replace(/\/$/,"")}/info.json failed to load: ${et}`)}),ur=tt=>{let et,rt;if(Array.isArray(tt)&&(et=tt[0],et)){let nt;"@id"in et?nt=et["@id"]:nt=et.id,rt=nt}return rt},pr=({uri:tt,hasPlaceholder:et,imageType:rt})=>{const[nt,it]=reactExports.useState(),[st,ot]=reactExports.useState(),lt=k(),{configOptions:ut}=lt,ct={id:`openseadragon-viewport-${st}`,loadTilesWithAjax:!0,fullPageButton:"fullPage",homeButton:"reset",rotateLeftButton:"rotateLeft",rotateRightButton:"rotateRight",zoomInButton:"zoomIn",zoomOutButton:"zoomOut",showNavigator:!0,showFullPageControl:!0,showHomeControl:!0,showRotationControl:!0,showZoomControl:!0,navigatorBorderColor:"transparent",navigatorId:`openseadragon-navigator-${st}`,gestureSettingsMouse:{clickToZoom:!0,dblClickToZoom:!0,pinchToZoom:!0,scrollToZoom:!0},...ut.openSeadragon,ajaxWithCredentials:ut.withCredentials};return reactExports.useEffect(()=>{tt!==nt&&(it(tt),ot(v4()))},[nt,tt]),reactExports.useEffect(()=>{if(nt)switch(rt){case"simpleImage":le(ct).addSimpleImage({url:nt});break;case"tiledImage":mr(nt).then(dt=>le(ct).addTiledImage({tileSource:dt}));break;default:console.warn(`Unable to render ${nt} in OpenSeadragon as type: "${rt}"`);break}},[nt]),st?e$1.createElement(or,{css:{backgroundColor:ut.canvasBackgroundColor,height:ut.canvasHeight},className:"clover-viewer-osd-wrapper","data-testid":"clover-viewer-osd-wrapper"},e$1.createElement(dr,{hasPlaceholder:et,options:ct}),e$1.createElement(nr,{id:`openseadragon-navigator-${st}`}),e$1.createElement(rr,{id:`openseadragon-viewport-${st}`})):null},fr=({painting:tt,hasPlaceholder:et})=>{const[rt,nt]=reactExports.useState(),[it,st]=reactExports.useState();return reactExports.useEffect(()=>{Array.isArray(tt==null?void 0:tt.service)&&(tt==null?void 0:tt.service.length)>0?(nt("tiledImage"),st(ur(tt==null?void 0:tt.service))):(nt("simpleImage"),st(tt==null?void 0:tt.id))},[tt]),e$1.createElement(pr,{uri:it,key:it,hasPlaceholder:et,imageType:rt})},gr=({isMedia:tt,label:et,placeholderCanvas:rt,setIsInteractive:nt})=>{const{vault:it}=k(),st=N(it,rt),ot=st?st[0]:void 0,lt=et?D(et):["placeholder image"];return e$1.createElement(je,{onClick:()=>nt(!0),isMedia:tt,className:"clover-viewer-placeholder"},e$1.createElement("img",{src:(ot==null?void 0:ot.id)||"",alt:lt.join(),height:ot==null?void 0:ot.height,width:ot==null?void 0:ot.width}))},hr=m("canvas",{position:"absolute",width:"100%",height:"100%",zIndex:"0"}),xr=e$1.forwardRef((tt,et)=>{const rt=e$1.useRef(null),nt=reactExports.useCallback(()=>{var st,ot;if((st=et.current)!=null&&st.currentTime&&((ot=et.current)==null?void 0:ot.currentTime)>0)return;const lt=et.current;if(!lt)return;const ut=new AudioContext,ct=ut.createMediaElementSource(lt),dt=ut.createAnalyser(),pt=rt.current;if(!pt)return;pt.width=lt.offsetWidth,pt.height=lt.offsetHeight;const ft=pt.getContext("2d");ct.connect(dt),dt.connect(ut.destination),dt.fftSize=256;const gt=dt.frequencyBinCount,_r=new Uint8Array(gt);setInterval(function(){it(dt,ft,gt,_r,pt.width,pt.height)},20)},[et]);e$1.useEffect(()=>{!et||!et.current||(et.current.onplay=nt)},[nt,et]);function it(st,ot,lt,ut,ct,dt){const pt=ct/lt*2.6;let ft,gt=0;st.getByteFrequencyData(ut),ot.fillStyle="#000000",ot.fillRect(0,0,ct,dt);for(let _r=0;_r<lt;_r++)ft=ut[_r]*2,ot.fillStyle="rgba(78, 42, 132, 1)",ot.fillRect(gt,dt-ft,pt,ft),gt+=pt+6}return e$1.createElement(hr,{ref:rt,role:"presentation"})}),vr=m("div",{position:"relative",backgroundColor:"$primaryAlt",display:"flex",flexGrow:"0",flexShrink:"1",maxHeight:"500px",zIndex:"1",video:{backgroundColor:"transparent",objectFit:"contain",width:"100%",height:"100%",position:"relative",zIndex:"1"}}),br=({resource:tt,ignoreCaptionLabels:et})=>{const rt=D(tt.label,"en");return Array.isArray(rt)&&rt.some(nt=>et.includes(nt))?null:e$1.createElement("track",{key:tt.id,src:tt.id,label:Array.isArray(rt)?rt[0]:rt,srcLang:"en","data-testid":"player-track"})},yr=({allSources:tt,resources:et,painting:rt})=>{const[nt,it]=e$1.useState(0),[st,ot]=e$1.useState(),lt=e$1.useRef(null),ut=(rt==null?void 0:rt.type)==="Sound",ct=k(),{activeCanvas:dt,configOptions:pt,vault:ft}=ct;return reactExports.useEffect(()=>{if(!rt.id||!lt.current)return;if(lt!=null&&lt.current){const Yr=lt.current;Yr.src=rt.id,Yr.load()}if(rt.id.split(".").pop()!=="m3u8")return;const gt={xhrSetup:function(Yr,mt){Yr.withCredentials=!!pt.withCredentials}},_r=new Hls(gt);return _r.attachMedia(lt.current),_r.on(Hls.Events.MEDIA_ATTACHED,function(){_r.loadSource(rt.id)}),_r.on(Hls.Events.ERROR,function(Yr,mt){if(mt.fatal)switch(mt.type){case Hls.ErrorTypes.NETWORK_ERROR:console.error(`fatal ${Yr} network error encountered, try to recover`),_r.startLoad();break;case Hls.ErrorTypes.MEDIA_ERROR:console.error(`fatal ${Yr} media error encountered, try to recover`),_r.recoverMediaError();break;default:_r.destroy();break}}),()=>{if(_r&&lt.current){const Yr=lt.current;_r.detachMedia(),_r.destroy(),Yr.currentTime=0}}},[pt.withCredentials,rt.id]),reactExports.useEffect(()=>{var gt,_r,Yr,mt;const Kr=ft.get(dt),Xr=(gt=Kr.accompanyingCanvas)!=null&&gt.id?N(ft,(_r=Kr.accompanyingCanvas)==null?void 0:_r.id):null,Zr=(Yr=Kr.placeholderCanvas)!=null&&Yr.id?N(ft,(mt=Kr.placeholderCanvas)==null?void 0:mt.id):null;Xr&&Zr?ot(nt===0?Zr[0].id:Xr[0].id):(Xr&&ot(Xr[0].id),Zr&&ot(Zr[0].id))},[dt,nt,ft]),reactExports.useEffect(()=>{if(lt!=null&&lt.current){const gt=lt.current;return gt==null||gt.addEventListener("timeupdate",()=>it(gt.currentTime)),()=>document.removeEventListener("timeupdate",()=>{})}},[]),e$1.createElement(vr,{css:{backgroundColor:pt.canvasBackgroundColor,maxHeight:pt.canvasHeight,position:"relative"},"data-testid":"player-wrapper",className:"clover-viewer-player-wrapper"},e$1.createElement("video",{id:"clover-iiif-video",key:rt.id,ref:lt,controls:!0,height:rt.height,width:rt.width,crossOrigin:"anonymous",poster:st,style:{maxHeight:pt.canvasHeight,position:"relative",zIndex:"1"}},tt.map(gt=>e$1.createElement("source",{src:gt.id,type:gt.format,key:gt.id})),et.length>0&&et.map(gt=>e$1.createElement(br,{resource:gt,ignoreCaptionLabels:pt.ignoreCaptionLabels||[],key:gt.id})),"Sorry, your browser doesn't support embedded videos."),ut&&e$1.createElement(xr,{ref:lt}))},Er=()=>e$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"close-svg-title",focusable:"false",viewBox:"0 0 512 512",role:"img"},e$1.createElement("title",{id:"close-svg-title"},"close"),e$1.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})),wr=({isMedia:tt})=>e$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"open-svg-title",focusable:"false",viewBox:"0 0 512 512",role:"img"},e$1.createElement("title",{id:"open-svg-title"},"open"),tt?e$1.createElement("path",{d:"M133 440a35.37 35.37 0 01-17.5-4.67c-12-6.8-19.46-20-19.46-34.33V111c0-14.37 7.46-27.53 19.46-34.33a35.13 35.13 0 0135.77.45l247.85 148.36a36 36 0 010 61l-247.89 148.4A35.5 35.5 0 01133 440z"}):e$1.createElement(e$1.Fragment,null,e$1.createElement("path",{d:"m456.69,421.39l-94.09-94.09c22.65-30.16,34.88-66.86,34.84-104.58,0-96.34-78.38-174.72-174.72-174.72S48,126.38,48,222.72s78.38,174.72,174.72,174.72c37.72.04,74.42-12.19,104.58-34.84l94.09,94.09c10.29,9.2,26.1,8.32,35.3-1.98,8.48-9.49,8.48-23.83,0-33.32Zm-233.97-73.87c-68.89-.08-124.72-55.91-124.8-124.8h0c0-68.93,55.87-124.8,124.8-124.8s124.8,55.87,124.8,124.8-55.87,124.8-124.8,124.8Z"}),e$1.createElement("path",{d:"m279.5,197.76h-3.35s-28.47,0-28.47,0v-31.82c-.77-13.79-12.57-24.33-26.36-23.56-12.71.71-22.85,10.86-23.56,23.56v3.35h0v28.47h-31.82c-13.79.77-24.33,12.57-23.56,26.36.71,12.71,10.86,22.85,23.56,23.56h3.35s28.47,0,28.47,0v31.82c.77,13.79,12.57,24.33,26.36,23.56,12.71-.71,22.85-10.86,23.56-23.56v-3.35h0v-28.47h31.82c13.79-.77,24.33-12.57,23.56-26.36-.71-12.71-10.86-22.85-23.56-23.56Z"}))),Cr=({handleToggle:tt,isInteractive:et,isMedia:rt})=>e$1.createElement(Ge,{onClick:tt,isInteractive:et,isMedia:rt,"data-testid":"placeholder-toggle"},et?e$1.createElement(Er,null):e$1.createElement(wr,{isMedia:rt})),Sr=({activeCanvas:tt,isMedia:et,painting:rt,resources:nt})=>{var it,st,ot;const[lt,ut]=e$1.useState(0),[ct,dt]=e$1.useState(!1),{configOptions:pt,customDisplays:ft,vault:gt}=k(),_r=gt.get(tt),Yr=(it=_r==null?void 0:_r.placeholderCanvas)==null?void 0:it.id,mt=!!Yr,Kr=(rt==null?void 0:rt.length)>1,Xr=Yr&&!ct&&!et,Zr=()=>dt(!ct),Qr=rs=>{const ss=rt.findIndex(hs=>hs.id===rs);ut(ss)},_i=ft.find(rs=>{var ss;let hs=!1;const{canvasId:os,paintingFormat:is}=rs.target;if(Array.isArray(os)&&os.length>0&&(hs=os.includes(tt)),Array.isArray(is)&&is.length>0){const cs=((ss=rt[lt])==null?void 0:ss.format)||"";hs=!!(cs&&is.includes(cs))}return hs}),ns=(st=_i==null?void 0:_i.display)==null?void 0:st.component;return e$1.createElement(Xn,{className:"clover-viewer-painting"},e$1.createElement(Yn,{style:{backgroundColor:pt.canvasBackgroundColor,maxHeight:pt.canvasHeight}},Yr&&!et&&e$1.createElement(Cr,{handleToggle:Zr,isInteractive:ct,isMedia:et}),Xr&&!et&&e$1.createElement(gr,{isMedia:et,label:_r==null?void 0:_r.label,placeholderCanvas:Yr,setIsInteractive:dt}),!Xr&&!_i&&(et?e$1.createElement(yr,{allSources:rt,painting:rt[lt],resources:nt}):rt&&e$1.createElement(fr,{painting:rt[lt],hasPlaceholder:mt,key:tt})),!Xr&&ns&&e$1.createElement(ns,{id:tt,annotationBody:rt[lt],..._i==null?void 0:_i.display.componentProps})),Kr&&e$1.createElement(Ue,{value:(ot=rt[lt])==null?void 0:ot.id,onValueChange:Qr,maxHeight:"200px"},rt==null?void 0:rt.map(rs=>e$1.createElement(_e,{value:rs==null?void 0:rs.id,key:rs==null?void 0:rs.id,label:rs==null?void 0:rs.label}))))},kr=({activeCanvas:tt,painting:et,resources:rt,items:nt,isAudioVideo:it})=>{const{informationOpen:st,configOptions:ot}=k(),{informationPanel:lt}=ot,ut=(lt==null?void 0:lt.renderAbout)||(lt==null?void 0:lt.renderSupplementing)&&rt.length>0;return e$1.createElement(Ae,{className:"clover-viewer-content","data-testid":"clover-viewer-content"},e$1.createElement(Te,null,e$1.createElement(Sr,{activeCanvas:tt,isMedia:it,painting:et,resources:rt}),ut&&e$1.createElement(Me,null,e$1.createElement("span",null,st?"View Items":"More Information")),nt.length>1&&e$1.createElement($e,{className:"clover-viewer-media-wrapper"},e$1.createElement(Zn,{items:nt,activeItem:0}))),st&&ut&&e$1.createElement($t,null,e$1.createElement(Re,null,e$1.createElement(xn,{activeCanvas:tt,resources:rt}))))},Ir=m(W.Trigger,{width:"30px",padding:"5px"}),$r=m(W.Content,{display:"flex",flexDirection:"column",fontSize:"0.8333rem",border:"none",boxShadow:"2px 2px 5px #0003",zIndex:"2",button:{display:"flex",textDecoration:"none",marginBottom:"0.5em",color:"$accentAlt",cursor:"pointer",background:"$secondary",border:"none","&:last-child":{marginBottom:"0"}}}),Ar=m("span",{fontSize:"1.33rem",alignSelf:"flex-start",flexGrow:"0",flexShrink:"1",padding:"1rem","@sm":{fontSize:"1rem"},"&.visually-hidden":{position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",border:"0"}}),Tr=m("header",{display:"flex",backgroundColor:"transparent !important",justifyContent:"space-between",alignItems:"flex-start",width:"100%",[`> ${qe}`]:{flexGrow:"1",flexShrink:"0"},form:{flexGrow:"0",flexShrink:"1"}}),Mr=m("div",{display:"flex",alignItems:"flex-end",justifyContent:"flex-end",padding:"1rem",flexShrink:"0",flexGrow:"1"}),Rr=()=>{var tt;const et=O(),rt=k(),{activeManifest:nt,collection:it,configOptions:st,vault:ot}=rt,lt=st==null?void 0:st.canvasHeight,ut=ct=>{et({type:"updateActiveManifest",manifestId:ct})};return e$1.createElement("div",{style:{margin:"0.75rem"}},e$1.createElement(Ue,{label:it.label,maxHeight:lt,value:nt,onValueChange:ut},(tt=it==null?void 0:it.items)==null?void 0:tt.map(ct=>e$1.createElement(_e,{value:ct.id,key:ct.id,thumbnail:ct!=null&&ct.thumbnail?ot.get(ct==null?void 0:ct.thumbnail):void 0,label:ct.label}))))},zr=(tt,et=2500)=>{const[rt,nt]=reactExports.useState(),it=reactExports.useCallback(()=>{navigator.clipboard.writeText(tt).then(()=>nt("copied"),()=>nt("failed"))},[tt]);return reactExports.useEffect(()=>{if(!rt)return;const st=setTimeout(()=>nt(void 0),et);return()=>clearTimeout(st)},[rt]),[rt,it]},Lr=m("span",{display:"flex",alignContent:"center",alignItems:"center",padding:"0.125rem 0.25rem 0",marginTop:"-0.125rem",marginLeft:"0.5rem",backgroundColor:"$accent",color:"$secondary",borderRadius:"3px",fontSize:"0.6111rem",textTransform:"uppercase",lineHeight:"1em"}),Fr=({status:tt})=>tt?e$1.createElement(Lr,{"data-copy-status":tt},tt):null,fe=({textPrompt:tt,textToCopy:et})=>{const[rt,nt]=zr(et);return e$1.createElement("button",{onClick:nt},tt," ",e$1.createElement(Fr,{status:rt}))},Pr=()=>{const tt="#ed1d33",et="#2873ab";return e$1.createElement("svg",{viewBox:"0 0 493.35999 441.33334",id:"iiif-logo",version:"1.1"},e$1.createElement("title",null,"IIIF Manifest Options"),e$1.createElement("g",{transform:"matrix(1.3333333,0,0,-1.3333333,0,441.33333)"},e$1.createElement("g",{transform:"scale(0.1)"},e$1.createElement("path",{style:{fill:et},d:"M 65.2422,2178.75 775.242,1915 773.992,15 65.2422,276.25 v 1902.5"}),e$1.createElement("path",{style:{fill:et},d:"m 804.145,2640.09 c 81.441,-240.91 -26.473,-436.2 -241.04,-436.2 -214.558,0 -454.511,195.29 -535.9527,436.2 -81.4335,240.89 26.4805,436.18 241.0387,436.18 214.567,0 454.512,-195.29 535.954,-436.18"}),e$1.createElement("path",{style:{fill:tt},d:"M 1678.58,2178.75 968.578,1915 969.828,15 1678.58,276.25 v 1902.5"}),e$1.createElement("path",{style:{fill:tt},d:"m 935.082,2640.09 c -81.437,-240.91 26.477,-436.2 241.038,-436.2 214.56,0 454.51,195.29 535.96,436.2 81.43,240.89 -26.48,436.18 -241.04,436.18 -214.57,0 -454.52,-195.29 -535.958,-436.18"}),e$1.createElement("path",{style:{fill:et},d:"m 1860.24,2178.75 710,-263.75 -1.25,-1900 -708.75,261.25 v 1902.5"}),e$1.createElement("path",{style:{fill:et},d:"m 2603.74,2640.09 c 81.45,-240.91 -26.47,-436.2 -241.03,-436.2 -214.58,0 -454.52,195.29 -535.96,436.2 -81.44,240.89 26.48,436.18 241.03,436.18 214.57,0 454.51,-195.29 535.96,-436.18"}),e$1.createElement("path",{style:{fill:tt},d:"m 3700.24,3310 v -652.5 c 0,0 -230,90 -257.5,-142.5 -2.5,-247.5 0,-336.25 0,-336.25 l 257.5,83.75 V 1690 l -258.61,-92.5 V 262.5 L 2735.24,0 v 2360 c 0,0 -15,850 965,950"}))))},Vr=m($6be4966fd9bbc698$export$be92b6f5f03c0fe9,{all:"unset",height:"2rem",width:"3.236rem",backgroundColor:"#6663",borderRadius:"9999px",position:"relative",WebkitTapHighlightColor:"transparent",cursor:"pointer","&:focus":{boxShadow:"0 0 0 2px $secondaryAlt"},'&[data-state="checked"]':{backgroundColor:"$accent",boxShadow:"inset 2px 2px 5px #0003"}}),Br=m($6be4966fd9bbc698$export$6521433ed15a34db,{display:"block",height:"calc(2rem - 12px)",width:"calc(2rem - 12px)",backgroundColor:"$secondary",borderRadius:"100%",boxShadow:"2px 2px 5px #0001",transition:"$all",transform:"translateX(6px)",willChange:"transform",'&[data-state="checked"]':{transform:"translateX(calc(1.236rem + 6px))"}}),Hr=m("label",{fontSize:"0.8333rem",fontWeight:"400",lineHeight:"1em",userSelect:"none",cursor:"pointer",paddingRight:"0.618rem"}),Or=m("form",{display:"flex",flexShrink:"0",flexGrow:"1",alignItems:"center",marginLeft:"1.618rem"}),Dr=()=>{var tt;const{configOptions:et}=k(),rt=O(),[nt,it]=reactExports.useState((tt=et==null?void 0:et.informationPanel)==null?void 0:tt.open);return reactExports.useEffect(()=>{rt({type:"updateInformationOpen",informationOpen:nt})},[nt]),e$1.createElement(Or,null,e$1.createElement(Hr,{htmlFor:"information-toggle",css:nt?{opacity:"1"}:{}},"More Information"),e$1.createElement(Vr,{checked:nt,onCheckedChange:()=>it(!nt),id:"information-toggle","aria-label":"information panel toggle",name:"toggled?"},e$1.createElement(Br,null)))},Ze=tt=>{const et=()=>window.matchMedia?window.matchMedia(tt).matches:!1,[rt,nt]=reactExports.useState(et);return reactExports.useEffect(()=>{const it=()=>nt(et);return window.addEventListener("resize",it),()=>window.removeEventListener("resize",it)}),rt},Wr=({manifestId:tt,manifestLabel:et})=>{const rt=k(),{collection:nt,configOptions:it}=rt,{showTitle:st,showIIIFBadge:ot,informationPanel:lt}=it,ut=ot||(lt==null?void 0:lt.renderToggle),ct=Ze(te.sm);return e$1.createElement(Tr,{className:"clover-viewer-header"},nt!=null&&nt.items?e$1.createElement(Rr,null):e$1.createElement(Ar,{className:st?"":"visually-hidden"},st&&e$1.createElement(L,{label:et,className:"label"})),ut&&e$1.createElement(Mr,null,ot&&e$1.createElement(W,null,e$1.createElement(Ir,null,e$1.createElement(Pr,null)),e$1.createElement($r,null,(nt==null?void 0:nt.items)&&e$1.createElement("button",{onClick:dt=>{dt.preventDefault(),window.open(nt.id,"_blank")}},"View Collection"),e$1.createElement("button",{onClick:dt=>{dt.preventDefault(),window.open(tt,"_blank")}},"View Manifest")," ",(nt==null?void 0:nt.items)&&e$1.createElement(fe,{textPrompt:"Copy Collection URL",textToCopy:nt.id}),e$1.createElement(fe,{textPrompt:"Copy Manifest URL",textToCopy:tt}))),(lt==null?void 0:lt.renderToggle)&&!ct&&e$1.createElement(Dr,null)))},jr=(tt=!1)=>{const[et,rt]=reactExports.useState(tt);return reactExports.useLayoutEffect(()=>{if(!et)return;const nt=document.documentElement.style.overflow;return document.documentElement.style.overflow="hidden",()=>{document.documentElement.style.overflow=nt}},[et]),reactExports.useEffect(()=>{et!==tt&&rt(tt)},[tt]),[et,rt]},Nr=({manifest:tt,theme:et})=>{var rt;const nt=k(),it=O(),{activeCanvas:st,informationOpen:ot,vault:lt,configOptions:ut}=nt,[ct,dt]=reactExports.useState(!1),[pt,ft]=reactExports.useState(!1),[gt,_r]=reactExports.useState([]),[Yr,mt]=reactExports.useState([]),[Kr,Xr]=jr(!1),Zr=Ze(te.sm),Qr=reactExports.useCallback(_i=>{it({type:"updateInformationOpen",informationOpen:_i})},[it]);return reactExports.useEffect(()=>{var _i;(_i=ut==null?void 0:ut.informationPanel)!=null&&_i.open&&Qr(!Zr)},[Zr,(rt=ut==null?void 0:ut.informationPanel)==null?void 0:rt.open,Qr]),reactExports.useEffect(()=>{if(!Zr){Xr(!1);return}Xr(ot)},[ot,Zr,Xr]),reactExports.useEffect(()=>{const _i=N(lt,st),ns=yt(lt,st,"text/vtt");_i&&(ft(["Sound","Video"].indexOf(_i[0].type)>-1),_r(_i)),mt(ns),dt(ns.length!==0)},[st,lt]),e$1.createElement(ErrorBoundary,{FallbackComponent:It},e$1.createElement(At,{className:`${et} clover-viewer`,css:{background:ut==null?void 0:ut.background},"data-body-locked":Kr,"data-information-panel":ct,"data-information-panel-open":ot},e$1.createElement($409067139f391064$export$be92b6f5f03c0fe9,{open:ot,onOpenChange:Qr},e$1.createElement(Wr,{manifestLabel:tt.label,manifestId:tt.id}),e$1.createElement(kr,{activeCanvas:st,painting:gt,resources:Yr,items:tt.items,isAudioVideo:pt}))))},ge={ignoreCache:!1,headers:{Accept:"application/json, text/javascript, text/plain"},timeout:5e3,withCredentials:!1};function Gr(tt){return{ok:tt.status>=200&&tt.status<300,status:tt.status,statusText:tt.statusText,headers:tt.getAllResponseHeaders(),data:tt.responseText,json:()=>JSON.parse(tt.responseText)}}function he(tt,et=null){return{ok:!1,status:tt.status,statusText:tt.statusText,headers:tt.getAllResponseHeaders(),data:et||tt.statusText,json:()=>JSON.parse(et||tt.statusText)}}function qr(tt,et=ge){const rt=et.headers||ge.headers;return new Promise((nt,it)=>{const st=new XMLHttpRequest;st.open("get",tt),st.withCredentials=et.withCredentials,rt&&Object.keys(rt).forEach(ot=>st.setRequestHeader(ot,rt[ot])),st.onload=()=>{nt(Gr(st))},st.onerror=()=>{it(he(st,"Failed to make request."))},st.ontimeout=()=>{it(he(st,"Request took longer than expected."))},st.send()})}const ao=({canvasIdCallback:tt=()=>{},customDisplays:et=[],customTheme:rt,iiifContent:nt,id:it,manifestId:st,options:ot})=>{var lt;let ut=nt;return it&&(ut=it),st&&(ut=st),e$1.createElement(bt,{initialState:{..._,customDisplays:et,informationOpen:!!((lt=ot==null?void 0:ot.informationPanel)!=null&&lt.open),vault:new Vault({customFetcher:ct=>qr(ct,{withCredentials:ot==null?void 0:ot.withCredentials,headers:ot==null?void 0:ot.requestHeaders}).then(dt=>JSON.parse(dt.data))})}},e$1.createElement(Ur,{iiifContent:ut,canvasIdCallback:tt,customTheme:rt,options:ot}))},Ur=({canvasIdCallback:tt,customTheme:et,iiifContent:rt,options:nt})=>{const it=O(),st=k(),{activeCanvas:ot,activeManifest:lt,isLoaded:ut,vault:ct}=st,[dt,pt]=reactExports.useState(),[ft,gt]=reactExports.useState();let _r={};return et&&(_r=Q$1("custom",et)),reactExports.useEffect(()=>{tt&&tt(ot)},[ot,tt]),reactExports.useEffect(()=>{lt&&ct.loadManifest(lt).then(Yr=>{gt(Yr),it({type:"updateActiveCanvas",canvasId:Yr.items[0]&&Yr.items[0].id})}).catch(Yr=>{console.error(`Manifest failed to load: ${Yr}`)}).finally(()=>{it({type:"updateIsLoaded",isLoaded:!0})})},[lt,it,ct]),reactExports.useEffect(()=>{it({type:"updateConfigOptions",configOptions:nt}),ct.load(rt).then(Yr=>{pt(Yr)}).catch(Yr=>{console.error(`The IIIF resource ${rt} failed to load: ${Yr}`)})},[it,rt,nt,ct]),reactExports.useEffect(()=>{let Yr=[];(dt==null?void 0:dt.type)==="Collection"?(it({type:"updateCollection",collection:dt}),Yr=dt.items.filter(mt=>mt.type==="Manifest").map(mt=>mt.id),Yr.length>0&&it({type:"updateActiveManifest",manifestId:Yr[0]})):(dt==null?void 0:dt.type)==="Manifest"&&it({type:"updateActiveManifest",manifestId:dt.id})},[it,dt]),ut?!ft||!ft.items?(console.log(`The IIIF manifest ${rt} failed to load.`),e$1.createElement(e$1.Fragment,null)):ft.items.length===0?(console.log(`The IIIF manifest ${rt} does not contain canvases.`),e$1.createElement(e$1.Fragment,null)):e$1.createElement(Nr,{manifest:ft,theme:_r,key:ft.id}):e$1.createElement(e$1.Fragment,null,"Loading")};class CloverInitializer{constructor(){this.element=document.getElementById("clover-viewer"),this.element&&(this.iiif_content=this.element.attributes.iiif_content.value)}run(){if(!this.iiif_content)return!1;createRoot(document.getElementById("clover-viewer")).render(reactExports.createElement(ao,{id:this.iiif_content,options:this.config}))}get config(){return{showTitle:!1,showIIIFBadge:!1,informationPanel:{renderToggle:!1,renderAbout:!1}}}}document.addEventListener("DOMContentLoaded",()=>{new CloverInitializer().run()});
