(function(n,d){typeof exports=="object"&&typeof module<"u"?d(exports,require("openseadragon"),require("@iiif/vault-helpers")):typeof define=="function"&&define.amd?define(["exports","openseadragon","@iiif/vault-helpers"],d):(n=typeof globalThis<"u"?globalThis:n||self,d(n.CloverIIIFHelpers={},n.OpenSeadragon))})(this,function(n,d){"use strict";const u=e=>{var o,c,r,s,h;let i={id:typeof e=="string"?e:e.source};if(typeof e=="string"){if(e.includes("#xywh=")){const t=e.split("#xywh=");if(t&&t[1]){const[f,p,v,a]=t[1].split(",").map(w=>Number(w));i={id:t[0],rect:{x:f,y:p,w:v,h:a}}}}else if(e.includes("#t=")){const t=e.split("#t=");t&&t[1]&&(i={id:t[0],t:t[1]})}}else if(typeof e=="object"){if(((o=e.selector)==null?void 0:o.type)==="PointSelector")i={id:e.source,point:{x:e.selector.x,y:e.selector.y}};else if(((c=e.selector)==null?void 0:c.type)==="SvgSelector")i={id:e.source,svg:e.selector.value};else if(((r=e.selector)==null?void 0:r.type)==="FragmentSelector"&&(s=e.selector)!=null&&s.value.includes("xywh=")&&e.source.type=="Canvas"&&e.source.id){const t=(h=e.selector)==null?void 0:h.value.split("xywh=");if(t&&t[1]){const[f,p,v,a]=t[1].split(",").map(w=>Number(w));i={id:e.source.id,rect:{x:f,y:p,w:v,h:a}}}}}return i};let l=window.OpenSeadragon;if(!l&&(l=d,!l))throw new Error("OpenSeadragon is missing.");const _="http://www.w3.org/2000/svg";l.Viewer&&(l.Viewer.prototype.svgOverlay=function(){return this._svgOverlayInfo?this._svgOverlayInfo:(this._svgOverlayInfo=new y(this),this._svgOverlayInfo)});const y=function(e){const i=this;this._viewer=e,this._containerWidth=0,this._containerHeight=0,this._svg=document.createElementNS(_,"svg"),this._svg.style.position="absolute",this._svg.style.left=0,this._svg.style.top=0,this._svg.style.width="100%",this._svg.style.height="100%",this._viewer.canvas.appendChild(this._svg),this._node=document.createElementNS(_,"g"),this._svg.appendChild(this._node),this._viewer.addHandler("animation",function(){i.resize()}),this._viewer.addHandler("open",function(){i.resize()}),this._viewer.addHandler("rotate",function(){i.resize()}),this._viewer.addHandler("flip",function(){i.resize()}),this._viewer.addHandler("resize",function(){i.resize()}),this.resize()};y.prototype={node:function(){return this._node},resize:function(){this._containerWidth!==this._viewer.container.clientWidth&&(this._containerWidth=this._viewer.container.clientWidth,this._svg.setAttribute("width",this._containerWidth)),this._containerHeight!==this._viewer.container.clientHeight&&(this._containerHeight=this._viewer.container.clientHeight,this._svg.setAttribute("height",this._containerHeight));const e=this._viewer.viewport.pixelFromPoint(new l.Point(0,0),!0),i=this._viewer.viewport.getZoom(!0),o=this._viewer.viewport.getRotation(),c=this._viewer.viewport.getFlip(),r=this._viewer.viewport._containerInnerSize.x;let s=r*i;const h=s;c&&(s=-s,e.x=-e.x+r),this._node.setAttribute("transform","translate("+e.x+","+e.y+") scale("+s+","+h+") rotate("+o+")")},onClick:function(e,i){new l.MouseTracker({element:e,clickHandler:i}).setTracking(!0)}};function g(e,i,o){let c,r,s=40,h=40;i.rect&&(c=i.rect.x,r=i.rect.y,s=i.rect.w,h=i.rect.h),i.point&&(c=i.point.x,r=i.point.y),u.svg;const t=1/e.width;return new d.Rect(c*t-s*t/2*(o-1),r*t-h*t/2*(o-1),s*t*o,h*t*o)}const m={parseAnnotationTarget:u,createOpenSeadragonRect:g};n.createOpenSeadragonRect=g,n.default=m,n.parseAnnotationTarget=u,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=index.umd.js.map
